<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Rabbitmq notes | Harry Blog</title><meta name="keywords" content="backend,summary,message queue"><meta name="author" content="Harry Qu"><meta name="copyright" content="Harry Qu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="# RabbitMQ  # 1 MQ 引言 # 1.1 什么是 MQ MQ(Message Quene) :  翻译为消息队列,通过典型的生产者 和消费者模型,生产者不断向消息队列中生产消息，消费者 不断的从队列中获取消息。因为消息的生产和消费都是异 步的，而且只关心消息的发送和接收，没有业务逻辑的侵 入,轻松的实现系统间解耦。别名为 消息中间件通过利用 高效可靠的消息传递机制进行平台无关的数据交">
<meta property="og:type" content="article">
<meta property="og:title" content="Rabbitmq notes">
<meta property="og:url" content="https://harryqu1229.github.io/2022/03/20/rabbitmq%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Harry Blog">
<meta property="og:description" content="# RabbitMQ  # 1 MQ 引言 # 1.1 什么是 MQ MQ(Message Quene) :  翻译为消息队列,通过典型的生产者 和消费者模型,生产者不断向消息队列中生产消息，消费者 不断的从队列中获取消息。因为消息的生产和消费都是异 步的，而且只关心消息的发送和接收，没有业务逻辑的侵 入,轻松的实现系统间解耦。别名为 消息中间件通过利用 高效可靠的消息传递机制进行平台无关的数据交">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://harryqu1229.github.io/img/default-covers/mountain.jpg">
<meta property="article:published_time" content="2022-03-19T11:00:00.000Z">
<meta property="article:modified_time" content="2022-06-12T01:13:32.148Z">
<meta property="article:author" content="Harry Qu">
<meta property="article:tag" content="backend">
<meta property="article:tag" content="summary">
<meta property="article:tag" content="message queue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://harryqu1229.github.io/img/default-covers/mountain.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://harryqu1229.github.io/2022/03/20/rabbitmq%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":100,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#C78550","bgDark":"#c08eaf","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Rabbitmq notes',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-12 13:13:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">158</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">57</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pedrorijo.com/assets/img/rabbitmq_logo.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Harry Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Rabbitmq notes</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-03-19T11:00:00.000Z" title="Created 2022-03-20 00:00:00">2022-03-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-12T01:13:32.148Z" title="Updated 2022-06-12 13:13:32">2022-06-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Backend/">Backend</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Backend/message-queue/">message queue</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">10.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>47min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Rabbitmq notes"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="rabbitmq"><a class="markdownIt-Anchor" href="#rabbitmq">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=RabbitMQ&amp;spm=1001.2101.3001.7020">RabbitMQ</a></h1>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210705145929233.png" alt=""></p>
<h2 id="1-mq引言"><a class="markdownIt-Anchor" href="#1-mq引言">#</a> 1 MQ 引言</h2>
<h3 id="11-什么是mq"><a class="markdownIt-Anchor" href="#11-什么是mq">#</a> 1.1 什么是 MQ</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">MQ(Message Quene) :  翻译为消息队列,通过典型的生产者
和消费者模型,生产者不断向消息队列中生产消息，消费者
不断的从队列中获取消息。因为消息的生产和消费都是异
步的，而且只关心消息的发送和接收，没有业务逻辑的侵
入,轻松的实现系统间解耦。别名为 消息中间件通过利用
高效可靠的消息传递机制进行平台无关的数据交流，并
基于数据通信来进行分布式系统的集成。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="12-mq有哪些"><a class="markdownIt-Anchor" href="#12-mq有哪些">#</a> 1.2 MQ 有哪些</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">当今市面上有很多主流的消息中间件，如老牌的ActiveMQ、
RabbitMQ，炙手可热的Kafka，阿里巴巴自主开发RocketMQ等。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="13-不同mq特点"><a class="markdownIt-Anchor" href="#13-不同mq特点">#</a> 1.3 不同 MQ 特点</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">1.ActiveMQ
		ActiveMQ 是Apache出品，最流行的，能力强劲的开源
		消息总线。它是一个完全支持JMS规范的的消息中间件。
		丰富的API,多种集群架构模式让ActiveMQ在业界成为老
		牌的消息中间件,在中小型企业 颇受欢迎!

2.Kafka
		Kafka是LinkedIn开源的分布式发布-订阅消息系统，目
		前归属于Apache顶级项目。Kafka主要特点是基于Pull
		的模式来处理消息消费，追求高吞吐量，一开始的目的
		就是用于日志收集和传输。0.8版本开始支持复制，不支
		持事务，对消息的重复、丢失、错误没有严格要求，
		适合产生大量数据的互联网服务的数据收集业务。

3.RocketMQ
		RocketMQ是阿里开源的消息中间件，它是纯Java开发，
		具有高吞吐量、高可用性、适合大规模分布式系统应用
		的特点。RocketMQ思路起源于Kafka，但并不是Kafka
		的一个Copy，它对消息的可靠传输及事务性做了优化，
		目前在阿里集团被广泛应用于交   易、充值、流计算、
		消息推送、日志流式处理、binglog分发等场景。

4.RabbitMQ
		RabbitMQ是使用Erlang语言开发的开源消息队列系统，
		基于AMQP协议来实现。AMQP的主要特征是面向消息、
		队列、路由（包括点对点和发布/订阅）、可靠性、安全。
		AMQP协议更多用在企业系统内对数据一致性、稳定性和
		可靠性要求很高的场景，对性能和吞吐量的要求还在
		其次。

RabbitMQ比Kafka可靠，Kafka更适合IO高吞吐的处理，一般应用
在大数据日志处理或对实时性（少量延迟），可靠性（少量丢数据）
要求稍低的场景使用，比如ELK日志收集。		
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-rabbitmq-的引言"><a class="markdownIt-Anchor" href="#2-rabbitmq-的引言">#</a> 2 RabbitMQ 的引言</h2>
<h3 id="21-rabbitmq"><a class="markdownIt-Anchor" href="#21-rabbitmq">#</a> 2.1 RabbitMQ</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">基于AMQP协议，erlang语言开发，是部署最广泛的开源
消息中间件,是最受欢迎的开源消息中间件之一。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030175407725.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">AMQP 协议
 	AMQP（advanced message queuing protocol）在2003年
 	时被提出，最早用于解决金融领不同平台之间的消息传递
 	交互问题。顾名思义，AMQP是一种协议，更准确的说是
 	一种binary wire-level protocol（链接协议）。这是其和
 	JMS的本质差别，AMQP不从API层进行限定，而是直接
 	定义网络交换的数据格式。这使得实现了AMQP的
 	provider天然性就是跨平台的。以下是AMQP协议模型:
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030175435428.png" alt=""></p>
<h3 id="22-rabbitmq-的安装"><a class="markdownIt-Anchor" href="#22-rabbitmq-的安装">#</a> 2.2 RabbitMQ 的安装</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">最新版的3.8版本的可以看我这篇文章
https://blog.csdn.net/unique_perfect/article/details/108643804
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="221-下载"><a class="markdownIt-Anchor" href="#221-下载">#</a> 2.2.1 下载</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030175453979.png" alt=""></p>
<h4 id="222-下载的安装包"><a class="markdownIt-Anchor" href="#222-下载的安装包">#</a> 2.2.2 下载的安装包</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030175542524.png#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">注意:这里的安装包是centos7安装的包
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="223-安装步骤"><a class="markdownIt-Anchor" href="#223-安装步骤">#</a> 2.2.3 安装步骤</h4>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.将rabbitmq安装包上传到linux系统中</span>
	erlang-22.0.7-1.el7.x86_64.rpm  #l7表示是Centosl7,Centosl8表示Centos8
	rabbitmq-server-3.7.18-1.el7.noarch.rpm

<span class="token title important"><span class="token punctuation">#</span> 2.安装Erlang依赖包</span>
	rpm -ivh erlang-22.0.7-1.el7.x86_64.rpm

<span class="token title important"><span class="token punctuation">#</span> 3.安装RabbitMQ安装包(需要联网)</span>
	yum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm
	注意:默认安装完成后配置文件模板在:/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example目录中,需要	
	将配置文件复制到/etc/rabbitmq/目录中,并修改名称为rabbitmq.config
<span class="token title important"><span class="token punctuation">#</span> 4.复制配置文件</span>
	cp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config

<span class="token title important"><span class="token punctuation">#</span> 5.查看配置文件位置</span>
	ls /etc/rabbitmq/rabbitmq.config

<span class="token title important"><span class="token punctuation">#</span> 6.修改配置文件(参见下图:)</span>
	vim /etc/rabbitmq/rabbitmq.config 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/2020103017560848.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">将上图中配置文件中红色部分去掉<span class="token code-snippet code keyword">`%%`</span>,以及最后的<span class="token code-snippet code keyword">`,`</span>逗号 
修改为下图:
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030175704618.png" alt=""></p>
<pre class="line-numbers language-none"><code class="language-none">&#96;# 7.执行如下命令,启动rabbitmq中的插件管理
	rabbitmq-plugins enable rabbitmq_management
	
	出现如下说明:
		Enabling plugins on node rabbit@localhost:
    rabbitmq_management
    The following plugins have been configured:
      rabbitmq_management
      rabbitmq_management_agent
      rabbitmq_web_dispatch
    Applying plugin configuration to rabbit@localhost...
    The following plugins have been enabled:
      rabbitmq_management
      rabbitmq_management_agent
      rabbitmq_web_dispatch

    set 3 plugins.
    Offline change; changes will take effect at broker restart.

# 8.启动RabbitMQ的服务
	systemctl start rabbitmq-server
	systemctl restart rabbitmq-server
	systemctl stop rabbitmq-server
	

# 9.查看服务状态(见下图:)
	systemctl status rabbitmq-server
  ● rabbitmq-server.service - RabbitMQ broker
     Loaded: loaded (&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;rabbitmq-server.service; disabled; vendor preset: disabled)
     Active: active (running) since 三 2019-09-25 22:26:35 CST; 7s ago
   Main PID: 2904 (beam.smp)
     Status: &quot;Initialized&quot;
     CGroup: &#x2F;system.slice&#x2F;rabbitmq-server.service
             ├─2904 &#x2F;usr&#x2F;lib64&#x2F;erlang&#x2F;erts-10.4.4&#x2F;bin&#x2F;beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -
             MBlmbcs...
             ├─3220 erl_child_setup 32768
             ├─3243 inet_gethost 4
             └─3244 inet_gethost 4
      .........&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35
*   36
*   37
*   38
*   39

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030175729252.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 10.关闭防火墙服务</span>
	systemctl disable firewalld  # 需要关闭防火墙，否则访问不了
    Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
    Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
	systemctl stop firewalld   

<span class="token title important"><span class="token punctuation">#</span> 11.访问web管理界面</span>
	http://10.15.0.8:15672/
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030175753712.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 12.登录管理界面</span>
	username:  guest
	password:  guest
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030175814170.png" alt=""></p>
<h2 id="3-rabiitmq-配置"><a class="markdownIt-Anchor" href="#3-rabiitmq-配置">#</a> 3 RabiitMQ 配置</h2>
<h3 id="31-rabbitmq-管理命令行"><a class="markdownIt-Anchor" href="#31-rabbitmq-管理命令行">#</a> 3.1 RabbitMQ 管理命令行</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 1.服务启动相关</span>
	systemctl start|restart|stop|status rabbitmq-server

<span class="token title important"><span class="token punctuation">#</span> 2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ</span>
	rabbitmqctl  help  可以查看更多命令

<span class="token title important"><span class="token punctuation">#</span> 3.插件管理命令行</span>
	rabbitmq-plugins enable|list|disable 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="32-web管理界面介绍"><a class="markdownIt-Anchor" href="#32-web管理界面介绍">#</a> 3.2 web 管理界面介绍</h3>
<h4 id="321-overview概览"><a class="markdownIt-Anchor" href="#321-overview概览">#</a> 3.2.1 overview 概览</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030175840800.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">connections：无论生产者还是消费者，都需要与RabbitMQ建立连接后才
可以完成消息的生产和消费，在这里可以查看连接情况`

channels：通道，建立连接后，会形成通道，消息的投递获取依赖通道。

Exchanges：交换机，用来实现消息的路由

Queues：队列，即消息队列，消息存放在队列中，等待消费，
消费后被移除队列。

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="322-admin用户和虚拟主机管理"><a class="markdownIt-Anchor" href="#322-admin用户和虚拟主机管理">#</a> 3.2.2 Admin 用户和虚拟主机管理</h4>
<h5 id="3221-添加用户"><a class="markdownIt-Anchor" href="#3221-添加用户">#</a> 3.2.2.1 添加用户</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210705193528571.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">上面的Tags选项，其实是指定用户的角色，可选的有以下几个：

超级管理员(administrator)

可登陆管理控制台，可查看所有的信息，并且可以对用户，
策略(policy)进行操作。

监控者(monitoring)

可登陆管理控制台，同时可以查看rabbitmq节点的相关信息
(进程数，内存使用情况，磁盘使用情况等)

策略制定者(policymaker)

可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的
相关信息(上图红框标识的部分)。

普通管理者(management)

仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。

其他

无法登陆管理控制台，通常就是普通的生产者和消费者。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="3222-创建虚拟主机"><a class="markdownIt-Anchor" href="#3222-创建虚拟主机">#</a> 3.2.2.2 创建虚拟主机</h5>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">虚拟主机
为了让各个用户可以互不干扰的工作，RabbitMQ添加了
虚拟主机（Virtual Hosts）的概念。其实就是一个独立的
访问路径，不同用户使用不同路径，各自有自己的
队列、交换机，互相不会影响。相当于关系型中的数据库
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/202107051936520.png" alt=""></p>
<h5 id="3223-绑定虚拟主机和用户"><a class="markdownIt-Anchor" href="#3223-绑定虚拟主机和用户">#</a> 3.2.2.3 绑定虚拟主机和用户</h5>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">创建好虚拟主机，我们还要给用户添加访问权限：

点击添加好的虚拟主机：
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210705193758998.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">进入虚拟机设置界面
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210705193911356.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt=""></p>
<h2 id="4-rabbitmq-的第一个程序"><a class="markdownIt-Anchor" href="#4-rabbitmq-的第一个程序">#</a> 4 RabbitMQ 的第一个程序</h2>
<h3 id="41-amqp协议的回顾"><a class="markdownIt-Anchor" href="#41-amqp协议的回顾">#</a> 4.1 AMQP 协议的回顾</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210705194004304.png" alt=""></p>
<h3 id="42-rabbitmq支持的消息模型"><a class="markdownIt-Anchor" href="#42-rabbitmq支持的消息模型">#</a> 4.2 RabbitMQ 支持的消息模型</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/2020103018025840.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030180315852.png" alt=""></p>
<h3 id="43-引入依赖"><a class="markdownIt-Anchor" href="#43-引入依赖">#</a> 4.3 引入依赖</h3>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rabbitmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>amqp-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>5.7.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="44-第一种模型直连"><a class="markdownIt-Anchor" href="#44-第一种模型直连">#</a> 4.4 第一种模型 (直连)</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030180349461.png#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">在上图的模型中，有以下概念：

P：生产者，也就是要发送消息的程序
C：消费者：消息的接受者，会一直等待消息到来。
queue：消息队列，图中红色部分。类似一个邮箱，
可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="441-开发生产者"><a class="markdownIt-Anchor" href="#441-开发生产者">#</a> 4.4.1 开发生产者</h4>
<pre class="line-numbers language-none"><code class="language-none">&#96;package helloword;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.MessageProperties;
import org.junit.Test;
import utils.RabbitMQUtils;

import java.io.IOException;
import java.util.concurrent.TimeoutException;

public class Provider &#123;

    &#x2F;&#x2F;生产消息
    @Test
    public void testSendMessage() throws IOException, TimeoutException &#123;
&#x2F;*
        &#x2F;&#x2F;创建连接mq的连接工厂对象
        ConnectionFactory connectionFactory &#x3D; new ConnectionFactory();
        &#x2F;&#x2F;设置连接rabbitmq主机
        connectionFactory.setHost(&quot;192.168.11.143&quot;);
        &#x2F;&#x2F;设置端口号
        connectionFactory.setPort(5672);
        &#x2F;&#x2F;设置连接那个虚拟主机
        connectionFactory.setVirtualHost(&quot;&#x2F;ems&quot;);
        &#x2F;&#x2F;设置访问虚拟主机的用户名和密码
        connectionFactory.setUsername(&quot;ems&quot;);
        connectionFactory.setPassword(&quot;123&quot;);

        &#x2F;&#x2F;获取连接对象
        Connection connection &#x3D; connectionFactory.newConnection();*&#x2F;

        &#x2F;&#x2F;通过工具类获取连接对象
        Connection connection &#x3D; RabbitMQUtils.getConnection();

        &#x2F;&#x2F;获取连接中通道
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;通道绑定对应消息队列
        &#x2F;&#x2F;参数1:  队列名称 如果队列不存在自动创建
        &#x2F;&#x2F;参数2:  用来定义队列特性是否要持久化 true 持久化队列   false 不持久化
        &#x2F;&#x2F;参数3:  exclusive 是否独占队列  true 独占队列   false  不独占
        &#x2F;&#x2F;参数4:  autoDelete: 是否在消费完成后自动删除队列  true 自动删除  false 不自动删除
        &#x2F;&#x2F;参数5:  额外附加参数
        channel.queueDeclare(&quot;hello&quot;,true,false,false,null);

        &#x2F;&#x2F;发布消息

        &#x2F;&#x2F;参数1: 交换机名称 参数2:队列名称  参数3:传递消息额外设置  参数4:消息的具体内容
        channel.basicPublish(&quot;&quot;,&quot;hello&quot;, MessageProperties.PERSISTENT_TEXT_PLAIN,&quot;hello rabbitmq&quot;.getBytes());

        &#x2F;*channel.close();
        connection.close();*&#x2F;

        &#x2F;&#x2F;调用工具类
        RabbitMQUtils.closeConnectionAndChanel(channel,connection);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35
*   36
*   37
*   38
*   39
*   40
*   41
*   42
*   43
*   44
*   45
*   46
*   47
*   48
*   49
*   50
*   51
*   52
*   53
*   54
*   55
*   56
*   57
*   58
*   59
*   60
*   61
*   62

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210705212514383.png" alt=""></p>
<h4 id="442-开发消费者"><a class="markdownIt-Anchor" href="#442-开发消费者">#</a> 4.4.2 开发消费者</h4>
<pre class="line-numbers language-none"><code class="language-none">&#96;package helloword;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.MessageProperties;
import org.junit.Test;
import utils.RabbitMQUtils;

import java.io.IOException;
import java.util.concurrent.TimeoutException;

public class Provider &#123;

    &#x2F;&#x2F;生产消息
    @Test
    public void testSendMessage() throws IOException, TimeoutException &#123;
&#x2F;*
        &#x2F;&#x2F;创建连接mq的连接工厂对象
        ConnectionFactory connectionFactory &#x3D; new ConnectionFactory();
        &#x2F;&#x2F;设置连接rabbitmq主机
        connectionFactory.setHost(&quot;192.168.11.134&quot;);
        &#x2F;&#x2F;设置端口号
        connectionFactory.setPort(5672);
        &#x2F;&#x2F;设置连接那个虚拟主机
        connectionFactory.setVirtualHost(&quot;&#x2F;ems&quot;);
        &#x2F;&#x2F;设置访问虚拟主机的用户名和密码
        connectionFactory.setUsername(&quot;admin&quot;);
        connectionFactory.setPassword(&quot;admin&quot;);

        &#x2F;&#x2F;获取连接对象
        Connection connection &#x3D; connectionFactory.newConnection();*&#x2F;

        &#x2F;&#x2F;通过工具类获取连接对象
        Connection connection &#x3D; RabbitMQUtils.getConnection();

        &#x2F;&#x2F;获取连接中通道
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;通道绑定对应消息队列
        &#x2F;&#x2F;参数1:  队列名称 如果队列不存在自动创建
        &#x2F;&#x2F;参数2:  用来定义队列特性是否要持久化 true 持久化队列   false 不持久化
        &#x2F;&#x2F;参数3:  exclusive 是否独占队列  true 独占队列   false  不独占
        &#x2F;&#x2F;参数4:  autoDelete: 是否在消费完成后自动删除队列  true 自动删除  false 不自动删除
        &#x2F;&#x2F;参数5:  额外附加参数
        channel.queueDeclare(&quot;hello&quot;,true,false,false,null);

        &#x2F;&#x2F;发布消息

        &#x2F;&#x2F;参数1: 交换机名称 参数2:队列名称  参数3:传递消息额外设置  参数4:消息的具体内容
        channel.basicPublish(&quot;&quot;,&quot;hello&quot;, MessageProperties.PERSISTENT_TEXT_PLAIN,&quot;hello rabbitmq&quot;.getBytes());

        &#x2F;*channel.close();
        connection.close();*&#x2F;

        &#x2F;&#x2F;调用工具类
        RabbitMQUtils.closeConnectionAndChanel(channel,connection);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35
*   36
*   37
*   38
*   39
*   40
*   41
*   42
*   43
*   44
*   45
*   46
*   47
*   48
*   49
*   50
*   51
*   52
*   53
*   54
*   55
*   56
*   57
*   58
*   59
*   60
*   61

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="443-参数的说明"><a class="markdownIt-Anchor" href="#443-参数的说明">#</a> 4.4.3 参数的说明</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token string">'参数1'</span><span class="token operator">:</span>用来声明通道对应的队列
<span class="token string">'参数2'</span><span class="token operator">:</span>用来指定是否持久化队列
<span class="token string">'参数3'</span><span class="token operator">:</span>用来指定是否独占队列
<span class="token string">'参数4'</span><span class="token operator">:</span>用来指定是否自动删除队列
<span class="token string">'参数5'</span><span class="token operator">:</span>对队列的额外配置
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210705212734830.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210705212756452.png" alt=""></p>
<h4 id="444-工具类的包装"><a class="markdownIt-Anchor" href="#444-工具类的包装">#</a> 4.4.4 工具类的包装</h4>
<pre class="line-numbers language-none"><code class="language-none">&#96;package utils;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;

import java.util.Properties;

public class RabbitMQUtils &#123;

    private static ConnectionFactory connectionFactory;
    private static Properties properties;
    static&#123;
        &#x2F;&#x2F;重量级资源  类加载执行之执行一次
        connectionFactory &#x3D; new ConnectionFactory();
        connectionFactory.setHost(&quot;192.168.42.134&quot;);
        connectionFactory.setPort(5672);
        connectionFactory.setVirtualHost(&quot;&#x2F;&quot;);
        connectionFactory.setUsername(&quot;admin&quot;);
        connectionFactory.setPassword(&quot;admin&quot;);

    &#125;

    &#x2F;&#x2F;定义提供连接对象的方法
    public static Connection getConnection() &#123;
        try &#123;
            return connectionFactory.newConnection();
        &#125; catch (Exception e) &#123;
            e.printStackTrace();
        &#125;
        return null;
    &#125;

    &#x2F;&#x2F;关闭通道和关闭连接工具方法
    public static void closeConnectionAndChanel(Channel channel, Connection conn) &#123;
        try &#123;
            if(channel!&#x3D;null) channel.close();
            if(conn!&#x3D;null)   conn.close();
        &#125; catch (Exception e) &#123;
            e.printStackTrace();

        &#125;
    &#125;

    public static void main(String[] args) &#123;
        &#x2F;&#x2F;System.out.println(&quot;RabbitMQUtils.getConnection() &#x3D; &quot; + RabbitMQUtils.getConnection());
    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35
*   36
*   37
*   38
*   39
*   40
*   41
*   42
*   43
*   44
*   45
*   46
*   47
*   48
*   49
*   50

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="45-第二种模型work-quene"><a class="markdownIt-Anchor" href="#45-第二种模型work-quene">#</a> 4.5 第二种模型 (work quene)</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Work queues，也被称为（Task queues），任务模型。
当消息处理比较耗时的时候，可能生产消息的速度会
远远大于消息的消费速度。长此以往，消息就会堆积
越来越多，无法及时处理。此时就可以使用work 模型：
让多个消费者绑定到一个队列，共同消费队列中的消息。
队列中的消息一旦消费，就会消失，因此任务是不会被重复执行的。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030180428828.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">角色：

P：生产者：任务的发布者
C1：消费者-1，领取任务并且完成任务，假设完成速度较慢
C2：消费者-2：领取任务并完成任务，假设完成速度快
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="451-开发生产者"><a class="markdownIt-Anchor" href="#451-开发生产者">#</a> 4.5.1 开发生产者</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">"====>:我是消息"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="452-开发消费者-1"><a class="markdownIt-Anchor" href="#452-开发消费者-1">#</a> 4.5.2 开发消费者 - 1</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者1: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="453-开发消费者-2"><a class="markdownIt-Anchor" href="#453-开发消费者-2">#</a> 4.5.3 开发消费者 - 2</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">DefaultConsumer</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleDelivery</span><span class="token punctuation">(</span><span class="token class-name">String</span> consumerTag<span class="token punctuation">,</span> <span class="token class-name">Envelope</span> envelope<span class="token punctuation">,</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//处理消息比较慢 一秒处理一个消息</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"消费者2: "</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="454-测试结果"><a class="markdownIt-Anchor" href="#454-测试结果">#</a> 4.5.4 测试结果</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030180452976.png#pic_center" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030180521397.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">总结:默认情况下，RabbitMQ将按顺序将每个消息发送给
下一个使用者。平均而言，每个消费者都会收到相同数量
的消息。这种分发消息的方式称为循环。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="455-消息自动确认机制"><a class="markdownIt-Anchor" href="#455-消息自动确认机制">#</a> 4.5.5 消息自动确认机制</h4>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Doing a task can take a few seconds. You may
wonder what happens if one of the consumers 
starts a long task and dies with it only partly 
done.With our current code,once RabbitMQ 
delivers a message to the consumer it immediately
marks it for deletion. In this case, if you kill a 
worker we will lose the message it was just
processing. We'llalso lose all the messages that  
were dispatched to this particular worker but 
were not yet handled.

But we don't want to lose any tasks. If a worker 
dies,we'd like the task to be delivered to 
another worker.

完成一项任务可能需要几秒钟。您可能想知道，如果其中一个消费者
开始了一项长期任务，但只完成了一部分就死了，会发生什么情况。
在我们当前的代码中，一旦RabbitMQ将消息传递给使用者，
它就会立即将其标记为删除。在这种情况下，
如果您杀死一个worker，我们将丢失它刚刚处理的消息。
我们还将丢失发送给该特定工作进程但尚未处理的所有消息。

但我们不想失去任何任务。如果一个worker死了，我们希望把
任务交给另一个工人。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4551-开发生产者"><a class="markdownIt-Anchor" href="#4551-开发生产者">#</a> 4.5.5.1 开发生产者</h5>
<pre class="line-numbers language-none"><code class="language-none">&#96;package workquene;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Provider &#123;
    public static void main(String[] args) throws IOException &#123;
        &#x2F;&#x2F;获取连接对象
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        &#x2F;&#x2F;获取通道对象
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;通过通道声明队列
        channel.queueDeclare(&quot;work&quot;, true, false, false, null);

        for (int i &#x3D; 1; i &lt;&#x3D;20; i++) &#123;
            &#x2F;&#x2F;生产消息
            channel.basicPublish(&quot;&quot;, &quot;work&quot;, null, (i + &quot;hello work quene&quot;).getBytes());
        &#125;

        &#x2F;&#x2F;关闭资源
        RabbitMQUtils.closeConnectionAndChanel(channel, connection);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4552-开发消费者-1"><a class="markdownIt-Anchor" href="#4552-开发消费者-1">#</a> 4.5.5.2 开发消费者 - 1</h5>
<pre class="line-numbers language-none"><code class="language-none">&#96;消费之1
package workquene;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer1 &#123;
    public static void main(String[] args) throws IOException &#123;

        &#x2F;&#x2F;获取连接
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        final Channel channel &#x3D; connection.createChannel();
        channel.basicQos(1);&#x2F;&#x2F;每一次只能消费一个消息
        channel.queueDeclare(&quot;work&quot;,true,false,false,null);
        &#x2F;&#x2F;参数1:队列名称  参数2:消息自动确认 true  消费者自动向rabbitmq确认消息消费  false 不会自动确认消息
        channel.basicConsume(&quot;work&quot;,false,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                try&#123;
                    Thread.sleep(2000);
                &#125;catch (Exception e)&#123;
                    e.printStackTrace();
                &#125;
                System.out.println(&quot;消费者-1: &quot;+new String(body));
                &#x2F;&#x2F; 参数1:确认队列中那个具体消息 参数2:是否开启多个消息同时确实
                channel.basicAck(envelope.getDeliveryTag(),false);
            &#125;
        &#125;);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4553-开发消费者-2"><a class="markdownIt-Anchor" href="#4553-开发消费者-2">#</a> 4.5.5.3 开发消费者 - 2</h5>
<pre class="line-numbers language-none"><code class="language-none">&#96;package workquene;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer2 &#123;
    public static void main(String[] args) throws IOException &#123;

        &#x2F;&#x2F;获取连接
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        final Channel channel &#x3D; connection.createChannel();

        channel.basicQos(1);
        channel.queueDeclare(&quot;work&quot;,true,false,false,null);

        channel.basicConsume(&quot;work&quot;,false,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者-2: &quot;+new String(body));
                &#x2F;&#x2F;手动确认  参数1:手动确认消息标识  参数2:false 每次确认一个
                channel.basicAck(envelope.getDeliveryTag(), false);
            &#125;
        &#125;);

        

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">设置通道一次只能消费一个消息
关闭消息的自动确认,开启手动确认消息
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210705234645168.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210705234709121.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt=""></p>
<h3 id="45-第三种模型fanout"><a class="markdownIt-Anchor" href="#45-第三种模型fanout">#</a> 4.5 第三种模型 (fanout)</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">fanout 扇出 也称为广播
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030183457220.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">在广播模式下，消息发送流程是这样的：

可以有多个消费者
每个消费者有自己的queue（队列）
每个队列都要绑定到Exchange（交换机）
生产者发送的消息，只能发送到交换机，
交换机来决定要发给哪个队列，生产者无法决定。
交换机把消息发送给绑定过的所有队列
队列的消费者都能拿到消息。实现一条消息被多个消费者消费
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="451-开发生产者-2"><a class="markdownIt-Anchor" href="#451-开发生产者-2">#</a> 4.5.1 开发生产者</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">fanout</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">utils<span class="token punctuation">.</span></span><span class="token class-name">RabbitMQUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Provider</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//获取连接对象</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">RabbitMQUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//将通道声明指定交换机   //参数1: 交换机名称    参数2: 交换机类型  fanout 广播类型</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">"fanout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//发送消息</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"fanout type message"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//释放资源</span>
        <span class="token class-name">RabbitMQUtils</span><span class="token punctuation">.</span><span class="token function">closeConnectionAndChanel</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="452-开发消费者-1-2"><a class="markdownIt-Anchor" href="#452-开发消费者-1-2">#</a> 4.5.2 开发消费者 - 1</h4>
<pre class="line-numbers language-none"><code class="language-none">&#96;package fanout;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer1 &#123;
    public static void main(String[] args) throws IOException &#123;
        &#x2F;&#x2F;获取连接对象
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;通道绑定交换机
        channel.exchangeDeclare(&quot;logs&quot;,&quot;fanout&quot;);

        &#x2F;&#x2F;临时队列
        String queueName &#x3D; channel.queueDeclare().getQueue();

        &#x2F;&#x2F;绑定交换机和队列
        channel.queueBind(queueName,&quot;logs&quot;,&quot;&quot;);

        &#x2F;&#x2F;消费消息
        channel.basicConsume(queueName,true,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者1: &quot;+new String(body));
            &#125;
        &#125;);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="453-开发消费者-2-2"><a class="markdownIt-Anchor" href="#453-开发消费者-2-2">#</a> 4.5.3 开发消费者 - 2</h4>
<pre class="line-numbers language-none"><code class="language-none">&#96;package fanout;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer2 &#123;
    public static void main(String[] args) throws IOException &#123;
        &#x2F;&#x2F;获取连接对象
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;通道绑定交换机
        channel.exchangeDeclare(&quot;logs&quot;,&quot;fanout&quot;);

        &#x2F;&#x2F;临时队列
        String queueName &#x3D; channel.queueDeclare().getQueue();

        &#x2F;&#x2F;绑定交换机和队列
        channel.queueBind(queueName,&quot;logs&quot;,&quot;&quot;);

        &#x2F;&#x2F;消费消息
        channel.basicConsume(queueName,true,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者2: &quot;+new String(body));
            &#125;
        &#125;);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="454-开发消费者-3"><a class="markdownIt-Anchor" href="#454-开发消费者-3">#</a> 4.5.4 开发消费者 - 3</h4>
<pre class="line-numbers language-none"><code class="language-none">&#96;package fanout;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer3 &#123;
    public static void main(String[] args) throws IOException &#123;
        &#x2F;&#x2F;获取连接对象
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;通道绑定交换机
        channel.exchangeDeclare(&quot;logs&quot;,&quot;fanout&quot;);

        &#x2F;&#x2F;临时队列
        String queueName &#x3D; channel.queueDeclare().getQueue();

        &#x2F;&#x2F;绑定交换机和队列
        channel.queueBind(queueName,&quot;logs&quot;,&quot;&quot;);

        &#x2F;&#x2F;消费消息
        channel.basicConsume(queueName,true,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者3: &quot;+new String(body));
            &#125;
        &#125;);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="455-测试结果"><a class="markdownIt-Anchor" href="#455-测试结果">#</a> 4.5.5 测试结果</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706003342953.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706003354516.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706003407181.png" alt=""></p>
<h3 id="46-第四种模型routing"><a class="markdownIt-Anchor" href="#46-第四种模型routing">#</a> 4.6 第四种模型 (Routing)</h3>
<h4 id="461-routing-之订阅模型-direct直连"><a class="markdownIt-Anchor" href="#461-routing-之订阅模型-direct直连">#</a> 4.6.1 Routing 之订阅模型 - Direct (直连)</h4>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">在Fanout模式中，一条消息，会被所有订阅的队列都消费。
但是，在某些场景下，我们希望不同的消息被不同的队列消费。
这时就要用到Direct类型的Exchange。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">在Direct模型下：队列与交换机的绑定，不能是任意绑定了，
而是要指定一个RoutingKey（路由key）
消息的发送方在 向 Exchange发送消息时，
也必须指定消息的 RoutingKey。

Exchange不再把消息交给每一个绑定的队列，
而是根据消息的Routing Key进行判断，
只有队列的Routingkey与消息的 Routing key完全一致，
才会接收到消息
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030234745232.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">P：生产者，向Exchange发送消息，发送消息时，
会指定一个routing key。
X：Exchange（交换机），接收生产者的消息，
然后把消息递交给 与routing key完全匹配的队列
C1：消费者，其所在队列指定了需要routing key 为 error 的消息
C2：消费者，其所在队列指定了需要routing key 为 info、
error、warning 的消息
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4611-开发生产者"><a class="markdownIt-Anchor" href="#4611-开发生产者">#</a> 4.6.1.1 开发生产者</h5>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">direct</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">utils<span class="token punctuation">.</span></span><span class="token class-name">RabbitMQUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Provider</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//获取连接对象</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">RabbitMQUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取连接通道对象</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token string">"logs_direct"</span><span class="token punctuation">;</span>
        <span class="token comment">//通过通道声明交换机  参数1:交换机名称  参数2:direct  路由模式</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span><span class="token string">"direct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//发送消息</span>
        <span class="token class-name">String</span> routingkey <span class="token operator">=</span> <span class="token string">"info"</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>exchangeName<span class="token punctuation">,</span>routingkey<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"这是direct模型发布的基于route key: ["</span><span class="token operator">+</span>routingkey<span class="token operator">+</span><span class="token string">"] 发送的消息"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭资源</span>
        <span class="token class-name">RabbitMQUtils</span><span class="token punctuation">.</span><span class="token function">closeConnectionAndChanel</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4612-开发消费者-1"><a class="markdownIt-Anchor" href="#4612-开发消费者-1">#</a> 4.6.1.2 开发消费者 - 1</h5>
<pre class="line-numbers language-none"><code class="language-none">&#96;package direct;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer1 &#123;
    public static void main(String[] args) throws IOException &#123;
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        Channel channel &#x3D; connection.createChannel();

        String exchangeName &#x3D; &quot;logs_direct&quot;;

        &#x2F;&#x2F;通道声明交换机以及交换的类型
        channel.exchangeDeclare(exchangeName,&quot;direct&quot;);

        &#x2F;&#x2F;创建一个临时队列
        String queue &#x3D; channel.queueDeclare().getQueue();

        &#x2F;&#x2F;基于route key绑定队列和交换机
        channel.queueBind(queue,exchangeName,&quot;error&quot;);

        &#x2F;&#x2F;获取消费的消息
        channel.basicConsume(queue,true,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者1: &quot;+ new String(body));
            &#125;
        &#125;);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4613-开发消费者-2"><a class="markdownIt-Anchor" href="#4613-开发消费者-2">#</a> 4.6.1.3 开发消费者 - 2</h5>
<pre class="line-numbers language-none"><code class="language-none">&#96;package direct;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer2 &#123;
    public static void main(String[] args) throws IOException &#123;
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        Channel channel &#x3D; connection.createChannel();

        String exchangeName &#x3D; &quot;logs_direct&quot;;

        &#x2F;&#x2F;声明交换机 以及交换机类型 direct
        channel.exchangeDeclare(exchangeName,&quot;direct&quot;);

        &#x2F;&#x2F;创建一个临时队列
        String queue &#x3D; channel.queueDeclare().getQueue();

        &#x2F;&#x2F;临时队列和交换机绑定
        channel.queueBind(queue,exchangeName,&quot;info&quot;);
        channel.queueBind(queue,exchangeName,&quot;error&quot;);
        channel.queueBind(queue,exchangeName,&quot;warning&quot;);

        &#x2F;&#x2F;消费消息
        channel.basicConsume(queue,true,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者2: &quot;+new String(body));
            &#125;
        &#125;);

    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33
*   34
*   35
*   36
*   37

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4614-测试生产者发送route-key为error的消息时"><a class="markdownIt-Anchor" href="#4614-测试生产者发送route-key为error的消息时">#</a> 4.6.1.4 测试生产者发送 Route key 为 error 的消息时</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210706085347295.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210706085405375.png" alt=""></p>
<h5 id="4615-测试生产者发送route-key为info的消息时"><a class="markdownIt-Anchor" href="#4615-测试生产者发送route-key为info的消息时">#</a> 4.6.1.5 测试生产者发送 Route key 为 info 的消息时</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706085227831.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706085253271.png" alt=""></p>
<h4 id="462-routing-之订阅模型-topic"><a class="markdownIt-Anchor" href="#462-routing-之订阅模型-topic">#</a> 4.6.2 Routing 之订阅模型 - Topic</h4>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Topic类型的Exchange与Direct相比，都是可以根据RoutingKey
把消息路由到不同的队列。只不过Topic类型Exchange可以让
队列在绑定Routing key的时候使用通配符！这种模型Routingkey 
一般都是由一个或多个单词组成，多个单词之间以”.”分割，
例如： item.insert
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030234821717.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 统配符</span>
		<span class="token list punctuation">*</span> (star) can substitute for exactly one word.    匹配不多不少恰好1个词
		<span class="token title important"><span class="token punctuation">#</span> (hash) can substitute for zero or more words.  匹配零个、一个或多个词</span>
<span class="token title important"><span class="token punctuation">#</span> 如:</span>
		audit.#    匹配audit、audit.irs 、或者audit.irs.corporate等
    audit.*   只能匹配 audit.irs
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4621-开发生产者"><a class="markdownIt-Anchor" href="#4621-开发生产者">#</a> 4.6.2.1 开发生产者</h5>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">topic</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Channel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">Connection</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">utils<span class="token punctuation">.</span></span><span class="token class-name">RabbitMQUtils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Provider</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//获取连接对象</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token class-name">RabbitMQUtils</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//声明交换机以及交换机类型 topic</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"topic"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//发布消息</span>
        <span class="token class-name">String</span> routekey <span class="token operator">=</span> <span class="token string">"save.user.delete"</span><span class="token punctuation">;</span>

        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span>routekey<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">"这里是topic动态路由模型,routekey: ["</span><span class="token operator">+</span>routekey<span class="token operator">+</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭资源</span>
        <span class="token class-name">RabbitMQUtils</span><span class="token punctuation">.</span><span class="token function">closeConnectionAndChanel</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span>connection<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4622-开发消费者-1"><a class="markdownIt-Anchor" href="#4622-开发消费者-1">#</a> 4.6.2.2 开发消费者 - 1</h5>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Routing Key中使用*通配符方式
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&#96;package topic;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer1 &#123;
    public static void main(String[] args) throws IOException &#123;

        &#x2F;&#x2F;获取连接
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;声明交换机以及交换机类型
        channel.exchangeDeclare(&quot;topics&quot;,&quot;topic&quot;);
        &#x2F;&#x2F;创建一个临时队列
        String queue &#x3D; channel.queueDeclare().getQueue();
        &#x2F;&#x2F;绑定队列和交换机  动态统配符形式route key
        channel.queueBind(queue,&quot;topics&quot;,&quot;*.user.*&quot;);

        &#x2F;&#x2F;消费消息
        channel.basicConsume(queue,true,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者1: &quot;+ new String(body));
            &#125;
        &#125;);
    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4623-开发消费者-2"><a class="markdownIt-Anchor" href="#4623-开发消费者-2">#</a> 4.6.2.3 开发消费者 - 2</h5>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">Routing Key中使用#通配符方式
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&#96;package topic;

import com.rabbitmq.client.*;
import utils.RabbitMQUtils;

import java.io.IOException;

public class Customer2 &#123;
    public static void main(String[] args) throws IOException &#123;

        &#x2F;&#x2F;获取连接
        Connection connection &#x3D; RabbitMQUtils.getConnection();
        Channel channel &#x3D; connection.createChannel();

        &#x2F;&#x2F;声明交换机以及交换机类型
        channel.exchangeDeclare(&quot;topics&quot;,&quot;topic&quot;);
        &#x2F;&#x2F;创建一个临时队列
        String queue &#x3D; channel.queueDeclare().getQueue();
        &#x2F;&#x2F;绑定队列和交换机  动态统配符形式route key
        channel.queueBind(queue,&quot;topics&quot;,&quot;*.user.#&quot;);

        &#x2F;&#x2F;消费消息
        channel.basicConsume(queue,true,new DefaultConsumer(channel)&#123;
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException &#123;
                System.out.println(&quot;消费者2: &quot;+ new String(body));
            &#125;
        &#125;);
    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="4624-测试结果"><a class="markdownIt-Anchor" href="#4624-测试结果">#</a> 4.6.2.4 测试结果</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706091718910.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706091736341.png" alt=""></p>
<h2 id="5-springboot中使用rabbitmq"><a class="markdownIt-Anchor" href="#5-springboot中使用rabbitmq">#</a> 5 SpringBoot 中使用 RabbitMQ</h2>
<h3 id="51-搭建初始环境"><a class="markdownIt-Anchor" href="#51-搭建初始环境">#</a> 5.1 搭建初始环境</h3>
<h4 id="511-引入依赖"><a class="markdownIt-Anchor" href="#511-引入依赖">#</a> 5.1.1 引入依赖</h4>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="512-配置配置文件"><a class="markdownIt-Anchor" href="#512-配置配置文件">#</a> 5.1.2 配置配置文件</h4>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> springboot_rabbitmq
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 10.15.0.9
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> ems
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">virtual-host</span><span class="token punctuation">:</span> /ems
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">RabbitTemplate用来简化操作    使用时候直接在项目中注入即可使用
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="52-第一种hello-world模型使用"><a class="markdownIt-Anchor" href="#52-第一种hello-world模型使用">#</a> 5.2 第一种 hello world 模型使用</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发生产者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">DemoApplicationTests</span> <span class="token punctuation">&#123;</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// 生产端没有指定交换机只有routingKey和Object。</span>
<span class="token comment">//消费方产生hello队列，放在默认的交换机(AMQP default)上。</span>
<span class="token comment">//而默认的交换机有一个特点，只要你的routerKey的名字与这个</span>
<span class="token comment">//交换机的队列有相同的名字，他就会自动路由上。 </span>
<span class="token comment">//生产端routingKey 叫hello ，消费端生产hello队列。</span>
<span class="token comment">//他们就路由上了</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发消费者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Queue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token comment">// 生产端没有指定交换机只有routingKey和Object。</span>
<span class="token comment">//消费方产生hello队列，放在默认的交换机(AMQP default)上。</span>
<span class="token comment">//而默认的交换机有一个特点，只要你的routerKey的名字与这个</span>
<span class="token comment">//交换机的队列有相同的名字，他就会自动路由上。 </span>
<span class="token comment">//生产端routingKey 叫hello ，消费端生产hello队列。</span>
<span class="token comment">//他们就路由上了</span>
<span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloCustomer</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@RabbitHandler</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2021070610294993.png" alt=""></p>
<h3 id="53-第二种work模型使用"><a class="markdownIt-Anchor" href="#53-第二种work模型使用">#</a> 5.3 第二种 work 模型使用</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发生产者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">DemoApplicationTests</span> <span class="token punctuation">&#123;</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"work"</span><span class="token punctuation">,</span><span class="token string">"hello work!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
			<span class="token comment">// 生产端没有指定交换机只有routingKey和Object。</span>
			<span class="token comment">//消费方产生work队列，放在默认的交换机(AMQP default)上。</span>
			<span class="token comment">//而默认的交换机有一个特点，只要你的routerKey的名字与这个</span>
			<span class="token comment">//交换机的队列有相同的名字，他就会自动路由上。 </span>
			<span class="token comment">//生产端routingKey 叫work ，消费端生产work队列。</span>
			<span class="token comment">//他们就路由上了	             </span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发消费者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Queue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WorkCustomer</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// 生产端没有指定交换机只有routingKey和Object。</span>
	<span class="token comment">//消费方产生work队列，放在默认的交换机(AMQP default)上。</span>
	<span class="token comment">//而默认的交换机有一个特点，只要你的routerKey的名字与这个</span>
	<span class="token comment">//交换机的队列有相同的名字，他就会自动路由上。 </span>
	<span class="token comment">//生产端routingKey 叫work ，消费端生产work队列。</span>
	<span class="token comment">//他们就路由上了	             </span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">"work"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"work message1 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queuesToDeclare <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">(</span><span class="token string">"work"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"work message2 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706103510129.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">说明:默认在Spring AMQP实现中Work这种方式就是公平调度,如果需要实现能者多劳需要外配置
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="54-fanout-广播模型"><a class="markdownIt-Anchor" href="#54-fanout-广播模型">#</a> 5.4 Fanout 广播模型</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发生产者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">DemoApplicationTests</span> <span class="token punctuation">&#123;</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"logs"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"这是日志广播"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 参数1为交换机，参数2为路由key，“”表示为任意路由，参数3为消息内容</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发消费者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Exchange</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Queue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">QueueBinding</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RabbitListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WorkCustomer</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span> <span class="token comment">// 创建临时队列</span>
            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"logs"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"fanout"</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message1 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>bindings <span class="token operator">=</span> <span class="token annotation punctuation">@QueueBinding</span><span class="token punctuation">(</span>
            value <span class="token operator">=</span> <span class="token annotation punctuation">@Queue</span><span class="token punctuation">,</span> <span class="token comment">//创建临时队列</span>
            exchange <span class="token operator">=</span> <span class="token annotation punctuation">@Exchange</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"logs"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token string">"fanout"</span><span class="token punctuation">)</span>  <span class="token comment">//绑定交换机类型</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive2</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"message2 = "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210706104830274.png" alt=""></p>
<h3 id="55-route-路由模型"><a class="markdownIt-Anchor" href="#55-route-路由模型">#</a> 5.5 Route 路由模型</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发生产者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">DemoApplicationTests</span> <span class="token punctuation">&#123;</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"directs"</span><span class="token punctuation">,</span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="token string">"error 的日志信息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发消费者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&#96;package com.example;

import org.springframework.amqp.rabbit.annotation.Exchange;
import org.springframework.amqp.rabbit.annotation.Queue;
import org.springframework.amqp.rabbit.annotation.QueueBinding;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.stereotype.Component;

@Component
public class WorkCustomer &#123;
    @RabbitListener(bindings &#x3D; &#123;
            @QueueBinding(
                    value &#x3D; @Queue, &#x2F;&#x2F; 创建临时队列
                    key &#x3D; &#123;&quot;info&quot;, &quot;error&quot;&#125;, &#x2F;&#x2F; 路由key
                    exchange &#x3D; @Exchange(type &#x3D; &quot;direct&quot;, name &#x3D; &quot;directs&quot;)
            )&#125;)
    public void receive1(String message) &#123;
        System.out.println(&quot;message1 &#x3D; &quot; + message);
    &#125;

    @RabbitListener(bindings &#x3D; &#123;
            @QueueBinding(
                    value &#x3D; @Queue,
                    key &#x3D; &#123;&quot;error&quot;&#125;,
                    exchange &#x3D; @Exchange(type &#x3D; &quot;direct&quot;, name &#x3D; &quot;directs&quot;)
            )&#125;)
    public void receive2(String message) &#123;
        System.out.println(&quot;message2 &#x3D; &quot; + message);
    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210706105459598.png" alt=""></p>
<h3 id="56-topic-订阅模型动态路由模型"><a class="markdownIt-Anchor" href="#56-topic-订阅模型动态路由模型">#</a> 5.6 Topic 订阅模型 (动态路由模型)</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发生产者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">DemoApplicationTests</span> <span class="token punctuation">&#123;</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">"topics"</span><span class="token punctuation">,</span><span class="token string">"user.save.findAll"</span><span class="token punctuation">,</span><span class="token string">"user.save.findAll 的消息"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


<span class="token punctuation">&#125;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">开发消费者
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&#96;package com.example;

import org.springframework.amqp.rabbit.annotation.Exchange;
import org.springframework.amqp.rabbit.annotation.Queue;
import org.springframework.amqp.rabbit.annotation.QueueBinding;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.stereotype.Component;

@Component
public class WorkCustomer &#123;
    @RabbitListener(bindings &#x3D; &#123;
            @QueueBinding(
                    value &#x3D; @Queue,
                    key &#x3D; &#123;&quot;user.*&quot;&#125;,
                    exchange &#x3D; @Exchange(type &#x3D; &quot;topic&quot;,name &#x3D; &quot;topics&quot;)
            )
    &#125;)
    public void receive1(String message)&#123;
        System.out.println(&quot;message1 &#x3D; &quot; + message);
    &#125;

    @RabbitListener(bindings &#x3D; &#123;
            @QueueBinding(
                    value &#x3D; @Queue,
                    key &#x3D; &#123;&quot;user.#&quot;&#125;,
                    exchange &#x3D; @Exchange(type &#x3D; &quot;topic&quot;,name &#x3D; &quot;topics&quot;)
            )
    &#125;)
    public void receive2(String message)&#123;
        System.out.println(&quot;message2 &#x3D; &quot; + message);
    &#125;
&#125;&#96; 

![](https:&#x2F;&#x2F;csdnimg.cn&#x2F;release&#x2F;blogv2&#x2F;dist&#x2F;pc&#x2F;img&#x2F;newCodeMoreWhite.png)

*   1
*   2
*   3
*   4
*   5
*   6
*   7
*   8
*   9
*   10
*   11
*   12
*   13
*   14
*   15
*   16
*   17
*   18
*   19
*   20
*   21
*   22
*   23
*   24
*   25
*   26
*   27
*   28
*   29
*   30
*   31
*   32
*   33

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706110027465.png" alt=""></p>
<h2 id="6-mq的应用场景"><a class="markdownIt-Anchor" href="#6-mq的应用场景">#</a> 6 MQ 的应用场景</h2>
<h3 id="61-异步处理"><a class="markdownIt-Anchor" href="#61-异步处理">#</a> 6.1 异步处理</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">场景说明：用户注册后，需要发注册邮件和注册短信,传统的做法有两种 
1.串行的方式 2.并行的方式
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">串行方式: 将注册信息写入数据库后,发送注册邮件,再发送注册短信,
以上三个任务全部完成后才返回给客户端。 这有一个问题是,邮件,
短信并不是必须的,它只是一个通知,而这种做法让客户端等待没有
必要等待的东西. 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030225628901.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">并行方式: 将注册信息写入数据库后,发送邮件的同时,发送短信,
以上三个任务完成后,返回给客户端,并行的方式能提高处理的时间。 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030225657273.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">消息队列:假设三个业务节点分别使用50ms,串行方式使用时间150ms,
并行使用时间100ms。虽然并行已经提高的处理时间,但是,前面说过,
邮件和短信对我正常的使用网站没有任何影响，客户端没有必要等
着其发送完成才显示注册成功,应该是写入数据库后就返回. 消息队
列: 引入消息队列后，把发送邮件,短信不是必须的业务逻辑异步处理 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030225723665.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">由此可以看出,引入消息队列后，用户的响应时间就等于写入数据库的
时间+写入消息队列的时间(可以忽略不计),引入消息队列后处理后,响
应时间是串行的3倍,是并行的2倍。
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="62-应用解耦"><a class="markdownIt-Anchor" href="#62-应用解耦">#</a> 6.2 应用解耦</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">场景：双11是购物狂节,用户下单后,订单系统需要通知库存系统,传统
的做法就是订单系统调用库存系统的接口. 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030225742845.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">这种做法有一个缺点:
当库存系统出现故障时,订单就会失败。 订单系统和库存系统高耦合.  引入消息队列 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030225800254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">订单系统:用户下单后,订单系统完成持久化处理,将消息写入消息队列,
返回用户订单下单成功。

库存系统:订阅下单的消息,获取下单消息,进行库操作。
就算库存系统出现故障,消息队列也能保证消息的可靠投递,
不会导致消息丢失.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="63-流量削峰"><a class="markdownIt-Anchor" href="#63-流量削峰">#</a> 6.3 流量削峰</h3>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">场景: 秒杀活动，一般会因为流量过大，导致应用挂掉,为了解决这个
问题，一般在应用前端加入消息队列。  
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">作用:

1.可以控制活动人数，超过此一定阀值的订单直接丢弃(我为什么
秒杀一次都没有成功过呢^^) 

2.可以缓解短时间的高流量压垮应用(应用程序按自己的最大处理能力
获取订单) 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030225837502.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">1.用户的请求,服务器收到之后,首先写入消息队列,加入消息队列长度
超过最大值,则直接抛弃用户请求或跳转到错误页面.  

2.秒杀业务根据消息队列中的请求信息，再做后续处理.
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="7-rabbitmq的集群"><a class="markdownIt-Anchor" href="#7-rabbitmq的集群">#</a> 7 RabbitMQ 的集群</h2>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">最新版的3.8版本的可以看我这篇文章
https://blog.csdn.net/unique_perfect/article/details/108643804
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="71-集群架构"><a class="markdownIt-Anchor" href="#71-集群架构">#</a> 7.1 集群架构</h3>
<h4 id="711-普通集群副本集群"><a class="markdownIt-Anchor" href="#711-普通集群副本集群">#</a> 7.1.1 普通集群 (副本集群)</h4>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">All data/state required for the operation of a 
RabbitMQ broker is replicated across all nodes. 
An exception to this are message queues, which
by default reside on one node, though they are 
visible and reachable from all nodes. To 
replicate queues across nodes in a cluster   
--摘自官网
默认情况下:RabbitMQ代理操作所需的所有数据/状态都将跨
所有节点复制。这方面的一个例外是消息队列，默认情况下，
消息队列位于一个节点上，尽管它们可以从所有节点看到和访问
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">架构图
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706112155571.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">核心解决问题:  当集群中某一时刻master节点宕机,
可以对Quene中信息,进行备份
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">集群搭建
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">&#96;# 0.集群规划
	node1: 10.15.0.3  mq1  master 主节点
	node2: 10.15.0.4  mq2  repl1  副本节点
	node3: 10.15.0.5  mq3  repl2  副本节点

# 1.克隆三台机器主机名和ip映射
	vim &#x2F;etc&#x2F;hosts加入:
		 10.15.0.3 mq1
    	10.15.0.4 mq2
    	10.15.0.5 mq3
	node1: vim &#x2F;etc&#x2F;hostname 加入:  mq1
	node2: vim &#x2F;etc&#x2F;hostname 加入:  mq2
	node3: vim &#x2F;etc&#x2F;hostname 加入:  mq3

# 2.三个机器安装rabbitmq,并同步cookie文件,在node1上执行:
	scp &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie root@mq2:&#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;
	scp &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie root@mq3:&#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;

# 3.查看cookie是否一致:
	node1: cat &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie 
	node2: cat &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie 
	node3: cat &#x2F;var&#x2F;lib&#x2F;rabbitmq&#x2F;.erlang.cookie 

# 4.后台启动rabbitmq所有节点执行如下命令,启动成功访问管理界面:
	rabbitmq-server -detached 

# 5.在node2和node3执行加入集群命令:
	1.关闭       rabbitmqctl stop_app
	2.加入集群    rabbitmqctl join_cluster rabbit@mq1
	3.启动服务    rabbitmqctl start_app

# 6.查看集群状态,任意节点执行:
	rabbitmqctl cluster_status

# 7.如果出现如下显示,集群搭建成功:
	Cluster status of node rabbit@mq3 ...
	[&#123;nodes,[&#123;disc,[rabbit@mq1,rabbit@mq2,rabbit@mq3]&#125;]&#125;,
	&#123;running_nodes,[rabbit@mq1,rabbit@mq2,rabbit@mq3]&#125;,
	&#123;cluster_name,&lt;&lt;&quot;rabbit@mq1&quot;&gt;&gt;&#125;,
	&#123;partitions,[]&#125;,
	&#123;alarms,[&#123;rabbit@mq1,[]&#125;,&#123;rabbit@mq2,[]&#125;,&#123;rabbit@mq3,[]&#125;]&#125;]

# 8.登录管理界面,展示如下状态:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20201030225920927.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70#pic_center" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 9.测试集群在node1上,创建队列</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706172934162.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 10.查看node2和node3节点:</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/202107061730445.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706173130281.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 11.关闭node1节点,执行如下命令,查看node2和node3:</span>
rabbitmqctl stop_app
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706180109199.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210706180146791.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt=""></p>
<h4 id="712-镜像集群"><a class="markdownIt-Anchor" href="#712-镜像集群">#</a> 7.1.2 镜像集群</h4>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">This guide covers mirroring (queue contents replication) 
of classic queues  --摘自官网

By default, contents of a queue within a RabbitMQ 
cluster are located on a single node (the node on 
which the queue was declared). This is in contrast 
to exchanges and bindings, which can always be
considered to be on all nodes. Queues can 
optionally be made <span class="token italic"><span class="token punctuation">*</span><span class="token content">mirrored</span><span class="token punctuation">*</span></span> across multiple nodes. 
--摘自官网
镜像队列机制就是将队列在三个节点之间设置主从关系，
消息会在三个节点之间进行自动同步，且如果其中一个
节点不可用，并不会导致消息丢失或服务不可用的情况，
提升MQ集群的整体高可用性。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">集群架构图<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201030230122209.png" alt=""></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">配置集群架构
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 0.策略说明</span>
rabbitmqctl set_policy <span class="token url">[<span class="token content">-p &lt;vhost></span>] [<span class="token variable">--priority &lt;priority></span>]</span> [--apply-to <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>apply-to</span><span class="token punctuation">></span></span>] <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>definition</span><span class="token punctuation">></span></span>
-p Vhost： 可选参数，针对指定vhost下的queue进行设置
Name:     policy的名称
Pattern: queue的匹配模式(正则表达式)
Definition：镜像定义，包括三个部分ha-mode, ha-params, ha-sync-mode
ha-mode:指明镜像队列的模式，有效值为 all/exactly/nodes
all：表示在集群中所有的节点上进行镜像
exactly：表示在指定个数的节点上进行镜像，节点的个数由ha-params指定
nodes：表示在指定的节点上进行镜像，节点名称通过ha-params指定
ha-params：ha-mode模式需要用到的参数
ha-sync-mode：进行队列中消息的同步方式，有效值为automatic和manual
              priority：可选参数，policy的优先级
              
<span class="token code keyword">               </span>
<span class="token title important"><span class="token punctuation">#</span> 1.查看当前策略</span>
rabbitmqctl list_policies

<span class="token title important"><span class="token punctuation">#</span> 2.添加策略</span>
rabbitmqctl set_policy ha-all '^hello' '&#123;"ha-mode":"all","ha-sync-mode":"automatic"&#125;' 
说明:策略正则表达式为 “^” 表示所有匹配所有队列名称  ^hello:匹配hello开头队列

<span class="token title important"><span class="token punctuation">#</span> 3.删除策略</span>
rabbitmqctl clear_policy ha-all

<span class="token title important"><span class="token punctuation">#</span> 4.测试集群</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706194543248.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/20210706194552481.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3VuaXF1ZV9wZXJmZWN0,size_16,color_FFFFFF,t_70" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210706194602674.png" alt=""></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Harry Qu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://harryqu1229.github.io/2022/03/20/rabbitmq%E7%AC%94%E8%AE%B0/">https://harryqu1229.github.io/2022/03/20/rabbitmq%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/backend/">backend</a><a class="post-meta__tags" href="/tags/summary/">summary</a><a class="post-meta__tags" href="/tags/message-queue/">message queue</a></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-621848f44e1c3724" async="async"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/19/rabbitmq/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/forest.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">My Rabbitmq notes</div></div></a></div><div class="next-post pull-right"><a href="/2022/03/20/Redis%E7%AC%94%E8%AE%B0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/statue.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Redis CS Notes</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/03/19/rabbitmq/" title="My Rabbitmq notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/forest.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-19</div><div class="title">My Rabbitmq notes</div></div></a></div><div><a href="/2022/01/01/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" title="Message Queue"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/cat.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-01</div><div class="title">Message Queue</div></div></a></div><div><a href="/2022/02/13/Redis/" title="Redis Notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/town.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-13</div><div class="title">Redis Notes</div></div></a></div><div><a href="/2022/03/20/Redis%E7%AC%94%E8%AE%B0/" title="Redis CS Notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/statue.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-20</div><div class="title">Redis CS Notes</div></div></a></div><div><a href="/2022/03/22/Socket/" title="Socket Notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/sun.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-22</div><div class="title">Socket Notes</div></div></a></div><div><a href="/2022/02/26/SSM%E6%A1%86%E6%9E%B6%E7%9A%84%E6%95%B4%E5%90%88%E9%A1%B9%E7%9B%AE/" title="SSM combine"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/house.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-26</div><div class="title">SSM combine</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Disqus</span><span class="switch-btn"></span><span class="second-comment">Gitalk</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Harry Qu</div><div class="author-info__description">Software Engineering Student</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">158</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">57</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/HarryQu1229"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://www.linkedin.com/in/harry-qu-a0a38220a" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a><a class="social-icon" href="https://github.com/HarryQu1229" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:Harryqu666@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="weixin://dl/chat?harry666ya" target="_blank" title="Wechat"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">be healthy, stay safe</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#rabbitmq"><span class="toc-number">1.</span> <span class="toc-text"> RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-mq%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text"> 1 MQ 引言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E4%BB%80%E4%B9%88%E6%98%AFmq"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 1.1 什么是 MQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-mq%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 1.2 MQ 有哪些</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E4%B8%8D%E5%90%8Cmq%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.3.</span> <span class="toc-text"> 1.3 不同 MQ 特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-rabbitmq-%E7%9A%84%E5%BC%95%E8%A8%80"><span class="toc-number">1.2.</span> <span class="toc-text"> 2 RabbitMQ 的引言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-rabbitmq"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 2.1 RabbitMQ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-rabbitmq-%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 2.2 RabbitMQ 的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#221-%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.2.2.1.</span> <span class="toc-text"> 2.2.1 下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#222-%E4%B8%8B%E8%BD%BD%E7%9A%84%E5%AE%89%E8%A3%85%E5%8C%85"><span class="toc-number">1.2.2.2.</span> <span class="toc-text"> 2.2.2 下载的安装包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#223-%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.2.2.3.</span> <span class="toc-text"> 2.2.3 安装步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-rabiitmq-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text"> 3 RabiitMQ 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-rabbitmq-%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 3.1 RabbitMQ 管理命令行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-web%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 3.2 web 管理界面介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#321-overview%E6%A6%82%E8%A7%88"><span class="toc-number">1.3.2.1.</span> <span class="toc-text"> 3.2.1 overview 概览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#322-admin%E7%94%A8%E6%88%B7%E5%92%8C%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.2.2.</span> <span class="toc-text"> 3.2.2 Admin 用户和虚拟主机管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3221-%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-number">1.3.2.2.1.</span> <span class="toc-text"> 3.2.2.1 添加用户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3222-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.3.2.2.2.</span> <span class="toc-text"> 3.2.2.2 创建虚拟主机</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3223-%E7%BB%91%E5%AE%9A%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E5%92%8C%E7%94%A8%E6%88%B7"><span class="toc-number">1.3.2.2.3.</span> <span class="toc-text"> 3.2.2.3 绑定虚拟主机和用户</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-rabbitmq-%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.4.</span> <span class="toc-text"> 4 RabbitMQ 的第一个程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-amqp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%9B%9E%E9%A1%BE"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 4.1 AMQP 协议的回顾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-rabbitmq%E6%94%AF%E6%8C%81%E7%9A%84%E6%B6%88%E6%81%AF%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 4.2 RabbitMQ 支持的消息模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.4.3.</span> <span class="toc-text"> 4.3 引入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#44-%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%A8%A1%E5%9E%8B%E7%9B%B4%E8%BF%9E"><span class="toc-number">1.4.4.</span> <span class="toc-text"> 4.4 第一种模型 (直连)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#441-%E5%BC%80%E5%8F%91%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">1.4.4.1.</span> <span class="toc-text"> 4.4.1 开发生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#442-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">1.4.4.2.</span> <span class="toc-text"> 4.4.2 开发消费者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#443-%E5%8F%82%E6%95%B0%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">1.4.4.3.</span> <span class="toc-text"> 4.4.3 参数的说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#444-%E5%B7%A5%E5%85%B7%E7%B1%BB%E7%9A%84%E5%8C%85%E8%A3%85"><span class="toc-number">1.4.4.4.</span> <span class="toc-text"> 4.4.4 工具类的包装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%A8%A1%E5%9E%8Bwork-quene"><span class="toc-number">1.4.5.</span> <span class="toc-text"> 4.5 第二种模型 (work quene)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#451-%E5%BC%80%E5%8F%91%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">1.4.5.1.</span> <span class="toc-text"> 4.5.1 开发生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#452-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-1"><span class="toc-number">1.4.5.2.</span> <span class="toc-text"> 4.5.2 开发消费者 - 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#453-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-2"><span class="toc-number">1.4.5.3.</span> <span class="toc-text"> 4.5.3 开发消费者 - 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#454-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="toc-number">1.4.5.4.</span> <span class="toc-text"> 4.5.4 测试结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#455-%E6%B6%88%E6%81%AF%E8%87%AA%E5%8A%A8%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.5.5.</span> <span class="toc-text"> 4.5.5 消息自动确认机制</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4551-%E5%BC%80%E5%8F%91%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">1.4.5.5.1.</span> <span class="toc-text"> 4.5.5.1 开发生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4552-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-1"><span class="toc-number">1.4.5.5.2.</span> <span class="toc-text"> 4.5.5.2 开发消费者 - 1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4553-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-2"><span class="toc-number">1.4.5.5.3.</span> <span class="toc-text"> 4.5.5.3 开发消费者 - 2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#45-%E7%AC%AC%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%9E%8Bfanout"><span class="toc-number">1.4.6.</span> <span class="toc-text"> 4.5 第三种模型 (fanout)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#451-%E5%BC%80%E5%8F%91%E7%94%9F%E4%BA%A7%E8%80%85-2"><span class="toc-number">1.4.6.1.</span> <span class="toc-text"> 4.5.1 开发生产者</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#452-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-1-2"><span class="toc-number">1.4.6.2.</span> <span class="toc-text"> 4.5.2 开发消费者 - 1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#453-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-2-2"><span class="toc-number">1.4.6.3.</span> <span class="toc-text"> 4.5.3 开发消费者 - 2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#454-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-3"><span class="toc-number">1.4.6.4.</span> <span class="toc-text"> 4.5.4 开发消费者 - 3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#455-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="toc-number">1.4.6.5.</span> <span class="toc-text"> 4.5.5 测试结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#46-%E7%AC%AC%E5%9B%9B%E7%A7%8D%E6%A8%A1%E5%9E%8Brouting"><span class="toc-number">1.4.7.</span> <span class="toc-text"> 4.6 第四种模型 (Routing)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#461-routing-%E4%B9%8B%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B-direct%E7%9B%B4%E8%BF%9E"><span class="toc-number">1.4.7.1.</span> <span class="toc-text"> 4.6.1 Routing 之订阅模型 - Direct (直连)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4611-%E5%BC%80%E5%8F%91%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">1.4.7.1.1.</span> <span class="toc-text"> 4.6.1.1 开发生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4612-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-1"><span class="toc-number">1.4.7.1.2.</span> <span class="toc-text"> 4.6.1.2 开发消费者 - 1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4613-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-2"><span class="toc-number">1.4.7.1.3.</span> <span class="toc-text"> 4.6.1.3 开发消费者 - 2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4614-%E6%B5%8B%E8%AF%95%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81route-key%E4%B8%BAerror%E7%9A%84%E6%B6%88%E6%81%AF%E6%97%B6"><span class="toc-number">1.4.7.1.4.</span> <span class="toc-text"> 4.6.1.4 测试生产者发送 Route key 为 error 的消息时</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4615-%E6%B5%8B%E8%AF%95%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81route-key%E4%B8%BAinfo%E7%9A%84%E6%B6%88%E6%81%AF%E6%97%B6"><span class="toc-number">1.4.7.1.5.</span> <span class="toc-text"> 4.6.1.5 测试生产者发送 Route key 为 info 的消息时</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#462-routing-%E4%B9%8B%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B-topic"><span class="toc-number">1.4.7.2.</span> <span class="toc-text"> 4.6.2 Routing 之订阅模型 - Topic</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4621-%E5%BC%80%E5%8F%91%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">1.4.7.2.1.</span> <span class="toc-text"> 4.6.2.1 开发生产者</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4622-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-1"><span class="toc-number">1.4.7.2.2.</span> <span class="toc-text"> 4.6.2.2 开发消费者 - 1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4623-%E5%BC%80%E5%8F%91%E6%B6%88%E8%B4%B9%E8%80%85-2"><span class="toc-number">1.4.7.2.3.</span> <span class="toc-text"> 4.6.2.3 开发消费者 - 2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4624-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="toc-number">1.4.7.2.4.</span> <span class="toc-text"> 4.6.2.4 测试结果</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-springboot%E4%B8%AD%E4%BD%BF%E7%94%A8rabbitmq"><span class="toc-number">1.5.</span> <span class="toc-text"> 5 SpringBoot 中使用 RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E6%90%AD%E5%BB%BA%E5%88%9D%E5%A7%8B%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.1.</span> <span class="toc-text"> 5.1 搭建初始环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#511-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">1.5.1.1.</span> <span class="toc-text"> 5.1.1 引入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#512-%E9%85%8D%E7%BD%AE%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.1.2.</span> <span class="toc-text"> 5.1.2 配置配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E7%AC%AC%E4%B8%80%E7%A7%8Dhello-world%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text"> 5.2 第一种 hello world 模型使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#53-%E7%AC%AC%E4%BA%8C%E7%A7%8Dwork%E6%A8%A1%E5%9E%8B%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.3.</span> <span class="toc-text"> 5.3 第二种 work 模型使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#54-fanout-%E5%B9%BF%E6%92%AD%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.5.4.</span> <span class="toc-text"> 5.4 Fanout 广播模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#55-route-%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.5.5.</span> <span class="toc-text"> 5.5 Route 路由模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#56-topic-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%9E%8B%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.5.6.</span> <span class="toc-text"> 5.6 Topic 订阅模型 (动态路由模型)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-mq%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.6.</span> <span class="toc-text"> 6 MQ 的应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 6.1 异步处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E5%BA%94%E7%94%A8%E8%A7%A3%E8%80%A6"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 6.2 应用解耦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#63-%E6%B5%81%E9%87%8F%E5%89%8A%E5%B3%B0"><span class="toc-number">1.6.3.</span> <span class="toc-text"> 6.3 流量削峰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-rabbitmq%E7%9A%84%E9%9B%86%E7%BE%A4"><span class="toc-number">1.7.</span> <span class="toc-text"> 7 RabbitMQ 的集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#71-%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="toc-number">1.7.1.</span> <span class="toc-text"> 7.1 集群架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#711-%E6%99%AE%E9%80%9A%E9%9B%86%E7%BE%A4%E5%89%AF%E6%9C%AC%E9%9B%86%E7%BE%A4"><span class="toc-number">1.7.1.1.</span> <span class="toc-text"> 7.1.1 普通集群 (副本集群)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#712-%E9%95%9C%E5%83%8F%E9%9B%86%E7%BE%A4"><span class="toc-number">1.7.1.2.</span> <span class="toc-text"> 7.1.2 镜像集群</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-map"><div class="card-content"><div class="item-headline"><i class="fa fa-globe-asia" aria-hidden="true"></i><span>Visitor Map</span></div><script id="clstr_globe" type="text/javascript" defer="defer" src="//clustrmaps.com/globe.js?d=4LA950xi3DtQgUHPlkO0mo-n_QgrcOu-1BIiVpExg7k"></script></div></div><div class="card-widget card-pixiv"><div class="card-content"><div class="item-headline"><i class="fa fa-image" aria-hidden="true"></i><span>Pixiv Top50</span><iframe src="https://cloud.mokeyjay.com/pixiv" frameborder="0" style="width:99%;height:380px;margin:0;"></iframe></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/Maven/" title="My Maven notes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/hello-world.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My Maven notes"/></a><div class="content"><a class="title" href="/2022/07/28/Maven/" title="My Maven notes">My Maven notes</a><time datetime="2022-07-27T12:00:00.000Z" title="Created 2022-07-28 00:00:00">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/25/nodejs/" title="Nodejs notes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/town.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nodejs notes"/></a><div class="content"><a class="title" href="/2022/07/25/nodejs/" title="Nodejs notes">Nodejs notes</a><time datetime="2022-07-24T12:00:00.000Z" title="Created 2022-07-25 00:00:00">2022-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/12/%E7%AE%97%E6%B3%95%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97/" title="My ultimate data structure and algorithm guide"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/statue.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My ultimate data structure and algorithm guide"/></a><div class="content"><a class="title" href="/2022/06/12/%E7%AE%97%E6%B3%95%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97/" title="My ultimate data structure and algorithm guide">My ultimate data structure and algorithm guide</a><time datetime="2022-06-11T12:00:00.000Z" title="Created 2022-06-12 00:00:00">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="Design Patterns"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Design Patterns"/></a><div class="content"><a class="title" href="/2022/06/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="Design Patterns">Design Patterns</a><time datetime="2022-06-11T12:00:00.000Z" title="Created 2022-06-12 00:00:00">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" title="Design Patterns - Factory Method"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Design Patterns - Factory Method"/></a><div class="content"><a class="title" href="/2022/06/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" title="Design Patterns - Factory Method">Design Patterns - Factory Method</a><time datetime="2022-06-10T12:00:00.000Z" title="Created 2022-06-11 00:00:00">2022-06-11</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Harry Qu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="Chat"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://harryqu1229.github.io/2022/03/20/rabbitmq%E7%AC%94%E8%AE%B0/'
    this.page.identifier = '2022/03/20/rabbitmq笔记/'
    this.page.title = 'Rabbitmq notes'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://harry-study-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '5df1e915e0fa867b50de',
      clientSecret: 'ce1cb793fe49078ee9d0102d3326d0d50ff6937b',
      repo: 'blog-comments-storage',
      owner: 'HarryQu1229',
      admin: ['HarryQu1229'],
      id: '15281c7d68a0cfff1b6baf10ffe3290d',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Disqus' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<code>.*?<\/code>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    fetch('https://disqus.com/api/3.0/forums/listPosts.json?forum=harry-study-blog&related=thread&limit=6&api_key=B5XFmdGuVaYDW7OIBakffpXoKorvphwRiwONIol4puEtr8YiwYAMAk2K7QcExNLY')
      .then(response => response.json())
      .then(data => {
        const disqusArray = data.response.map(item => {
          return {
            'avatar': item.author.avatar.cache,
            'content': changeContent(item.message),
            'nick': item.author.name,
            'url': item.url,
            'date': item.createdAt
          }
        })

        saveToLocal.set('disqus-newest-comments', JSON.stringify(disqusArray), 10/(60*24))
        generateHtml(disqusArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "Unable to get the data, please make sure the settings are correct."
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick}</span><time> / ${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('disqus-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="2809513713" data-server="netease" data-type="playlist" data-autoplay="false" data-fixed="true" data-order="random" data-theme="#e9ccd3"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="255,255,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>((window.gitter = {}).chat = {}).options = {
  disableDefaultChat: true,
};
document.addEventListener('gitter-sidecar-ready', (e) => {
  const GitterChat = e.detail.Chat
  let chat

  function initGitter () {
    chat = new GitterChat({
      room: 'HarryStudyBlog/community',
      activationElement: '#chat_btn'
    });
  }

  initGitter()

  if (true) {
    document.addEventListener('pjax:complete', () => {
      chat.destroy()
      initGitter()
    })
  }

})</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="async" defer="defer"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v3.8.2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":300,"height":450},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>