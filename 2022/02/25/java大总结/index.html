<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Java big Summary | Harry World</title><meta name="keywords" content="summary,javase"><meta name="author" content="Harry Qu"><meta name="copyright" content="Harry Qu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="# Java åŸºç¡€è¯­æ³•ç‰¹æ€§  ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ javacore   1. æ³¨é‡Š 2. åŸºæœ¬æ•°æ®ç±»å‹ 3. å˜é‡ 4. æ•°ç»„ 5. æšä¸¾ 6. æ“ä½œç¬¦ 7. æ–¹æ³• 8. æ§åˆ¶è¯­å¥ 9. å¼‚å¸¸ 10. æ³›å‹ 11. åå°„ 12. æ³¨è§£ 13. åºåˆ—åŒ–  # 1. æ³¨é‡Š ç©ºç™½è¡Œï¼Œæˆ–è€…æ³¨é‡Šçš„å†…å®¹ï¼Œéƒ½ä¼šè¢« Java ç¼–è¯‘å™¨å¿½ç•¥æ‰ã€‚ Java æ”¯æŒå¤šç§æ³¨é‡Šæ–¹å¼ï¼Œä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å„ç§æ³¨é‡Šçš„ä½¿ç”¨æ–¹">
<meta property="og:type" content="article">
<meta property="og:title" content="Java big Summary">
<meta property="og:url" content="https://harryqu1229.github.io/2022/02/25/java%E5%A4%A7%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="Harry World">
<meta property="og:description" content="# Java åŸºç¡€è¯­æ³•ç‰¹æ€§  ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ javacore   1. æ³¨é‡Š 2. åŸºæœ¬æ•°æ®ç±»å‹ 3. å˜é‡ 4. æ•°ç»„ 5. æšä¸¾ 6. æ“ä½œç¬¦ 7. æ–¹æ³• 8. æ§åˆ¶è¯­å¥ 9. å¼‚å¸¸ 10. æ³›å‹ 11. åå°„ 12. æ³¨è§£ 13. åºåˆ—åŒ–  # 1. æ³¨é‡Š ç©ºç™½è¡Œï¼Œæˆ–è€…æ³¨é‡Šçš„å†…å®¹ï¼Œéƒ½ä¼šè¢« Java ç¼–è¯‘å™¨å¿½ç•¥æ‰ã€‚ Java æ”¯æŒå¤šç§æ³¨é‡Šæ–¹å¼ï¼Œä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å„ç§æ³¨é‡Šçš„ä½¿ç”¨æ–¹">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://w.wallhaven.cc/full/k7/wallhaven-k7v9yq.png">
<meta property="article:published_time" content="2022-02-24T13:31:45.905Z">
<meta property="article:modified_time" content="2022-02-25T14:40:56.618Z">
<meta property="article:author" content="Harry Qu">
<meta property="article:tag" content="fundamental">
<meta property="article:tag" content="javase">
<meta property="article:tag" content="summary">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://w.wallhaven.cc/full/k7/wallhaven-k7v9yq.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://harryqu1229.github.io/2022/02/25/java%E5%A4%A7%E6%80%BB%E7%BB%93/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":100,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#C78550","bgDark":"#c08eaf","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java big Summary',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-02-26 03:40:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/6aca34ee52f40fe1b2d637474f90111e2c151939/notes-img/%E5%85%B6%E4%B8%AD%E5%8C%85%E6%8B%AC%E5%9B%BE%E7%89%87%EF%BC%9A%7B%7B%20pinTitle%20%7D%7D_m6kogp.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">171</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">89</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">60</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Videos/"><i class="fa-fw fa-regular fa-play"></i><span> Videos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.vox-cdn.com/thumbor/_AobZZDt_RVStktVR7mUZpBkovc=/0x0:640x427/1200x800/filters:focal(0x0:640x427)/cdn.vox-cdn.com/assets/1087137/java_logo_640.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Harry World</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Videos/"><i class="fa-fw fa-regular fa-play"></i><span> Videos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java big Summary</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-02-24T13:31:45.905Z" title="Created 2022-02-25 02:31:45">2022-02-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-02-25T14:40:56.618Z" title="Updated 2022-02-26 03:40:56">2022-02-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Important/">Important</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Important/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">229.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>848min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java big Summary"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><span class="disqus-comment-count"><a href="https://harryqu1229.github.io/2022/02/25/java%E5%A4%A7%E6%80%BB%E7%BB%93/#disqus_thread"></a></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="java-åŸºç¡€è¯­æ³•ç‰¹æ€§"><a class="markdownIt-Anchor" href="#java-åŸºç¡€è¯­æ³•ç‰¹æ€§">#</a> Java åŸºç¡€è¯­æ³•ç‰¹æ€§</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore</a></strong></p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#1-%E6%B3%A8%E9%87%8A">1. æ³¨é‡Š</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#2-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">2. åŸºæœ¬æ•°æ®ç±»å‹</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#3-%E5%8F%98%E9%87%8F">3. å˜é‡</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#4-%E6%95%B0%E7%BB%84">4. æ•°ç»„</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#5-%E6%9E%9A%E4%B8%BE">5. æšä¸¾</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#6-%E6%93%8D%E4%BD%9C%E7%AC%A6">6. æ“ä½œç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#7-%E6%96%B9%E6%B3%95">7. æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#8-%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5">8. æ§åˆ¶è¯­å¥</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#9-%E5%BC%82%E5%B8%B8">9. å¼‚å¸¸</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#10-%E6%B3%9B%E5%9E%8B">10. æ³›å‹</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#11-%E5%8F%8D%E5%B0%84">11. åå°„</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#12-%E6%B3%A8%E8%A7%A3">12. æ³¨è§£</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-basic-grammar.md#13-%E5%BA%8F%E5%88%97%E5%8C%96">13. åºåˆ—åŒ–</a></li>
</ul>
<h2 id="1-æ³¨é‡Š"><a class="markdownIt-Anchor" href="#1-æ³¨é‡Š">#</a> 1. æ³¨é‡Š</h2>
<p>ç©ºç™½è¡Œï¼Œæˆ–è€…æ³¨é‡Šçš„å†…å®¹ï¼Œéƒ½ä¼šè¢« Java ç¼–è¯‘å™¨å¿½ç•¥æ‰ã€‚</p>
<p>Java æ”¯æŒå¤šç§æ³¨é‡Šæ–¹å¼ï¼Œä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å„ç§æ³¨é‡Šçš„ä½¿ç”¨æ–¹å¼ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/*
     * JavaDoc æ³¨é‡Š
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å•è¡Œæ³¨é‡Š</span>
        <span class="token comment">/* å¤šè¡Œæ³¨é‡Šï¼š
           1. æ³¨æ„ç‚¹a
           2. æ³¨æ„ç‚¹b
         */</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-åŸºæœ¬æ•°æ®ç±»å‹"><a class="markdownIt-Anchor" href="#2-åŸºæœ¬æ•°æ®ç±»å‹">#</a> 2. åŸºæœ¬æ•°æ®ç±»å‹</h2>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.svg" alt="img"></a></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-data-type.md">æ·±å…¥ç†è§£ Java åŸºæœ¬æ•°æ®ç±»å‹</a></p>
</blockquote>
<h2 id="3-å˜é‡"><a class="markdownIt-Anchor" href="#3-å˜é‡">#</a> 3. å˜é‡</h2>
<p>Java æ”¯æŒçš„å˜é‡ç±»å‹æœ‰ï¼š</p>
<ul>
<li><code>å±€éƒ¨å˜é‡</code>  - ç±»æ–¹æ³•ä¸­çš„å˜é‡ã€‚</li>
<li><code>å®ä¾‹å˜é‡ï¼ˆä¹Ÿå«æˆå‘˜å˜é‡ï¼‰</code>  - ç±»æ–¹æ³•å¤–çš„å˜é‡ï¼Œä¸è¿‡æ²¡æœ‰  <code>static</code>  ä¿®é¥°ã€‚</li>
<li><code>ç±»å˜é‡ï¼ˆä¹Ÿå«é™æ€å˜é‡ï¼‰</code>  - ç±»æ–¹æ³•å¤–çš„å˜é‡ï¼Œç”¨  <code>static</code>  ä¿®é¥°ã€‚</li>
</ul>
<p>ç‰¹æ€§å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>å±€éƒ¨å˜é‡</th>
<th>å®ä¾‹å˜é‡ï¼ˆä¹Ÿå«æˆå‘˜å˜é‡ï¼‰</th>
<th>ç±»å˜é‡ï¼ˆä¹Ÿå«é™æ€å˜é‡ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>å±€éƒ¨å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­ã€‚</td>
<td>å®ä¾‹å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚</td>
<td>ç±»å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚å¹¶ä¸”ä»¥ static ä¿®é¥°ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆ–è€…è¯­å¥å—è¢«æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºï¼Œå½“å®ƒä»¬æ‰§è¡Œå®Œæˆåï¼Œå˜é‡å°†ä¼šè¢«é”€æ¯ã€‚</td>
<td>å®ä¾‹å˜é‡åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™åˆ›å»ºï¼Œåœ¨å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™é”€æ¯ã€‚</td>
<td>ç±»å˜é‡åœ¨ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶åˆ›å»ºï¼Œåœ¨ç¨‹åºç»“æŸæ—¶é”€æ¯ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡æ²¡æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥å¿…é¡»ç»è¿‡åˆå§‹åŒ–ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚</td>
<td>å®ä¾‹å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ nullã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚</td>
<td>ç±»å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ nullã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚æ­¤å¤–ï¼Œé™æ€å˜é‡è¿˜å¯ä»¥åœ¨é™æ€è¯­å¥å—ä¸­åˆå§‹åŒ–ã€‚</td>
</tr>
<tr>
<td>å¯¹äºå±€éƒ¨å˜é‡ï¼Œå¦‚æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œä¼šæŠŠå€¼ç›´æ¥å­˜å‚¨åœ¨æ ˆï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼šæŠŠå…¶å¯¹è±¡å­˜å‚¨åœ¨å †ï¼Œè€ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰å­˜å‚¨åœ¨æ ˆã€‚</td>
<td>å®ä¾‹å˜é‡å­˜å‚¨åœ¨å †ã€‚</td>
<td>ç±»å˜é‡å­˜å‚¨åœ¨é™æ€å­˜å‚¨åŒºã€‚</td>
</tr>
<tr>
<td>è®¿é—®ä¿®é¥°ç¬¦ä¸èƒ½ç”¨äºå±€éƒ¨å˜é‡ã€‚</td>
<td>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ç”¨äºå®ä¾‹å˜é‡ã€‚</td>
<td>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ç”¨äºç±»å˜é‡ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡åªåœ¨å£°æ˜å®ƒçš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­å¯è§ã€‚</td>
<td>å®ä¾‹å˜é‡å¯¹äºç±»ä¸­çš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—æ˜¯å¯è§çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹åº”è¯¥æŠŠå®ä¾‹å˜é‡è®¾ä¸ºç§æœ‰ã€‚é€šè¿‡ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾‹å˜é‡å¯¹å­ç±»å¯è§ã€‚</td>
<td>ä¸å®ä¾‹å˜é‡å…·æœ‰ç›¸ä¼¼çš„å¯è§æ€§ã€‚ä½†ä¸ºäº†å¯¹ç±»çš„ä½¿ç”¨è€…å¯è§ï¼Œå¤§å¤šæ•°é™æ€å˜é‡å£°æ˜ä¸º public ç±»å‹ã€‚</td>
</tr>
<tr>
<td></td>
<td>å®ä¾‹å˜é‡å¯ä»¥ç›´æ¥é€šè¿‡å˜é‡åè®¿é—®ã€‚ä½†åœ¨é™æ€æ–¹æ³•ä»¥åŠå…¶ä»–ç±»ä¸­ï¼Œå°±åº”è¯¥ä½¿ç”¨å®Œå…¨é™å®šåï¼šObejectReference.VariableNameã€‚</td>
<td>é™æ€å˜é‡å¯ä»¥é€šè¿‡ï¼šClassName.VariableName çš„æ–¹å¼è®¿é—®ã€‚</td>
</tr>
<tr>
<td></td>
<td></td>
<td>æ— è®ºä¸€ä¸ªç±»åˆ›å»ºäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œç±»åªæ‹¥æœ‰ç±»å˜é‡çš„ä¸€ä»½æ‹·è´ã€‚</td>
</tr>
<tr>
<td></td>
<td></td>
<td>ç±»å˜é‡é™¤äº†è¢«å£°æ˜ä¸ºå¸¸é‡å¤–å¾ˆå°‘ä½¿ç”¨ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>å˜é‡ä¿®é¥°ç¬¦</strong></p>
<ul>
<li>è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦
<ul>
<li>å¦‚æœå˜é‡æ˜¯å®ä¾‹å˜é‡æˆ–ç±»å˜é‡ï¼Œå¯ä»¥æ·»åŠ è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦ï¼ˆpublic/protected/privateï¼‰</li>
</ul>
</li>
<li>é™æ€ä¿®é¥°ç¬¦
<ul>
<li>å¦‚æœå˜é‡æ˜¯ç±»å˜é‡ï¼Œéœ€è¦æ·»åŠ  static ä¿®é¥°</li>
</ul>
</li>
<li>final
<ul>
<li>å¦‚æœå˜é‡ä½¿ç”¨  <code>fianl</code>  ä¿®é¥°ç¬¦ï¼Œå°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-æ•°ç»„"><a class="markdownIt-Anchor" href="#4-æ•°ç»„">#</a> 4. æ•°ç»„</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%95%B0%E7%BB%84.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-array.md">æ·±å…¥ç†è§£ Java æ•°ç»„</a></p>
</blockquote>
<h2 id="5-æšä¸¾"><a class="markdownIt-Anchor" href="#5-æšä¸¾">#</a> 5. æšä¸¾</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%9E%9A%E4%B8%BE.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-enum.md">æ·±å…¥ç†è§£ Java æ•°ç»„</a></p>
</blockquote>
<h2 id="6-æ“ä½œç¬¦"><a class="markdownIt-Anchor" href="#6-æ“ä½œç¬¦">#</a> 6. æ“ä½œç¬¦</h2>
<p>Java ä¸­æ”¯æŒçš„æ“ä½œç¬¦ç±»å‹å¦‚ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%93%8D%E4%BD%9C%E7%AC%A6.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%93%8D%E4%BD%9C%E7%AC%A6.svg" alt="img"></a></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="http://www.runoob.com/java/java-operators.html">Java æ“ä½œç¬¦</a></p>
</blockquote>
<h2 id="7-æ–¹æ³•"><a class="markdownIt-Anchor" href="#7-æ–¹æ³•">#</a> 7. æ–¹æ³•</h2>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/snap/20220125072221.png"><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20220125072221.png" alt="img" style="zoom:200%;" /></a></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-method.md">æ·±å…¥ç†è§£ Java æ–¹æ³•</a></p>
</blockquote>
<h2 id="8-æ§åˆ¶è¯­å¥"><a class="markdownIt-Anchor" href="#8-æ§åˆ¶è¯­å¥">#</a> 8. æ§åˆ¶è¯­å¥</h2>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5.svg" alt="img"></a></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-control-statement.md">Java æ§åˆ¶è¯­å¥</a></p>
</blockquote>
<h2 id="9-å¼‚å¸¸"><a class="markdownIt-Anchor" href="#9-å¼‚å¸¸">#</a> 9. å¼‚å¸¸</h2>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BC%82%E5%B8%B8%E6%A1%86%E6%9E%B6.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BC%82%E5%B8%B8%E6%A1%86%E6%9E%B6.svg" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BC%82%E5%B8%B8.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BC%82%E5%B8%B8.svg" alt="img"></a></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-exception.md">æ·±å…¥ç†è§£ Java å¼‚å¸¸</a></p>
</blockquote>
<h2 id="10-æ³›å‹"><a class="markdownIt-Anchor" href="#10-æ³›å‹">#</a> 10. æ³›å‹</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%B3%9B%E5%9E%8B.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-generic.md">æ·±å…¥ç†è§£ Java æ³›å‹</a></p>
</blockquote>
<h2 id="11-åå°„"><a class="markdownIt-Anchor" href="#11-åå°„">#</a> 11. åå°„</h2>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%8F%8D%E5%B0%84.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%8F%8D%E5%B0%84.svg" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E4%BB%A3%E7%90%86.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E4%BB%A3%E7%90%86.svg" alt="img"></a></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-reflection.md">æ·±å…¥ç†è§£ Java åå°„å’ŒåŠ¨æ€ä»£ç†</a></p>
</blockquote>
<h2 id="12-æ³¨è§£"><a class="markdownIt-Anchor" href="#12-æ³¨è§£">#</a> 12. æ³¨è§£</h2>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E6%B3%A8%E8%A7%A3%E7%AE%80%E4%BB%8B.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E6%B3%A8%E8%A7%A3%E7%AE%80%E4%BB%8B.svg" alt="img"></a></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E5%85%83%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-annotation.md">æ·±å…¥ç†è§£ Java æ³¨è§£</a></p>
</blockquote>
<h2 id="13-åºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#13-åºåˆ—åŒ–">#</a> 13. åºåˆ—åŒ–</h2>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BA%8F%E5%88%97%E5%8C%96.svg"><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%BA%8F%E5%88%97%E5%8C%96.svg" alt="img"></a></p>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-åŸºæœ¬æ•°æ®ç±»å‹"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-åŸºæœ¬æ•°æ®ç±»å‹">#</a> æ·±å…¥ç†è§£ Java åŸºæœ¬æ•°æ®ç±»å‹</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553754196283.png" alt="img"></p>
<ul>
<li>\1. æ•°æ®ç±»å‹åˆ†ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#11-%E5%80%BC%E7%B1%BB%E5%9E%8B">1.1. å€¼ç±»å‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#12-%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%AB">1.2. å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„åŒºåˆ«</a></li>
</ul>
</li>
<li>\2. æ•°æ®è½¬æ¢
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#21-%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2">2.1. è‡ªåŠ¨è½¬æ¢</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#22-%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2">2.2. å¼ºåˆ¶è½¬æ¢</a></li>
</ul>
</li>
<li>\3. è£…ç®±å’Œæ‹†ç®±
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#31-%E5%8C%85%E8%A3%85%E7%B1%BB%E8%A3%85%E7%AE%B1%E6%8B%86%E7%AE%B1">3.1. åŒ…è£…ç±»ã€è£…ç®±ã€æ‹†ç®±</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#32-%E8%87%AA%E5%8A%A8%E8%A3%85%E7%AE%B1%E8%87%AA%E5%8A%A8%E6%8B%86%E7%AE%B1">3.2. è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#33-%E8%A3%85%E7%AE%B1%E6%8B%86%E7%AE%B1%E7%9A%84%E5%BA%94%E7%94%A8%E5%92%8C%E6%B3%A8%E6%84%8F%E7%82%B9">3.3. è£…ç®±ã€æ‹†ç®±çš„åº”ç”¨å’Œæ³¨æ„ç‚¹</a></li>
</ul>
</li>
<li>\4. åˆ¤ç­‰é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#41-%E5%8C%85%E8%A3%85%E7%B1%BB%E7%9A%84%E5%88%A4%E7%AD%89">4.1. åŒ…è£…ç±»çš„åˆ¤ç­‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#42-string-%E7%9A%84%E5%88%A4%E7%AD%89">4.2. String çš„åˆ¤ç­‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#43-%E5%AE%9E%E7%8E%B0-equals">4.3. å®ç° equals</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#44-hashcode-%E5%92%8C-equals-%E8%A6%81%E9%85%8D%E5%AF%B9%E5%AE%9E%E7%8E%B0">4.4. hashCode å’Œ equals è¦é…å¯¹å®ç°</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#45-compareto-%E5%92%8C-equals-%E7%9A%84%E9%80%BB%E8%BE%91%E4%B8%80%E8%87%B4%E6%80%A7">4.5. compareTo å’Œ equals çš„é€»è¾‘ä¸€è‡´æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#46-%E5%B0%8F%E5%BF%83-lombok-%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%9A%84%E5%9D%91">4.6. å°å¿ƒ Lombok ç”Ÿæˆä»£ç çš„ â€œå‘â€</a></li>
</ul>
</li>
<li>\5. æ•°å€¼è®¡ç®—
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#51-%E6%B5%AE%E7%82%B9%E6%95%B0%E8%AE%A1%E7%AE%97%E9%97%AE%E9%A2%98">5.1. æµ®ç‚¹æ•°è®¡ç®—é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#52-%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B2%BE%E5%BA%A6%E5%92%8C%E6%A0%BC%E5%BC%8F%E5%8C%96">5.2. æµ®ç‚¹æ•°ç²¾åº¦å’Œæ ¼å¼åŒ–</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#53-bigdecimal-%E5%88%A4%E7%AD%89%E9%97%AE%E9%A2%98">5.3. BigDecimal åˆ¤ç­‰é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#54-%E6%95%B0%E5%80%BC%E6%BA%A2%E5%87%BA">5.4. æ•°å€¼æº¢å‡º</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#6-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">6. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_1-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%88%86%E7%B1%BB">#</a>1. æ•°æ®ç±»å‹åˆ†ç±»</h2>
<p>Java ä¸­çš„æ•°æ®ç±»å‹æœ‰ä¸¤ç±»ï¼š</p>
<ul>
<li>å€¼ç±»å‹ï¼ˆåˆå«å†…ç½®æ•°æ®ç±»å‹ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ï¼‰</li>
<li>å¼•ç”¨ç±»å‹ï¼ˆé™¤å€¼ç±»å‹ä»¥å¤–ï¼Œéƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼ŒåŒ…æ‹¬  <code>String</code> ã€æ•°ç»„ï¼‰</li>
</ul>
<h3 id="-2"><a class="markdownIt-Anchor" href="#-2">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_1-1-%E5%80%BC%E7%B1%BB%E5%9E%8B">#</a>1.1. å€¼ç±»å‹</h3>
<p>Java è¯­è¨€æä¾›äº† <strong>8</strong> ç§åŸºæœ¬ç±»å‹ï¼Œå¤§è‡´åˆ†ä¸º <strong>4</strong> ç±»</p>
<table>
<thead>
<tr>
<th>åŸºæœ¬æ•°æ®ç±»å‹</th>
<th>åˆ†ç±»</th>
<th>æ¯”ç‰¹æ•°</th>
<th>é»˜è®¤å€¼</th>
<th>å–å€¼èŒƒå›´</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>boolean</code></td>
<td><strong>å¸ƒå°”å‹</strong></td>
<td>8 ä½</td>
<td><code>false</code></td>
<td false,="" true=""></td>
<td></td>
</tr>
<tr>
<td><code>char</code></td>
<td><strong>å­—ç¬¦å‹</strong></td>
<td>16 ä½</td>
<td><code>'\u0000'</code></td>
<td>[0, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{16} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>]</td>
<td>å­˜å‚¨ Unicode ç ï¼Œç”¨å•å¼•å·èµ‹å€¼</td>
</tr>
<tr>
<td><code>byte</code></td>
<td><strong>æ•´æ•°å‹</strong></td>
<td>8 ä½</td>
<td><code>0</code></td>
<td>[-<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>7</mn></msup></mrow><annotation encoding="application/x-tex">2^7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>7</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^7 - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>]</td>
<td></td>
</tr>
<tr>
<td><code>short</code></td>
<td><strong>æ•´æ•°å‹</strong></td>
<td>16 ä½</td>
<td><code>0</code></td>
<td>[-<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup></mrow><annotation encoding="application/x-tex">2^{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{15} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>]</td>
<td></td>
</tr>
<tr>
<td><code>int</code></td>
<td><strong>æ•´æ•°å‹</strong></td>
<td>32 ä½</td>
<td><code>0</code></td>
<td>[-<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>31</mn></msup></mrow><annotation encoding="application/x-tex">2^{31}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>31</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{31} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>]</td>
<td></td>
</tr>
<tr>
<td><code>long</code></td>
<td><strong>æ•´æ•°å‹</strong></td>
<td>64 ä½</td>
<td><code>0L</code></td>
<td>[-<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>63</mn></msup></mrow><annotation encoding="application/x-tex">2^{63}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>63</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{63} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>]</td>
<td>èµ‹å€¼æ—¶ä¸€èˆ¬åœ¨æ•°å­—ååŠ ä¸Š  <code>l</code>  æˆ–  <code>L</code></td>
</tr>
<tr>
<td><code>float</code></td>
<td><strong>æµ®ç‚¹å‹</strong></td>
<td>32 ä½</td>
<td><code>+0.0F</code></td>
<td>[<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mo>âˆ’</mo><mn>149</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{-149}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span><span class="mord mtight">4</span><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>128</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{128} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>]</td>
<td>èµ‹å€¼æ—¶å¿…é¡»åœ¨æ•°å­—ååŠ ä¸Š  <code>f</code>  æˆ–  <code>F</code></td>
</tr>
<tr>
<td><code>double</code></td>
<td><strong>æµ®ç‚¹å‹</strong></td>
<td>64 ä½</td>
<td><code>+0.0D</code></td>
<td>[<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mo>âˆ’</mo><mn>1074</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{-1074}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mord mtight">7</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>1024</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{1024} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>]</td>
<td>èµ‹å€¼æ—¶ä¸€èˆ¬åœ¨æ•°å­—ååŠ   <code>d</code>  æˆ–  <code>D</code></td>
</tr>
</tbody>
</table>
<p>å°½ç®¡å„ç§æ•°æ®ç±»å‹çš„é»˜è®¤å€¼çœ‹èµ·æ¥ä¸ä¸€æ ·ï¼Œä½†åœ¨å†…å­˜ä¸­éƒ½æ˜¯ 0ã€‚</p>
<p>åœ¨è¿™äº›åŸºæœ¬ç±»å‹ä¸­ï¼Œ <code>boolean</code>  å’Œ  <code>char</code>  æ˜¯å”¯äºŒçš„æ— ç¬¦å·ç±»å‹ã€‚</p>
<h3 id="-3"><a class="markdownIt-Anchor" href="#-3">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_1-2-%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8C%BA%E5%88%AB">#</a>1.2. å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„åŒºåˆ«</h3>
<ul>
<li>ä»æ¦‚å¿µæ–¹é¢æ¥è¯´
<ul>
<li>åŸºæœ¬ç±»å‹ï¼šå˜é‡åæŒ‡å‘å…·ä½“çš„æ•°å€¼ã€‚</li>
<li>å¼•ç”¨ç±»å‹ï¼šå˜é‡åæŒ‡å‘å­˜æ•°æ®å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚</li>
</ul>
</li>
<li>ä»å†…å­˜æ–¹é¢æ¥è¯´
<ul>
<li>åŸºæœ¬ç±»å‹ï¼šå˜é‡åœ¨å£°æ˜ä¹‹åï¼ŒJava å°±ä¼šç«‹åˆ»åˆ†é…ç»™ä»–å†…å­˜ç©ºé—´ã€‚</li>
<li>å¼•ç”¨ç±»å‹ï¼šå®ƒä»¥ç‰¹æ®Šçš„æ–¹å¼ï¼ˆç±»ä¼¼ C æŒ‡é’ˆï¼‰å‘å¯¹è±¡å®ä½“ï¼ˆå…·ä½“çš„å€¼ï¼‰ï¼Œè¿™ç±»å˜é‡å£°æ˜æ—¶ä¸ä¼šåˆ†é…å†…å­˜ï¼Œåªæ˜¯å­˜å‚¨äº†ä¸€ä¸ªå†…å­˜åœ°å€ã€‚</li>
</ul>
</li>
<li>ä»ä½¿ç”¨æ–¹é¢æ¥è¯´
<ul>
<li>åŸºæœ¬ç±»å‹ï¼šä½¿ç”¨æ—¶éœ€è¦èµ‹å…·ä½“å€¼ï¼Œåˆ¤æ–­æ—¶ä½¿ç”¨  <code>==</code>  å·ã€‚</li>
<li>å¼•ç”¨ç±»å‹ï¼šä½¿ç”¨æ—¶å¯ä»¥èµ‹ nullï¼Œåˆ¤æ–­æ—¶ä½¿ç”¨  <code>equals</code>  æ–¹æ³•ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/59cd71835188255d3448faf6">Java åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹ (opens new window)</a></p>
<p>è¿™ç¯‡æ–‡ç« å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„å†…å­˜å­˜å‚¨è®²è¿°æ¯”è¾ƒç”ŸåŠ¨ã€‚</p>
</blockquote>
<h2 id="-4"><a class="markdownIt-Anchor" href="#-4">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_2-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2">#</a>2. æ•°æ®è½¬æ¢</h2>
<p>Java ä¸­ï¼Œæ•°æ®ç±»å‹è½¬æ¢æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>è‡ªåŠ¨è½¬æ¢</li>
<li>å¼ºåˆ¶è½¬æ¢</li>
</ul>
<h3 id="-5"><a class="markdownIt-Anchor" href="#-5">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_2-1-%E8%87%AA%E5%8A%A8%E8%BD%AC%E6%8D%A2">#</a>2.1. è‡ªåŠ¨è½¬æ¢</h3>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®šä¹‰äº†æŸæ•°æ®ç±»å‹çš„å˜é‡ï¼Œå°±ä¸èƒ½å†éšæ„è½¬æ¢ã€‚ä½†æ˜¯ JAVA å…è®¸ç”¨æˆ·å¯¹åŸºæœ¬ç±»å‹åš<strong>æœ‰é™åº¦</strong>çš„ç±»å‹è½¬æ¢ã€‚</p>
<p>å¦‚æœç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼Œåˆ™ JAVA å°†ä¼šè‡ªåŠ¨åšç±»å‹è½¬æ¢ï¼š</p>
<ul>
<li>
<p><strong>ç”±å°æ•°æ®è½¬æ¢ä¸ºå¤§æ•°æ®</strong></p>
<p>æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œâ€œå°â€ æ•°æ®ç±»å‹çš„æ•°å€¼è¡¨ç¤ºèŒƒå›´å°äº â€œå¤§â€ æ•°æ®ç±»å‹çš„æ•°å€¼è¡¨ç¤ºèŒƒå›´ï¼Œå³ç²¾åº¦å°äº â€œå¤§â€ æ•°æ®ç±»å‹ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœ â€œå¤§â€ æ•°æ®å‘ â€œå°â€ æ•°æ®è½¬æ¢ï¼Œä¼šä¸¢å¤±æ•°æ®ç²¾åº¦ã€‚æ¯”å¦‚ï¼šlong è½¬ä¸º intï¼Œåˆ™è¶…å‡º int è¡¨ç¤ºèŒƒå›´çš„æ•°æ®å°†ä¼šä¸¢å¤±ï¼Œå¯¼è‡´ç»“æœçš„ä¸ç¡®å®šæ€§ã€‚</p>
<p>åä¹‹ï¼Œâ€œå°â€ æ•°æ®å‘ â€œå¤§â€ æ•°æ®è½¬æ¢ï¼Œåˆ™ä¸ä¼šå­˜åœ¨æ•°æ®ä¸¢å¤±æƒ…å†µã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œè¿™ç§ç±»å‹è½¬æ¢ä¹Ÿç§°ä¸º<strong>æ‰©å¤§è½¬æ¢</strong>ã€‚</p>
<p>è¿™äº›ç±»å‹ç”± â€œå°â€ åˆ° â€œå¤§â€ åˆ†åˆ«ä¸ºï¼š(byteï¼Œshortï¼Œchar) &lt; int &lt; long &lt; float &lt; doubleã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æ‰€è¯´çš„ â€œå¤§â€ ä¸ â€œå°â€ï¼Œå¹¶ä¸æ˜¯æŒ‡å ç”¨å­—èŠ‚çš„å¤šå°‘ï¼Œè€Œæ˜¯æŒ‡è¡¨ç¤ºå€¼çš„èŒƒå›´çš„å¤§å°ã€‚</p>
</li>
<li>
<p><strong>è½¬æ¢å‰åçš„æ•°æ®ç±»å‹è¦å…¼å®¹</strong></p>
<p>ç”±äº boolean ç±»å‹åªèƒ½å­˜æ”¾ true æˆ– falseï¼Œè¿™ä¸æ•´æ•°æˆ–å­—ç¬¦æ˜¯ä¸å…¼å®¹çš„ï¼Œå› æ­¤ä¸å¯ä»¥åšç±»å‹è½¬æ¢ã€‚</p>
</li>
<li>
<p><strong>æ•´å‹ç±»å‹å’Œæµ®ç‚¹å‹è¿›è¡Œè®¡ç®—åï¼Œç»“æœä¼šè½¬ä¸ºæµ®ç‚¹ç±»å‹</strong></p>
</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> x <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">float</span> y <span class="token operator">=</span> <span class="token number">14.3f</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"x/y = "</span> <span class="token operator">+</span> x<span class="token operator">/</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">x/y = 1.9607843<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¯è§ long è™½ç„¶ç²¾åº¦å¤§äº float ç±»å‹ï¼Œä½†æ˜¯ç»“æœä¸ºæµ®ç‚¹æ•°ç±»å‹ã€‚</p>
<h3 id="-6"><a class="markdownIt-Anchor" href="#-6">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_2-2-%E5%BC%BA%E5%88%B6%E8%BD%AC%E6%8D%A2">#</a>2.2. å¼ºåˆ¶è½¬æ¢</h3>
<p>åœ¨ä¸ç¬¦åˆè‡ªåŠ¨è½¬æ¢æ¡ä»¶æ—¶æˆ–è€…æ ¹æ®ç”¨æˆ·çš„éœ€è¦ï¼Œå¯ä»¥å¯¹æ•°æ®ç±»å‹åšå¼ºåˆ¶çš„è½¬æ¢ã€‚</p>
<p><strong>å¼ºåˆ¶è½¬æ¢ä½¿ç”¨æ‹¬å·  <code>()</code>  ã€‚</strong></p>
<p>å¼•ç”¨ç±»å‹ä¹Ÿå¯ä»¥ä½¿ç”¨å¼ºåˆ¶è½¬æ¢ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">25.5f</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>f<span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"x = "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="-7"><a class="markdownIt-Anchor" href="#-7">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_3-%E8%A3%85%E7%AE%B1%E5%92%8C%E6%8B%86%E7%AE%B1">#</a>3. è£…ç®±å’Œæ‹†ç®±</h2>
<h3 id="-8"><a class="markdownIt-Anchor" href="#-8">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_3-1-%E5%8C%85%E8%A3%85%E7%B1%BB%E3%80%81%E8%A3%85%E7%AE%B1%E3%80%81%E6%8B%86%E7%AE%B1">#</a>3.1. åŒ…è£…ç±»ã€è£…ç®±ã€æ‹†ç®±</h3>
<p>Java ä¸­ä¸ºæ¯ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹æä¾›äº†ç›¸åº”çš„åŒ…è£…ç±»ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Byte &lt;-> byte
Short &lt;-> short
Integer &lt;-> int
Long &lt;-> long
Float &lt;-> float
Double &lt;-> double
Character &lt;-> char
Boolean &lt;-> boolean<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>å¼•å…¥åŒ…è£…ç±»çš„ç›®çš„</strong>å°±æ˜¯ï¼šæä¾›ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—<strong>åŸºæœ¬æ•°æ®ç±»å‹å¯ä»¥ä¸å¼•ç”¨ç±»å‹äº’ç›¸è½¬æ¢</strong>ã€‚</p>
<p>åŸºæœ¬æ•°æ®ç±»å‹ä¸åŒ…è£…ç±»çš„è½¬æ¢è¢«ç§°ä¸º <code>è£…ç®±</code> å’Œ <code>æ‹†ç®±</code> ã€‚</p>
<ul>
<li>
<p><code>è£…ç®±</code> ï¼ˆboxingï¼‰æ˜¯å°†å€¼ç±»å‹è½¬æ¢ä¸ºå¼•ç”¨ç±»å‹</p>
<p>ã€‚ä¾‹å¦‚ï¼š <code>int</code>  è½¬ <code>Integer</code></p>
<ul>
<li>è£…ç®±è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨åŒ…è£…ç±»çš„  <code>valueOf</code>  æ–¹æ³•å®ç°çš„ã€‚</li>
</ul>
</li>
<li>
<p><code>æ‹†ç®±</code> ï¼ˆunboxingï¼‰æ˜¯å°†å¼•ç”¨ç±»å‹è½¬æ¢ä¸ºå€¼ç±»å‹</p>
<p>ã€‚ä¾‹å¦‚ï¼š <code>Integer</code>  è½¬ <code>int</code></p>
<ul>
<li>æ‹†ç®±è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨åŒ…è£…ç±»çš„  <code>xxxValue</code>  æ–¹æ³•å®ç°çš„ã€‚ï¼ˆxxx ä»£è¡¨å¯¹åº”çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 id="-9"><a class="markdownIt-Anchor" href="#-9">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_3-2-%E8%87%AA%E5%8A%A8%E8%A3%85%E7%AE%B1%E3%80%81%E8%87%AA%E5%8A%A8%E6%8B%86%E7%AE%B1">#</a>3.2. è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±</h3>
<p>åŸºæœ¬æ•°æ®ï¼ˆPrimitiveï¼‰å‹çš„è‡ªåŠ¨è£…ç®±ï¼ˆboxingï¼‰æ‹†ç®±ï¼ˆunboxingï¼‰è‡ª JDK 5 å¼€å§‹æä¾›çš„åŠŸèƒ½ã€‚</p>
<p>è‡ªåŠ¨è£…ç®±ä¸æ‹†ç®±çš„æœºåˆ¶å¯ä»¥è®©æˆ‘ä»¬åœ¨ Java çš„å˜é‡èµ‹å€¼æˆ–è€…æ˜¯æ–¹æ³•è°ƒç”¨ç­‰æƒ…å†µä¸‹ä½¿ç”¨åŸå§‹ç±»å‹æˆ–è€…å¯¹è±¡ç±»å‹æ›´åŠ ç®€å•ç›´æ¥ã€‚ å› ä¸ºè‡ªåŠ¨è£…ç®±ä¼šéšå¼åœ°åˆ›å»ºå¯¹è±¡ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå¾ªç¯ä½“ä¸­ï¼Œä¼šåˆ›å»ºæ— ç”¨çš„ä¸­é—´å¯¹è±¡ï¼Œè¿™æ ·ä¼šå¢åŠ  GC å‹åŠ›ï¼Œæ‹‰ä½ç¨‹åºçš„æ€§èƒ½ã€‚æ‰€ä»¥åœ¨å†™å¾ªç¯æ—¶ä¸€å®šè¦æ³¨æ„ä»£ç ï¼Œé¿å…å¼•å…¥ä¸å¿…è¦çš„è‡ªåŠ¨è£…ç®±æ“ä½œã€‚</p>
<p>JDK 5 ä¹‹å‰çš„å½¢å¼ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éè‡ªåŠ¨è£…ç®±</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>JDK 5 ä¹‹åï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªåŠ¨è£…ç®±</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Java å¯¹äºè‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±çš„è®¾è®¡ï¼Œä¾èµ–äºä¸€ç§å«åšäº«å…ƒæ¨¡å¼çš„è®¾è®¡æ¨¡å¼ï¼ˆæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å»äº†è§£ä¸€ä¸‹æºç ï¼Œè¿™é‡Œä¸å¯¹è®¾è®¡æ¨¡å¼å±•å¼€è¯¦è¿°ï¼‰ã€‚</p>
<blockquote>
<p>ğŸ‘‰ æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dolphin0520/p/3780005.html">æ·±å…¥å‰–æ Java ä¸­çš„è£…ç®±å’Œæ‹†ç®± (opens new window)</a></p>
<p>ç»“åˆç¤ºä¾‹ï¼Œä¸€æ­¥æ­¥é˜è¿°è£…ç®±å’Œæ‹†ç®±åŸç†ã€‚</p>
</blockquote>
<h3 id="-10"><a class="markdownIt-Anchor" href="#-10">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_3-3-%E8%A3%85%E7%AE%B1%E3%80%81%E6%8B%86%E7%AE%B1%E7%9A%84%E5%BA%94%E7%94%A8%E5%92%8C%E6%B3%A8%E6%84%8F%E7%82%B9">#</a>3.3. è£…ç®±ã€æ‹†ç®±çš„åº”ç”¨å’Œæ³¨æ„ç‚¹</h3>
<h4 id="-11"><a class="markdownIt-Anchor" href="#-11">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#%E8%A3%85%E7%AE%B1%E3%80%81%E6%8B%86%E7%AE%B1%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">#</a>è£…ç®±ã€æ‹†ç®±åº”ç”¨åœºæ™¯</h4>
<ul>
<li>ä¸€ç§æœ€æ™®é€šçš„åœºæ™¯æ˜¯ï¼šè°ƒç”¨ä¸€ä¸ª<strong>å«ç±»å‹ä¸º  <code>Object</code>  å‚æ•°çš„æ–¹æ³•</strong>ï¼Œè¯¥  <code>Object</code>  å¯æ”¯æŒä»»æ„ç±»å‹ï¼ˆå› ä¸º  <code>Object</code>  æ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼‰ï¼Œä»¥ä¾¿é€šç”¨ã€‚å½“ä½ éœ€è¦å°†ä¸€ä¸ªå€¼ç±»å‹ï¼ˆå¦‚ intï¼‰ä¼ å…¥æ—¶ï¼Œéœ€è¦ä½¿ç”¨  <code>Integer</code>  è£…ç®±ã€‚</li>
<li>å¦ä¸€ç§ç”¨æ³•æ˜¯ï¼šä¸€ä¸ª<strong>éæ³›å‹çš„å®¹å™¨</strong>ï¼ŒåŒæ ·æ˜¯ä¸ºäº†ä¿è¯é€šç”¨ï¼Œè€Œå°†å…ƒç´ ç±»å‹å®šä¹‰ä¸º  <code>Object</code> ã€‚äºæ˜¯ï¼Œè¦å°†å€¼ç±»å‹æ•°æ®åŠ å…¥å®¹å™¨æ—¶ï¼Œéœ€è¦è£…ç®±ã€‚</li>
<li>å½“  <code>==</code>  è¿ç®—ç¬¦çš„ä¸¤ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ“ä½œæ•°æ˜¯åŒ…è£…ç±»ï¼Œå¦ä¸€ä¸ªæ“ä½œæ•°æ˜¯è¡¨è¾¾å¼ï¼ˆå³åŒ…å«ç®—æœ¯è¿ç®—ï¼‰åˆ™æ¯”è¾ƒçš„æ˜¯æ•°å€¼ï¼ˆå³ä¼šè§¦å‘è‡ªåŠ¨æ‹†ç®±çš„è¿‡ç¨‹ï¼‰ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘è£…ç®±ã€æ‹†ç®±ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> i1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªåŠ¨è£…ç®±</span>
<span class="token class-name">Integer</span> i2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éè‡ªåŠ¨è£…ç®±</span>
<span class="token class-name">Integer</span> i3 <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éè‡ªåŠ¨è£…ç®±</span>
<span class="token keyword">int</span> i4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªåŠ¨æ‹†ç®±</span>
<span class="token keyword">int</span> i5 <span class="token operator">=</span> i2<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// éè‡ªåŠ¨æ‹†ç®±</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i1 = ["</span> <span class="token operator">+</span> i1 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i2 = ["</span> <span class="token operator">+</span> i2 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i3 = ["</span> <span class="token operator">+</span> i3 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i4 = ["</span> <span class="token operator">+</span> i4 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i5 = ["</span> <span class="token operator">+</span> i5 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i1 == i2 is ["</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i1 <span class="token operator">==</span> i2<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"i1 == i4 is ["</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i1 <span class="token operator">==</span> i4<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªåŠ¨æ‹†ç®±</span>
<span class="token comment">// Output:</span>
<span class="token comment">// i1 = [10]</span>
<span class="token comment">// i2 = [10]</span>
<span class="token comment">// i3 = [10]</span>
<span class="token comment">// i4 = [10]</span>
<span class="token comment">// i5 = [10]</span>
<span class="token comment">// i1 == i2 is [false]</span>
<span class="token comment">// i1 == i4 is [true]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è¯´æ˜ã€‘</p>
<p>ä¸Šé¢çš„ä¾‹å­ï¼Œè™½ç„¶ç®€å•ï¼Œä½†å´éšè—äº†è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±å’Œéè‡ªåŠ¨è£…ç®±ã€æ‹†ç®±çš„åº”ç”¨ã€‚ä»ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ˜æ˜æ‰€æœ‰å˜é‡éƒ½åˆå§‹åŒ–ä¸ºæ•°å€¼ 10 äº†ï¼Œä½†ä¸ºä½•ä¼šå‡ºç°  <code>i1 == i2 is [false</code>  è€Œ  <code>i1 == i4 is [true]</code>  ï¼Ÿ</p>
<p>åŸå› åœ¨äºï¼š</p>
<ul>
<li>i1ã€i2 éƒ½æ˜¯åŒ…è£…ç±»ï¼Œä½¿ç”¨  <code>==</code>  æ—¶ï¼ŒJava å°†å®ƒä»¬å½“åšä¸¤ä¸ªå¯¹è±¡ï¼Œè€Œéä¸¤ä¸ª int å€¼æ¥æ¯”è¾ƒï¼Œæ‰€ä»¥ä¸¤ä¸ªå¯¹è±¡è‡ªç„¶æ˜¯ä¸ç›¸ç­‰çš„ã€‚æ­£ç¡®çš„æ¯”è¾ƒæ“ä½œåº”è¯¥ä½¿ç”¨  <code>equals</code>  æ–¹æ³•ã€‚</li>
<li>i1 æ˜¯åŒ…è£…ç±»ï¼Œi4 æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œä½¿ç”¨  <code>==</code>  æ—¶ï¼ŒJava ä¼šå°†ä¸¤ä¸ª i1 è¿™ä¸ªåŒ…è£…ç±»å¯¹è±¡è‡ªåŠ¨æ‹†ç®±ä¸ºä¸€ä¸ª  <code>int</code>  å€¼ï¼Œå†ä»£å…¥åˆ°  <code>==</code>  è¿ç®—è¡¨è¾¾å¼ä¸­è®¡ç®—ï¼›æœ€ç»ˆï¼Œç›¸å½“äºä¸¤ä¸ª  <code>int</code>  è¿›è¡Œæ¯”è¾ƒï¼Œç”±äºå€¼ç›¸åŒï¼Œæ‰€ä»¥ç»“æœç›¸ç­‰ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘åŒ…è£…ç±»åˆ¤ç­‰é—®é¢˜</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> a <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(127)</span>
<span class="token class-name">Integer</span> b <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(127)</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger a = 127;\nInteger b = 127;\na == b ? &#123;&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// true</span>

<span class="token class-name">Integer</span> c <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(128)</span>
<span class="token class-name">Integer</span> d <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(128)</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger c = 128;\nInteger d = 128;\nc == d ? &#123;&#125;"</span><span class="token punctuation">,</span> c <span class="token operator">==</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//false</span>
<span class="token comment">//è®¾ç½®-XX:AutoBoxCacheMax=1000å†è¯•è¯•</span>

<span class="token class-name">Integer</span> e <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(127)</span>
<span class="token class-name">Integer</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new instance</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger e = 127;\nInteger f = new Integer(127);\ne == f ? &#123;&#125;"</span><span class="token punctuation">,</span> e <span class="token operator">==</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//false</span>

<span class="token class-name">Integer</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new instance</span>
<span class="token class-name">Integer</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new instance</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger g = new Integer(127);\nInteger h = new Integer(127);\ng == h ? &#123;&#125;"</span><span class="token punctuation">,</span> g <span class="token operator">==</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//false</span>

<span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">//unbox</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger i = 128;\nint j = 128;\ni == j ? &#123;&#125;"</span><span class="token punctuation">,</span> i <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡è¿è¡Œç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶çœ‹èµ·æ¥æ°¸è¿œæ˜¯åœ¨å¯¹ 127 å’Œ 127ã€128 å’Œ 128 åˆ¤ç­‰ï¼Œä½† == å´å¹¶éæ€»æ˜¯è¿”å› trueã€‚</p>
<h4 id="-12"><a class="markdownIt-Anchor" href="#-12">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#%E8%A3%85%E7%AE%B1%E3%80%81%E6%8B%86%E7%AE%B1%E5%BA%94%E7%94%A8%E6%B3%A8%E6%84%8F%E7%82%B9">#</a>è£…ç®±ã€æ‹†ç®±åº”ç”¨æ³¨æ„ç‚¹</h4>
<ol>
<li>è£…ç®±æ“ä½œä¼šåˆ›å»ºå¯¹è±¡ï¼Œé¢‘ç¹çš„è£…ç®±æ“ä½œä¼šé€ æˆä¸å¿…è¦çš„å†…å­˜æ¶ˆè€—ï¼Œå½±å“æ€§èƒ½ã€‚æ‰€ä»¥<strong>åº”è¯¥å°½é‡é¿å…è£…ç®±ã€‚</strong></li>
<li>åŸºç¡€æ•°æ®ç±»å‹çš„æ¯”è¾ƒæ“ä½œä½¿ç”¨  <code>==</code> ï¼ŒåŒ…è£…ç±»çš„æ¯”è¾ƒæ“ä½œä½¿ç”¨  <code>equals</code>  æ–¹æ³•ã€‚</li>
</ol>
<h2 id="-13"><a class="markdownIt-Anchor" href="#-13">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_4-%E5%88%A4%E7%AD%89%E9%97%AE%E9%A2%98">#</a>4. åˆ¤ç­‰é—®é¢˜</h2>
<p>Java ä¸­ï¼Œé€šå¸¸ä½¿ç”¨  <code>equals</code>  æˆ–  <code>==</code>  è¿›è¡Œåˆ¤ç­‰æ“ä½œã€‚ <code>equals</code>  æ˜¯æ–¹æ³•è€Œ  <code>==</code>  æ˜¯æ“ä½œç¬¦ã€‚æ­¤å¤–ï¼ŒäºŒè€…ä½¿ç”¨ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ï¼š</p>
<ul>
<li>å¯¹<strong>åŸºæœ¬ç±»å‹</strong>ï¼Œæ¯”å¦‚  <code>int</code> ã€ <code>long</code> ï¼Œè¿›è¡Œåˆ¤ç­‰ï¼Œ<strong>åªèƒ½ä½¿ç”¨  <code>==</code> ï¼Œæ¯”è¾ƒçš„æ˜¯å­—é¢å€¼</strong>ã€‚å› ä¸ºåŸºæœ¬ç±»å‹çš„å€¼å°±æ˜¯å…¶æ•°å€¼ã€‚</li>
<li>å¯¹<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œæ¯”å¦‚  <code>Integer</code> ã€ <code>Long</code>  å’Œ  <code>String</code> ï¼Œè¿›è¡Œåˆ¤ç­‰ï¼Œ<strong>éœ€è¦ä½¿ç”¨  <code>equals</code>  è¿›è¡Œå†…å®¹åˆ¤ç­‰</strong>ã€‚å› ä¸ºå¼•ç”¨ç±»å‹çš„ç›´æ¥å€¼æ˜¯æŒ‡é’ˆï¼Œä½¿ç”¨  <code>==</code>  çš„è¯ï¼Œæ¯”è¾ƒçš„æ˜¯æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œå³æ¯”è¾ƒå®ƒä»¬æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ã€‚</li>
</ul>
<h3 id="-14"><a class="markdownIt-Anchor" href="#-14">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_4-1-%E5%8C%85%E8%A3%85%E7%B1%BB%E7%9A%84%E5%88%A4%E7%AD%89">#</a>4.1. åŒ…è£…ç±»çš„åˆ¤ç­‰</h3>
<p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ·±å…¥ç ”ç©¶ä¸€ä¸‹åˆ¤ç­‰é—®é¢˜ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åŒ…è£…ç±»çš„åˆ¤ç­‰</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span> a <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(127)</span>
<span class="token class-name">Integer</span> b <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(127)</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger a = 127;\nInteger b = 127;\na == b ? &#123;&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// true</span>

<span class="token class-name">Integer</span> c <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(128)</span>
<span class="token class-name">Integer</span> d <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(128)</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger c = 128;\nInteger d = 128;\nc == d ? &#123;&#125;"</span><span class="token punctuation">,</span> c <span class="token operator">==</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//false</span>
<span class="token comment">//è®¾ç½®-XX:AutoBoxCacheMax=1000å†è¯•è¯•</span>

<span class="token class-name">Integer</span> e <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span> <span class="token comment">//Integer.valueOf(127)</span>
<span class="token class-name">Integer</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new instance</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger e = 127;\nInteger f = new Integer(127);\ne == f ? &#123;&#125;"</span><span class="token punctuation">,</span> e <span class="token operator">==</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//false</span>

<span class="token class-name">Integer</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new instance</span>
<span class="token class-name">Integer</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//new instance</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger g = new Integer(127);\nInteger h = new Integer(127);\ng == h ? &#123;&#125;"</span><span class="token punctuation">,</span> g <span class="token operator">==</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//false</span>

<span class="token class-name">Integer</span> i <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token comment">//unbox</span>
<span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nInteger i = 128;\nint j = 128;\ni == j ? &#123;&#125;"</span><span class="token punctuation">,</span> i <span class="token operator">==</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¬¬ä¸€ä¸ªæ¡ˆä¾‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šæŠŠ Integer a = 127 è½¬æ¢ä¸º Integer.valueOf (127)ã€‚æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªè½¬æ¢åœ¨å†…éƒ¨å…¶å®åšäº†ç¼“å­˜ï¼Œä½¿å¾—ä¸¤ä¸ª Integer æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ == è¿”å› trueã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Integer</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>cache<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>low<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¬¬äºŒä¸ªæ¡ˆä¾‹ä¸­ï¼Œä¹‹æ‰€ä»¥åŒæ ·çš„ä»£ç  128 å°±è¿”å› false çš„åŸå› æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šç¼“å­˜ [-128,127] çš„æ•°å€¼ï¼Œè€Œ 128 å¤„äºè¿™ä¸ªåŒºé—´ä¹‹å¤–ã€‚è®¾ç½® JVM å‚æ•°åŠ ä¸Š -XX:AutoBoxCacheMax=1000 å†è¯•è¯•ï¼Œæ˜¯ä¸æ˜¯å°±è¿”å› true äº†å‘¢ï¼Ÿ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">IntegerCache</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> high<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> cache<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// high value may be configured by property</span>
        <span class="token keyword">int</span> h <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> integerCacheHighPropValue <span class="token operator">=</span>
            sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span>VM<span class="token punctuation">.</span><span class="token function">getSavedProperty</span><span class="token punctuation">(</span><span class="token string">"java.lang.Integer.IntegerCache.high"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>integerCacheHighPropValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>integerCacheHighPropValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                i <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Maximum array size is Integer.MAX_VALUE</span>
                h <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token operator">-</span>low<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span> <span class="token class-name">NumberFormatException</span> nfe<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// If the property cannot be parsed into an int, ignore it.</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        high <span class="token operator">=</span> h<span class="token punctuation">;</span>

        cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> low<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> cache<span class="token punctuation">.</span>length<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
            cache<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span>
        <span class="token keyword">assert</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">.</span>high <span class="token operator">>=</span> <span class="token number">127</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">IntegerCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¬¬ä¸‰å’Œç¬¬å››ä¸ªæ¡ˆä¾‹ä¸­ï¼ŒNew å‡ºæ¥çš„ Integer å§‹ç»ˆæ˜¯ä¸èµ°ç¼“å­˜çš„æ–°å¯¹è±¡ã€‚æ¯”è¾ƒä¸¤ä¸ªæ–°å¯¹è±¡ï¼Œæˆ–è€…æ¯”è¾ƒä¸€ä¸ªæ–°å¯¹è±¡å’Œä¸€ä¸ªæ¥è‡ªç¼“å­˜çš„å¯¹è±¡ï¼Œç»“æœè‚¯å®šä¸æ˜¯ç›¸åŒçš„å¯¹è±¡ï¼Œå› æ­¤è¿”å› falseã€‚</p>
<p>ç¬¬äº”ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬æŠŠè£…ç®±çš„ Integer å’ŒåŸºæœ¬ç±»å‹ int æ¯”è¾ƒï¼Œå‰è€…ä¼šå…ˆæ‹†ç®±å†æ¯”è¾ƒï¼Œæ¯”è¾ƒçš„è‚¯å®šæ˜¯æ•°å€¼è€Œä¸æ˜¯å¼•ç”¨ï¼Œå› æ­¤è¿”å› trueã€‚</p>
<blockquote>
<p>ã€æ€»ç»“ã€‘ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼š<strong>åŒ…è£…ç±»éœ€è¦ä½¿ç”¨  <code>equals</code>  è¿›è¡Œå†…å®¹åˆ¤ç­‰ï¼Œè€Œä¸èƒ½ä½¿ç”¨  <code>==</code> </strong>ã€‚</p>
</blockquote>
<h3 id="-15"><a class="markdownIt-Anchor" href="#-15">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_4-2-string-%E7%9A%84%E5%88%A4%E7%AD%89">#</a>4.2. String çš„åˆ¤ç­‰</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nString a = \"1\";\nString b = \"1\";\na == b ? &#123;&#125;"</span><span class="token punctuation">,</span> a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>

<span class="token class-name">String</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nString c = new String(\"2\");\nString d = new String(\"2\");\nc == d ? &#123;&#125;"</span><span class="token punctuation">,</span> c <span class="token operator">==</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>

<span class="token class-name">String</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nString e = new String(\"3\").intern();\nString f = new String(\"3\").intern();\ne == f ? &#123;&#125;"</span><span class="token punctuation">,</span> e <span class="token operator">==</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>

<span class="token class-name">String</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"\nString g = new String(\"4\");\nString h = new String(\"4\");\ng == h ? &#123;&#125;"</span><span class="token punctuation">,</span> g<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨ JVM ä¸­ï¼Œå½“ä»£ç ä¸­å‡ºç°åŒå¼•å·å½¢å¼åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼ŒJVM ä¼šå…ˆå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜åœ¨ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™å°†è¿™ä¸ªå¼•ç”¨è¿”å›ï¼›å¦åˆ™ï¼Œåˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åå°†è¿™ä¸ªå¼•ç”¨æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå¹¶è¿”å›è¯¥å¼•ç”¨ã€‚è¿™ç§æœºåˆ¶ï¼Œå°±æ˜¯å­—ç¬¦ä¸²é©»ç•™æˆ–æ± åŒ–ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ¡ˆä¾‹è¿”å› trueï¼Œå› ä¸º Java çš„å­—ç¬¦ä¸²é©»ç•™æœºåˆ¶ï¼Œç›´æ¥ä½¿ç”¨åŒå¼•å·å£°æ˜å‡ºæ¥çš„ä¸¤ä¸ª String å¯¹è±¡æŒ‡å‘å¸¸é‡æ± ä¸­çš„ç›¸åŒå­—ç¬¦ä¸²ã€‚</p>
<p>ç¬¬äºŒä¸ªæ¡ˆä¾‹ï¼Œnew å‡ºæ¥çš„ä¸¤ä¸ª String æ˜¯ä¸åŒå¯¹è±¡ï¼Œå¼•ç”¨å½“ç„¶ä¸åŒï¼Œæ‰€ä»¥å¾—åˆ° false çš„ç»“æœã€‚</p>
<p>ç¬¬ä¸‰ä¸ªæ¡ˆä¾‹ï¼Œä½¿ç”¨ String æä¾›çš„ intern æ–¹æ³•ä¹Ÿä¼šèµ°å¸¸é‡æ± æœºåˆ¶ï¼Œæ‰€ä»¥åŒæ ·èƒ½å¾—åˆ° trueã€‚</p>
<p>ç¬¬å››ä¸ªæ¡ˆä¾‹ï¼Œé€šè¿‡ equals å¯¹å€¼å†…å®¹åˆ¤ç­‰ï¼Œæ˜¯æ­£ç¡®çš„å¤„ç†æ–¹å¼ï¼Œå½“ç„¶ä¼šå¾—åˆ° trueã€‚</p>
<p>è™½ç„¶ä½¿ç”¨ new å£°æ˜çš„å­—ç¬¦ä¸²è°ƒç”¨ intern æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è®©å­—ç¬¦ä¸²è¿›è¡Œé©»ç•™ï¼Œä½†åœ¨ä¸šåŠ¡ä»£ç ä¸­æ»¥ç”¨ internï¼Œå¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘String#intern æ€§èƒ½æµ‹è¯•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//-XX:+PrintStringTableStatistics</span>
<span class="token comment">//-XX:StringTableSize=10000000</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"size:"</span> <span class="token operator">+</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"time:"</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„ç¤ºä¾‹æ‰§è¡Œæ—¶é—´ä¼šæ¯”è¾ƒé•¿ã€‚åŸå› åœ¨äºï¼šå­—ç¬¦ä¸²å¸¸é‡æ± æ˜¯ä¸€ä¸ªå›ºå®šå®¹é‡çš„ Mapã€‚å¦‚æœå®¹é‡å¤ªå°ï¼ˆNumber of buckets=60013ï¼‰ã€å­—ç¬¦ä¸²å¤ªå¤šï¼ˆ1000 ä¸‡ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªæ¡¶ä¸­çš„å­—ç¬¦ä¸²æ•°é‡ä¼šéå¸¸å¤šï¼Œæ‰€ä»¥æœç´¢èµ·æ¥å°±å¾ˆæ…¢ã€‚è¾“å‡ºç»“æœä¸­çš„ Average bucket size=167ï¼Œä»£è¡¨äº† Map ä¸­æ¡¶çš„å¹³å‡é•¿åº¦æ˜¯ 167ã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯ï¼šè®¾ç½® JVM å‚æ•° -XX:StringTableSize=10000000ï¼ŒæŒ‡å®šæ›´å¤šçš„æ¡¶ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿï¼Œå¯ä»¥åœ¨å¯åŠ¨ç¨‹åºæ—¶è®¾ç½® JVM å‚æ•° -XX:+PrintStringTableStatisticï¼Œç¨‹åºé€€å‡ºæ—¶å¯ä»¥æ‰“å°å‡ºå­—ç¬¦ä¸²å¸¸é‡è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>æ‰§è¡Œç»“æœæ¯”ä¸è®¾ç½® -XX:StringTableSize è¦å¿«å¾ˆå¤šã€‚</p>
<blockquote>
<p>ã€æ€»ç»“ã€‘<strong>æ²¡äº‹åˆ«è½»æ˜“ç”¨ internï¼Œå¦‚æœè¦ç”¨ä¸€å®šè¦æ³¨æ„æ§åˆ¶é©»ç•™çš„å­—ç¬¦ä¸²çš„æ•°é‡ï¼Œå¹¶ç•™æ„å¸¸é‡è¡¨çš„å„é¡¹æŒ‡æ ‡</strong>ã€‚</p>
</blockquote>
<h3 id="-16"><a class="markdownIt-Anchor" href="#-16">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_4-3-%E5%AE%9E%E7%8E%B0-equals">#</a>4.3. å®ç° equals</h3>
<p>å¦‚æœçœ‹è¿‡ Object ç±»æºç ï¼Œä½ å¯èƒ½å°±çŸ¥é“ï¼Œequals çš„å®ç°å…¶å®æ˜¯æ¯”è¾ƒå¯¹è±¡å¼•ç”¨</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä¹‹æ‰€ä»¥ Integer æˆ– String èƒ½é€šè¿‡ equals å®ç°å†…å®¹åˆ¤ç­‰ï¼Œæ˜¯å› ä¸ºå®ƒä»¬éƒ½è¦†å†™äº†è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œå¦‚æœä¸è¦†å†™ equals çš„è¯ï¼Œé»˜è®¤å°±æ˜¯ä½¿ç”¨ Object åŸºç±»çš„æŒ‰å¼•ç”¨çš„æ¯”è¾ƒæ–¹å¼ã€‚</p>
<p>å®ç°ä¸€ä¸ªæ›´å¥½çš„ equals åº”è¯¥æ³¨æ„çš„ç‚¹ï¼š</p>
<ul>
<li>è€ƒè™‘åˆ°æ€§èƒ½ï¼Œå¯ä»¥å…ˆè¿›è¡ŒæŒ‡é’ˆåˆ¤ç­‰ï¼Œå¦‚æœå¯¹è±¡æ˜¯åŒä¸€ä¸ªé‚£ä¹ˆç›´æ¥è¿”å› trueï¼›</li>
<li>éœ€è¦å¯¹å¦ä¸€æ–¹è¿›è¡Œåˆ¤ç©ºï¼Œç©ºå¯¹è±¡å’Œè‡ªèº«è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœä¸€å®šæ˜¯ fasleï¼›</li>
<li>éœ€è¦åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹ï¼Œå¦‚æœç±»å‹éƒ½ä¸åŒï¼Œé‚£ä¹ˆç›´æ¥è¿”å› falseï¼›</li>
<li>ç¡®ä¿ç±»å‹ç›¸åŒçš„æƒ…å†µä¸‹å†è¿›è¡Œç±»å‹å¼ºåˆ¶è½¬æ¢ï¼Œç„¶åé€ä¸€åˆ¤æ–­æ‰€æœ‰å­—æ®µã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘è‡ªå®šä¹‰ equals ç¤ºä¾‹</p>
<p>è‡ªå®šä¹‰ç±»ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> y<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> desc<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è‡ªå®šä¹‰ equalsï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">Point</span> that <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token operator">==</span> that<span class="token punctuation">.</span>x <span class="token operator">&amp;&amp;</span> y <span class="token operator">==</span> that<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-17"><a class="markdownIt-Anchor" href="#-17">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_4-4-hashcode-%E5%92%8C-equals-%E8%A6%81%E9%85%8D%E5%AF%B9%E5%AE%9E%E7%8E%B0">#</a>4.4. hashCode å’Œ equals è¦é…å¯¹å®ç°</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Point</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Point</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PointWrong</span><span class="token punctuation">></span></span> points <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
points<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"points.contains(p2) ? &#123;&#125;"</span><span class="token punctuation">,</span> points<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŒ‰ç…§æ”¹è¿›åçš„ equals æ–¹æ³•ï¼Œè¿™ 2 ä¸ªå¯¹è±¡å¯ä»¥è®¤ä¸ºæ˜¯åŒä¸€ä¸ªï¼ŒSet ä¸­å·²ç»å­˜åœ¨äº† p1 å°±åº”è¯¥åŒ…å« p2ï¼Œä½†ç»“æœå´æ˜¯ falseã€‚</p>
<p>å‡ºç°è¿™ä¸ª Bug çš„åŸå› æ˜¯ï¼Œæ•£åˆ—è¡¨éœ€è¦ä½¿ç”¨ hashCode æ¥å®šä½å…ƒç´ æ”¾åˆ°å“ªä¸ªæ¡¶ã€‚å¦‚æœè‡ªå®šä¹‰å¯¹è±¡æ²¡æœ‰å®ç°è‡ªå®šä¹‰çš„ hashCode æ–¹æ³•ï¼Œå°±ä¼šä½¿ç”¨ Object è¶…ç±»çš„é»˜è®¤å®ç°ï¼Œå¾—åˆ°çš„ä¸¤ä¸ª hashCode æ˜¯ä¸åŒçš„ï¼Œå¯¼è‡´æ— æ³•æ»¡è¶³éœ€æ±‚ã€‚</p>
<p>è¦è‡ªå®šä¹‰ hashCodeï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Objects.hash æ–¹æ³•æ¥å®ç°ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-18"><a class="markdownIt-Anchor" href="#-18">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_4-5-compareto-%E5%92%8C-equals-%E7%9A%84%E9%80%BB%E8%BE%91%E4%B8%80%E8%87%B4%E6%80%A7">#</a>4.5. compareTo å’Œ equals çš„é€»è¾‘ä¸€è‡´æ€§</h3>
<p>ã€ç¤ºä¾‹ã€‘è‡ªå®šä¹‰ compareTo å‡ºé”™ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Student</span> other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>id<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"this &#123;&#125; == other &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è°ƒç”¨ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"zhang"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"wang"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ArrayList.indexOf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> index1 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Collections.binarySearch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> index2 <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">binarySearch</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> student<span class="token punctuation">)</span><span class="token punctuation">;</span>

log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"index1 = "</span> <span class="token operator">+</span> index1<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"index2 = "</span> <span class="token operator">+</span> index2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>binarySearch æ–¹æ³•å†…éƒ¨è°ƒç”¨äº†å…ƒç´ çš„ compareTo æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼›</p>
<ul>
<li>indexOf çš„ç»“æœæ²¡é—®é¢˜ï¼Œåˆ—è¡¨ä¸­æœç´¢ä¸åˆ° id ä¸º 2ã€name æ˜¯ li çš„å­¦ç”Ÿï¼›</li>
<li>binarySearch è¿”å›äº†ç´¢å¼• 1ï¼Œä»£è¡¨æœç´¢åˆ°çš„ç»“æœæ˜¯ id ä¸º 2ï¼Œname æ˜¯ wang çš„å­¦ç”Ÿã€‚</li>
</ul>
<p>ä¿®å¤æ–¹å¼å¾ˆç®€å•ï¼Œç¡®ä¿ compareTo çš„æ¯”è¾ƒé€»è¾‘å’Œ equals çš„å®ç°ä¸€è‡´å³å¯ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">StudentRight</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">StudentRight</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">StudentRight</span> other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Comparator</span><span class="token punctuation">.</span><span class="token function">comparing</span><span class="token punctuation">(</span><span class="token class-name">StudentRight</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">thenComparingInt</span><span class="token punctuation">(</span><span class="token class-name">StudentRight</span><span class="token operator">::</span><span class="token function">getId</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-19"><a class="markdownIt-Anchor" href="#-19">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_4-6-%E5%B0%8F%E5%BF%83-lombok-%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%9A%84-%E5%9D%91">#</a>4.6. å°å¿ƒ Lombok ç”Ÿæˆä»£ç çš„ â€œå‘â€</h3>
<p>Lombok çš„ @Data æ³¨è§£ä¼šå¸®æˆ‘ä»¬å®ç° equals å’Œ hashcode æ–¹æ³•ï¼Œä½†æ˜¯æœ‰ç»§æ‰¿å…³ç³»æ—¶ï¼Œ Lombok è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•å¯èƒ½å°±ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„äº†ã€‚</p>
<p>@EqualsAndHashCode é»˜è®¤å®ç°æ²¡æœ‰ä½¿ç”¨çˆ¶ç±»å±æ€§ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½® callSuper å¼€å…³ä¸º trueï¼Œæ¥è¦†ç›–è¿™ç§é»˜è®¤è¡Œä¸ºã€‚</p>
<h2 id="-20"><a class="markdownIt-Anchor" href="#-20">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_5-%E6%95%B0%E5%80%BC%E8%AE%A1%E7%AE%97">#</a>5. æ•°å€¼è®¡ç®—</h2>
<h3 id="-21"><a class="markdownIt-Anchor" href="#-21">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_5-1-%E6%B5%AE%E7%82%B9%E6%95%B0%E8%AE%A1%E7%AE%97%E9%97%AE%E9%A2%98">#</a>5.1. æµ®ç‚¹æ•°è®¡ç®—é—®é¢˜</h3>
<p>è®¡ç®—æœºæ˜¯æŠŠæ•°å€¼ä¿å­˜åœ¨äº†å˜é‡ä¸­ï¼Œä¸åŒç±»å‹çš„æ•°å€¼å˜é‡èƒ½ä¿å­˜çš„æ•°å€¼èŒƒå›´ä¸åŒï¼Œå½“æ•°å€¼è¶…è¿‡ç±»å‹èƒ½è¡¨è¾¾çš„æ•°å€¼ä¸Šé™åˆ™ä¼šå‘ç”Ÿæº¢å‡ºé—®é¢˜ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.30000000000000004</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0.19999999999999996</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">4.015</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 401.49999999999994</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">123.3</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.2329999999999999</span>
<span class="token keyword">double</span> amount1 <span class="token operator">=</span> <span class="token number">2.15</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> amount2 <span class="token operator">=</span> <span class="token number">1.10</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>amount1 <span class="token operator">-</span> amount2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1.0499999999999998</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„å‡ ä¸ªç¤ºä¾‹ï¼Œè¾“å‡ºç»“æœå’Œæˆ‘ä»¬é¢„æœŸçš„å¾ˆä¸ä¸€æ ·ã€‚ä¸ºä»€ä¹ˆä¼šæ˜¯è¿™æ ·å‘¢ï¼Ÿ</p>
<p>å‡ºç°è¿™ç§é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ï¼Œè®¡ç®—æœºæ˜¯ä»¥äºŒè¿›åˆ¶å­˜å‚¨æ•°å€¼çš„ï¼Œæµ®ç‚¹æ•°ä¹Ÿä¸ä¾‹å¤–ã€‚Java é‡‡ç”¨äº† IEEE 754 æ ‡å‡†å®ç°æµ®ç‚¹æ•°çš„è¡¨è¾¾å’Œè¿ç®—ï¼Œä½ å¯ä»¥é€šè¿‡è¿™é‡ŒæŸ¥çœ‹æ•°å€¼è½¬åŒ–ä¸ºäºŒè¿›åˆ¶çš„ç»“æœã€‚</p>
<p>æ¯”å¦‚ï¼Œ0.1 çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 0.0 0011 0011 0011â€¦ ï¼ˆ0011 æ— é™å¾ªç¯)ï¼Œå†è½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯ 0.1000000000000000055511151231257827021181583404541015625ã€‚å¯¹äºè®¡ç®—æœºè€Œè¨€ï¼Œ0.1 æ— æ³•ç²¾ç¡®è¡¨è¾¾ï¼Œè¿™æ˜¯æµ®ç‚¹æ•°è®¡ç®—é€ æˆç²¾åº¦æŸå¤±çš„æ ¹æºã€‚</p>
<p><strong>æµ®ç‚¹æ•°æ— æ³•ç²¾ç¡®è¡¨è¾¾å’Œè¿ç®—çš„åœºæ™¯ï¼Œä¸€å®šè¦ä½¿ç”¨ BigDecimal ç±»å‹</strong>ã€‚</p>
<p>ä½¿ç”¨ BigDecimal æ—¶ï¼Œæœ‰ä¸ªç»†èŠ‚è¦æ ¼å¤–æ³¨æ„ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: 0.3000000000000000166533453693773481063544750213623046875</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: 0.1999999999999999555910790149937383830547332763671875</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">4.015</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: 401.49999999999996802557689079549163579940795898437500</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">123.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Output: 1.232999999999999971578290569595992565155029296875</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸ºä»€ä¹ˆè¾“å‡ºç»“æœä»ç„¶ä¸ç¬¦åˆé¢„æœŸå‘¢ï¼Ÿ</p>
<p><strong>ä½¿ç”¨ BigDecimal è¡¨ç¤ºå’Œè®¡ç®—æµ®ç‚¹æ•°ï¼Œä¸”åŠ¡å¿…ä½¿ç”¨å­—ç¬¦ä¸²çš„æ„é€ æ–¹æ³•æ¥åˆå§‹åŒ– BigDecimal</strong>ã€‚</p>
<h3 id="-22"><a class="markdownIt-Anchor" href="#-22">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_5-2-%E6%B5%AE%E7%82%B9%E6%95%B0%E7%B2%BE%E5%BA%A6%E5%92%8C%E6%A0%BC%E5%BC%8F%E5%8C%96">#</a>5.2. æµ®ç‚¹æ•°ç²¾åº¦å’Œæ ¼å¼åŒ–</h3>
<p><strong>æµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¹Ÿè¦é€šè¿‡ BigDecimal è¿›è¡Œ</strong>ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">wrong1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">double</span> num1 <span class="token operator">=</span> <span class="token number">3.35</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> num2 <span class="token operator">=</span> <span class="token number">3.35f</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%.1f"</span><span class="token punctuation">,</span> num1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.4</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%.1f"</span><span class="token punctuation">,</span> num2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.3</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">wrong2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">double</span> num1 <span class="token operator">=</span> <span class="token number">3.35</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> num2 <span class="token operator">=</span> <span class="token number">3.35f</span><span class="token punctuation">;</span>
    <span class="token class-name">DecimalFormat</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DecimalFormat</span><span class="token punctuation">(</span><span class="token string">"#.##"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    format<span class="token punctuation">.</span><span class="token function">setRoundingMode</span><span class="token punctuation">(</span><span class="token class-name">RoundingMode</span><span class="token punctuation">.</span>DOWN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.35</span>
    format<span class="token punctuation">.</span><span class="token function">setRoundingMode</span><span class="token punctuation">(</span><span class="token class-name">RoundingMode</span><span class="token punctuation">.</span>DOWN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>format<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.34</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">BigDecimal</span> num1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"3.35"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">BigDecimal</span> num2 <span class="token operator">=</span> num1<span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ROUND_DOWN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.3</span>
    <span class="token class-name">BigDecimal</span> num3 <span class="token operator">=</span> num1<span class="token punctuation">.</span><span class="token function">setScale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">.</span>ROUND_HALF_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.4</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-23"><a class="markdownIt-Anchor" href="#-23">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_5-3-bigdecimal-%E5%88%A4%E7%AD%89%E9%97%AE%E9%A2%98">#</a>5.3. BigDecimal åˆ¤ç­‰é—®é¢˜</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">wrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>BigDecimal çš„ equals æ–¹æ³•çš„æ³¨é‡Šä¸­è¯´æ˜äº†åŸå› ï¼Œequals æ¯”è¾ƒçš„æ˜¯ BigDecimal çš„ value å’Œ scaleï¼Œ1.0 çš„ scale æ˜¯ 1ï¼Œ1 çš„ scale æ˜¯ 0ï¼Œæ‰€ä»¥ç»“æœä¸€å®šæ˜¯ falseã€‚</p>
<p><strong>å¦‚æœæˆ‘ä»¬å¸Œæœ›åªæ¯”è¾ƒ BigDecimal çš„ valueï¼Œå¯ä»¥ä½¿ç”¨ compareTo æ–¹æ³•</strong>ã€‚</p>
<p>BigDecimal çš„ equals å’Œ hashCode æ–¹æ³•ä¼šåŒæ—¶è€ƒè™‘ value å’Œ scaleï¼Œå¦‚æœç»“åˆ HashSet æˆ– HashMap ä½¿ç”¨çš„è¯å°±å¯èƒ½ä¼šå‡ºç°éº»çƒ¦ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠå€¼ä¸º 1.0 çš„ BigDecimal åŠ å…¥ HashSetï¼Œç„¶ååˆ¤æ–­å…¶æ˜¯å¦å­˜åœ¨å€¼ä¸º 1 çš„ BigDecimalï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ falseã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigDecimal</span><span class="token punctuation">></span></span> hashSet1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashSet1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hashSet1<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿”å›false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>è§£å†³åŠæ³•æœ‰ä¸¤ä¸ªï¼š</p>
<p>ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œä½¿ç”¨ TreeSet æ›¿æ¢ HashSetã€‚TreeSet ä¸ä½¿ç”¨ hashCode æ–¹æ³•ï¼Œä¹Ÿä¸ä½¿ç”¨ equals æ¯”è¾ƒå…ƒç´ ï¼Œè€Œæ˜¯ä½¿ç”¨ compareTo æ–¹æ³•ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ã€‚</p>
<p>ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ï¼ŒæŠŠ BigDecimal å­˜å…¥ HashSet æˆ– HashMap å‰ï¼Œå…ˆä½¿ç”¨ stripTrailingZeros æ–¹æ³•å»æ‰å°¾éƒ¨çš„é›¶ï¼Œæ¯”è¾ƒçš„æ—¶å€™ä¹Ÿå»æ‰å°¾éƒ¨çš„ 0ï¼Œç¡®ä¿ value ç›¸åŒçš„ BigDecimalï¼Œscale ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigDecimal</span><span class="token punctuation">></span></span> hashSet2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hashSet2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stripTrailingZeros</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hashSet2<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1.000"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stripTrailingZeros</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿”å›true</span>

<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BigDecimal</span><span class="token punctuation">></span></span> treeSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
treeSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>treeSet<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿”å›true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-24"><a class="markdownIt-Anchor" href="#-24">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-data-type.html#_5-4-%E6%95%B0%E5%80%BC%E6%BA%A2%E5%87%BA">#</a>5.4. æ•°å€¼æº¢å‡º</h3>
<p>æ•°å€¼è®¡ç®—è¿˜æœ‰ä¸€ä¸ªè¦å°å¿ƒçš„ç‚¹æ˜¯æº¢å‡ºï¼Œä¸ç®¡æ˜¯ int è¿˜æ˜¯ longï¼Œæ‰€æœ‰çš„åŸºæœ¬æ•°å€¼ç±»å‹éƒ½æœ‰è¶…å‡ºè¡¨è¾¾èŒƒå›´çš„å¯èƒ½æ€§ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -9223372036854775808</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>l <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>æ˜¾ç„¶è¿™æ˜¯å‘ç”Ÿäº†æº¢å‡ºï¼Œè€Œä¸”æ˜¯é»˜é»˜çš„æº¢å‡ºï¼Œå¹¶æ²¡æœ‰ä»»ä½•å¼‚å¸¸</strong>ã€‚è¿™ç±»é—®é¢˜éå¸¸å®¹æ˜“è¢«å¿½ç•¥ï¼Œæ”¹è¿›æ–¹å¼æœ‰ä¸‹é¢ 2 ç§ã€‚</p>
<p>æ–¹æ³•ä¸€æ˜¯ï¼Œè€ƒè™‘ä½¿ç”¨ Math ç±»çš„ addExactã€subtractExact ç­‰ xxExact æ–¹æ³•è¿›è¡Œæ•°å€¼è¿ç®—ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥åœ¨æ•°å€¼æº¢å‡ºæ—¶ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">addExact</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ–¹æ³•äºŒæ˜¯ï¼Œä½¿ç”¨å¤§æ•°ç±» BigIntegerã€‚BigDecimal æ˜¯å¤„ç†æµ®ç‚¹æ•°çš„ä¸“å®¶ï¼Œè€Œ BigInteger åˆ™æ˜¯å¯¹å¤§æ•°è¿›è¡Œç§‘å­¦è®¡ç®—çš„ä¸“å®¶ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">BigInteger</span> i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span>ONE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">long</span> l <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">BigInteger</span><span class="token punctuation">.</span>ONE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValueExact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-string-ç±»å‹"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-string-ç±»å‹">#</a> æ·±å…¥ç†è§£ Java String ç±»å‹</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>String ç±»å‹å¯èƒ½æ˜¯ Java ä¸­åº”ç”¨æœ€é¢‘ç¹çš„å¼•ç”¨ç±»å‹ï¼Œä½†å®ƒçš„æ€§èƒ½é—®é¢˜å´å¸¸å¸¸è¢«å¿½ç•¥ã€‚é«˜æ•ˆçš„ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œå¯ä»¥æå‡ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚å½“ç„¶ï¼Œè¦åšåˆ°é«˜æ•ˆä½¿ç”¨å­—ç¬¦ä¸²ï¼Œéœ€è¦æ·±å…¥äº†è§£å…¶ç‰¹æ€§ã€‚</p>
</blockquote>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#1-string-%E7%9A%84%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7">1. String çš„ä¸å¯å˜æ€§</a></p>
</li>
<li>
<ol start="2">
<li>String çš„æ€§èƒ½è€ƒé‡</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#21-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5">2.1. å­—ç¬¦ä¸²æ‹¼æ¥</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#22-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%86%E5%89%B2">2.2. å­—ç¬¦ä¸²åˆ†å‰²</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#23-stringintern">2.3. String.intern</a></li>
</ul>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#3-stringstringbufferstringbuilder-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">3. Stringã€StringBufferã€StringBuilder æœ‰ä»€ä¹ˆåŒºåˆ«</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#4-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">4. å‚è€ƒèµ„æ–™</a></p>
</li>
</ul>
<h2 id="-25"><a class="markdownIt-Anchor" href="#-25">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#_1-string-%E7%9A%84%E4%B8%8D%E5%8F%AF%E5%8F%98%E6%80%A7">#</a>1. String çš„ä¸å¯å˜æ€§</h2>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹  <code>String</code>  çš„å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">String</span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">CharSequence</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/** The value is used for character storage. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">char</span> value<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>String</code>  ç±»è¢«  <code>final</code>  å…³é”®å­—ä¿®é¥°ï¼Œè¡¨ç¤º<strong>ä¸å¯ç»§æ‰¿  <code>String</code>  ç±»</strong>ã€‚</p>
<p><code>String</code>  ç±»çš„æ•°æ®å­˜å‚¨äº  <code>char[]</code>  æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„è¢«  <code>final</code>  å…³é”®å­—ä¿®é¥°ï¼Œè¡¨ç¤º <strong> <code>String</code>  å¯¹è±¡ä¸å¯è¢«æ›´æ”¹</strong>ã€‚</p>
<p>ä¸ºä»€ä¹ˆ Java è¦è¿™æ ·è®¾è®¡ï¼Ÿ</p>
<p>ï¼ˆ1ï¼‰<strong>ä¿è¯ String å¯¹è±¡å®‰å…¨æ€§</strong>ã€‚é¿å… String è¢«ç¯¡æ”¹ã€‚</p>
<p>ï¼ˆ2ï¼‰<strong>ä¿è¯ hash å€¼ä¸ä¼šé¢‘ç¹å˜æ›´</strong>ã€‚</p>
<p>ï¼ˆ3ï¼‰<strong>å¯ä»¥å®ç°å­—ç¬¦ä¸²å¸¸é‡æ± </strong>ã€‚é€šå¸¸æœ‰ä¸¤ç§åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡å­—ç¬¦ä¸²å¸¸é‡çš„æ–¹å¼åˆ›å»ºï¼Œå¦‚  <code>String str=&quot;abc&quot;;</code>  å¦ä¸€ç§æ˜¯å­—ç¬¦ä¸²å˜é‡é€šè¿‡ new å½¢å¼çš„åˆ›å»ºï¼Œå¦‚  <code>String str = new String(&quot;abc&quot;)</code> ã€‚</p>
<p>ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼ŒJVM é¦–å…ˆä¼šæ£€æŸ¥è¯¥å¯¹è±¡æ˜¯å¦åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¦‚æœåœ¨ï¼Œå°±è¿”å›è¯¥å¯¹è±¡å¼•ç”¨ï¼Œå¦åˆ™æ–°çš„å­—ç¬¦ä¸²å°†åœ¨å¸¸é‡æ± ä¸­è¢«åˆ›å»ºã€‚è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘åŒä¸€ä¸ªå€¼çš„å­—ç¬¦ä¸²å¯¹è±¡çš„é‡å¤åˆ›å»ºï¼ŒèŠ‚çº¦å†…å­˜ã€‚</p>
<p><code>String str = new String(&quot;abc&quot;)</code>  è¿™ç§æ–¹å¼ï¼Œé¦–å…ˆåœ¨ç¼–è¯‘ç±»æ–‡ä»¶æ—¶ï¼Œ <code>&quot;abc&quot;</code>  å¸¸é‡å­—ç¬¦ä¸²å°†ä¼šæ”¾å…¥åˆ°å¸¸é‡ç»“æ„ä¸­ï¼Œåœ¨ç±»åŠ è½½æ—¶ï¼Œ <code>&quot;abc&quot;</code>  å°†ä¼šåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºï¼›å…¶æ¬¡ï¼Œåœ¨è°ƒç”¨ new æ—¶ï¼ŒJVM å‘½ä»¤å°†ä¼šè°ƒç”¨  <code>String</code>  çš„æ„é€ å‡½æ•°ï¼ŒåŒæ—¶å¼•ç”¨å¸¸é‡æ± ä¸­çš„  <code>&quot;abc&quot;</code>  å­—ç¬¦ä¸²ï¼Œåœ¨å †å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ª  <code>String</code>  å¯¹è±¡ï¼›æœ€åï¼Œstr å°†å¼•ç”¨  <code>String</code>  å¯¹è±¡ã€‚</p>
<h2 id="-26"><a class="markdownIt-Anchor" href="#-26">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#_2-string-%E7%9A%84%E6%80%A7%E8%83%BD%E8%80%83%E9%87%8F">#</a>2. String çš„æ€§èƒ½è€ƒé‡</h2>
<h3 id="-27"><a class="markdownIt-Anchor" href="#-27">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#_2-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5">#</a>2.1. å­—ç¬¦ä¸²æ‹¼æ¥</h3>
<p><strong>å­—ç¬¦ä¸²å¸¸é‡çš„æ‹¼æ¥ï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶ä¼˜åŒ–ä¸ºä¸€ä¸ªå¸¸é‡å­—ç¬¦ä¸²</strong>ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘å­—ç¬¦ä¸²å¸¸é‡æ‹¼æ¥</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æœ¬è¡Œä»£ç åœ¨ class æ–‡ä»¶ä¸­ï¼Œä¼šè¢«ç¼–è¯‘å™¨ç›´æ¥ä¼˜åŒ–ä¸ºï¼š</span>
    <span class="token comment">// String str = "abc";</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"a"</span> <span class="token operator">+</span> <span class="token string">"b"</span> <span class="token operator">+</span> <span class="token string">"c"</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"str = "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>å­—ç¬¦ä¸²å˜é‡çš„æ‹¼æ¥ï¼Œç¼–è¯‘å™¨ä¼šä¼˜åŒ–æˆ  <code>StringBuilder</code>  çš„æ–¹å¼</strong>ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘å­—ç¬¦ä¸²å˜é‡çš„æ‹¼æ¥</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æœ¬è¡Œä»£ç ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ä¸ºï¼š</span>
        <span class="token comment">// str = (new StringBuilder(String.valueOf(str))).append(i).toString();</span>
        str <span class="token operator">=</span> str <span class="token operator">+</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½†æ˜¯ï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„  <code>StringBuilder</code>  å®ä¾‹ï¼ŒåŒæ ·ä¹Ÿä¼šé™ä½ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p>
<p>å­—ç¬¦ä¸²æ‹¼æ¥çš„æ­£ç¡®æ–¹æ¡ˆï¼š</p>
<ul>
<li>å¦‚æœéœ€è¦ä½¿ç”¨<strong>å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘  <code>StringBuilder</code>  çš„  <code>append</code>  æ–¹æ³•æ›¿ä»£ä½¿ç”¨  <code>+</code>  å·</strong>ã€‚</li>
<li>å¦‚æœåœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ <code>String</code>  å¯¹è±¡çš„æ‹¼æ¥æ¶‰åŠåˆ°çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨  <code>StringBuffer</code> ã€‚ä½†æ˜¯è¦æ³¨æ„ï¼Œç”±äº  <code>StringBuffer</code>  æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¶‰åŠåˆ°é”ç«äº‰ï¼Œæ‰€ä»¥ä»æ€§èƒ½ä¸Šæ¥è¯´ï¼Œè¦æ¯”  <code>StringBuilder</code>  å·®ä¸€äº›ã€‚</li>
</ul>
<h3 id="-28"><a class="markdownIt-Anchor" href="#-28">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#_2-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%86%E5%89%B2">#</a>2.2. å­—ç¬¦ä¸²åˆ†å‰²</h3>
<p><strong> <code>String</code>  çš„  <code>split()</code>  æ–¹æ³•ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°å…¶å¼ºå¤§çš„åˆ†å‰²åŠŸèƒ½</strong>ã€‚è€Œæ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½æ˜¯éå¸¸ä¸ç¨³å®šçš„ï¼Œä½¿ç”¨ä¸æ°å½“ä¼šå¼•èµ·å›æº¯é—®é¢˜ï¼Œå¾ˆå¯èƒ½å¯¼è‡´ CPU å±…é«˜ä¸ä¸‹ã€‚</p>
<p>æ‰€ä»¥ï¼Œåº”è¯¥æ…é‡ä½¿ç”¨  <code>split()</code>  æ–¹æ³•ï¼Œ<strong>å¯ä»¥è€ƒè™‘ç”¨  <code>String.indexOf()</code>  æ–¹æ³•ä»£æ›¿  <code>split()</code>  æ–¹æ³•å®Œæˆå­—ç¬¦ä¸²çš„åˆ†å‰²</strong>ã€‚å¦‚æœå®åœ¨æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œä½ å°±åœ¨ä½¿ç”¨ Split () æ–¹æ³•æ—¶ï¼Œå¯¹å›æº¯é—®é¢˜åŠ ä»¥é‡è§†å°±å¯ä»¥äº†ã€‚</p>
<h3 id="-29"><a class="markdownIt-Anchor" href="#-29">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#_2-3-string-intern">#</a>2.3. String.intern</h3>
<p><strong>åœ¨æ¯æ¬¡èµ‹å€¼çš„æ—¶å€™ä½¿ç”¨  <code>String</code>  çš„  <code>intern</code>  æ–¹æ³•ï¼Œå¦‚æœå¸¸é‡æ± ä¸­æœ‰ç›¸åŒå€¼ï¼Œå°±ä¼šé‡å¤ä½¿ç”¨è¯¥å¯¹è±¡ï¼Œè¿”å›å¯¹è±¡å¼•ç”¨ï¼Œè¿™æ ·ä¸€å¼€å§‹çš„å¯¹è±¡å°±å¯ä»¥è¢«å›æ”¶æ‰</strong>ã€‚</p>
<p>åœ¨å­—ç¬¦ä¸²å¸¸é‡ä¸­ï¼Œé»˜è®¤ä¼šå°†å¯¹è±¡æ”¾å…¥å¸¸é‡æ± ï¼›åœ¨å­—ç¬¦ä¸²å˜é‡ä¸­ï¼Œå¯¹è±¡æ˜¯ä¼šåˆ›å»ºåœ¨å †å†…å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¼šåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¤åˆ¶åˆ°å †å†…å­˜å¯¹è±¡ä¸­ï¼Œå¹¶è¿”å›å †å†…å­˜å¯¹è±¡å¼•ç”¨ã€‚</p>
<p>å¦‚æœè°ƒç”¨  <code>intern</code>  æ–¹æ³•ï¼Œä¼šå»æŸ¥çœ‹å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰ç­‰äºè¯¥å¯¹è±¡çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±åœ¨å¸¸é‡æ± ä¸­æ–°å¢è¯¥å¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡å¼•ç”¨ï¼›å¦‚æœæœ‰ï¼Œå°±è¿”å›å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¼•ç”¨ã€‚å †å†…å­˜ä¸­åŸæœ‰çš„å¯¹è±¡ç”±äºæ²¡æœ‰å¼•ç”¨æŒ‡å‘å®ƒï¼Œå°†ä¼šé€šè¿‡åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SharedLocation</span> <span class="token punctuation">&#123;</span>

	<span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> region<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> countryCode<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">SharedLocation</span> sharedLocation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SharedLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sharedLocation<span class="token punctuation">.</span><span class="token function">setCity</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">.</span><span class="token function">getCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		sharedLocation<span class="token punctuation">.</span><span class="token function">setCountryCode</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">.</span><span class="token function">getRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sharedLocation<span class="token punctuation">.</span><span class="token function">setRegion</span><span class="token punctuation">(</span>messageInfo<span class="token punctuation">.</span><span class="token function">getCountryCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intern</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ä½¿ç”¨  <code>intern</code>  æ–¹æ³•éœ€è¦æ³¨æ„ï¼šä¸€å®šè¦ç»“åˆå®é™…åœºæ™¯ã€‚å› ä¸ºå¸¸é‡æ± çš„å®ç°æ˜¯ç±»ä¼¼äºä¸€ä¸ª HashTable çš„å®ç°æ–¹å¼ï¼ŒHashTable å­˜å‚¨çš„æ•°æ®è¶Šå¤§ï¼Œéå†çš„æ—¶é—´å¤æ‚åº¦å°±ä¼šå¢åŠ ã€‚å¦‚æœæ•°æ®è¿‡å¤§ï¼Œä¼šå¢åŠ æ•´ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± çš„è´Ÿæ‹…ã€‚</p>
</blockquote>
<h2 id="-30"><a class="markdownIt-Anchor" href="#-30">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-string.html#_3-string%E3%80%81stringbuffer%E3%80%81stringbuilder-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">#</a>3. Stringã€StringBufferã€StringBuilder æœ‰ä»€ä¹ˆåŒºåˆ«</h2>
<p><code>String</code>  æ˜¯ Java è¯­è¨€éå¸¸åŸºç¡€å’Œé‡è¦çš„ç±»ï¼Œæä¾›äº†æ„é€ å’Œç®¡ç†å­—ç¬¦ä¸²çš„å„ç§åŸºæœ¬é€»è¾‘ã€‚å®ƒæ˜¯å…¸å‹çš„  <code>Immutable</code>  ç±»ï¼Œè¢«å£°æ˜æˆä¸º  <code>final class</code> ï¼Œæ‰€æœ‰å±æ€§ä¹Ÿéƒ½æ˜¯  <code>final</code>  çš„ã€‚ä¹Ÿç”±äºå®ƒçš„ä¸å¯å˜æ€§ï¼Œç±»ä¼¼æ‹¼æ¥ã€è£å‰ªå­—ç¬¦ä¸²ç­‰åŠ¨ä½œï¼Œéƒ½ä¼šäº§ç”Ÿæ–°çš„  <code>String</code>  å¯¹è±¡ã€‚ç”±äºå­—ç¬¦ä¸²æ“ä½œçš„æ™®éæ€§ï¼Œæ‰€ä»¥ç›¸å…³æ“ä½œçš„æ•ˆç‡å¾€å¾€å¯¹åº”ç”¨æ€§èƒ½æœ‰æ˜æ˜¾å½±å“ã€‚</p>
<p><code>StringBuffer</code>  æ˜¯ä¸ºè§£å†³ä¸Šé¢æåˆ°æ‹¼æ¥äº§ç”Ÿå¤ªå¤šä¸­é—´å¯¹è±¡çš„é—®é¢˜è€Œæä¾›çš„ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨  <code>append</code>  æˆ–è€…  <code>add</code>  æ–¹æ³•ï¼ŒæŠŠå­—ç¬¦ä¸²æ·»åŠ åˆ°å·²æœ‰åºåˆ—çš„æœ«å°¾æˆ–è€…æŒ‡å®šä½ç½®ã€‚ <code>StringBuffer</code>  æ˜¯ä¸€ä¸ª<strong>çº¿ç¨‹å®‰å…¨çš„</strong>å¯ä¿®æ”¹å­—ç¬¦åºåˆ—ã€‚ <code>StringBuffer</code>  çš„çº¿ç¨‹å®‰å…¨æ˜¯é€šè¿‡åœ¨å„ç§ä¿®æ”¹æ•°æ®çš„æ–¹æ³•ä¸Šç”¨  <code>synchronized</code>  å…³é”®å­—ä¿®é¥°å®ç°çš„ã€‚</p>
<p><code>StringBuilder</code>  æ˜¯ Java 1.5 ä¸­æ–°å¢çš„ï¼Œåœ¨èƒ½åŠ›ä¸Šå’Œ StringBuffer æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œä½†æ˜¯å®ƒå»æ‰äº†çº¿ç¨‹å®‰å…¨çš„éƒ¨åˆ†ï¼Œæœ‰æ•ˆå‡å°äº†å¼€é”€ï¼Œæ˜¯ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥çš„é¦–é€‰ã€‚</p>
<p><code>StringBuffer</code>  å’Œ  <code>StringBuilder</code>  åº•å±‚éƒ½æ˜¯åˆ©ç”¨å¯ä¿®æ”¹çš„ï¼ˆcharï¼ŒJDK 9 ä»¥åæ˜¯ byteï¼‰æ•°ç»„ï¼ŒäºŒè€…éƒ½ç»§æ‰¿äº†  <code>AbstractStringBuilder</code> ï¼Œé‡Œé¢åŒ…å«äº†åŸºæœ¬æ“ä½œï¼ŒåŒºåˆ«ä»…åœ¨äºæœ€ç»ˆçš„æ–¹æ³•æ˜¯å¦åŠ äº†  <code>synchronized</code> ã€‚æ„å»ºæ—¶åˆå§‹å­—ç¬¦ä¸²é•¿åº¦åŠ  16ï¼ˆè¿™æ„å‘³ç€ï¼Œå¦‚æœæ²¡æœ‰æ„å»ºå¯¹è±¡æ—¶è¾“å…¥æœ€åˆçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆåˆå§‹å€¼å°±æ˜¯ 16ï¼‰ã€‚æˆ‘ä»¬å¦‚æœç¡®å®šæ‹¼æ¥ä¼šå‘ç”Ÿéå¸¸å¤šæ¬¡ï¼Œè€Œä¸”å¤§æ¦‚æ˜¯å¯é¢„è®¡çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‡å®šåˆé€‚çš„å¤§å°ï¼Œé¿å…å¾ˆå¤šæ¬¡æ‰©å®¹çš„å¼€é”€ã€‚æ‰©å®¹ä¼šäº§ç”Ÿå¤šé‡å¼€é”€ï¼Œå› ä¸ºè¦æŠ›å¼ƒåŸæœ‰æ•°ç»„ï¼Œåˆ›å»ºæ–°çš„ï¼ˆå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯å€æ•°ï¼‰æ•°ç»„ï¼Œè¿˜è¦è¿›è¡Œ  <code>arraycopy</code> ã€‚</p>
<p><strong>é™¤éæœ‰çº¿ç¨‹å®‰å…¨çš„éœ€è¦ï¼Œä¸ç„¶ä¸€èˆ¬éƒ½ä½¿ç”¨  <code>StringBuilder</code> </strong></p>
<hr>
<h1 id="java-é¢å‘å¯¹è±¡"><a class="markdownIt-Anchor" href="#java-é¢å‘å¯¹è±¡">#</a> Java é¢å‘å¯¹è±¡</h1>
<blockquote>
<p>åœ¨<a target="_blank" rel="noopener" href="https://github.com/dunwu/blog/blob/master/source/_posts/programming/java/javacore/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.md">æ·±å…¥ç†è§£ Java åŸºæœ¬æ•°æ®ç±»å‹ (opens new window)</a> ä¸­æˆ‘ä»¬äº†è§£ Java ä¸­æ”¯æŒçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå€¼ç±»å‹ï¼‰ã€‚æœ¬æ–‡å¼€å§‹è®²è§£ Java ä¸­é‡è¦çš„å¼•ç”¨ç±»å‹ â€”â€” ç±»ã€‚</p>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>
<ol>
<li>é¢å‘å¯¹è±¡</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#11-%E5%B0%81%E8%A3%85">1.1. å°è£…</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#12-%E7%BB%A7%E6%89%BF">1.2. ç»§æ‰¿</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#13-%E5%A4%9A%E6%80%81">1.3. å¤šæ€</a></li>
</ul>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#2-%E7%B1%BB">2. ç±»</a></p>
</li>
<li>
<ol start="3">
<li>æ–¹æ³•</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#31-%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89">3.1. æ–¹æ³•å®šä¹‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#32-%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8">3.2. æ–¹æ³•è°ƒç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#33-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">3.3. æ„é€ æ–¹æ³•</a></li>
</ul>
</li>
<li>
<ol start="4">
<li>å˜é‡</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#41-%E5%8F%98%E9%87%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6">4.1. å˜é‡ä¿®é¥°ç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#42-%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1">4.2. åˆ›å»ºå¯¹è±¡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#43-%E8%AE%BF%E9%97%AE%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%92%8C%E6%96%B9%E6%B3%95">4.3. è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•</a></li>
</ul>
</li>
<li>
<ol start="5">
<li>è®¿é—®æƒé™æ§åˆ¶</li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#51-%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87">5.1. ä»£ç ç»„ç»‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#52-%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E5%85%B3%E9%94%AE%E5%AD%97">5.2. è®¿é—®æƒé™ä¿®é¥°å…³é”®å­—</a></li>
</ul>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#6-%E6%8E%A5%E5%8F%A3">6. æ¥å£</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#7-%E6%8A%BD%E8%B1%A1%E7%B1%BB">7. æŠ½è±¡ç±»</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#8-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">8. å‚è€ƒèµ„æ–™</a></p>
</li>
</ul>
<h2 id="-31"><a class="markdownIt-Anchor" href="#-31">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_1-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1">#</a>1. é¢å‘å¯¹è±¡</h2>
<p>æ¯ç§ç¼–ç¨‹è¯­è¨€ï¼Œéƒ½æœ‰è‡ªå·±çš„æ“çºµå†…å­˜ä¸­å…ƒç´ çš„æ–¹å¼ã€‚</p>
<p>Java ä¸­æä¾›äº†<a target="_blank" rel="noopener" href="https://github.com/dunwu/blog/blob/master/source/_posts/programming/java/javacore/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.md">åŸºæœ¬æ•°æ®ç±»å‹ (opens new window)</a>ï¼Œä½†è¿™è¿˜ä¸èƒ½æ»¡è¶³ç¼–å†™ç¨‹åºæ—¶ï¼Œéœ€è¦æŠ½è±¡æ›´åŠ å¤æ‚æ•°æ®ç±»å‹çš„éœ€è¦ã€‚å› æ­¤ï¼ŒJava ä¸­ï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ç±»ï¼ˆç±»çš„æœºåˆ¶ä¸‹é¢ä¼šè®²åˆ°ï¼‰åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚</p>
<p>æœ‰äº†è‡ªå®šä¹‰ç±»å‹ï¼Œé‚£ä¹ˆæ•°æ®ç±»å‹è‡ªç„¶ä¼šåƒå˜ä¸‡åŒ–ï¼Œæ‰€ä»¥ï¼Œå¿…é¡»è¦æœ‰ä¸€å®šçš„æœºåˆ¶ï¼Œä½¿å¾—å®ƒä»¬ä»ç„¶ä¿æŒä¸€äº›å¿…è¦çš„ã€é€šç”¨çš„ç‰¹æ€§ã€‚</p>
<p>Java ä¸–ç•Œæœ‰ä¸€å¥åè¨€ï¼šä¸€åˆ‡çš†ä¸ºå¯¹è±¡ã€‚è¿™å¥è¯ï¼Œä½ å¯èƒ½ç¬¬ä¸€å¤©å­¦ Java æ—¶ï¼Œå°±å¬è¿‡äº†ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€å¥å£å·ï¼Œä¹Ÿä½“ç°åœ¨ Java çš„è®¾è®¡ä¸Šã€‚</p>
<ul>
<li>é¦–å…ˆï¼Œæ‰€æœ‰ Java ç±»éƒ½ç»§æ‰¿è‡ª  <code>Object</code>  ç±»ï¼ˆä»è¿™ä¸ªåå­—ï¼Œå°±å¯è§ä¸€æ–‘ï¼‰ã€‚</li>
<li>å‡ ä¹æ‰€æœ‰ Java å¯¹è±¡åˆå§‹åŒ–æ—¶ï¼Œéƒ½è¦ä½¿ç”¨  <code>new</code>  åˆ›å»ºå¯¹è±¡ï¼ˆ<a target="_blank" rel="noopener" href="https://github.com/dunwu/blog/blob/master/source/_posts/programming/java/javacore/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Java%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.md">åŸºæœ¬æ•°æ®ç±»å‹ (opens new window)</a>ã€Stringã€æšä¸¾ç‰¹æ®Šå¤„ç†ï¼‰ï¼Œå¯¹è±¡å­˜å‚¨åœ¨å †ä¸­ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¸‹é¢ä¸¤</span>
<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­ï¼Œ <code>String s</code>  å®šä¹‰äº†ä¸€ä¸ªåä¸º s çš„å¼•ç”¨ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ª  <code>String</code>  ç±»å‹çš„å¯¹è±¡ï¼Œè€Œå®é™…çš„å¯¹è±¡æ˜¯  <code>â€œabcâ€</code>  å­—ç¬¦ä¸²ã€‚è¿™å°±åƒæ˜¯ï¼Œä½¿ç”¨é¥æ§å™¨ï¼ˆå¼•ç”¨ï¼‰æ¥æ“çºµç”µè§†æœºï¼ˆå¯¹è±¡ï¼‰ã€‚</p>
<p>ä¸ C/C++ è¿™ç±»è¯­è¨€ä¸åŒï¼Œç¨‹åºå‘˜åªéœ€è¦é€šè¿‡  <code>new</code>  åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä½†ä¸å¿…è´Ÿè´£é”€æ¯æˆ–ç»“æŸä¸€ä¸ªå¯¹è±¡ã€‚è´Ÿè´£è¿è¡Œ Java ç¨‹åºçš„ Java è™šæ‹Ÿæœºæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶å™¨ï¼Œå®ƒä¼šç›‘è§†  <code>new</code>  åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸€æ—¦å‘ç°å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œåˆ™ä¼šé‡Šæ”¾å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚</p>
<h3 id="-32"><a class="markdownIt-Anchor" href="#-32">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_1-1-%E5%B0%81%E8%A3%85">#</a>1.1. å°è£…</h3>
<p><strong>å°è£…ï¼ˆEncapsulationï¼‰æ˜¯æŒ‡ä¸€ç§å°†æŠ½è±¡æ€§å‡½å¼æ¥å£çš„å®ç°ç»†èŠ‚éƒ¨ä»½åŒ…è£…ã€éšè—èµ·æ¥çš„æ–¹æ³•ã€‚</strong></p>
<p>å°è£…æœ€ä¸»è¦çš„ä½œç”¨åœ¨äºæˆ‘ä»¬èƒ½ä¿®æ”¹è‡ªå·±çš„å®ç°ä»£ç ï¼Œè€Œä¸ç”¨ä¿®æ”¹é‚£äº›è°ƒç”¨æˆ‘ä»¬ä»£ç çš„ç¨‹åºç‰‡æ®µã€‚</p>
<p>é€‚å½“çš„å°è£…å¯ä»¥è®©ç¨‹å¼ç æ›´å®¹æ˜“ç†è§£ä¸ç»´æŠ¤ï¼Œä¹ŸåŠ å¼ºäº†ç¨‹å¼ç çš„å®‰å…¨æ€§ã€‚</p>
<p>å°è£…çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è‰¯å¥½çš„å°è£…èƒ½å¤Ÿå‡å°‘è€¦åˆã€‚</li>
<li>ç±»å†…éƒ¨çš„ç»“æ„å¯ä»¥è‡ªç”±ä¿®æ”¹ã€‚</li>
<li>å¯ä»¥å¯¹æˆå‘˜å˜é‡è¿›è¡Œæ›´ç²¾ç¡®çš„æ§åˆ¶ã€‚</li>
<li>éšè—ä¿¡æ¯ï¼Œå®ç°ç»†èŠ‚ã€‚</li>
</ul>
<p>å®ç°å°è£…çš„æ­¥éª¤ï¼š</p>
<ol>
<li>ä¿®æ”¹å±æ€§çš„å¯è§æ€§æ¥é™åˆ¶å¯¹å±æ€§çš„è®¿é—®ï¼ˆä¸€èˆ¬é™åˆ¶ä¸º privateï¼‰ã€‚</li>
<li>å¯¹æ¯ä¸ªå€¼å±æ€§æä¾›å¯¹å¤–çš„å…¬å…±æ–¹æ³•è®¿é—®ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºä¸€å¯¹èµ‹å–å€¼æ–¹æ³•ï¼Œç”¨äºå¯¹ç§æœ‰å±æ€§çš„è®¿é—®ã€‚</li>
</ol>
<h3 id="-33"><a class="markdownIt-Anchor" href="#-33">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_1-2-%E7%BB%A7%E6%89%BF">#</a>1.2. ç»§æ‰¿</h3>
<p>ç»§æ‰¿æ˜¯ java é¢å‘å¯¹è±¡ç¼–ç¨‹æŠ€æœ¯çš„ä¸€å—åŸºçŸ³ï¼Œå› ä¸ºå®ƒå…è®¸åˆ›å»ºåˆ†ç­‰çº§å±‚æ¬¡çš„ç±»ã€‚</p>
<p>ç»§æ‰¿å°±æ˜¯å­ç±»ç»§æ‰¿çˆ¶ç±»çš„ç‰¹å¾å’Œè¡Œä¸ºï¼Œä½¿å¾—å­ç±»å¯¹è±¡ï¼ˆå®ä¾‹ï¼‰å…·æœ‰çˆ¶ç±»çš„å®ä¾‹åŸŸå’Œæ–¹æ³•ï¼Œæˆ–å­ç±»ä»çˆ¶ç±»ç»§æ‰¿æ–¹æ³•ï¼Œä½¿å¾—å­ç±»å…·æœ‰çˆ¶ç±»ç›¸åŒçš„è¡Œä¸ºã€‚</p>
<p>ç°å®ä¸­çš„ä¾‹å­ï¼š</p>
<p>ç‹—å’Œé¸Ÿéƒ½æ˜¯åŠ¨ç‰©ã€‚å¦‚æœå°†ç‹—ã€é¸Ÿä½œä¸ºç±»ï¼Œå®ƒä»¬å¯ä»¥ç»§æ‰¿åŠ¨ç‰©ç±»ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1552641712126.png" alt="img"></p>
<p>ç±»çš„ç»§æ‰¿å½¢å¼ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">class çˆ¶ç±» &#123;&#125;

class å­ç±» extends çˆ¶ç±» &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="-34"><a class="markdownIt-Anchor" href="#-34">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#%E7%BB%A7%E6%89%BF%E7%B1%BB%E5%9E%8B">#</a>ç»§æ‰¿ç±»å‹</h4>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/types_of_inheritance.png" alt="img"></p>
<h4 id="-35"><a class="markdownIt-Anchor" href="#-35">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#%E7%BB%A7%E6%89%BF%E7%9A%84%E7%89%B9%E6%80%A7">#</a>ç»§æ‰¿çš„ç‰¹æ€§</h4>
<ul>
<li>å­ç±»æ‹¥æœ‰çˆ¶ç±»é private çš„å±æ€§ã€æ–¹æ³•ã€‚</li>
<li>å­ç±»å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ï¼Œå³å­ç±»å¯ä»¥å¯¹çˆ¶ç±»è¿›è¡Œæ‰©å±•ã€‚</li>
<li>å­ç±»å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼å®ç°çˆ¶ç±»çš„æ–¹æ³•ã€‚</li>
<li>Java çš„ç»§æ‰¿æ˜¯å•ç»§æ‰¿ï¼Œä½†æ˜¯å¯ä»¥å¤šé‡ç»§æ‰¿ï¼Œå•ç»§æ‰¿å°±æ˜¯ä¸€ä¸ªå­ç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå¤šé‡ç»§æ‰¿å°±æ˜¯ï¼Œä¾‹å¦‚ A ç±»ç»§æ‰¿ B ç±»ï¼ŒB ç±»ç»§æ‰¿ C ç±»ï¼Œæ‰€ä»¥æŒ‰ç…§å…³ç³»å°±æ˜¯ C ç±»æ˜¯ B ç±»çš„çˆ¶ç±»ï¼ŒB ç±»æ˜¯ A ç±»çš„çˆ¶ç±»ï¼Œè¿™æ˜¯ Java ç»§æ‰¿åŒºåˆ«äº C++ ç»§æ‰¿çš„ä¸€ä¸ªç‰¹æ€§ã€‚</li>
<li>æé«˜äº†ç±»ä¹‹é—´çš„è€¦åˆæ€§ï¼ˆç»§æ‰¿çš„ç¼ºç‚¹ï¼Œè€¦åˆåº¦é«˜å°±ä¼šé€ æˆä»£ç ä¹‹é—´çš„è”ç³»è¶Šç´§å¯†ï¼Œä»£ç ç‹¬ç«‹æ€§è¶Šå·®ï¼‰ã€‚</li>
</ul>
<h4 id="-36"><a class="markdownIt-Anchor" href="#-36">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#%E7%BB%A7%E6%89%BF%E5%85%B3%E9%94%AE%E5%AD%97">#</a>ç»§æ‰¿å…³é”®å­—</h4>
<p>ç»§æ‰¿å¯ä»¥ä½¿ç”¨ extends å’Œ implements è¿™ä¸¤ä¸ªå…³é”®å­—æ¥å®ç°ç»§æ‰¿ï¼Œè€Œä¸”æ‰€æœ‰çš„ç±»éƒ½æ˜¯ç»§æ‰¿äº java.lang.Objectï¼Œå½“ä¸€ä¸ªç±»æ²¡æœ‰ç»§æ‰¿çš„ä¸¤ä¸ªå…³é”®å­—ï¼Œåˆ™é»˜è®¤ç»§æ‰¿ objectï¼ˆè¿™ä¸ªç±»åœ¨ <strong>java.lang</strong> åŒ…ä¸­ï¼Œæ‰€ä»¥ä¸éœ€è¦ <strong>import</strong>ï¼‰ç¥–å…ˆç±»ã€‚</p>
<h3 id="-37"><a class="markdownIt-Anchor" href="#-37">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_1-3-%E5%A4%9A%E6%80%81">#</a>1.3. å¤šæ€</h3>
<p>åˆšå¼€å§‹å­¦ä¹ é¢å‘å¯¹è±¡ç¼–ç¨‹æ—¶ï¼Œå®¹æ˜“è¢«å„ç§æœ¯è¯­å¼„å¾—äº‘é‡Œé›¾é‡Œã€‚æ‰€ä»¥ï¼Œå¾ˆå¤šäººä¼šæ­»è®°ç¡¬èƒŒä¹¦ä¸­å¯¹äºæœ¯è¯­çš„å®šä¹‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œéšç€åº”ç”¨å’Œç†è§£çš„æ·±å…¥ï¼Œåº”è¯¥ä¼šæ¸æ¸æœ‰æ›´è¿›ä¸€æ­¥çš„è®¤è¯†ï¼Œå°†å…¶èæ±‡è´¯é€šçš„ç†è§£ã€‚</p>
<p>å­¦ä¹ ç±»ä¹‹å‰ï¼Œå…ˆè®©æˆ‘ä»¬æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šJava ä¸­ä¸ºä»€ä¹ˆè¦å¼•å…¥ç±»æœºåˆ¶ï¼Œè®¾è®¡çš„åˆè¡·æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>Java ä¸­æä¾›çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œåªèƒ½è¡¨ç¤ºå•ä¸€çš„æ•°å€¼ï¼Œè¿™ç”¨äºæ•°å€¼è®¡ç®—ï¼Œè¿˜ OKã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦æŠ½è±¡æ¨¡æ‹Ÿç°å®ä¸­æ›´å¤æ‚çš„äº‹ç‰©ï¼Œåˆ™æ— æ³•åšåˆ°ã€‚</p>
<p>è¯•æƒ³ï¼Œå¦‚æœè¦è®©ä½ æŠ½è±¡ç‹—çš„æ•°æ®æ¨¡å‹ï¼Œæ€ä¹ˆåšï¼Ÿç‹—æœ‰çœ¼è€³å£é¼»ç­‰å™¨å®˜ï¼Œæœ‰è…¿ï¼Œç‹—æœ‰å¤§å°ï¼Œæ¯›è‰²ï¼Œè¿™äº›éƒ½æ˜¯å®ƒçš„çŠ¶æ€ï¼Œç‹—ä¼šè·‘ã€ä¼šå«ã€ä¼šåƒä¸œè¥¿ï¼Œè¿™äº›æ˜¯å®ƒçš„è¡Œä¸ºã€‚</p>
<p>ç±»çš„å¼•å…¥ï¼Œå°±æ˜¯ä¸ºäº†æŠ½è±¡è¿™ç§ç›¸å¯¹å¤æ‚çš„äº‹ç‰©ã€‚</p>
<p>å¯¹è±¡æ˜¯ç”¨äºè®¡ç®—æœºè¯­è¨€å¯¹é—®é¢˜åŸŸä¸­äº‹ç‰©çš„æè¿°ã€‚<strong>å¯¹è±¡é€šè¿‡æ–¹æ³•å’Œå±æ€§æ¥åˆ†åˆ«æè¿°äº‹ç‰©æ‰€å…·æœ‰çš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚</strong></p>
<p><strong>ç±»æ˜¯ç”¨äºæè¿°åŒä¸€ç±»çš„å¯¹è±¡çš„ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œç±»ä¸­å®šä¹‰äº†è¿™ä¸€ç±»å¯¹è±¡æ‰€å…·æœ‰çš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚</strong></p>
<p>ç±»å¯ä»¥çœ‹æˆæ˜¯åˆ›å»º Java å¯¹è±¡çš„æ¨¡æ¿ã€‚</p>
<p>ä»€ä¹ˆæ˜¯æ–¹æ³•ï¼Ÿæ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20275578/answer/26577791">é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å¼Šç«¯æ˜¯ä»€ä¹ˆï¼Ÿ - invalid s çš„å›ç­” (opens new window)</a></p>
<h2 id="-38"><a class="markdownIt-Anchor" href="#-38">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_2-%E7%B1%BB">#</a>2. ç±»</h2>
<p>ä¸å¤§å¤šæ•°é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒJava ä½¿ç”¨  <code>class</code>  ï¼ˆç±»ï¼‰å…³é”®å­—æ¥è¡¨ç¤ºè‡ªå®šä¹‰ç±»å‹ã€‚è‡ªå®šä¹‰ç±»å‹æ˜¯ä¸ºäº†æ›´å®¹æ˜“æŠ½è±¡ç°å®äº‹ç‰©ã€‚</p>
<p>åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¯ä»¥è®¾ç½®ä¸€é™ä¸€åŠ¨ä¸¤ç§å…ƒç´ ï¼šå±æ€§ï¼ˆé™ï¼‰å’Œæ–¹æ³•ï¼ˆåŠ¨ï¼‰ã€‚</p>
<ul>
<li><strong>å±æ€§ï¼ˆæœ‰çš„äººå–œæ¬¢ç§°ä¸ºæˆå‘˜ã€å­—æ®µï¼‰</strong> - å±æ€§æŠ½è±¡çš„æ˜¯äº‹ç‰©çš„çŠ¶æ€ã€‚ç±»å±æ€§å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚</li>
<li><strong>æ–¹æ³•ï¼ˆæœ‰çš„äººå–œæ¬¢ç§°ä¸ºå‡½æ•°ï¼‰</strong> - æ–¹æ³•æŠ½è±¡çš„æ˜¯äº‹ç‰©çš„è¡Œä¸ºã€‚</li>
</ul>
<p>ç±»çš„å½¢å¼å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1552640231731.png" alt="img"></p>
<h2 id="-39"><a class="markdownIt-Anchor" href="#-39">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_3-%E6%96%B9%E6%B3%95">#</a>3. æ–¹æ³•</h2>
<h3 id="-40"><a class="markdownIt-Anchor" href="#-40">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_3-1-%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89">#</a>3.1. æ–¹æ³•å®šä¹‰</h3>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">ä¿®é¥°ç¬¦ è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å‚æ•°ç±»å‹ å‚æ•°å)&#123;
    ...
    æ–¹æ³•ä½“
    ...
    return è¿”å›å€¼;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ–¹æ³•åŒ…å«ä¸€ä¸ªæ–¹æ³•å¤´å’Œä¸€ä¸ªæ–¹æ³•ä½“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰éƒ¨åˆ†ï¼š</p>
<ul>
<li>** ä¿®é¥°ç¬¦ï¼š** ä¿®é¥°ç¬¦ï¼Œè¿™æ˜¯å¯é€‰çš„ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•è°ƒç”¨è¯¥æ–¹æ³•ã€‚å®šä¹‰äº†è¯¥æ–¹æ³•çš„è®¿é—®ç±»å‹ã€‚</li>
<li>** è¿”å›å€¼ç±»å‹ ï¼š** æ–¹æ³•å¯èƒ½æœ‰è¿”å›å€¼ã€‚å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›å€¼ç±»å‹åº”è®¾ä¸º voidã€‚</li>
<li>** æ–¹æ³•åï¼š** æ˜¯æ–¹æ³•çš„å®é™…åç§°ã€‚æ–¹æ³•åå’Œå‚æ•°è¡¨å…±åŒæ„æˆæ–¹æ³•ç­¾åã€‚</li>
<li>** å‚æ•°ç±»å‹ï¼š** å‚æ•°åƒæ˜¯ä¸€ä¸ªå ä½ç¬¦ã€‚å½“æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼ é€’å€¼ç»™å‚æ•°ã€‚è¿™ä¸ªå€¼è¢«ç§°ä¸ºå®å‚æˆ–å˜é‡ã€‚å‚æ•°åˆ—è¡¨æ˜¯æŒ‡æ–¹æ³•çš„å‚æ•°ç±»å‹ã€é¡ºåºå’Œå‚æ•°çš„ä¸ªæ•°ã€‚å‚æ•°æ˜¯å¯é€‰çš„ï¼Œæ–¹æ³•å¯ä»¥ä¸åŒ…å«ä»»ä½•å‚æ•°ã€‚</li>
<li>** æ–¹æ³•ä½“ï¼š** æ–¹æ³•ä½“åŒ…å«å…·ä½“çš„è¯­å¥ï¼Œå®šä¹‰è¯¥æ–¹æ³•çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="-41"><a class="markdownIt-Anchor" href="#-41">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_3-2-%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8">#</a>3.2. æ–¹æ³•è°ƒç”¨</h3>
<p>Java æ”¯æŒä¸¤ç§è°ƒç”¨æ–¹æ³•çš„æ–¹å¼ï¼Œæ ¹æ®æ–¹æ³•æ˜¯å¦è¿”å›å€¼æ¥é€‰æ‹©ã€‚</p>
<p>å½“ç¨‹åºè°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œç¨‹åºçš„æ§åˆ¶æƒäº¤ç»™äº†è¢«è°ƒç”¨çš„æ–¹æ³•ã€‚å½“è¢«è°ƒç”¨æ–¹æ³•çš„è¿”å›è¯­å¥æ‰§è¡Œæˆ–è€…åˆ°è¾¾æ–¹æ³•ä½“é—­æ‹¬å·æ—¶å€™äº¤è¿˜æ§åˆ¶æƒç»™ç¨‹åºã€‚</p>
<p>å½“æ–¹æ³•è¿”å›ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œæ–¹æ³•è°ƒç”¨é€šå¸¸è¢«å½“åšä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">int larger = max(30, 40);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœæ–¹æ³•è¿”å›å€¼æ˜¯ voidï¼Œæ–¹æ³•è°ƒç”¨ä¸€å®šæ˜¯ä¸€æ¡è¯­å¥ã€‚ä¾‹å¦‚ï¼Œæ–¹æ³• println è¿”å› voidã€‚ä¸‹é¢çš„è°ƒç”¨æ˜¯ä¸ªè¯­å¥ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">System.out.println("Hello World");<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-42"><a class="markdownIt-Anchor" href="#-42">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_3-3-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">#</a>3.3. æ„é€ æ–¹æ³•</h3>
<p>æ¯ä¸ªç±»éƒ½æœ‰æ„é€ æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°ä¸ºç±»å®šä¹‰ä»»ä½•æ„é€ æ–¹æ³•ï¼ŒJava ç¼–è¯‘å™¨å°†ä¼šä¸ºè¯¥ç±»æä¾›ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•ã€‚</p>
<p>åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè‡³å°‘è¦è°ƒç”¨ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚æ„é€ æ–¹æ³•çš„åç§°å¿…é¡»ä¸ç±»åŒåï¼Œä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Puppy</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Puppy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Puppy</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// è¿™ä¸ªæ„é€ å™¨ä»…æœ‰ä¸€ä¸ªå‚æ•°ï¼šname</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-43"><a class="markdownIt-Anchor" href="#-43">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_4-%E5%8F%98%E9%87%8F">#</a>4. å˜é‡</h2>
<p>Java æ”¯æŒçš„å˜é‡ç±»å‹æœ‰ï¼š</p>
<ul>
<li><code>å±€éƒ¨å˜é‡</code>  - ç±»æ–¹æ³•ä¸­çš„å˜é‡ã€‚</li>
<li><code>å®ä¾‹å˜é‡ï¼ˆä¹Ÿå«æˆå‘˜å˜é‡ï¼‰</code>  - ç±»æ–¹æ³•å¤–çš„å˜é‡ï¼Œä¸è¿‡æ²¡æœ‰  <code>static</code>  ä¿®é¥°ã€‚</li>
<li><code>ç±»å˜é‡ï¼ˆä¹Ÿå«é™æ€å˜é‡ï¼‰</code>  - ç±»æ–¹æ³•å¤–çš„å˜é‡ï¼Œç”¨  <code>static</code>  ä¿®é¥°ã€‚</li>
</ul>
<p>ç‰¹æ€§å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>å±€éƒ¨å˜é‡</th>
<th>å®ä¾‹å˜é‡ï¼ˆä¹Ÿå«æˆå‘˜å˜é‡ï¼‰</th>
<th>ç±»å˜é‡ï¼ˆä¹Ÿå«é™æ€å˜é‡ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>å±€éƒ¨å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­ã€‚</td>
<td>å®ä¾‹å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚</td>
<td>ç±»å˜é‡å£°æ˜åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•å’Œè¯­å¥å—ä¹‹å¤–ã€‚å¹¶ä¸”ä»¥ static ä¿®é¥°ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡åœ¨æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€æˆ–è€…è¯­å¥å—è¢«æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºï¼Œå½“å®ƒä»¬æ‰§è¡Œå®Œæˆåï¼Œå˜é‡å°†ä¼šè¢«é”€æ¯ã€‚</td>
<td>å®ä¾‹å˜é‡åœ¨å¯¹è±¡åˆ›å»ºçš„æ—¶å€™åˆ›å»ºï¼Œåœ¨å¯¹è±¡è¢«é”€æ¯çš„æ—¶å€™é”€æ¯ã€‚</td>
<td>ç±»å˜é‡åœ¨ç¬¬ä¸€æ¬¡è¢«è®¿é—®æ—¶åˆ›å»ºï¼Œåœ¨ç¨‹åºç»“æŸæ—¶é”€æ¯ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡æ²¡æœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥å¿…é¡»ç»è¿‡åˆå§‹åŒ–ï¼Œæ‰å¯ä»¥ä½¿ç”¨ã€‚</td>
<td>å®ä¾‹å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ nullã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚</td>
<td>ç±»å˜é‡å…·æœ‰é»˜è®¤å€¼ã€‚æ•°å€¼å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œå¸ƒå°”å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ falseï¼Œå¼•ç”¨ç±»å‹å˜é‡çš„é»˜è®¤å€¼æ˜¯ nullã€‚å˜é‡çš„å€¼å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šã€‚æ­¤å¤–ï¼Œé™æ€å˜é‡è¿˜å¯ä»¥åœ¨é™æ€è¯­å¥å—ä¸­åˆå§‹åŒ–ã€‚</td>
</tr>
<tr>
<td>å¯¹äºå±€éƒ¨å˜é‡ï¼Œå¦‚æœæ˜¯åŸºæœ¬ç±»å‹ï¼Œä¼šæŠŠå€¼ç›´æ¥å­˜å‚¨åœ¨æ ˆï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¼šæŠŠå…¶å¯¹è±¡å­˜å‚¨åœ¨å †ï¼Œè€ŒæŠŠè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰å­˜å‚¨åœ¨æ ˆã€‚</td>
<td>å®ä¾‹å˜é‡å­˜å‚¨åœ¨å †ã€‚</td>
<td>ç±»å˜é‡å­˜å‚¨åœ¨é™æ€å­˜å‚¨åŒºã€‚</td>
</tr>
<tr>
<td>è®¿é—®ä¿®é¥°ç¬¦ä¸èƒ½ç”¨äºå±€éƒ¨å˜é‡ã€‚</td>
<td>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ç”¨äºå®ä¾‹å˜é‡ã€‚</td>
<td>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ç”¨äºç±»å˜é‡ã€‚</td>
</tr>
<tr>
<td>å±€éƒ¨å˜é‡åªåœ¨å£°æ˜å®ƒçš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—ä¸­å¯è§ã€‚</td>
<td>å®ä¾‹å˜é‡å¯¹äºç±»ä¸­çš„æ–¹æ³•ã€æ„é€ æ–¹æ³•æˆ–è€…è¯­å¥å—æ˜¯å¯è§çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹åº”è¯¥æŠŠå®ä¾‹å˜é‡è®¾ä¸ºç§æœ‰ã€‚é€šè¿‡ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ä½¿å®ä¾‹å˜é‡å¯¹å­ç±»å¯è§ã€‚</td>
<td>ä¸å®ä¾‹å˜é‡å…·æœ‰ç›¸ä¼¼çš„å¯è§æ€§ã€‚ä½†ä¸ºäº†å¯¹ç±»çš„ä½¿ç”¨è€…å¯è§ï¼Œå¤§å¤šæ•°é™æ€å˜é‡å£°æ˜ä¸º public ç±»å‹ã€‚</td>
</tr>
<tr>
<td></td>
<td>å®ä¾‹å˜é‡å¯ä»¥ç›´æ¥é€šè¿‡å˜é‡åè®¿é—®ã€‚ä½†åœ¨é™æ€æ–¹æ³•ä»¥åŠå…¶ä»–ç±»ä¸­ï¼Œå°±åº”è¯¥ä½¿ç”¨å®Œå…¨é™å®šåï¼šObejectReference.VariableNameã€‚</td>
<td>é™æ€å˜é‡å¯ä»¥é€šè¿‡ï¼šClassName.VariableName çš„æ–¹å¼è®¿é—®ã€‚</td>
</tr>
<tr>
<td></td>
<td></td>
<td>æ— è®ºä¸€ä¸ªç±»åˆ›å»ºäº†å¤šå°‘ä¸ªå¯¹è±¡ï¼Œç±»åªæ‹¥æœ‰ç±»å˜é‡çš„ä¸€ä»½æ‹·è´ã€‚</td>
</tr>
<tr>
<td></td>
<td></td>
<td>ç±»å˜é‡é™¤äº†è¢«å£°æ˜ä¸ºå¸¸é‡å¤–å¾ˆå°‘ä½¿ç”¨ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="-44"><a class="markdownIt-Anchor" href="#-44">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_4-1-%E5%8F%98%E9%87%8F%E4%BF%AE%E9%A5%B0%E7%AC%A6">#</a>4.1. å˜é‡ä¿®é¥°ç¬¦</h3>
<ul>
<li>è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦ - å¦‚æœå˜é‡æ˜¯å®ä¾‹å˜é‡æˆ–ç±»å˜é‡ï¼Œå¯ä»¥æ·»åŠ è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦ï¼ˆpublic/protected/privateï¼‰</li>
<li>é™æ€ä¿®é¥°ç¬¦ - å¦‚æœå˜é‡æ˜¯ç±»å˜é‡ï¼Œéœ€è¦æ·»åŠ  static ä¿®é¥°</li>
<li>final - å¦‚æœå˜é‡ä½¿ç”¨ fianl ä¿®é¥°ç¬¦ï¼Œå°±è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚</li>
</ul>
<h3 id="-45"><a class="markdownIt-Anchor" href="#-45">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_4-2-%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1">#</a>4.2. åˆ›å»ºå¯¹è±¡</h3>
<p>å¯¹è±¡æ˜¯æ ¹æ®ç±»åˆ›å»ºçš„ã€‚åœ¨ Java ä¸­ï¼Œä½¿ç”¨å…³é”®å­— new æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚åˆ›å»ºå¯¹è±¡éœ€è¦ä»¥ä¸‹ä¸‰æ­¥ï¼š</p>
<ul>
<li><strong>å£°æ˜</strong>ï¼šå£°æ˜ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬å¯¹è±¡åç§°å’Œå¯¹è±¡ç±»å‹ã€‚</li>
<li><strong>å®ä¾‹åŒ–</strong>ï¼šä½¿ç”¨å…³é”®å­— new æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li><strong>åˆå§‹åŒ–</strong>ï¼šä½¿ç”¨ new åˆ›å»ºå¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨æ„é€ æ–¹æ³•åˆå§‹åŒ–å¯¹è±¡ã€‚</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">public class Puppy&#123;
   public Puppy(String name)&#123;
      //è¿™ä¸ªæ„é€ å™¨ä»…æœ‰ä¸€ä¸ªå‚æ•°ï¼šname
      System.out.println("å°ç‹—çš„åå­—æ˜¯ : " + name );
   &#125;
   public static void main(String[] args)&#123;
      // ä¸‹é¢çš„è¯­å¥å°†åˆ›å»ºä¸€ä¸ªPuppyå¯¹è±¡
      Puppy myPuppy = new Puppy( "tommy" );
   &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-46"><a class="markdownIt-Anchor" href="#-46">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_4-3-%E8%AE%BF%E9%97%AE%E5%AE%9E%E4%BE%8B%E5%8F%98%E9%87%8F%E5%92%8C%E6%96%B9%E6%B3%95">#</a>4.3. è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•</h3>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">/* å®ä¾‹åŒ–å¯¹è±¡ */
ObjectReference = new Constructor();
/* è®¿é—®ç±»ä¸­çš„å˜é‡ */
ObjectReference.variableName;
/* è®¿é—®ç±»ä¸­çš„æ–¹æ³• */
ObjectReference.methodName();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-47"><a class="markdownIt-Anchor" href="#-47">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_5-%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6">#</a>5. è®¿é—®æƒé™æ§åˆ¶</h2>
<h3 id="-48"><a class="markdownIt-Anchor" href="#-48">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_5-1-%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87">#</a>5.1. ä»£ç ç»„ç»‡</h3>
<p><strong>å½“ç¼–è¯‘ä¸€ä¸ª .java æ–‡ä»¶æ—¶ï¼Œåœ¨ .java æ–‡ä»¶ä¸­çš„æ¯ä¸ªç±»éƒ½ä¼šè¾“å‡ºä¸€ä¸ªä¸ç±»åŒåçš„ .class æ–‡ä»¶ã€‚</strong></p>
<p>MultiClassDemo.java ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">MultiClass1</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">MultiClass2</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">MultiClass3</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiClassDemo</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œ  <code>javac MultiClassDemo.java</code>  å‘½ä»¤ï¼Œæœ¬åœ°ä¼šç”Ÿæˆ MultiClass1.classã€MultiClass2.classã€MultiClass3.classã€MultiClassDemo.class å››ä¸ªæ–‡ä»¶ã€‚</p>
<p><strong>Java å¯è¿è¡Œç¨‹åºæ˜¯ç”±ä¸€ç»„ .class æ–‡ä»¶æ‰“åŒ…å¹¶å‹ç¼©æˆçš„ä¸€ä¸ª .jar æ–‡ä»¶</strong>ã€‚Java è§£é‡Šå™¨è´Ÿè´£è¿™äº›æ–‡ä»¶çš„æŸ¥æ‰¾ã€è£…è½½å’Œè§£é‡Šã€‚<strong>Java ç±»åº“å®é™…ä¸Šæ˜¯ä¸€ç»„ç±»æ–‡ä»¶ï¼ˆ.java æ–‡ä»¶ï¼‰ã€‚</strong></p>
<ul>
<li><strong>å…¶ä¸­æ¯ä¸ªæ–‡ä»¶å…è®¸æœ‰ä¸€ä¸ª public ç±»ï¼Œä»¥åŠä»»æ„æ•°é‡çš„é public ç±»</strong>ã€‚</li>
<li><strong>public ç±»åå¿…é¡»å’Œ .java æ–‡ä»¶åå®Œå…¨ç›¸åŒï¼ŒåŒ…æ‹¬å¤§å°å†™ã€‚</strong></li>
</ul>
<p>ç¨‹åºä¸€èˆ¬ä¸æ­¢ä¸€ä¸ªäººç¼–å†™ï¼Œä¼šè°ƒç”¨ç³»ç»Ÿæä¾›çš„ä»£ç ã€ç¬¬ä¸‰æ–¹åº“ä¸­çš„ä»£ç ã€é¡¹ç›®ä¸­å…¶ä»–äººå†™çš„ä»£ç ç­‰ï¼Œä¸åŒçš„äººå› ä¸ºä¸åŒçš„ç›®çš„å¯èƒ½å®šä¹‰åŒæ ·çš„ç±»å / æ¥å£åï¼Œè¿™å°±æ˜¯å‘½åå†²çªã€‚</p>
<p>Java ä¸­ä¸ºäº†è§£å†³å‘½åå†²çªé—®é¢˜ï¼Œæä¾›äº†åŒ…ï¼ˆ <code>package</code> ï¼‰å’Œå¯¼å…¥ï¼ˆ <code>import</code> ï¼‰æœºåˆ¶ã€‚</p>
<h4 id="-49"><a class="markdownIt-Anchor" href="#-49">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#package">#</a>package</h4>
<p>åŒ…ï¼ˆ <code>package</code> ï¼‰çš„åŸåˆ™ï¼š</p>
<ul>
<li>åŒ…ç±»ä¼¼äºæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶æ”¾åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œç±»å’Œæ¥å£åˆ™æ”¾åœ¨åŒ…ä¸­ã€‚ä¸ºäº†ä¾¿äºç»„ç»‡ï¼Œæ–‡ä»¶å¤¹ä¸€èˆ¬æ˜¯ä¸€ä¸ª<strong>æœ‰å±‚æ¬¡çš„æ ‘å½¢ç»“æ„</strong>ï¼ŒåŒ…ä¹Ÿç±»ä¼¼ã€‚</li>
<li><strong>åŒ…åä»¥é€—å·  <code>.</code>  åˆ†éš”ï¼Œè¡¨ç¤ºå±‚æ¬¡ç»“æ„ã€‚</strong></li>
<li>Java ä¸­å‘½ååŒ…åçš„ä¸€ä¸ªæƒ¯ä¾‹æ˜¯ä½¿ç”¨åŸŸåä½œä¸ºå‰ç¼€ï¼Œå› ä¸ºåŸŸåæ˜¯å”¯ä¸€çš„ï¼Œä¸€èˆ¬æŒ‰ç…§åŸŸåçš„ååºæ¥å®šä¹‰åŒ…åï¼Œæ¯”å¦‚ï¼ŒåŸŸåæ˜¯ï¼š<a target="_blank" rel="noopener" href="http://apache.org">apache.org</a>ï¼ŒåŒ…åå°±ä»¥ org.apache å¼€å¤´ã€‚</li>
<li>** åŒ…åå’Œæ–‡ä»¶ç›®å½•ç»“æ„å¿…é¡»å®Œå…¨åŒ¹é…ã€‚**Java è§£é‡Šå™¨è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š
<ul>
<li>æ‰¾å‡ºç¯å¢ƒå˜é‡ CLASSPATHï¼Œä½œä¸º .class æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚</li>
<li>ä»æ ¹ç›®å½•å¼€å§‹ï¼Œè·å–åŒ…åç§°ï¼Œå¹¶å°†é€—å·  <code>.</code>  æ›¿æ¢ä¸ºæ–‡ä»¶åˆ†éš”ç¬¦ï¼ˆåæ–œæ   <code>/</code> ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªè·¯å¾„åç§°å»æŸ¥æ‰¾ Java ç±»ã€‚</li>
</ul>
</li>
</ul>
<h4 id="-50"><a class="markdownIt-Anchor" href="#-50">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#import">#</a>import</h4>
<p>åŒä¸€ä¸ªåŒ…ä¸‹çš„ç±»ä¹‹é—´äº’ç›¸å¼•ç”¨æ˜¯ä¸éœ€è¦åŒ…åçš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ä½†å¦‚æœç±»ä¸åœ¨åŒä¸€ä¸ªåŒ…å†…ï¼Œåˆ™å¿…é¡»è¦çŸ¥é“å…¶æ‰€åœ¨çš„åŒ…ï¼Œä½¿ç”¨æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>é€šè¿‡ç±»çš„å®Œå…¨é™å®šå</li>
<li>é€šè¿‡ import å°†ç”¨åˆ°çš„ç±»å¼•å…¥åˆ°å½“å‰ç±»</li>
</ul>
<p>é€šè¿‡ç±»çš„å®Œå…¨é™å®šåç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PackageDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> main <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span>args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡  <code>import</code>  å¯¼å…¥å…¶å®ƒåŒ…çš„ç±»åˆ°å½“å‰ç±»ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PackageDemo2</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼šä»¥ä¸Šä¸¤ä¸ªç¤ºä¾‹æ¯”è¾ƒèµ·æ¥ï¼Œæ˜¾ç„¶æ˜¯  <code>import</code>  æ–¹å¼ï¼Œä»£ç æ›´åŠ æ•´æ´ã€‚</p>
</blockquote>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/swiftma/p/5628762.html">https://www.cnblogs.com/swiftma/p/5628762.html</a></p>
</blockquote>
<h3 id="-51"><a class="markdownIt-Anchor" href="#-51">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_5-2-%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E4%BF%AE%E9%A5%B0%E5%85%B3%E9%94%AE%E5%AD%97">#</a>5.2. è®¿é—®æƒé™ä¿®é¥°å…³é”®å­—</h3>
<p>è®¿é—®æƒé™æ§åˆ¶çš„ç­‰çº§ï¼Œä»æœ€å¤§æƒé™åˆ°æœ€å°æƒé™ä¾æ¬¡ä¸ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">public > protected > åŒ…è®¿é—®æƒé™ï¼ˆæ²¡æœ‰ä»»ä½•å…³é”®å­—ï¼‰> private<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>public</code>  - è¡¨ç¤ºä»»ä½•ç±»éƒ½å¯ä»¥è®¿é—®ï¼›</li>
<li><code>åŒ…è®¿é—®æƒé™</code>  - åŒ…è®¿é—®æƒé™ï¼Œæ²¡æœ‰ä»»ä½•å…³é”®å­—ã€‚å®ƒè¡¨ç¤ºå½“å‰åŒ…ä¸­çš„æ‰€æœ‰å…¶ä»–ç±»éƒ½å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å…¶å®ƒåŒ…çš„ç±»æ— æ³•è®¿é—®ã€‚</li>
<li><code>protected</code>  - è¡¨ç¤ºå­ç±»å¯ä»¥è®¿é—®ï¼Œæ­¤å¤–ï¼ŒåŒä¸€ä¸ªåŒ…å†…çš„å…¶ä»–ç±»ä¹Ÿå¯ä»¥è®¿é—®ï¼Œå³ä½¿è¿™äº›ç±»ä¸æ˜¯å­ç±»ã€‚</li>
<li><code>private</code>  - è¡¨ç¤ºå…¶å®ƒä»»ä½•ç±»éƒ½æ— æ³•è®¿é—®ã€‚</li>
</ul>
<h2 id="-52"><a class="markdownIt-Anchor" href="#-52">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_6-%E6%8E%A5%E5%8F%A3">#</a>6. æ¥å£</h2>
<p>æ¥å£æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ï¼Œå®ƒæ˜¯æŠ½è±¡æ–¹æ³•çš„é›†åˆï¼Œåˆ©ç”¨æ¥å£å¯ä»¥è¾¾åˆ° API å®šä¹‰å’Œå®ç°åˆ†ç¦»çš„ç›®çš„ã€‚</p>
<p>æ¥å£ï¼Œä¸èƒ½å®ä¾‹åŒ–ï¼›ä¸èƒ½åŒ…å«ä»»ä½•éå¸¸é‡æˆå‘˜ï¼Œä»»ä½• field éƒ½æ˜¯éšå«ç€  <code>public static final</code>  çš„æ„ä¹‰ï¼›åŒæ—¶ï¼Œæ²¡æœ‰éé™æ€æ–¹æ³•å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¹ˆæ˜¯æŠ½è±¡æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯é™æ€æ–¹æ³•ã€‚</p>
<p>Java æ ‡å‡†ç±»åº“ä¸­ï¼Œå®šä¹‰äº†éå¸¸å¤šçš„æ¥å£ï¼Œæ¯”å¦‚  <code>java.util.List</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">T</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="-53"><a class="markdownIt-Anchor" href="#-53">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-oop.html#_7-%E6%8A%BD%E8%B1%A1%E7%B1%BB">#</a>7. æŠ½è±¡ç±»</h2>
<p>æŠ½è±¡ç±»æ˜¯ä¸èƒ½å®ä¾‹åŒ–çš„ç±»ï¼Œç”¨  <code>abstract</code>  å…³é”®å­—ä¿®é¥°  <code>class</code> ï¼Œå…¶ç›®çš„ä¸»è¦æ˜¯ä»£ç é‡ç”¨ã€‚é™¤äº†ä¸èƒ½å®ä¾‹åŒ–ï¼Œå½¢å¼ä¸Šå’Œä¸€èˆ¬çš„ Java ç±»å¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰æŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡ç±»å¤§å¤šç”¨äºæŠ½å–ç›¸å…³ Java ç±»çš„å…±ç”¨æ–¹æ³•å®ç°æˆ–è€…æ˜¯å…±åŒæˆå‘˜å˜é‡ï¼Œç„¶åé€šè¿‡ç»§æ‰¿çš„æ–¹å¼è¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ã€‚</p>
<p>Java æ ‡å‡†åº“ä¸­ï¼Œæ¯”å¦‚  <code>collection</code>  æ¡†æ¶ï¼Œå¾ˆå¤šé€šç”¨éƒ¨åˆ†å°±è¢«æŠ½å–æˆä¸ºæŠ½è±¡ç±»ï¼Œä¾‹å¦‚  <code>java.util.AbstractList</code> ã€‚</p>
<ol>
<li>æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ– (åˆå­¦è€…å¾ˆå®¹æ˜“çŠ¯çš„é”™)ï¼Œå¦‚æœè¢«å®ä¾‹åŒ–ï¼Œå°±ä¼šæŠ¥é”™ï¼Œç¼–è¯‘æ— æ³•é€šè¿‡ã€‚åªæœ‰æŠ½è±¡ç±»çš„éæŠ½è±¡å­ç±»å¯ä»¥åˆ›å»ºå¯¹è±¡ã€‚</li>
<li>æŠ½è±¡ç±»ä¸­ä¸ä¸€å®šåŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å¿…å®šæ˜¯æŠ½è±¡ç±»ã€‚</li>
<li>æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•åªæ˜¯å£°æ˜ï¼Œä¸åŒ…å«æ–¹æ³•ä½“ï¼Œå°±æ˜¯ä¸ç»™å‡ºæ–¹æ³•çš„å…·ä½“å®ç°ä¹Ÿå°±æ˜¯æ–¹æ³•çš„å…·ä½“åŠŸèƒ½ã€‚</li>
<li>æ„é€ æ–¹æ³•ï¼Œç±»æ–¹æ³•ï¼ˆç”¨ static ä¿®é¥°çš„æ–¹æ³•ï¼‰ä¸èƒ½å£°æ˜ä¸ºæŠ½è±¡æ–¹æ³•ã€‚</li>
<li>æŠ½è±¡ç±»çš„å­ç±»å¿…é¡»ç»™å‡ºæŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œé™¤éè¯¥å­ç±»ä¹Ÿæ˜¯æŠ½è±¡ç±»ã€‚</li>
</ol>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-æ–¹æ³•"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-æ–¹æ³•">#</a> æ·±å…¥ç†è§£ Java æ–¹æ³•</h1>
<blockquote>
<p><strong>æ–¹æ³•ï¼ˆæœ‰çš„äººå–œæ¬¢å«å‡½æ•°ï¼‰æ˜¯ä¸€æ®µå¯é‡ç”¨çš„ä»£ç æ®µã€‚</strong></p>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. æ–¹æ³•çš„ä½¿ç”¨
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#11-%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89">1.1. æ–¹æ³•å®šä¹‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#12-%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8">1.2. æ–¹æ³•çš„è°ƒç”¨</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#2-%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0">2. æ–¹æ³•å‚æ•°</a></li>
<li>\3. æ–¹æ³•ä¿®é¥°ç¬¦
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#31-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E4%BF%AE%E9%A5%B0%E7%AC%A6">3.1. è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#32-static">3.2. static</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#33-final">3.3. final</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#34-default">3.4. default</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#35-abstract">3.5. abstract</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#36-synchronized">3.6. synchronized</a></li>
</ul>
</li>
<li>\4. ç‰¹æ®Šæ–¹æ³•
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#41-main-%E6%96%B9%E6%B3%95">4.1. main æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#42-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">4.2. æ„é€ æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#43-%E5%8F%98%E5%8F%82%E6%96%B9%E6%B3%95">4.3. å˜å‚æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#44-finalize-%E6%96%B9%E6%B3%95">4.4. finalize () æ–¹æ³•</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#5-%E8%A6%86%E5%86%99%E5%92%8C%E9%87%8D%E8%BD%BD">5. è¦†å†™å’Œé‡è½½</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#6-%E5%B0%8F%E7%BB%93">6. å°ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-54"><a class="markdownIt-Anchor" href="#-54">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_1-%E6%96%B9%E6%B3%95%E7%9A%84%E4%BD%BF%E7%94%A8">#</a>1. æ–¹æ³•çš„ä½¿ç”¨</h2>
<h3 id="-55"><a class="markdownIt-Anchor" href="#-55">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_1-1-%E6%96%B9%E6%B3%95%E5%AE%9A%E4%B9%89">#</a>1.1. æ–¹æ³•å®šä¹‰</h3>
<p>æ–¹æ³•å®šä¹‰è¯­æ³•æ ¼å¼ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">[ä¿®é¥°ç¬¦] è¿”å›å€¼ç±»å‹ æ–¹æ³•å([å‚æ•°ç±»å‹ å‚æ•°å])&#123;
    ...
    æ–¹æ³•ä½“
    ...
    return è¿”å›å€¼;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ–¹æ³•åŒ…å«ä¸€ä¸ªæ–¹æ³•å¤´å’Œä¸€ä¸ªæ–¹æ³•ä½“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ–¹æ³•çš„æ‰€æœ‰éƒ¨åˆ†ï¼š</p>
<ul>
<li><strong>ä¿®é¥°ç¬¦</strong> - ä¿®é¥°ç¬¦æ˜¯å¯é€‰çš„ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•è°ƒç”¨è¯¥æ–¹æ³•ã€‚å®šä¹‰äº†è¯¥æ–¹æ³•çš„è®¿é—®ç±»å‹ã€‚</li>
<li><strong>è¿”å›å€¼ç±»å‹</strong> - è¿”å›å€¼ç±»å‹è¡¨ç¤ºæ–¹æ³•æ‰§è¡Œç»“æŸåï¼Œè¿”å›ç»“æœçš„æ•°æ®ç±»å‹ã€‚å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œåº”è®¾ä¸º voidã€‚</li>
<li><strong>æ–¹æ³•å</strong> - æ˜¯æ–¹æ³•çš„å®é™…åç§°ã€‚æ–¹æ³•åå’Œå‚æ•°è¡¨å…±åŒæ„æˆæ–¹æ³•ç­¾åã€‚</li>
<li><strong>å‚æ•°ç±»å‹</strong> - å‚æ•°åƒæ˜¯ä¸€ä¸ªå ä½ç¬¦ã€‚å½“æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼ é€’å€¼ç»™å‚æ•°ã€‚å‚æ•°åˆ—è¡¨æ˜¯æŒ‡æ–¹æ³•çš„å‚æ•°ç±»å‹ã€é¡ºåºå’Œå‚æ•°çš„ä¸ªæ•°ã€‚å‚æ•°æ˜¯å¯é€‰çš„ï¼Œæ–¹æ³•å¯ä»¥ä¸åŒ…å«ä»»ä½•å‚æ•°ã€‚</li>
<li><strong>æ–¹æ³•ä½“</strong> - æ–¹æ³•ä½“åŒ…å«å…·ä½“çš„è¯­å¥ï¼Œå®šä¹‰è¯¥æ–¹æ³•çš„åŠŸèƒ½ã€‚</li>
<li><strong>return</strong> - å¿…é¡»è¿”å›å£°æ˜æ–¹æ³•æ—¶è¿”å›å€¼ç±»å‹ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚åœ¨ void æ–¹æ³•ä¸­ï¼Œreturn è¯­å¥å¯æœ‰å¯æ— ï¼Œå¦‚æœè¦å†™ returnï¼Œåˆ™åªèƒ½æ˜¯  <code>return;</code>  è¿™ç§å½¢å¼ã€‚</li>
</ul>
<h3 id="-56"><a class="markdownIt-Anchor" href="#-56">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_1-2-%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8">#</a>1.2. æ–¹æ³•çš„è°ƒç”¨</h3>
<p>å½“ç¨‹åºè°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œç¨‹åºçš„æ§åˆ¶æƒäº¤ç»™äº†è¢«è°ƒç”¨çš„æ–¹æ³•ã€‚å½“è¢«è°ƒç”¨æ–¹æ³•çš„è¿”å›è¯­å¥æ‰§è¡Œæˆ–è€…åˆ°è¾¾æ–¹æ³•ä½“é—­æ‹¬å·æ—¶å€™äº¤è¿˜æ§åˆ¶æƒç»™ç¨‹åºã€‚</p>
<p>Java æ”¯æŒä¸¤ç§è°ƒç”¨æ–¹æ³•çš„æ–¹å¼ï¼Œæ ¹æ®æ–¹æ³•æ˜¯å¦æœ‰è¿”å›å€¼æ¥é€‰æ‹©ã€‚</p>
<ul>
<li>æœ‰è¿”å›å€¼æ–¹æ³• - æœ‰è¿”å›å€¼æ–¹æ³•é€šå¸¸è¢«ç”¨æ¥ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼æˆ–ä»£å…¥åˆ°è¿ç®—è¡¨è¾¾å¼ä¸­è¿›è¡Œè®¡ç®—ã€‚</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">int larger = max(30, 40);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>æ— è¿”å›å€¼æ–¹æ³• - æ— è¿”å›å€¼æ–¹æ³•åªèƒ½æ˜¯ä¸€æ¡è¯­å¥ã€‚</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">System.out.println("Hello World");<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="-57"><a class="markdownIt-Anchor" href="#-57">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#%E9%80%92%E5%BD%92%E8%B0%83%E7%94%A8">#</a>é€’å½’è°ƒç”¨</h4>
<p>Java æ”¯æŒæ–¹æ³•çš„é€’å½’è°ƒç”¨ï¼ˆå³æ–¹æ³•è°ƒç”¨è‡ªèº«ï¼‰ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š</p>
<ul>
<li>é€’å½’æ–¹æ³•å¿…é¡»æœ‰æ˜ç¡®çš„ç»“æŸæ¡ä»¶ã€‚</li>
<li>å°½é‡é¿å…ä½¿ç”¨é€’å½’è°ƒç”¨ã€‚å› ä¸ºé€’å½’è°ƒç”¨å¦‚æœå¤„ç†ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´æ ˆæº¢å‡ºã€‚</li>
</ul>
</blockquote>
<p>æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆä¸€ä¸ªå…¸å‹çš„é€’å½’ç®—æ³•ï¼‰ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecursionMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> num <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">fib</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fib</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token function">fib</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-58"><a class="markdownIt-Anchor" href="#-58">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_2-%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0">#</a>2. æ–¹æ³•å‚æ•°</h2>
<p>åœ¨ C/C++ ç­‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ–¹æ³•çš„å‚æ•°ä¼ é€’ä¸€èˆ¬æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li>å€¼ä¼ é€’ - å€¼ä¼ é€’çš„å‚æ•°è¢«ç§°ä¸ºå½¢å‚ã€‚å€¼ä¼ é€’æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ï¼Œåœ¨æ–¹æ³•ä¸­çš„ä¿®æ”¹ï¼Œä¸ä¼šåœ¨æ–¹æ³•å¤–éƒ¨ç”Ÿæ•ˆã€‚</li>
<li>å¼•ç”¨ä¼ é€’ - å¼•ç”¨ä¼ é€’çš„å‚æ•°è¢«ç§°ä¸ºå®å‚ã€‚å¼•ç”¨ä¼ é€’æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ï¼Œåœ¨æ–¹æ³•ä¸­çš„ä¿®æ”¹ï¼Œä¼šåœ¨æ–¹æ³•å¤–éƒ¨ç”Ÿæ•ˆã€‚</li>
</ul>
<p>é‚£ä¹ˆï¼ŒJava ä¸­æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p><strong>Java ä¸­åªæœ‰å€¼ä¼ é€’ã€‚</strong></p>
<p>ç¤ºä¾‹ä¸€ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodParamDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        value <span class="token operator">=</span>  value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">method</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"num = ["</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"num = ["</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// num = [0]</span>
<span class="token comment">// num = [0]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¤ºä¾‹äºŒï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodParamDemo2</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span> sb<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sb = ["</span> <span class="token operator">+</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method</span><span class="token punctuation">(</span>sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sb = ["</span> <span class="token operator">+</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sb = ["</span> <span class="token operator">+</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// sb = [A]</span>
<span class="token comment">// sb = [A]</span>
<span class="token comment">// sb = [C]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<p>ä»¥ä¸Šä¸¤ä¸ªç¤ºä¾‹ï¼Œæ— è®ºå‘æ–¹æ³•ä¸­ä¼ å…¥çš„æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œè¿˜æ˜¯å¼•ç”¨ç±»å‹ï¼Œåœ¨æ–¹æ³•ä¸­ä¿®æ”¹çš„å€¼ï¼Œåœ¨å¤–éƒ¨éƒ½æœªç”Ÿæ•ˆã€‚</p>
<p>Java å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¼šç›´æ¥æ‹·è´å€¼ä¼ é€’åˆ°æ–¹æ³•ä¸­ï¼›å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ‹·è´å½“å‰å¯¹è±¡çš„å¼•ç”¨åœ°å€ï¼Œç„¶åæŠŠè¯¥åœ°å€ä¼ é€’è¿‡å»ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯å€¼ä¼ é€’ã€‚</p>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/24556934?refer=dreawer">å›¾è§£ Java ä¸­çš„å‚æ•°ä¼ é€’ (opens new window)</a></p>
</blockquote>
<h2 id="-59"><a class="markdownIt-Anchor" href="#-59">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_3-%E6%96%B9%E6%B3%95%E4%BF%AE%E9%A5%B0%E7%AC%A6">#</a>3. æ–¹æ³•ä¿®é¥°ç¬¦</h2>
<p>å‰é¢æåˆ°äº†ï¼ŒJava æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯å¯é€‰çš„ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•è°ƒç”¨è¯¥æ–¹æ³•ã€‚å®šä¹‰äº†è¯¥æ–¹æ³•çš„è®¿é—®ç±»å‹ã€‚</p>
<p>Java æ–¹æ³•æœ‰å¥½å‡ ä¸ªä¿®é¥°ç¬¦ï¼Œè®©æˆ‘ä»¬ä¸€ä¸€æ¥è®¤è¯†ä¸€ä¸‹ï¼š</p>
<h3 id="-60"><a class="markdownIt-Anchor" href="#-60">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_3-1-%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E4%BF%AE%E9%A5%B0%E7%AC%A6">#</a>3.1. è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦</h3>
<p>è®¿é—®æƒé™æ§åˆ¶çš„ç­‰çº§ï¼Œä»æœ€å¤§æƒé™åˆ°æœ€å°æƒé™ä¾æ¬¡ä¸ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">public > protected > åŒ…è®¿é—®æƒé™ï¼ˆæ²¡æœ‰ä»»ä½•å…³é”®å­—ï¼‰> private<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>public</code>  - è¡¨ç¤ºä»»ä½•ç±»éƒ½å¯ä»¥è®¿é—®ï¼›</li>
<li><code>åŒ…è®¿é—®æƒé™</code>  - åŒ…è®¿é—®æƒé™ï¼Œæ²¡æœ‰ä»»ä½•å…³é”®å­—ã€‚å®ƒè¡¨ç¤ºå½“å‰åŒ…ä¸­çš„æ‰€æœ‰å…¶ä»–ç±»éƒ½å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å…¶å®ƒåŒ…çš„ç±»æ— æ³•è®¿é—®ã€‚</li>
<li><code>protected</code>  - è¡¨ç¤ºå­ç±»å¯ä»¥è®¿é—®ï¼Œæ­¤å¤–ï¼ŒåŒä¸€ä¸ªåŒ…å†…çš„å…¶ä»–ç±»ä¹Ÿå¯ä»¥è®¿é—®ï¼Œå³ä½¿è¿™äº›ç±»ä¸æ˜¯å­ç±»ã€‚</li>
<li><code>private</code>  - è¡¨ç¤ºå…¶å®ƒä»»ä½•ç±»éƒ½æ— æ³•è®¿é—®ã€‚</li>
</ul>
<h3 id="-61"><a class="markdownIt-Anchor" href="#-61">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_3-2-static">#</a>3.2. static</h3>
<p><strong>è¢«  <code>static</code>  ä¿®é¥°çš„æ–¹æ³•è¢«ç§°ä¸ºé™æ€æ–¹æ³•ã€‚</strong></p>
<p>é™æ€æ–¹æ³•ç›¸æ¯”äºæ™®é€šçš„å®ä¾‹æ–¹æ³•ï¼Œä¸»è¦æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p>
<ul>
<li>åœ¨å¤–éƒ¨è°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨  <code>ç±»å.æ–¹æ³•å</code>  çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨  <code>å¯¹è±¡å.æ–¹æ³•å</code>  çš„æ–¹å¼ã€‚è€Œå®ä¾‹æ–¹æ³•åªæœ‰åé¢è¿™ç§æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>è°ƒç”¨é™æ€æ–¹æ³•å¯ä»¥æ— éœ€åˆ›å»ºå¯¹è±¡</strong>ã€‚</li>
<li><strong>é™æ€æ–¹æ³•åœ¨è®¿é—®æœ¬ç±»çš„æˆå‘˜æ—¶ï¼Œåªå…è®¸è®¿é—®é™æ€æˆå‘˜</strong>ï¼ˆå³é™æ€æˆå‘˜å˜é‡å’Œé™æ€æ–¹æ³•ï¼‰ï¼Œè€Œä¸å…è®¸è®¿é—®å®ä¾‹æˆå‘˜å˜é‡å’Œå®ä¾‹æ–¹æ³•ï¼›å®ä¾‹æ–¹æ³•åˆ™æ— æ­¤é™åˆ¶ã€‚</li>
</ul>
<p>é™æ€æ–¹æ³•å¸¸è¢«ç”¨äºå„ç§å·¥å…·ç±»ã€å·¥å‚æ–¹æ³•ç±»ã€‚</p>
<h3 id="-62"><a class="markdownIt-Anchor" href="#-62">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_3-3-final">#</a>3.3. final</h3>
<p>è¢«  <code>final</code>  ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«å­ç±»è¦†å†™ï¼ˆOverrideï¼‰ã€‚</p>
<p>final æ–¹æ³•ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinalMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"call Father print()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"call print()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Father</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        demo<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ç¼–è¯‘æ—¶ä¼šæŠ¥é”™</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œçˆ¶ç±» Father ä¸­å®šä¹‰äº†ä¸€ä¸ª  <code>final</code>  æ–¹æ³•  <code>print()</code> ï¼Œåˆ™å…¶å­ç±»ä¸èƒ½ Override è¿™ä¸ª final æ–¹æ³•ï¼Œå¦åˆ™ä¼šç¼–è¯‘æŠ¥é”™ã€‚</p>
</blockquote>
<h3 id="-63"><a class="markdownIt-Anchor" href="#-63">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_3-4-default">#</a>3.4. default</h3>
<p>JDK8 å¼€å§‹ï¼Œæ”¯æŒåœ¨æ¥å£  <code>Interface</code>  ä¸­å®šä¹‰  <code>default</code>  æ–¹æ³•ã€‚<strong> <code>default</code>  æ–¹æ³•åªèƒ½å‡ºç°åœ¨æ¥å£  <code>Interface</code>  ä¸­</strong>ã€‚</p>
<p><strong>æ¥å£ä¸­è¢«  <code>default</code>  ä¿®é¥°çš„æ–¹æ³•è¢«ç§°ä¸ºé»˜è®¤æ–¹æ³•ï¼Œå®ç°æ­¤æ¥å£çš„ç±»å¦‚æœæ²¡ Override æ­¤æ–¹æ³•ï¼Œåˆ™ç›´æ¥ç»§æ‰¿è¿™ä¸ªæ–¹æ³•ï¼Œä¸å†å¼ºåˆ¶å¿…é¡»å®ç°æ­¤æ–¹æ³•ã€‚</strong></p>
<p>default æ–¹æ³•è¯­æ³•çš„å‡ºç°ï¼Œæ˜¯ä¸ºäº†æ—¢æœ‰çš„æˆåƒä¸Šä¸‡çš„ Java ç±»åº“çš„ç±»å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œ ä¸”ä¸å¿…å¯¹è¿™äº›ç±»é‡æ–°è¿›è¡Œè®¾è®¡ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼ŒJDK8 ä¸­  <code>Collection</code>  ç±»ä¸­æœ‰ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„  <code>stream()</code>  æ–¹æ³•ï¼Œå°±æ˜¯è¢«ä¿®é¥°ä¸º  <code>default</code> ï¼ŒCollection çš„ä¸€å¤§å † Listã€Set å­ç±»å°±ç›´æ¥ç»§æ‰¿äº†è¿™ä¸ªæ–¹æ³• Iï¼Œä¸å¿…å†ä¸ºæ¯ä¸ªå­ç±»éƒ½æ³¨æ„æ·»åŠ è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p><code>default</code>  æ–¹æ³•ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">interface</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">implements</span> <span class="token class-name">MyInterface</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MyInterface</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// Hello World</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-64"><a class="markdownIt-Anchor" href="#-64">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_3-5-abstract">#</a>3.5. abstract</h3>
<p><strong>è¢«  <code>abstract</code>  ä¿®é¥°çš„æ–¹æ³•è¢«ç§°ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œæ–¹æ³•ä¸èƒ½æœ‰å®ä½“ã€‚æŠ½è±¡æ–¹æ³•åªèƒ½å‡ºç°æŠ½è±¡ç±»ä¸­ã€‚</strong></p>
<p>æŠ½è±¡æ–¹æ³•ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AbstractMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractClass</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteClass</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractClass</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"call print()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">AbstractClass</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        demo<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span class="token comment">// Outpu:</span>
<span class="token comment">// call print()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-65"><a class="markdownIt-Anchor" href="#-65">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_3-6-synchronized">#</a>3.6. synchronized</h3>
<p><code>synchronized</code>  ç”¨äºå¹¶å‘ç¼–ç¨‹ã€‚<strong>è¢«  <code>synchronized</code>  ä¿®é¥°çš„æ–¹æ³•åœ¨ä¸€ä¸ªæ—¶åˆ»ï¼Œåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚</strong></p>
<p>åœ¨ Java çš„åŒæ­¥å®¹å™¨ï¼ˆVectorã€Stackã€HashTableï¼‰ä¸­ï¼Œä½ ä¼šè§åˆ°å¤§é‡çš„ synchronized æ–¹æ³•ã€‚ä¸è¿‡ï¼Œè¯·è®°ä½ï¼šåœ¨ Java å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œsynchronized æ–¹æ³•å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ›´åŠ è½»é‡çº§çš„é” ã€‚</p>
<h2 id="-66"><a class="markdownIt-Anchor" href="#-66">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_4-%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95">#</a>4. ç‰¹æ®Šæ–¹æ³•</h2>
<p>Java ä¸­ï¼Œæœ‰ä¸€äº›è¾ƒä¸ºç‰¹æ®Šçš„æ–¹æ³•ï¼Œåˆ†åˆ«ä½¿ç”¨äºç‰¹æ®Šçš„åœºæ™¯ã€‚</p>
<h3 id="-67"><a class="markdownIt-Anchor" href="#-67">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_4-1-main-%E6%96%B9%E6%B3%95">#</a>4.1. main æ–¹æ³•</h3>
<p>Java ä¸­çš„ main æ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„é™æ€æ–¹æ³•ï¼Œå› ä¸ºæ‰€æœ‰çš„ Java ç¨‹åºéƒ½æ˜¯ç”±  <code>public static void main(String[] args)</code>  æ–¹æ³•å¼€å§‹æ‰§è¡Œã€‚</p>
<p>æœ‰å¾ˆå¤šæ–°æ‰‹è™½ç„¶ä¸€ç›´ç”¨ main æ–¹æ³•ï¼Œå´ä¸çŸ¥é“ main æ–¹æ³•ä¸­çš„ args æœ‰ä»€ä¹ˆç”¨ã€‚å®é™…ä¸Šï¼Œè¿™æ˜¯ç”¨æ¥æ¥æ”¶æ¥æ”¶å‘½ä»¤è¡Œè¾“å…¥å‚æ•°çš„ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> arg <span class="token operator">:</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"arg = ["</span> <span class="token operator">+</span> arg <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¾æ¬¡æ‰§è¡Œ</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">javac MainMethodDemo.java
java MainMethodDemo A B C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ§åˆ¶å°ä¼šæ‰“å°è¾“å‡ºå‚æ•°ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">arg = [A]
arg = [B]
arg = [C]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="-68"><a class="markdownIt-Anchor" href="#-68">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_4-2-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">#</a>4.2. æ„é€ æ–¹æ³•</h3>
<p>ä»»ä½•ç±»éƒ½æœ‰æ„é€ æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•çš„ä½œç”¨å°±æ˜¯åœ¨åˆå§‹åŒ–ç±»å®ä¾‹æ—¶ï¼Œè®¾ç½®å®ä¾‹çš„çŠ¶æ€ã€‚</p>
<p>æ¯ä¸ªç±»éƒ½æœ‰æ„é€ æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°ä¸ºç±»å®šä¹‰ä»»ä½•æ„é€ æ–¹æ³•ï¼ŒJava ç¼–è¯‘å™¨å°†ä¼šä¸ºè¯¥ç±»æä¾›ä¸€ä¸ªé»˜è®¤æ„é€ æ–¹æ³•ã€‚</p>
<p>åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œè‡³å°‘è¦è°ƒç”¨ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚æ„é€ æ–¹æ³•çš„åç§°å¿…é¡»ä¸ç±»åŒåï¼Œä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConstructorMethodDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"jack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"person name is "</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨æ„ï¼Œæ„é€ æ–¹æ³•é™¤äº†ä½¿ç”¨ publicï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ private ä¿®é¥°ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç±»æ— æ³•è°ƒç”¨æ­¤æ„é€ æ–¹æ³•å»å®ä¾‹åŒ–å¯¹è±¡ï¼Œè¿™å¸¸å¸¸ç”¨äºè®¾è®¡æ¨¡å¼ä¸­çš„å•ä¾‹æ¨¡å¼ã€‚</p>
<h3 id="-69"><a class="markdownIt-Anchor" href="#-69">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_4-3-%E5%8F%98%E5%8F%82%E6%96%B9%E6%B3%95">#</a>4.3. å˜å‚æ–¹æ³•</h3>
<p>JDK5 å¼€å§‹ï¼ŒJava æ”¯æŒä¼ é€’åŒç±»å‹çš„å¯å˜å‚æ•°ç»™ä¸€ä¸ªæ–¹æ³•ã€‚åœ¨æ–¹æ³•å£°æ˜ä¸­ï¼Œåœ¨æŒ‡å®šå‚æ•°ç±»å‹ååŠ ä¸€ä¸ªçœç•¥å·  <code>...</code> ã€‚ä¸€ä¸ªæ–¹æ³•ä¸­åªèƒ½æŒ‡å®šä¸€ä¸ªå¯å˜å‚æ•°ï¼Œå®ƒå¿…é¡»æ˜¯æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚ä»»ä½•æ™®é€šçš„å‚æ•°å¿…é¡»åœ¨å®ƒä¹‹å‰å£°æ˜ã€‚</p>
<p>å˜å‚æ–¹æ³•ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">public class VarargsDemo &#123;
    public static void method(String... params) &#123;
        System.out.println("params.length = " + params.length);
        for (String param : params) &#123;
            System.out.println("params = [" + param + "]");
        &#125;
    &#125;

    public static void main(String[] args) &#123;
        method("red");
        method("red", "yellow");
        method("red", "yellow", "blue");
    &#125;
&#125;
// Output:
// params.length = 1
// params = [red]
// params.length = 2
// params = [red]
// params = [yellow]
// params.length = 3
// params = [red]
// params = [yellow]
// params = [blue]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-70"><a class="markdownIt-Anchor" href="#-70">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_4-4-finalize-%E6%96%B9%E6%B3%95">#</a>4.4. finalize () æ–¹æ³•</h3>
<p><code>finalize</code>  åœ¨å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨ææ„ (å›æ”¶) ä¹‹å‰è°ƒç”¨ï¼Œç”¨æ¥æ¸…é™¤å›æ”¶å¯¹è±¡ã€‚</p>
<p><code>finalize</code>  æ˜¯åœ¨  <code>java.lang.Object</code>  é‡Œå®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰è¿™ä¹ˆä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•åœ¨ GC å¯åŠ¨ï¼Œè¯¥å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™è¢«è°ƒç”¨ã€‚</p>
<p>finalizer () é€šå¸¸æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œä¹Ÿæ˜¯å¾ˆå±é™©çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸å¿…è¦çš„ã€‚ä½¿ç”¨ç»ˆç»“æ–¹æ³•ä¼šå¯¼è‡´è¡Œä¸ºä¸ç¨³å®šã€é™ä½æ€§èƒ½ï¼Œä»¥åŠå¯ç§»æ¤æ€§é—®é¢˜ã€‚</p>
<p><strong>è¯·è®°ä½ï¼šåº”è¯¥å°½é‡é¿å…ä½¿ç”¨  <code>finalizer()</code> </strong>ã€‚åƒä¸‡ä¸è¦æŠŠå®ƒå½“æˆæ˜¯ C/C++ ä¸­çš„ææ„å‡½æ•°æ¥ç”¨ã€‚åŸå› æ˜¯ï¼š<strong>Finalizer çº¿ç¨‹ä¼šå’Œæˆ‘ä»¬çš„ä¸»çº¿ç¨‹è¿›è¡Œç«äº‰ï¼Œä¸è¿‡ç”±äºå®ƒçš„ä¼˜å…ˆçº§è¾ƒä½ï¼Œè·å–åˆ°çš„ CPU æ—¶é—´è¾ƒå°‘ï¼Œå› æ­¤å®ƒæ°¸è¿œä¹Ÿèµ¶ä¸ä¸Šä¸»çº¿ç¨‹çš„æ­¥ä¼ã€‚æ‰€ä»¥æœ€åå¯èƒ½ä¼šå‘ç”Ÿ OutOfMemoryError å¼‚å¸¸ã€‚</strong></p>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š</p>
<p>ä¸‹é¢ä¸¤ç¯‡æ–‡ç« æ¯”è¾ƒè¯¦ç»†çš„è®²è¿°äº† finalizer () å¯èƒ½ä¼šé€ æˆçš„é—®é¢˜åŠåŸå› ã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/benwu/articles/5812903.html">Java çš„ Finalizer å¼•å‘çš„å†…å­˜æº¢å‡º (opens new window)</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/27850176">é‡è½½ Finalize å¼•å‘çš„å†…å­˜æ³„éœ² (opens new window)</a></li>
</ul>
</blockquote>
<h2 id="-71"><a class="markdownIt-Anchor" href="#-71">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_5-%E8%A6%86%E5%86%99%E5%92%8C%E9%87%8D%E8%BD%BD">#</a>5. è¦†å†™å’Œé‡è½½</h2>
<p><strong>è¦†å†™ï¼ˆOverrideï¼‰æ˜¯æŒ‡å­ç±»å®šä¹‰äº†ä¸çˆ¶ç±»ä¸­åŒåçš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨æ–¹æ³•è¦†å†™æ—¶å¿…é¡»è€ƒè™‘åˆ°è®¿é—®æƒé™ï¼Œå­ç±»è¦†å†™çš„æ–¹æ³•ä¸èƒ½æ‹¥æœ‰æ¯”çˆ¶ç±»æ›´åŠ ä¸¥æ ¼çš„è®¿é—®æƒé™ã€‚</strong></p>
<p>å­ç±»è¦è¦†å†™çš„æ–¹æ³•å¦‚æœè¦è®¿é—®çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨  <code>super</code>  å…³é”®å­—ã€‚</p>
<p>è¦†å†™ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodOverrideDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¼šåŠ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¼šè·‘"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Animal</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dog<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// ä¼šåŠ¨</span>
<span class="token comment">// ä¼šè·‘</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æ–¹æ³•çš„é‡è½½ï¼ˆOverloadï¼‰æ˜¯æŒ‡æ–¹æ³•åç§°ç›¸åŒï¼Œä½†å‚æ•°çš„ç±»å‹æˆ–å‚æ•°çš„ä¸ªæ•°ä¸åŒã€‚é€šè¿‡ä¼ é€’å‚æ•°çš„ä¸ªæ•°åŠç±»å‹çš„ä¸åŒå¯ä»¥å®Œæˆä¸åŒåŠŸèƒ½çš„æ–¹æ³•è°ƒç”¨ã€‚</strong></p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š</p>
<p>é‡è½½ä¸€å®šæ˜¯æ–¹æ³•çš„å‚æ•°ä¸å®Œå…¨ç›¸åŒã€‚å¦‚æœæ–¹æ³•çš„å‚æ•°å®Œå…¨ç›¸åŒï¼Œä»…ä»…æ˜¯è¿”å›å€¼ä¸åŒï¼ŒJava æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ã€‚</p>
</blockquote>
<p>é‡è½½ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodOverloadDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"x + y = "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"x + y = "</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// x + y = 30</span>
<span class="token comment">// x + y = 3.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-72"><a class="markdownIt-Anchor" href="#-72">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-method.html#_6-%E5%B0%8F%E7%BB%93">#</a>6. å°ç»“</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553767582595.png" alt="img"></p>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-æ•°ç»„"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-æ•°ç»„">#</a> æ·±å…¥ç†è§£ Java æ•°ç»„</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#11-%E6%95%B0%E7%BB%84%E7%9A%84%E7%89%B9%E6%80%A7">1.1. æ•°ç»„çš„ç‰¹æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#12-%E6%95%B0%E7%BB%84%E5%92%8C%E5%AE%B9%E5%99%A8">1.2. æ•°ç»„å’Œå®¹å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#13-java-%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%AC%E8%B4%A8%E6%98%AF%E5%AF%B9%E8%B1%A1">1.3. Java æ•°ç»„çš„æœ¬è´¨æ˜¯å¯¹è±¡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#14-java-%E6%95%B0%E7%BB%84%E5%92%8C%E5%86%85%E5%AD%98">1.4. Java æ•°ç»„å’Œå†…å­˜</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#2-%E5%A3%B0%E6%98%8E%E6%95%B0%E7%BB%84">2. å£°æ˜æ•°ç»„</a></li>
<li>\3. åˆ›å»ºæ•°ç»„
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#31-%E6%95%B0%E7%BB%84%E7%BB%B4%E5%BA%A6%E7%9A%84%E5%BD%A2%E5%BC%8F">3.1. æ•°ç»„ç»´åº¦çš„å½¢å¼</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#32-%E6%95%B0%E7%BB%84%E7%BB%B4%E5%BA%A6%E7%9A%84%E5%A4%A7%E5%B0%8F">3.2. æ•°ç»„ç»´åº¦çš„å¤§å°</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#4-%E8%AE%BF%E9%97%AE%E6%95%B0%E7%BB%84">4. è®¿é—®æ•°ç»„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#5-%E6%95%B0%E7%BB%84%E7%9A%84%E5%BC%95%E7%94%A8">5. æ•°ç»„çš„å¼•ç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#6-%E6%B3%9B%E5%9E%8B%E5%92%8C%E6%95%B0%E7%BB%84">6. æ³›å‹å’Œæ•°ç»„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#7-%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84">7. å¤šç»´æ•°ç»„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#8-arrays-%E7%B1%BB">8. Arrays ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#9-%E5%B0%8F%E7%BB%93">9. å°ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#10-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">10. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-73"><a class="markdownIt-Anchor" href="#-73">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_1-%E7%AE%80%E4%BB%8B">#</a>1. ç®€ä»‹</h2>
<h3 id="-74"><a class="markdownIt-Anchor" href="#-74">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_1-1-%E6%95%B0%E7%BB%84%E7%9A%84%E7%89%B9%E6%80%A7">#</a>1.1. æ•°ç»„çš„ç‰¹æ€§</h3>
<p>æ•°ç»„å¯¹äºæ¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€æ¥è¯´éƒ½æ˜¯é‡è¦çš„æ•°æ®ç»“æ„ä¹‹ä¸€ï¼Œå½“ç„¶ä¸åŒè¯­è¨€å¯¹æ•°ç»„çš„å®ç°åŠå¤„ç†ä¹Ÿä¸å°½ç›¸åŒã€‚å‡ ä¹æ‰€æœ‰ç¨‹åºè®¾è®¡è¯­è¨€éƒ½æ”¯æŒæ•°ç»„ã€‚</p>
<p>æ•°ç»„ä»£è¡¨ä¸€ç³»åˆ—å¯¹è±¡æˆ–è€…åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ‰€æœ‰ç›¸åŒçš„ç±»å‹éƒ½å°è£…åˆ°ä¸€èµ·ï¼Œé‡‡ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ ‡è¯†ç¬¦åç§°ã€‚</p>
<p><strong>æ•°ç»„çš„å®šä¹‰å’Œä½¿ç”¨éœ€è¦é€šè¿‡æ–¹æ‹¬å·  <code>[]</code> ã€‚</strong></p>
<blockquote>
<p><strong>Java ä¸­ï¼Œæ•°ç»„æ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ã€‚</strong></p>
<p><strong>Java ä¸­ï¼Œæ•°ç»„æ˜¯ç”¨æ¥å­˜å‚¨å›ºå®šå¤§å°çš„åŒç±»å‹å…ƒç´ ã€‚</strong></p>
</blockquote>
<h3 id="-75"><a class="markdownIt-Anchor" href="#-75">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_1-2-%E6%95%B0%E7%BB%84%E5%92%8C%E5%AE%B9%E5%99%A8">#</a>1.2. æ•°ç»„å’Œå®¹å™¨</h3>
<p>Java ä¸­ï¼Œæ—¢ç„¶æœ‰äº†å¼ºå¤§çš„å®¹å™¨ï¼Œæ˜¯ä¸æ˜¯å°±ä¸éœ€è¦æ•°ç»„äº†ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ä¸ã€‚</p>
<p>è¯šç„¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåº”è¯¥é€‰æ‹©å®¹å™¨å­˜å‚¨æ•°æ®ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ•°ç»„ä¹Ÿä¸æ˜¯æ¯«æ— æ˜¯å¤„ï¼š</p>
<ul>
<li>Java ä¸­ï¼Œæ•°ç»„æ˜¯ä¸€ç§æ•ˆç‡æœ€é«˜çš„å­˜å‚¨å’Œéšæœºè®¿é—®å¯¹è±¡å¼•ç”¨åºåˆ—çš„æ–¹å¼ã€‚<strong>æ•°ç»„çš„æ•ˆç‡è¦é«˜äºå®¹å™¨</strong>ï¼ˆå¦‚  <code>ArrayList</code> ï¼‰ã€‚</li>
<li><strong>æ•°ç»„å¯ä»¥æŒæœ‰å€¼ç±»å‹ï¼Œè€Œå®¹å™¨åˆ™ä¸èƒ½</strong>ï¼ˆè¿™æ—¶ï¼Œå°±å¿…é¡»ç”¨åˆ°åŒ…è£…ç±»ï¼‰ã€‚</li>
</ul>
<h3 id="-76"><a class="markdownIt-Anchor" href="#-76">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_1-3-java-%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%AC%E8%B4%A8%E6%98%AF%E5%AF%B9%E8%B1%A1">#</a>1.3. Java æ•°ç»„çš„æœ¬è´¨æ˜¯å¯¹è±¡</h3>
<p><strong>Java æ•°ç»„çš„æœ¬è´¨æ˜¯å¯¹è±¡</strong>ã€‚å®ƒå…·æœ‰ Java ä¸­å…¶ä»–å¯¹è±¡çš„ä¸€äº›åŸºæœ¬ç‰¹ç‚¹ï¼šå°è£…äº†ä¸€äº›æ•°æ®ï¼Œå¯ä»¥è®¿é—®å±æ€§ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œæ•°ç»„æ˜¯å¯¹è±¡ã€‚</p>
<p>å¦‚æœæœ‰ä¸¤ä¸ªç±» A å’Œ Bï¼Œå¦‚æœ B ç»§æ‰¿ï¼ˆextendsï¼‰äº† Aï¼Œé‚£ä¹ˆ A [] ç±»å‹çš„å¼•ç”¨å°±å¯ä»¥æŒ‡å‘ B [] ç±»å‹çš„å¯¹è±¡ã€‚</p>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/zhangjg_blog/article/details/16116613#t1">Java ä¸­æ•°ç»„çš„ç‰¹æ€§ (opens new window)</a></p>
<p>å¦‚æœæƒ³è¦è®ºè¯ <strong>Java æ•°ç»„æœ¬è´¨æ˜¯å¯¹è±¡</strong>ï¼Œä¸å¦¨ä¸€è¯»è¿™ç¯‡æ–‡ç« ã€‚</p>
</blockquote>
<h3 id="-77"><a class="markdownIt-Anchor" href="#-77">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_1-4-java-%E6%95%B0%E7%BB%84%E5%92%8C%E5%86%85%E5%AD%98">#</a>1.4. Java æ•°ç»„å’Œå†…å­˜</h3>
<p>Java æ•°ç»„åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ˜¯è¿™æ ·çš„ï¼š</p>
<p>æ•°ç»„å¯¹è±¡ï¼ˆè¿™é‡Œå¯ä»¥çœ‹æˆä¸€ä¸ªæŒ‡é’ˆï¼‰å­˜å‚¨åœ¨æ ˆä¸­ã€‚</p>
<p>æ•°ç»„å…ƒç´ å­˜å‚¨åœ¨å †ä¸­ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šåªæœ‰å½“ JVM æ‰§è¡Œ  <code>new String[]</code>  æ—¶ï¼Œæ‰ä¼šåœ¨å †ä¸­å¼€è¾Ÿç›¸åº”çš„å†…å­˜åŒºåŸŸã€‚æ•°ç»„å¯¹è±¡ array å¯ä»¥è§†ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¿™å—å†…å­˜çš„å­˜å‚¨åœ°å€ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1552473482942.png" alt="img"></p>
<h2 id="-78"><a class="markdownIt-Anchor" href="#-78">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_2-%E5%A3%B0%E6%98%8E%E6%95%B0%E7%BB%84">#</a>2. å£°æ˜æ•°ç»„</h2>
<p>å£°æ˜æ•°ç»„å˜é‡çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr1<span class="token punctuation">;</span> <span class="token comment">// æ¨èé£æ ¼</span>
<span class="token keyword">int</span> arr2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ•ˆæœç›¸åŒ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-79"><a class="markdownIt-Anchor" href="#-79">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_3-%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84">#</a>3. åˆ›å»ºæ•°ç»„</h2>
<p>Java è¯­è¨€ä½¿ç”¨  <code>new</code>  æ“ä½œç¬¦æ¥åˆ›å»ºæ•°ç»„ã€‚æœ‰ä¸¤ç§åˆ›å»ºæ•°ç»„æ–¹å¼ï¼š</p>
<ul>
<li>æŒ‡å®šæ•°ç»„ç»´åº¦
<ul>
<li>ä¸ºæ•°ç»„å¼€è¾ŸæŒ‡å®šå¤§å°çš„æ•°ç»„ç»´åº¦ã€‚</li>
<li>å¦‚æœæ•°ç»„å…ƒç´ æ˜¯åŸºç¡€æ•°æ®ç±»å‹ï¼Œä¼šå°†æ¯ä¸ªå…ƒç´ è®¾ä¸ºé»˜è®¤å€¼ï¼›å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œå…ƒç´ å€¼ä¸º  <code>null</code> ã€‚</li>
</ul>
</li>
<li>ä¸æŒ‡å®šæ•°ç»„ç»´åº¦
<ul>
<li>ç”¨èŠ±æ‹¬å·ä¸­çš„å®é™…å…ƒç´ åˆå§‹åŒ–æ•°ç»„ï¼Œæ•°ç»„å¤§å°ä¸å…ƒç´ æ•°ç›¸åŒã€‚</li>
</ul>
</li>
</ul>
<p>ç¤ºä¾‹ 1ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æŒ‡å®šæ•°ç»„ç»´åº¦</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// ä¸æŒ‡å®šæ•°ç»„ç»´åº¦</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array1 size is "</span> <span class="token operator">+</span> array1<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> item <span class="token operator">:</span> array1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array2 size is "</span> <span class="token operator">+</span> array1<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> item <span class="token operator">:</span> array2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// array1 size is 2</span>
<span class="token comment">// 0</span>
<span class="token comment">// 0</span>
<span class="token comment">// array2 size is 2</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯´æ˜</strong> è¯·æ³¨æ„æ•°ç»„ array1 ä¸­çš„å…ƒç´ è™½ç„¶æ²¡æœ‰åˆå§‹åŒ–ï¼Œä½†æ˜¯ length å’ŒæŒ‡å®šçš„æ•°ç»„ç»´åº¦æ˜¯ä¸€æ ·çš„ã€‚è¿™è¡¨æ˜<strong>æŒ‡å®šæ•°ç»„ç»´åº¦åï¼Œæ— è®ºåé¢æ˜¯å¦åˆå§‹åŒ–æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæ•°ç»„éƒ½å·²ç»å¼€è¾Ÿäº†ç›¸åº”çš„å†…å­˜</strong>ã€‚</p>
<p>æ•°ç»„ array1 ä¸­çš„å…ƒç´ éƒ½è¢«è®¾ä¸ºé»˜è®¤å€¼ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ 2ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayDemo2</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">User</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æŒ‡å®šæ•°ç»„ç»´åº¦</span>
        <span class="token class-name">User</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// ä¸æŒ‡å®šæ•°ç»„ç»´åº¦</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array1: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> item <span class="token operator">:</span> array1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array2: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> item <span class="token operator">:</span> array2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// array1:</span>
<span class="token comment">// null</span>
<span class="token comment">// null</span>
<span class="token comment">// array2:</span>
<span class="token comment">// io.github.dunwu.javacore.array.ArrayDemo2$User@4141d797</span>
<span class="token comment">// io.github.dunwu.javacore.array.ArrayDemo2$User@68f7aae2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯´æ˜</strong></p>
<p>è¯·å°†æœ¬ä¾‹ä¸ç¤ºä¾‹ 1 æ¯”è¾ƒï¼Œå¯ä»¥å‘ç°ï¼šå¦‚æœä½¿ç”¨æŒ‡å®šæ•°ç»„ç»´åº¦æ–¹å¼åˆ›å»ºæ•°ç»„ï¼Œä¸”æ•°ç»„å…ƒç´ ä¸ºå¼•ç”¨ç±»å‹ï¼Œåˆ™æ•°ç»„ä¸­çš„å…ƒç´ å…ƒç´ å€¼ä¸º  <code>null</code> ã€‚</p>
</blockquote>
<h3 id="-80"><a class="markdownIt-Anchor" href="#-80">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_3-1-%E6%95%B0%E7%BB%84%E7%BB%B4%E5%BA%A6%E7%9A%84%E5%BD%A2%E5%BC%8F">#</a>3.1. æ•°ç»„ç»´åº¦çš„å½¢å¼</h3>
<p>åˆ›å»ºæ•°ç»„æ—¶ï¼ŒæŒ‡å®šçš„æ•°ç»„ç»´åº¦å¯ä»¥æœ‰å¤šç§å½¢å¼ï¼š</p>
<ul>
<li>æ•°ç»„ç»´åº¦å¯ä»¥æ˜¯æ•´æ•°ã€å­—ç¬¦ã€‚</li>
<li>æ•°ç»„ç»´åº¦å¯ä»¥æ˜¯æ•´æ•°å‹ã€å­—ç¬¦å‹å˜é‡ã€‚</li>
<li>æ•°ç»„ç»´åº¦å¯ä»¥æ˜¯è®¡ç®—ç»“æœä¸ºæ•´æ•°æˆ–å­—ç¬¦çš„è¡¨è¾¾å¼ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayDemo3</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token comment">// æ”¾å¼€è¢«æ³¨æ‰çš„ä»£ç ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™</span>
        <span class="token comment">// int[] array = new int[4.0];</span>
        <span class="token comment">// int[] array2 = new int["test"];</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>length <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token string">'a'</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// int[] array7 = new int[length + 2.1];</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array3.length = ["</span> <span class="token operator">+</span> array3<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array4.length = ["</span> <span class="token operator">+</span> array4<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array5.length = ["</span> <span class="token operator">+</span> array5<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array6.length = ["</span> <span class="token operator">+</span> array6<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// array3.length = [97]</span>
<span class="token comment">// array4.length = [3]</span>
<span class="token comment">// array5.length = [5]</span>
<span class="token comment">// array6.length = [99]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯´æ˜</strong></p>
<p>å½“æŒ‡å®šçš„æ•°ç»„ç»´åº¦æ˜¯å­—ç¬¦æ—¶ï¼ŒJava ä¼šå°†å…¶è½¬ä¸ºæ•´æ•°ã€‚å¦‚å­—ç¬¦  <code>a</code>  çš„ ASCII ç æ˜¯ 97ã€‚</p>
<p>ç»¼ä¸Šï¼Œ<strong>Java æ•°ç»„çš„æ•°ç»„ç»´åº¦å¯ä»¥æ˜¯å¸¸é‡ã€å˜é‡ã€è¡¨è¾¾å¼ï¼Œåªè¦è½¬æ¢ä¸ºæ•´æ•°å³å¯</strong>ã€‚</p>
<p>è¯·ç•™æ„ï¼Œæœ‰äº›ç¼–ç¨‹è¯­è¨€åˆ™ä¸æ”¯æŒè¿™ç‚¹ï¼Œå¦‚ C/C++ è¯­è¨€ï¼Œåªå…è®¸æ•°ç»„ç»´åº¦æ˜¯å¸¸é‡ã€‚</p>
</blockquote>
<h3 id="-81"><a class="markdownIt-Anchor" href="#-81">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_3-2-%E6%95%B0%E7%BB%84%E7%BB%B4%E5%BA%A6%E7%9A%84%E5%A4%A7%E5%B0%8F">#</a>3.2. æ•°ç»„ç»´åº¦çš„å¤§å°</h3>
<p><strong>æ•°ç»„ç»´åº¦å¹¶éæ²¡æœ‰ä¸Šé™çš„ï¼Œå¦‚æœæ•°å€¼è¿‡å¤§ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™ã€‚</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">6553612431</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ•°ç»„ç»´åº¦è¿‡å¤§ï¼Œç¼–è¯‘æŠ¥é”™</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ­¤å¤–ï¼Œ<strong>æ•°ç»„è¿‡å¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ ˆæº¢å‡º</strong>ã€‚</p>
<h2 id="-82"><a class="markdownIt-Anchor" href="#-82">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_4-%E8%AE%BF%E9%97%AE%E6%95%B0%E7%BB%84">#</a>4. è®¿é—®æ•°ç»„</h2>
<p><strong>Java ä¸­ï¼Œå¯ä»¥é€šè¿‡åœ¨  <code>[]</code>  ä¸­æŒ‡å®šä¸‹æ ‡ï¼Œè®¿é—®æ•°ç»„å…ƒç´ ï¼Œä¸‹æ ‡ä½ç½®ä» 0 å¼€å§‹ã€‚</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayDemo4</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> array<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"array[%d] = %d"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// array[0] = 2</span>
<span class="token comment">// array[1] = 3</span>
<span class="token comment">// array[2] = 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è¯´æ˜</strong></p>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä» 0 å¼€å§‹ï¼Œä½¿ç”¨ä¸‹æ ‡éå†æ•°ç»„ array çš„æ‰€æœ‰å…ƒç´ ï¼Œä¸ºæ¯ä¸ªå…ƒç´ å€¼åŠ  1 ã€‚</p>
</blockquote>
<h2 id="-83"><a class="markdownIt-Anchor" href="#-83">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_5-%E6%95%B0%E7%BB%84%E7%9A%84%E5%BC%95%E7%94%A8">#</a>5. æ•°ç»„çš„å¼•ç”¨</h2>
<p><strong>Java ä¸­ï¼Œæ•°ç»„ç±»å‹æ˜¯ä¸€ç§å¼•ç”¨ç±»å‹</strong>ã€‚</p>
<p>å› æ­¤ï¼Œå®ƒå¯ä»¥ä½œä¸ºå¼•ç”¨ï¼Œè¢« Java å‡½æ•°<strong>ä½œä¸ºå‡½æ•°å…¥å‚æˆ–è¿”å›å€¼</strong>ã€‚</p>
<p>æ•°ç»„ä½œä¸ºå‡½æ•°å…¥å‚çš„ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayRefDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">:</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">"\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token function">fun</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// 1	3	5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ•°ç»„ä½œä¸ºå‡½æ•°è¿”å›å€¼çš„ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayRefDemo2</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * è¿”å›ä¸€ä¸ªæ•°ç»„
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// [1, 3, 5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-84"><a class="markdownIt-Anchor" href="#-84">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_6-%E6%B3%9B%E5%9E%8B%E5%92%8C%E6%95%B0%E7%BB%84">#</a>6. æ³›å‹å’Œæ•°ç»„</h2>
<p>é€šå¸¸ï¼Œæ•°ç»„å’Œæ³›å‹ä¸èƒ½å¾ˆå¥½åœ°ç»“åˆã€‚ä½ ä¸èƒ½å®ä¾‹åŒ–å…·æœ‰å‚æ•°åŒ–ç±»å‹çš„æ•°ç»„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Peel</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Banana</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> peels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pell</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Banana</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// è¿™è¡Œä»£ç éæ³•</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Java ä¸­ä¸å…è®¸ç›´æ¥åˆ›å»ºæ³›å‹æ•°ç»„ã€‚ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç±»å‹æ“¦é™¤çš„æ•°ç»„ï¼Œç„¶åè½¬å‹çš„æ–¹å¼æ¥åˆ›å»ºæ³›å‹æ•°ç»„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericArrayDemo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GenericArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">GenericArray</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">T</span> item<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            array<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> array<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> array<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>



    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GenericArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> genericArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        genericArray<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        genericArray<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> genericArray<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">deepToString</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// [0, 1, null, null]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiangzhaowei/p/7399522.html">https://www.cnblogs.com/jiangzhaowei/p/7399522.html</a></p>
<p>æˆ‘è®¤ä¸ºï¼Œå¯¹äºæ³›å‹æ•°ç»„çš„ç†è§£ï¼Œç‚¹åˆ°ä¸ºæ­¢å³å¯ã€‚å®é™…ä¸Šï¼ŒçœŸçš„éœ€è¦å­˜å‚¨æ³›å‹ï¼Œè¿˜æ˜¯ä½¿ç”¨å®¹å™¨æ›´åˆé€‚ã€‚</p>
</blockquote>
<h2 id="-85"><a class="markdownIt-Anchor" href="#-85">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_7-%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%84">#</a>7. å¤šç»´æ•°ç»„</h2>
<p>å¤šç»´æ•°ç»„å¯ä»¥çœ‹æˆæ˜¯æ•°ç»„çš„æ•°ç»„ï¼Œæ¯”å¦‚äºŒç»´æ•°ç»„å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¸€ç»´æ•°ç»„ï¼Œå…¶æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ã€‚</p>
<p>Java å¯ä»¥æ”¯æŒäºŒç»´æ•°ç»„ã€ä¸‰ç»´æ•°ç»„ã€å››ç»´æ•°ç»„ã€äº”ç»´æ•°ç»„ã€‚ã€‚ã€‚</p>
<p>ä½†æ˜¯ï¼Œä»¥æ­£å¸¸äººçš„ç†è§£èƒ½åŠ›ï¼Œä¸€èˆ¬ä¹Ÿå°±æœ€å¤šèƒ½ç†è§£ä¸‰ç»´æ•°ç»„ã€‚æ‰€ä»¥ï¼Œè¯·ä¸è¦åšåäººç±»çš„äº‹ï¼Œå»å®šä¹‰è¿‡å¤šç»´åº¦çš„æ•°ç»„ã€‚</p>
<p>å¤šç»´æ•°ç»„ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiArrayDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token comment">// è‡ªåŠ¨è£…ç®±</span>
            <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token class-name">Double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token comment">// è‡ªåŠ¨è£…ç®±</span>
            <span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">3.3</span><span class="token punctuation">,</span> <span class="token number">4.4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span><span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">6.6</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">7.7</span><span class="token punctuation">,</span> <span class="token number">8.8</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span><span class="token number">9.9</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">2.3</span><span class="token punctuation">,</span> <span class="token number">3.4</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#123;</span><span class="token string">"The"</span><span class="token punctuation">,</span> <span class="token string">"Quick"</span><span class="token punctuation">,</span> <span class="token string">"Sly"</span><span class="token punctuation">,</span> <span class="token string">"Fox"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span><span class="token string">"Jumped"</span><span class="token punctuation">,</span> <span class="token string">"Over"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span><span class="token string">"The"</span><span class="token punctuation">,</span> <span class="token string">"Lazy"</span><span class="token punctuation">,</span> <span class="token string">"Brown"</span><span class="token punctuation">,</span> <span class="token string">"Dog"</span><span class="token punctuation">,</span> <span class="token string">"and"</span><span class="token punctuation">,</span> <span class="token string">"friend"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a1: "</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">deepToString</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a2: "</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">deepToString</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"a3: "</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">deepToString</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// a1: [[1, 2, 3], [4, 5, 6]]</span>
<span class="token comment">// a2: [[[1.1, 2.2], [3.3, 4.4]], [[5.5, 6.6], [7.7, 8.8]], [[9.9, 1.2], [2.3, 3.4]]]</span>
<span class="token comment">// a3: [[The, Quick, Sly, Fox], [Jumped, Over], [The, Lazy, Brown, Dog, and, friend]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-86"><a class="markdownIt-Anchor" href="#-86">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_8-arrays-%E7%B1%BB">#</a>8. Arrays ç±»</h2>
<p>Java ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„æ•°ç»„å·¥å…·ç±»ï¼šArraysã€‚</p>
<p>å®ƒæä¾›çš„ä¸»è¦æ“ä½œæœ‰ï¼š</p>
<ul>
<li><code>sort</code>  - æ’åº</li>
<li><code>binarySearch</code>  - æŸ¥æ‰¾</li>
<li><code>equals</code>  - æ¯”è¾ƒ</li>
<li><code>fill</code>  - å¡«å……</li>
<li><code>asList</code>  - è½¬åˆ—è¡¨</li>
<li><code>hash</code>  - å“ˆå¸Œ</li>
<li><code>toString</code>  - è½¬å­—ç¬¦ä¸²</li>
</ul>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/5a6ade5c518825733e60acb8">https://juejin.im/post/5a6ade5c518825733e60acb8</a></p>
</blockquote>
<h2 id="-87"><a class="markdownIt-Anchor" href="#-87">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-array.html#_9-%E5%B0%8F%E7%BB%93">#</a>9. å°ç»“</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/1553753908349.png" alt="img"></p>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-æšä¸¾"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-æšä¸¾">#</a> æ·±å…¥ç†è§£ Java æšä¸¾</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#1-%E7%AE%80%E4%BB%8B">1. ç®€ä»‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#2-%E6%9E%9A%E4%B8%BE%E7%9A%84%E6%9C%AC%E8%B4%A8">2. æšä¸¾çš„æœ¬è´¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#3-%E6%9E%9A%E4%B8%BE%E7%9A%84%E6%96%B9%E6%B3%95">3. æšä¸¾çš„æ–¹æ³•</a></li>
<li>\4. æšä¸¾çš„ç‰¹æ€§
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#41-%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7">4.1. åŸºæœ¬ç‰¹æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#42-%E6%9E%9A%E4%B8%BE%E5%8F%AF%E4%BB%A5%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95">4.2. æšä¸¾å¯ä»¥æ·»åŠ æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#43-%E6%9E%9A%E4%B8%BE%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3">4.3. æšä¸¾å¯ä»¥å®ç°æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#44-%E6%9E%9A%E4%B8%BE%E4%B8%8D%E5%8F%AF%E4%BB%A5%E7%BB%A7%E6%89%BF">4.4. æšä¸¾ä¸å¯ä»¥ç»§æ‰¿</a></li>
</ul>
</li>
<li>\5. æšä¸¾çš„åº”ç”¨
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#51-%E7%BB%84%E7%BB%87%E5%B8%B8%E9%87%8F">5.1. ç»„ç»‡å¸¸é‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#52-switch-%E7%8A%B6%E6%80%81%E6%9C%BA">5.2. switch çŠ¶æ€æœº</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#53-%E9%94%99%E8%AF%AF%E7%A0%81">5.3. é”™è¯¯ç </a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#54-%E7%BB%84%E7%BB%87%E6%9E%9A%E4%B8%BE">5.4. ç»„ç»‡æšä¸¾</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#55-%E7%AD%96%E7%95%A5%E6%9E%9A%E4%B8%BE">5.5. ç­–ç•¥æšä¸¾</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#56-%E6%9E%9A%E4%B8%BE%E5%AE%9E%E7%8E%B0%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">5.6. æšä¸¾å®ç°å•ä¾‹æ¨¡å¼</a></li>
</ul>
</li>
<li>\6. æšä¸¾å·¥å…·ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#61-enumset">6.1. EnumSet</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#62-enummap">6.2. EnumMap</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#7-%E5%B0%8F%E7%BB%93">7. å°ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#8-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">8. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-88"><a class="markdownIt-Anchor" href="#-88">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_1-%E7%AE%80%E4%BB%8B">#</a>1. ç®€ä»‹</h2>
<p><code>enum</code>  çš„å…¨ç§°ä¸º enumerationï¼Œ æ˜¯ JDK5 ä¸­å¼•å…¥çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œè¢«  <code>enum</code>  å…³é”®å­—ä¿®é¥°çš„ç±»å‹å°±æ˜¯æšä¸¾ç±»å‹ã€‚å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">enum</span> <span class="token class-name">ColorEn</span> <span class="token punctuation">&#123;</span> RED<span class="token punctuation">,</span> GREEN<span class="token punctuation">,</span> BLUE <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>æšä¸¾çš„å¥½å¤„</strong>ï¼šå¯ä»¥å°†å¸¸é‡ç»„ç»‡èµ·æ¥ï¼Œç»Ÿä¸€è¿›è¡Œç®¡ç†ã€‚</p>
<p><strong>æšä¸¾çš„å…¸å‹åº”ç”¨åœºæ™¯</strong>ï¼šé”™è¯¯ç ã€çŠ¶æ€æœºç­‰ã€‚</p>
<h2 id="-89"><a class="markdownIt-Anchor" href="#-89">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_2-%E6%9E%9A%E4%B8%BE%E7%9A%84%E6%9C%AC%E8%B4%A8">#</a>2. æšä¸¾çš„æœ¬è´¨</h2>
<p><code>java.lang.Enum</code>  ç±»å£°æ˜</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ–°å»ºä¸€ä¸ª ColorEn.java æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ColorEn</span> <span class="token punctuation">&#123;</span>
    RED<span class="token punctuation">,</span>YELLOW<span class="token punctuation">,</span>BLUE
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œ  <code>javac ColorEn.java</code>  å‘½ä»¤ï¼Œç”Ÿæˆ ColorEn.class æ–‡ä»¶ã€‚</p>
<p>ç„¶åæ‰§è¡Œ  <code>javap ColorEn.class</code>  å‘½ä»¤ï¼Œè¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Compiled</span> from <span class="token string">"ColorEn.java"</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span>ColorEn</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Enum</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span>ColorEn</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span>ColorEn</span> RED<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span>ColorEn</span> YELLOW<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span>ColorEn</span> BLUE<span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span>ColorEn</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>enumeration<span class="token punctuation">.</span></span>ColorEn</span> <span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ğŸ’¡ è¯´æ˜ï¼š</p>
<p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼š</p>
<p><strong>æšä¸¾çš„æœ¬è´¨æ˜¯  <code>java.lang.Enum</code>  çš„å­ç±»ã€‚</strong></p>
<p>å°½ç®¡  <code>enum</code>  çœ‹èµ·æ¥åƒæ˜¯ä¸€ç§æ–°çš„æ•°æ®ç±»å‹ï¼Œäº‹å®ä¸Šï¼Œ<strong>enum æ˜¯ä¸€ç§å—é™åˆ¶çš„ç±»ï¼Œå¹¶ä¸”å…·æœ‰è‡ªå·±çš„æ–¹æ³•</strong>ã€‚æšä¸¾è¿™ç§ç‰¹æ®Šçš„ç±»å› ä¸ºè¢«ä¿®é¥°ä¸º  <code>final</code> ï¼Œæ‰€ä»¥ä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ã€‚</p>
<p>å®šä¹‰çš„æšä¸¾å€¼ï¼Œä¼šè¢«é»˜è®¤ä¿®é¥°ä¸º  <code>public static final</code>  ï¼Œä»ä¿®é¥°å…³é”®å­—ï¼Œå³å¯çœ‹å‡ºæšä¸¾å€¼æœ¬è´¨ä¸Šæ˜¯é™æ€å¸¸é‡ã€‚</p>
</blockquote>
<h2 id="-90"><a class="markdownIt-Anchor" href="#-90">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_3-%E6%9E%9A%E4%B8%BE%E7%9A%84%E6%96%B9%E6%B3%95">#</a>3. æšä¸¾çš„æ–¹æ³•</h2>
<p>åœ¨ enum ä¸­ï¼Œæä¾›äº†ä¸€äº›åŸºæœ¬æ–¹æ³•ï¼š</p>
<ul>
<li><code>values()</code> ï¼šè¿”å› enum å®ä¾‹çš„æ•°ç»„ï¼Œè€Œä¸”è¯¥æ•°ç»„ä¸­çš„å…ƒç´ ä¸¥æ ¼ä¿æŒåœ¨ enum ä¸­å£°æ˜æ—¶çš„é¡ºåºã€‚</li>
<li><code>name()</code> ï¼šè¿”å›å®ä¾‹åã€‚</li>
<li><code>ordinal()</code> ï¼šè¿”å›å®ä¾‹å£°æ˜æ—¶çš„æ¬¡åºï¼Œä» 0 å¼€å§‹ã€‚</li>
<li><code>getDeclaringClass()</code> ï¼šè¿”å›å®ä¾‹æ‰€å±çš„ enum ç±»å‹ã€‚</li>
<li><code>equals()</code>  ï¼šåˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚</li>
</ul>
<p>å¯ä»¥ä½¿ç”¨  <code>==</code>  æ¥æ¯”è¾ƒ <code>enum</code>  å®ä¾‹ã€‚</p>
<p>æ­¤å¤–ï¼Œ <code>java.lang.Enum</code>  å®ç°äº† <code>Comparable</code>  å’Œ  <code>Serializable</code>  æ¥å£ï¼Œæ‰€ä»¥ä¹Ÿæä¾›  <code>compareTo()</code>  æ–¹æ³•ã€‚</p>
<p><strong>ä¾‹ï¼šå±•ç¤º enum çš„åŸºæœ¬æ–¹æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnumMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span>RED<span class="token punctuation">,</span> GREEN<span class="token punctuation">,</span> BLUE<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">enum</span> <span class="token class-name">Size</span> <span class="token punctuation">&#123;</span>BIG<span class="token punctuation">,</span> MIDDLE<span class="token punctuation">,</span> SMALL<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=========== Print all Color ==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Color</span> c <span class="token operator">:</span> <span class="token class-name">Color</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c <span class="token operator">+</span> <span class="token string">" ordinal: "</span> <span class="token operator">+</span> c<span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=========== Print all Size ==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Size</span> s <span class="token operator">:</span> <span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token string">" ordinal: "</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">Color</span> green <span class="token operator">=</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"green name(): "</span> <span class="token operator">+</span> green<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"green getDeclaringClass(): "</span> <span class="token operator">+</span> green<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"green hashCode(): "</span> <span class="token operator">+</span> green<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"green compareTo Color.GREEN: "</span> <span class="token operator">+</span> green<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"green equals Color.GREEN: "</span> <span class="token operator">+</span> green<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Color</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"green equals Size.MIDDLE: "</span> <span class="token operator">+</span> green<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">.</span>MIDDLE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"green equals 1: "</span> <span class="token operator">+</span> green<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"green == Color.BLUE: %b\n"</span><span class="token punctuation">,</span> green <span class="token operator">==</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>BLUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">=========== Print all Color ===========
RED ordinal: 0
GREEN ordinal: 1
BLUE ordinal: 2
=========== Print all Size ===========
BIG ordinal: 0
MIDDLE ordinal: 1
SMALL ordinal: 2
green name(): GREEN
green getDeclaringClass(): class org.zp.javase.enumeration.EnumDemo$Color
green hashCode(): 460141958
green compareTo Color.GREEN: 0
green equals Color.GREEN: true
green equals Size.MIDDLE: false
green equals 1: false
green == Color.BLUE: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-91"><a class="markdownIt-Anchor" href="#-91">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_4-%E6%9E%9A%E4%B8%BE%E7%9A%84%E7%89%B9%E6%80%A7">#</a>4. æšä¸¾çš„ç‰¹æ€§</h2>
<p>æšä¸¾çš„ç‰¹æ€§ï¼Œå½’ç»“èµ·æ¥å°±æ˜¯ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>é™¤äº†ä¸èƒ½ç»§æ‰¿ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥å°†  <code>enum</code>  çœ‹åšä¸€ä¸ªå¸¸è§„çš„ç±»</strong>ã€‚</p>
</blockquote>
<p>ä½†æ˜¯è¿™å¥è¯éœ€è¦æ‹†åˆ†å»ç†è§£ï¼Œè®©æˆ‘ä»¬ç»†ç»†é“æ¥ã€‚</p>
<h3 id="-92"><a class="markdownIt-Anchor" href="#-92">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_4-1-%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7">#</a>4.1. åŸºæœ¬ç‰¹æ€§</h3>
<p><strong>å¦‚æœæšä¸¾ä¸­æ²¡æœ‰å®šä¹‰æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åœ¨æœ€åä¸€ä¸ªå®ä¾‹åé¢åŠ é€—å·ã€åˆ†å·æˆ–ä»€ä¹ˆéƒ½ä¸åŠ ã€‚</strong></p>
<p>å¦‚æœæšä¸¾ä¸­æ²¡æœ‰å®šä¹‰æ–¹æ³•ï¼Œ<strong>æšä¸¾å€¼é»˜è®¤ä¸ºä» 0 å¼€å§‹çš„æœ‰åºæ•°å€¼</strong>ã€‚ä»¥ Color æšä¸¾ç±»å‹ä¸¾ä¾‹ï¼Œå®ƒçš„æšä¸¾å¸¸é‡ä¾æ¬¡ä¸º  <code>REDï¼š0ï¼ŒGREENï¼š1ï¼ŒBLUEï¼š2</code> ã€‚</p>
<h3 id="-93"><a class="markdownIt-Anchor" href="#-93">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_4-2-%E6%9E%9A%E4%B8%BE%E5%8F%AF%E4%BB%A5%E6%B7%BB%E5%8A%A0%E6%96%B9%E6%B3%95">#</a>4.2. æšä¸¾å¯ä»¥æ·»åŠ æ–¹æ³•</h3>
<p>åœ¨æ¦‚å¿µç« èŠ‚æåˆ°äº†ï¼Œ<strong>æšä¸¾å€¼é»˜è®¤ä¸ºä» 0 å¼€å§‹çš„æœ‰åºæ•°å€¼</strong> ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå¦‚ä½•ä¸ºæšä¸¾æ˜¾å¼çš„èµ‹å€¼ã€‚</p>
<p>ï¼ˆ1ï¼‰<strong>Java ä¸å…è®¸ä½¿ç”¨  <code>=</code>  ä¸ºæšä¸¾å¸¸é‡èµ‹å€¼</strong></p>
<p>å¦‚æœä½ æ¥è§¦è¿‡ C/C++ï¼Œä½ è‚¯å®šä¼šå¾ˆè‡ªç„¶çš„æƒ³åˆ°èµ‹å€¼ç¬¦å·  <code>=</code>  ã€‚åœ¨ C/C++ è¯­è¨€ä¸­çš„ enumï¼Œå¯ä»¥ç”¨èµ‹å€¼ç¬¦å· <code>=</code>  æ˜¾å¼çš„ä¸ºæšä¸¾å¸¸é‡èµ‹å€¼ï¼›ä½†æ˜¯ ï¼Œå¾ˆé—æ†¾ï¼Œ<strong>Java è¯­æ³•ä¸­å´ä¸å…è®¸ä½¿ç”¨èµ‹å€¼ç¬¦å·  <code>=</code>  ä¸ºæšä¸¾å¸¸é‡èµ‹å€¼</strong>ã€‚</p>
<p><strong>ä¾‹ï¼šC/C++ è¯­è¨€ä¸­çš„æšä¸¾å£°æ˜</strong></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token punctuation">&#123;</span>
    ONE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
    TWO<span class="token punctuation">,</span>
    THREE <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
    TEN <span class="token operator">=</span> <span class="token number">10</span>
<span class="token punctuation">&#125;</span> Number<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ï¼ˆ2ï¼‰<strong>æšä¸¾å¯ä»¥æ·»åŠ æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•ã€æŠ½è±¡æ–¹æ³•ã€æ„é€ æ–¹æ³•</strong></p>
<p>Java è™½ç„¶ä¸èƒ½ç›´æ¥ä¸ºå®ä¾‹èµ‹å€¼ï¼Œä½†æ˜¯å®ƒæœ‰æ›´ä¼˜ç§€çš„è§£å†³æ–¹æ¡ˆï¼š<strong>ä¸º enum æ·»åŠ æ–¹æ³•æ¥é—´æ¥å®ç°æ˜¾å¼èµ‹å€¼</strong>ã€‚</p>
<p>åˆ›å»º  <code>enum</code>  æ—¶ï¼Œå¯ä»¥ä¸ºå…¶æ·»åŠ å¤šç§æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥ä¸ºå…¶æ·»åŠ æ„é€ æ–¹æ³•ã€‚</p>
<p><strong>æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼šå¦‚æœè¦ä¸º enum å®šä¹‰æ–¹æ³•ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨ enum çš„æœ€åä¸€ä¸ªå®ä¾‹å°¾éƒ¨æ·»åŠ ä¸€ä¸ªåˆ†å·ã€‚æ­¤å¤–ï¼Œåœ¨ enum ä¸­ï¼Œå¿…é¡»å…ˆå®šä¹‰å®ä¾‹ï¼Œä¸èƒ½å°†å­—æ®µæˆ–æ–¹æ³•å®šä¹‰åœ¨å®ä¾‹å‰é¢ã€‚å¦åˆ™ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</strong></p>
<p><strong>ä¾‹ï¼šå…¨é¢å±•ç¤ºå¦‚ä½•åœ¨æšä¸¾ä¸­å®šä¹‰æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•ã€æŠ½è±¡æ–¹æ³•ã€æ„é€ æ–¹æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ErrorCodeEn</span> <span class="token punctuation">&#123;</span>
    <span class="token function">OK</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">ERROR_A</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"é”™è¯¯A"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">ERROR_B</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"é”™è¯¯B"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ æ–¹æ³•ï¼šenumçš„æ„é€ æ–¹æ³•åªèƒ½è¢«å£°æ˜ä¸ºprivateæƒé™æˆ–ä¸å£°æ˜æƒé™</span>
    <span class="token keyword">private</span> <span class="token class-name">ErrorCodeEn</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ„é€ æ–¹æ³•</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> number<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ™®é€šæ–¹æ³•</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// æ™®é€šæ–¹æ³•</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŠ½è±¡æ–¹æ³•</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// é™æ€æ–¹æ³•</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ErrorCodeEn</span> s <span class="token operator">:</span> <span class="token class-name">ErrorCodeEn</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"code: "</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", description: "</span> <span class="token operator">+</span> s<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// code: 0, description: æˆåŠŸ</span>
<span class="token comment">// code: 100, description: é”™è¯¯A</span>
<span class="token comment">// code: 200, description: é”™è¯¯B</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨ï¼šä¸Šé¢çš„ä¾‹å­å¹¶ä¸å¯å–ï¼Œä»…ä»…æ˜¯ä¸ºäº†å±•ç¤ºæšä¸¾æ”¯æŒå®šä¹‰å„ç§æ–¹æ³•ã€‚æ­£ç¡®çš„ä¾‹å­æƒ…å†µ<a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#%E9%94%99%E8%AF%AF%E7%A0%81">é”™è¯¯ç ç¤ºä¾‹</a></p>
<h3 id="-94"><a class="markdownIt-Anchor" href="#-94">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_4-3-%E6%9E%9A%E4%B8%BE%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3">#</a>4.3. æšä¸¾å¯ä»¥å®ç°æ¥å£</h3>
<p><strong> <code>enum</code>  å¯ä»¥åƒä¸€èˆ¬ç±»ä¸€æ ·å®ç°æ¥å£ã€‚</strong></p>
<p>åŒæ ·æ˜¯å®ç°ä¸Šä¸€èŠ‚ä¸­çš„é”™è¯¯ç æšä¸¾ç±»ï¼Œé€šè¿‡å®ç°æ¥å£ï¼Œå¯ä»¥çº¦æŸå®ƒçš„æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ErrorCodeEn2</span> <span class="token keyword">implements</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
    <span class="token function">OK</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ERROR_A</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"é”™è¯¯A"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ERROR_B</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"é”™è¯¯B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ErrorCodeEn2</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">,</span> <span class="token class-name">String</span> description<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> number<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> description<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-95"><a class="markdownIt-Anchor" href="#-95">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_4-4-%E6%9E%9A%E4%B8%BE%E4%B8%8D%E5%8F%AF%E4%BB%A5%E7%BB%A7%E6%89%BF">#</a>4.4. æšä¸¾ä¸å¯ä»¥ç»§æ‰¿</h3>
<p><strong>enum ä¸å¯ä»¥ç»§æ‰¿å¦å¤–ä¸€ä¸ªç±»ï¼Œå½“ç„¶ï¼Œä¹Ÿä¸èƒ½ç»§æ‰¿å¦ä¸€ä¸ª enum ã€‚</strong></p>
<p>å› ä¸º  <code>enum</code>  å®é™…ä¸Šéƒ½ç»§æ‰¿è‡ª  <code>java.lang.Enum</code>  ç±»ï¼Œè€Œ Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥  <code>enum</code>  ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ï¼Œå½“ç„¶ä¹Ÿä¸èƒ½ç»§æ‰¿å¦ä¸€ä¸ª  <code>enum</code> ã€‚</p>
<h2 id="-96"><a class="markdownIt-Anchor" href="#-96">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_5-%E6%9E%9A%E4%B8%BE%E7%9A%84%E5%BA%94%E7%94%A8">#</a>5. æšä¸¾çš„åº”ç”¨</h2>
<h3 id="-97"><a class="markdownIt-Anchor" href="#-97">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_5-1-%E7%BB%84%E7%BB%87%E5%B8%B8%E9%87%8F">#</a>5.1. ç»„ç»‡å¸¸é‡</h3>
<p>åœ¨ JDK5 ä¹‹å‰ï¼Œåœ¨ Java ä¸­å®šä¹‰å¸¸é‡éƒ½æ˜¯ <code>public static final TYPE a;</code>  è¿™æ ·çš„å½¢å¼ã€‚æœ‰äº†æšä¸¾ï¼Œä½ å¯ä»¥å°†æœ‰å…³è”å…³ç³»çš„å¸¸é‡ç»„ç»‡èµ·æ¥ï¼Œä½¿ä»£ç æ›´åŠ æ˜“è¯»ã€å®‰å…¨ï¼Œå¹¶ä¸”è¿˜å¯ä»¥ä½¿ç”¨æšä¸¾æä¾›çš„æ–¹æ³•ã€‚</p>
<p>ä¸‹é¢ä¸‰ç§å£°æ˜æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span> RED<span class="token punctuation">,</span> GREEN<span class="token punctuation">,</span> BLUE <span class="token punctuation">&#125;</span>
<span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span> RED<span class="token punctuation">,</span> GREEN<span class="token punctuation">,</span> BLUE<span class="token punctuation">,</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span> RED<span class="token punctuation">,</span> GREEN<span class="token punctuation">,</span> BLUE<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="-98"><a class="markdownIt-Anchor" href="#-98">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_5-2-switch-%E7%8A%B6%E6%80%81%E6%9C%BA">#</a>5.2. switch çŠ¶æ€æœº</h3>
<p>æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ switch è¯­å¥æ¥å†™çŠ¶æ€æœºã€‚JDK7 ä»¥åï¼Œswitch å·²ç»æ”¯æŒ  <code>int</code> ã€ <code>char</code> ã€ <code>String</code> ã€ <code>enum</code>  ç±»å‹çš„å‚æ•°ã€‚è¿™å‡ ç§ç±»å‹çš„å‚æ•°æ¯”è¾ƒèµ·æ¥ï¼Œä½¿ç”¨æšä¸¾çš„ switch ä»£ç æ›´å…·æœ‰å¯è¯»æ€§ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StateMachineDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Signal</span> <span class="token punctuation">&#123;</span>
        GREEN<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> RED
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getTrafficInstruct</span><span class="token punctuation">(</span><span class="token class-name">Signal</span> signal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> instruct <span class="token operator">=</span> <span class="token string">"ä¿¡å·ç¯æ•…éšœ"</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>signal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">case</span> RED<span class="token operator">:</span>
                instruct <span class="token operator">=</span> <span class="token string">"çº¢ç¯åœ"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> YELLOW<span class="token operator">:</span>
                instruct <span class="token operator">=</span> <span class="token string">"é»„ç¯è¯·æ³¨æ„"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> GREEN<span class="token operator">:</span>
                instruct <span class="token operator">=</span> <span class="token string">"ç»¿ç¯è¡Œ"</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> instruct<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">getTrafficInstruct</span><span class="token punctuation">(</span><span class="token class-name">Signal</span><span class="token punctuation">.</span>RED<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// çº¢ç¯åœ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-99"><a class="markdownIt-Anchor" href="#-99">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_5-3-%E9%94%99%E8%AF%AF%E7%A0%81">#</a>5.3. é”™è¯¯ç </h3>
<p>æšä¸¾å¸¸è¢«ç”¨äºå®šä¹‰ç¨‹åºé”™è¯¯ç ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorCodeEnumDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">enum</span> <span class="token class-name">ErrorCodeEn</span> <span class="token punctuation">&#123;</span>
        <span class="token function">OK</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">ERROR_A</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"é”™è¯¯A"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">ERROR_B</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"é”™è¯¯B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ErrorCodeEn</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> number<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> code<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"ErrorCodeEn&#123;"</span> <span class="token operator">+</span> <span class="token string">"code="</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">", msg='"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">toStringAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"ErrorCodeEn All Elements: ["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ErrorCodeEn</span> code <span class="token operator">:</span> <span class="token class-name">ErrorCodeEn</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodeEn</span><span class="token punctuation">.</span><span class="token function">toStringAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ErrorCodeEn</span> s <span class="token operator">:</span> <span class="token class-name">ErrorCodeEn</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// ErrorCodeEn All Elements: [0, 100, 200, ]</span>
<span class="token comment">// ErrorCodeEn&#123;code=0, msg='æˆåŠŸ'&#125;</span>
<span class="token comment">// ErrorCodeEn&#123;code=100, msg='é”™è¯¯A'&#125;</span>
<span class="token comment">// ErrorCodeEn&#123;code=200, msg='é”™è¯¯B'&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-100"><a class="markdownIt-Anchor" href="#-100">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_5-4-%E7%BB%84%E7%BB%87%E6%9E%9A%E4%B8%BE">#</a>5.4. ç»„ç»‡æšä¸¾</h3>
<p>å¯ä»¥å°†ç±»å‹ç›¸è¿‘çš„æšä¸¾é€šè¿‡æ¥å£æˆ–ç±»ç»„ç»‡èµ·æ¥ï¼Œä½†æ˜¯ä¸€èˆ¬ç”¨æ¥å£æ–¹å¼è¿›è¡Œç»„ç»‡ã€‚</p>
<p>åŸå› æ˜¯ï¼šJava æ¥å£åœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨ä¸º enum ç±»å‹åŠ ä¸Š <code>public static</code>  ä¿®é¥°ç¬¦ï¼›Java ç±»åœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨ä¸º  <code>enum</code>  ç±»å‹åŠ ä¸Š static ä¿®é¥°ç¬¦ã€‚çœ‹å‡ºå·®å¼‚äº†å—ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯è¯´ï¼Œåœ¨ç±»ä¸­ç»„ç»‡  <code>enum</code> ï¼Œå¦‚æœä½ ä¸ç»™å®ƒä¿®é¥°ä¸º  <code>public</code> ï¼Œé‚£ä¹ˆåªèƒ½åœ¨æœ¬åŒ…ä¸­è¿›è¡Œè®¿é—®ã€‚</p>
<p><strong>ä¾‹ï¼šåœ¨æ¥å£ä¸­ç»„ç»‡ enum</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnumInInterfaceDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Plant</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">enum</span> <span class="token class-name">Vegetable</span> <span class="token keyword">implements</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
            <span class="token function">POTATO</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"åœŸè±†"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">TOMATO</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"è¥¿çº¢æŸ¿"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Vegetable</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">,</span> <span class="token class-name">String</span> description<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> number<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
            <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>description<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>


        <span class="token keyword">enum</span> <span class="token class-name">Fruit</span> <span class="token keyword">implements</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
            <span class="token function">APPLE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"è‹¹æœ"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">ORANGE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"æ¡”å­"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">BANANA</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"é¦™è•‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Fruit</span><span class="token punctuation">(</span><span class="token keyword">int</span> number<span class="token punctuation">,</span> <span class="token class-name">String</span> description<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> number<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>description <span class="token operator">=</span> description<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
            <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>description<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Plant<span class="token punctuation">.</span>Fruit</span> f <span class="token operator">:</span> <span class="token class-name">Plant<span class="token punctuation">.</span>Fruit</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// è‹¹æœ</span>
<span class="token comment">// æ¡”å­</span>
<span class="token comment">// é¦™è•‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ä¾‹ï¼šåœ¨ç±»ä¸­ç»„ç»‡ enum</strong></p>
<p>æœ¬ä¾‹å’Œä¸Šä¾‹æ•ˆæœç›¸åŒã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnumInClassDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Plant2</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">enum</span> <span class="token class-name">Vegetable</span> <span class="token keyword">implements</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ç•¥ï¼Œä¸ä¸Šé¢å®Œå…¨ç›¸åŒ</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">enum</span> <span class="token class-name">Fruit</span> <span class="token keyword">implements</span> <span class="token class-name">INumberEnum</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ç•¥ï¼Œä¸ä¸Šé¢å®Œå…¨ç›¸åŒ</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// ç•¥</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// åœŸè±†</span>
<span class="token comment">// è¥¿çº¢æŸ¿</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-101"><a class="markdownIt-Anchor" href="#-101">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_5-5-%E7%AD%96%E7%95%A5%E6%9E%9A%E4%B8%BE">#</a>5.5. ç­–ç•¥æšä¸¾</h3>
<p>Effective Java ä¸­å±•ç¤ºäº†ä¸€ç§ç­–ç•¥æšä¸¾ã€‚è¿™ç§æšä¸¾é€šè¿‡æšä¸¾åµŒå¥—æšä¸¾çš„æ–¹å¼ï¼Œå°†æšä¸¾å¸¸é‡åˆ†ç±»å¤„ç†ã€‚</p>
<p>è¿™ç§åšæ³•è™½ç„¶æ²¡æœ‰ switch è¯­å¥ç®€æ´ï¼Œä½†æ˜¯æ›´åŠ å®‰å…¨ã€çµæ´»ã€‚</p>
<p><strong>ä¾‹ï¼šEffectvieJava ä¸­çš„ç­–ç•¥æšä¸¾èŒƒä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">enum</span> <span class="token class-name">PayrollDay</span> <span class="token punctuation">&#123;</span>
    <span class="token function">MONDAY</span><span class="token punctuation">(</span><span class="token class-name">PayType</span><span class="token punctuation">.</span>WEEKDAY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">TUESDAY</span><span class="token punctuation">(</span><span class="token class-name">PayType</span><span class="token punctuation">.</span>WEEKDAY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WEDNESDAY</span><span class="token punctuation">(</span>
            <span class="token class-name">PayType</span><span class="token punctuation">.</span>WEEKDAY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">THURSDAY</span><span class="token punctuation">(</span><span class="token class-name">PayType</span><span class="token punctuation">.</span>WEEKDAY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">FRIDAY</span><span class="token punctuation">(</span><span class="token class-name">PayType</span><span class="token punctuation">.</span>WEEKDAY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">SATURDAY</span><span class="token punctuation">(</span>
            <span class="token class-name">PayType</span><span class="token punctuation">.</span>WEEKEND<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">SUNDAY</span><span class="token punctuation">(</span><span class="token class-name">PayType</span><span class="token punctuation">.</span>WEEKEND<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PayType</span> payType<span class="token punctuation">;</span>

    <span class="token class-name">PayrollDay</span><span class="token punctuation">(</span><span class="token class-name">PayType</span> payType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>payType <span class="token operator">=</span> payType<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">double</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token keyword">double</span> hoursWorked<span class="token punctuation">,</span> <span class="token keyword">double</span> payRate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> payType<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span>hoursWorked<span class="token punctuation">,</span> payRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// ç­–ç•¥æšä¸¾</span>
    <span class="token keyword">private</span> <span class="token keyword">enum</span> <span class="token class-name">PayType</span> <span class="token punctuation">&#123;</span>
        WEEKDAY <span class="token punctuation">&#123;</span>
            <span class="token keyword">double</span> <span class="token function">overtimePay</span><span class="token punctuation">(</span><span class="token keyword">double</span> hours<span class="token punctuation">,</span> <span class="token keyword">double</span> payRate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> hours <span class="token operator">&lt;=</span> HOURS_PER_SHIFT <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>hours <span class="token operator">-</span> HOURS_PER_SHIFT<span class="token punctuation">)</span>
                        <span class="token operator">*</span> payRate <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        WEEKEND <span class="token punctuation">&#123;</span>
            <span class="token keyword">double</span> <span class="token function">overtimePay</span><span class="token punctuation">(</span><span class="token keyword">double</span> hours<span class="token punctuation">,</span> <span class="token keyword">double</span> payRate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> hours <span class="token operator">*</span> payRate <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> HOURS_PER_SHIFT <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>

        <span class="token keyword">abstract</span> <span class="token keyword">double</span> <span class="token function">overtimePay</span><span class="token punctuation">(</span><span class="token keyword">double</span> hrs<span class="token punctuation">,</span> <span class="token keyword">double</span> payRate<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">double</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token keyword">double</span> hoursWorked<span class="token punctuation">,</span> <span class="token keyword">double</span> payRate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">double</span> basePay <span class="token operator">=</span> hoursWorked <span class="token operator">*</span> payRate<span class="token punctuation">;</span>
            <span class="token keyword">return</span> basePay <span class="token operator">+</span> <span class="token function">overtimePay</span><span class="token punctuation">(</span>hoursWorked<span class="token punctuation">,</span> payRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>æµ‹è¯•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ—¶è–ª100çš„äººåœ¨å‘¨äº”å·¥ä½œ8å°æ—¶çš„æ”¶å…¥ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">PayrollDay</span><span class="token punctuation">.</span>FRIDAY<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ—¶è–ª100çš„äººåœ¨å‘¨å…­å·¥ä½œ8å°æ—¶çš„æ”¶å…¥ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">PayrollDay</span><span class="token punctuation">.</span>SATURDAY<span class="token punctuation">.</span><span class="token function">pay</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-102"><a class="markdownIt-Anchor" href="#-102">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_5-6-%E6%9E%9A%E4%B8%BE%E5%AE%9E%E7%8E%B0%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">#</a>5.6. æšä¸¾å®ç°å•ä¾‹æ¨¡å¼</h3>
<p>å•ä¾‹æ¨¡å¼æ˜¯æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>å•ä¾‹æ¨¡å¼åœ¨å¹¶å‘ç¯å¢ƒä¸‹å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>ä¸ºäº†çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¼ ç»Ÿåšæ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>é¥¿æ±‰å¼åŠ è½½</li>
<li>æ‡’æ±‰å¼ synchronize å’ŒåŒé‡æ£€æŸ¥</li>
<li>åˆ©ç”¨ java çš„é™æ€åŠ è½½æœºåˆ¶</li>
</ul>
<p>ç›¸æ¯”ä¸Šè¿°çš„æ–¹æ³•ï¼Œä½¿ç”¨æšä¸¾ä¹Ÿå¯ä»¥å®ç°å•ä¾‹ï¼Œè€Œä¸”è¿˜æ›´åŠ ç®€å•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingleEnumDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">SingleEn</span> <span class="token punctuation">&#123;</span>

        INSTANCE<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SingleEn</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"zp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">SingleEn</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/javazejian/article/details/71333103#enumset%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90">æ·±å…¥ç†è§£ Java æšä¸¾ç±»å‹ (enum)(opens new window)</a></p>
<p>è¿™ç¯‡æ–‡ç« å¯¹äº Java æšä¸¾çš„ç‰¹æ€§è®²è§£å¾ˆä»”ç»†ï¼Œå…¶ä¸­å¯¹äºæšä¸¾å®ç°å•ä¾‹å’Œä¼ ç»Ÿå•ä¾‹å®ç°æ–¹å¼è¯´çš„å°¤ä¸ºç»†è‡´ã€‚</p>
</blockquote>
<h2 id="-103"><a class="markdownIt-Anchor" href="#-103">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_6-%E6%9E%9A%E4%B8%BE%E5%B7%A5%E5%85%B7%E7%B1%BB">#</a>6. æšä¸¾å·¥å…·ç±»</h2>
<p>Java ä¸­æä¾›äº†ä¸¤ä¸ªæ–¹ä¾¿æ“ä½œ enum çš„å·¥å…·ç±» â€”â€” <code>EnumSet</code>  å’Œ  <code>EnumMap</code> ã€‚</p>
<h3 id="-104"><a class="markdownIt-Anchor" href="#-104">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_6-1-enumset">#</a>6.1. EnumSet</h3>
<p><code>EnumSet</code>  æ˜¯æšä¸¾ç±»å‹çš„é«˜æ€§èƒ½  <code>Set</code>  å®ç°ã€‚å®ƒè¦æ±‚æ”¾å…¥å®ƒçš„æšä¸¾å¸¸é‡å¿…é¡»å±äºåŒä¸€æšä¸¾ç±»å‹ã€‚</p>
<p>ä¸»è¦æ¥å£ï¼š</p>
<ul>
<li><code>noneOf</code>  - åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šå…ƒç´ ç±»å‹çš„ç©º EnumSet</li>
<li><code>allOf</code>  - åˆ›å»ºä¸€ä¸ªæŒ‡å®šå…ƒç´ ç±»å‹å¹¶åŒ…å«æ‰€æœ‰æšä¸¾å€¼çš„ EnumSet</li>
<li><code>range</code>  - åˆ›å»ºä¸€ä¸ªåŒ…æ‹¬æšä¸¾å€¼ä¸­æŒ‡å®šèŒƒå›´å…ƒç´ çš„ EnumSet</li>
<li><code>complementOf</code>  - åˆå§‹é›†åˆåŒ…æ‹¬æŒ‡å®šé›†åˆçš„è¡¥é›†</li>
<li><code>of</code>  - åˆ›å»ºä¸€ä¸ªåŒ…æ‹¬å‚æ•°ä¸­æ‰€æœ‰å…ƒç´ çš„ EnumSet</li>
<li><code>copyOf</code>  - åˆ›å»ºä¸€ä¸ªåŒ…å«å‚æ•°å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„ EnumSet</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnumSetDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"EnumSetå±•ç¤º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EnumSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ErrorCodeEn</span><span class="token punctuation">></span></span> errSet <span class="token operator">=</span> <span class="token class-name">EnumSet</span><span class="token punctuation">.</span><span class="token function">allOf</span><span class="token punctuation">(</span><span class="token class-name">ErrorCodeEn</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ErrorCodeEn</span> e <span class="token operator">:</span> errSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" : "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-105"><a class="markdownIt-Anchor" href="#-105">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_6-2-enummap">#</a>6.2. EnumMap</h3>
<p><code>EnumMap</code>  æ˜¯ä¸“é—¨ä¸ºæšä¸¾ç±»å‹é‡èº«å®šåšçš„  <code>Map</code>  å®ç°ã€‚è™½ç„¶ä½¿ç”¨å…¶å®ƒçš„ Map å®ç°ï¼ˆå¦‚ HashMapï¼‰ä¹Ÿèƒ½å®Œæˆæšä¸¾ç±»å‹å®ä¾‹åˆ°å€¼å¾—æ˜ å°„ï¼Œä½†æ˜¯ä½¿ç”¨ EnumMap ä¼šæ›´åŠ é«˜æ•ˆï¼šå®ƒåªèƒ½æ¥æ”¶åŒä¸€æšä¸¾ç±»å‹çš„å®ä¾‹ä½œä¸ºé”®å€¼ï¼Œå¹¶ä¸”ç”±äºæšä¸¾ç±»å‹å®ä¾‹çš„æ•°é‡ç›¸å¯¹å›ºå®šå¹¶ä¸”æœ‰é™ï¼Œæ‰€ä»¥ EnumMap ä½¿ç”¨æ•°ç»„æ¥å­˜æ”¾ä¸æšä¸¾ç±»å‹å¯¹åº”çš„å€¼ã€‚è¿™ä½¿å¾— EnumMap çš„æ•ˆç‡éå¸¸é«˜ã€‚</p>
<p>ä¸»è¦æ¥å£ï¼š</p>
<ul>
<li><code>size</code>  - è¿”å›é”®å€¼å¯¹æ•°</li>
<li><code>containsValue</code>  - æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„ value</li>
<li><code>containsKey</code>  - æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„ key</li>
<li><code>get</code>  - æ ¹æ®æŒ‡å®š key è·å– value</li>
<li><code>put</code>  - å–å‡ºæŒ‡å®šçš„é”®å€¼å¯¹</li>
<li><code>remove</code>  - åˆ é™¤æŒ‡å®š key</li>
<li><code>putAll</code>  - æ‰¹é‡å–å‡ºé”®å€¼å¯¹</li>
<li><code>clear</code>  - æ¸…é™¤æ•°æ®</li>
<li><code>keySet</code>  - è·å– key é›†åˆ</li>
<li><code>values</code>  - è¿”å›æ‰€æœ‰</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EnumMapDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Signal</span> <span class="token punctuation">&#123;</span>
        GREEN<span class="token punctuation">,</span> YELLOW<span class="token punctuation">,</span> RED
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"EnumMapå±•ç¤º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EnumMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Signal</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> errMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EnumMap</span><span class="token punctuation">(</span><span class="token class-name">Signal</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Signal</span><span class="token punctuation">.</span>RED<span class="token punctuation">,</span> <span class="token string">"çº¢ç¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Signal</span><span class="token punctuation">.</span>YELLOW<span class="token punctuation">,</span> <span class="token string">"é»„ç¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        errMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Signal</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">,</span> <span class="token string">"ç»¿ç¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">Signal</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> iter <span class="token operator">=</span> errMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Signal</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> entry <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" : "</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/javazejian/article/details/71333103#enumset%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90">æ·±å…¥ç†è§£ Java æšä¸¾ç±»å‹ (enum)(opens new window)</a></p>
<p>è¿™ç¯‡æ–‡ç« ä¸­å¯¹ EnumSet å’Œ EnumMap åŸç†åšäº†è¾ƒä¸ºè¯¦ç»†çš„ä»‹ç»ã€‚</p>
</blockquote>
<h2 id="-106"><a class="markdownIt-Anchor" href="#-106">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-enum.html#_7-%E5%B0%8F%E7%BB%93">#</a>7. å°ç»“</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553002212154.png" alt="img"></p>
<hr>
<h1 id="java-æ§åˆ¶è¯­å¥"><a class="markdownIt-Anchor" href="#java-æ§åˆ¶è¯­å¥">#</a> Java æ§åˆ¶è¯­å¥</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>Java æ§åˆ¶è¯­å¥å¤§è‡´å¯åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p>
<ul>
<li>é€‰æ‹©è¯­å¥
<ul>
<li>if, else-if, else</li>
<li>switch</li>
</ul>
</li>
<li>å¾ªç¯è¯­å¥
<ul>
<li>while</li>
<li>doâ€¦while</li>
<li>for</li>
<li>foreach</li>
</ul>
</li>
<li>ç»ˆç«¯è¯­å¥
<ul>
<li>break</li>
<li>continue</li>
<li>return</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>\1. é€‰æ‹©è¯­å¥
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#11-if-%E8%AF%AD%E5%8F%A5">1.1. if è¯­å¥</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#12-ifelse-%E8%AF%AD%E5%8F%A5">1.2. ifâ€¦else è¯­å¥</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#13-ifelse-ifelse-%E8%AF%AD%E5%8F%A5">1.3. ifâ€¦else ifâ€¦else è¯­å¥</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#14-%E5%B5%8C%E5%A5%97%E7%9A%84-ifelse-%E8%AF%AD%E5%8F%A5">1.4. åµŒå¥—çš„ ifâ€¦else è¯­å¥</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#15-switch-%E8%AF%AD%E5%8F%A5">1.5. switch è¯­å¥</a></li>
</ul>
</li>
<li>\2. å¾ªç¯è¯­å¥
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#21-while-%E5%BE%AA%E7%8E%AF">2.1. while å¾ªç¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#22-do-while-%E5%BE%AA%E7%8E%AF">2.2. do while å¾ªç¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#23-for-%E5%BE%AA%E7%8E%AF">2.3. for å¾ªç¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#24-foreach-%E5%BE%AA%E7%8E%AF">2.4. foreach å¾ªç¯</a></li>
</ul>
</li>
<li>\3. ä¸­æ–­è¯­å¥
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#31-break-%E5%85%B3%E9%94%AE%E5%AD%97">3.1. break å…³é”®å­—</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#32-continue-%E5%85%B3%E9%94%AE%E5%AD%97">3.2. continue å…³é”®å­—</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#33-return-%E5%85%B3%E9%94%AE%E5%AD%97">3.3. return å…³é”®å­—</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#4-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">4. æœ€ä½³å®è·µ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-107"><a class="markdownIt-Anchor" href="#-107">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_1-%E9%80%89%E6%8B%A9%E8%AF%AD%E5%8F%A5">#</a>1. é€‰æ‹©è¯­å¥</h2>
<h3 id="-108"><a class="markdownIt-Anchor" href="#-108">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_1-1-if-%E8%AF%AD%E5%8F%A5">#</a>1.1. if è¯­å¥</h3>
<p><code>if</code>  è¯­å¥ä¼šåˆ¤æ–­æ‹¬å·ä¸­çš„æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œå¦‚æœæˆç«‹åˆ™æ‰§è¡Œ  <code>if</code>  è¯­å¥ä¸­çš„ä»£ç å—ï¼Œå¦åˆ™è·³è¿‡ä»£ç å—ç»§ç»­æ‰§è¡Œã€‚</p>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ä¸ºtrueå°†æ‰§è¡Œçš„è¯­å¥</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯ if è¯­å¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// è¿™æ˜¯ if è¯­å¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-109"><a class="markdownIt-Anchor" href="#-109">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_1-2-if-else-%E8%AF%AD%E5%8F%A5">#</a>1.2. ifâ€¦else è¯­å¥</h3>
<p><code>if</code>  è¯­å¥åé¢å¯ä»¥è·Ÿ  <code>else</code>  è¯­å¥ï¼Œå½“  <code>if</code>  è¯­å¥çš„å¸ƒå°”è¡¨è¾¾å¼å€¼ä¸º  <code>false</code>  æ—¶ï¼Œ <code>else</code>  è¯­å¥å—ä¼šè¢«æ‰§è¡Œã€‚</p>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//å¦‚æœå¸ƒå°”è¡¨è¾¾å¼çš„å€¼ä¸ºtrue</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//å¦‚æœå¸ƒå°”è¡¨è¾¾å¼çš„å€¼ä¸ºfalse</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfElseDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯ if è¯­å¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯ else è¯­å¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// è¿™æ˜¯ else è¯­å¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-110"><a class="markdownIt-Anchor" href="#-110">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_1-3-if-else-if-else-%E8%AF%AD%E5%8F%A5">#</a>1.3. ifâ€¦else ifâ€¦else è¯­å¥</h3>
<ul>
<li><code>if</code>  è¯­å¥è‡³å¤šæœ‰ 1 ä¸ª  <code>else</code>  è¯­å¥ï¼Œ <code>else</code>  è¯­å¥åœ¨æ‰€æœ‰çš„  <code>else if</code>  è¯­å¥ä¹‹åã€‚</li>
<li><code>If</code>  è¯­å¥å¯ä»¥æœ‰è‹¥å¹²ä¸ª  <code>else if</code>  è¯­å¥ï¼Œå®ƒä»¬å¿…é¡»åœ¨  <code>else</code>  è¯­å¥ä¹‹å‰ã€‚</li>
<li>ä¸€æ—¦å…¶ä¸­ä¸€ä¸ª  <code>else if</code>  è¯­å¥æ£€æµ‹ä¸º  <code>true</code> ï¼Œå…¶ä»–çš„  <code>else if</code>  ä»¥åŠ  <code>else</code>  è¯­å¥éƒ½å°†è·³è¿‡æ‰§è¡Œã€‚</li>
</ul>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼ <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 1çš„å€¼ä¸ºtrueæ‰§è¡Œä»£ç </span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼ <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 2çš„å€¼ä¸ºtrueæ‰§è¡Œä»£ç </span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼ <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 3çš„å€¼ä¸ºtrueæ‰§è¡Œä»£ç </span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">//å¦‚æœä»¥ä¸Šå¸ƒå°”è¡¨è¾¾å¼éƒ½ä¸ä¸ºtrueæ‰§è¡Œä»£ç </span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfElseifElseDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Value of X is 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Value of X is 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Value of X is 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"This is else statement"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// Value of X is 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-111"><a class="markdownIt-Anchor" href="#-111">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_1-4-%E5%B5%8C%E5%A5%97%E7%9A%84-if-else-%E8%AF%AD%E5%8F%A5">#</a>1.4. åµŒå¥—çš„ ifâ€¦else è¯­å¥</h3>
<p>ä½¿ç”¨åµŒå¥—çš„  <code>if else</code>  è¯­å¥æ˜¯åˆæ³•çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥åœ¨å¦ä¸€ä¸ª  <code>if</code>  æˆ–è€…  <code>else if</code>  è¯­å¥ä¸­ä½¿ç”¨  <code>if</code>  æˆ–è€…  <code>else if</code>  è¯­å¥ã€‚</p>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼ <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">////å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 1çš„å€¼ä¸ºtrueæ‰§è¡Œä»£ç </span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼ <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">////å¦‚æœå¸ƒå°”è¡¨è¾¾å¼ 2çš„å€¼ä¸ºtrueæ‰§è¡Œä»£ç </span>
   <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfNestDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"X = 30 and Y = 10"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// X = 30 and Y = 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-112"><a class="markdownIt-Anchor" href="#-112">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_1-5-switch-%E8%AF%AD%E5%8F%A5">#</a>1.5. switch è¯­å¥</h3>
<p><code>switch</code>  è¯­å¥åˆ¤æ–­ä¸€ä¸ªå˜é‡ä¸ä¸€ç³»åˆ—å€¼ä¸­æŸä¸ªå€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ¯ä¸ªå€¼ç§°ä¸ºä¸€ä¸ªåˆ†æ”¯ã€‚</p>
<p><code>switch</code>  è¯­å¥æœ‰å¦‚ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li><code>switch</code>  è¯­å¥ä¸­çš„å˜é‡ç±»å‹åªèƒ½ä¸º  <code>byte</code> ã€ <code>short</code> ã€ <code>int</code> ã€ <code>char</code>  æˆ–è€…  <code>String</code> ã€‚</li>
<li><code>switch</code>  è¯­å¥å¯ä»¥æ‹¥æœ‰å¤šä¸ª  <code>case</code>  è¯­å¥ã€‚æ¯ä¸ª  <code>case</code>  åé¢è·Ÿä¸€ä¸ªè¦æ¯”è¾ƒçš„å€¼å’Œå†’å·ã€‚</li>
<li><code>case</code>  è¯­å¥ä¸­çš„å€¼çš„æ•°æ®ç±»å‹å¿…é¡»ä¸å˜é‡çš„æ•°æ®ç±»å‹ç›¸åŒï¼Œè€Œä¸”åªèƒ½æ˜¯å¸¸é‡æˆ–è€…å­—é¢å¸¸é‡ã€‚</li>
<li>å½“å˜é‡çš„å€¼ä¸  <code>case</code>  è¯­å¥çš„å€¼ç›¸ç­‰æ—¶ï¼Œé‚£ä¹ˆ  <code>case</code>  è¯­å¥ä¹‹åçš„è¯­å¥å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°  <code>break</code>  è¯­å¥å‡ºç°æ‰ä¼šè·³å‡º  <code>switch</code>  è¯­å¥ã€‚</li>
<li>å½“é‡åˆ°  <code>break</code>  è¯­å¥æ—¶ï¼Œ <code>switch</code>  è¯­å¥ç»ˆæ­¢ã€‚ç¨‹åºè·³è½¬åˆ°  <code>switch</code>  è¯­å¥åé¢çš„è¯­å¥æ‰§è¡Œã€‚ <code>case</code>  è¯­å¥ä¸å¿…é¡»è¦åŒ…å«  <code>break</code>  è¯­å¥ã€‚å¦‚æœæ²¡æœ‰  <code>break</code>  è¯­å¥å‡ºç°ï¼Œç¨‹åºä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡  <code>case</code>  è¯­å¥ï¼Œç›´åˆ°å‡ºç°  <code>break</code>  è¯­å¥ã€‚</li>
<li><code>switch</code>  è¯­å¥å¯ä»¥åŒ…å«ä¸€ä¸ª  <code>default</code>  åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯å¿…é¡»æ˜¯  <code>switch</code>  è¯­å¥çš„æœ€åä¸€ä¸ªåˆ†æ”¯ã€‚ <code>default</code>  åœ¨æ²¡æœ‰  <code>case</code>  è¯­å¥çš„å€¼å’Œå˜é‡å€¼ç›¸ç­‰çš„æ—¶å€™æ‰§è¡Œã€‚ <code>default</code>  åˆ†æ”¯ä¸éœ€è¦  <code>break</code>  è¯­å¥ã€‚</li>
</ul>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">switch</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> value <span class="token operator">:</span>
       <span class="token comment">//è¯­å¥</span>
       <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//å¯é€‰</span>
    <span class="token keyword">case</span> value <span class="token operator">:</span>
       <span class="token comment">//è¯­å¥</span>
       <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//å¯é€‰</span>
    <span class="token comment">//ä½ å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„caseè¯­å¥</span>
    <span class="token keyword">default</span> <span class="token operator">:</span> <span class="token comment">//å¯é€‰</span>
       <span class="token comment">//è¯­å¥</span>
       <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//å¯é€‰ï¼Œä½†ä¸€èˆ¬å»ºè®®åŠ ä¸Š</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwitchDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">char</span> grade <span class="token operator">=</span> <span class="token string">'C'</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token string">'A'</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Excellent!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'B'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'C'</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Well done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'D'</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"You passed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'F'</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Better try again"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Invalid grade"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Your grade is "</span> <span class="token operator">+</span> grade<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// Well done</span>
<span class="token comment">// Your grade is C</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-113"><a class="markdownIt-Anchor" href="#-113">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_2-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5">#</a>2. å¾ªç¯è¯­å¥</h2>
<h3 id="-114"><a class="markdownIt-Anchor" href="#-114">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_2-1-while-%E5%BE%AA%E7%8E%AF">#</a>2.1. while å¾ªç¯</h3>
<p>åªè¦å¸ƒå°”è¡¨è¾¾å¼ä¸º  <code>true</code> ï¼Œ <code>while</code>  å¾ªç¯ä½“ä¼šä¸€ç›´æ‰§è¡Œä¸‹å»ã€‚</p>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span><span class="token punctuation">(</span> å¸ƒå°”è¡¨è¾¾å¼ <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//å¾ªç¯å†…å®¹</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WhileDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"value of x : "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            x<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// value of x : 10</span>
<span class="token comment">// value of x : 11</span>
<span class="token comment">// value of x : 12</span>
<span class="token comment">// value of x : 13</span>
<span class="token comment">// value of x : 14</span>
<span class="token comment">// value of x : 15</span>
<span class="token comment">// value of x : 16</span>
<span class="token comment">// value of x : 17</span>
<span class="token comment">// value of x : 18</span>
<span class="token comment">// value of x : 19</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-115"><a class="markdownIt-Anchor" href="#-115">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_2-2-do-while-%E5%BE%AA%E7%8E%AF">#</a>2.2. do while å¾ªç¯</h3>
<p>å¯¹äº  <code>while</code>  è¯­å¥è€Œè¨€ï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¸èƒ½è¿›å…¥å¾ªç¯ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å³ä½¿ä¸æ»¡è¶³æ¡ä»¶ï¼Œä¹Ÿè‡³å°‘æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p><code>do while</code>  å¾ªç¯å’Œ  <code>while</code>  å¾ªç¯ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯ï¼Œ <code>do while</code>  å¾ªç¯è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//ä»£ç è¯­å¥</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>å¸ƒå°”è¡¨è¾¾å¼<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¸ƒå°”è¡¨è¾¾å¼åœ¨å¾ªç¯ä½“çš„åé¢ï¼Œæ‰€ä»¥è¯­å¥å—åœ¨æ£€æµ‹å¸ƒå°”è¡¨è¾¾å¼ä¹‹å‰å·²ç»æ‰§è¡Œäº†ã€‚ å¦‚æœå¸ƒå°”è¡¨è¾¾å¼çš„å€¼ä¸º trueï¼Œåˆ™è¯­å¥å—ä¸€ç›´æ‰§è¡Œï¼Œç›´åˆ°å¸ƒå°”è¡¨è¾¾å¼çš„å€¼ä¸º falseã€‚</p>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DoWhileDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"value of x : "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            x<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// value of x:10</span>
<span class="token comment">// value of x:11</span>
<span class="token comment">// value of x:12</span>
<span class="token comment">// value of x:13</span>
<span class="token comment">// value of x:14</span>
<span class="token comment">// value of x:15</span>
<span class="token comment">// value of x:16</span>
<span class="token comment">// value of x:17</span>
<span class="token comment">// value of x:18</span>
<span class="token comment">// value of x:19</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-116"><a class="markdownIt-Anchor" href="#-116">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_2-3-for-%E5%BE%AA%E7%8E%AF">#</a>2.3. for å¾ªç¯</h3>
<p>è™½ç„¶æ‰€æœ‰å¾ªç¯ç»“æ„éƒ½å¯ä»¥ç”¨  <code>while</code>  æˆ–è€…  <code>do while</code>  è¡¨ç¤ºï¼Œä½† Java æä¾›äº†å¦ä¸€ç§è¯­å¥ â€”â€”  <code>for</code>  å¾ªç¯ï¼Œä½¿ä¸€äº›å¾ªç¯ç»“æ„å˜å¾—æ›´åŠ ç®€å•ã€‚  <code>for</code>  å¾ªç¯æ‰§è¡Œçš„æ¬¡æ•°æ˜¯åœ¨æ‰§è¡Œå‰å°±ç¡®å®šçš„ã€‚</p>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span>åˆå§‹åŒ–<span class="token punctuation">;</span> å¸ƒå°”è¡¨è¾¾å¼<span class="token punctuation">;</span> æ›´æ–°<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//ä»£ç è¯­å¥</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>æœ€å…ˆæ‰§è¡Œåˆå§‹åŒ–æ­¥éª¤ã€‚å¯ä»¥å£°æ˜ä¸€ç§ç±»å‹ï¼Œä½†å¯åˆå§‹åŒ–ä¸€ä¸ªæˆ–å¤šä¸ªå¾ªç¯æ§åˆ¶å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ç©ºè¯­å¥ã€‚</li>
<li>ç„¶åï¼Œæ£€æµ‹å¸ƒå°”è¡¨è¾¾å¼çš„å€¼ã€‚å¦‚æœä¸º trueï¼Œå¾ªç¯ä½“è¢«æ‰§è¡Œã€‚å¦‚æœä¸º falseï¼Œå¾ªç¯ç»ˆæ­¢ï¼Œå¼€å§‹æ‰§è¡Œå¾ªç¯ä½“åé¢çš„è¯­å¥ã€‚</li>
<li>æ‰§è¡Œä¸€æ¬¡å¾ªç¯åï¼Œæ›´æ–°å¾ªç¯æ§åˆ¶å˜é‡ã€‚</li>
<li>å†æ¬¡æ£€æµ‹å¸ƒå°”è¡¨è¾¾å¼ã€‚å¾ªç¯æ‰§è¡Œä¸Šé¢çš„è¿‡ç¨‹ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"value of x : "</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// value of x : 10</span>
<span class="token comment">// value of x : 11</span>
<span class="token comment">// value of x : 12</span>
<span class="token comment">// value of x : 13</span>
<span class="token comment">// value of x : 14</span>
<span class="token comment">// value of x : 15</span>
<span class="token comment">// value of x : 16</span>
<span class="token comment">// value of x : 17</span>
<span class="token comment">// value of x : 18</span>
<span class="token comment">// value of x : 19</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-117"><a class="markdownIt-Anchor" href="#-117">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_2-4-foreach-%E5%BE%AA%E7%8E%AF">#</a>2.4. foreach å¾ªç¯</h3>
<p>Java5 å¼•å…¥äº†ä¸€ç§ä¸»è¦ç”¨äºæ•°ç»„çš„å¢å¼ºå‹ for å¾ªç¯ã€‚</p>
<p><strong>è¯­æ³•</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span>å£°æ˜è¯­å¥ <span class="token operator">:</span> è¡¨è¾¾å¼<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//ä»£ç å¥å­</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>å£°æ˜è¯­å¥</strong>ï¼šå£°æ˜æ–°çš„å±€éƒ¨å˜é‡ï¼Œè¯¥å˜é‡çš„ç±»å‹å¿…é¡»å’Œæ•°ç»„å…ƒç´ çš„ç±»å‹åŒ¹é…ã€‚å…¶ä½œç”¨åŸŸé™å®šåœ¨å¾ªç¯è¯­å¥å—ï¼Œå…¶å€¼ä¸æ­¤æ—¶æ•°ç»„å…ƒç´ çš„å€¼ç›¸ç­‰ã€‚</p>
<p><strong>è¡¨è¾¾å¼</strong>ï¼šè¡¨è¾¾å¼æ˜¯è¦è®¿é—®çš„æ•°ç»„åï¼Œæˆ–è€…æ˜¯è¿”å›å€¼ä¸ºæ•°ç»„çš„æ–¹æ³•ã€‚</p>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForeachDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> numbers <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">:</span> numbers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> names <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"James"</span><span class="token punctuation">,</span> <span class="token string">"Larry"</span><span class="token punctuation">,</span> <span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token string">"Lacy"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> names<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 10,20,30,40,50,</span>
<span class="token comment">// James,Larry,Tom,Lacy,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-118"><a class="markdownIt-Anchor" href="#-118">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_3-%E4%B8%AD%E6%96%AD%E8%AF%AD%E5%8F%A5">#</a>3. ä¸­æ–­è¯­å¥</h2>
<h3 id="-119"><a class="markdownIt-Anchor" href="#-119">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_3-1-break-%E5%85%B3%E9%94%AE%E5%AD%97">#</a>3.1. break å…³é”®å­—</h3>
<p><code>break</code>  ä¸»è¦ç”¨åœ¨å¾ªç¯è¯­å¥æˆ–è€…  <code>switch</code>  è¯­å¥ä¸­ï¼Œç”¨æ¥è·³å‡ºæ•´ä¸ªè¯­å¥å—ã€‚</p>
<p><code>break</code>  è·³å‡ºæœ€é‡Œå±‚çš„å¾ªç¯ï¼Œå¹¶ä¸”ç»§ç»­æ‰§è¡Œè¯¥å¾ªç¯ä¸‹é¢çš„è¯­å¥ã€‚</p>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BreakDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> numbers <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">:</span> numbers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"break ç¤ºä¾‹ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 10</span>
<span class="token comment">// 20</span>
<span class="token comment">// break ç¤ºä¾‹ç»“æŸ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-120"><a class="markdownIt-Anchor" href="#-120">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_3-2-continue-%E5%85%B3%E9%94%AE%E5%AD%97">#</a>3.2. continue å…³é”®å­—</h3>
<p><code>continue</code>  é€‚ç”¨äºä»»ä½•å¾ªç¯æ§åˆ¶ç»“æ„ä¸­ã€‚ä½œç”¨æ˜¯è®©ç¨‹åºç«‹åˆ»è·³è½¬åˆ°ä¸‹ä¸€æ¬¡å¾ªç¯çš„è¿­ä»£ã€‚åœ¨  <code>for</code>  å¾ªç¯ä¸­ï¼Œ <code>continue</code>  è¯­å¥ä½¿ç¨‹åºç«‹å³è·³è½¬åˆ°æ›´æ–°è¯­å¥ã€‚åœ¨  <code>while</code>  æˆ–è€…  <code>do while</code>  å¾ªç¯ä¸­ï¼Œç¨‹åºç«‹å³è·³è½¬åˆ°å¸ƒå°”è¡¨è¾¾å¼çš„åˆ¤æ–­è¯­å¥ã€‚</p>
<p><strong>ç¤ºä¾‹</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContinueDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> numbers <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">:</span> numbers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 10</span>
<span class="token comment">// 20</span>
<span class="token comment">// 40</span>
<span class="token comment">// 50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-121"><a class="markdownIt-Anchor" href="#-121">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_3-3-return-%E5%85%B3%E9%94%AE%E5%AD%97">#</a>3.3. return å…³é”®å­—</h3>
<p>è·³å‡ºæ•´ä¸ªå‡½æ•°ä½“ï¼Œå‡½æ•°ä½“åé¢çš„éƒ¨åˆ†ä¸å†æ‰§è¡Œã€‚</p>
<p>ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReturnDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> numbers <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">:</span> numbers<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"return ç¤ºä¾‹ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// output:</span>
<span class="token comment">// 10</span>
<span class="token comment">// 20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šè¯·ä»”ç»†ä½“ä¼šä¸€ä¸‹  <code>return</code>  å’Œ  <code>break</code>  çš„åŒºåˆ«ã€‚</p>
</blockquote>
<h2 id="-122"><a class="markdownIt-Anchor" href="#-122">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-control-statement.html#_4-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">#</a>4. æœ€ä½³å®è·µ</h2>
<ul>
<li>é€‰æ‹©åˆ†æ”¯ç‰¹åˆ«å¤šçš„æƒ…å†µä¸‹ï¼Œ <code>switch</code>  è¯­å¥ä¼˜äº  <code>if...else if...else</code>  è¯­å¥ã€‚</li>
<li><code>switch</code>  è¯­å¥ä¸è¦åå•¬ä½¿ç”¨  <code>default</code> ã€‚</li>
<li><code>switch</code>  è¯­å¥ä¸­çš„  <code>default</code>  è¦æ”¾åœ¨æœ€åã€‚</li>
<li><code>foreach</code>  å¾ªç¯ä¼˜å…ˆäºä¼ ç»Ÿçš„  <code>for</code>  å¾ªç¯</li>
<li>ä¸è¦å¾ªç¯éå†å®¹å™¨å…ƒç´ ï¼Œç„¶ååˆ é™¤ç‰¹å®šå…ƒç´ ã€‚æ­£ç¡®å§¿åŠ¿åº”è¯¥æ˜¯éå†å®¹å™¨çš„è¿­ä»£å™¨ï¼ˆ <code>Iterator</code> ï¼‰ï¼Œåˆ é™¤å…ƒç´ ã€‚</li>
</ul>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-å¼‚å¸¸"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-å¼‚å¸¸">#</a> æ·±å…¥ç†è§£ Java å¼‚å¸¸</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553752019030.png" alt="img"></p>
<ul>
<li>\1. å¼‚å¸¸æ¡†æ¶
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#11-throwable">1.1. Throwable</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#12-error">1.2. Error</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#13-exception">1.3. Exception</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#14-runtimeexception">1.4. RuntimeException</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8">2. è‡ªå®šä¹‰å¼‚å¸¸</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#3-%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8">3. æŠ›å‡ºå¼‚å¸¸</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#4-%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8">4. æ•è·å¼‚å¸¸</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#5-%E5%BC%82%E5%B8%B8%E9%93%BE">5. å¼‚å¸¸é“¾</a></li>
<li>\6. å¼‚å¸¸æ³¨æ„äº‹é¡¹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#61-finally-%E8%A6%86%E7%9B%96%E5%BC%82%E5%B8%B8">6.1. finally è¦†ç›–å¼‚å¸¸</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#62-%E8%A6%86%E7%9B%96%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E7%9A%84%E6%96%B9%E6%B3%95">6.2. è¦†ç›–æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#63-%E5%BC%82%E5%B8%B8%E5%92%8C%E7%BA%BF%E7%A8%8B">6.3. å¼‚å¸¸å’Œçº¿ç¨‹</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#7-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">7. æœ€ä½³å®è·µ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#8-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">8. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-123"><a class="markdownIt-Anchor" href="#-123">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_1-%E5%BC%82%E5%B8%B8%E6%A1%86%E6%9E%B6">#</a>1. å¼‚å¸¸æ¡†æ¶</h2>
<h3 id="-124"><a class="markdownIt-Anchor" href="#-124">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_1-1-throwable">#</a>1.1. Throwable</h3>
<p>** <code>Throwable</code>  æ˜¯ Java è¯­è¨€ä¸­æ‰€æœ‰é”™è¯¯ï¼ˆ <code>Error</code> ï¼‰å’Œå¼‚å¸¸ï¼ˆ <code>Exception</code> ï¼‰çš„è¶…ç±»ã€‚** åœ¨ Java ä¸­åªæœ‰  <code>Throwable</code>  ç±»å‹çš„å®ä¾‹æ‰å¯ä»¥è¢«æŠ›å‡ºï¼ˆ <code>throw</code> ï¼‰æˆ–è€…æ•è·ï¼ˆ <code>catch</code> ï¼‰ï¼Œå®ƒæ˜¯å¼‚å¸¸å¤„ç†æœºåˆ¶çš„åŸºæœ¬ç»„æˆç±»å‹ã€‚</p>
<p><code>Throwable</code>  åŒ…å«äº†å…¶çº¿ç¨‹åˆ›å»ºæ—¶çº¿ç¨‹æ‰§è¡Œå †æ ˆçš„å¿«ç…§ï¼Œå®ƒæä¾›äº†  <code>printStackTrace()</code>  ç­‰æ¥å£ç”¨äºè·å–å †æ ˆè·Ÿè¸ªæ•°æ®ç­‰ä¿¡æ¯ã€‚</p>
<p>ä¸»è¦æ–¹æ³•ï¼š</p>
<ul>
<li><code>fillInStackTrace</code>  - ç”¨å½“å‰çš„è°ƒç”¨æ ˆå±‚æ¬¡å¡«å……  <code>Throwable</code>  å¯¹è±¡æ ˆå±‚æ¬¡ï¼Œæ·»åŠ åˆ°æ ˆå±‚æ¬¡ä»»ä½•å…ˆå‰ä¿¡æ¯ä¸­ã€‚</li>
<li><code>getMessage</code>  - è¿”å›å…³äºå‘ç”Ÿçš„å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™ä¸ªæ¶ˆæ¯åœ¨  <code>Throwable</code>  ç±»çš„æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–äº†ã€‚</li>
<li><code>getCause</code>  - è¿”å›ä¸€ä¸ª  <code>Throwable</code>  å¯¹è±¡ä»£è¡¨å¼‚å¸¸åŸå› ã€‚</li>
<li><code>getStackTrace</code>  - è¿”å›ä¸€ä¸ªåŒ…å«å †æ ˆå±‚æ¬¡çš„æ•°ç»„ã€‚ä¸‹æ ‡ä¸º 0 çš„å…ƒç´ ä»£è¡¨æ ˆé¡¶ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä»£è¡¨æ–¹æ³•è°ƒç”¨å †æ ˆçš„æ ˆåº•ã€‚</li>
<li><code>printStackTrace</code>  - æ‰“å°  <code>toString()</code>  ç»“æœå’Œæ ˆå±‚æ¬¡åˆ°  <code>System.err</code> ï¼Œå³é”™è¯¯è¾“å‡ºæµã€‚</li>
<li><code>toString</code>  - ä½¿ç”¨  <code>getMessage</code>  çš„ç»“æœè¿”å›ä»£è¡¨  <code>Throwable</code>  å¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h3 id="-125"><a class="markdownIt-Anchor" href="#-125">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_1-2-error">#</a>1.2. Error</h3>
<p><code>Error</code>  æ˜¯  <code>Throwable</code>  çš„ä¸€ä¸ªå­ç±»ã€‚<strong> <code>Error</code>  è¡¨ç¤ºæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸å¤§å¯èƒ½å‡ºç°çš„ä¸¥é‡é—®é¢˜</strong>ã€‚<strong>ç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥  <code>Error</code> </strong>ã€‚ç»å¤§éƒ¨åˆ†çš„ Error éƒ½ä¼šå¯¼è‡´ç¨‹åºï¼ˆæ¯”å¦‚ JVM è‡ªèº«ï¼‰å¤„äºéæ­£å¸¸çš„ã€ä¸å¯æ¢å¤çŠ¶æ€ã€‚æ—¢ç„¶æ˜¯éæ­£å¸¸æƒ…å†µï¼Œæ‰€ä»¥ä¸ä¾¿äºä¹Ÿä¸éœ€è¦æ•è·ï¼Œå¸¸è§çš„æ¯”å¦‚ OutOfMemoryError ä¹‹ç±»ï¼Œéƒ½æ˜¯ Error çš„å­ç±»ã€‚</p>
<p>å¸¸è§  <code>Error</code> ï¼š</p>
<ul>
<li><code>AssertionError</code>  - æ–­è¨€é”™è¯¯ã€‚</li>
<li><code>VirtualMachineError</code>  - è™šæ‹Ÿæœºé”™è¯¯ã€‚</li>
<li><code>UnsupportedClassVersionError</code>  - Java ç±»ç‰ˆæœ¬é”™è¯¯ã€‚</li>
<li><code>StackOverflowError</code>  - æ ˆæº¢å‡ºé”™è¯¯ã€‚</li>
<li><code>OutOfMemoryError</code>  - å†…å­˜æº¢å‡ºé”™è¯¯ã€‚</li>
</ul>
<h3 id="-126"><a class="markdownIt-Anchor" href="#-126">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_1-3-exception">#</a>1.3. Exception</h3>
<p><code>Exception</code>  æ˜¯  <code>Throwable</code>  çš„ä¸€ä¸ªå­ç±»ã€‚** <code>Exception</code>  è¡¨ç¤ºåˆç†çš„åº”ç”¨ç¨‹åºå¯èƒ½æƒ³è¦æ•è·çš„æ¡ä»¶ã€‚**Exception æ˜¯ç¨‹åºæ­£å¸¸è¿è¡Œä¸­ï¼Œå¯ä»¥é¢„æ–™çš„æ„å¤–æƒ…å†µï¼Œå¯èƒ½å¹¶ä¸”åº”è¯¥è¢«æ•è·ï¼Œè¿›è¡Œç›¸åº”å¤„ç†ã€‚</p>
<p>Exception åˆåˆ†ä¸ºå¯æ£€æŸ¥ï¼ˆcheckedï¼‰å¼‚å¸¸å’Œä¸æ£€æŸ¥ï¼ˆuncheckedï¼‰å¼‚å¸¸ï¼Œå¯æ£€æŸ¥å¼‚å¸¸åœ¨æºä»£ç é‡Œå¿…é¡»æ˜¾å¼åœ°è¿›è¡Œæ•è·å¤„ç†ï¼Œè¿™æ˜¯ç¼–è¯‘æœŸæ£€æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>** ç¼–è¯‘å™¨ä¼šæ£€æŸ¥  <code>Exception</code>  å¼‚å¸¸ã€‚** æ­¤ç±»å¼‚å¸¸ï¼Œè¦ä¹ˆé€šè¿‡  <code>throws</code>  è¿›è¡Œå£°æ˜æŠ›å‡ºï¼Œè¦ä¹ˆé€šè¿‡  <code>try catch</code>  è¿›è¡Œæ•è·å¤„ç†ï¼Œå¦åˆ™ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚</p>
<p>å¸¸è§  <code>Exception</code> ï¼š</p>
<ul>
<li><code>ClassNotFoundException</code>  - åº”ç”¨ç¨‹åºè¯•å›¾åŠ è½½ç±»æ—¶ï¼Œæ‰¾ä¸åˆ°ç›¸åº”çš„ç±»ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>CloneNotSupportedException</code>  - å½“è°ƒç”¨ Object ç±»ä¸­çš„ clone æ–¹æ³•å…‹éš†å¯¹è±¡ï¼Œä½†è¯¥å¯¹è±¡çš„ç±»æ— æ³•å®ç° Cloneable æ¥å£æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>IllegalAccessException</code>  - æ‹’ç»è®¿é—®ä¸€ä¸ªç±»çš„æ—¶å€™ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>InstantiationException</code>  - å½“è¯•å›¾ä½¿ç”¨ Class ç±»ä¸­çš„ newInstance æ–¹æ³•åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œè€ŒæŒ‡å®šçš„ç±»å¯¹è±¡å› ä¸ºæ˜¯ä¸€ä¸ªæ¥å£æˆ–æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»è€Œæ— æ³•å®ä¾‹åŒ–æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>InterruptedException</code>  - ä¸€ä¸ªçº¿ç¨‹è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¸­æ–­ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>NoSuchFieldException</code>  - è¯·æ±‚çš„å˜é‡ä¸å­˜åœ¨ã€‚</li>
<li><code>NoSuchMethodException</code>  - è¯·æ±‚çš„æ–¹æ³•ä¸å­˜åœ¨ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"toString"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯•å›¾ç¼–è¯‘è¿è¡Œæ—¶ä¼šæŠ¥é”™ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Error:(7, 47) java: æœªæŠ¥å‘Šçš„å¼‚å¸¸é”™è¯¯java.lang.NoSuchMethodException; å¿…é¡»å¯¹å…¶è¿›è¡Œæ•è·æˆ–å£°æ˜ä»¥ä¾¿æŠ›å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-127"><a class="markdownIt-Anchor" href="#-127">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_1-4-runtimeexception">#</a>1.4. RuntimeException</h3>
<p><code>RuntimeException</code>  æ˜¯  <code>Exception</code>  çš„ä¸€ä¸ªå­ç±»ã€‚ <code>RuntimeException</code>  æ˜¯é‚£äº›å¯èƒ½åœ¨ Java è™šæ‹Ÿæœºæ­£å¸¸è¿è¡ŒæœŸé—´æŠ›å‡ºçš„å¼‚å¸¸çš„è¶…ç±»ã€‚</p>
<p>** ç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥  <code>RuntimeException</code>  å¼‚å¸¸ã€‚** å½“ç¨‹åºä¸­å¯èƒ½å‡ºç°è¿™ç±»å¼‚å¸¸æ—¶ï¼Œå€˜è‹¥æ—¢æ²¡æœ‰é€šè¿‡  <code>throws</code>  å£°æ˜æŠ›å‡ºå®ƒï¼Œä¹Ÿæ²¡æœ‰ç”¨  <code>try catch</code>  è¯­å¥æ•è·å®ƒï¼Œç¨‹åºè¿˜æ˜¯ä¼šç¼–è¯‘é€šè¿‡ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuntimeExceptionDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æ­¤å¤„äº§ç”Ÿäº†å¼‚å¸¸</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸¤ä¸ªæ•°å­—ç›¸é™¤çš„ç»“æœï¼š"</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿è¡Œæ—¶è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Exception in thread "main" java.lang.ArithmeticException: / by zero
	at io.github.dunwu.javacore.exception.RumtimeExceptionDemo01.main(RumtimeExceptionDemo01.java:6)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¸¸è§  <code>RuntimeException</code> ï¼š</p>
<ul>
<li><code>ArrayIndexOutOfBoundsException</code>  - ç”¨éæ³•ç´¢å¼•è®¿é—®æ•°ç»„æ—¶æŠ›å‡ºçš„å¼‚å¸¸ã€‚å¦‚æœç´¢å¼•ä¸ºè´Ÿæˆ–å¤§äºç­‰äºæ•°ç»„å¤§å°ï¼Œåˆ™è¯¥ç´¢å¼•ä¸ºéæ³•ç´¢å¼•ã€‚</li>
<li><code>ArrayStoreException</code>  - è¯•å›¾å°†é”™è¯¯ç±»å‹çš„å¯¹è±¡å­˜å‚¨åˆ°ä¸€ä¸ªå¯¹è±¡æ•°ç»„æ—¶æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li>
<li><code>ClassCastException</code>  - å½“è¯•å›¾å°†å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºä¸æ˜¯å®ä¾‹çš„å­ç±»æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>IllegalArgumentException</code>  - æŠ›å‡ºçš„å¼‚å¸¸è¡¨æ˜å‘æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªä¸åˆæ³•æˆ–ä¸æ­£ç¡®çš„å‚æ•°ã€‚</li>
<li><code>IllegalMonitorStateException</code>  - æŠ›å‡ºçš„å¼‚å¸¸è¡¨æ˜æŸä¸€çº¿ç¨‹å·²ç»è¯•å›¾ç­‰å¾…å¯¹è±¡çš„ç›‘è§†å™¨ï¼Œæˆ–è€…è¯•å›¾é€šçŸ¥å…¶ä»–æ­£åœ¨ç­‰å¾…å¯¹è±¡çš„ç›‘è§†å™¨è€Œæœ¬èº«æ²¡æœ‰æŒ‡å®šç›‘è§†å™¨çš„çº¿ç¨‹ã€‚</li>
<li><code>IllegalStateException</code>  - åœ¨éæ³•æˆ–ä¸é€‚å½“çš„æ—¶é—´è°ƒç”¨æ–¹æ³•æ—¶äº§ç”Ÿçš„ä¿¡å·ã€‚æ¢å¥è¯è¯´ï¼Œå³ Java ç¯å¢ƒæˆ– Java åº”ç”¨ç¨‹åºæ²¡æœ‰å¤„äºè¯·æ±‚æ“ä½œæ‰€è¦æ±‚çš„é€‚å½“çŠ¶æ€ä¸‹ã€‚</li>
<li><code>IllegalThreadStateException</code>  - çº¿ç¨‹æ²¡æœ‰å¤„äºè¯·æ±‚æ“ä½œæ‰€è¦æ±‚çš„é€‚å½“çŠ¶æ€æ—¶æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li>
<li><code>IndexOutOfBoundsException</code>  - æŒ‡ç¤ºæŸæ’åºç´¢å¼•ï¼ˆä¾‹å¦‚å¯¹æ•°ç»„ã€å­—ç¬¦ä¸²æˆ–å‘é‡çš„æ’åºï¼‰è¶…å‡ºèŒƒå›´æ—¶æŠ›å‡ºã€‚</li>
<li><code>NegativeArraySizeException</code>  - å¦‚æœåº”ç”¨ç¨‹åºè¯•å›¾åˆ›å»ºå¤§å°ä¸ºè´Ÿçš„æ•°ç»„ï¼Œåˆ™æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>NullPointerException</code>  - å½“åº”ç”¨ç¨‹åºè¯•å›¾åœ¨éœ€è¦å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨ null æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸</li>
<li><code>NumberFormatException</code>  - å½“åº”ç”¨ç¨‹åºè¯•å›¾å°†å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ç§æ•°å€¼ç±»å‹ï¼Œä½†è¯¥å­—ç¬¦ä¸²ä¸èƒ½è½¬æ¢ä¸ºé€‚å½“æ ¼å¼æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
<li><code>SecurityException</code>  - ç”±å®‰å…¨ç®¡ç†å™¨æŠ›å‡ºçš„å¼‚å¸¸ï¼ŒæŒ‡ç¤ºå­˜åœ¨å®‰å…¨ä¾µçŠ¯ã€‚</li>
<li><code>StringIndexOutOfBoundsException</code>  - æ­¤å¼‚å¸¸ç”± String æ–¹æ³•æŠ›å‡ºï¼ŒæŒ‡ç¤ºç´¢å¼•æˆ–è€…ä¸ºè´Ÿï¼Œæˆ–è€…è¶…å‡ºå­—ç¬¦ä¸²çš„å¤§å°ã€‚</li>
<li><code>UnsupportedOperationException</code>  - å½“ä¸æ”¯æŒè¯·æ±‚çš„æ“ä½œæ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</li>
</ul>
<h2 id="-128"><a class="markdownIt-Anchor" href="#-128">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8">#</a>2. è‡ªå®šä¹‰å¼‚å¸¸</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553752795010.png" alt="img"></p>
<p><strong>è‡ªå®šä¹‰ä¸€ä¸ªå¼‚å¸¸ç±»ï¼Œåªéœ€è¦ç»§æ‰¿  <code>Exception</code>  æˆ–  <code>RuntimeException</code>  å³å¯ã€‚</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyExceptionDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyException</span><span class="token punctuation">(</span><span class="token string">"è‡ªå®šä¹‰å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">MyException</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Exception in thread "main" io.github.dunwu.javacore.exception.MyExceptionDemo$MyException: è‡ªå®šä¹‰å¼‚å¸¸
	at io.github.dunwu.javacore.exception.MyExceptionDemo.main(MyExceptionDemo.java:9)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-129"><a class="markdownIt-Anchor" href="#-129">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_3-%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8">#</a>3. æŠ›å‡ºå¼‚å¸¸</h2>
<p>å¦‚æœæƒ³åœ¨ç¨‹åºä¸­æ˜ç¡®åœ°æŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦ç”¨åˆ°  <code>throw</code>  å’Œ  <code>throws</code>  ã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ–¹æ³•æ²¡æœ‰æ•è·ä¸€ä¸ªæ£€æŸ¥æ€§å¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å¿…é¡»ä½¿ç”¨  <code>throws</code>  å…³é”®å­—æ¥å£°æ˜ã€‚ <code>throws</code>  å…³é”®å­—æ”¾åœ¨æ–¹æ³•ç­¾åçš„å°¾éƒ¨ã€‚</p>
<p><code>throw</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThrowDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">java.lang.RuntimeException: æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨  <code>throw</code>  å…³é”®å­—æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œæ— è®ºå®ƒæ˜¯æ–°å®ä¾‹åŒ–çš„è¿˜æ˜¯åˆšæ•è·åˆ°çš„ã€‚</p>
<p><code>throws</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThrowsDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchFieldException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Field</span> field <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"digits"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>field <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åå°„è·å– digits æ–¹æ³•æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"toString"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åå°„è·å– toString æ–¹æ³•æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// è°ƒç”¨ f1 å¤„ï¼Œå¦‚æœä¸ç”¨ try catch ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™</span>
            <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">åå°„è·å– digits æ–¹æ³•æˆåŠŸ
java.lang.NoSuchMethodException: java.lang.String.toString(int)
	at java.lang.Class.getMethod(Class.java:1786)
	at io.github.dunwu.javacore.exception.ThrowsDemo.f1(ThrowsDemo.java:12)
	at io.github.dunwu.javacore.exception.ThrowsDemo.f2(ThrowsDemo.java:21)
	at io.github.dunwu.javacore.exception.ThrowsDemo.main(ThrowsDemo.java:30)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>throw å’Œ throws çš„åŒºåˆ«ï¼š</p>
<ul>
<li>throws ä½¿ç”¨åœ¨å‡½æ•°ä¸Šï¼Œthrow ä½¿ç”¨åœ¨å‡½æ•°å†…ã€‚</li>
<li>throws åé¢è·Ÿå¼‚å¸¸ç±»ï¼Œå¯ä»¥è·Ÿå¤šä¸ªï¼Œç”¨é€—å·åŒºåˆ«ï¼›throw åé¢è·Ÿçš„æ˜¯å¼‚å¸¸å¯¹è±¡ã€‚</li>
</ul>
<h2 id="-130"><a class="markdownIt-Anchor" href="#-130">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_4-%E6%8D%95%E8%8E%B7%E5%BC%82%E5%B8%B8">#</a>4. æ•è·å¼‚å¸¸</h2>
<p><strong>ä½¿ç”¨ try å’Œ catch å…³é”®å­—å¯ä»¥æ•è·å¼‚å¸¸</strong>ã€‚try catch ä»£ç å—æ”¾åœ¨å¼‚å¸¸å¯èƒ½å‘ç”Ÿçš„åœ°æ–¹ã€‚</p>
<p>å®ƒçš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„ä»£ç å—</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ•è·å¹¶å¤„ç†tryæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹Exception</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception2</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ•è·å¹¶å¤„ç†tryæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹Exception2</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½å°†æ‰§è¡Œçš„ä»£ç å—</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­¤å¤–ï¼ŒJDK7 ä»¥åï¼Œ <code>catch</code>  å¤šç§å¼‚å¸¸æ—¶ï¼Œä¹Ÿå¯ä»¥åƒä¸‹é¢è¿™æ ·ç®€åŒ–ä»£ç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// å¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„ä»£ç å—</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token operator">|</span> <span class="token class-name">Exception2</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ•è·å¹¶å¤„ç†tryæŠ›å‡ºçš„å¼‚å¸¸ç±»å‹</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½å°†æ‰§è¡Œçš„ä»£ç å—</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>try</code>  - <strong> <code>try</code>  è¯­å¥ç”¨äºç›‘å¬ã€‚å°†è¦è¢«ç›‘å¬çš„ä»£ç  (å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ) æ”¾åœ¨  <code>try</code>  è¯­å¥å—ä¹‹å†…ï¼Œå½“  <code>try</code>  è¯­å¥å—å†…å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¼‚å¸¸å°±è¢«æŠ›å‡ºã€‚</strong></li>
<li><code>catch</code>  -  <code>catch</code>  è¯­å¥åŒ…å«è¦æ•è·å¼‚å¸¸ç±»å‹çš„å£°æ˜ã€‚å½“ä¿æŠ¤ä»£ç å—ä¸­å‘ç”Ÿä¸€ä¸ªå¼‚å¸¸æ—¶ï¼Œ <code>try</code>  åé¢çš„  <code>catch</code>  å—å°±ä¼šè¢«æ£€æŸ¥ã€‚</li>
<li><code>finally</code>  - <strong> <code>finally</code>  è¯­å¥å—æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œæ— è®ºæ˜¯å¦å‡ºç°å¼‚å¸¸ã€‚</strong> <code>try catch</code>  è¯­å¥åä¸ä¸€å®šéè¦ <code>finally</code>  è¯­å¥ã€‚ <code>finally</code>  å¸¸ç”¨äºè¿™æ ·çš„åœºæ™¯ï¼šç”±äº <code>finally</code>  è¯­å¥å—æ€»æ˜¯ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥é‚£äº›åœ¨  <code>try</code>  ä»£ç å—ä¸­æ‰“å¼€çš„ï¼Œå¹¶ä¸”å¿…é¡»å›æ”¶çš„ç‰©ç†èµ„æº (å¦‚æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥å’Œæ–‡ä»¶)ï¼Œä¸€èˆ¬ä¼šæ”¾åœ¨ <code>finally</code>  è¯­å¥å—ä¸­é‡Šæ”¾èµ„æºã€‚</li>
<li><code>try</code> ã€ <code>catch</code> ã€ <code>finally</code>  ä¸‰ä¸ªä»£ç å—ä¸­çš„å±€éƒ¨å˜é‡ä¸å¯å…±äº«ä½¿ç”¨ã€‚</li>
<li><code>catch</code>  å—å°è¯•æ•è·å¼‚å¸¸æ—¶ï¼Œæ˜¯æŒ‰ç…§  <code>catch</code>  å—çš„å£°æ˜é¡ºåºä»ä¸Šå¾€ä¸‹å¯»æ‰¾çš„ï¼Œä¸€æ—¦åŒ¹é…ï¼Œå°±ä¸ä¼šå†å‘ä¸‹æ‰§è¡Œã€‚å› æ­¤ï¼Œå¦‚æœåŒä¸€ä¸ª  <code>try</code>  å—ä¸‹çš„å¤šä¸ª  <code>catch</code>  å¼‚å¸¸ç±»å‹æœ‰çˆ¶å­å…³ç³»ï¼Œåº”è¯¥å°†å­ç±»å¼‚å¸¸æ”¾åœ¨å‰é¢ï¼Œçˆ¶ç±»å¼‚å¸¸æ”¾åœ¨åé¢ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TryCatchFinallyDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// æ­¤å¤„äº§ç”Ÿäº†å¼‚å¸¸</span>
            <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸¤ä¸ªæ•°å­—ç›¸é™¤çš„ç»“æœï¼š"</span> <span class="token operator">+</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"----------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ArithmeticException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å‡ºç°å¼‚å¸¸äº†ï¼š"</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œéƒ½æ‰§è¡Œæ­¤ä»£ç "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿è¡Œæ—¶è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">å‡ºç°å¼‚å¸¸äº†ï¼šjava.lang.ArithmeticException: / by zero
ä¸ç®¡æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œéƒ½æ‰§è¡Œæ­¤ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-131"><a class="markdownIt-Anchor" href="#-131">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_5-%E5%BC%82%E5%B8%B8%E9%93%BE">#</a>5. å¼‚å¸¸é“¾</h2>
<p>å¼‚å¸¸é“¾æ˜¯ä»¥ä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ä¸ºå‚æ•°æ„é€ æ–°çš„å¼‚å¸¸å¯¹è±¡ï¼Œæ–°çš„å¼‚å¸¸å¯¹è±¡å°†åŒ…å«å…ˆå‰å¼‚å¸¸çš„ä¿¡æ¯ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨å¼‚å¸¸é“¾ï¼Œæˆ‘ä»¬å¯ä»¥æé«˜ä»£ç çš„å¯ç†è§£æ€§ã€ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå‹å¥½æ€§ã€‚</p>
<p>æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¤„ç†å¼‚å¸¸ï¼Œä¸€æ˜¯  <code>throws</code>  æŠ›å‡ºäº¤ç»™ä¸Šçº§å¤„ç†ï¼ŒäºŒæ˜¯  <code>tryâ€¦catch</code>  åšå…·ä½“å¤„ç†ã€‚ <code>tryâ€¦catch</code>  çš„  <code>catch</code>  å—æˆ‘ä»¬å¯ä»¥ä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œä»…ä»…åªç”¨ throw è¿™ä¸ªå…³é”®å­—å°†æˆ‘ä»¬å°è£…å¼‚å¸¸ä¿¡æ¯ä¸»åŠ¨æŠ›å‡ºæ¥ã€‚ç„¶ååœ¨é€šè¿‡å…³é”®å­—  <code>throws</code>  ç»§ç»­æŠ›å‡ºè¯¥æ–¹æ³•å¼‚å¸¸ã€‚å®ƒçš„ä¸Šå±‚ä¹Ÿå¯ä»¥åšè¿™æ ·çš„å¤„ç†ï¼Œä»¥æ­¤ç±»æ¨å°±ä¼šäº§ç”Ÿä¸€æ¡ç”±å¼‚å¸¸æ„æˆçš„å¼‚å¸¸é“¾ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionChainDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyException1</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">MyException1</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyException2</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">MyException2</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MyException1</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyException1</span><span class="token punctuation">(</span><span class="token string">"å‡ºç° MyException1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MyException2</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MyException1</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyException2</span><span class="token punctuation">(</span><span class="token string">"å‡ºç° MyException2"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MyException2</span> <span class="token punctuation">&#123;</span>
        <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Exception in thread "main" io.github.dunwu.javacore.exception.ExceptionChainDemo$MyException2: å‡ºç° MyException2
	at io.github.dunwu.javacore.exception.ExceptionChainDemo.f2(ExceptionChainDemo.java:29)
	at io.github.dunwu.javacore.exception.ExceptionChainDemo.main(ExceptionChainDemo.java:34)
Caused by: io.github.dunwu.javacore.exception.ExceptionChainDemo$MyException1: å‡ºç° MyException1
	at io.github.dunwu.javacore.exception.ExceptionChainDemo.f1(ExceptionChainDemo.java:22)
	at io.github.dunwu.javacore.exception.ExceptionChainDemo.f2(ExceptionChainDemo.java:27)
	... 1 more<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/5b6d61e55188251b38129f9a#heading-10">https://juejin.im/post/5b6d61e55188251b38129f9a#heading-10</a></p>
<p>è¿™ç¯‡æ–‡ç« ä¸­å¯¹äºå¼‚å¸¸é“¾è®²è§£æ¯”è¾ƒè¯¦ç»†ã€‚</p>
</blockquote>
<h2 id="-132"><a class="markdownIt-Anchor" href="#-132">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_6-%E5%BC%82%E5%B8%B8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">#</a>6. å¼‚å¸¸æ³¨æ„äº‹é¡¹</h2>
<h3 id="-133"><a class="markdownIt-Anchor" href="#-133">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_6-1-finally-%E8%A6%86%E7%9B%96%E5%BC%82%E5%B8%B8">#</a>6.1. finally è¦†ç›–å¼‚å¸¸</h3>
<p>Java å¼‚å¸¸å¤„ç†ä¸­  <code>finally</code>  ä¸­çš„  <code>return</code>  ä¼šè¦†ç›–  <code>catch</code>  ä»£ç å—ä¸­çš„  <code>return</code>  è¯­å¥å’Œ  <code>throw</code>  è¯­å¥ï¼Œæ‰€ä»¥ Java <strong>ä¸å»ºè®®åœ¨  <code>finally</code>  ä¸­ä½¿ç”¨  <code>return</code>  è¯­å¥</strong>ã€‚</p>
<p>æ­¤å¤–  <code>finally</code>  ä¸­çš„  <code>throw</code>  è¯­å¥ä¹Ÿä¼šè¦†ç›–  <code>catch</code>  ä»£ç å—ä¸­çš„  <code>return</code>  è¯­å¥å’Œ  <code>throw</code>  è¯­å¥ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FinallyOverrideExceptionDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼šC</p>
<h3 id="-134"><a class="markdownIt-Anchor" href="#-134">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_6-2-%E8%A6%86%E7%9B%96%E6%8A%9B%E5%87%BA%E5%BC%82%E5%B8%B8%E7%9A%84%E6%96%B9%E6%B3%95">#</a>6.2. è¦†ç›–æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•</h3>
<p>å½“å­ç±»é‡å†™çˆ¶ç±»å¸¦æœ‰  <code>throws</code>  å£°æ˜çš„å‡½æ•°æ—¶ï¼Œå…¶  <code>throws</code>  å£°æ˜çš„å¼‚å¸¸å¿…é¡»åœ¨çˆ¶ç±»å¼‚å¸¸çš„å¯æ§èŒƒå›´å†… â€”â€” ç”¨äºå¤„ç†çˆ¶ç±»çš„  <code>throws</code>  æ–¹æ³•çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œå¿…é¡»ä¹Ÿé€‚ç”¨äºå­ç±»çš„è¿™ä¸ªå¸¦  <code>throws</code>  æ–¹æ³• ã€‚è¿™æ˜¯ä¸ºäº†æ”¯æŒå¤šæ€ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionOverrideDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Father</span> obj1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Father</span> obj2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            obj1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            obj2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ä¸Šé¢çš„ç¤ºä¾‹ç¼–è¯‘æ—¶ä¼šæŠ¥é”™ï¼ŒåŸå› åœ¨äºï¼š</p>
<p>å› ä¸º Son ç±»æŠ›å‡ºå¼‚å¸¸çš„å®è´¨æ˜¯  <code>SQLException</code> ï¼Œè€Œ  <code>IOException</code>  æ— æ³•å¤„ç†å®ƒã€‚é‚£ä¹ˆè¿™é‡Œçš„ try catch å°±ä¸èƒ½å¤„ç† Son ä¸­çš„å¼‚å¸¸äº†ã€‚å¤šæ€å°±ä¸èƒ½å®ç°äº†ã€‚</p>
</blockquote>
<h3 id="-135"><a class="markdownIt-Anchor" href="#-135">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_6-3-%E5%BC%82%E5%B8%B8%E5%92%8C%E7%BA%BF%E7%A8%8B">#</a>6.3. å¼‚å¸¸å’Œçº¿ç¨‹</h3>
<p>å¦‚æœ Java ç¨‹åºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæ²¡æœ‰è¢«ä»»ä½•ä»£ç å¤„ç†çš„å¼‚å¸¸ä¼šå¯¼è‡´ç¨‹åºç»ˆæ­¢ã€‚å¦‚æœ Java ç¨‹åºæ˜¯å¤šçº¿ç¨‹çš„ï¼Œé‚£ä¹ˆæ²¡æœ‰è¢«ä»»ä½•ä»£ç å¤„ç†çš„å¼‚å¸¸ä»…ä»…ä¼šå¯¼è‡´å¼‚å¸¸æ‰€åœ¨çš„çº¿ç¨‹ç»“æŸã€‚</p>
<h2 id="-136"><a class="markdownIt-Anchor" href="#-136">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-exception.html#_7-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">#</a>7. æœ€ä½³å®è·µ</h2>
<ul>
<li>å¯¹å¯æ¢å¤çš„æƒ…å†µä½¿ç”¨æ£€æŸ¥æ€§å¼‚å¸¸ï¼ˆExceptionï¼‰ï¼Œå¯¹ç¼–ç¨‹é”™è¯¯ä½¿ç”¨è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ã€‚</li>
<li>ä¼˜å…ˆä½¿ç”¨ Java æ ‡å‡†çš„å¼‚å¸¸ã€‚</li>
<li>æŠ›å‡ºä¸æŠ½è±¡ç›¸å¯¹åº”çš„å¼‚å¸¸ã€‚</li>
<li>åœ¨ç»†èŠ‚æ¶ˆæ¯ä¸­åŒ…å«èƒ½æ•è·å¤±è´¥çš„ä¿¡æ¯ã€‚</li>
<li>å°½å¯èƒ½å‡å°‘ try ä»£ç å—çš„å¤§å°ã€‚</li>
<li>å°½é‡ç¼©å°å¼‚å¸¸èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ˜çŸ¥å°è¯•æ•è·çš„æ˜¯ä¸€ä¸ª  <code>ArithmeticException</code> ï¼Œå°±åº”è¯¥  <code>catch</code>   <code>ArithmeticException</code> ï¼Œè€Œä¸æ˜¯  <code>catch</code>  èŒƒå›´è¾ƒå¤§çš„  <code>RuntimeException</code> ï¼Œç”šè‡³æ˜¯  <code>Exception</code> ã€‚</li>
<li>å°½é‡ä¸è¦åœ¨  <code>finally</code>  å—æŠ›å‡ºå¼‚å¸¸æˆ–è€…è¿”å›å€¼ã€‚</li>
<li>ä¸è¦å¿½ç•¥å¼‚å¸¸ï¼Œä¸€æ—¦æ•è·å¼‚å¸¸ï¼Œå°±åº”è¯¥å¤„ç†ï¼Œè€Œéä¸¢å¼ƒã€‚</li>
<li>å¼‚å¸¸å¤„ç†æ•ˆç‡å¾ˆä½ï¼Œæ‰€ä»¥ä¸è¦ç”¨å¼‚å¸¸è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚</li>
<li>å„ç±»å¼‚å¸¸å¿…é¡»è¦æœ‰å•ç‹¬çš„æ—¥å¿—è®°å½•ï¼Œå°†å¼‚å¸¸åˆ†çº§ï¼Œåˆ†ç±»ç®¡ç†ï¼Œå› ä¸ºæœ‰çš„æ—¶å€™ä»…ä»…æƒ³ç»™ç¬¬ä¸‰æ–¹è¿ç»´çœ‹åˆ°é€»è¾‘å¼‚å¸¸ï¼Œè€Œä¸æ˜¯æ›´ç»†èŠ‚çš„ä¿¡æ¯ã€‚</li>
<li>å¦‚ä½•å¯¹å¼‚å¸¸è¿›è¡Œåˆ†ç±»ï¼š
<ul>
<li>é€»è¾‘å¼‚å¸¸ï¼Œè¿™ç±»å¼‚å¸¸ç”¨äºæè¿°ä¸šåŠ¡æ— æ³•æŒ‰ç…§é¢„æœŸçš„æƒ…å†µå¤„ç†ä¸‹å»ï¼Œå±äºç”¨æˆ·åˆ¶é€ çš„æ„å¤–ã€‚</li>
<li>ä»£ç é”™è¯¯ï¼Œè¿™ç±»å¼‚å¸¸ç”¨äºæè¿°å¼€å‘çš„ä»£ç é”™è¯¯ï¼Œä¾‹å¦‚ NPEï¼ŒILLARGï¼Œéƒ½å±äºç¨‹åºå‘˜åˆ¶é€ çš„ BUGã€‚</li>
<li>ä¸“æœ‰å¼‚å¸¸ï¼Œå¤šç”¨äºç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼Œç”¨äºæè¿°æŒ‡å®šä½œä¸šå‡ºç°æ„å¤–æƒ…å†µæ— æ³•é¢„å…ˆå¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-æ³›å‹"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-æ³›å‹">#</a> æ·±å…¥ç†è§£ Java æ³›å‹</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%B3%9B%E5%9E%8B">1. ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹</a></li>
<li>\2. æ³›å‹ç±»å‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#21-%E6%B3%9B%E5%9E%8B%E7%B1%BB">2.1. æ³›å‹ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#22-%E6%B3%9B%E5%9E%8B%E6%8E%A5%E5%8F%A3">2.2. æ³›å‹æ¥å£</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#3-%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95">3. æ³›å‹æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#4-%E7%B1%BB%E5%9E%8B%E6%93%A6%E9%99%A4">4. ç±»å‹æ“¦é™¤</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#5-%E6%B3%9B%E5%9E%8B%E5%92%8C%E7%BB%A7%E6%89%BF">5. æ³›å‹å’Œç»§æ‰¿</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#6-%E7%B1%BB%E5%9E%8B%E8%BE%B9%E7%95%8C">6. ç±»å‹è¾¹ç•Œ</a></li>
<li>\7. ç±»å‹é€šé…ç¬¦
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#71-%E4%B8%8A%E7%95%8C%E9%80%9A%E9%85%8D%E7%AC%A6">7.1. ä¸Šç•Œé€šé…ç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#72-%E4%B8%8B%E7%95%8C%E9%80%9A%E9%85%8D%E7%AC%A6">7.2. ä¸‹ç•Œé€šé…ç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#73-%E6%97%A0%E7%95%8C%E9%80%9A%E9%85%8D%E7%AC%A6">7.3. æ— ç•Œé€šé…ç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#74-%E9%80%9A%E9%85%8D%E7%AC%A6%E5%92%8C%E5%90%91%E4%B8%8A%E8%BD%AC%E5%9E%8B">7.4. é€šé…ç¬¦å’Œå‘ä¸Šè½¬å‹</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#8-%E6%B3%9B%E5%9E%8B%E7%9A%84%E7%BA%A6%E6%9D%9F">8. æ³›å‹çš„çº¦æŸ</a></li>
<li>\9. æ³›å‹æœ€ä½³å®è·µ
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#91-%E6%B3%9B%E5%9E%8B%E5%91%BD%E5%90%8D">9.1. æ³›å‹å‘½å</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#92-%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B%E7%9A%84%E5%BB%BA%E8%AE%AE">9.2. ä½¿ç”¨æ³›å‹çš„å»ºè®®</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#10-%E5%B0%8F%E7%BB%93">10. å°ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#11-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">11. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-137"><a class="markdownIt-Anchor" href="#-137">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%B3%9B%E5%9E%8B">#</a>1. ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹</h2>
<p><strong>JDK5 å¼•å…¥äº†æ³›å‹æœºåˆ¶</strong>ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹å‘¢ï¼Ÿå›ç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œå…ˆè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NoGenericsDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj1 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj2 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> obj3 <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj1 = ["</span> <span class="token operator">+</span> obj1 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj2 = ["</span> <span class="token operator">+</span> obj2 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"obj3 = ["</span> <span class="token operator">+</span> obj3 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> num3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"num1 = ["</span> <span class="token operator">+</span> num1 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"num2 = ["</span> <span class="token operator">+</span> num2 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"num3 = ["</span> <span class="token operator">+</span> num3 <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// obj1 = [abc]</span>
<span class="token comment">// obj2 = [18]</span>
<span class="token comment">// obj3 = [[D@47089e5f]</span>
<span class="token comment">// Exception in thread "main" java.lang.ClassCastException: java.lang.String cannot be cast to java.lang.Integer</span>
<span class="token comment">// at io.github.dunwu.javacore.generics.NoGenericsDemo.main(NoGenericsDemo.java:23)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ç¤ºä¾‹è¯´æ˜ï¼š</p>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ <code>List</code>  å®¹å™¨æ²¡æœ‰æŒ‡å®šå­˜å‚¨æ•°æ®ç±»å‹ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å‘  <code>List</code>  æ·»åŠ ä»»æ„ç±»å‹æ•°æ®ï¼Œç¼–è¯‘å™¨ä¸ä¼šåšç±»å‹æ£€æŸ¥ï¼Œè€Œæ˜¯é»˜é»˜çš„å°†æ‰€æœ‰æ•°æ®éƒ½è½¬ä¸º  <code>Object</code> ã€‚</p>
<p>å‡è®¾ï¼Œæœ€åˆæˆ‘ä»¬å¸Œæœ›å‘  <code>List</code>  å­˜å‚¨çš„æ˜¯æ•´å½¢æ•°æ®ï¼Œå‡è®¾ï¼ŒæŸä¸ªå®¶ä¼™ä¸å°å¿ƒå­˜å…¥äº†å…¶ä»–æ•°æ®ç±»å‹ã€‚å½“ä½ è¯•å›¾ä»å®¹å™¨ä¸­å–æ•´å½¢æ•°æ®æ—¶ï¼Œç”±äº  <code>List</code>  å½“æˆ  <code>Object</code>  ç±»å‹æ¥å­˜å‚¨ï¼Œä½ ä¸å¾—ä¸ä½¿ç”¨ç±»å‹å¼ºåˆ¶è½¬æ¢ã€‚åœ¨è¿è¡Œæ—¶ï¼Œæ‰ä¼šå‘ç°  <code>List</code>  ä¸­æ•°æ®ä¸å­˜å‚¨ä¸€è‡´çš„é—®é¢˜ï¼Œè¿™å°±ä¸ºç¨‹åºè¿è¡Œå¸¦æ¥äº†å¾ˆå¤§çš„é£é™©ï¼ˆæ— å½¢ä¼¤å®³æœ€ä¸ºè‡´å‘½ï¼‰ã€‚</p>
</blockquote>
<p>è€Œæ³›å‹çš„å‡ºç°ï¼Œè§£å†³äº†ç±»å‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>æ³›å‹å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>ç¼–è¯‘æ—¶çš„å¼ºç±»å‹æ£€æŸ¥</strong></li>
</ul>
<p>æ³›å‹è¦æ±‚åœ¨å£°æ˜æ—¶æŒ‡å®šå®é™…æ•°æ®ç±»å‹ï¼ŒJava ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šå¯¹æ³›å‹ä»£ç åšå¼ºç±»å‹æ£€æŸ¥ï¼Œå¹¶åœ¨ä»£ç è¿åç±»å‹å®‰å…¨æ—¶å‘å‡ºå‘Šè­¦ã€‚æ—©å‘ç°ï¼Œæ—©æ²»ç†ï¼ŒæŠŠéšæ‚£æ‰¼æ€äºæ‘‡ç¯®ï¼Œåœ¨ç¼–è¯‘æ—¶å‘ç°å¹¶ä¿®å¤é”™è¯¯æ‰€ä»˜å‡ºçš„ä»£ä»·è¿œæ¯”åœ¨è¿è¡Œæ—¶å°ã€‚</p>
<ul>
<li><strong>é¿å…äº†ç±»å‹è½¬æ¢</strong></li>
</ul>
<p>æœªä½¿ç”¨æ³›å‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨æ³›å‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> s <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// no cast</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>æ³›å‹ç¼–ç¨‹å¯ä»¥å®ç°é€šç”¨ç®—æ³•</strong></li>
</ul>
<p>é€šè¿‡ä½¿ç”¨æ³›å‹ï¼Œç¨‹åºå‘˜å¯ä»¥å®ç°é€šç”¨ç®—æ³•ï¼Œè¿™äº›ç®—æ³•å¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„é›†åˆï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œå¹¶ä¸”ç±»å‹å®‰å…¨ä¸”æ˜“äºé˜…è¯»ã€‚</p>
<h2 id="-138"><a class="markdownIt-Anchor" href="#-138">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_2-%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B">#</a>2. æ³›å‹ç±»å‹</h2>
<p><strong> <code>æ³›å‹ç±»å‹</code> æ˜¯è¢«å‚æ•°åŒ–çš„ç±»æˆ–æ¥å£ã€‚</strong></p>
<h3 id="-139"><a class="markdownIt-Anchor" href="#-139">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_2-1-%E6%B3%9B%E5%9E%8B%E7%B1%BB">#</a>2.1. æ³›å‹ç±»</h3>
<p>æ³›å‹ç±»çš„è¯­æ³•å½¢å¼ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> name<span class="token generics"><span class="token punctuation">&lt;</span>T1<span class="token punctuation">,</span> T2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token class-name">Tn</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ³›å‹ç±»çš„å£°æ˜å’Œéæ³›å‹ç±»çš„å£°æ˜ç±»ä¼¼ï¼Œé™¤äº†åœ¨ç±»ååé¢æ·»åŠ äº†ç±»å‹å‚æ•°å£°æ˜éƒ¨åˆ†ã€‚ç”±å°–æ‹¬å·ï¼ˆ <code>&lt;&gt;</code> ï¼‰åˆ†éš”çš„ç±»å‹å‚æ•°éƒ¨åˆ†è·Ÿåœ¨ç±»ååé¢ã€‚å®ƒæŒ‡å®šç±»å‹å‚æ•°ï¼ˆä¹Ÿç§°ä¸ºç±»å‹å˜é‡ï¼‰T1ï¼ŒT2ï¼Œâ€¦ å’Œ Tnã€‚</p>
<p>ä¸€èˆ¬å°†æ³›å‹ä¸­çš„ç±»åç§°ä¸º<strong>åŸå‹</strong>ï¼Œè€Œå°†  <code>&lt;&gt;</code>  æŒ‡å®šçš„å‚æ•°ç§°ä¸º<strong>ç±»å‹å‚æ•°</strong>ã€‚</p>
<ul>
<li>æœªåº”ç”¨æ³›å‹çš„ç±»</li>
</ul>
<p>åœ¨æ³›å‹å‡ºç°ä¹‹å‰ï¼Œå¦‚æœä¸€ä¸ªç±»æƒ³æŒæœ‰ä¸€ä¸ªå¯ä»¥ä¸ºä»»æ„ç±»å‹çš„æ•°æ®ï¼Œåªèƒ½ä½¿ç”¨  <code>Object</code>  åšç±»å‹è½¬æ¢ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Info</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token class-name">Object</span> value<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> value<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>å•ç±»å‹å‚æ•°çš„æ³›å‹ç±»</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Info</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> value<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"Info&#123;"</span> <span class="token operator">+</span> <span class="token string">"value="</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsClassDemo01</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Info</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Info</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> info2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info2<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"xyz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info2<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// 10</span>
<span class="token comment">// xyz</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåœ¨åˆå§‹åŒ–ä¸€ä¸ªæ³›å‹ç±»æ—¶ï¼Œä½¿ç”¨  <code>&lt;&gt;</code>  æŒ‡å®šäº†å†…éƒ¨å…·ä½“ç±»å‹ï¼Œåœ¨ç¼–è¯‘æ—¶å°±ä¼šæ ¹æ®è¿™ä¸ªç±»å‹åšå¼ºç±»å‹æ£€æŸ¥ã€‚</p>
<p>å®é™…ä¸Šï¼Œä¸ä½¿ç”¨  <code>&lt;&gt;</code>  æŒ‡å®šå†…éƒ¨å…·ä½“ç±»å‹ï¼Œè¯­æ³•ä¸Šä¹Ÿæ˜¯æ”¯æŒçš„ï¼ˆä¸æ¨èè¿™ä¹ˆåšï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Info</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ç¤ºä¾‹è¯´æ˜ï¼š</p>
<p>ä¸Šé¢çš„ä¾‹å­ï¼Œä¸ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œä¹Ÿèƒ½æ­£å¸¸è¿è¡Œã€‚ä½†è¿™æ ·çš„è°ƒç”¨å°±å¤±å»æ³›å‹ç±»å‹çš„ä¼˜åŠ¿ã€‚</p>
</blockquote>
<ul>
<li>å¤šä¸ªç±»å‹å‚æ•°çš„æ³›å‹ç±»</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">V</span> value<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyMap</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token string">"MyMap&#123;"</span> <span class="token operator">+</span> <span class="token string">"key="</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">", value="</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsClassDemo02</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MyMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"one"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// MyMap&#123;key=1, value=one&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>æ³›å‹ç±»çš„ç±»å‹åµŒå¥—</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsClassDemo03</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Info</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Info</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// MyMap&#123;key=1, value=Info&#123;value=Hello&#125;&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-140"><a class="markdownIt-Anchor" href="#-140">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_2-2-%E6%B3%9B%E5%9E%8B%E6%8E%A5%E5%8F%A3">#</a>2.2. æ³›å‹æ¥å£</h3>
<p>æ¥å£ä¹Ÿå¯ä»¥å£°æ˜æ³›å‹ã€‚</p>
<p>æ³›å‹æ¥å£è¯­æ³•å½¢å¼ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Content</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">T</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æ³›å‹æ¥å£æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<ul>
<li>å®ç°æ¥å£çš„å­ç±»æ˜ç¡®å£°æ˜æ³›å‹ç±»å‹</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsInterfaceDemo01</span> <span class="token keyword">implements</span> <span class="token class-name">Content</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> text<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">GenericsInterfaceDemo01</span><span class="token punctuation">(</span><span class="token keyword">int</span> text<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> text<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GenericsInterfaceDemo01</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericsInterfaceDemo01</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// 10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>å®ç°æ¥å£çš„å­ç±»ä¸æ˜ç¡®å£°æ˜æ³›å‹ç±»å‹</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsInterfaceDemo02</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Content</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> text<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">GenericsInterfaceDemo02</span><span class="token punctuation">(</span><span class="token class-name">T</span> text<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>text <span class="token operator">=</span> text<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> text<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">GenericsInterfaceDemo02</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> gen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericsInterfaceDemo02</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token string">"ABC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>gen<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// ABC</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-141"><a class="markdownIt-Anchor" href="#-141">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_3-%E6%B3%9B%E5%9E%8B%E6%96%B9%E6%B3%95">#</a>3. æ³›å‹æ–¹æ³•</h2>
<p>æ³›å‹æ–¹æ³•æ˜¯å¼•å…¥å…¶è‡ªå·±çš„ç±»å‹å‚æ•°çš„æ–¹æ³•ã€‚æ³›å‹æ–¹æ³•å¯ä»¥æ˜¯æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•ä»¥åŠæ„é€ æ–¹æ³•ã€‚</p>
<p>æ³›å‹æ–¹æ³•è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>æ˜¯å¦æ‹¥æœ‰æ³›å‹æ–¹æ³•ï¼Œä¸å…¶æ‰€åœ¨çš„ç±»æ˜¯å¦æ˜¯æ³›å‹æ²¡æœ‰å…³ç³»ã€‚</strong></p>
<p>æ³›å‹æ–¹æ³•çš„è¯­æ³•åŒ…æ‹¬ä¸€ä¸ªç±»å‹å‚æ•°åˆ—è¡¨ï¼Œåœ¨å°–æ‹¬å·å†…ï¼Œå®ƒå‡ºç°åœ¨æ–¹æ³•çš„è¿”å›ç±»å‹ä¹‹å‰ã€‚å¯¹äºé™æ€æ³›å‹æ–¹æ³•ï¼Œç±»å‹å‚æ•°éƒ¨åˆ†å¿…é¡»å‡ºç°åœ¨æ–¹æ³•çš„è¿”å›ç±»å‹ä¹‹å‰ã€‚ç±»å‹å‚æ•°èƒ½è¢«ç”¨æ¥å£°æ˜è¿”å›å€¼ç±»å‹ï¼Œå¹¶ä¸”èƒ½ä½œä¸ºæ³›å‹æ–¹æ³•å¾—åˆ°çš„å®é™…ç±»å‹å‚æ•°çš„å ä½ç¬¦ã€‚</p>
<p><strong>ä½¿ç”¨æ³›å‹æ–¹æ³•çš„æ—¶å€™ï¼Œé€šå¸¸ä¸å¿…æŒ‡æ˜ç±»å‹å‚æ•°ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æ‰¾å‡ºå…·ä½“çš„ç±»å‹ã€‚è¿™ç§°ä¸ºç±»å‹å‚æ•°æ¨æ–­ï¼ˆtype argument inferenceï¼‰ã€‚ç±»å‹æ¨æ–­åªå¯¹èµ‹å€¼æ“ä½œæœ‰æ•ˆï¼Œå…¶ä»–æ—¶å€™å¹¶ä¸èµ·ä½œç”¨</strong>ã€‚å¦‚æœå°†ä¸€ä¸ªè¿”å›ç±»å‹ä¸º T çš„æ³›å‹æ–¹æ³•è°ƒç”¨çš„ç»“æœä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™å¦ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™æ—¶ç¼–è¯‘å™¨å¹¶ä¸ä¼šæ‰§è¡Œæ¨æ–­ã€‚ç¼–è¯‘å™¨ä¼šè®¤ä¸ºï¼šè°ƒç”¨æ³›å‹æ–¹æ³•åï¼Œå…¶è¿”å›å€¼è¢«èµ‹ç»™ä¸€ä¸ª Object ç±»å‹çš„å˜é‡ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsMethodDemo01</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">printClass</span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printClass</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printClass</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// class java.lang.String</span>
<span class="token comment">// class java.lang.Integer</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³›å‹æ–¹æ³•ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å¯å˜å‚æ•°åˆ—è¡¨</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericVarargsMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">makeList</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> ls <span class="token operator">=</span> <span class="token function">makeList</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ls<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ls <span class="token operator">=</span> <span class="token function">makeList</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ls<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// [A]</span>
<span class="token comment">// [A, B, C]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-142"><a class="markdownIt-Anchor" href="#-142">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_4-%E7%B1%BB%E5%9E%8B%E6%93%A6%E9%99%A4">#</a>4. ç±»å‹æ“¦é™¤</h2>
<p>Java è¯­è¨€å¼•å…¥æ³›å‹æ˜¯ä¸ºäº†åœ¨ç¼–è¯‘æ—¶æä¾›æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œå¹¶æ”¯æŒæ³›å‹ç¼–ç¨‹ã€‚ä¸åŒäº C++ çš„æ¨¡æ¿æœºåˆ¶ï¼Œ<strong>Java æ³›å‹æ˜¯ä½¿ç”¨ç±»å‹æ“¦é™¤æ¥å®ç°çš„ï¼Œä½¿ç”¨æ³›å‹æ—¶ï¼Œä»»ä½•å…·ä½“çš„ç±»å‹ä¿¡æ¯éƒ½è¢«æ“¦é™¤äº†</strong>ã€‚</p>
<p>é‚£ä¹ˆï¼Œç±»å‹æ“¦é™¤åšäº†ä»€ä¹ˆå‘¢ï¼Ÿå®ƒåšäº†ä»¥ä¸‹å·¥ä½œï¼š</p>
<ul>
<li>æŠŠæ³›å‹ä¸­çš„æ‰€æœ‰ç±»å‹å‚æ•°æ›¿æ¢ä¸º Objectï¼Œå¦‚æœæŒ‡å®šç±»å‹è¾¹ç•Œï¼Œåˆ™ä½¿ç”¨ç±»å‹è¾¹ç•Œæ¥æ›¿æ¢ã€‚å› æ­¤ï¼Œç”Ÿæˆçš„å­—èŠ‚ç ä»…åŒ…å«æ™®é€šçš„ç±»ï¼Œæ¥å£å’Œæ–¹æ³•ã€‚</li>
<li>æ“¦é™¤å‡ºç°çš„ç±»å‹å£°æ˜ï¼Œå³å»æ‰  <code>&lt;&gt;</code>  çš„å†…å®¹ã€‚æ¯”å¦‚  <code>T get()</code>  æ–¹æ³•å£°æ˜å°±å˜æˆäº†  <code>Object get()</code>  ï¼› <code>List&lt;String&gt;</code>  å°±å˜æˆäº†  <code>List</code> ã€‚å¦‚æœ‰å¿…è¦ï¼Œæ’å…¥ç±»å‹è½¬æ¢ä»¥ä¿æŒç±»å‹å®‰å…¨ã€‚</li>
<li>ç”Ÿæˆæ¡¥æ¥æ–¹æ³•ä»¥ä¿ç•™æ‰©å±•æ³›å‹ç±»å‹ä¸­çš„å¤šæ€æ€§ã€‚ç±»å‹æ“¦é™¤ç¡®ä¿ä¸ä¸ºå‚æ•°åŒ–ç±»å‹åˆ›å»ºæ–°ç±»ï¼›å› æ­¤ï¼Œæ³›å‹ä¸ä¼šäº§ç”Ÿè¿è¡Œæ—¶å¼€é”€ã€‚</li>
</ul>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsErasureTypeDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> list1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list2<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// class java.util.ArrayList</span>
<span class="token comment">// class java.util.ArrayList</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ç¤ºä¾‹è¯´æ˜ï¼š</p>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè™½ç„¶æŒ‡å®šäº†ä¸åŒçš„ç±»å‹å‚æ•°ï¼Œä½†æ˜¯ list1 å’Œ list2 çš„ç±»ä¿¡æ¯å´æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼š<strong>ä½¿ç”¨æ³›å‹æ—¶ï¼Œä»»ä½•å…·ä½“çš„ç±»å‹ä¿¡æ¯éƒ½è¢«æ“¦é™¤äº†</strong>ã€‚è¿™æ„å‘³ç€ï¼š <code>ArrayList&lt;Object&gt;</code>  å’Œ  <code>ArrayList&lt;String&gt;</code>  åœ¨è¿è¡Œæ—¶ï¼ŒJVM å°†å®ƒä»¬è§†ä¸ºåŒä¸€ç±»å‹ã€‚</p>
</blockquote>
<p>Java æ³›å‹çš„å®ç°æ–¹å¼ä¸å¤ªä¼˜é›…ï¼Œä½†è¿™æ˜¯å› ä¸ºæ³›å‹æ˜¯åœ¨ JDK5 æ—¶å¼•å…¥çš„ï¼Œä¸ºäº†å…¼å®¹è€ä»£ç ï¼Œå¿…é¡»åœ¨è®¾è®¡ä¸Šåšä¸€å®šçš„æŠ˜ä¸­ã€‚</p>
<h2 id="-143"><a class="markdownIt-Anchor" href="#-143">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_5-%E6%B3%9B%E5%9E%8B%E5%92%8C%E7%BB%A7%E6%89%BF">#</a>5. æ³›å‹å’Œç»§æ‰¿</h2>
<p><strong>æ³›å‹ä¸èƒ½ç”¨äºæ˜¾å¼åœ°å¼•ç”¨è¿è¡Œæ—¶ç±»å‹çš„æ“ä½œä¹‹ä¸­ï¼Œä¾‹å¦‚ï¼šè½¬å‹ã€instanceof æ“ä½œå’Œ new è¡¨è¾¾å¼ã€‚å› ä¸ºæ‰€æœ‰å…³äºå‚æ•°çš„ç±»å‹ä¿¡æ¯éƒ½ä¸¢å¤±äº†</strong>ã€‚å½“ä½ åœ¨ç¼–å†™æ³›å‹ä»£ç æ—¶ï¼Œå¿…é¡»æ—¶åˆ»æé†’è‡ªå·±ï¼Œä½ åªæ˜¯çœ‹èµ·æ¥å¥½åƒæ‹¥æœ‰æœ‰å…³å‚æ•°çš„ç±»å‹ä¿¡æ¯è€Œå·²ã€‚</p>
<p>æ­£æ˜¯ç”±äºæ³›å‹æ—¶åŸºäºç±»å‹æ“¦é™¤å®ç°çš„ï¼Œæ‰€ä»¥ï¼Œ<strong>æ³›å‹ç±»å‹æ— æ³•å‘ä¸Šè½¬å‹</strong>ã€‚</p>
<blockquote>
<p>å‘ä¸Šè½¬å‹æ˜¯æŒ‡ç”¨å­ç±»å®ä¾‹å»åˆå§‹åŒ–çˆ¶ç±»ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡ä¸­å¤šæ€çš„é‡è¦è¡¨ç°ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553147778883.png" alt="img"></p>
<p><code>Integer</code>  ç»§æ‰¿äº†  <code>Object</code> ï¼› <code>ArrayList</code>  ç»§æ‰¿äº†  <code>List</code> ï¼›ä½†æ˜¯  <code>List&lt;Interger&gt;</code>  å´å¹¶éç»§æ‰¿äº†  <code>List&lt;Object&gt;</code> ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œæ³›å‹ç±»å¹¶æ²¡æœ‰è‡ªå·±ç‹¬æœ‰çš„  <code>Class</code>  ç±»å¯¹è±¡ã€‚æ¯”å¦‚ï¼šå¹¶ä¸å­˜åœ¨  <code>List&lt;Object&gt;.class</code>  æˆ–æ˜¯  <code>List&lt;Interger&gt;.class</code> ï¼ŒJava ç¼–è¯‘å™¨ä¼šå°†äºŒè€…éƒ½è§†ä¸º  <code>List.class</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> list2 <span class="token operator">=</span> list<span class="token punctuation">;</span> <span class="token comment">// Erorr</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-144"><a class="markdownIt-Anchor" href="#-144">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_6-%E7%B1%BB%E5%9E%8B%E8%BE%B9%E7%95%8C">#</a>6. ç±»å‹è¾¹ç•Œ</h2>
<p>æœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›é™åˆ¶å¯åœ¨å‚æ•°åŒ–ç±»å‹ä¸­ç”¨ä½œç±»å‹å‚æ•°çš„ç±»å‹ã€‚<strong> <code>ç±»å‹è¾¹ç•Œ</code> å¯ä»¥å¯¹æ³›å‹çš„ç±»å‹å‚æ•°è®¾ç½®é™åˆ¶æ¡ä»¶</strong>ã€‚ä¾‹å¦‚ï¼Œå¯¹æ•°å­—è¿›è¡Œæ“ä½œçš„æ–¹æ³•å¯èƒ½åªæƒ³æ¥å—  <code>Number</code>  æˆ–å…¶å­ç±»çš„å®ä¾‹ã€‚</p>
<p>è¦å£°æ˜æœ‰ç•Œç±»å‹å‚æ•°ï¼Œè¯·åˆ—å‡ºç±»å‹å‚æ•°çš„åç§°ï¼Œç„¶åæ˜¯  <code>extends</code>  å…³é”®å­—ï¼Œåè·Ÿå…¶é™åˆ¶ç±»æˆ–æ¥å£ã€‚</p>
<p>ç±»å‹è¾¹ç•Œçš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">&lt;T extends XXX><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsExtendsDemo01</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token class-name">T</span> x<span class="token punctuation">,</span> <span class="token class-name">T</span> y<span class="token punctuation">,</span> <span class="token class-name">T</span> z<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">T</span> max <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token comment">// å‡è®¾xæ˜¯åˆå§‹æœ€å¤§å€¼</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            max <span class="token operator">=</span> y<span class="token punctuation">;</span> <span class="token comment">//y æ›´å¤§</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>z<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            max <span class="token operator">=</span> z<span class="token punctuation">;</span> <span class="token comment">// ç°åœ¨ z æ›´å¤§</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> max<span class="token punctuation">;</span> <span class="token comment">// è¿”å›æœ€å¤§å¯¹è±¡</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">6.6</span><span class="token punctuation">,</span> <span class="token number">8.8</span><span class="token punctuation">,</span> <span class="token number">7.7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token string">"pear"</span><span class="token punctuation">,</span> <span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// 5</span>
<span class="token comment">// 8.8</span>
<span class="token comment">// pear</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ç¤ºä¾‹è¯´æ˜ï¼š</p>
<p>ä¸Šé¢çš„ç¤ºä¾‹å£°æ˜äº†ä¸€ä¸ªæ³›å‹æ–¹æ³•ï¼Œç±»å‹å‚æ•°  <code>T extends Comparable&lt;T&gt;</code>  è¡¨æ˜ä¼ å…¥æ–¹æ³•ä¸­çš„ç±»å‹å¿…é¡»å®ç°äº† Comparable æ¥å£ã€‚</p>
</blockquote>
<p>ç±»å‹è¾¹ç•Œå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œè¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">&lt;T extends B1 &amp; B2 &amp; B3><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šextends å…³é”®å­—åé¢çš„ç¬¬ä¸€ä¸ªç±»å‹å‚æ•°å¯ä»¥æ˜¯ç±»æˆ–æ¥å£ï¼Œå…¶ä»–ç±»å‹å‚æ•°åªèƒ½æ˜¯æ¥å£ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsExtendsDemo02</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">interface</span> <span class="token class-name">B</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">interface</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> D1 <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token operator">&amp;</span> <span class="token class-name">B</span> <span class="token operator">&amp;</span> <span class="token class-name">C</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> D2 <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">B</span> <span class="token operator">&amp;</span> <span class="token class-name">A</span> <span class="token operator">&amp;</span> <span class="token class-name">C</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span> <span class="token comment">// ç¼–è¯‘æŠ¥é”™</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token keyword">implements</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        D1<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> demo1 <span class="token operator">=</span> <span class="token keyword">new</span> D1<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>demo1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        D1<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> demo2 <span class="token operator">=</span> <span class="token keyword">new</span> D1<span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç¼–è¯‘æŠ¥é”™</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-145"><a class="markdownIt-Anchor" href="#-145">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_7-%E7%B1%BB%E5%9E%8B%E9%80%9A%E9%85%8D%E7%AC%A6">#</a>7. ç±»å‹é€šé…ç¬¦</h2>
<p><code>ç±»å‹é€šé…ç¬¦</code> ä¸€èˆ¬æ˜¯ä½¿ç”¨  <code>?</code>  ä»£æ›¿å…·ä½“çš„ç±»å‹å‚æ•°ã€‚ä¾‹å¦‚  <code>List&lt;?&gt;</code>  åœ¨é€»è¾‘ä¸Šæ˜¯  <code>List&lt;String&gt;</code>  ï¼Œ <code>List&lt;Integer&gt;</code>  ç­‰æ‰€æœ‰  <code>List&lt;å…·ä½“ç±»å‹å®å‚&gt;</code>  çš„çˆ¶ç±»ã€‚</p>
<h3 id="-146"><a class="markdownIt-Anchor" href="#-146">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_7-1-%E4%B8%8A%E7%95%8C%E9%80%9A%E9%85%8D%E7%AC%A6">#</a>7.1. ä¸Šç•Œé€šé…ç¬¦</h3>
<p>å¯ä»¥ä½¿ç”¨ ** <code>ä¸Šç•Œé€šé…ç¬¦</code>  ** æ¥ç¼©å°ç±»å‹å‚æ•°çš„ç±»å‹èŒƒå›´ã€‚</p>
<p>å®ƒçš„è¯­æ³•å½¢å¼ä¸ºï¼š <code>&lt;? extends Number&gt;</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsUpperBoundedWildcardDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">sumOfList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Number</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">double</span> s <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Number</span> n <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            s <span class="token operator">+=</span> n<span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> li <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sum = "</span> <span class="token operator">+</span> <span class="token function">sumOfList</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// sum = 6.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-147"><a class="markdownIt-Anchor" href="#-147">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_7-2-%E4%B8%8B%E7%95%8C%E9%80%9A%E9%85%8D%E7%AC%A6">#</a>7.2. ä¸‹ç•Œé€šé…ç¬¦</h3>
<p>** <code>ä¸‹ç•Œé€šé…ç¬¦</code>  ** å°†æœªçŸ¥ç±»å‹é™åˆ¶ä¸ºè¯¥ç±»å‹çš„ç‰¹å®šç±»å‹æˆ–è¶…ç±»ç±»å‹ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š<strong>ä¸Šç•Œé€šé…ç¬¦å’Œä¸‹ç•Œé€šé…ç¬¦ä¸èƒ½åŒæ—¶ä½¿ç”¨</strong>ã€‚</p>
</blockquote>
<p>å®ƒçš„è¯­æ³•å½¢å¼ä¸ºï¼š <code>&lt;? super Number&gt;</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsLowerBoundedWildcardDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addNumbers</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addNumbers</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">deepToString</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// [1, 2, 3, 4, 5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-148"><a class="markdownIt-Anchor" href="#-148">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_7-3-%E6%97%A0%E7%95%8C%E9%80%9A%E9%85%8D%E7%AC%A6">#</a>7.3. æ— ç•Œé€šé…ç¬¦</h3>
<p>æ— ç•Œé€šé…ç¬¦æœ‰ä¸¤ç§åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨ Object ç±»ä¸­æä¾›çš„åŠŸèƒ½æ¥å®ç°çš„æ–¹æ³•ã€‚</li>
<li>ä½¿ç”¨ä¸ä¾èµ–äºç±»å‹å‚æ•°çš„æ³›å‹ç±»ä¸­çš„æ–¹æ³•ã€‚</li>
</ul>
<p>è¯­æ³•å½¢å¼ï¼š <code>&lt;?&gt;</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsUnboundedWildcardDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> elem <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>elem <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> li <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> ls <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printList</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printList</span><span class="token punctuation">(</span>ls<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// 1 2 3</span>
<span class="token comment">// one two three</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-149"><a class="markdownIt-Anchor" href="#-149">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_7-4-%E9%80%9A%E9%85%8D%E7%AC%A6%E5%92%8C%E5%90%91%E4%B8%8A%E8%BD%AC%E5%9E%8B">#</a>7.4. é€šé…ç¬¦å’Œå‘ä¸Šè½¬å‹</h3>
<p>å‰é¢ï¼Œæˆ‘ä»¬æåˆ°ï¼š<strong>æ³›å‹ä¸èƒ½å‘ä¸Šè½¬å‹ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é€šé…ç¬¦æ¥å‘ä¸Šè½¬å‹</strong>ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenericsWildcardDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> intList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Number</span><span class="token punctuation">></span></span> numList <span class="token operator">=</span> intList<span class="token punctuation">;</span>  <span class="token comment">// Error</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> intList2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Number</span><span class="token punctuation">></span></span> numList2 <span class="token operator">=</span> intList2<span class="token punctuation">;</span>  <span class="token comment">// OK</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>æ‰©å±•é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/index.html">Oracle æ³›å‹æ–‡æ¡£ (opens new window)</a></p>
</blockquote>
<h2 id="-150"><a class="markdownIt-Anchor" href="#-150">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_8-%E6%B3%9B%E5%9E%8B%E7%9A%84%E7%BA%A6%E6%9D%9F">#</a>8. æ³›å‹çš„çº¦æŸ</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#instantiate">æ³›å‹ç±»å‹çš„ç±»å‹å‚æ•°ä¸èƒ½æ˜¯å€¼ç±»å‹ (opens new window)</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç¼–è¯‘é”™è¯¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#createObjects">ä¸èƒ½åˆ›å»ºç±»å‹å‚æ•°çš„å®ä¾‹ (opens new window)</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">E</span> elem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç¼–è¯‘é”™è¯¯</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#createStatic">ä¸èƒ½å£°æ˜ç±»å‹ä¸ºç±»å‹å‚æ•°çš„é™æ€æˆå‘˜ (opens new window)</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MobileDevice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">T</span> os<span class="token punctuation">;</span> <span class="token comment">// error</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#cannotCast">ç±»å‹å‚æ•°ä¸èƒ½ä½¿ç”¨ç±»å‹è½¬æ¢æˆ–  <code>instanceof</code> (opens new window)</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">rtti</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token keyword">instanceof</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼–è¯‘é”™è¯¯</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> li <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Number</span><span class="token punctuation">></span></span>  ln <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Number</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> li<span class="token punctuation">;</span>  <span class="token comment">// ç¼–è¯‘é”™è¯¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#createArrays">ä¸èƒ½åˆ›å»ºç±»å‹å‚æ•°çš„æ•°ç»„ (opens new window)</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> arrayOfLists <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// ç¼–è¯‘é”™è¯¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#cannotCatch">ä¸èƒ½åˆ›å»ºã€catch æˆ– throw å‚æ•°åŒ–ç±»å‹å¯¹è±¡ (opens new window)</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Extends Throwable indirectly</span>
<span class="token keyword">class</span> <span class="token class-name">MathException</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token punctuation">&#125;</span>    <span class="token comment">// ç¼–è¯‘é”™è¯¯</span>

<span class="token comment">// Extends Throwable directly</span>
<span class="token keyword">class</span> <span class="token class-name">QueueFullException</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* ... */</span> <span class="token comment">// ç¼–è¯‘é”™è¯¯</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span><span class="token punctuation">,</span> <span class="token class-name">J</span><span class="token punctuation">></span></span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">J</span><span class="token punctuation">></span></span> jobs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">J</span> job <span class="token operator">:</span> jobs<span class="token punctuation">)</span>
            <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">T</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// compile-time error</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/tutorial/java/generics/restrictions.html#cannotOverload">ä»…ä»…æ˜¯æ³›å‹ç±»ç›¸åŒï¼Œè€Œç±»å‹å‚æ•°ä¸åŒçš„æ–¹æ³•ä¸èƒ½é‡è½½ (opens new window)</a></li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> strSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> intSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// ç¼–è¯‘é”™è¯¯</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-151"><a class="markdownIt-Anchor" href="#-151">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_9-%E6%B3%9B%E5%9E%8B%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">#</a>9. æ³›å‹æœ€ä½³å®è·µ</h2>
<h3 id="-152"><a class="markdownIt-Anchor" href="#-152">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_9-1-%E6%B3%9B%E5%9E%8B%E5%91%BD%E5%90%8D">#</a>9.1. æ³›å‹å‘½å</h3>
<p>æ³›å‹ä¸€äº›çº¦å®šä¿—æˆçš„å‘½åï¼š</p>
<ul>
<li>E - Element</li>
<li>K - Key</li>
<li>N - Number</li>
<li>T - Type</li>
<li>V - Value</li>
<li>S,U,V etc. - 2nd, 3rd, 4th types</li>
</ul>
<h3 id="-153"><a class="markdownIt-Anchor" href="#-153">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_9-2-%E4%BD%BF%E7%94%A8%E6%B3%9B%E5%9E%8B%E7%9A%84%E5%BB%BA%E8%AE%AE">#</a>9.2. ä½¿ç”¨æ³›å‹çš„å»ºè®®</h3>
<ul>
<li>æ¶ˆé™¤ç±»å‹æ£€æŸ¥å‘Šè­¦</li>
<li>List ä¼˜å…ˆäºæ•°ç»„</li>
<li>ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨æ³›å‹æ¥æé«˜ä»£ç é€šç”¨æ€§</li>
<li>ä¼˜å…ˆè€ƒè™‘æ³›å‹æ–¹æ³•æ¥é™å®šæ³›å‹çš„èŒƒå›´</li>
<li>åˆ©ç”¨æœ‰é™åˆ¶é€šé…ç¬¦æ¥æå‡ API çš„çµæ´»æ€§</li>
<li>ä¼˜å…ˆè€ƒè™‘ç±»å‹å®‰å…¨çš„å¼‚æ„å®¹å™¨</li>
</ul>
<h2 id="-154"><a class="markdownIt-Anchor" href="#-154">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-generic.html#_10-%E5%B0%8F%E7%BB%93">#</a>10. å°ç»“</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E6%B3%9B%E5%9E%8B.svg" alt="img"></p>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-åå°„å’ŒåŠ¨æ€ä»£ç†"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-åå°„å’ŒåŠ¨æ€ä»£ç†">#</a> æ·±å…¥ç†è§£ Java åå°„å’ŒåŠ¨æ€ä»£ç†</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. åå°„ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#11-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%B0%84">1.1. ä»€ä¹ˆæ˜¯åå°„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#12-%E5%8F%8D%E5%B0%84%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">1.2. åå°„çš„åº”ç”¨åœºæ™¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#13-%E5%8F%8D%E5%B0%84%E7%9A%84%E7%BC%BA%E7%82%B9">1.3. åå°„çš„ç¼ºç‚¹</a></li>
</ul>
</li>
<li>\2. åå°„æœºåˆ¶
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#21-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B">2.1. ç±»åŠ è½½è¿‡ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#22-class-%E5%AF%B9%E8%B1%A1">2.2. Class å¯¹è±¡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#23-%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8">2.3. æ–¹æ³•çš„åå°„è°ƒç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#24-%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E7%9A%84%E5%BC%80%E9%94%80">2.4. åå°„è°ƒç”¨çš„å¼€é”€</a></li>
</ul>
</li>
<li>\3. ä½¿ç”¨åå°„
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#31-javalangreflect-%E5%8C%85">3.1. java.lang.reflect åŒ…</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#32-%E8%8E%B7%E5%8F%96-class-%E5%AF%B9%E8%B1%A1">3.2. è·å– Class å¯¹è±¡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#33-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E4%B8%BA%E6%9F%90%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B">3.3. åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªç±»çš„å®ä¾‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#34-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B">3.4. åˆ›å»ºå®ä¾‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#35-%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84%E5%AE%9E%E4%BE%8B">3.5. åˆ›å»ºæ•°ç»„å®ä¾‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#36-field">3.6. Field</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#37-method">3.7. Method</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#38-constructor">3.8. Constructor</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#39-%E7%BB%95%E5%BC%80%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6">3.9. ç»•å¼€è®¿é—®é™åˆ¶</a></li>
</ul>
</li>
<li>\4. åŠ¨æ€ä»£ç†
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#41-%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86">4.1. é™æ€ä»£ç†</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#42-jdk-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">4.2. JDK åŠ¨æ€ä»£ç†</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#43-cglib-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">4.3. CGLIB åŠ¨æ€ä»£ç†</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-155"><a class="markdownIt-Anchor" href="#-155">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_1-%E5%8F%8D%E5%B0%84%E7%AE%80%E4%BB%8B">#</a>1. åå°„ç®€ä»‹</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E5%8F%8D%E5%B0%84.svg" alt="img"></p>
<h3 id="-156"><a class="markdownIt-Anchor" href="#-156">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%B0%84">#</a>1.1. ä»€ä¹ˆæ˜¯åå°„</h3>
<p>åå°„ (Reflection) æ˜¯ Java ç¨‹åºå¼€å‘è¯­è¨€çš„ç‰¹å¾ä¹‹ä¸€ï¼Œå®ƒå…è®¸è¿è¡Œä¸­çš„ Java ç¨‹åºè·å–è‡ªèº«çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯ä»¥æ“ä½œç±»æˆ–å¯¹è±¡çš„å†…éƒ¨å±æ€§ã€‚</p>
<p><strong>é€šè¿‡åå°„æœºåˆ¶ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶è®¿é—® Java å¯¹è±¡çš„å±æ€§ï¼Œæ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ç­‰ã€‚</strong></p>
<h3 id="-157"><a class="markdownIt-Anchor" href="#-157">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_1-2-%E5%8F%8D%E5%B0%84%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">#</a>1.2. åå°„çš„åº”ç”¨åœºæ™¯</h3>
<p>åå°„çš„ä¸»è¦åº”ç”¨åœºæ™¯æœ‰ï¼š</p>
<ul>
<li><strong>å¼€å‘é€šç”¨æ¡†æ¶</strong> - åå°„æœ€é‡è¦çš„ç”¨é€”å°±æ˜¯å¼€å‘å„ç§é€šç”¨æ¡†æ¶ã€‚å¾ˆå¤šæ¡†æ¶ï¼ˆæ¯”å¦‚ Springï¼‰éƒ½æ˜¯é…ç½®åŒ–çš„ï¼ˆæ¯”å¦‚é€šè¿‡ XML æ–‡ä»¶é…ç½® JavaBeanã€Filter ç­‰ï¼‰ï¼Œä¸ºäº†ä¿è¯æ¡†æ¶çš„é€šç”¨æ€§ï¼Œå®ƒä»¬å¯èƒ½éœ€è¦æ ¹æ®é…ç½®æ–‡ä»¶åŠ è½½ä¸åŒçš„å¯¹è±¡æˆ–ç±»ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™å°±å¿…é¡»ç”¨åˆ°åå°„ â€”â€” è¿è¡Œæ—¶åŠ¨æ€åŠ è½½éœ€è¦åŠ è½½çš„å¯¹è±¡ã€‚</li>
<li><strong>åŠ¨æ€ä»£ç†</strong> - åœ¨åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ä¸­ï¼Œéœ€è¦æ‹¦æˆªç‰¹å®šçš„æ–¹æ³•ï¼Œé€šå¸¸ï¼Œä¼šé€‰æ‹©åŠ¨æ€ä»£ç†æ–¹å¼ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦åå°„æŠ€æœ¯æ¥å®ç°äº†ã€‚</li>
<li><strong>æ³¨è§£</strong> - æ³¨è§£æœ¬èº«ä»…ä»…æ˜¯èµ·åˆ°æ ‡è®°ä½œç”¨ï¼Œå®ƒéœ€è¦åˆ©ç”¨åå°„æœºåˆ¶ï¼Œæ ¹æ®æ³¨è§£æ ‡è®°å»è°ƒç”¨æ³¨è§£è§£é‡Šå™¨ï¼Œæ‰§è¡Œè¡Œä¸ºã€‚å¦‚æœæ²¡æœ‰åå°„æœºåˆ¶ï¼Œæ³¨è§£å¹¶ä¸æ¯”æ³¨é‡Šæ›´æœ‰ç”¨ã€‚</li>
<li><strong>å¯æ‰©å±•æ€§åŠŸèƒ½</strong> - åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ä½¿ç”¨å®Œå…¨é™å®šåç§°åˆ›å»ºå¯æ‰©å±•æ€§å¯¹è±¡å®ä¾‹æ¥ä½¿ç”¨å¤–éƒ¨çš„ç”¨æˆ·å®šä¹‰ç±»ã€‚</li>
</ul>
<h3 id="-158"><a class="markdownIt-Anchor" href="#-158">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_1-3-%E5%8F%8D%E5%B0%84%E7%9A%84%E7%BC%BA%E7%82%B9">#</a>1.3. åå°„çš„ç¼ºç‚¹</h3>
<ul>
<li><strong>æ€§èƒ½å¼€é”€</strong> - ç”±äºåå°„æ¶‰åŠåŠ¨æ€è§£æçš„ç±»å‹ï¼Œå› æ­¤æ— æ³•æ‰§è¡ŒæŸäº› Java è™šæ‹Ÿæœºä¼˜åŒ–ã€‚å› æ­¤ï¼Œåå°„æ“ä½œçš„æ€§èƒ½è¦æ¯”éåå°„æ“ä½œçš„æ€§èƒ½è¦å·®ï¼Œåº”è¯¥åœ¨æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ç¨‹åºä¸­é¢‘ç¹è°ƒç”¨çš„ä»£ç æ®µä¸­é¿å…ã€‚</li>
<li><strong>ç ´åå°è£…æ€§</strong> - åå°„è°ƒç”¨æ–¹æ³•æ—¶å¯ä»¥å¿½ç•¥æƒé™æ£€æŸ¥ï¼Œå› æ­¤å¯èƒ½ä¼šç ´åå°è£…æ€§è€Œå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</li>
<li><strong>å†…éƒ¨æ›å…‰</strong> - ç”±äºåå°„å…è®¸ä»£ç æ‰§è¡Œåœ¨éåå°„ä»£ç ä¸­éæ³•çš„æ“ä½œï¼Œä¾‹å¦‚è®¿é—®ç§æœ‰å­—æ®µå’Œæ–¹æ³•ï¼Œæ‰€ä»¥åå°„çš„ä½¿ç”¨å¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä»£ç åŠŸèƒ½å¤±å¸¸å¹¶å¯èƒ½ç ´åå¯ç§»æ¤æ€§ã€‚åå°„ä»£ç æ‰“ç ´äº†æŠ½è±¡ï¼Œå› æ­¤å¯èƒ½ä¼šéšç€å¹³å°çš„å‡çº§è€Œæ”¹å˜è¡Œä¸ºã€‚</li>
</ul>
<h2 id="-159"><a class="markdownIt-Anchor" href="#-159">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_2-%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6">#</a>2. åå°„æœºåˆ¶</h2>
<h3 id="-160"><a class="markdownIt-Anchor" href="#-160">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_2-1-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B">#</a>2.1. ç±»åŠ è½½è¿‡ç¨‹</h3>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553611895164.png" alt="img"></p>
<p>ç±»åŠ è½½çš„å®Œæ•´è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åœ¨ç¼–è¯‘æ—¶ï¼ŒJava ç¼–è¯‘å™¨ç¼–è¯‘å¥½  <code>.java</code>  æ–‡ä»¶ä¹‹åï¼Œåœ¨ç£ç›˜ä¸­äº§ç”Ÿ  <code>.class</code>  æ–‡ä»¶ã€‚ <code>.class</code>  æ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå†…å®¹æ˜¯åªæœ‰ JVM èƒ½å¤Ÿè¯†åˆ«çš„æœºå™¨ç ã€‚</li>
<li>JVM ä¸­çš„ç±»åŠ è½½å™¨è¯»å–å­—èŠ‚ç æ–‡ä»¶ï¼Œå–å‡ºäºŒè¿›åˆ¶æ•°æ®ï¼ŒåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè§£æ.class æ–‡ä»¶å†…çš„ä¿¡æ¯ã€‚ç±»åŠ è½½å™¨ä¼šæ ¹æ®ç±»çš„å…¨é™å®šåæ¥è·å–æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼›ç„¶åï¼Œå°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼›æ¥ç€ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆä»£è¡¨è¿™ä¸ªç±»çš„  <code>java.lang.Class</code>  å¯¹è±¡ã€‚</li>
<li>åŠ è½½ç»“æŸåï¼ŒJVM å¼€å§‹è¿›è¡Œè¿æ¥é˜¶æ®µï¼ˆåŒ…å«éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–ï¼‰ã€‚ç»è¿‡è¿™ä¸€ç³»åˆ—æ“ä½œï¼Œç±»çš„å˜é‡ä¼šè¢«åˆå§‹åŒ–ã€‚</li>
</ol>
<h3 id="-161"><a class="markdownIt-Anchor" href="#-161">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_2-2-class-%E5%AF%B9%E8%B1%A1">#</a>2.2. Class å¯¹è±¡</h3>
<p>è¦æƒ³ä½¿ç”¨åå°„ï¼Œé¦–å…ˆéœ€è¦è·å¾—å¾…æ“ä½œçš„ç±»æ‰€å¯¹åº”çš„ Class å¯¹è±¡ã€‚<strong>Java ä¸­ï¼Œæ— è®ºç”ŸæˆæŸä¸ªç±»çš„å¤šå°‘ä¸ªå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡éƒ½ä¼šå¯¹åº”äºåŒä¸€ä¸ª Class å¯¹è±¡ã€‚è¿™ä¸ª Class å¯¹è±¡æ˜¯ç”± JVM ç”Ÿæˆçš„ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿè·æ‚‰æ•´ä¸ªç±»çš„ç»“æ„</strong>ã€‚æ‰€ä»¥ï¼Œ <code>java.lang.Class</code>  å¯ä»¥è§†ä¸ºæ‰€æœ‰åå°„ API çš„å…¥å£ç‚¹ã€‚</p>
<p><strong>åå°„çš„æœ¬è´¨å°±æ˜¯ï¼šåœ¨è¿è¡Œæ—¶ï¼ŒæŠŠ Java ç±»ä¸­çš„å„ç§æˆåˆ†æ˜ å°„æˆä¸€ä¸ªä¸ªçš„ Java å¯¹è±¡ã€‚</strong></p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚å®šä¹‰äº†ä»¥ä¸‹ä»£ç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ­¥éª¤è¯´æ˜ï¼š</p>
<ol>
<li>JVM åŠ è½½æ–¹æ³•çš„æ—¶å€™ï¼Œé‡åˆ°  <code>new User()</code> ï¼ŒJVM ä¼šæ ¹æ®  <code>User</code>  çš„å…¨é™å®šåå»åŠ è½½  <code>User.class</code>  ã€‚</li>
<li>JVM ä¼šå»æœ¬åœ°ç£ç›˜æŸ¥æ‰¾  <code>User.class</code>  æ–‡ä»¶å¹¶åŠ è½½ JVM å†…å­˜ä¸­ã€‚</li>
<li>JVM é€šè¿‡è°ƒç”¨ç±»åŠ è½½å™¨è‡ªåŠ¨åˆ›å»ºè¿™ä¸ªç±»å¯¹åº”çš„  <code>Class</code>  å¯¹è±¡ï¼Œå¹¶ä¸”å­˜å‚¨åœ¨ JVM çš„æ–¹æ³•åŒºã€‚æ³¨æ„ï¼š<strong>ä¸€ä¸ªç±»æœ‰ä¸”åªæœ‰ä¸€ä¸ª  <code>Class</code>  å¯¹è±¡</strong>ã€‚</li>
</ol>
<h3 id="-162"><a class="markdownIt-Anchor" href="#-162">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_2-3-%E6%96%B9%E6%B3%95%E7%9A%84%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8">#</a>2.3. æ–¹æ³•çš„åå°„è°ƒç”¨</h3>
<p>æ–¹æ³•çš„åå°„è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯  <code>Method.invoke</code>  æ–¹æ³•ã€‚</p>
<p><code>Method.invoke</code>  æ–¹æ³•æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Method</span> <span class="token keyword">extends</span> <span class="token class-name">Executable</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// æƒé™æ£€æŸ¥</span>
    <span class="token class-name">MethodAccessor</span> ma <span class="token operator">=</span> methodAccessor<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ma <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      ma <span class="token operator">=</span> <span class="token function">acquireMethodAccessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> ma<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Method.invoke</code>  æ–¹æ³•å®é™…ä¸Šå§”æ´¾ç»™  <code>MethodAccessor</code>  æ¥å£æ¥å¤„ç†ã€‚å®ƒæœ‰ä¸¤ä¸ªå·²æœ‰çš„å…·ä½“å®ç°ï¼š</p>
<ul>
<li><code>NativeMethodAccessorImpl</code> ï¼šæœ¬åœ°æ–¹æ³•æ¥å®ç°åå°„è°ƒç”¨</li>
<li><code>DelegatingMethodAccessorImpl</code> ï¼šå§”æ´¾æ¨¡å¼æ¥å®ç°åå°„è°ƒç”¨</li>
</ul>
<p>æ¯ä¸ª  <code>Method</code>  å®ä¾‹çš„ç¬¬ä¸€æ¬¡åå°„è°ƒç”¨éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå§”æ´¾å®ç°ï¼ˆ <code>DelegatingMethodAccessorImpl</code> ï¼‰ï¼Œå®ƒæ‰€å§”æ´¾çš„å…·ä½“å®ç°ä¾¿æ˜¯ä¸€ä¸ªæœ¬åœ°å®ç°ï¼ˆ <code>NativeMethodAccessorImpl</code> ï¼‰ã€‚æœ¬åœ°å®ç°éå¸¸å®¹æ˜“ç†è§£ã€‚å½“è¿›å…¥äº† Java è™šæ‹Ÿæœºå†…éƒ¨ä¹‹åï¼Œæˆ‘ä»¬ä¾¿æ‹¥æœ‰äº†  <code>Method</code>  å®ä¾‹æ‰€æŒ‡å‘æ–¹æ³•çš„å…·ä½“åœ°å€ã€‚è¿™æ—¶å€™ï¼Œåå°„è°ƒç”¨æ— éå°±æ˜¯å°†ä¼ å…¥çš„å‚æ•°å‡†å¤‡å¥½ï¼Œç„¶åè°ƒç”¨è¿›å…¥ç›®æ ‡æ–¹æ³•ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘é€šè¿‡æŠ›å‡ºå¼‚å¸¸æ–¹å¼ æ‰“å°  <code>Method.invoke</code>  è°ƒç”¨è½¨è¿¹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodDemo01</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"#"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"io.github.dunwu.javacore.reflect.MethodDemo01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"target"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// java.lang.Exception: #0</span>
<span class="token comment">//     at io.github.dunwu.javacore.reflect.MethodDemo01.target(MethodDemo01.java:12)</span>
<span class="token comment">//     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span>
<span class="token comment">//     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…ˆè°ƒç”¨  <code>DelegatingMethodAccessorImpl</code> ï¼›ç„¶åè°ƒç”¨  <code>NativeMethodAccessorImpl</code> ï¼Œæœ€åè°ƒç”¨å®é™…æ–¹æ³•ã€‚</p>
<p>ä¸ºä»€ä¹ˆåå°„è°ƒç”¨ <code>DelegatingMethodAccessorImpl</code>  ä½œä¸ºä¸­é—´å±‚ï¼Œè€Œä¸æ˜¯ç›´æ¥äº¤ç»™æœ¬åœ°å®ç°ï¼Ÿ</p>
<p>å…¶å®ï¼ŒJava çš„åå°„è°ƒç”¨æœºåˆ¶è¿˜è®¾ç«‹äº†å¦ä¸€ç§åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç çš„å®ç°ï¼ˆä¸‹ç§°åŠ¨æ€å®ç°ï¼‰ï¼Œç›´æ¥ä½¿ç”¨ invoke æŒ‡ä»¤æ¥è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨å§”æ´¾å®ç°ï¼Œä¾¿æ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨æœ¬åœ°å®ç°ä»¥åŠåŠ¨æ€å®ç°ä¸­åˆ‡æ¢ã€‚åŠ¨æ€å®ç°å’Œæœ¬åœ°å®ç°ç›¸æ¯”ï¼Œå…¶è¿è¡Œæ•ˆç‡è¦å¿«ä¸Š 20 å€ã€‚è¿™æ˜¯å› ä¸ºåŠ¨æ€å®ç°æ— éœ€ç»è¿‡ Java åˆ° C++ å†åˆ° Java çš„åˆ‡æ¢ï¼Œä½†ç”±äºç”Ÿæˆå­—èŠ‚ç ååˆ†è€—æ—¶ï¼Œä»…è°ƒç”¨ä¸€æ¬¡çš„è¯ï¼Œåè€Œæ˜¯æœ¬åœ°å®ç°è¦å¿«ä¸Š 3 åˆ° 4 å€ã€‚</p>
<p>è€ƒè™‘åˆ°è®¸å¤šåå°„è°ƒç”¨ä»…ä¼šæ‰§è¡Œä¸€æ¬¡ï¼ŒJava è™šæ‹Ÿæœºè®¾ç½®äº†ä¸€ä¸ªé˜ˆå€¼ 15ï¼ˆå¯ä»¥é€šè¿‡  <code>-Dsun.reflect.inflationThreshold</code>  æ¥è°ƒæ•´ï¼‰ï¼Œå½“æŸä¸ªåå°„è°ƒç”¨çš„è°ƒç”¨æ¬¡æ•°åœ¨ 15 ä¹‹ä¸‹æ—¶ï¼Œé‡‡ç”¨æœ¬åœ°å®ç°ï¼›å½“è¾¾åˆ° 15 æ—¶ï¼Œä¾¿å¼€å§‹åŠ¨æ€ç”Ÿæˆå­—èŠ‚ç ï¼Œå¹¶å°†å§”æ´¾å®ç°çš„å§”æ´¾å¯¹è±¡åˆ‡æ¢è‡³åŠ¨æ€å®ç°ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ç§°ä¹‹ä¸º Inflationã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ‰§è¡Œ java -verbose:class MethodDemo02 å¯åŠ¨</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodDemo02</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">target</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"#"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> klass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"io.github.dunwu.javacore.reflect.MethodDemo02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> klass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"target"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºå†…å®¹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ...çœç•¥</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Exception</span><span class="token operator">:</span> #<span class="token number">14</span>
        at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodDemo02</span><span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span><span class="token class-name">MethodDemo02</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">NativeMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodDemo02</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">MethodDemo02</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ClassFileConstants</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>AccessorGenerator</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodAccessorGenerator</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ByteVectorFactory</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ByteVector</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ByteVectorImpl</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ClassFileAssembler</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>UTF8 from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Label</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Label</span>$<span class="token class-name">PatchInfo</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ArrayList</span>$<span class="token class-name">Itr</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodAccessorGenerator</span>$<span class="token number">1</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ClassDefiner</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>ClassDefiner</span>$<span class="token number">1</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>GeneratedMethodAccessor1</span> from __JVM_DefineClass__<span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Exception</span><span class="token operator">:</span> #<span class="token number">15</span>
        at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodDemo02</span><span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span><span class="token class-name">MethodDemo02</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>NativeMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">NativeMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">62</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodDemo02</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">MethodDemo02</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token class-name">Loaded</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ConcurrentHashMap</span>$<span class="token class-name">ForwardingNode</span> from <span class="token class-name">D</span><span class="token operator">:</span>\<span class="token class-name">Tools</span>\<span class="token class-name">Java</span>\jdk1<span class="token punctuation">.</span><span class="token number">8.0_192</span>\jre\lib\rt<span class="token punctuation">.</span>jar<span class="token punctuation">]</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Exception</span><span class="token operator">:</span> #<span class="token number">16</span>
        at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodDemo02</span><span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span><span class="token class-name">MethodDemo02</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>GeneratedMethodAccessor1</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Unknown</span> <span class="token class-name">Source</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">DelegatingMethodAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Method</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">498</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>MethodDemo02</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">MethodDemo02</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token comment">// ...çœç•¥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä»ç¬¬ 16 æ¬¡å¼€å§‹åï¼Œéƒ½æ˜¯ä½¿ç”¨  <code>DelegatingMethodAccessorImpl</code>  ï¼Œä¸å†ä½¿ç”¨æœ¬åœ°å®ç°  <code>NativeMethodAccessorImpl</code> ã€‚</p>
<h3 id="-163"><a class="markdownIt-Anchor" href="#-163">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_2-4-%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8%E7%9A%84%E5%BC%80%E9%94%80">#</a>2.4. åå°„è°ƒç”¨çš„å¼€é”€</h3>
<p>æ–¹æ³•çš„åå°„è°ƒç”¨ä¼šå¸¦æ¥ä¸å°‘æ€§èƒ½å¼€é”€ï¼ŒåŸå› ä¸»è¦æœ‰ä¸‰ä¸ªï¼š</p>
<ul>
<li>å˜é•¿å‚æ•°æ–¹æ³•å¯¼è‡´çš„ Object æ•°ç»„</li>
<li>åŸºæœ¬ç±»å‹çš„è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±</li>
<li>è¿˜æœ‰æœ€é‡è¦çš„æ–¹æ³•å†…è”</li>
</ul>
<p><code>Class.forName</code>  ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œ <code>Class.getMethod</code>  åˆ™ä¼šéå†è¯¥ç±»çš„å…¬æœ‰æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œå®ƒè¿˜å°†éå†çˆ¶ç±»çš„å…¬æœ‰æ–¹æ³•ã€‚å¯æƒ³è€ŒçŸ¥ï¼Œè¿™ä¸¤ä¸ªæ“ä½œéƒ½éå¸¸è´¹æ—¶ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œä»¥  <code>getMethod</code>  ä¸ºä»£è¡¨çš„æŸ¥æ‰¾æ–¹æ³•æ“ä½œï¼Œä¼šè¿”å›æŸ¥æ‰¾å¾—åˆ°ç»“æœçš„ä¸€ä»½æ‹·è´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”å½“é¿å…åœ¨çƒ­ç‚¹ä»£ç ä¸­ä½¿ç”¨è¿”å›  <code>Method</code>  æ•°ç»„çš„  <code>getMethods</code>  æˆ–è€…  <code>getDeclaredMethods</code>  æ–¹æ³•ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„å †ç©ºé—´æ¶ˆè€—ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šåœ¨åº”ç”¨ç¨‹åºä¸­ç¼“å­˜  <code>Class.forName</code>  å’Œ  <code>Class.getMethod</code>  çš„ç»“æœã€‚</p>
</blockquote>
<p>ä¸‹é¢åªå…³æ³¨åå°„è°ƒç”¨æœ¬èº«çš„æ€§èƒ½å¼€é”€ã€‚</p>
<p>ç¬¬ä¸€ï¼Œç”±äº Method.invoke æ˜¯ä¸€ä¸ªå˜é•¿å‚æ•°æ–¹æ³•ï¼Œåœ¨å­—èŠ‚ç å±‚é¢å®ƒçš„æœ€åä¸€ä¸ªå‚æ•°ä¼šæ˜¯ Object æ•°ç»„ï¼ˆæ„Ÿå…´è¶£çš„åŒå­¦ç§ä¸‹å¯ä»¥ç”¨ javap æŸ¥çœ‹ï¼‰ã€‚Java ç¼–è¯‘å™¨ä¼šåœ¨æ–¹æ³•è°ƒç”¨å¤„ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸ºä¼ å…¥å‚æ•°æ•°é‡çš„ Object æ•°ç»„ï¼Œå¹¶å°†ä¼ å…¥å‚æ•°ä¸€ä¸€å­˜å‚¨è¿›è¯¥æ•°ç»„ä¸­ã€‚</p>
<p>ç¬¬äºŒï¼Œç”±äº Object æ•°ç»„ä¸èƒ½å­˜å‚¨åŸºæœ¬ç±»å‹ï¼ŒJava ç¼–è¯‘å™¨ä¼šå¯¹ä¼ å…¥çš„åŸºæœ¬ç±»å‹å‚æ•°è¿›è¡Œè‡ªåŠ¨è£…ç®±ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ“ä½œé™¤äº†å¸¦æ¥æ€§èƒ½å¼€é”€å¤–ï¼Œè¿˜å¯èƒ½å ç”¨å †å†…å­˜ï¼Œä½¿å¾— GC æ›´åŠ é¢‘ç¹ã€‚ï¼ˆå¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç”¨è™šæ‹Ÿæœºå‚æ•° -XX:+PrintGC è¯•è¯•ã€‚ï¼‰é‚£ä¹ˆï¼Œå¦‚ä½•æ¶ˆé™¤è¿™éƒ¨åˆ†å¼€é”€å‘¢ï¼Ÿ</p>
<h2 id="-164"><a class="markdownIt-Anchor" href="#-164">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-%E4%BD%BF%E7%94%A8%E5%8F%8D%E5%B0%84">#</a>3. ä½¿ç”¨åå°„</h2>
<h3 id="-165"><a class="markdownIt-Anchor" href="#-165">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-1-java-lang-reflect-%E5%8C%85">#</a>3.1. java.lang.reflect åŒ…</h3>
<p>Java ä¸­çš„  <code>java.lang.reflect</code>  åŒ…æä¾›äº†åå°„åŠŸèƒ½ã€‚ <code>java.lang.reflect</code>  åŒ…ä¸­çš„ç±»éƒ½æ²¡æœ‰  <code>public</code>  æ„é€ æ–¹æ³•ã€‚</p>
<p><code>java.lang.reflect</code>  åŒ…çš„æ ¸å¿ƒæ¥å£å’Œç±»å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>Member</code>  æ¥å£ï¼šåæ˜ å…³äºå•ä¸ªæˆå‘˜ (å­—æ®µæˆ–æ–¹æ³•) æˆ–æ„é€ å‡½æ•°çš„æ ‡è¯†ä¿¡æ¯ã€‚</li>
<li><code>Field</code>  ç±»ï¼šæä¾›ä¸€ä¸ªç±»çš„åŸŸçš„ä¿¡æ¯ä»¥åŠè®¿é—®ç±»çš„åŸŸçš„æ¥å£ã€‚</li>
<li><code>Method</code>  ç±»ï¼šæä¾›ä¸€ä¸ªç±»çš„æ–¹æ³•çš„ä¿¡æ¯ä»¥åŠè®¿é—®ç±»çš„æ–¹æ³•çš„æ¥å£ã€‚</li>
<li><code>Constructor</code>  ç±»ï¼šæä¾›ä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°çš„ä¿¡æ¯ä»¥åŠè®¿é—®ç±»çš„æ„é€ å‡½æ•°çš„æ¥å£ã€‚</li>
<li><code>Array</code>  ç±»ï¼šè¯¥ç±»æä¾›åŠ¨æ€åœ°ç”Ÿæˆå’Œè®¿é—® JAVA æ•°ç»„çš„æ–¹æ³•ã€‚</li>
<li><code>Modifier</code>  ç±»ï¼šæä¾›äº† static æ–¹æ³•å’Œå¸¸é‡ï¼Œå¯¹ç±»å’Œæˆå‘˜è®¿é—®ä¿®é¥°ç¬¦è¿›è¡Œè§£ç ã€‚</li>
<li><code>Proxy</code>  ç±»ï¼šæä¾›åŠ¨æ€åœ°ç”Ÿæˆä»£ç†ç±»å’Œç±»å®ä¾‹çš„é™æ€æ–¹æ³•ã€‚</li>
</ul>
<h3 id="-166"><a class="markdownIt-Anchor" href="#-166">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-2-%E8%8E%B7%E5%8F%96-class-%E5%AF%B9%E8%B1%A1">#</a>3.2. è·å– Class å¯¹è±¡</h3>
<p>è·å–  <code>Class</code>  å¯¹è±¡çš„ä¸‰ç§æ–¹æ³•ï¼š</p>
<p>ï¼ˆ1ï¼‰<strong> <code>Class.forName</code>  é™æ€æ–¹æ³•</strong></p>
<p>ã€ç¤ºä¾‹ã€‘ä½¿ç”¨  <code>Class.forName</code>  é™æ€æ–¹æ³•è·å–  <code>Class</code>  å¯¹è±¡</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectClassDemo01</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"io.github.dunwu.javacore.reflect.ReflectClassDemo01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span> c2 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"[D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span> c3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"[[Ljava.lang.String;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c3<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//io.github.dunwu.javacore.reflect.ReflectClassDemo01</span>
<span class="token comment">//double[]</span>
<span class="token comment">//java.lang.String[][]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨ç±»çš„å®Œå…¨é™å®šåæ¥åå°„å¯¹è±¡çš„ç±»ã€‚å¸¸è§çš„åº”ç”¨åœºæ™¯ä¸ºï¼šåœ¨ JDBC å¼€å‘ä¸­å¸¸ç”¨æ­¤æ–¹æ³•åŠ è½½æ•°æ®åº“é©±åŠ¨ã€‚</p>
<p>ï¼ˆ2ï¼‰<strong>ç±»å +  <code>.class</code> </strong></p>
<p>ã€ç¤ºä¾‹ã€‘ç›´æ¥ç”¨ç±»å +  <code>.class</code>  è·å–  <code>Class</code>  å¯¹è±¡</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectClassDemo02</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">boolean</span> b<span class="token punctuation">;</span>
        <span class="token comment">// Class c = b.getClass(); // ç¼–è¯‘é”™è¯¯</span>
        <span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token keyword">boolean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span> c2 <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>PrintStream</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span> c3 <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c3<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//boolean</span>
<span class="token comment">//java.io.PrintStream</span>
<span class="token comment">//int[][][]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ï¼ˆ3ï¼‰<strong> <code>Object</code>  çš„  <code>getClass</code>  æ–¹æ³•</strong></p>
<p><code>Object</code>  ç±»ä¸­æœ‰  <code>getClass</code>  æ–¹æ³•ï¼Œå› ä¸ºæ‰€æœ‰ç±»éƒ½ç»§æ‰¿  <code>Object</code>  ç±»ã€‚ä»è€Œè°ƒç”¨  <code>Object</code>  ç±»æ¥è·å–  <code>Class</code>  å¯¹è±¡ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ <code>Object</code>  çš„  <code>getClass</code>  æ–¹æ³•è·å–  <code>Class</code>  å¯¹è±¡</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectClassDemo03</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">enum</span> <span class="token class-name">E</span> <span class="token punctuation">&#123;</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">B</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Class</span> c <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Class</span> c2 <span class="token operator">=</span> <span class="token class-name">ReflectClassDemo03<span class="token punctuation">.</span>E<span class="token punctuation">.</span>A</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span> c3 <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c3<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span> c4 <span class="token operator">=</span> set<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c4<span class="token punctuation">.</span><span class="token function">getCanonicalName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//java.lang.String</span>
<span class="token comment">//io.github.dunwu.javacore.reflect.ReflectClassDemo.E</span>
<span class="token comment">//byte[]</span>
<span class="token comment">//java.util.HashSet</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-167"><a class="markdownIt-Anchor" href="#-167">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-3-%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E4%B8%BA%E6%9F%90%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B">#</a>3.3. åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªç±»çš„å®ä¾‹</h3>
<p>åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªç±»çš„å®ä¾‹æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li><strong>ç”¨  <code>instanceof</code>  å…³é”®å­—</strong></li>
<li><strong>ç”¨  <code>Class</code>  å¯¹è±¡çš„  <code>isInstance</code>  æ–¹æ³•</strong>ï¼ˆå®ƒæ˜¯ä¸€ä¸ª Native æ–¹æ³•ï¼‰</li>
</ol>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstanceofDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ArrayList</span> arrayList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arrayList <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ArrayList is List"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isInstance</span><span class="token punctuation">(</span>arrayList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ArrayList is List"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//ArrayList is List</span>
<span class="token comment">//ArrayList is List</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-168"><a class="markdownIt-Anchor" href="#-168">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-4-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B">#</a>3.4. åˆ›å»ºå®ä¾‹</h3>
<p>é€šè¿‡åå°„æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ç”¨  <code>Class</code>  å¯¹è±¡çš„  <code>newInstance</code>  æ–¹æ³•ã€‚</li>
<li>ç”¨  <code>Constructor</code>  å¯¹è±¡çš„  <code>newInstance</code>  æ–¹æ³•ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewInstanceDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c1 <span class="token operator">=</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">StringBuilder</span><span class="token punctuation">)</span> c1<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è·å–Stringæ‰€å¯¹åº”çš„Classå¯¹è±¡</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å–Stringç±»å¸¦ä¸€ä¸ªStringå‚æ•°çš„æ„é€ å™¨</span>
        <span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> c2<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ ¹æ®æ„é€ å™¨åˆ›å»ºå®ä¾‹</span>
        <span class="token class-name">String</span> str2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//aaa</span>
<span class="token comment">//bbb</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-169"><a class="markdownIt-Anchor" href="#-169">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-5-%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84%E5%AE%9E%E4%BE%8B">#</a>3.5. åˆ›å»ºæ•°ç»„å®ä¾‹</h3>
<p>æ•°ç»„åœ¨ Java é‡Œæ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç§ç±»å‹ï¼Œå®ƒå¯ä»¥èµ‹å€¼ç»™ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ã€‚Java ä¸­ï¼Œ<strong>é€šè¿‡  <code>Array.newInstance</code>  åˆ›å»ºæ•°ç»„çš„å®ä¾‹</strong>ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åˆ©ç”¨åå°„åˆ›å»ºæ•°ç»„</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectArrayDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> cls <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.String"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> array <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¾€æ•°ç»„é‡Œæ·»åŠ å†…å®¹</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Scala"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Groovy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"Scala"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"Clojure"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å–æŸä¸€é¡¹çš„å†…å®¹</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//Scala</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­çš„ Array ç±»ä¸º  <code>java.lang.reflect.Array</code>  ç±»ã€‚æˆ‘ä»¬ <code>Array.newInstance</code>  çš„åŸå‹æ˜¯ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> componentType<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">NegativeArraySizeException</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">newArray</span><span class="token punctuation">(</span>componentType<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-170"><a class="markdownIt-Anchor" href="#-170">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-6-field">#</a>3.6. Field</h3>
<p><code>Class</code>  å¯¹è±¡æä¾›ä»¥ä¸‹æ–¹æ³•è·å–å¯¹è±¡çš„æˆå‘˜ï¼ˆ <code>Field</code> ï¼‰ï¼š</p>
<ul>
<li><code>getFiled</code>  - æ ¹æ®åç§°è·å–å…¬æœ‰çš„ï¼ˆpublicï¼‰ç±»æˆå‘˜ã€‚</li>
<li><code>getDeclaredField</code>  - æ ¹æ®åç§°è·å–å·²å£°æ˜çš„ç±»æˆå‘˜ã€‚ä½†ä¸èƒ½å¾—åˆ°å…¶çˆ¶ç±»çš„ç±»æˆå‘˜ã€‚</li>
<li><code>getFields</code>  - è·å–æ‰€æœ‰å…¬æœ‰çš„ï¼ˆpublicï¼‰ç±»æˆå‘˜ã€‚</li>
<li><code>getDeclaredFields</code>  - è·å–æ‰€æœ‰å·²å£°æ˜çš„ç±»æˆå‘˜ã€‚</li>
</ul>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectFieldDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">class</span> <span class="token class-name">FieldSpy</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"Alice"</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchFieldException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Field</span> f1 <span class="token operator">=</span> <span class="token class-name">FieldSpy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Type: %s%n"</span><span class="token punctuation">,</span> f1<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Field</span> f2 <span class="token operator">=</span> <span class="token class-name">FieldSpy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Type: %s%n"</span><span class="token punctuation">,</span> f2<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Field</span> f3 <span class="token operator">=</span> <span class="token class-name">FieldSpy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Type: %s%n"</span><span class="token punctuation">,</span> f3<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Field</span> f4 <span class="token operator">=</span> <span class="token class-name">FieldSpy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"val"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Type: %s%n"</span><span class="token punctuation">,</span> f4<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//Type: class [[Z</span>
<span class="token comment">//Type: class java.lang.String</span>
<span class="token comment">//Type: interface java.util.List</span>
<span class="token comment">//Type: class java.lang.Object</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-171"><a class="markdownIt-Anchor" href="#-171">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-7-method">#</a>3.7. Method</h3>
<p><code>Class</code>  å¯¹è±¡æä¾›ä»¥ä¸‹æ–¹æ³•è·å–å¯¹è±¡çš„æ–¹æ³•ï¼ˆ <code>Method</code> ï¼‰ï¼š</p>
<ul>
<li><code>getMethod</code>  - è¿”å›ç±»æˆ–æ¥å£çš„ç‰¹å®šæ–¹æ³•ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åç§°ï¼Œåé¢çš„å‚æ•°ä¸ºæ–¹æ³•å‚æ•°å¯¹åº” Class çš„å¯¹è±¡ã€‚</li>
<li><code>getDeclaredMethod</code>  - è¿”å›ç±»æˆ–æ¥å£çš„ç‰¹å®šå£°æ˜æ–¹æ³•ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åç§°ï¼Œåé¢çš„å‚æ•°ä¸ºæ–¹æ³•å‚æ•°å¯¹åº” Class çš„å¯¹è±¡ã€‚</li>
<li><code>getMethods</code>  - è¿”å›ç±»æˆ–æ¥å£çš„æ‰€æœ‰ public æ–¹æ³•ï¼ŒåŒ…æ‹¬å…¶çˆ¶ç±»çš„ public æ–¹æ³•ã€‚</li>
<li><code>getDeclaredMethods</code>  - è¿”å›ç±»æˆ–æ¥å£å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ï¼ŒåŒ…æ‹¬ publicã€protectedã€é»˜è®¤ï¼ˆåŒ…ï¼‰è®¿é—®å’Œ private æ–¹æ³•ï¼Œä½†ä¸åŒ…æ‹¬ç»§æ‰¿çš„æ–¹æ³•ã€‚</li>
</ul>
<p>è·å–ä¸€ä¸ª  <code>Method</code>  å¯¹è±¡åï¼Œå¯ä»¥ç”¨  <code>invoke</code>  æ–¹æ³•æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p><code>invoke</code>  æ–¹æ³•çš„åŸå‹ä¸º:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">,</span>
           <span class="token class-name">InvocationTargetException</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectMethodDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// è¿”å›æ‰€æœ‰æ–¹æ³•</span>
        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"System getDeclaredMethods æ¸…å•ï¼ˆæ•°é‡ = "</span> <span class="token operator">+</span> methods1<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"ï¼‰ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> m <span class="token operator">:</span> methods1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// è¿”å›æ‰€æœ‰ public æ–¹æ³•</span>
        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods2 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"System getMethods æ¸…å•ï¼ˆæ•°é‡ = "</span> <span class="token operator">+</span> methods2<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"ï¼‰ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> m <span class="token operator">:</span> methods2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// åˆ©ç”¨ Method çš„ invoke æ–¹æ³•è°ƒç”¨ System.currentTimeMillis()</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"currentTimeMillis"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-172"><a class="markdownIt-Anchor" href="#-172">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-8-constructor">#</a>3.8. Constructor</h3>
<p><code>Class</code>  å¯¹è±¡æä¾›ä»¥ä¸‹æ–¹æ³•è·å–å¯¹è±¡çš„æ„é€ æ–¹æ³•ï¼ˆ <code>Constructor</code> ï¼‰ï¼š</p>
<ul>
<li><code>getConstructor</code>  - è¿”å›ç±»çš„ç‰¹å®š public æ„é€ æ–¹æ³•ã€‚å‚æ•°ä¸ºæ–¹æ³•å‚æ•°å¯¹åº” Class çš„å¯¹è±¡ã€‚</li>
<li><code>getDeclaredConstructor</code>  - è¿”å›ç±»çš„ç‰¹å®šæ„é€ æ–¹æ³•ã€‚å‚æ•°ä¸ºæ–¹æ³•å‚æ•°å¯¹åº” Class çš„å¯¹è±¡ã€‚</li>
<li><code>getConstructors</code>  - è¿”å›ç±»çš„æ‰€æœ‰ public æ„é€ æ–¹æ³•ã€‚</li>
<li><code>getDeclaredConstructors</code>  - è¿”å›ç±»çš„æ‰€æœ‰æ„é€ æ–¹æ³•ã€‚</li>
</ul>
<p>è·å–ä¸€ä¸ª  <code>Constructor</code>  å¯¹è±¡åï¼Œå¯ä»¥ç”¨  <code>newInstance</code>  æ–¹æ³•æ¥åˆ›å»ºç±»å®ä¾‹ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectMethodConstructorDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">InstantiationException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> constructors1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"String getDeclaredConstructors æ¸…å•ï¼ˆæ•°é‡ = "</span> <span class="token operator">+</span> constructors1<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"ï¼‰ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Constructor</span> c <span class="token operator">:</span> constructors1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> constructors2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"String getConstructors æ¸…å•ï¼ˆæ•°é‡ = "</span> <span class="token operator">+</span> constructors2<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"ï¼‰ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Constructor</span> c <span class="token operator">:</span> constructors2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-173"><a class="markdownIt-Anchor" href="#-173">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_3-9-%E7%BB%95%E5%BC%80%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6">#</a>3.9. ç»•å¼€è®¿é—®é™åˆ¶</h3>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åå°„è®¿é—®ç§æœ‰æˆå‘˜ã€æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨  <code>Constructor/Field/Method.setAccessible(true)</code>  æ¥ç»•å¼€ Java è¯­è¨€çš„è®¿é—®é™åˆ¶ã€‚</p>
<h2 id="-174"><a class="markdownIt-Anchor" href="#-174">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_4-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">#</a>4. åŠ¨æ€ä»£ç†</h2>
<p>åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§æ–¹ä¾¿è¿è¡Œæ—¶åŠ¨æ€æ„å»ºä»£ç†ã€åŠ¨æ€å¤„ç†ä»£ç†æ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œå¾ˆå¤šåœºæ™¯éƒ½æ˜¯åˆ©ç”¨ç±»ä¼¼æœºåˆ¶åšåˆ°çš„ï¼Œæ¯”å¦‚ç”¨æ¥åŒ…è£… RPC è°ƒç”¨ã€é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚</p>
<p>å®ç°åŠ¨æ€ä»£ç†çš„æ–¹å¼å¾ˆå¤šï¼Œæ¯”å¦‚ JDK è‡ªèº«æä¾›çš„åŠ¨æ€ä»£ç†ï¼Œå°±æ˜¯ä¸»è¦åˆ©ç”¨äº†ä¸Šé¢æåˆ°çš„åå°„æœºåˆ¶ã€‚è¿˜æœ‰å…¶ä»–çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚åˆ©ç”¨ä¼ è¯´ä¸­æ›´é«˜æ€§èƒ½çš„å­—èŠ‚ç æ“ä½œæœºåˆ¶ï¼Œç±»ä¼¼ ASMã€cglibï¼ˆåŸºäº ASMï¼‰ã€Javassist ç­‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/Java%E4%BB%A3%E7%90%86.svg" alt="img"></p>
<h3 id="-175"><a class="markdownIt-Anchor" href="#-175">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_4-1-%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86">#</a>4.1. é™æ€ä»£ç†</h3>
<blockquote>
<p>é™æ€ä»£ç†å…¶å®å°±æ˜¯æŒ‡è®¾è®¡æ¨¡å¼ä¸­çš„ä»£ç†æ¨¡å¼ã€‚</p>
<p><strong>ä»£ç†æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚</strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/3101171-6269723ea61527bd.png" alt="img"></p>
<p><strong>Subject</strong> å®šä¹‰äº† RealSubject å’Œ Proxy çš„å…¬å…±æ¥å£ï¼Œè¿™æ ·å°±åœ¨ä»»ä½•ä½¿ç”¨ RealSubject çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ Proxy ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>RealSubject</strong> å®šä¹‰ Proxy æ‰€ä»£è¡¨çš„çœŸå®å®ä½“ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">RealSubject</span> <span class="token keyword">extends</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çœŸå®çš„è¯·æ±‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>Proxy</strong> ä¿å­˜ä¸€ä¸ªå¼•ç”¨ä½¿å¾—ä»£ç†å¯ä»¥è®¿é—®å®ä½“ï¼Œå¹¶æä¾›ä¸€ä¸ªä¸ Subject çš„æ¥å£ç›¸åŒçš„æ¥å£ï¼Œè¿™æ ·ä»£ç†å°±å¯ä»¥ç”¨æ¥æ›¿ä»£å®ä½“ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Proxy</span> <span class="token keyword">extends</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">RealSubject</span> real<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> real<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            real <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name"><span class="token namespace">real<span class="token punctuation">.</span></span>Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<p>é™æ€ä»£ç†æ¨¡å¼å›ºç„¶åœ¨è®¿é—®æ— æ³•è®¿é—®çš„èµ„æºï¼Œå¢å¼ºç°æœ‰çš„æ¥å£ä¸šåŠ¡åŠŸèƒ½æ–¹é¢æœ‰å¾ˆå¤§çš„ä¼˜ç‚¹ï¼Œä½†æ˜¯å¤§é‡ä½¿ç”¨è¿™ç§é™æ€ä»£ç†ï¼Œä¼šä½¿æˆ‘ä»¬ç³»ç»Ÿå†…çš„ç±»çš„è§„æ¨¡å¢å¤§ï¼Œå¹¶ä¸”ä¸æ˜“ç»´æŠ¤ï¼›å¹¶ä¸”ç”±äº Proxy å’Œ RealSubject çš„åŠŸèƒ½æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„ï¼ŒProxy åªæ˜¯èµ·åˆ°äº†ä¸­ä»‹çš„ä½œç”¨ï¼Œè¿™ç§ä»£ç†åœ¨ç³»ç»Ÿä¸­çš„å­˜åœ¨ï¼Œå¯¼è‡´ç³»ç»Ÿç»“æ„æ¯”è¾ƒè‡ƒè‚¿å’Œæ¾æ•£ã€‚</p>
</blockquote>
<h3 id="-176"><a class="markdownIt-Anchor" href="#-176">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_4-2-jdk-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">#</a>4.2. JDK åŠ¨æ€ä»£ç†</h3>
<p>ä¸ºäº†è§£å†³é™æ€ä»£ç†çš„é—®é¢˜ï¼Œå°±æœ‰äº†åˆ›å»ºåŠ¨æ€ä»£ç†çš„æƒ³æ³•ï¼š</p>
<p>åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œéœ€è¦ä»£ç†çš„åœ°æ–¹ï¼Œæ ¹æ® Subject å’Œ RealSubjectï¼ŒåŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ª Proxyï¼Œç”¨å®Œä¹‹åï¼Œå°±ä¼šé”€æ¯ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…äº† Proxy è§’è‰²çš„ class åœ¨ç³»ç»Ÿä¸­å†—æ‚çš„é—®é¢˜äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553614585028.png" alt="img"></p>
<p>Java åŠ¨æ€ä»£ç†åŸºäºç»å…¸ä»£ç†æ¨¡å¼ï¼Œå¼•å…¥äº†ä¸€ä¸ª  <code>InvocationHandler</code> ï¼Œ <code>InvocationHandler</code>  è´Ÿè´£ç»Ÿä¸€ç®¡ç†æ‰€æœ‰çš„æ–¹æ³•è°ƒç”¨ã€‚</p>
<p>åŠ¨æ€ä»£ç†æ­¥éª¤ï¼š</p>
<ol>
<li>è·å– RealSubject ä¸Šçš„æ‰€æœ‰æ¥å£åˆ—è¡¨ï¼›</li>
<li>ç¡®å®šè¦ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åï¼Œé»˜è®¤ä¸ºï¼š <code>com.sun.proxy.$ProxyXXXX</code> ï¼›</li>
<li>æ ¹æ®éœ€è¦å®ç°çš„æ¥å£ä¿¡æ¯ï¼Œåœ¨ä»£ç ä¸­åŠ¨æ€åˆ›å»º è¯¥ Proxy ç±»çš„å­—èŠ‚ç ï¼›</li>
<li>å°†å¯¹åº”çš„å­—èŠ‚ç è½¬æ¢ä¸ºå¯¹åº”çš„ class å¯¹è±¡ï¼›</li>
<li>åˆ›å»º  <code>InvocationHandler</code>  å®ä¾‹ handlerï¼Œç”¨æ¥å¤„ç†  <code>Proxy</code>  æ‰€æœ‰æ–¹æ³•è°ƒç”¨ï¼›</li>
<li>Proxy çš„ class å¯¹è±¡ ä»¥åˆ›å»ºçš„ handler å¯¹è±¡ä¸ºå‚æ•°ï¼Œå®ä¾‹åŒ–ä¸€ä¸ª proxy å¯¹è±¡ã€‚</li>
</ol>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒJDK åŠ¨æ€ä»£ç†çš„å®ç°æ˜¯åŸºäºå®ç°æ¥å£çš„æ–¹å¼ï¼Œä½¿å¾— Proxy å’Œ RealSubject å…·æœ‰ç›¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>ä½†å…¶å®è¿˜æœ‰ä¸€ç§æ€è·¯ï¼šé€šè¿‡ç»§æ‰¿ã€‚å³ï¼šè®© Proxy ç»§æ‰¿ RealSubjectï¼Œè¿™æ ·äºŒè€…åŒæ ·å…·æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼ŒProxy è¿˜å¯ä»¥é€šè¿‡é‡å†™ RealSubject ä¸­çš„æ–¹æ³•ï¼Œæ¥å®ç°å¤šæ€ã€‚CGLIB å°±æ˜¯åŸºäºè¿™ç§æ€è·¯è®¾è®¡çš„ã€‚</p>
<p>åœ¨ Java çš„åŠ¨æ€ä»£ç†æœºåˆ¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„ç±»ï¼ˆæ¥å£ï¼‰ï¼Œä¸€ä¸ªæ˜¯  <code>InvocationHandler</code>  æ¥å£ã€å¦ä¸€ä¸ªåˆ™æ˜¯  <code>Proxy</code>  ç±»ï¼Œè¿™ä¸€ä¸ªç±»å’Œä¸€ä¸ªæ¥å£æ˜¯å®ç°æˆ‘ä»¬åŠ¨æ€ä»£ç†æ‰€å¿…é¡»ç”¨åˆ°çš„ã€‚</p>
<h4 id="-177"><a class="markdownIt-Anchor" href="#-177">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#invocationhandler-%E6%8E%A5%E5%8F%A3">#</a>InvocationHandler æ¥å£</h4>
<p><code>InvocationHandler</code>  æ¥å£å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»è¦å®ç°  <code>InvocationHandler</code>  è¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»çš„å®ä¾‹éƒ½å…³è”åˆ°äº†ä¸€ä¸ª Handlerï¼Œå½“æˆ‘ä»¬é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘ä¸ºç”±  <code>InvocationHandler</code>  è¿™ä¸ªæ¥å£çš„  <code>invoke</code>  æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ InvocationHandler è¿™ä¸ªæ¥å£çš„å”¯ä¸€ä¸€ä¸ªæ–¹æ³• invoke æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><strong>proxy</strong> - ä»£ç†çš„çœŸå®å¯¹è±¡ã€‚</li>
<li><strong>method</strong> - æ‰€è¦è°ƒç”¨çœŸå®å¯¹è±¡çš„æŸä¸ªæ–¹æ³•çš„  <code>Method</code>  å¯¹è±¡</li>
<li><strong>args</strong> - æ‰€è¦è°ƒç”¨çœŸå®å¯¹è±¡æŸä¸ªæ–¹æ³•æ—¶æ¥å—çš„å‚æ•°</li>
</ul>
<p>å¦‚æœä¸æ˜¯å¾ˆæ˜ç™½ï¼Œç­‰ä¸‹é€šè¿‡ä¸€ä¸ªå®ä¾‹ä¼šå¯¹è¿™å‡ ä¸ªå‚æ•°è¿›è¡Œæ›´æ·±çš„è®²è§£ã€‚</p>
<h4 id="-178"><a class="markdownIt-Anchor" href="#-178">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#proxy-%E7%B1%BB">#</a>Proxy ç±»</h4>
<p><code>Proxy</code>  è¿™ä¸ªç±»çš„ä½œç”¨å°±æ˜¯ç”¨æ¥åŠ¨æ€åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡çš„ç±»ï¼Œå®ƒæä¾›äº†è®¸å¤šçš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„å°±æ˜¯  <code>newProxyInstance</code>  è¿™ä¸ªæ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> <span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> loader<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces<span class="token punctuation">,</span>  <span class="token class-name">InvocationHandler</span> h<span class="token punctuation">)</span>  <span class="token keyword">throws</span> <span class="token class-name">IllegalArgumentException</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯å¾—åˆ°ä¸€ä¸ªåŠ¨æ€çš„ä»£ç†å¯¹è±¡ã€‚</p>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><strong>loader</strong> - ä¸€ä¸ª  <code>ClassLoader</code>  å¯¹è±¡ï¼Œå®šä¹‰äº†ç”±å“ªä¸ª  <code>ClassLoader</code>  å¯¹è±¡æ¥å¯¹ç”Ÿæˆçš„ä»£ç†å¯¹è±¡è¿›è¡ŒåŠ è½½ã€‚</li>
<li><strong>interfaces</strong> - ä¸€ä¸ª  <code>Class&lt;?&gt;</code>  å¯¹è±¡çš„æ•°ç»„ï¼Œè¡¨ç¤ºçš„æ˜¯æˆ‘å°†è¦ç»™æˆ‘éœ€è¦ä»£ç†çš„å¯¹è±¡æä¾›ä¸€ç»„ä»€ä¹ˆæ¥å£ï¼Œå¦‚æœæˆ‘æä¾›äº†ä¸€ç»„æ¥å£ç»™å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç†å¯¹è±¡å°±å®£ç§°å®ç°äº†è¯¥æ¥å£ (å¤šæ€)ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº†</li>
<li><strong>h</strong> - ä¸€ä¸ª  <code>InvocationHandler</code>  å¯¹è±¡ï¼Œè¡¨ç¤ºçš„æ˜¯å½“æˆ‘è¿™ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå…³è”åˆ°å“ªä¸€ä¸ª  <code>InvocationHandler</code>  å¯¹è±¡ä¸Š</li>
</ul>
<h4 id="-179"><a class="markdownIt-Anchor" href="#-179">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#jdk-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E4%BE%8B">#</a>JDK åŠ¨æ€ä»£ç†å®ä¾‹</h4>
<p>ä¸Šé¢çš„å†…å®¹ä»‹ç»å®Œè¿™ä¸¤ä¸ªæ¥å£ (ç±») ä»¥åï¼Œæˆ‘ä»¬æ¥é€šè¿‡ä¸€ä¸ªå®ä¾‹æ¥çœ‹çœ‹æˆ‘ä»¬çš„åŠ¨æ€ä»£ç†æ¨¡å¼æ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p>
<p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª Subject ç±»å‹çš„æ¥å£ï¼Œä¸ºå…¶å£°æ˜äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">bye</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¥ç€ï¼Œå®šä¹‰äº†ä¸€ä¸ªç±»æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œè¿™ä¸ªç±»å°±æ˜¯æˆ‘ä»¬çš„çœŸå®å¯¹è±¡ï¼ŒRealSubject ç±»ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello  "</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">bye</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Goodbye"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"Over"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±è¦å®šä¹‰ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»äº†ï¼Œå‰é¢è¯´ä¸ªï¼Œæ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»è¦å®ç° InvocationHandler è¿™ä¸ªæ¥å£ï¼Œå› æ­¤æˆ‘ä»¬è¿™ä¸ªåŠ¨æ€ä»£ç†ç±»ä¹Ÿä¸ä¾‹å¤–ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InvocationHandlerDemo</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡</span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> subject<span class="token punctuation">;</span>

    <span class="token comment">// æ„é€ æ–¹æ³•ï¼Œç»™æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡èµ‹åˆå€¼</span>
    <span class="token keyword">public</span> <span class="token class-name">InvocationHandlerDemo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> subject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subject <span class="token operator">=</span> subject<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åœ¨ä»£ç†çœŸå®å¯¹è±¡å‰æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Before method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Call Method: "</span> <span class="token operator">+</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>subject<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åœ¨ä»£ç†çœŸå®å¯¹è±¡åæˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"After method"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æœ€åï¼Œæ¥çœ‹çœ‹æˆ‘ä»¬çš„ Client ç±»ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æˆ‘ä»¬è¦ä»£ç†çš„çœŸå®å¯¹è±¡</span>
        <span class="token class-name">Subject</span> realSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æˆ‘ä»¬è¦ä»£ç†å“ªä¸ªçœŸå®å¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›å»ï¼Œæœ€åæ˜¯é€šè¿‡è¯¥çœŸå®å¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•çš„</span>
        <span class="token class-name">InvocationHandler</span> handler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandlerDemo</span><span class="token punctuation">(</span>realSubject<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
         * é€šè¿‡Proxyçš„newProxyInstanceæ–¹æ³•æ¥åˆ›å»ºæˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸‰ä¸ªå‚æ•°
         * ç¬¬ä¸€ä¸ªå‚æ•° handler.getClass().getClassLoader() ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨handlerè¿™ä¸ªç±»çš„ClassLoaderå¯¹è±¡æ¥åŠ è½½æˆ‘ä»¬çš„ä»£ç†å¯¹è±¡
         * ç¬¬äºŒä¸ªå‚æ•°realSubject.getClass().getInterfaces()ï¼Œæˆ‘ä»¬è¿™é‡Œä¸ºä»£ç†å¯¹è±¡æä¾›çš„æ¥å£æ˜¯çœŸå®å¯¹è±¡æ‰€å®è¡Œçš„æ¥å£ï¼Œè¡¨ç¤ºæˆ‘è¦ä»£ç†çš„æ˜¯è¯¥çœŸå®å¯¹è±¡ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº†
         * ç¬¬ä¸‰ä¸ªå‚æ•°handlerï¼Œ æˆ‘ä»¬è¿™é‡Œå°†è¿™ä¸ªä»£ç†å¯¹è±¡å…³è”åˆ°äº†ä¸Šæ–¹çš„ InvocationHandler è¿™ä¸ªå¯¹è±¡ä¸Š
         */</span>
        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Subject</span><span class="token punctuation">)</span><span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>handler<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> realSubject
                <span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> subject<span class="token punctuation">.</span><span class="token function">bye</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Result is: "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ§åˆ¶å°çš„è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">com.sun.proxy.$Proxy0
Before method
Call Method: public abstract void io.github.dunwu.javacore.reflect.InvocationHandlerDemo$Subject.hello(java.lang.String)
Hello  World
After method

Before method
Call Method: public abstract java.lang.String io.github.dunwu.javacore.reflect.InvocationHandlerDemo$Subject.bye()
Goodbye
After method

Result is: Over<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹çœ‹  <code>com.sun.proxy.$Proxy0</code>  è¿™ä¸œè¥¿ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªä¸œè¥¿æ˜¯ç”±  <code>System.out.println(subject.getClass().getName());</code>  è¿™æ¡è¯­å¥æ‰“å°å‡ºæ¥çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬è¿”å›çš„è¿™ä¸ªä»£ç†å¯¹è±¡çš„ç±»åæ˜¯è¿™æ ·çš„å‘¢ï¼Ÿ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Subject</span><span class="token punctuation">)</span><span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>handler<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> realSubject
                <span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¯èƒ½æˆ‘ä»¥ä¸ºè¿”å›çš„è¿™ä¸ªä»£ç†å¯¹è±¡ä¼šæ˜¯ Subject ç±»å‹çš„å¯¹è±¡ï¼Œæˆ–è€…æ˜¯ InvocationHandler çš„å¯¹è±¡ï¼Œç»“æœå´ä¸æ˜¯ï¼Œé¦–å…ˆæˆ‘ä»¬è§£é‡Šä¸€ä¸‹<strong>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿™é‡Œå¯ä»¥å°†å…¶è½¬åŒ–ä¸º Subject ç±»å‹çš„å¯¹è±¡ï¼Ÿ</strong></p>
<p>åŸå› å°±æ˜¯ï¼šåœ¨ newProxyInstance è¿™ä¸ªæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¸Šï¼Œæˆ‘ä»¬ç»™è¿™ä¸ªä»£ç†å¯¹è±¡æä¾›äº†ä¸€ç»„ä»€ä¹ˆæ¥å£ï¼Œé‚£ä¹ˆæˆ‘è¿™ä¸ªä»£ç†å¯¹è±¡å°±ä¼šå®ç°äº†è¿™ç»„æ¥å£ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å½“ç„¶å¯ä»¥å°†è¿™ä¸ªä»£ç†å¯¹è±¡å¼ºåˆ¶ç±»å‹è½¬åŒ–ä¸ºè¿™ç»„æ¥å£ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œå› ä¸ºè¿™é‡Œçš„æ¥å£æ˜¯ Subject ç±»å‹ï¼Œæ‰€ä»¥å°±å¯ä»¥å°†å…¶è½¬åŒ–ä¸º Subject ç±»å‹äº†ã€‚</p>
<p><strong>åŒæ—¶æˆ‘ä»¬ä¸€å®šè¦è®°ä½ï¼Œé€šè¿‡  <code>Proxy.newProxyInstance</code>  åˆ›å»ºçš„ä»£ç†å¯¹è±¡æ˜¯åœ¨ jvm è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¹¶ä¸æ˜¯æˆ‘ä»¬çš„ InvocationHandler ç±»å‹ï¼Œä¹Ÿä¸æ˜¯æˆ‘ä»¬å®šä¹‰çš„é‚£ç»„æ¥å£çš„ç±»å‹ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ˜¯åŠ¨æ€ç”Ÿæˆçš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”å‘½åæ–¹å¼éƒ½æ˜¯è¿™æ ·çš„å½¢å¼ï¼Œä»¥ $ å¼€å¤´ï¼Œproxy ä¸ºä¸­ï¼Œæœ€åä¸€ä¸ªæ•°å­—è¡¨ç¤ºå¯¹è±¡çš„æ ‡å·</strong>ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸¤å¥</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">subject.hello("World");
String result = subject.bye();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿™é‡Œæ˜¯é€šè¿‡ä»£ç†å¯¹è±¡æ¥è°ƒç”¨å®ç°çš„é‚£ç§æ¥å£ä¸­çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ç¨‹åºå°±ä¼šè·³è½¬åˆ°ç”±è¿™ä¸ªä»£ç†å¯¹è±¡å…³è”åˆ°çš„ handler ä¸­çš„ invoke æ–¹æ³•å»æ‰§è¡Œï¼Œè€Œæˆ‘ä»¬çš„è¿™ä¸ª handler å¯¹è±¡åˆæ¥å—äº†ä¸€ä¸ª RealSubject ç±»å‹çš„å‚æ•°ï¼Œè¡¨ç¤ºæˆ‘è¦ä»£ç†çš„å°±æ˜¯è¿™ä¸ªçœŸå®å¯¹è±¡ï¼Œæ‰€ä»¥æ­¤æ—¶å°±ä¼šè°ƒç”¨ handler ä¸­çš„ invoke æ–¹æ³•å»æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨çœŸæ­£é€šè¿‡ä»£ç†å¯¹è±¡æ¥è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¥æ–¹æ³•å‰åæ·»åŠ è‡ªå·±çš„ä¸€äº›æ“ä½œï¼ŒåŒæ—¶æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬çš„è¿™ä¸ª method å¯¹è±¡æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>InvocationHandlerDemo</span>$<span class="token class-name">Subject</span><span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>InvocationHandlerDemo</span>$<span class="token class-name">Subject</span><span class="token punctuation">.</span><span class="token function">bye</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ­£å¥½å°±æ˜¯æˆ‘ä»¬çš„ Subject æ¥å£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œè¿™ä¹Ÿå°±è¯æ˜äº†å½“æˆ‘é€šè¿‡ä»£ç†å¯¹è±¡æ¥è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œèµ·å®é™…å°±æ˜¯å§”æ‰˜ç”±å…¶å…³è”åˆ°çš„ handler å¯¹è±¡çš„ invoke æ–¹æ³•ä¸­æ¥è°ƒç”¨ï¼Œå¹¶ä¸æ˜¯è‡ªå·±æ¥çœŸå®è°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†çš„æ–¹å¼æ¥è°ƒç”¨çš„ã€‚</p>
<h4 id="-180"><a class="markdownIt-Anchor" href="#-180">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#jdk-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%B0%8F%E7%BB%93">#</a>JDK åŠ¨æ€ä»£ç†å°ç»“</h4>
<p>ä»£ç†ç±»ä¸å§”æ‰˜ç±»å®ç°åŒä¸€æ¥å£ï¼Œä¸»è¦æ˜¯é€šè¿‡ä»£ç†ç±»å®ç°  <code>InvocationHandler</code>  å¹¶é‡å†™  <code>invoke</code>  æ–¹æ³•æ¥è¿›è¡ŒåŠ¨æ€ä»£ç†çš„ï¼Œåœ¨  <code>invoke</code>  æ–¹æ³•ä¸­å°†å¯¹æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
<p>JDK åŠ¨æ€ä»£ç†ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç›¸å¯¹äºé™æ€ä»£ç†æ¨¡å¼ï¼Œä¸éœ€è¦ç¡¬ç¼–ç æ¥å£ï¼Œä»£ç å¤ç”¨ç‡é«˜ã€‚</li>
<li>ç¼ºç‚¹ï¼šå¼ºåˆ¶è¦æ±‚ä»£ç†ç±»å®ç°  <code>InvocationHandler</code>  æ¥å£ã€‚</li>
</ul>
<h3 id="-181"><a class="markdownIt-Anchor" href="#-181">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-reflection.html#_4-3-cglib-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">#</a>4.3. CGLIB åŠ¨æ€ä»£ç†</h3>
<p>CGLIB æä¾›äº†ä¸ JDK åŠ¨æ€ä»£ç†ä¸åŒçš„æ–¹æ¡ˆã€‚å¾ˆå¤šæ¡†æ¶ï¼Œä¾‹å¦‚ Spring AOP ä¸­ï¼Œå°±ä½¿ç”¨äº† CGLIB åŠ¨æ€ä»£ç†ã€‚</p>
<p>CGLIB åº•å±‚ï¼Œå…¶å®æ˜¯å€ŸåŠ©äº† ASM è¿™ä¸ªå¼ºå¤§çš„ Java å­—èŠ‚ç æ¡†æ¶å»è¿›è¡Œå­—èŠ‚ç å¢å¼ºæ“ä½œã€‚</p>
<p>CGLIB åŠ¨æ€ä»£ç†çš„å·¥ä½œæ­¥éª¤ï¼š</p>
<ul>
<li>ç”Ÿæˆä»£ç†ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚ç æ–‡ä»¶ï¼›</li>
<li>åŠ è½½äºŒè¿›åˆ¶å­—èŠ‚ç ï¼Œç”Ÿæˆ  <code>Class</code>  å¯¹è±¡ ( ä¾‹å¦‚ä½¿ç”¨  <code>Class.forName()</code>  æ–¹æ³• )ï¼›</li>
<li>é€šè¿‡åå°„æœºåˆ¶è·å¾—å®ä¾‹æ„é€ ï¼Œå¹¶åˆ›å»ºä»£ç†ç±»å¯¹è±¡ã€‚</li>
</ul>
<p>CGLIB åŠ¨æ€ä»£ç†ç‰¹ç‚¹ï¼š</p>
<p>ä¼˜ç‚¹ï¼šä½¿ç”¨å­—èŠ‚ç å¢å¼ºï¼Œæ¯” JDK åŠ¨æ€ä»£ç†æ–¹å¼æ€§èƒ½é«˜ã€‚å¯ä»¥åœ¨è¿è¡Œæ—¶å¯¹ç±»æˆ–è€…æ˜¯æ¥å£è¿›è¡Œå¢å¼ºæ“ä½œï¼Œä¸”å§”æ‰˜ç±»æ— éœ€å®ç°æ¥å£ã€‚</p>
<p>ç¼ºç‚¹ï¼šä¸èƒ½å¯¹  <code>final</code>  ç±»ä»¥åŠ  <code>final</code>  æ–¹æ³•è¿›è¡Œä»£ç†ã€‚</p>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-æ³¨è§£"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-æ³¨è§£">#</a> æ·±å…¥ç†è§£ Java æ³¨è§£</h1>
<blockquote>
<p>æœ¬æ–‡å†…å®¹åŸºäº JDK8ã€‚æ³¨è§£æ˜¯ JDK5 å¼•å…¥çš„ï¼Œåç»­ JDK ç‰ˆæœ¬æ‰©å±•äº†ä¸€äº›å†…å®¹ï¼Œæœ¬æ–‡ä¸­æ²¡æœ‰æ˜ç¡®æŒ‡æ˜ç‰ˆæœ¬çš„æ³¨è§£éƒ½æ˜¯ JDK5 å°±å·²ç»æ”¯æŒçš„æ³¨è§£ã€‚</p>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#11-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%BD%A2%E5%BC%8F">1.1. æ³¨è§£çš„å½¢å¼</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#12-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E8%A7%A3">1.2. ä»€ä¹ˆæ˜¯æ³¨è§£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#13-%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BD%9C%E7%94%A8">1.3. æ³¨è§£çš„ä½œç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#14-%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BB%A3%E4%BB%B7">1.4. æ³¨è§£çš„ä»£ä»·</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#15-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%BA%94%E7%94%A8%E8%8C%83%E5%9B%B4">1.5. æ³¨è§£çš„åº”ç”¨èŒƒå›´</a></li>
</ul>
</li>
<li>\2. å†…ç½®æ³¨è§£
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#21-override">2.1. @Override</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#22-deprecated">2.2. @Deprecated</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#23-suppresswarnnings">2.3. @SuppressWarnnings</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#24-safevarargs">2.4. @SafeVarargs</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#25-functionalinterface">2.5. @FunctionalInterface</a></li>
</ul>
</li>
<li>\3. å…ƒæ³¨è§£
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#31-retention">3.1. @Retention</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#32-documented">3.2. @Documented</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#33-target">3.3. @Target</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#34-inherited">3.4. @Inherited</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#35-repeatable">3.5. @Repeatable</a></li>
</ul>
</li>
<li>\4. è‡ªå®šä¹‰æ³¨è§£
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#41-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%AE%9A%E4%B9%89">4.1. æ³¨è§£çš„å®šä¹‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#42-%E6%B3%A8%E8%A7%A3%E5%B1%9E%E6%80%A7">4.2. æ³¨è§£å±æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#43-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8">4.3. æ³¨è§£å¤„ç†å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#44-%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3">4.4. ä½¿ç”¨æ³¨è§£</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#5-%E5%B0%8F%E7%BB%93">5. å°ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#6-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">6. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-182"><a class="markdownIt-Anchor" href="#-182">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_1-%E7%AE%80%E4%BB%8B">#</a>1. ç®€ä»‹</h2>
<h3 id="-183"><a class="markdownIt-Anchor" href="#-183">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_1-1-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%BD%A2%E5%BC%8F">#</a>1.1. æ³¨è§£çš„å½¢å¼</h3>
<p>Java ä¸­ï¼Œæ³¨è§£æ˜¯ä»¥  <code>@</code>  å­—ç¬¦å¼€å§‹çš„ä¿®é¥°ç¬¦ã€‚å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">void</span> <span class="token function">mySuperMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ³¨è§£å¯ä»¥åŒ…å«å‘½åæˆ–æœªå‘½åçš„å±æ€§ï¼Œå¹¶ä¸”è¿™äº›å±æ€§æœ‰å€¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Author</span><span class="token punctuation">(</span>
   name <span class="token operator">=</span> <span class="token string">"Benjamin Franklin"</span><span class="token punctuation">,</span>
   date <span class="token operator">=</span> <span class="token string">"3/27/2003"</span>
<span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœåªæœ‰ä¸€ä¸ªåä¸º value çš„å±æ€§ï¼Œé‚£ä¹ˆåç§°å¯ä»¥çœç•¥ï¼Œå¦‚ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">myMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¦‚æœæ³¨è§£æ²¡æœ‰å±æ€§ï¼Œåˆ™ç§°ä¸º <code>æ ‡è®°æ³¨è§£</code> ã€‚å¦‚ï¼š <code>@Override</code> ã€‚</p>
<h3 id="-184"><a class="markdownIt-Anchor" href="#-184">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_1-2-%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E8%A7%A3">#</a>1.2. ä»€ä¹ˆæ˜¯æ³¨è§£</h3>
<p>ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œ<strong>æ³¨è§£æ˜¯ä¸€ç§æ ‡ç­¾ï¼Œå…¶å®è´¨ä¸Šå¯ä»¥è§†ä¸ºä¸€ç§ç‰¹æ®Šçš„æ³¨é‡Šï¼Œå¦‚æœæ²¡æœ‰è§£æå®ƒçš„ä»£ç ï¼Œå®ƒå¹¶ä¸æ¯”æ™®é€šæ³¨é‡Šå¼ºã€‚</strong></p>
<p>è§£æä¸€ä¸ªæ³¨è§£å¾€å¾€æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li><strong>ç¼–è¯‘æœŸç›´æ¥çš„æ‰«æ</strong> - ç¼–è¯‘å™¨çš„æ‰«ææŒ‡çš„æ˜¯ç¼–è¯‘å™¨åœ¨å¯¹ java ä»£ç ç¼–è¯‘å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ä¼šæ£€æµ‹åˆ°æŸä¸ªç±»æˆ–è€…æ–¹æ³•è¢«ä¸€äº›æ³¨è§£ä¿®é¥°ï¼Œè¿™æ—¶å®ƒå°±ä¼šå¯¹äºè¿™äº›æ³¨è§£è¿›è¡ŒæŸäº›å¤„ç†ã€‚è¿™ç§æƒ…å†µåªé€‚ç”¨äº JDK å†…ç½®çš„æ³¨è§£ç±»ã€‚</li>
<li><strong>è¿è¡ŒæœŸçš„åå°„</strong> - å¦‚æœè¦è‡ªå®šä¹‰æ³¨è§£ï¼ŒJava ç¼–è¯‘å™¨æ— æ³•è¯†åˆ«å¹¶å¤„ç†è¿™ä¸ªæ³¨è§£ï¼Œå®ƒåªèƒ½æ ¹æ®è¯¥æ³¨è§£çš„ä½œç”¨èŒƒå›´æ¥é€‰æ‹©æ˜¯å¦ç¼–è¯‘è¿›å­—èŠ‚ç æ–‡ä»¶ã€‚å¦‚æœè¦å¤„ç†æ³¨è§£ï¼Œå¿…é¡»åˆ©ç”¨åå°„æŠ€æœ¯ï¼Œè¯†åˆ«è¯¥æ³¨è§£ä»¥åŠå®ƒæ‰€æºå¸¦çš„ä¿¡æ¯ï¼Œç„¶ååšç›¸åº”çš„å¤„ç†ã€‚</li>
</ul>
<h3 id="-185"><a class="markdownIt-Anchor" href="#-185">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_1-3-%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BD%9C%E7%94%A8">#</a>1.3. æ³¨è§£çš„ä½œç”¨</h3>
<p>æ³¨è§£æœ‰è®¸å¤šç”¨é€”ï¼š</p>
<ul>
<li>ç¼–è¯‘å™¨ä¿¡æ¯ - ç¼–è¯‘å™¨å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥æ£€æµ‹é”™è¯¯æˆ–æŠ‘åˆ¶è­¦å‘Šã€‚</li>
<li>ç¼–è¯‘æ—¶å’Œéƒ¨ç½²æ—¶çš„å¤„ç† - ç¨‹åºå¯ä»¥å¤„ç†æ³¨è§£ä¿¡æ¯ä»¥ç”Ÿæˆä»£ç ï¼ŒXML æ–‡ä»¶ç­‰ã€‚</li>
<li>è¿è¡Œæ—¶å¤„ç† - å¯ä»¥åœ¨è¿è¡Œæ—¶æ£€æŸ¥æŸäº›æ³¨è§£å¹¶å¤„ç†ã€‚</li>
</ul>
<p>ä½œä¸º Java ç¨‹åºå‘˜ï¼Œå¤šå¤šå°‘å°‘éƒ½æ›¾ç»å†è¿‡è¢«å„ç§é…ç½®æ–‡ä»¶ï¼ˆxmlã€propertiesï¼‰æ”¯é…çš„ææƒ§ã€‚è¿‡å¤šçš„é…ç½®æ–‡ä»¶ä¼šä½¿å¾—é¡¹ç›®éš¾ä»¥ç»´æŠ¤ã€‚ä¸ªäººè®¤ä¸ºï¼Œä½¿ç”¨æ³¨è§£ä»¥å‡å°‘é…ç½®æ–‡ä»¶æˆ–ä»£ç ï¼Œæ˜¯æ³¨è§£æœ€å¤§çš„ç”¨å¤„ã€‚</p>
<h3 id="-186"><a class="markdownIt-Anchor" href="#-186">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_1-4-%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BB%A3%E4%BB%B7">#</a>1.4. æ³¨è§£çš„ä»£ä»·</h3>
<p>å‡¡äº‹æœ‰å¾—å¿…æœ‰å¤±ï¼Œæ³¨è§£æŠ€æœ¯åŒæ ·å¦‚æ­¤ã€‚ä½¿ç”¨æ³¨è§£ä¹Ÿæœ‰ä¸€å®šçš„ä»£ä»·ï¼š</p>
<ul>
<li>æ˜¾ç„¶ï¼Œå®ƒæ˜¯ä¸€ç§ä¾µå…¥å¼ç¼–ç¨‹ï¼Œé‚£ä¹ˆï¼Œè‡ªç„¶å°±å­˜åœ¨ç€å¢åŠ ç¨‹åºè€¦åˆåº¦çš„é—®é¢˜ã€‚</li>
<li>è‡ªå®šä¹‰æ³¨è§£çš„å¤„ç†éœ€è¦åœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡åå°„æŠ€æœ¯æ¥è·å–å±æ€§ã€‚å¦‚æœæ³¨è§£æ‰€ä¿®é¥°çš„å…ƒç´ æ˜¯ç±»çš„é public æˆå‘˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åå°„è·å–ã€‚è¿™å°±è¿èƒŒäº†é¢å‘å¯¹è±¡çš„å°è£…æ€§ã€‚</li>
<li>æ³¨è§£æ‰€äº§ç”Ÿçš„é—®é¢˜ï¼Œç›¸å¯¹è€Œè¨€ï¼Œæ›´éš¾ä»¥ debug æˆ–å®šä½ã€‚</li>
</ul>
<p>ä½†æ˜¯ï¼Œæ­£æ‰€è°“ç‘•ä¸æ©ç‘œï¼Œæ³¨è§£æ‰€ä»˜å‡ºçš„ä»£ä»·ï¼Œç›¸è¾ƒäºå®ƒæä¾›çš„åŠŸèƒ½è€Œè¨€ï¼Œè¿˜æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<h3 id="-187"><a class="markdownIt-Anchor" href="#-187">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_1-5-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%BA%94%E7%94%A8%E8%8C%83%E5%9B%B4">#</a>1.5. æ³¨è§£çš„åº”ç”¨èŒƒå›´</h3>
<p>æ³¨è§£å¯ä»¥åº”ç”¨äºç±»ã€å­—æ®µã€æ–¹æ³•å’Œå…¶ä»–ç¨‹åºå…ƒç´ çš„å£°æ˜ã€‚</p>
<p>JDK8 å¼€å§‹ï¼Œæ³¨è§£çš„åº”ç”¨èŒƒå›´è¿›ä¸€æ­¥æ‰©å¤§ï¼Œä»¥ä¸‹æ˜¯æ–°çš„åº”ç”¨èŒƒå›´ï¼š</p>
<p>ç±»å®ä¾‹åˆå§‹åŒ–è¡¨è¾¾å¼ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token annotation punctuation">@Interned</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç±»å‹è½¬æ¢ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">myString <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">)</span> str<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å®ç°æ¥å£çš„å£°æ˜ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">UnmodifiableList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span>
    <span class="token annotation punctuation">@Readonly</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token annotation punctuation">@Readonly</span> <span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æŠ›å‡ºå¼‚å¸¸å£°æ˜ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">monitorTemperature</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token annotation punctuation">@Critical</span> <span class="token class-name">TemperatureException</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-188"><a class="markdownIt-Anchor" href="#-188">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_2-%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3">#</a>2. å†…ç½®æ³¨è§£</h2>
<p>JDK ä¸­å†…ç½®äº†ä»¥ä¸‹æ³¨è§£ï¼š</p>
<ul>
<li><code>@Override</code></li>
<li><code>@Deprecated</code></li>
<li><code>@SuppressWarnnings</code></li>
<li><code>@SafeVarargs</code> ï¼ˆJDK7 å¼•å…¥ï¼‰</li>
<li><code>@FunctionalInterface</code> ï¼ˆJDK8 å¼•å…¥ï¼‰</li>
</ul>
<h3 id="-189"><a class="markdownIt-Anchor" href="#-189">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_2-1-override">#</a>2.1. @Override</h3>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Override.html"> <code>@Override</code>  (opens new window)</a> ç”¨äºè¡¨æ˜è¢«ä¿®é¥°æ–¹æ³•è¦†å†™äº†çˆ¶ç±»çš„æ–¹æ³•ã€‚</strong></p>
<p>å¦‚æœè¯•å›¾ä½¿ç”¨  <code>@Override</code>  æ ‡è®°ä¸€ä¸ªå®é™…ä¸Šå¹¶æ²¡æœ‰è¦†å†™çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œjava ç¼–è¯‘å™¨ä¼šå‘Šè­¦ã€‚</p>
<p><code>@Override</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OverrideAnnotationDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"getName"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"override getName"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         *  æ”¾å¼€ä¸‹é¢çš„æ³¨é‡Šï¼Œç¼–è¯‘æ—¶ä¼šå‘Šè­¦
         */</span>
       <span class="token comment">/*
        @Override
        public String getName2() &#123;
            return "override getName2";
        &#125;
        */</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Person</span> per <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>per<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-190"><a class="markdownIt-Anchor" href="#-190">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_2-2-deprecated">#</a>2.2. @Deprecated</h3>
<p><strong> <code>@Deprecated</code>  ç”¨äºæ ‡æ˜è¢«ä¿®é¥°çš„ç±»æˆ–ç±»æˆå‘˜ã€ç±»æ–¹æ³•å·²ç»åºŸå¼ƒã€è¿‡æ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</strong></p>
<p><code>@Deprecated</code>  æœ‰ä¸€å®šçš„<strong>å»¶ç»­æ€§</strong>ï¼šå¦‚æœæˆ‘ä»¬åœ¨ä»£ç ä¸­é€šè¿‡ç»§æ‰¿æˆ–è€…è¦†ç›–çš„æ–¹å¼ä½¿ç”¨äº†è¿‡æ—¶çš„ç±»æˆ–ç±»æˆå‘˜ï¼Œå³ä½¿å­ç±»æˆ–å­æ–¹æ³•æ²¡æœ‰æ ‡è®°ä¸º  <code>@Deprecated</code> ï¼Œä½†ç¼–è¯‘å™¨ä»ç„¶ä¼šå‘Šè­¦ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š  <code>@Deprecated</code>  è¿™ä¸ªæ³¨è§£ç±»å‹å’Œ javadoc ä¸­çš„  <code>@deprecated</code>  è¿™ä¸ª tag æ˜¯æœ‰åŒºåˆ«çš„ï¼šå‰è€…æ˜¯ java ç¼–è¯‘å™¨è¯†åˆ«çš„ï¼›è€Œåè€…æ˜¯è¢« javadoc å·¥å…·æ‰€è¯†åˆ«ç”¨æ¥ç”Ÿæˆæ–‡æ¡£ï¼ˆåŒ…å«ç¨‹åºæˆå‘˜ä¸ºä»€ä¹ˆå·²ç»è¿‡æ—¶ã€å®ƒåº”å½“å¦‚ä½•è¢«ç¦æ­¢æˆ–è€…æ›¿ä»£çš„æè¿°ï¼‰ã€‚</p>
</blockquote>
<p><code>@Deprecated</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeprecatedAnnotationDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DeprecatedField</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Deprecated</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DEPRECATED_FIELD <span class="token operator">=</span> <span class="token string">"DeprecatedField"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DeprecatedMethod</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Deprecated</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"DeprecatedMethod"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>


    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DeprecatedClass</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"DeprecatedClass"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">DeprecatedField</span><span class="token punctuation">.</span>DEPRECATED_FIELD<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">DeprecatedMethod</span> dm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeprecatedMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dm<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">DeprecatedClass</span> dc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeprecatedClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//Output:</span>
<span class="token comment">//DeprecatedField</span>
<span class="token comment">//DeprecatedMethod</span>
<span class="token comment">//DeprecatedClass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-191"><a class="markdownIt-Anchor" href="#-191">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_2-3-suppresswarnnings">#</a>2.3. @SuppressWarnnings</h3>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/SuppressWarnings.html"> <code>@SuppressWarnings</code>  (opens new window)</a> ç”¨äºå…³é—­å¯¹ç±»ã€æ–¹æ³•ã€æˆå‘˜ç¼–è¯‘æ—¶äº§ç”Ÿçš„ç‰¹å®šè­¦å‘Šã€‚</strong></p>
<p><code>@SuppressWarning</code>  ä¸æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ã€‚å®ƒæœ‰ä¸€ä¸ªç±»å‹ä¸º  <code>String[]</code>  çš„æ•°ç»„æˆå‘˜ï¼Œè¿™ä¸ªæ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯è¦å…³é—­çš„å‘Šè­¦ç±»å‹ã€‚å¯¹äº javac ç¼–è¯‘å™¨æ¥è®²ï¼Œå¯¹  <code>-Xlint</code>  é€‰é¡¹æœ‰æ•ˆçš„è­¦å‘Šåä¹ŸåŒæ ·å¯¹  <code>@SuppressWarings</code>  æœ‰æ•ˆï¼ŒåŒæ—¶ç¼–è¯‘å™¨ä¼šå¿½ç•¥æ‰æ— æ³•è¯†åˆ«çš„è­¦å‘Šåã€‚</p>
<p><code>@SuppressWarning</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span> <span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SuppressWarningsAnnotationDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SuppressDemo</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">T</span> value<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">T</span> <span class="token keyword">var</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">var</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"deprecation"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SuppressDemo</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuppressDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        d<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"å—äº¬"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åœ°åï¼š"</span> <span class="token operator">+</span> d<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>@SuppressWarnings</code>  æ³¨è§£çš„å¸¸è§å‚æ•°å€¼çš„ç®€å•è¯´æ˜ï¼š</p>
<ul>
<li><code>deprecation</code>  - ä½¿ç”¨äº†ä¸èµæˆä½¿ç”¨çš„ç±»æˆ–æ–¹æ³•æ—¶çš„è­¦å‘Šï¼›</li>
<li><code>unchecked</code>  - æ‰§è¡Œäº†æœªæ£€æŸ¥çš„è½¬æ¢æ—¶çš„è­¦å‘Šï¼Œä¾‹å¦‚å½“ä½¿ç”¨é›†åˆæ—¶æ²¡æœ‰ç”¨æ³›å‹ (Generics) æ¥æŒ‡å®šé›†åˆä¿å­˜çš„ç±»å‹ï¼›</li>
<li><code>fallthrough</code>  - å½“ Switch ç¨‹åºå—ç›´æ¥é€šå¾€ä¸‹ä¸€ç§æƒ…å†µè€Œæ²¡æœ‰ Break æ—¶çš„è­¦å‘Šï¼›</li>
<li><code>path</code>  - åœ¨ç±»è·¯å¾„ã€æºæ–‡ä»¶è·¯å¾„ç­‰ä¸­æœ‰ä¸å­˜åœ¨çš„è·¯å¾„æ—¶çš„è­¦å‘Šï¼›</li>
<li><code>serial</code>  - å½“åœ¨å¯åºåˆ—åŒ–çš„ç±»ä¸Šç¼ºå°‘ serialVersionUID å®šä¹‰æ—¶çš„è­¦å‘Šï¼›</li>
<li><code>finally</code>  - ä»»ä½• finally å­å¥ä¸èƒ½æ­£å¸¸å®Œæˆæ—¶çš„è­¦å‘Šï¼›</li>
<li><code>all</code>  - æ‰€æœ‰çš„è­¦å‘Šã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"uncheck"</span><span class="token punctuation">,</span> <span class="token string">"deprecation"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InternalAnnotationDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">/**
     * @SuppressWarnings æ ‡è®°æ¶ˆé™¤å½“å‰ç±»çš„å‘Šè­¦ä¿¡æ¯
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"deprecation"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"call method1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * @Deprecated æ ‡è®°å½“å‰æ–¹æ³•ä¸ºåºŸå¼ƒæ–¹æ³•ï¼Œä¸å»ºè®®ä½¿ç”¨
         */</span>
        <span class="token annotation punctuation">@Deprecated</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"call method2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * @Deprecated æ ‡è®°å½“å‰ç±»ä¸ºåºŸå¼ƒç±»ï¼Œä¸å»ºè®®ä½¿ç”¨
     */</span>
    <span class="token annotation punctuation">@Deprecated</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/**
         * @Override æ ‡è®°æ˜¾ç¤ºæŒ‡æ˜å½“å‰æ–¹æ³•è¦†å†™äº†çˆ¶ç±»æˆ–æ¥å£çš„æ–¹æ³•
         */</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">A</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span><span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        obj<span class="token punctuation">.</span><span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-192"><a class="markdownIt-Anchor" href="#-192">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_2-4-safevarargs">#</a>2.4. @SafeVarargs</h3>
<p><code>@SafeVarargs</code>  åœ¨ JDK7 ä¸­å¼•å…¥ã€‚</p>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/SafeVarargs.html"> <code>@SafeVarargs</code>  (opens new window)</a> çš„ä½œç”¨æ˜¯ï¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œåœ¨å¯å˜é•¿å‚æ•°ä¸­çš„æ³›å‹æ˜¯ç±»å‹å®‰å…¨çš„ã€‚å¯å˜é•¿å‚æ•°æ˜¯ä½¿ç”¨æ•°ç»„å­˜å‚¨çš„ï¼Œè€Œæ•°ç»„å’Œæ³›å‹ä¸èƒ½å¾ˆå¥½çš„æ··åˆä½¿ç”¨ã€‚</strong></p>
<p>ç®€å•çš„è¯´ï¼Œæ•°ç»„å…ƒç´ çš„æ•°æ®ç±»å‹åœ¨ç¼–è¯‘å’Œè¿è¡Œæ—¶éƒ½æ˜¯ç¡®å®šçš„ï¼Œè€Œæ³›å‹çš„æ•°æ®ç±»å‹åªæœ‰åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šä¸‹æ¥ã€‚å› æ­¤ï¼Œå½“æŠŠä¸€ä¸ªæ³›å‹å­˜å‚¨åˆ°æ•°ç»„ä¸­æ—¶ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µæ— æ³•ç¡®è®¤æ•°æ®ç±»å‹æ˜¯å¦åŒ¹é…ï¼Œå› æ­¤ä¼šç»™å‡ºè­¦å‘Šä¿¡æ¯ï¼›å³å¦‚æœæ³›å‹çš„çœŸå®æ•°æ®ç±»å‹æ— æ³•å’Œå‚æ•°æ•°ç»„çš„ç±»å‹åŒ¹é…ï¼Œä¼šå¯¼è‡´  <code>ClassCastException</code>  å¼‚å¸¸ã€‚</p>
<p><code>@SafeVarargs</code>  æ³¨è§£ä½¿ç”¨èŒƒå›´ï¼š</p>
<ul>
<li><code>@SafeVarargs</code>  æ³¨è§£å¯ä»¥ç”¨äºæ„é€ æ–¹æ³•ã€‚</li>
<li><code>@SafeVarargs</code>  æ³¨è§£å¯ä»¥ç”¨äº  <code>static</code>  æˆ–  <code>final</code>  æ–¹æ³•ã€‚</li>
</ul>
<p><code>@SafeVarargs</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SafeVarargsAnnotationDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * æ­¤æ–¹æ³•å®é™…ä¸Šå¹¶ä¸å®‰å…¨ï¼Œä¸ä½¿ç”¨æ­¤æ³¨è§£ï¼Œç¼–è¯‘æ—¶ä¼šå‘Šè­¦
     */</span>
    <span class="token annotation punctuation">@SafeVarargs</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">wrongMethod</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> stringLists<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> stringLists<span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> tmpList <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmpList<span class="token punctuation">;</span> <span class="token comment">// è¯­æ³•é”™è¯¯ï¼Œä½†æ˜¯ç¼–è¯‘ä¸å‘Šè­¦</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> stringLists<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿è¡Œæ—¶æŠ¥ ClassCastException</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">wrongMethod</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»¥ä¸Šä»£ç ï¼Œå¦‚æœä¸ä½¿ç”¨  <code>@SafeVarargs</code>  ï¼Œç¼–è¯‘æ—¶ä¼šå‘Šè­¦</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">[WARNING] /D:/Codes/ZP/Java/javacore/codes/basics/src/main/java/io/github/dunwu/javacore/annotation/SafeVarargsAnnotationDemo.java: æŸäº›è¾“å…¥æ–‡ä»¶ä½¿ç”¨äº†æœªç»æ£€æŸ¥æˆ–ä¸å®‰å…¨çš„æ“ä½œã€‚
[WARNING] /D:/Codes/ZP/Java/javacore/codes/basics/src/main/java/io/github/dunwu/javacore/annotation/SafeVarargsAnnotationDemo.java: æœ‰å…³è¯¦ç»†ä¿¡æ¯, è¯·ä½¿ç”¨ -Xlint:unchecked é‡æ–°ç¼–è¯‘ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-193"><a class="markdownIt-Anchor" href="#-193">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_2-5-functionalinterface">#</a>2.5. @FunctionalInterface</h3>
<p><code>@FunctionalInterface</code>  åœ¨ JDK8 å¼•å…¥ã€‚</p>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/FunctionalInterface.html"> <code>@FunctionalInterface</code>  (opens new window)</a> ç”¨äºæŒ‡ç¤ºè¢«ä¿®é¥°çš„æ¥å£æ˜¯å‡½æ•°å¼æ¥å£ã€‚</strong></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ¥å£ç¬¦åˆ &quot;å‡½æ•°å¼æ¥å£&quot; å®šä¹‰ï¼Œä¸åŠ   <code>@FunctionalInterface</code>  ä¹Ÿæ²¡å…³ç³»ï¼›ä½†å¦‚æœç¼–å†™çš„ä¸æ˜¯å‡½æ•°å¼æ¥å£ï¼Œå´ä½¿ç”¨  <code>@FunctionInterface</code> ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p>
<p>ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£ï¼Ÿ</p>
<p><strong>å‡½æ•°å¼æ¥å£ (Functional Interface) å°±æ˜¯ä¸€ä¸ªæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•çš„æ¥å£</strong>ã€‚å‡½æ•°å¼æ¥å£å¯ä»¥è¢«éšå¼è½¬æ¢ä¸º lambda è¡¨è¾¾å¼ã€‚</p>
<p>å‡½æ•°å¼æ¥å£çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ¥å£æœ‰ä¸”åªèƒ½æœ‰ä¸ªä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆæŠ½è±¡æ–¹æ³•åªæœ‰æ–¹æ³•å®šä¹‰ï¼Œæ²¡æœ‰æ–¹æ³•ä½“ï¼‰ã€‚</li>
<li>ä¸èƒ½åœ¨æ¥å£ä¸­è¦†å†™ Object ç±»ä¸­çš„ public æ–¹æ³•ï¼ˆå†™äº†ç¼–è¯‘å™¨ä¹Ÿä¼šæŠ¥é”™ï¼‰ã€‚</li>
<li>å…è®¸æœ‰ default å®ç°æ–¹æ³•ã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FunctionalInterfaceAnnotationDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@FunctionalInterface</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Func1</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">void</span> <span class="token function">printMessage</span><span class="token punctuation">(</span><span class="token class-name">T</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * @FunctionalInterface ä¿®é¥°çš„æ¥å£ä¸­å®šä¹‰ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç¼–è¯‘æ—¶ä¼šæŠ¥é”™
     * @param &lt;T>
     */</span>
    <span class="token comment">/*@FunctionalInterface
    public interface Func2&lt;T> &#123;
        void printMessage(T message);
        void printMessage2(T message);
    &#125;*/</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Func1</span> func1 <span class="token operator">=</span> message <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        func1<span class="token punctuation">.</span><span class="token function">printMessage</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        func1<span class="token punctuation">.</span><span class="token function">printMessage</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-194"><a class="markdownIt-Anchor" href="#-194">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_3-%E5%85%83%E6%B3%A8%E8%A7%A3">#</a>3. å…ƒæ³¨è§£</h2>
<p>JDK ä¸­è™½ç„¶å†…ç½®äº†å‡ ä¸ªæ³¨è§£ï¼Œä½†è¿™è¿œè¿œä¸èƒ½æ»¡è¶³å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„åƒå˜ä¸‡åŒ–çš„éœ€æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰æ³¨è§£ï¼Œè€Œè¿™å°±éœ€è¦ç”¨åˆ°å…ƒæ³¨è§£ã€‚</p>
<p><strong>å…ƒæ³¨è§£çš„ä½œç”¨å°±æ˜¯ç”¨äºå®šä¹‰å…¶å®ƒçš„æ³¨è§£</strong>ã€‚</p>
<p>Java ä¸­æä¾›äº†ä»¥ä¸‹å…ƒæ³¨è§£ç±»å‹ï¼š</p>
<ul>
<li><code>@Retention</code></li>
<li><code>@Target</code></li>
<li><code>@Documented</code></li>
<li><code>@Inherited</code> ï¼ˆJDK8 å¼•å…¥ï¼‰</li>
<li><code>@Repeatable</code> ï¼ˆJDK8 å¼•å…¥ï¼‰</li>
</ul>
<p>è¿™äº›ç±»å‹å’Œå®ƒä»¬æ‰€æ”¯æŒçš„ç±»åœ¨  <code>java.lang.annotation</code>  åŒ…ä¸­å¯ä»¥æ‰¾åˆ°ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹æ¯ä¸ªå…ƒæ³¨è§£çš„ä½œç”¨å’Œç›¸åº”åˆ†å‚æ•°çš„ä½¿ç”¨è¯´æ˜ã€‚</p>
<h3 id="-195"><a class="markdownIt-Anchor" href="#-195">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_3-1-retention">#</a>3.1. @Retention</h3>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html"> <code>@Retention</code>  (opens new window)</a> æŒ‡æ˜äº†æ³¨è§£çš„ä¿ç•™çº§åˆ«ã€‚</strong></p>
<p><code>@Retention</code>  æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Retention</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">RetentionPolicy</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>RetentionPolicy</code>  æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®ƒå®šä¹‰äº†è¢«  <code>@Retention</code>  ä¿®é¥°çš„æ³¨è§£æ‰€æ”¯æŒçš„ä¿ç•™çº§åˆ«ï¼š</p>
<ul>
<li><code>RetentionPolicy.SOURCE</code>  - æ ‡è®°çš„æ³¨è§£ä»…åœ¨æºæ–‡ä»¶ä¸­æœ‰æ•ˆï¼Œç¼–è¯‘å™¨ä¼šå¿½ç•¥ã€‚</li>
<li><code>RetentionPolicy.CLASS</code>  - æ ‡è®°çš„æ³¨è§£åœ¨ class æ–‡ä»¶ä¸­æœ‰æ•ˆï¼ŒJVM ä¼šå¿½ç•¥ã€‚</li>
<li><code>RetentionPolicy.RUNTIME</code>  - æ ‡è®°çš„æ³¨è§£åœ¨è¿è¡Œæ—¶æœ‰æ•ˆã€‚</li>
</ul>
<p><code>@Retention</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Column</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"fieldName"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">setFuncName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"setField"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFuncName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"getField"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">defaultDBValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-196"><a class="markdownIt-Anchor" href="#-196">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_3-2-documented">#</a>3.2. @Documented</h3>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Documented.html"> <code>@Documented</code>  (opens new window)</a> è¡¨ç¤ºæ— è®ºä½•æ—¶ä½¿ç”¨æŒ‡å®šçš„æ³¨è§£ï¼Œéƒ½åº”ä½¿ç”¨ Javadocï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œæ³¨é‡Šä¸åŒ…å«åœ¨ Javadoc ä¸­ï¼‰ã€‚æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/technotes/guides/javadoc/index.html">Javadoc tools page (opens new window)</a>ã€‚</p>
<p><code>@Documented</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Column</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"fieldName"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">setFuncName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"setField"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFuncName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"getField"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">defaultDBValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-197"><a class="markdownIt-Anchor" href="#-197">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_3-3-target">#</a>3.3. @Target</h3>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html"> <code>@Target</code>  (opens new window)</a> æŒ‡å®šæ³¨è§£å¯ä»¥ä¿®é¥°çš„å…ƒç´ ç±»å‹ã€‚</strong></p>
<p><code>@Target</code>  æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Target</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ElementType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ElementType</code>  æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼Œå®ƒå®šä¹‰äº†è¢«  <code>@Target</code>  ä¿®é¥°çš„æ³¨è§£å¯ä»¥åº”ç”¨çš„èŒƒå›´ï¼š</p>
<ul>
<li><code>ElementType.ANNOTATION_TYPE</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ³¨è§£ç±»å‹ã€‚</li>
<li><code>ElementType.CONSTRUCTOR</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ„é€ å‡½æ•°ã€‚</li>
<li><code>ElementType.FIELD</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºå­—æ®µæˆ–å±æ€§ã€‚</li>
<li><code>ElementType.LOCAL_VARIABLE</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºå±€éƒ¨å˜é‡ã€‚</li>
<li><code>ElementType.METHOD</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ–¹æ³•ã€‚</li>
<li><code>ElementType.PACKAGE</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºåŒ…å£°æ˜ã€‚</li>
<li><code>ElementType.PARAMETER</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºæ–¹æ³•çš„å‚æ•°ã€‚</li>
<li><code>ElementType.TYPE</code>  - æ ‡è®°çš„æ³¨è§£å¯ä»¥åº”ç”¨äºç±»çš„ä»»ä½•å…ƒç´ ã€‚</li>
</ul>
<p><code>@Target</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Table</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * æ•°æ®è¡¨åç§°æ³¨è§£ï¼Œé»˜è®¤å€¼ä¸ºç±»åç§°
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">tableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"className"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">NoDBColumn</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-198"><a class="markdownIt-Anchor" href="#-198">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_3-4-inherited">#</a>3.4. @Inherited</h3>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Inherited.html"> <code>@Inherited</code>  (opens new window)</a> è¡¨ç¤ºæ³¨è§£ç±»å‹å¯ä»¥è¢«ç»§æ‰¿ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸æ˜¯è¿™æ ·ï¼‰</strong>ã€‚</p>
<p>è¡¨ç¤ºè‡ªåŠ¨ç»§æ‰¿æ³¨è§£ç±»å‹ã€‚ å¦‚æœæ³¨è§£ç±»å‹å£°æ˜ä¸­å­˜åœ¨  <code>@Inherited</code>  å…ƒæ³¨è§£ï¼Œåˆ™æ³¨è§£æ‰€ä¿®é¥°ç±»çš„æ‰€æœ‰å­ç±»éƒ½å°†ä¼šç»§æ‰¿æ­¤æ³¨è§£ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š <code>@Inherited</code>  æ³¨è§£ç±»å‹æ˜¯è¢«æ ‡æ³¨è¿‡çš„ç±»çš„å­ç±»æ‰€ç»§æ‰¿ã€‚ç±»å¹¶ä¸ä»å®ƒæ‰€å®ç°çš„æ¥å£ç»§æ‰¿æ³¨è§£ï¼Œæ–¹æ³•å¹¶ä¸ä»å®ƒæ‰€è¦†å†™çš„æ–¹æ³•ç»§æ‰¿æ³¨è§£ã€‚</p>
<p>æ­¤å¤–ï¼Œå½“  <code>@Inherited</code>  ç±»å‹æ ‡æ³¨çš„æ³¨è§£çš„  <code>@Retention</code>  æ˜¯  <code>RetentionPolicy.RUNTIME</code> ï¼Œåˆ™åå°„ API å¢å¼ºäº†è¿™ç§ç»§æ‰¿æ€§ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨  <code>java.lang.reflect</code>  å»æŸ¥è¯¢ä¸€ä¸ª  <code>@Inherited</code>  ç±»å‹çš„æ³¨è§£æ—¶ï¼Œåå°„ä»£ç æ£€æŸ¥å°†å±•å¼€å·¥ä½œï¼šæ£€æŸ¥ç±»å’Œå…¶çˆ¶ç±»ï¼Œç›´åˆ°å‘ç°æŒ‡å®šçš„æ³¨è§£ç±»å‹è¢«å‘ç°ï¼Œæˆ–è€…åˆ°è¾¾ç±»ç»§æ‰¿ç»“æ„çš„é¡¶å±‚ã€‚</p>
</blockquote>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Inherited</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Greeting</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">FontColor</span><span class="token punctuation">&#123;</span> BULE<span class="token punctuation">,</span>RED<span class="token punctuation">,</span>GREEN<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">FontColor</span> <span class="token function">fontColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">FontColor</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-199"><a class="markdownIt-Anchor" href="#-199">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_3-5-repeatable">#</a>3.5. @Repeatable</h3>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Repeatable.html"> <code>@Repeatable</code>  (opens new window)</a> è¡¨ç¤ºæ³¨è§£å¯ä»¥é‡å¤ä½¿ç”¨ã€‚</strong></p>
<p>ä»¥ Spring  <code>@Scheduled</code>  ä¸ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Schedules</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Scheduled</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>ANNOTATION_TYPE<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">Schedules</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Scheduled</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åº”ç”¨ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskRunner</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span><span class="token string">"0 0/15 * * * ?"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Scheduled</span><span class="token punctuation">(</span><span class="token string">"0 0 12 * ?"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">task1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-200"><a class="markdownIt-Anchor" href="#-200">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_4-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3">#</a>4. è‡ªå®šä¹‰æ³¨è§£</h2>
<p>ä½¿ç”¨  <code>@interface</code>  è‡ªå®šä¹‰æ³¨è§£æ—¶ï¼Œè‡ªåŠ¨ç»§æ‰¿äº†  <code>java.lang.annotation.Annotation</code>  æ¥å£ï¼Œç”±ç¼–è¯‘ç¨‹åºè‡ªåŠ¨å®Œæˆå…¶ä»–ç»†èŠ‚ã€‚åœ¨å®šä¹‰æ³¨è§£æ—¶ï¼Œä¸èƒ½ç»§æ‰¿å…¶ä»–çš„æ³¨è§£æˆ–æ¥å£ã€‚ <code>@interface</code>  ç”¨æ¥å£°æ˜ä¸€ä¸ªæ³¨è§£ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªæ–¹æ³•å®é™…ä¸Šæ˜¯å£°æ˜äº†ä¸€ä¸ªé…ç½®å‚æ•°ã€‚æ–¹æ³•çš„åç§°å°±æ˜¯å‚æ•°çš„åç§°ï¼Œè¿”å›å€¼ç±»å‹å°±æ˜¯å‚æ•°çš„ç±»å‹ï¼ˆè¿”å›å€¼ç±»å‹åªèƒ½æ˜¯åŸºæœ¬ç±»å‹ã€Classã€Stringã€enumï¼‰ã€‚å¯ä»¥é€šè¿‡  <code>default</code>  æ¥å£°æ˜å‚æ•°çš„é»˜è®¤å€¼ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä¼šé€šè¿‡å®ç°ä¸€ä¸ªåä¸º  <code>RegexValid</code>  çš„æ­£åˆ™æ ¡éªŒæ³¨è§£å·¥å…·æ¥å±•ç¤ºè‡ªå®šä¹‰æ³¨è§£çš„å…¨æ­¥éª¤ã€‚</p>
<h3 id="-201"><a class="markdownIt-Anchor" href="#-201">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_4-1-%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%AE%9A%E4%B9%89">#</a>4.1. æ³¨è§£çš„å®šä¹‰</h3>
<p>æ³¨è§£çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> æ³¨è§£å <span class="token punctuation">&#123;</span>å®šä¹‰ä½“<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>PARAMETER<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">RegexValid</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<p>é€šè¿‡ä¸Šä¸€èŠ‚å¯¹äºå…ƒæ³¨è§£ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#target"> <code>@Target</code> </a>ã€<a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#retention"> <code>@Retention</code> </a>ã€<a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#documented"> <code>@Documented</code> </a> çš„è¯´æ˜ï¼Œè¿™é‡Œå°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚</p>
<ul>
<li>ä¸Šé¢çš„ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º  <code>@RegexValid</code>  çš„æ³¨è§£ã€‚</li>
<li><code>@Documented</code>  è¡¨ç¤º  <code>@RegexValid</code>  åº”è¯¥ä½¿ç”¨ javadocã€‚</li>
<li><code>@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</code>  è¡¨ç¤º  <code>@RegexValid</code>  å¯ä»¥åœ¨ç±»æˆå‘˜æˆ–æ–¹æ³•å‚æ•°ä¸Šä¿®é¥°ã€‚</li>
<li>@Retention (RetentionPolicy.RUNTIME) è¡¨ç¤º  <code>@RegexValid</code>  åœ¨è¿è¡Œæ—¶æœ‰æ•ˆã€‚</li>
</ul>
</blockquote>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å±æ€§çš„æ³¨è§£ï¼Œå¦‚æœåˆ°æ­¤ä¸ºæ­¢ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ã€‚ä½œä¸ºæ­£åˆ™å·¥å…·ï¼Œæ²¡æœ‰å±æ€§å¯ä»€ä¹ˆä¹Ÿåšä¸äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸ºå®ƒæ·»åŠ æ³¨è§£å±æ€§ã€‚</p>
<h3 id="-202"><a class="markdownIt-Anchor" href="#-202">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_4-2-%E6%B3%A8%E8%A7%A3%E5%B1%9E%E6%80%A7">#</a>4.2. æ³¨è§£å±æ€§</h3>
<p>æ³¨è§£å±æ€§çš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">[è®¿é—®çº§åˆ«ä¿®é¥°ç¬¦] [æ•°æ®ç±»å‹] åç§°() default é»˜è®¤å€¼;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å®šä¹‰åœ¨æ³¨è§£ä¸­å®šä¹‰ä¸€ä¸ªåä¸º value çš„å­—ç¬¦ä¸²å±æ€§ï¼Œå…¶é»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè®¿é—®çº§åˆ«ä¸ºé»˜è®¤çº§åˆ«ï¼Œé‚£ä¹ˆåº”è¯¥å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">String value() default "";<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š<strong>åœ¨æ³¨è§£ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰å±æ€§æ—¶ï¼Œå±æ€§ååé¢éœ€è¦åŠ   <code>()</code> </strong>ã€‚</p>
</blockquote>
<p>å®šä¹‰æ³¨è§£å±æ€§æœ‰ä»¥ä¸‹è¦ç‚¹ï¼š</p>
<ul>
<li><strong>æ³¨è§£å±æ€§åªèƒ½ä½¿ç”¨  <code>public</code>  æˆ–é»˜è®¤è®¿é—®çº§åˆ«ï¼ˆå³ä¸æŒ‡å®šè®¿é—®çº§åˆ«ä¿®é¥°ç¬¦ï¼‰ä¿®é¥°</strong>ã€‚</li>
<li><strong>æ³¨è§£å±æ€§çš„æ•°æ®ç±»å‹æœ‰é™åˆ¶è¦æ±‚</strong>ã€‚æ”¯æŒçš„æ•°æ®ç±»å‹å¦‚ä¸‹ï¼š
<ul>
<li>æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbyteã€charã€shortã€intã€longã€floatã€doubleã€booleanï¼‰</li>
<li>String ç±»å‹</li>
<li>Class ç±»</li>
<li>enum ç±»å‹</li>
<li>Annotation ç±»å‹</li>
<li>ä»¥ä¸Šæ‰€æœ‰ç±»å‹çš„æ•°ç»„</li>
</ul>
</li>
<li><strong>æ³¨è§£å±æ€§å¿…é¡»æœ‰ç¡®å®šçš„å€¼ï¼Œå»ºè®®æŒ‡å®šé»˜è®¤å€¼</strong>ã€‚æ³¨è§£å±æ€§åªèƒ½é€šè¿‡æŒ‡å®šé»˜è®¤å€¼æˆ–ä½¿ç”¨æ³¨è§£æ—¶æŒ‡å®šå±æ€§å€¼ï¼Œç›¸è¾ƒä¹‹ä¸‹ï¼ŒæŒ‡å®šé»˜è®¤å€¼çš„æ–¹å¼æ›´ä¸ºå¯é ã€‚æ³¨è§£å±æ€§å¦‚æœæ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸å¯ä»¥ä¸º nullã€‚è¿™ä¸ªçº¦æŸä½¿å¾—æ³¨è§£å¤„ç†å™¨å¾ˆéš¾åˆ¤æ–­æ³¨è§£å±æ€§æ˜¯é»˜è®¤å€¼ï¼Œæˆ–æ˜¯ä½¿ç”¨æ³¨è§£æ—¶æ‰€æŒ‡å®šçš„å±æ€§å€¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è®¾ç½®é»˜è®¤å€¼æ—¶ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ä¸€äº›ç‰¹æ®Šçš„å€¼ï¼Œä¾‹å¦‚ç©ºå­—ç¬¦ä¸²æˆ–è€…è´Ÿæ•°ã€‚</li>
<li>å¦‚æœæ³¨è§£ä¸­åªæœ‰ä¸€ä¸ªå±æ€§å€¼ï¼Œæœ€å¥½å°†å…¶å‘½åä¸º valueã€‚å› ä¸ºï¼ŒæŒ‡å®šå±æ€§åä¸º valueï¼Œåœ¨ä½¿ç”¨æ³¨è§£æ—¶ï¼ŒæŒ‡å®š value çš„å€¼å¯ä»¥ä¸æŒ‡å®šå±æ€§åç§°ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è¿™ä¸¤ç§æ–¹å¼æ•ˆæœç›¸åŒ</span>
<span class="token annotation punctuation">@RegexValid</span><span class="token punctuation">(</span><span class="token string">"^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d&#123;8&#125;$"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RegexValid</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d&#123;8&#125;$"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<p>äº†è§£äº†æ³¨è§£å±æ€§çš„å®šä¹‰è¦ç‚¹ï¼Œè®©æˆ‘ä»¬æ¥ä¸º  <code>@RegexValid</code>  æ³¨è§£å®šä¹‰å‡ ä¸ªå±æ€§ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>PARAMETER<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">RegexValid</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">enum</span> <span class="token class-name">Policy</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// @formatter:off</span>
        <span class="token function">EMPTY</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">DATE</span><span class="token punctuation">(</span><span class="token string">"^(?:(?!0000)[0-9]&#123;4&#125;([-/.]?)(?:(?:0?[1-9]|1[0-2])\\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\\1"</span>
            <span class="token operator">+</span> <span class="token string">"(?:29|30)|(?:0?[13578]|1[02])\\1(?:31))|(?:[0-9]&#123;2&#125;(?:0[48]|[2468][048]|[13579][26])|"</span>
            <span class="token operator">+</span> <span class="token string">"(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\\2(?:29))$"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">MAIL</span><span class="token punctuation">(</span><span class="token string">"^[A-Za-z0-9](([_\\.\\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\\.\\-]?[a-zA-Z0-9]+)*)\\.([A-Za-z]&#123;2,&#125;)$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// @formatter:on</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> policy<span class="token punctuation">;</span>

        <span class="token class-name">Policy</span><span class="token punctuation">(</span><span class="token class-name">String</span> policy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>policy <span class="token operator">=</span> policy<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> policy<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token class-name">Policy</span> <span class="token function">policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">Policy</span><span class="token punctuation">.</span>EMPTY<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªæ³¨è§£å±æ€§ï¼š <code>String</code>  ç±»å‹çš„ value å±æ€§å’Œ  <code>Policy</code>  æšä¸¾ç±»å‹çš„ policy å±æ€§ã€‚ <code>Policy</code>  æšä¸¾ä¸­å®šä¹‰äº†å‡ ä¸ªé»˜è®¤çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™æ˜¯ä¸ºäº†ç›´æ¥ä½¿ç”¨è¿™å‡ ä¸ªå¸¸ç”¨è¡¨è¾¾å¼å»æ­£åˆ™æ ¡éªŒã€‚è€ƒè™‘åˆ°ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è‡ªå·±ä¼ å…¥ä¸€äº›è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼å»æ ¡éªŒå…¶ä»–åœºæ™¯ï¼Œæ‰€ä»¥å®šä¹‰äº† value å±æ€§ï¼Œå…è®¸ä½¿ç”¨è€…ä¼ å…¥æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
</blockquote>
<p>è‡³æ­¤ï¼Œ <code>@RegexValid</code>  çš„å£°æ˜å·²ç»ç»“æŸã€‚ä½†æ˜¯ï¼Œç¨‹åºä»ä¸çŸ¥é“å¦‚ä½•å¤„ç†  <code>@RegexValid</code>  è¿™ä¸ªæ³¨è§£ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰æ³¨è§£å¤„ç†å™¨ã€‚</p>
<h3 id="-203"><a class="markdownIt-Anchor" href="#-203">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_4-3-%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8">#</a>4.3. æ³¨è§£å¤„ç†å™¨</h3>
<p>å¦‚æœæ²¡æœ‰ç”¨æ¥è¯»å–æ³¨è§£çš„æ–¹æ³•å’Œå·¥ä½œï¼Œé‚£ä¹ˆæ³¨è§£ä¹Ÿå°±ä¸ä¼šæ¯”æ³¨é‡Šæ›´æœ‰ç”¨å¤„äº†ã€‚ä½¿ç”¨æ³¨è§£çš„è¿‡ç¨‹ä¸­ï¼Œå¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†å°±æ˜¯åˆ›å»ºäºä½¿ç”¨æ³¨è§£å¤„ç†å™¨ã€‚JDK5 æ‰©å±•äº†åå°„æœºåˆ¶çš„ APIï¼Œä»¥å¸®åŠ©ç¨‹åºå‘˜å¿«é€Ÿçš„æ„é€ è‡ªå®šä¹‰æ³¨è§£å¤„ç†å™¨ã€‚</p>
<p><strong> <code>java.lang.annotation.Annotation</code>  æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç¨‹åºå¯ä»¥é€šè¿‡åå°„æ¥è·å–æŒ‡å®šç¨‹åºå…ƒç´ çš„æ³¨è§£å¯¹è±¡ï¼Œç„¶åé€šè¿‡æ³¨è§£å¯¹è±¡æ¥è·å–æ³¨è§£é‡Œé¢çš„å…ƒæ•°æ®</strong>ã€‚</p>
<p><code>Annotation</code>  æ¥å£æºç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Annotation</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">></span></span> <span class="token function">annotationType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒJava ä¸­æ”¯æŒ<strong>æ³¨è§£å¤„ç†å™¨æ¥å£  <code>java.lang.reflect.AnnotatedElement</code> </strong> ï¼Œè¯¥æ¥å£ä»£è¡¨ç¨‹åºä¸­å¯ä»¥æ¥å—æ³¨è§£çš„ç¨‹åºå…ƒç´ ï¼Œè¯¥æ¥å£ä¸»è¦æœ‰å¦‚ä¸‹å‡ ä¸ªå®ç°ç±»ï¼š</p>
<ul>
<li><code>Class</code>  - ç±»å®šä¹‰</li>
<li><code>Constructor</code>  - æ„é€ å™¨å®šä¹‰</li>
<li><code>Field</code>  - ç´¯çš„æˆå‘˜å˜é‡å®šä¹‰</li>
<li><code>Method</code>  - ç±»çš„æ–¹æ³•å®šä¹‰</li>
<li><code>Package</code>  - ç±»çš„åŒ…å®šä¹‰</li>
</ul>
<p><code>java.lang.reflect</code>  åŒ…ä¸‹ä¸»è¦åŒ…å«ä¸€äº›å®ç°åå°„åŠŸèƒ½çš„å·¥å…·ç±»ã€‚å®é™…ä¸Šï¼Œ <code>java.lang.reflect</code>  åŒ…æ‰€æœ‰æä¾›çš„åå°„ API æ‰©å……äº†è¯»å–è¿è¡Œæ—¶æ³¨è§£ä¿¡æ¯çš„èƒ½åŠ›ã€‚å½“ä¸€ä¸ªæ³¨è§£ç±»å‹è¢«å®šä¹‰ä¸ºè¿è¡Œæ—¶çš„æ³¨è§£åï¼Œè¯¥æ³¨è§£æ‰èƒ½æ˜¯è¿è¡Œæ—¶å¯è§ï¼Œå½“ class æ–‡ä»¶è¢«è£…è½½æ—¶è¢«ä¿å­˜åœ¨ class æ–‡ä»¶ä¸­çš„æ³¨è§£æ‰ä¼šè¢«è™šæ‹Ÿæœºè¯»å–ã€‚  <code>AnnotatedElement</code>  æ¥å£æ˜¯æ‰€æœ‰ç¨‹åºå…ƒç´ ï¼ˆClassã€Method å’Œ Constructorï¼‰çš„çˆ¶æ¥å£ï¼Œæ‰€ä»¥ç¨‹åºé€šè¿‡åå°„è·å–äº†æŸä¸ªç±»çš„ <code>AnnotatedElement</code>  å¯¹è±¡ä¹‹åï¼Œç¨‹åºå°±å¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡çš„å¦‚ä¸‹å››ä¸ªä¸ªæ–¹æ³•æ¥è®¿é—®æ³¨è§£ä¿¡æ¯ï¼š</p>
<ul>
<li><code>getAnnotation</code>  - è¿”å›è¯¥ç¨‹åºå…ƒç´ ä¸Šå­˜åœ¨çš„ã€æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œå¦‚æœè¯¥ç±»å‹æ³¨è§£ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› nullã€‚</li>
<li><code>getAnnotations</code>  - è¿”å›è¯¥ç¨‹åºå…ƒç´ ä¸Šå­˜åœ¨çš„æ‰€æœ‰æ³¨è§£ã€‚</li>
<li><code>isAnnotationPresent</code>  - åˆ¤æ–­è¯¥ç¨‹åºå…ƒç´ ä¸Šæ˜¯å¦åŒ…å«æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œå­˜åœ¨åˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</li>
<li><code>getDeclaredAnnotations</code>  - è¿”å›ç›´æ¥å­˜åœ¨äºæ­¤å…ƒç´ ä¸Šçš„æ‰€æœ‰æ³¨é‡Šã€‚ä¸æ­¤æ¥å£ä¸­çš„å…¶ä»–æ–¹æ³•ä¸åŒï¼Œè¯¥æ–¹æ³•å°†å¿½ç•¥ç»§æ‰¿çš„æ³¨é‡Šã€‚ï¼ˆå¦‚æœæ²¡æœ‰æ³¨é‡Šç›´æ¥å­˜åœ¨äºæ­¤å…ƒç´ ä¸Šï¼Œåˆ™è¿”å›é•¿åº¦ä¸ºé›¶çš„ä¸€ä¸ªæ•°ç»„ã€‚ï¼‰è¯¥æ–¹æ³•çš„è°ƒç”¨è€…å¯ä»¥éšæ„ä¿®æ”¹è¿”å›çš„æ•°ç»„ï¼›è¿™ä¸ä¼šå¯¹å…¶ä»–è°ƒç”¨è€…è¿”å›çš„æ•°ç»„äº§ç”Ÿä»»ä½•å½±å“ã€‚</li>
</ul>
<p>äº†è§£äº†ä»¥ä¸Šå†…å®¹ï¼Œè®©æˆ‘ä»¬æ¥å®ç°  <code>@RegexValid</code>  çš„æ³¨è§£å¤„ç†å™¨ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Matcher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>regex<span class="token punctuation">.</span></span><span class="token class-name">Pattern</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegexValidUtil</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fields<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// åˆ¤æ–­æˆå‘˜æ˜¯å¦è¢« @RegexValid æ³¨è§£æ‰€ä¿®é¥°</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">RegexValid</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">RegexValid</span> valid <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">RegexValid</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// å¦‚æœ value ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè¯´æ˜æ²¡æœ‰æ³¨å…¥è‡ªå®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ”¹ç”¨ policy å±æ€§</span>
                <span class="token class-name">String</span> value <span class="token operator">=</span> valid<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">RegexValid<span class="token punctuation">.</span>Policy</span> policy <span class="token operator">=</span> valid<span class="token punctuation">.</span><span class="token function">policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    value <span class="token operator">=</span> policy<span class="token punctuation">.</span><span class="token function">getPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                <span class="token comment">// é€šè¿‡è®¾ç½® setAccessible(true) æ¥è®¿é—®ç§æœ‰æˆå‘˜</span>
                field<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> fieldObj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    fieldObj <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>fieldObj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s ç±»ä¸­çš„ %s å­—æ®µä¸èƒ½ä¸ºç©ºï¼"</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fieldObj <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> fieldObj<span class="token punctuation">;</span>
                        <span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        result <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s ä¸æ˜¯åˆæ³•çš„ %s ï¼"</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>
                            <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s ç±»ä¸­çš„ %s å­—æ®µä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸èƒ½ä½¿ç”¨æ­¤æ³¨è§£æ ¡éªŒï¼"</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<p>ä»¥ä¸Šç¤ºä¾‹ä¸­çš„æ³¨è§£å¤„ç†å™¨ï¼Œæ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€šè¿‡ getDeclaredFields åå°„æ–¹æ³•è·å–ä¼ å…¥å¯¹è±¡çš„æ‰€æœ‰æˆå‘˜ã€‚</li>
<li>éå†æˆå‘˜ï¼Œä½¿ç”¨ isAnnotationPresent åˆ¤æ–­æˆå‘˜æ˜¯å¦è¢«æŒ‡å®šæ³¨è§£æ‰€ä¿®é¥°ï¼Œå¦‚æœä¸æ˜¯ï¼Œç›´æ¥è·³è¿‡ã€‚</li>
<li>å¦‚æœæˆå‘˜è¢«æ³¨è§£æ‰€ä¿®é¥°ï¼Œé€šè¿‡  <code>RegexValid valid = field.getAnnotation(RegexValid.class);</code>  è¿™æ ·çš„å½¢å¼è·å–ï¼Œæ³¨è§£å®ä¾‹åŒ–å¯¹è±¡ï¼Œç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨  <code>valid.value()</code>  æˆ–  <code>valid.policy()</code>  è¿™æ ·çš„å½¢å¼è·å–æ³¨è§£ä¸­è®¾å®šçš„å±æ€§å€¼ã€‚</li>
<li>æ ¹æ®å±æ€§å€¼ï¼Œè¿›è¡Œé€»è¾‘å¤„ç†ã€‚</li>
</ol>
</blockquote>
<h3 id="-204"><a class="markdownIt-Anchor" href="#-204">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_4-4-%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3">#</a>4.4. ä½¿ç”¨æ³¨è§£</h3>
<p>å®Œæˆäº†ä»¥ä¸Šå·¥ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RegexValidDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@RegexValid</span><span class="token punctuation">(</span>policy <span class="token operator">=</span> <span class="token class-name">RegexValid<span class="token punctuation">.</span>Policy</span><span class="token punctuation">.</span>DATE<span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> date<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@RegexValid</span><span class="token punctuation">(</span>policy <span class="token operator">=</span> <span class="token class-name">RegexValid<span class="token punctuation">.</span>Policy</span><span class="token punctuation">.</span>MAIL<span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> mail<span class="token punctuation">;</span>
        <span class="token annotation punctuation">@RegexValid</span><span class="token punctuation">(</span><span class="token string">"^((\\+)?86\\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\\d&#123;8&#125;$"</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> date<span class="token punctuation">,</span> <span class="token class-name">String</span> mail<span class="token punctuation">,</span> <span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>date <span class="token operator">=</span> date<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mail <span class="token operator">=</span> mail<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"User&#123;"</span> <span class="token operator">+</span> <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span> <span class="token string">", date='"</span> <span class="token operator">+</span> date <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span> <span class="token string">", mail='"</span> <span class="token operator">+</span> mail <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span> <span class="token string">", phone='"</span>
                <span class="token operator">+</span> phone <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printDate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RegexValid</span><span class="token punctuation">(</span>policy <span class="token operator">=</span> <span class="token class-name">RegexValid<span class="token punctuation">.</span>Policy</span><span class="token punctuation">.</span>DATE<span class="token punctuation">)</span> <span class="token class-name">String</span> date<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token string">"1990-01-31"</span><span class="token punctuation">,</span> <span class="token string">"xxx@163.com"</span><span class="token punctuation">,</span> <span class="token string">"18612341234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token string">"2019-02-29"</span><span class="token punctuation">,</span> <span class="token string">"sadhgs"</span><span class="token punctuation">,</span> <span class="token string">"183xxxxxxxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">RegexValidUtil</span><span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user <span class="token operator">+</span> <span class="token string">"æ­£åˆ™æ ¡éªŒé€šè¿‡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">RegexValidUtil</span><span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2 <span class="token operator">+</span> <span class="token string">"æ­£åˆ™æ ¡éªŒé€šè¿‡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-205"><a class="markdownIt-Anchor" href="#-205">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/basics/java-annotation.html#_5-%E5%B0%8F%E7%BB%93">#</a>5. å°ç»“</h2>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E6%B3%A8%E8%A7%A3%E7%AE%80%E4%BB%8B.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E5%85%83%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/xmind/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3.svg" alt="img"></p>
<hr>
<h1 id="java-æ­£åˆ™ä»å…¥é—¨åˆ°ç²¾é€š"><a class="markdownIt-Anchor" href="#java-æ­£åˆ™ä»å…¥é—¨åˆ°ç²¾é€š">#</a> Java æ­£åˆ™ä»å…¥é—¨åˆ°ç²¾é€š</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>å…³é”®è¯ï¼šPatternã€Matcherã€æ•è·ä¸éæ•è·ã€åå‘å¼•ç”¨ã€é›¶å®½æ–­è¨€ã€è´ªå©ªä¸æ‡’æƒ°ã€å…ƒå­—ç¬¦ã€DFAã€NFA</p>
</blockquote>
<ul>
<li>\1. æ­£åˆ™ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#11-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%98%AF%E4%BB%80%E4%B9%88">1.1. æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#12-%E5%A6%82%E4%BD%95%E5%AD%A6%E4%B9%A0%E6%AD%A3%E5%88%99">1.2. å¦‚ä½•å­¦ä¹ æ­£åˆ™</a></li>
</ul>
</li>
<li>\2. æ­£åˆ™å·¥å…·ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#21-pattern-%E7%B1%BB">2.1. Pattern ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#22-matcher-%E7%B1%BB">2.2. Matcher ç±»</a></li>
</ul>
</li>
<li>\3. å…ƒå­—ç¬¦
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#31-%E5%9F%BA%E6%9C%AC%E5%85%83%E5%AD%97%E7%AC%A6">3.1. åŸºæœ¬å…ƒå­—ç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#32-%E7%AD%89%E4%BB%B7%E5%AD%97%E7%AC%A6">3.2. ç­‰ä»·å­—ç¬¦</a></li>
</ul>
</li>
<li>\4. åˆ†ç»„æ„é€ 
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#41-%E6%8D%95%E8%8E%B7%E4%B8%8E%E9%9D%9E%E6%8D%95%E8%8E%B7">4.1. æ•è·ä¸éæ•è·</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#42-%E5%8F%8D%E5%90%91%E5%BC%95%E7%94%A8">4.2. åå‘å¼•ç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#43-%E9%9D%9E%E6%8D%95%E8%8E%B7%E7%BB%84">4.3. éæ•è·ç»„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#44-%E9%9B%B6%E5%AE%BD%E6%96%AD%E8%A8%80">4.4. é›¶å®½æ–­è¨€</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#5-%E8%B4%AA%E5%A9%AA%E4%B8%8E%E6%87%92%E6%83%B0">5. è´ªå©ªä¸æ‡’æƒ°</a></li>
<li>\6. æ­£åˆ™é™„å½•
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#61-%E5%8C%B9%E9%85%8D%E6%AD%A3%E5%88%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%96%B9%E6%B3%95">6.1. åŒ¹é…æ­£åˆ™å­—ç¬¦ä¸²çš„æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#62-%E9%80%9F%E6%9F%A5%E5%85%83%E5%AD%97%E7%AC%A6%E5%AD%97%E5%85%B8">6.2. é€ŸæŸ¥å…ƒå­—ç¬¦å­—å…¸</a></li>
</ul>
</li>
<li>\7. æ­£åˆ™å®æˆ˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#71-%E6%9C%80%E5%AE%9E%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99">7.1. æœ€å®ç”¨çš„æ­£åˆ™</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#72-%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6">7.2. ç‰¹å®šå­—ç¬¦</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#73-%E7%89%B9%E5%AE%9A%E6%95%B0%E5%AD%97">7.3. ç‰¹å®šæ•°å­—</a></li>
</ul>
</li>
<li>\8. æ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#81-nfa-%E8%87%AA%E5%8A%A8%E6%9C%BA%E7%9A%84%E5%9B%9E%E6%BA%AF">8.1. NFA è‡ªåŠ¨æœºçš„å›æº¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#82-%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%9B%9E%E6%BA%AF">8.2. å¦‚ä½•é¿å…å›æº¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#83-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E4%BC%98%E5%8C%96">8.3. æ­£åˆ™è¡¨è¾¾å¼çš„ä¼˜åŒ–</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#9-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">9. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-206"><a class="markdownIt-Anchor" href="#-206">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_1-%E6%AD%A3%E5%88%99%E7%AE%80%E4%BB%8B">#</a>1. æ­£åˆ™ç®€ä»‹</h2>
<h3 id="-207"><a class="markdownIt-Anchor" href="#-207">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_1-1-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%98%AF%E4%BB%80%E4%B9%88">#</a>1.1. æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ</h3>
<p>æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionï¼‰æ˜¯ä¸€ä¸ªç”¨æ­£åˆ™ç¬¦å·å†™å‡ºçš„å…¬å¼ï¼Œç¨‹åºå¯¹è¿™ä¸ªå…¬å¼è¿›è¡Œè¯­æ³•åˆ†æï¼Œå»ºç«‹ä¸€ä¸ªè¯­æ³•åˆ†ææ ‘ï¼Œå†æ ¹æ®è¿™ä¸ªåˆ†ææ ‘ç»“åˆæ­£åˆ™è¡¨è¾¾å¼çš„å¼•æ“ç”Ÿæˆæ‰§è¡Œç¨‹åºï¼ˆè¿™ä¸ªæ‰§è¡Œç¨‹åºæˆ‘ä»¬æŠŠå®ƒç§°ä½œçŠ¶æ€æœºï¼Œä¹Ÿå«çŠ¶æ€è‡ªåŠ¨æœºï¼‰ï¼Œç”¨äºå­—ç¬¦åŒ¹é…ã€‚</p>
<h3 id="-208"><a class="markdownIt-Anchor" href="#-208">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_1-2-%E5%A6%82%E4%BD%95%E5%AD%A6%E4%B9%A0%E6%AD%A3%E5%88%99">#</a>1.2. å¦‚ä½•å­¦ä¹ æ­£åˆ™</h3>
<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ–‡æœ¬åŒ¹é…å·¥å…·ï¼Œä½†æ˜¯å®ƒçš„è§„åˆ™å¾ˆå¤æ‚ï¼Œç†è§£èµ·æ¥è¾ƒä¸ºå›°éš¾ï¼Œå®¹æ˜“è®©äººæœ›è€Œç”Ÿç•ã€‚</p>
<p>åˆšæ¥è§¦æ­£åˆ™æ—¶ï¼Œæˆ‘çœ‹äº†ä¸€å †æ­£åˆ™çš„è¯­ä¹‰è¯´æ˜ï¼Œä½†æ˜¯ä»ç„¶ä¸æ˜æ‰€ä»¥ã€‚åæ¥ï¼Œæˆ‘å¤šæ¥è§¦ä¸€äº›æ­£åˆ™çš„åº”ç”¨å®ä¾‹ï¼Œæ¸æ¸æœ‰äº†æ„Ÿè§‰ï¼Œå†ç»“åˆè¯­ä¹‰è¯´æ˜ï¼Œç»ˆæœ‰é¢†æ‚Ÿã€‚æˆ‘è§‰å¾—æ­£åˆ™è¡¨è¾¾å¼å’Œæ­¦ä¾ ä¿®ç»ƒæ­¦åŠŸå·®ä¸å¤šï¼Œåº”è¯¥å…ˆç»ƒæ‹›å¼ï¼Œå†ç»ƒå¿ƒæ³•ã€‚å¦‚æœä¸€å¼€å§‹å°±ç›´æ¥çœ‹æ­£åˆ™çš„è§„åˆ™ï¼Œä¿è¯ä½ ä¼šæ‡µé€¼ã€‚å½“ä½ ç†Ÿæ‚‰åŸºæœ¬æ‹›å¼ï¼ˆæ­£åˆ™åŸºæœ¬ä½¿ç”¨æ¡ˆä¾‹ï¼‰åï¼Œä¹Ÿè¯¥ä¿®ç‚¼ä¿®ç‚¼å¿ƒæ³•ï¼ˆæ­£åˆ™è¯­æ³•ï¼‰äº†ã€‚çœŸæ­£çš„é«˜æ‰‹ä¸èƒ½åªé æ­»è®°ç¡¬èƒŒé‚£ä¹ˆå‡ æ‹›æŠŠå¼ã€‚å°±åƒå¼ ä¸‰ä¸°æ•™å¼ æ— å¿Œå¤ªææ‹³ä¸€æ ·ï¼Œé¢†æ‚Ÿå¿ƒæ³•ï¼Œèä¼šè´¯é€šï¼Œå°‘ä¾ ä½ å°±å¯ä»¥æ— æ‹›èƒœæœ‰æ‹›ï¼Œæˆä¸ºä¼ è¯´ä¸­çš„ç»ä¸–é«˜æ‰‹ã€‚</p>
<p><strong>ä»¥ä¸Šé—²è¯å¯å½’çº³ä¸ºä¸€å¥ï¼šå­¦ä¹ æ­£åˆ™åº”è¯¥ä»å®ä¾‹å»ç†è§£è§„åˆ™ã€‚</strong></p>
<h2 id="-209"><a class="markdownIt-Anchor" href="#-209">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_2-%E6%AD%A3%E5%88%99%E5%B7%A5%E5%85%B7%E7%B1%BB">#</a>2. æ­£åˆ™å·¥å…·ç±»</h2>
<p>JDK ä¸­çš„  <code>java.util.regex</code>  åŒ…æä¾›äº†å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒã€‚</p>
<p><code>java.util.regex</code>  æœ‰ä¸‰ä¸ªæ ¸å¿ƒç±»ï¼š</p>
<ul>
<li><strong>Pattern ç±»ï¼š</strong> <code>Pattern</code>  æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç¼–è¯‘è¡¨ç¤ºã€‚</li>
<li><strong>Matcher ç±»ï¼š</strong> <code>Matcher</code>  æ˜¯å¯¹è¾“å…¥å­—ç¬¦ä¸²è¿›è¡Œè§£é‡Šå’ŒåŒ¹é…æ“ä½œçš„å¼•æ“ã€‚</li>
<li><strong>PatternSyntaxExceptionï¼š</strong> <code>PatternSyntaxException</code>  æ˜¯ä¸€ä¸ªéå¼ºåˆ¶å¼‚å¸¸ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­çš„è¯­æ³•é”™è¯¯ã€‚</li>
</ul>
<p>** æ³¨ï¼š** éœ€è¦æ ¼å¤–æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨ Java ä¸­ä½¿ç”¨åæ–œæ  &quot;&quot; æ—¶å¿…é¡»å†™æˆ  <code>&quot;\\&quot;</code> ã€‚æ‰€ä»¥æœ¬æ–‡çš„ä»£ç å‡ºç°å½¢å¦‚  <code>String regex = &quot;\\$\\&#123;.*?\\&#125;&quot;</code>  å…¶å®å°±æ˜¯  <code>\$\&#123;.\*?\&#125;</code> ã€‚</p>
<h3 id="-210"><a class="markdownIt-Anchor" href="#-210">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_2-1-pattern-%E7%B1%BB">#</a>2.1. Pattern ç±»</h3>
<p><code>Pattern</code>  ç±»æ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ã€‚è¦åˆ›å»ºä¸€ä¸ª <code>Pattern</code>  å¯¹è±¡ï¼Œä½ å¿…é¡»é¦–å…ˆè°ƒç”¨å…¶<strong>é™æ€æ–¹æ³•</strong> <code>compile</code> ï¼ŒåŠ è½½æ­£åˆ™è§„åˆ™å­—ç¬¦ä¸²ï¼Œç„¶åè¿”å›ä¸€ä¸ª Pattern å¯¹è±¡ã€‚</p>
<p>ä¸ <code>Pattern</code>  ç±»ä¸€æ ·ï¼Œ <code>Matcher</code>  ç±»ä¹Ÿæ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ã€‚ä½ éœ€è¦è°ƒç”¨ <code>Pattern</code>  å¯¹è±¡çš„ <code>matcher</code>  æ–¹æ³•æ¥è·å¾—ä¸€ä¸ª <code>Matcher</code>  å¯¹è±¡ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘Pattern å’Œ Matcher çš„åˆå§‹åŒ–</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-211"><a class="markdownIt-Anchor" href="#-211">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_2-2-matcher-%E7%B1%BB">#</a>2.2. Matcher ç±»</h3>
<p><code>Matcher</code>  ç±»å¯ä»¥è¯´æ˜¯  <code>java.util.regex</code>  ä¸­çš„æ ¸å¿ƒç±»ï¼Œå®ƒæœ‰ä¸‰ç±»åŠŸèƒ½ï¼šæ ¡éªŒã€æŸ¥æ‰¾ã€æ›¿æ¢ã€‚</p>
<h4 id="-212"><a class="markdownIt-Anchor" href="#-212">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C">#</a>æ ¡éªŒ</h4>
<p>ä¸ºäº†æ ¡éªŒæ–‡æœ¬æ˜¯å¦ä¸æ­£åˆ™è§„åˆ™åŒ¹é…ï¼ŒMatcher æä¾›äº†ä»¥ä¸‹å‡ ä¸ªè¿”å›å€¼ä¸º  <code>boolean</code>  çš„æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th><strong>åºå·</strong></th>
<th><strong>æ–¹æ³•åŠè¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>**public boolean lookingAt () ** å°è¯•å°†ä»åŒºåŸŸå¼€å¤´å¼€å§‹çš„è¾“å…¥åºåˆ—ä¸è¯¥æ¨¡å¼åŒ¹é…ã€‚</td>
</tr>
<tr>
<td>2</td>
<td>**public boolean find () ** å°è¯•æŸ¥æ‰¾ä¸è¯¥æ¨¡å¼åŒ¹é…çš„è¾“å…¥åºåˆ—çš„ä¸‹ä¸€ä¸ªå­åºåˆ—ã€‚</td>
</tr>
<tr>
<td>3</td>
<td>**public boolean find (int startï¼‰** é‡ç½®æ­¤åŒ¹é…å™¨ï¼Œç„¶åå°è¯•æŸ¥æ‰¾åŒ¹é…è¯¥æ¨¡å¼ã€ä»æŒ‡å®šç´¢å¼•å¼€å§‹çš„è¾“å…¥åºåˆ—çš„ä¸‹ä¸€ä¸ªå­åºåˆ—ã€‚</td>
</tr>
<tr>
<td>4</td>
<td>**public boolean matches () ** å°è¯•å°†æ•´ä¸ªåŒºåŸŸä¸æ¨¡å¼åŒ¹é…ã€‚</td>
</tr>
</tbody>
</table>
<p>å¦‚æœä½ å‚»å‚»åˆ†ä¸æ¸…ä¸Šé¢çš„æŸ¥æ‰¾æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œé‚£ä¹ˆä¸‹é¢ä¸€ä¸ªä¾‹å­å°±å¯ä»¥è®©ä½ ç§’æ‡‚ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘lookingAtã€findã€matches</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">checkLookingAt</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">checkLookingAt</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">checkFind</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">checkFind</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"helloworld"</span><span class="token punctuation">,</span> <span class="token string">"helloworld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkLookingAt</span><span class="token punctuation">(</span><span class="token class-name">String</span> regex<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">lookingAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content <span class="token operator">+</span> <span class="token string">"\tlookingAtï¼š "</span> <span class="token operator">+</span> regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content <span class="token operator">+</span> <span class="token string">"\tnot lookingAtï¼š "</span> <span class="token operator">+</span> regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkFind</span><span class="token punctuation">(</span><span class="token class-name">String</span> regex<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content <span class="token operator">+</span> <span class="token string">"\tfindï¼š "</span> <span class="token operator">+</span> regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content <span class="token operator">+</span> <span class="token string">"\tnot findï¼š "</span> <span class="token operator">+</span> regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token class-name">String</span> regex<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content <span class="token operator">+</span> <span class="token string">"\tmatchesï¼š "</span> <span class="token operator">+</span> regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content <span class="token operator">+</span> <span class="token string">"\tnot matchesï¼š "</span> <span class="token operator">+</span> regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">helloworld	lookingAtï¼š hello
helloworld	not lookingAtï¼š world
helloworld	findï¼š hello
helloworld	findï¼š world
helloworld	not matchesï¼š hello
helloworld	not matchesï¼š world
helloworld	matchesï¼š helloworld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¯´æ˜</strong></p>
<p><code>regex = &quot;world&quot;</code>  è¡¨ç¤ºçš„æ­£åˆ™è§„åˆ™æ˜¯ä»¥ world å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œ <code>regex = &quot;hello&quot;</code>  å’Œ  <code>regex = &quot;helloworld&quot;</code>  ä¹Ÿæ˜¯åŒç†ã€‚</p>
<ul>
<li><code>lookingAt</code>  æ–¹æ³•ä»å¤´éƒ¨å¼€å§‹ï¼Œæ£€æŸ¥ content å­—ç¬¦ä¸²æ˜¯å¦æœ‰å­å­—ç¬¦ä¸²äºæ­£åˆ™è§„åˆ™åŒ¹é…ã€‚</li>
<li><code>find</code>  æ–¹æ³•æ£€æŸ¥ content å­—ç¬¦ä¸²æ˜¯å¦æœ‰å­å­—ç¬¦ä¸²äºæ­£åˆ™è§„åˆ™åŒ¹é…ï¼Œä¸ç®¡å­—ç¬¦ä¸²æ‰€åœ¨ä½ç½®ã€‚</li>
<li><code>matches</code>  æ–¹æ³•æ£€æŸ¥ content å­—ç¬¦ä¸²æ•´ä½“æ˜¯å¦ä¸æ­£åˆ™è§„åˆ™åŒ¹é…ã€‚</li>
</ul>
<h4 id="-213"><a class="markdownIt-Anchor" href="#-213">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%9F%A5%E6%89%BE">#</a>æŸ¥æ‰¾</h4>
<p>ä¸ºäº†æŸ¥æ‰¾æ–‡æœ¬åŒ¹é…æ­£åˆ™è§„åˆ™çš„ä½ç½®ï¼Œ <code>Matcher</code>  æä¾›äº†ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th><strong>åºå·</strong></th>
<th><strong>æ–¹æ³•åŠè¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>**public int start () ** è¿”å›ä»¥å‰åŒ¹é…çš„åˆå§‹ç´¢å¼•ã€‚</td>
</tr>
<tr>
<td>2</td>
<td><strong>public int start(int group)</strong> è¿”å›åœ¨ä»¥å‰çš„åŒ¹é…æ“ä½œæœŸé—´ï¼Œç”±ç»™å®šç»„æ‰€æ•è·çš„å­åºåˆ—çš„åˆå§‹ç´¢å¼•</td>
</tr>
<tr>
<td>3</td>
<td>**public int end ()** è¿”å›æœ€ååŒ¹é…å­—ç¬¦ä¹‹åçš„åç§»é‡ã€‚</td>
</tr>
<tr>
<td>4</td>
<td>**public int end (int group)** è¿”å›åœ¨ä»¥å‰çš„åŒ¹é…æ“ä½œæœŸé—´ï¼Œç”±ç»™å®šç»„æ‰€æ•è·å­åºåˆ—çš„æœ€åå­—ç¬¦ä¹‹åçš„åç§»é‡ã€‚</td>
</tr>
<tr>
<td>5</td>
<td>**public String group ()** è¿”å›å‰ä¸€ä¸ªç¬¦åˆåŒ¹é…æ¡ä»¶çš„å­åºåˆ—ã€‚</td>
</tr>
<tr>
<td>6</td>
<td>**public String group (int group)** è¿”å›æŒ‡å®šçš„ç¬¦åˆåŒ¹é…æ¡ä»¶çš„å­åºåˆ—ã€‚</td>
</tr>
</tbody>
</table>
<p>ã€ç¤ºä¾‹ã€‘ä½¿ç”¨ start ()ã€end ()ã€group () æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…æ­£åˆ™æ¡ä»¶çš„å­åºåˆ—</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">final</span> <span class="token class-name">String</span> regex <span class="token operator">=</span> <span class="token string">"world"</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">"helloworld helloworld"</span><span class="token punctuation">;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"content: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"["</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">"th] found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"start: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"end: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"group: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">content: helloworld helloworld
[1th] found
start: 5, end: 10, group: world
[2th] found
start: 16, end: 21, group: world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¯´æ˜</strong></p>
<p>ä¾‹å­å¾ˆç›´ç™½ï¼Œä¸è¨€è‡ªæ˜äº†å§ã€‚</p>
<h4 id="-214"><a class="markdownIt-Anchor" href="#-214">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%9B%BF%E6%8D%A2">#</a>æ›¿æ¢</h4>
<p>æ›¿æ¢æ–¹æ³•æ˜¯æ›¿æ¢è¾“å…¥å­—ç¬¦ä¸²é‡Œæ–‡æœ¬çš„æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th><strong>åºå·</strong></th>
<th><strong>æ–¹æ³•åŠè¯´æ˜</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>**public Matcher appendReplacement (StringBuffer sb, String replacement)** å®ç°éç»ˆç«¯æ·»åŠ å’Œæ›¿æ¢æ­¥éª¤ã€‚</td>
</tr>
<tr>
<td>2</td>
<td>**public StringBuffer appendTail (StringBuffer sb)** å®ç°ç»ˆç«¯æ·»åŠ å’Œæ›¿æ¢æ­¥éª¤ã€‚</td>
</tr>
<tr>
<td>3</td>
<td>**public String replaceAll (String replacement) ** æ›¿æ¢æ¨¡å¼ä¸ç»™å®šæ›¿æ¢å­—ç¬¦ä¸²ç›¸åŒ¹é…çš„è¾“å…¥åºåˆ—çš„æ¯ä¸ªå­åºåˆ—ã€‚</td>
</tr>
<tr>
<td>4</td>
<td><strong>public String replaceFirst(String replacement)</strong> æ›¿æ¢æ¨¡å¼ä¸ç»™å®šæ›¿æ¢å­—ç¬¦ä¸²åŒ¹é…çš„è¾“å…¥åºåˆ—çš„ç¬¬ä¸€ä¸ªå­åºåˆ—ã€‚</td>
</tr>
<tr>
<td>5</td>
<td>**public static String quoteReplacement (String s)** è¿”å›æŒ‡å®šå­—ç¬¦ä¸²çš„å­—é¢æ›¿æ¢å­—ç¬¦ä¸²ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°±åƒä¼ é€’ç»™ Matcher ç±»çš„ appendReplacement æ–¹æ³•ä¸€ä¸ªå­—é¢å­—ç¬¦ä¸²ä¸€æ ·å·¥ä½œã€‚</td>
</tr>
</tbody>
</table>
<p>ã€ç¤ºä¾‹ã€‘replaceFirst å’Œ replaceAll</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> regex <span class="token operator">=</span> <span class="token string">"can"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> replace <span class="token operator">=</span> <span class="token string">"can not"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">"I can because I think I can."</span><span class="token punctuation">;</span>

	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"content: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"replaceFirst: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">replaceFirst</span><span class="token punctuation">(</span>replace<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"replaceAll: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>replace<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">content: I can because I think I can.
replaceFirst: I can not because I think I can.
replaceAll: I can not because I think I can not.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>è¯´æ˜</strong></p>
<p>replaceFirstï¼šæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…æ­£åˆ™è§„åˆ™çš„å­åºåˆ—ã€‚</p>
<p>replaceAllï¼šæ›¿æ¢æ‰€æœ‰åŒ¹é…æ­£åˆ™è§„åˆ™çš„å­åºåˆ—ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘appendReplacementã€appendTail å’Œ replaceAll</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> regex <span class="token operator">=</span> <span class="token string">"can"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> replace <span class="token operator">=</span> <span class="token string">"can not"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">"I can because I think I can."</span><span class="token punctuation">;</span>
	<span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">StringBuffer</span> sb2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"content: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		m<span class="token punctuation">.</span><span class="token function">appendReplacement</span><span class="token punctuation">(</span>sb<span class="token punctuation">,</span> replace<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"appendReplacement: "</span> <span class="token operator">+</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
	m<span class="token punctuation">.</span><span class="token function">appendTail</span><span class="token punctuation">(</span>sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"appendTail: "</span> <span class="token operator">+</span> sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">content: I can because I think I can.
appendReplacement: I can not because I think I can not
appendTail: I can not because I think I can not.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>è¯´æ˜</strong></p>
<p>ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œ <code>appendReplacement</code>  å’Œ <code>appendTail</code>  æ–¹æ³•ç»„åˆèµ·æ¥ç”¨ï¼ŒåŠŸèƒ½å’Œ <code>replaceAll</code>  æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å¦‚æœä½ æŸ¥çœ‹ <code>replaceAll</code>  çš„æºç ï¼Œä¼šå‘ç°å…¶å†…éƒ¨å°±æ˜¯ä½¿ç”¨ <code>appendReplacement</code>  å’Œ <code>appendTail</code>  æ–¹æ³•ç»„åˆæ¥å®ç°çš„ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘quoteReplacement å’Œ replaceAllï¼Œè§£å†³ç‰¹æ®Šå­—ç¬¦æ›¿æ¢é—®é¢˜</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> regex <span class="token operator">=</span> <span class="token string">"\\$\\&#123;.*?\\&#125;"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> replace <span class="token operator">=</span> <span class="token string">"$&#123;product&#125;"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">"product is $&#123;productName&#125;."</span><span class="token punctuation">;</span>

	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> replaceAll <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>replace<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"content: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"replaceAll: "</span> <span class="token operator">+</span> replaceAll<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Exception in thread "main" java.lang.IllegalArgumentException: No group with name &#123;product&#125;
	at java.util.regex.Matcher.appendReplacement(Matcher.java:849)
	at java.util.regex.Matcher.replaceAll(Matcher.java:955)
	at org.zp.notes.javase.regex.RegexDemo.wrongMethod(RegexDemo.java:42)
	at org.zp.notes.javase.regex.RegexDemo.main(RegexDemo.java:18)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:147)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¯´æ˜</strong></p>
<p><code>String regex = &quot;\\$\\&#123;.*?\\&#125;&quot;;</code>  è¡¨ç¤ºåŒ¹é…ç±»ä¼¼ <code>$&#123;name&#125;</code>  è¿™æ ·çš„å­—ç¬¦ä¸²ã€‚ç”±äº <code>$</code> ã€ <code>&#123;</code>  ã€ <code>&#125;</code>  éƒ½æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦ç”¨åä¹‰å­—ç¬¦ <code>\</code>  æ¥ä¿®é¥°æ‰èƒ½è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²å­—ç¬¦æ¥å¤„ç†ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­æ˜¯æƒ³å°†  <code>$&#123;productName&#125;</code>  æ›¿æ¢ä¸º  <code>$&#123;product&#125;</code>  ï¼Œç„¶è€Œ <code>replaceAll</code>  æ–¹æ³•å´å°†ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­çš„ <code>$</code>  å½“åšç‰¹æ®Šå­—ç¬¦æ¥å¤„ç†äº†ã€‚ç»“æœäº§ç”Ÿå¼‚å¸¸ã€‚</p>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</p>
<p>JDK1.5 å¼•å…¥äº† <code>quoteReplacement</code>  æ–¹æ³•ã€‚å®ƒå¯ä»¥ç”¨æ¥è½¬æ¢ç‰¹æ®Šå­—ç¬¦ã€‚å…¶å®æºç éå¸¸ç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­å­—ç¬¦ä¸²ä¸­å¦‚æœæœ‰ <code>\</code>  æˆ– <code>$</code> ï¼Œå°±ä¸ºå®ƒåŠ ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ <code>\</code></p>
<p>æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç ç•¥ä½œè°ƒæ•´ï¼š</p>
<p><code>m.replaceAll(replace)</code>  æ”¹ä¸º <code>m.replaceAll(Matcher.quoteReplacement(replace))</code> ï¼Œæ–°ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> regex <span class="token operator">=</span> <span class="token string">"\\$\\&#123;.*?\\&#125;"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> replace <span class="token operator">=</span> <span class="token string">"$&#123;product&#125;"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">"product is $&#123;productName&#125;."</span><span class="token punctuation">;</span>

	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> replaceAll <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token class-name">Matcher</span><span class="token punctuation">.</span><span class="token function">quoteReplacement</span><span class="token punctuation">(</span>replace<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"content: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"replaceAll: "</span> <span class="token operator">+</span> replaceAll<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">content: product is $&#123;productName&#125;.
replaceAll: product is $&#123;product&#125;.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>è¯´æ˜</strong></p>
<p>å­—ç¬¦ä¸²ä¸­å¦‚æœæœ‰ <code>\</code>  æˆ– <code>$</code> ï¼Œä¸èƒ½è¢«æ­£å¸¸è§£æçš„é—®é¢˜è§£å†³ã€‚</p>
<h2 id="-215"><a class="markdownIt-Anchor" href="#-215">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_3-%E5%85%83%E5%AD%97%E7%AC%A6">#</a>3. å…ƒå­—ç¬¦</h2>
<p>å…ƒå­—ç¬¦ (metacharacters) å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­å…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„ä¸“ç”¨å­—ç¬¦ã€‚</p>
<h3 id="-216"><a class="markdownIt-Anchor" href="#-216">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_3-1-%E5%9F%BA%E6%9C%AC%E5%85%83%E5%AD%97%E7%AC%A6">#</a>3.1. åŸºæœ¬å…ƒå­—ç¬¦</h3>
<p>æ­£åˆ™è¡¨è¾¾å¼çš„å…ƒå­—ç¬¦éš¾ä»¥è®°å¿†ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºæœ‰å¾ˆå¤šä¸ºäº†ç®€åŒ–è¡¨è¾¾è€Œå‡ºç°çš„ç­‰ä»·å­—ç¬¦ã€‚è€Œå®é™…ä¸Šæœ€åŸºæœ¬çš„å…ƒå­—ç¬¦ï¼Œå¹¶æ²¡æœ‰é‚£ä¹ˆå¤šã€‚å¯¹äºå¤§éƒ¨åˆ†çš„åœºæ™¯ï¼ŒåŸºæœ¬å…ƒå­—ç¬¦éƒ½å¯ä»¥æå®šã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªä¸ªå®ä¾‹å‡ºå‘ï¼Œç”±æµ…å…¥æ·±çš„å»ä½“ä¼šæ­£åˆ™çš„å¥¥å¦™ã€‚</p>
<h4 id="-217"><a class="markdownIt-Anchor" href="#-217">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%A4%9A%E9%80%89">#</a>å¤šé€‰ï¼ˆ <code>|</code> ï¼‰</h4>
<p>ã€ç¤ºä¾‹ã€‘åŒ¹é…ä¸€ä¸ªç¡®å®šçš„å­—ç¬¦ä¸²</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœè¦åŒ¹é…ä¸€ä¸ªç¡®å®šçš„å­—ç¬¦ä¸²ï¼Œéå¸¸ç®€å•ï¼Œå¦‚ä¾‹ 1 æ‰€ç¤ºã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸ç¡®å®šè¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œå¸Œæœ›æœ‰å¤šä¸ªé€‰æ‹©ï¼Œæ€ä¹ˆåŠï¼Ÿç­”æ¡ˆæ˜¯ï¼šä½¿ç”¨å…ƒå­—ç¬¦ <code>|</code>  ï¼Œå®ƒçš„å«ä¹‰æ˜¯æˆ–ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åŒ¹é…å¤šä¸ªå¯é€‰çš„å­—ç¬¦ä¸²</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ï¼š|</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"yes|no"</span><span class="token punctuation">,</span> <span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"yes|no"</span><span class="token punctuation">,</span> <span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"yes|no"</span><span class="token punctuation">,</span> <span class="token string">"right"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// yes	matchesï¼š yes|no</span>
<span class="token comment">// no	matchesï¼š yes|no</span>
<span class="token comment">// right	not matchesï¼š yes|no</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-218"><a class="markdownIt-Anchor" href="#-218">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%88%86%E7%BB%84">#</a>åˆ†ç»„ï¼ˆ <code>()</code> ï¼‰</h4>
<p>å¦‚æœä½ å¸Œæœ›è¡¨è¾¾å¼ç”±å¤šä¸ªå­è¡¨è¾¾å¼ç»„æˆï¼Œä½ å¯ä»¥ä½¿ç”¨  <code>()</code> ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åŒ¹é…ç»„åˆå­—ç¬¦ä¸²</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"(play|end)(ing|ed)"</span><span class="token punctuation">,</span> <span class="token string">"ended"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"(play|end)(ing|ed)"</span><span class="token punctuation">,</span> <span class="token string">"ending"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"(play|end)(ing|ed)"</span><span class="token punctuation">,</span> <span class="token string">"playing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"(play|end)(ing|ed)"</span><span class="token punctuation">,</span> <span class="token string">"played"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// ended	matchesï¼š (play|end)(ing|ed)</span>
<span class="token comment">// ending	matchesï¼š (play|end)(ing|ed)</span>
<span class="token comment">// playing	matchesï¼š (play|end)(ing|ed)</span>
<span class="token comment">// played	matchesï¼š (play|end)(ing|ed)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-219"><a class="markdownIt-Anchor" href="#-219">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%8C%87%E5%AE%9A%E5%8D%95%E5%AD%97%E7%AC%A6%E6%9C%89%E6%95%88%E8%8C%83%E5%9B%B4">#</a>æŒ‡å®šå•å­—ç¬¦æœ‰æ•ˆèŒƒå›´ï¼ˆ <code>[]</code> ï¼‰</h4>
<p>å‰é¢å±•ç¤ºäº†å¦‚ä½•åŒ¹é…å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™ä½ éœ€è¦ç²¾ç¡®çš„åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ <code>[]</code>  ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘å­—ç¬¦åœ¨æŒ‡å®šèŒƒå›´</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ï¼š[]</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[abc]"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å­—ç¬¦åªèƒ½æ˜¯aã€bã€c</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[a-z]"</span><span class="token punctuation">,</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦åªèƒ½æ˜¯a - z</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[A-Z]"</span><span class="token punctuation">,</span> <span class="token string">"O"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦åªèƒ½æ˜¯A - Z</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[a-zA-Z]"</span><span class="token punctuation">,</span> <span class="token string">"K"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦åªèƒ½æ˜¯a - zå’ŒA - Z</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[a-zA-Z]"</span><span class="token punctuation">,</span> <span class="token string">"k"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[0-9]"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦åªèƒ½æ˜¯0 - 9</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// b	matchesï¼š [abc]</span>
<span class="token comment">// m	matchesï¼š [a-z]</span>
<span class="token comment">// O	matchesï¼š [A-Z]</span>
<span class="token comment">// K	matchesï¼š [a-zA-Z]</span>
<span class="token comment">// k	matchesï¼š [a-zA-Z]</span>
<span class="token comment">// 5	matchesï¼š [0-9]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-220"><a class="markdownIt-Anchor" href="#-220">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%8C%87%E5%AE%9A%E5%8D%95%E5%AD%97%E7%AC%A6%E6%97%A0%E6%95%88%E8%8C%83%E5%9B%B4">#</a>æŒ‡å®šå•å­—ç¬¦æ— æ•ˆèŒƒå›´ï¼ˆ  <code>[^]</code> ï¼‰</h4>
<p>ã€ç¤ºä¾‹ã€‘å­—ç¬¦ä¸èƒ½åœ¨æŒ‡å®šèŒƒå›´</p>
<p>å¦‚æœéœ€è¦åŒ¹é…ä¸€ä¸ªå­—ç¬¦çš„é€†æ“ä½œï¼Œå³å­—ç¬¦ä¸èƒ½åœ¨æŒ‡å®šèŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨ <code>[^]</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ï¼š[^]</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[^abc]"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸èƒ½æ˜¯aã€bã€c</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[^a-z]"</span><span class="token punctuation">,</span> <span class="token string">"m"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸èƒ½æ˜¯a - z</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[^A-Z]"</span><span class="token punctuation">,</span> <span class="token string">"O"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸èƒ½æ˜¯A - Z</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[^a-zA-Z]"</span><span class="token punctuation">,</span> <span class="token string">"K"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸èƒ½æ˜¯a - zå’ŒA - Z</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[^a-zA-Z]"</span><span class="token punctuation">,</span> <span class="token string">"k"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[^0-9]"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸èƒ½æ˜¯0 - 9</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// b	not matchesï¼š [^abc]</span>
<span class="token comment">// m	not matchesï¼š [^a-z]</span>
<span class="token comment">// O	not matchesï¼š [^A-Z]</span>
<span class="token comment">// K	not matchesï¼š [^a-zA-Z]</span>
<span class="token comment">// k	not matchesï¼š [^a-zA-Z]</span>
<span class="token comment">// 5	not matchesï¼š [^0-9]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-221"><a class="markdownIt-Anchor" href="#-221">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E9%99%90%E5%88%B6%E5%AD%97%E7%AC%A6%E6%95%B0%E9%87%8F">#</a>é™åˆ¶å­—ç¬¦æ•°é‡ï¼ˆ <code>&#123;&#125;</code> ï¼‰</h4>
<p>å¦‚æœæƒ³è¦æ§åˆ¶å­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨  <code>&#123;&#125;</code> ã€‚</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&#123;n&#125;</code></td>
<td>n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚</td>
</tr>
<tr>
<td><code>&#123;n,&#125;</code></td>
<td>n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚</td>
</tr>
<tr>
<td><code>&#123;n,m&#125;</code></td>
<td>m å’Œ n å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n &lt;= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚</td>
</tr>
</tbody>
</table>
<p>ã€ç¤ºä¾‹ã€‘é™åˆ¶å­—ç¬¦å‡ºç°æ¬¡æ•°</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// &#123;n&#125;: n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1&#125;"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1&#125;"</span><span class="token punctuation">,</span> <span class="token string">"ap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1&#125;"</span><span class="token punctuation">,</span> <span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1&#125;"</span><span class="token punctuation">,</span> <span class="token string">"apppppppppp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#123;n,&#125;: n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"ap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"apppppppppp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// &#123;n,m&#125;: m å’Œ n å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n &lt;= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;2,5&#125;"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;2,5&#125;"</span><span class="token punctuation">,</span> <span class="token string">"ap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;2,5&#125;"</span><span class="token punctuation">,</span> <span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap&#123;2,5&#125;"</span><span class="token punctuation">,</span> <span class="token string">"apppppppppp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// a	not matchesï¼š ap&#123;1&#125;</span>
<span class="token comment">// ap	matchesï¼š ap&#123;1&#125;</span>
<span class="token comment">// app	not matchesï¼š ap&#123;1&#125;</span>
<span class="token comment">// apppppppppp	not matchesï¼š ap&#123;1&#125;</span>
<span class="token comment">// a	not matchesï¼š ap&#123;1,&#125;</span>
<span class="token comment">// ap	matchesï¼š ap&#123;1,&#125;</span>
<span class="token comment">// app	matchesï¼š ap&#123;1,&#125;</span>
<span class="token comment">// apppppppppp	matchesï¼š ap&#123;1,&#125;</span>
<span class="token comment">// a	not matchesï¼š ap&#123;2,5&#125;</span>
<span class="token comment">// ap	not matchesï¼š ap&#123;2,5&#125;</span>
<span class="token comment">// app	matchesï¼š ap&#123;2,5&#125;</span>
<span class="token comment">// apppppppppp	not matchesï¼š ap&#123;2,5&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-222"><a class="markdownIt-Anchor" href="#-222">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E8%BD%AC%E4%B9%89%E5%AD%97%E7%AC%A6">#</a>è½¬ä¹‰å­—ç¬¦ï¼ˆ <code>/</code> ï¼‰</h4>
<p>å¦‚æœæƒ³è¦æŸ¥æ‰¾å…ƒå­—ç¬¦æœ¬èº«ï¼Œä½ éœ€è¦ä½¿ç”¨è½¬ä¹‰ç¬¦ï¼Œä½¿å¾—æ­£åˆ™å¼•æ“å°†å…¶è§†ä½œä¸€ä¸ªæ™®é€šå­—ç¬¦ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…ƒå­—ç¬¦å»å¤„ç†ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">* çš„è½¬ä¹‰å­—ç¬¦ï¼š\*
+ çš„è½¬ä¹‰å­—ç¬¦ï¼š\+
? çš„è½¬ä¹‰å­—ç¬¦ï¼š\?
^ çš„è½¬ä¹‰å­—ç¬¦ï¼š\^
$ çš„è½¬ä¹‰å­—ç¬¦ï¼š\$
. çš„è½¬ä¹‰å­—ç¬¦ï¼š\.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœæ˜¯è½¬ä¹‰ç¬¦  <code>\</code>  æœ¬èº«ï¼Œä½ éœ€è¦ä½¿ç”¨  <code>\\</code>  ã€‚</p>
<h4 id="-223"><a class="markdownIt-Anchor" href="#-223">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%8C%87%E5%AE%9A%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%BC%80%E5%A7%8B-%E5%92%8C%E7%BB%93%E5%B0%BE">#</a>æŒ‡å®šè¡¨è¾¾å¼å­—ç¬¦ä¸²çš„å¼€å§‹ï¼ˆ <code>^</code> ï¼‰å’Œç»“å°¾ï¼ˆ <code>$</code> ï¼‰</h4>
<p>å¦‚æœå¸Œæœ›åŒ¹é…çš„å­—ç¬¦ä¸²å¿…é¡»ä»¥ç‰¹å®šå­—ç¬¦ä¸²å¼€å¤´ï¼Œå¯ä»¥ä½¿ç”¨  <code>^</code>  ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¯·ç‰¹åˆ«ç•™æ„ï¼Œè¿™é‡Œçš„  <code>^</code>  ä¸€å®šè¦å’Œ  <code>[^]</code>  ä¸­çš„  <code>^</code>  åŒºåˆ†ã€‚</p>
</blockquote>
<p>ã€ç¤ºä¾‹ã€‘é™åˆ¶å­—ç¬¦ä¸²å¤´éƒ¨</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"^app[a-z]&#123;0,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"apple"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸²å¿…é¡»ä»¥appå¼€å¤´</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"^app[a-z]&#123;0,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"aplause"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// apple	matchesï¼š ^app[a-z]&#123;0,&#125;</span>
<span class="token comment">// aplause	not matchesï¼š ^app[a-z]&#123;0,&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœå¸Œæœ›åŒ¹é…çš„å­—ç¬¦ä¸²å¿…é¡»ä»¥ç‰¹å®šå­—ç¬¦ä¸²ç»“å°¾ï¼Œå¯ä»¥ä½¿ç”¨  <code>$</code>  ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘é™åˆ¶å­—ç¬¦ä¸²å°¾éƒ¨</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[a-z]&#123;0,&#125;ing$"</span><span class="token punctuation">,</span> <span class="token string">"playing"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸²å¿…é¡»ä»¥ingç»“å°¾</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[a-z]&#123;0,&#125;ing$"</span><span class="token punctuation">,</span> <span class="token string">"long"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// playing	matchesï¼š [a-z]&#123;0,&#125;ing$</span>
<span class="token comment">// long	not matchesï¼š [a-z]&#123;0,&#125;ing$</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-224"><a class="markdownIt-Anchor" href="#-224">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_3-2-%E7%AD%89%E4%BB%B7%E5%AD%97%E7%AC%A6">#</a>3.2. ç­‰ä»·å­—ç¬¦</h3>
<p>ç­‰ä»·å­—ç¬¦ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¯¹äºåŸºæœ¬å…ƒå­—ç¬¦è¡¨è¾¾çš„ä¸€ç§ç®€åŒ–ï¼ˆç­‰ä»·å­—ç¬¦çš„åŠŸèƒ½éƒ½å¯ä»¥é€šè¿‡åŸºæœ¬å…ƒå­—ç¬¦æ¥å®ç°ï¼‰ã€‚</p>
<p>åœ¨æ²¡æœ‰æŒæ¡åŸºæœ¬å…ƒå­—ç¬¦ä¹‹å‰ï¼Œå¯ä»¥å…ˆä¸ç”¨ç†ä¼šï¼Œå› ä¸ºå¾ˆå®¹æ˜“æŠŠäººç»•æ™•ã€‚</p>
<p>ç­‰ä»·å­—ç¬¦çš„å¥½å¤„åœ¨äºç®€åŒ–äº†åŸºæœ¬å…ƒå­—ç¬¦çš„å†™æ³•ã€‚</p>
<h4 id="-225"><a class="markdownIt-Anchor" href="#-225">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E8%A1%A8%E7%A4%BA%E6%9F%90%E4%B8%80%E7%B1%BB%E5%9E%8B%E5%AD%97%E7%AC%A6%E7%9A%84%E7%AD%89%E4%BB%B7%E5%AD%97%E7%AC%A6">#</a>è¡¨ç¤ºæŸä¸€ç±»å‹å­—ç¬¦çš„ç­‰ä»·å­—ç¬¦</h4>
<p>ä¸‹è¡¨ä¸­çš„ç­‰ä»·å­—ç¬¦éƒ½è¡¨ç¤ºæŸä¸€ç±»å‹çš„å­—ç¬¦ã€‚</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong> <code>.</code> </strong></td>
<td>åŒ¹é…é™¤ â€œ\nâ€ ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚</td>
</tr>
<tr>
<td><strong> <code>\d</code> </strong></td>
<td>åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº [0-9]ã€‚</td>
</tr>
<tr>
<td><strong> <code>\D</code> </strong></td>
<td>åŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº [^0-9]ã€‚</td>
</tr>
<tr>
<td><strong> <code>\w</code> </strong></td>
<td>åŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ã€‚ç±»ä¼¼ä½†ä¸ç­‰ä»·äº â€œ[A-Za-z0-9_]â€ï¼Œè¿™é‡Œçš„å•è¯å­—ç¬¦æŒ‡çš„æ˜¯ Unicode å­—ç¬¦é›†ã€‚</td>
</tr>
<tr>
<td><strong> <code>\W</code> </strong></td>
<td>åŒ¹é…ä»»ä½•éå•è¯å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td><strong> <code>\s</code> </strong></td>
<td>åŒ¹é…ä»»ä½•ä¸å¯è§å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [\f\n\r\t\v]ã€‚</td>
</tr>
<tr>
<td><strong> <code>\S</code> </strong></td>
<td>åŒ¹é…ä»»ä½•å¯è§å­—ç¬¦ã€‚ç­‰ä»·äº [\f\n\r\t\v]ã€‚</td>
</tr>
</tbody>
</table>
<p>ã€ç¤ºä¾‹ã€‘åŸºæœ¬ç­‰ä»·å­—ç¬¦çš„ç”¨æ³•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// åŒ¹é…é™¤â€œ\nâ€ä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">".&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">".&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;>,./?|\\"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"[^\n]"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åŒ¹é…ä¸€ä¸ªæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº[0-9]</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\d&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"0123456789"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åŒ¹é…ä¸€ä¸ªéæ•°å­—å­—ç¬¦ã€‚ç­‰ä»·äº[^0-9]</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\D&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"0123456789"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åŒ¹é…åŒ…æ‹¬ä¸‹åˆ’çº¿çš„ä»»ä½•å•è¯å­—ç¬¦ã€‚ç±»ä¼¼ä½†ä¸ç­‰ä»·äºâ€œ[A-Za-z0-9_]â€ï¼Œè¿™é‡Œçš„å•è¯å­—ç¬¦æŒ‡çš„æ˜¯Unicodeå­—ç¬¦é›†</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\w&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\w&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;>,./?|\\"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åŒ¹é…ä»»ä½•éå•è¯å­—ç¬¦</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\W&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\W&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">"~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;>,./?|\\"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åŒ¹é…ä»»ä½•ä¸å¯è§å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº[ \f\n\r\t\v]</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\s&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">" \f\r\n\t"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åŒ¹é…ä»»ä½•å¯è§å­—ç¬¦ã€‚ç­‰ä»·äº[^ \f\n\r\t\v]</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"\\S&#123;1,&#125;"</span><span class="token punctuation">,</span> <span class="token string">" \f\r\n\t"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_	matchesï¼š .&#123;1,&#125;</span>
<span class="token comment">// ~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;>,./?|\\	matchesï¼š .&#123;1,&#125;</span>
<span class="token comment">// \n	not matchesï¼š .</span>
<span class="token comment">// \n	not matchesï¼š [^\n]</span>
<span class="token comment">// 0123456789	matchesï¼š \\d&#123;1,&#125;</span>
<span class="token comment">// 0123456789	not matchesï¼š \\D&#123;1,&#125;</span>
<span class="token comment">// ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_	matchesï¼š \\w&#123;1,&#125;</span>
<span class="token comment">// ~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;>,./?|\\	not matchesï¼š \\w&#123;1,&#125;</span>
<span class="token comment">// ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_	not matchesï¼š \\W&#123;1,&#125;</span>
<span class="token comment">// ~!@#$%^&amp;*()+`-=[]&#123;&#125;;:&lt;>,./?|\\	matchesï¼š \\W&#123;1,&#125;</span>
<span class="token comment">// \f\r\n\t	matchesï¼š \\s&#123;1,&#125;</span>
<span class="token comment">// \f\r\n\t	not matchesï¼š \\S&#123;1,&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-226"><a class="markdownIt-Anchor" href="#-226">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E9%99%90%E5%88%B6%E5%AD%97%E7%AC%A6%E6%95%B0%E9%87%8F%E7%9A%84%E7%AD%89%E4%BB%B7%E5%AD%97%E7%AC%A6">#</a>é™åˆ¶å­—ç¬¦æ•°é‡çš„ç­‰ä»·å­—ç¬¦</h4>
<p>åœ¨åŸºæœ¬å…ƒå­—ç¬¦ç« èŠ‚ä¸­ï¼Œå·²ç»ä»‹ç»äº†é™åˆ¶å­—ç¬¦æ•°é‡çš„åŸºæœ¬å…ƒå­—ç¬¦ -  <code>&#123;&#125;</code>  ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰  <code>*</code> ã€ <code>+</code> ã€ <code>?</code>  è¿™ä¸ªä¸‰ä¸ªä¸ºäº†ç®€åŒ–å†™æ³•è€Œå‡ºç°çš„ç­‰ä»·å­—ç¬¦ï¼Œæˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ã€‚</p>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ç­‰ä»·äº {0,}ã€‚</td>
</tr>
<tr>
<td><code>+</code></td>
<td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ç­‰ä»·äº {1,}ã€‚</td>
</tr>
<tr>
<td><code>?</code></td>
<td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ç­‰ä»·äº {0,1}ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>æ¡ˆä¾‹ é™åˆ¶å­—ç¬¦æ•°é‡çš„ç­‰ä»·å­—ç¬¦</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// *: åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚* ç­‰ä»·äº&#123;0,&#125;ã€‚</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap*"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap*"</span><span class="token punctuation">,</span> <span class="token string">"ap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap*"</span><span class="token punctuation">,</span> <span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap*"</span><span class="token punctuation">,</span> <span class="token string">"apppppppppp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// +: åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚+ ç­‰ä»·äº &#123;1,&#125;ã€‚</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap+"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap+"</span><span class="token punctuation">,</span> <span class="token string">"ap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap+"</span><span class="token punctuation">,</span> <span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap+"</span><span class="token punctuation">,</span> <span class="token string">"apppppppppp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ?: åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚? ç­‰ä»·äº &#123;0,1&#125;ã€‚</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap?"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap?"</span><span class="token punctuation">,</span> <span class="token string">"ap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap?"</span><span class="token punctuation">,</span> <span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token string">"ap?"</span><span class="token punctuation">,</span> <span class="token string">"apppppppppp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// a	matchesï¼š ap*</span>
<span class="token comment">// ap	matchesï¼š ap*</span>
<span class="token comment">// app	matchesï¼š ap*</span>
<span class="token comment">// apppppppppp	matchesï¼š ap*</span>
<span class="token comment">// a	not matchesï¼š ap+</span>
<span class="token comment">// ap	matchesï¼š ap+</span>
<span class="token comment">// app	matchesï¼š ap+</span>
<span class="token comment">// apppppppppp	matchesï¼š ap+</span>
<span class="token comment">// a	matchesï¼š ap?</span>
<span class="token comment">// ap	matchesï¼š ap?</span>
<span class="token comment">// app	not matchesï¼š ap?</span>
<span class="token comment">// apppppppppp	not matchesï¼š ap?</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-227"><a class="markdownIt-Anchor" href="#-227">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%85%83%E5%AD%97%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7%E9%A1%BA%E5%BA%8F">#</a>å…ƒå­—ç¬¦ä¼˜å…ˆçº§é¡ºåº</h4>
<p>æ­£åˆ™è¡¨è¾¾å¼ä»å·¦åˆ°å³è¿›è¡Œè®¡ç®—ï¼Œå¹¶éµå¾ªä¼˜å…ˆçº§é¡ºåºï¼Œè¿™ä¸ç®—æœ¯è¡¨è¾¾å¼éå¸¸ç±»ä¼¼ã€‚</p>
<p>ä¸‹è¡¨ä»æœ€é«˜åˆ°æœ€ä½è¯´æ˜äº†å„ç§æ­£åˆ™è¡¨è¾¾å¼è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é¡ºåºï¼š</p>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td>è½¬ä¹‰ç¬¦</td>
</tr>
<tr>
<td><code>()</code> ã€ <code>(?:)</code> ã€ <code>(?=)</code> ã€ <code>[]</code></td>
<td>æ‹¬å·å’Œä¸­æ‹¬å·</td>
</tr>
<tr>
<td><code>*</code> ã€ <code>+</code> ã€ <code>?</code> ã€ <code>&#123;n&#125;</code> ã€ <code>&#123;n,&#125;</code> ã€ <code>&#123;n,m&#125;</code></td>
<td>é™å®šç¬¦</td>
</tr>
<tr>
<td><code>^</code> ã€ <code>$</code> ã€ <code>*ä»»ä½•å­—ç¬¦</code> ã€ <code>ä»»ä½•å­—ç¬¦*</code></td>
<td>å®šä½ç‚¹å’Œåºåˆ—</td>
</tr>
<tr>
<td><code>|</code></td>
<td>æ›¿æ¢</td>
</tr>
</tbody>
</table>
<p>å­—ç¬¦å…·æœ‰é«˜äºæ›¿æ¢è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Œä½¿å¾—  <code>m|food</code>  åŒ¹é…  <code>m</code>  æˆ–  <code>food</code>  ã€‚è‹¥è¦åŒ¹é…  <code>mood</code>  æˆ–  <code>food</code>  ï¼Œè¯·ä½¿ç”¨æ‹¬å·åˆ›å»ºå­è¡¨è¾¾å¼ï¼Œä»è€Œäº§ç”Ÿ  <code>(m|f)ood</code>  ã€‚</p>
<h2 id="-228"><a class="markdownIt-Anchor" href="#-228">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_4-%E5%88%86%E7%BB%84%E6%9E%84%E9%80%A0">#</a>4. åˆ†ç»„æ„é€ </h2>
<p>åœ¨åŸºæœ¬å…ƒå­—ç¬¦ç« èŠ‚ï¼Œæåˆ°äº†  <code>()</code>  å­—ç¬¦å¯ä»¥ç”¨æ¥å¯¹è¡¨è¾¾å¼åˆ†ç»„ã€‚å®é™…ä¸Šåˆ†ç»„è¿˜æœ‰æ›´å¤šå¤æ‚çš„ç”¨æ³•ã€‚</p>
<p>æ‰€è°“åˆ†ç»„æ„é€ ï¼Œæ˜¯ç”¨æ¥æè¿°æ­£åˆ™è¡¨è¾¾å¼çš„å­è¡¨è¾¾å¼ï¼Œç”¨äºæ•è·å­—ç¬¦ä¸²ä¸­çš„å­å­—ç¬¦ä¸²ã€‚</p>
<h3 id="-229"><a class="markdownIt-Anchor" href="#-229">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_4-1-%E6%8D%95%E8%8E%B7%E4%B8%8E%E9%9D%9E%E6%8D%95%E8%8E%B7">#</a>4.1. æ•è·ä¸éæ•è·</h3>
<p>ä¸‹è¡¨ä¸ºåˆ†ç»„æ„é€ ä¸­çš„æ•è·å’Œéæ•è·åˆ†ç±»ã€‚</p>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>æè¿°</th>
<th>æ•è·æˆ–éæ•è·</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(exp)</code></td>
<td>åŒ¹é…çš„å­è¡¨è¾¾å¼</td>
<td>æ•è·</td>
</tr>
<tr>
<td><code>(?&lt;name&gt;exp)</code></td>
<td>å‘½åçš„åå‘å¼•ç”¨</td>
<td>æ•è·</td>
</tr>
<tr>
<td><code>(?:exp)</code></td>
<td>éæ•è·ç»„</td>
<td>éæ•è·</td>
</tr>
<tr>
<td><code>(?=exp)</code></td>
<td>é›¶å®½åº¦æ­£é¢„æµ‹å…ˆè¡Œæ–­è¨€</td>
<td>éæ•è·</td>
</tr>
<tr>
<td><code>(?!exp)</code></td>
<td>é›¶å®½åº¦è´Ÿé¢„æµ‹å…ˆè¡Œæ–­è¨€</td>
<td>éæ•è·</td>
</tr>
<tr>
<td><code>(?&lt;=exp)</code></td>
<td>é›¶å®½åº¦æ­£å›é¡¾åå‘æ–­è¨€</td>
<td>éæ•è·</td>
</tr>
<tr>
<td><code>(?&lt;!exp)</code></td>
<td>é›¶å®½åº¦è´Ÿå›é¡¾åå‘æ–­è¨€</td>
<td>éæ•è·</td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ³¨ï¼šJava æ­£åˆ™å¼•æ“ä¸æ”¯æŒå¹³è¡¡ç»„ã€‚</p>
</blockquote>
<h3 id="-230"><a class="markdownIt-Anchor" href="#-230">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_4-2-%E5%8F%8D%E5%90%91%E5%BC%95%E7%94%A8">#</a>4.2. åå‘å¼•ç”¨</h3>
<h5 id="-231"><a class="markdownIt-Anchor" href="#-231">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%B8%A6%E7%BC%96%E5%8F%B7%E7%9A%84%E5%8F%8D%E5%90%91%E5%BC%95%E7%94%A8">#</a>å¸¦ç¼–å·çš„åå‘å¼•ç”¨</h5>
<p>å¸¦ç¼–å·çš„åå‘å¼•ç”¨ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š <code>\number</code></p>
<p>å…¶ä¸­<em> number</em> æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­æ•è·ç»„çš„åºå·ä½ç½®ã€‚ ä¾‹å¦‚ï¼Œ\4 åŒ¹é…ç¬¬å››ä¸ªæ•è·ç»„çš„å†…å®¹ã€‚ å¦‚æœæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­æœªå®šä¹‰<em> number</em>ï¼Œåˆ™å°†å‘ç”Ÿåˆ†æé”™è¯¯</p>
<p><strong>ã€ç¤ºä¾‹ã€‘åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯ (ä¸å‘½åå­è¡¨è¾¾å¼)</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// (\w+)\s\1\W(\w+) åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(\\w+)\\s\\1\\W(\\w+)"</span><span class="token punctuation">,</span>
		<span class="token string">"He said that that was the the correct answer."</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = (\w+)\s\1\W(\w+), content: He said that that was the the correct answer.</span>
<span class="token comment">// [1th] start: 8, end: 21, group: that that was</span>
<span class="token comment">// [2th] start: 22, end: 37, group: the the correct</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>(\w+)</code> ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚</li>
<li><code>\s</code> ï¼šä¸ç©ºç™½å­—ç¬¦åŒ¹é…ã€‚</li>
<li><code>\1</code> ï¼šåŒ¹é…ç¬¬ä¸€ä¸ªç»„ï¼Œå³ (\w+)ã€‚</li>
<li><code>\W</code> ï¼šåŒ¹é…åŒ…æ‹¬ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·çš„ä¸€ä¸ªéå•è¯å­—ç¬¦ã€‚ è¿™æ ·å¯ä»¥é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ä»ç¬¬ä¸€ä¸ªæ•è·ç»„çš„å•è¯å¼€å¤´çš„å•è¯ã€‚</li>
</ul>
<h4 id="-232"><a class="markdownIt-Anchor" href="#-232">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%91%BD%E5%90%8D%E7%9A%84%E5%8F%8D%E5%90%91%E5%BC%95%E7%94%A8">#</a>å‘½åçš„åå‘å¼•ç”¨</h4>
<p>å‘½ååå‘å¼•ç”¨é€šè¿‡ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•è¿›è¡Œå®šä¹‰ï¼š <code>\k&lt;name &gt;</code></p>
<p><strong>ã€ç¤ºä¾‹ã€‘åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯ (å‘½åå­è¡¨è¾¾å¼)</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// (?&lt;duplicateWord>\w+)\s\k&lt;duplicateWord>\W(?&lt;nextWord>\w+) åŒ¹é…é‡å¤çš„å•è¯å’Œç´§éšæ¯ä¸ªé‡å¤çš„å•è¯çš„å•è¯</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?&lt;duplicateWord>\\w+)\\s\\k&lt;duplicateWord>\\W(?&lt;nextWord>\\w+)"</span><span class="token punctuation">,</span>
		<span class="token string">"He said that that was the the correct answer."</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = (?&lt;duplicateWord>\w+)\s\k&lt;duplicateWord>\W(?&lt;nextWord>\w+), content: He said that that was the the correct answer.</span>
<span class="token comment">// [1th] start: 8, end: 21, group: that that was</span>
<span class="token comment">// [2th] start: 22, end: 37, group: the the correct</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>(?&lt;duplicateWord&gt;\w+)</code> ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚ å‘½åæ­¤æ•è·ç»„ duplicateWordã€‚</li>
<li><code>\s</code> : ä¸ç©ºç™½å­—ç¬¦åŒ¹é…ã€‚</li>
<li><code>\k&lt;duplicateWord&gt;</code> ï¼šåŒ¹é…åä¸º duplicateWord çš„æ•è·çš„ç»„ã€‚</li>
<li><code>\W</code> ï¼šåŒ¹é…åŒ…æ‹¬ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·çš„ä¸€ä¸ªéå•è¯å­—ç¬¦ã€‚ è¿™æ ·å¯ä»¥é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ä»ç¬¬ä¸€ä¸ªæ•è·ç»„çš„å•è¯å¼€å¤´çš„å•è¯ã€‚</li>
<li><code>(?&lt;nextWord&gt;\w+)</code> ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚ å‘½åæ­¤æ•è·ç»„ nextWordã€‚</li>
</ul>
<h3 id="-233"><a class="markdownIt-Anchor" href="#-233">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_4-3-%E9%9D%9E%E6%8D%95%E8%8E%B7%E7%BB%84">#</a>4.3. éæ•è·ç»„</h3>
<p><code>(?:exp)</code>  è¡¨ç¤ºå½“ä¸€ä¸ªé™å®šç¬¦åº”ç”¨åˆ°ä¸€ä¸ªç»„ï¼Œä½†ç»„æ•è·çš„å­å­—ç¬¦ä¸²å¹¶éæ‰€éœ€æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨éæ•è·ç»„æ„é€ ã€‚</p>
<p><strong>ã€ç¤ºä¾‹ã€‘åŒ¹é…ä»¥ã€‚ç»“æŸçš„è¯­å¥ã€‚</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// åŒ¹é…ç”±å¥å·ç»ˆæ­¢çš„è¯­å¥ã€‚</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?:\\b(?:\\w+)\\W*)+\\."</span><span class="token punctuation">,</span> <span class="token string">"This is a short sentence. Never end"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = (?:\b(?:\w+)\W*)+\., content: This is a short sentence. Never end</span>
<span class="token comment">// [1th] start: 0, end: 25, group: This is a short sentence.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-234"><a class="markdownIt-Anchor" href="#-234">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_4-4-%E9%9B%B6%E5%AE%BD%E6%96%AD%E8%A8%80">#</a>4.4. é›¶å®½æ–­è¨€</h3>
<p>ç”¨äºæŸ¥æ‰¾åœ¨æŸäº›å†…å®¹ (ä½†å¹¶ä¸åŒ…æ‹¬è¿™äº›å†…å®¹) ä¹‹å‰æˆ–ä¹‹åçš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åƒ \b,^,$ é‚£æ ·ç”¨äºæŒ‡å®šä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®åº”è¯¥æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ (å³æ–­è¨€)ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿè¢«ç§°ä¸ºé›¶å®½æ–­è¨€ã€‚</p>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(?=exp)</code></td>
<td>åŒ¹é… exp å‰é¢çš„ä½ç½®</td>
</tr>
<tr>
<td><code>(?&lt;=exp)</code></td>
<td>åŒ¹é… exp åé¢çš„ä½ç½®</td>
</tr>
<tr>
<td><code>(?!exp)</code></td>
<td>åŒ¹é…åé¢è·Ÿçš„ä¸æ˜¯ exp çš„ä½ç½®</td>
</tr>
<tr>
<td><code>(?&lt;!exp)</code></td>
<td>åŒ¹é…å‰é¢ä¸æ˜¯ exp çš„ä½ç½®</td>
</tr>
</tbody>
</table>
<h4 id="-235"><a class="markdownIt-Anchor" href="#-235">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%8C%B9%E9%85%8D-exp-%E5%89%8D%E9%9D%A2%E7%9A%84%E4%BD%8D%E7%BD%AE">#</a>åŒ¹é… exp å‰é¢çš„ä½ç½®</h4>
<p><code>(?=exp)</code>  è¡¨ç¤ºè¾“å…¥å­—ç¬¦ä¸²å¿…é¡»åŒ¹é…<em>å­è¡¨è¾¾å¼</em>ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œå°½ç®¡åŒ¹é…çš„å­å­—ç¬¦ä¸²æœªåŒ…å«åœ¨åŒ¹é…ç»“æœä¸­ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// \b\w+(?=\sis\b) è¡¨ç¤ºè¦æ•è·isä¹‹å‰çš„å•è¯</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"\\b\\w+(?=\\sis\\b)"</span><span class="token punctuation">,</span> <span class="token string">"The dog is a Malamute."</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"\\b\\w+(?=\\sis\\b)"</span><span class="token punctuation">,</span> <span class="token string">"The island has beautiful birds."</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"\\b\\w+(?=\\sis\\b)"</span><span class="token punctuation">,</span> <span class="token string">"The pitch missed home plate."</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"\\b\\w+(?=\\sis\\b)"</span><span class="token punctuation">,</span> <span class="token string">"Sunday is a weekend day."</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = \b\w+(?=\sis\b), content: The dog is a Malamute.</span>
<span class="token comment">// [1th] start: 4, end: 7, group: dog</span>
<span class="token comment">// regex = \b\w+(?=\sis\b), content: The island has beautiful birds.</span>
<span class="token comment">// not found</span>
<span class="token comment">// regex = \b\w+(?=\sis\b), content: The pitch missed home plate.</span>
<span class="token comment">// not found</span>
<span class="token comment">// regex = \b\w+(?=\sis\b), content: Sunday is a weekend day.</span>
<span class="token comment">// [1th] start: 0, end: 6, group: Sunday</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>\b</code> ï¼šåœ¨å•è¯è¾¹ç•Œå¤„å¼€å§‹åŒ¹é…ã€‚</li>
<li><code>\w+</code> ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚</li>
<li><code>(?=\sis\b)</code> ï¼šç¡®å®šå•è¯å­—ç¬¦æ˜¯å¦åæ¥ç©ºç™½å­—ç¬¦å’Œå­—ç¬¦ä¸² â€œisâ€ï¼Œå…¶åœ¨å•è¯è¾¹ç•Œå¤„ç»“æŸã€‚ å¦‚æœå¦‚æ­¤ï¼Œåˆ™åŒ¹é…æˆåŠŸã€‚</li>
</ul>
<h4 id="-236"><a class="markdownIt-Anchor" href="#-236">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%8C%B9%E9%85%8D-exp-%E5%90%8E%E9%9D%A2%E7%9A%84%E4%BD%8D%E7%BD%AE">#</a>åŒ¹é… exp åé¢çš„ä½ç½®</h4>
<p><code>(?&lt;=exp)</code>  è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾—åœ¨è¾“å…¥å­—ç¬¦ä¸²å½“å‰ä½ç½®å·¦ä¾§å‡ºç°ï¼Œå°½ç®¡å­è¡¨è¾¾å¼æœªåŒ…å«åœ¨åŒ¹é…ç»“æœä¸­ã€‚é›¶å®½åº¦æ­£å›é¡¾åå‘æ–­è¨€ä¸ä¼šå›æº¯ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// (?&lt;=\b20)\d&#123;2&#125;\b è¡¨ç¤ºè¦æ•è·ä»¥20å¼€å¤´çš„æ•°å­—çš„åé¢éƒ¨åˆ†</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?&lt;=\\b20)\\d&#123;2&#125;\\b"</span><span class="token punctuation">,</span> <span class="token string">"2010 1999 1861 2140 2009"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = (?&lt;=\b20)\d&#123;2&#125;\b, content: 2010 1999 1861 2140 2009</span>
<span class="token comment">// [1th] start: 2, end: 4, group: 10</span>
<span class="token comment">// [2th] start: 22, end: 24, group: 09</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>\d&#123;2&#125;</code> ï¼šåŒ¹é…ä¸¤ä¸ªåè¿›åˆ¶æ•°å­—ã€‚</li>
<li><code>&#123;?&lt;=\b20)</code> ï¼šå¦‚æœä¸¤ä¸ªåè¿›åˆ¶æ•°å­—çš„å­—è¾¹ç•Œä»¥å°æ•°ä½æ•° â€œ20â€ å¼€å¤´ï¼Œåˆ™ç»§ç»­åŒ¹é…ã€‚</li>
<li><code>\b</code> ï¼šåœ¨å•è¯è¾¹ç•Œå¤„ç»“æŸåŒ¹é…ã€‚</li>
</ul>
<h4 id="-237"><a class="markdownIt-Anchor" href="#-237">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%8C%B9%E9%85%8D%E5%90%8E%E9%9D%A2%E8%B7%9F%E7%9A%84%E4%B8%8D%E6%98%AF-exp-%E7%9A%84%E4%BD%8D%E7%BD%AE">#</a>åŒ¹é…åé¢è·Ÿçš„ä¸æ˜¯ exp çš„ä½ç½®</h4>
<p><code>(?!exp)</code>  è¡¨ç¤ºè¾“å…¥å­—ç¬¦ä¸²ä¸å¾—åŒ¹é…<em>å­è¡¨è¾¾å¼</em>ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œå°½ç®¡åŒ¹é…çš„å­å­—ç¬¦ä¸²æœªåŒ…å«åœ¨åŒ¹é…ç»“æœä¸­ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ•è·æœªä»¥ â€œunâ€ å¼€å¤´çš„å•è¯</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// \b(?!un)\w+\b è¡¨ç¤ºè¦æ•è·æœªä»¥â€œunâ€å¼€å¤´çš„å•è¯</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"\\b(?!un)\\w+\\b"</span><span class="token punctuation">,</span> <span class="token string">"unite one unethical ethics use untie ultimate"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = \b(?!un)\w+\b, content: unite one unethical ethics use untie ultimate</span>
<span class="token comment">// [1th] start: 6, end: 9, group: one</span>
<span class="token comment">// [2th] start: 20, end: 26, group: ethics</span>
<span class="token comment">// [3th] start: 27, end: 30, group: use</span>
<span class="token comment">// [4th] start: 37, end: 45, group: ultimate</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>\b</code> ï¼šåœ¨å•è¯è¾¹ç•Œå¤„å¼€å§‹åŒ¹é…ã€‚</li>
<li><code>(?!un)</code> ï¼šç¡®å®šæ¥ä¸‹æ¥çš„ä¸¤ä¸ªçš„å­—ç¬¦æ˜¯å¦ä¸º â€œunâ€ã€‚ å¦‚æœæ²¡æœ‰ï¼Œåˆ™å¯èƒ½åŒ¹é…ã€‚</li>
<li><code>\w+</code> ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå•è¯å­—ç¬¦ã€‚</li>
<li><code>\b</code> ï¼šåœ¨å•è¯è¾¹ç•Œå¤„ç»“æŸåŒ¹é…ã€‚</li>
</ul>
<h4 id="-238"><a class="markdownIt-Anchor" href="#-238">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%8C%B9%E9%85%8D%E5%89%8D%E9%9D%A2%E4%B8%8D%E6%98%AF-exp-%E7%9A%84%E4%BD%8D%E7%BD%AE">#</a>åŒ¹é…å‰é¢ä¸æ˜¯ exp çš„ä½ç½®</h4>
<p><code>(?&lt;!exp)</code>  è¡¨ç¤ºå­è¡¨è¾¾å¼ä¸å¾—åœ¨è¾“å…¥å­—ç¬¦ä¸²å½“å‰ä½ç½®çš„å·¦ä¾§å‡ºç°ã€‚ ä½†æ˜¯ï¼Œä»»ä½•ä¸åŒ¹é…å­è¡¨è¾¾å¼ çš„å­å­—ç¬¦ä¸²ä¸åŒ…å«åœ¨åŒ¹é…ç»“æœä¸­ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ•è·ä»»æ„å·¥ä½œæ—¥</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b è¡¨ç¤ºè¦æ•è·ä»»æ„å·¥ä½œæ—¥ï¼ˆå³å‘¨ä¸€åˆ°å‘¨äº”ï¼‰</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b"</span><span class="token punctuation">,</span> <span class="token string">"Monday February 1, 2010"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b"</span><span class="token punctuation">,</span> <span class="token string">"Wednesday February 3, 2010"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b"</span><span class="token punctuation">,</span> <span class="token string">"Saturday February 6, 2010"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertFalse</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b"</span><span class="token punctuation">,</span> <span class="token string">"Sunday February 7, 2010"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"(?&lt;!(Saturday|Sunday) )\\b\\w+ \\d&#123;1,2&#125;, \\d&#123;4&#125;\\b"</span><span class="token punctuation">,</span> <span class="token string">"Monday, February 8, 2010"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Monday February 1, 2010</span>
<span class="token comment">// [1th] start: 7, end: 23, group: February 1, 2010</span>
<span class="token comment">// regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Wednesday February 3, 2010</span>
<span class="token comment">// [1th] start: 10, end: 26, group: February 3, 2010</span>
<span class="token comment">// regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Saturday February 6, 2010</span>
<span class="token comment">// not found</span>
<span class="token comment">// regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Sunday February 7, 2010</span>
<span class="token comment">// not found</span>
<span class="token comment">// regex = (?&lt;!(Saturday|Sunday) )\b\w+ \d&#123;1,2&#125;, \d&#123;4&#125;\b, content: Monday, February 8, 2010</span>
<span class="token comment">// [1th] start: 8, end: 24, group: February 8, 2010</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-239"><a class="markdownIt-Anchor" href="#-239">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_5-%E8%B4%AA%E5%A9%AA%E4%B8%8E%E6%87%92%E6%83%B0">#</a>5. è´ªå©ªä¸æ‡’æƒ°</h2>
<p>å½“æ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ…å«èƒ½æ¥å—é‡å¤çš„é™å®šç¬¦æ—¶ï¼Œé€šå¸¸çš„è¡Œä¸ºæ˜¯ï¼ˆåœ¨ä½¿æ•´ä¸ªè¡¨è¾¾å¼èƒ½å¾—åˆ°åŒ¹é…çš„å‰æä¸‹ï¼‰åŒ¹é…<strong>å°½å¯èƒ½å¤š</strong>çš„å­—ç¬¦ã€‚ä»¥è¿™ä¸ªè¡¨è¾¾å¼ä¸ºä¾‹ï¼ša.*bï¼Œå®ƒå°†ä¼šåŒ¹é…æœ€é•¿çš„ä»¥ a å¼€å§‹ï¼Œä»¥ b ç»“æŸçš„å­—ç¬¦ä¸²ã€‚å¦‚æœç”¨å®ƒæ¥æœç´¢ aabab çš„è¯ï¼Œå®ƒä¼šåŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸² aababã€‚è¿™è¢«ç§°ä¸ºè´ªå©ªåŒ¹é…ã€‚</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬æ›´éœ€è¦æ‡’æƒ°åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯åŒ¹é…<strong>å°½å¯èƒ½å°‘</strong>çš„å­—ç¬¦ã€‚å‰é¢ç»™å‡ºçš„é™å®šç¬¦éƒ½å¯ä»¥è¢«è½¬åŒ–ä¸ºæ‡’æƒ°åŒ¹é…æ¨¡å¼ï¼Œåªè¦åœ¨å®ƒåé¢åŠ ä¸Šä¸€ä¸ªé—®å·ï¼Ÿã€‚è¿™æ ·.*? å°±æ„å‘³ç€åŒ¹é…ä»»æ„æ•°é‡çš„é‡å¤ï¼Œä½†æ˜¯åœ¨èƒ½ä½¿æ•´ä¸ªåŒ¹é…æˆåŠŸçš„å‰æä¸‹ä½¿ç”¨æœ€å°‘çš„é‡å¤ã€‚</p>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*?</code></td>
<td>é‡å¤ä»»æ„æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</td>
</tr>
<tr>
<td><code>+?</code></td>
<td>é‡å¤ 1 æ¬¡æˆ–æ›´å¤šæ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</td>
</tr>
<tr>
<td><code>??</code></td>
<td>é‡å¤ 0 æ¬¡æˆ– 1 æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</td>
</tr>
<tr>
<td><code>&#123;n,m&#125;?</code></td>
<td>é‡å¤ n åˆ° m æ¬¡ï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</td>
</tr>
<tr>
<td><code>&#123;n,&#125;?</code></td>
<td>é‡å¤ n æ¬¡ä»¥ä¸Šï¼Œä½†å°½å¯èƒ½å°‘é‡å¤</td>
</tr>
</tbody>
</table>
<p>ã€ç¤ºä¾‹ã€‘Java æ­£åˆ™ä¸­è´ªå©ªä¸æ‡’æƒ°çš„ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è´ªå©ªåŒ¹é…</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"a\\w*b"</span><span class="token punctuation">,</span> <span class="token string">"abaabaaabaaaab"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ‡’æƒ°åŒ¹é…</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"a\\w*?b"</span><span class="token punctuation">,</span> <span class="token string">"abaabaaabaaaab"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"a\\w+?b"</span><span class="token punctuation">,</span> <span class="token string">"abaabaaabaaaab"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"a\\w??b"</span><span class="token punctuation">,</span> <span class="token string">"abaabaaabaaaab"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"a\\w&#123;0,4&#125;?b"</span><span class="token punctuation">,</span> <span class="token string">"abaabaaabaaaab"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertTrue</span><span class="token punctuation">(</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token string">"a\\w&#123;3,&#125;?b"</span><span class="token punctuation">,</span> <span class="token string">"abaabaaabaaaab"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¾“å‡º</span>
<span class="token comment">// regex = a\w*b, content: abaabaaabaaaab</span>
<span class="token comment">// [1th] start: 0, end: 14, group: abaabaaabaaaab</span>
<span class="token comment">// regex = a\w*?b, content: abaabaaabaaaab</span>
<span class="token comment">// [1th] start: 0, end: 2, group: ab</span>
<span class="token comment">// [2th] start: 2, end: 5, group: aab</span>
<span class="token comment">// [3th] start: 5, end: 9, group: aaab</span>
<span class="token comment">// [4th] start: 9, end: 14, group: aaaab</span>
<span class="token comment">// regex = a\w+?b, content: abaabaaabaaaab</span>
<span class="token comment">// [1th] start: 0, end: 5, group: abaab</span>
<span class="token comment">// [2th] start: 5, end: 9, group: aaab</span>
<span class="token comment">// [3th] start: 9, end: 14, group: aaaab</span>
<span class="token comment">// regex = a\w??b, content: abaabaaabaaaab</span>
<span class="token comment">// [1th] start: 0, end: 2, group: ab</span>
<span class="token comment">// [2th] start: 2, end: 5, group: aab</span>
<span class="token comment">// [3th] start: 6, end: 9, group: aab</span>
<span class="token comment">// [4th] start: 11, end: 14, group: aab</span>
<span class="token comment">// regex = a\w&#123;0,4&#125;?b, content: abaabaaabaaaab</span>
<span class="token comment">// [1th] start: 0, end: 2, group: ab</span>
<span class="token comment">// [2th] start: 2, end: 5, group: aab</span>
<span class="token comment">// [3th] start: 5, end: 9, group: aaab</span>
<span class="token comment">// [4th] start: 9, end: 14, group: aaaab</span>
<span class="token comment">// regex = a\w&#123;3,&#125;?b, content: abaabaaabaaaab</span>
<span class="token comment">// [1th] start: 0, end: 5, group: abaab</span>
<span class="token comment">// [2th] start: 5, end: 14, group: aaabaaaab</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<p>æœ¬ä¾‹ä¸­ä»£ç å±•ç¤ºçš„æ˜¯ä½¿ç”¨ä¸åŒè´ªå©ªæˆ–æ‡’æƒ°ç­–ç•¥å»æŸ¥æ‰¾å­—ç¬¦ä¸²  <code>abaabaaabaaaab</code>  ä¸­åŒ¹é…<strong>ä»¥  <code>a</code>  å¼€å¤´ï¼Œä»¥  <code>b</code>  ç»“å°¾çš„æ‰€æœ‰å­å­—ç¬¦ä¸²</strong>ã€‚è¯·ä»è¾“å‡ºç»“æœä¸­ï¼Œç»†ç»†ä½“å‘³ä½¿ç”¨ä¸åŒçš„è´ªå©ªæˆ–æ‡’æƒ°ç­–ç•¥ï¼Œå¯¹äºåŒ¹é…å­å­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå½±å“ã€‚</p>
<h2 id="-240"><a class="markdownIt-Anchor" href="#-240">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_6-%E6%AD%A3%E5%88%99%E9%99%84%E5%BD%95">#</a>6. æ­£åˆ™é™„å½•</h2>
<h3 id="-241"><a class="markdownIt-Anchor" href="#-241">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_6-1-%E5%8C%B9%E9%85%8D%E6%AD%A3%E5%88%99%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%96%B9%E6%B3%95">#</a>6.1. åŒ¹é…æ­£åˆ™å­—ç¬¦ä¸²çš„æ–¹æ³•</h3>
<p>ç”±äºæ­£åˆ™è¡¨è¾¾å¼ä¸­å¾ˆå¤šå…ƒå­—ç¬¦æœ¬èº«å°±æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œåœ¨ Java å­—ç¬¦ä¸²çš„è§„åˆ™ä¸­ä¸ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>ä¸ºæ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå·¥å…·ç±» <code>org.apache.commons.lang3.StringEscapeUtils</code>  æ¥åšç‰¹æ®Šå¤„ç†ï¼Œä½¿å¾—è½¬ä¹‰å­—ç¬¦å¯ä»¥æ‰“å°ã€‚è¿™ä¸ªå·¥å…·ç±»æä¾›çš„éƒ½æ˜¯é™æ€æ–¹æ³•ï¼Œä»æ–¹æ³•å‘½åå¤§è‡´ä¹Ÿå¯ä»¥çŒœå‡ºç”¨æ³•ï¼Œè¿™é‡Œä¸å¤šåšè¯´æ˜ã€‚</p>
<p>å¦‚æœä½ äº†è§£ mavenï¼Œå¯ä»¥ç›´æ¥å¼•å…¥ä¾èµ–</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>commons-lang3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;commons-lang3.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘æœ¬æ–‡ä¸ºäº†å±•ç¤ºæ­£åˆ™åŒ¹é…è§„åˆ™ç”¨åˆ°çš„æ–¹æ³•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">checkMatches</span><span class="token punctuation">(</span><span class="token class-name">String</span> regex<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> flag <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StringEscapeUtils</span><span class="token punctuation">.</span><span class="token function">escapeJava</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\tmatchesï¼š "</span> <span class="token operator">+</span> <span class="token class-name">StringEscapeUtils</span><span class="token punctuation">.</span><span class="token function">escapeJava</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">StringEscapeUtils</span><span class="token punctuation">.</span><span class="token function">escapeJava</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\tnot matchesï¼š "</span> <span class="token operator">+</span> <span class="token class-name">StringEscapeUtils</span><span class="token punctuation">.</span><span class="token function">escapeJava</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> flag<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">String</span> regex<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"regex = "</span> <span class="token operator">+</span> regex <span class="token operator">+</span> <span class="token string">", content: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		count<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"["</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">"th] "</span> <span class="token operator">+</span> <span class="token string">"start: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", end: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token operator">+</span> <span class="token string">", group: "</span> <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> count<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-242"><a class="markdownIt-Anchor" href="#-242">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_6-2-%E9%80%9F%E6%9F%A5%E5%85%83%E5%AD%97%E7%AC%A6%E5%AD%97%E5%85%B8">#</a>6.2. é€ŸæŸ¥å…ƒå­—ç¬¦å­—å…¸</h3>
<p>ä¸ºäº†æ–¹ä¾¿å¿«æŸ¥æ­£åˆ™çš„å…ƒå­—ç¬¦å«ä¹‰ï¼Œåœ¨æœ¬èŠ‚æ ¹æ®å…ƒå­—ç¬¦çš„åŠŸèƒ½é›†ä¸­ç½—åˆ—æ­£åˆ™çš„å„ç§å…ƒå­—ç¬¦ã€‚</p>
<h4 id="-243"><a class="markdownIt-Anchor" href="#-243">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E9%99%90%E5%AE%9A%E7%AC%A6">#</a>é™å®šç¬¦</h4>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>*</code></td>
<td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œzo* èƒ½åŒ¹é… â€œzâ€ ä»¥åŠ â€œzooâ€ã€‚* ç­‰ä»·äº {0,}ã€‚</td>
</tr>
<tr>
<td><code>+</code></td>
<td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜zo+â€™ èƒ½åŒ¹é… â€œzoâ€ ä»¥åŠ â€œzooâ€ï¼Œä½†ä¸èƒ½åŒ¹é… â€œzâ€ã€‚+ ç­‰ä»·äº {1,}ã€‚</td>
</tr>
<tr>
<td><code>?</code></td>
<td>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€œdo (es)?â€ å¯ä»¥åŒ¹é… â€œdoâ€ æˆ– â€œdoesâ€ ä¸­çš„ &quot;do&quot; ã€‚? ç­‰ä»·äº {0,1}ã€‚</td>
</tr>
<tr>
<td><code>&#123;n&#125;</code></td>
<td>n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ n æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜o {2}â€™ ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ â€˜oâ€™ï¼Œä½†æ˜¯èƒ½åŒ¹é… â€œfoodâ€ ä¸­çš„ä¸¤ä¸ª oã€‚</td>
</tr>
<tr>
<td><code>&#123;n,&#125;</code></td>
<td>n æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… n æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€˜o {2,}â€™ ä¸èƒ½åŒ¹é… â€œBobâ€ ä¸­çš„ â€˜oâ€™ï¼Œä½†èƒ½åŒ¹é… â€œfooooodâ€ ä¸­çš„æ‰€æœ‰ oã€‚â€˜o {1,}â€™ ç­‰ä»·äº â€˜o+â€™ã€‚â€˜o {0,}â€™ åˆ™ç­‰ä»·äº â€˜o*â€™ã€‚</td>
</tr>
<tr>
<td><code>&#123;n,m&#125;</code></td>
<td>m å’Œ n å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ n &lt;= mã€‚æœ€å°‘åŒ¹é… n æ¬¡ä¸”æœ€å¤šåŒ¹é… m æ¬¡ã€‚ä¾‹å¦‚ï¼Œâ€œo {1,3}â€ å°†åŒ¹é… â€œfoooooodâ€ ä¸­çš„å‰ä¸‰ä¸ª oã€‚â€˜o {0,1}â€™ ç­‰ä»·äº â€˜o?â€™ã€‚è¯·æ³¨æ„åœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</td>
</tr>
</tbody>
</table>
<h4 id="-244"><a class="markdownIt-Anchor" href="#-244">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%AE%9A%E4%BD%8D%E7%AC%A6">#</a>å®šä½ç¬¦</h4>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>^</code></td>
<td>åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²å¼€å§‹çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ^ è¿˜ä¼šä¸ \n æˆ– \r ä¹‹åçš„ä½ç½®åŒ¹é…ã€‚</td>
</tr>
<tr>
<td><code>$</code></td>
<td>åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²ç»“å°¾çš„ä½ç½®ã€‚å¦‚æœè®¾ç½®äº† RegExp å¯¹è±¡çš„ Multiline å±æ€§ï¼Œ$ è¿˜ä¼šä¸ \n æˆ– \r ä¹‹å‰çš„ä½ç½®åŒ¹é…ã€‚</td>
</tr>
<tr>
<td><code>\b</code></td>
<td>åŒ¹é…ä¸€ä¸ªå­—è¾¹ç•Œï¼Œå³å­—ä¸ç©ºæ ¼é—´çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td><code>\B</code></td>
<td>éå­—è¾¹ç•ŒåŒ¹é…ã€‚</td>
</tr>
</tbody>
</table>
<h4 id="-245"><a class="markdownIt-Anchor" href="#-245">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E9%9D%9E%E6%89%93%E5%8D%B0%E5%AD%97%E7%AC%A6">#</a>éæ‰“å°å­—ç¬¦</h4>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\cx</code></td>
<td>åŒ¹é…ç”± x æŒ‡æ˜çš„æ§åˆ¶å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œ \cM åŒ¹é…ä¸€ä¸ª Control-M æˆ–å›è½¦ç¬¦ã€‚x çš„å€¼å¿…é¡»ä¸º A-Z æˆ– a-z ä¹‹ä¸€ã€‚å¦åˆ™ï¼Œå°† c è§†ä¸ºä¸€ä¸ªåŸä¹‰çš„ â€˜câ€™ å­—ç¬¦ã€‚</td>
</tr>
<tr>
<td><code>\f</code></td>
<td>åŒ¹é…ä¸€ä¸ªæ¢é¡µç¬¦ã€‚ç­‰ä»·äº \x0c å’Œ \cLã€‚</td>
</tr>
<tr>
<td><code>\n</code></td>
<td>åŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ç­‰ä»·äº \x0a å’Œ \cJã€‚</td>
</tr>
<tr>
<td><code>\r</code></td>
<td>åŒ¹é…ä¸€ä¸ªå›è½¦ç¬¦ã€‚ç­‰ä»·äº \x0d å’Œ \cMã€‚</td>
</tr>
<tr>
<td><code>\s</code></td>
<td>åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚ç­‰ä»·äº [\f\n\r\t\v]ã€‚</td>
</tr>
<tr>
<td><code>\S</code></td>
<td>åŒ¹é…ä»»ä½•éç©ºç™½å­—ç¬¦ã€‚ç­‰ä»·äº [\f\n\r\t\v]ã€‚</td>
</tr>
<tr>
<td><code>\t</code></td>
<td>åŒ¹é…ä¸€ä¸ªåˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \x09 å’Œ \cIã€‚</td>
</tr>
<tr>
<td><code>\v</code></td>
<td>åŒ¹é…ä¸€ä¸ªå‚ç›´åˆ¶è¡¨ç¬¦ã€‚ç­‰ä»·äº \x0b å’Œ \cKã€‚</td>
</tr>
</tbody>
</table>
<h4 id="-246"><a class="markdownIt-Anchor" href="#-246">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%88%86%E7%BB%84-2">#</a>åˆ†ç»„</h4>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(exp)</code></td>
<td>åŒ¹é…çš„å­è¡¨è¾¾å¼ã€‚() ä¸­çš„å†…å®¹å°±æ˜¯å­è¡¨è¾¾å¼ã€‚</td>
</tr>
<tr>
<td><code>(?&lt;name&gt;exp)</code></td>
<td>å‘½åçš„å­è¡¨è¾¾å¼ï¼ˆåå‘å¼•ç”¨ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>(?:exp)</code></td>
<td>éæ•è·ç»„ï¼Œè¡¨ç¤ºå½“ä¸€ä¸ªé™å®šç¬¦åº”ç”¨åˆ°ä¸€ä¸ªç»„ï¼Œä½†ç»„æ•è·çš„å­å­—ç¬¦ä¸²å¹¶éæ‰€éœ€æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨éæ•è·ç»„æ„é€ ã€‚</td>
</tr>
<tr>
<td><code>(?=exp)</code></td>
<td>åŒ¹é… exp å‰é¢çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td><code>(?&lt;=exp)</code></td>
<td>åŒ¹é… exp åé¢çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td><code>(?!exp)</code></td>
<td>åŒ¹é…åé¢è·Ÿçš„ä¸æ˜¯ exp çš„ä½ç½®ã€‚</td>
</tr>
<tr>
<td><code>(?&lt;!exp)</code></td>
<td>åŒ¹é…å‰é¢ä¸æ˜¯ exp çš„ä½ç½®ã€‚</td>
</tr>
</tbody>
</table>
<h4 id="-247"><a class="markdownIt-Anchor" href="#-247">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7">#</a>ç‰¹æ®Šç¬¦å·</h4>
<table>
<thead>
<tr>
<th>å­—ç¬¦</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>\</code></td>
<td>å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºæˆ–ç‰¹æ®Šå­—ç¬¦ã€æˆ–åŸä¹‰å­—ç¬¦ã€æˆ–å‘åå¼•ç”¨ã€æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ â€˜nâ€™ åŒ¹é…å­—ç¬¦ â€˜nâ€™ã€‚â€™\nâ€™ åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ— â€˜â€™ åŒ¹é… â€œâ€ï¼Œè€Œ â€˜(â€™ åˆ™åŒ¹é… â€œ(â€ã€‚</td>
</tr>
<tr>
<td><code>\|</code></td>
<td>æŒ‡æ˜ä¸¤é¡¹ä¹‹é—´çš„ä¸€ä¸ªé€‰æ‹©ã€‚</td>
</tr>
<tr>
<td><code>[]</code></td>
<td>åŒ¹é…æ–¹æ‹¬å·èŒƒå›´å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚å½¢å¼å¦‚ï¼š[xyz]ã€[<sup>xyz]ã€[a-z]ã€[</sup>a-z]ã€[x,y,z]</td>
</tr>
</tbody>
</table>
<h2 id="-248"><a class="markdownIt-Anchor" href="#-248">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_7-%E6%AD%A3%E5%88%99%E5%AE%9E%E6%88%98">#</a>7. æ­£åˆ™å®æˆ˜</h2>
<p>è™½ç„¶æœ¬ç³»åˆ—æ´‹æ´‹æ´’æ´’çš„å¤§è°ˆç‰¹è°ˆæ­£åˆ™è¡¨è¾¾å¼ã€‚ä½†æ˜¯æˆ‘è¿˜æ˜¯è¦åœ¨è¿™é‡Œå»ºè®®ï¼Œå¦‚æœä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰ç»è¿‡å……åˆ†æµ‹è¯•ï¼Œè¿˜æ˜¯è¦è°¨æ…ä½¿ç”¨ã€‚</p>
<p>æ­£åˆ™æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œå®ƒå¯ä»¥ä¸ºä½ èŠ‚çœå¤§é‡çš„ä»£ç è¡Œã€‚ä½†æ˜¯ç”±äºå®ƒä¸æ˜“é˜…è¯»ï¼Œç»´æŠ¤èµ·æ¥å¯æ˜¯å¤´ç–¼çš„å“¦ï¼ˆä½ éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦çš„å»ç†è§£ï¼‰ã€‚</p>
<h3 id="-249"><a class="markdownIt-Anchor" href="#-249">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_7-1-%E6%9C%80%E5%AE%9E%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99">#</a>7.1. æœ€å®ç”¨çš„æ­£åˆ™</h3>
<h4 id="-250"><a class="markdownIt-Anchor" href="#-250">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E4%B8%AD%E6%96%87">#</a>æ ¡éªŒä¸­æ–‡</h4>
<p>æ ¡éªŒå­—ç¬¦ä¸²ä¸­åªèƒ½æœ‰ä¸­æ–‡å­—ç¬¦ï¼ˆä¸åŒ…æ‹¬ä¸­æ–‡æ ‡ç‚¹ç¬¦å·ï¼‰ã€‚ä¸­æ–‡å­—ç¬¦çš„ Unicode ç¼–ç èŒƒå›´æ˜¯  <code>\u4e00</code>  åˆ°  <code>\u9fa5</code> ã€‚</p>
<blockquote>
<p>å¦‚æœ‰å…´è¶£ï¼Œå¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="http://baike.baidu.com/link?url=3xi0vmvCIGKQLJZdn_BYhQ1IDFsoSJMrya6_eOjCBb7A6cRIW-zhZFLC9Yh8wjxU6A_HCfNuP8FBBXU9CN3Wcq"><strong>ç™¾åº¦ç™¾ç§‘ - Unicode</strong> (opens new window)</a>ã€‚</p>
</blockquote>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^[\u4e00-\u9fa5]+$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>åŒ¹é…ï¼š</strong> æ˜¥çœ ä¸è§‰æ™“</li>
<li>** ä¸åŒ¹é…ï¼š** æ˜¥çœ ä¸è§‰æ™“ï¼Œ</li>
</ul>
<h4 id="-251"><a class="markdownIt-Anchor" href="#-251">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E8%BA%AB%E4%BB%BD%E8%AF%81%E5%8F%B7%E7%A0%81">#</a>æ ¡éªŒèº«ä»½è¯å·ç </h4>
<p>èº«ä»½è¯ä¸º 15 ä½æˆ– 18 ä½ã€‚15 ä½æ˜¯ç¬¬ä¸€ä»£èº«ä»½è¯ã€‚ä» 1999 å¹´ 10 æœˆ 1 æ—¥èµ·ï¼Œå…¨å›½å®è¡Œå…¬æ°‘èº«ä»½è¯å·ç åˆ¶åº¦ï¼Œå±…æ°‘èº«ä»½è¯ç¼–å·ç”±åŸ 15 ä½å‡è‡³ 18 ä½ã€‚</p>
<ul>
<li><strong>15 ä½èº«ä»½è¯</strong>ï¼šç”± 15 ä½æ•°å­—ç»„æˆã€‚æ’åˆ—é¡ºåºä»å·¦è‡³å³ä¾æ¬¡ä¸ºï¼šå…­ä½æ•°å­—åœ°åŒºç ï¼›å…­ä½æ•°å­—å‡ºç”Ÿæ—¥æœŸï¼›ä¸‰ä½é¡ºåºå·ï¼Œå…¶ä¸­ 15 ä½ç”·ä¸ºå•æ•°ï¼Œå¥³ä¸ºåŒæ•°ã€‚</li>
<li><strong>18 ä½èº«ä»½è¯</strong>ï¼šç”±åä¸ƒä½æ•°å­—æœ¬ä½“ç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ç»„æˆã€‚æ’åˆ—é¡ºåºä»å·¦è‡³å³ä¾æ¬¡ä¸ºï¼šå…­ä½æ•°å­—åœ°åŒºç ï¼›å…«ä½æ•°å­—å‡ºç”Ÿæ—¥æœŸï¼›ä¸‰ä½æ•°å­—é¡ºåºç å’Œä¸€ä½æ•°å­—æ ¡éªŒç ï¼ˆä¹Ÿå¯èƒ½æ˜¯ Xï¼‰ã€‚</li>
</ul>
<blockquote>
<p>èº«ä»½è¯å·å«ä¹‰è¯¦æƒ…è¯·è§ï¼š<a target="_blank" rel="noopener" href="http://baike.baidu.com/link?url=5mYlYNE0RsSe2D4tydajtiaR8hAm4pPZ0FHSPuQ05N4f6H-i7qPuw7sY5KfNuiOVJWVWZvU4gf3IY-vIcKdP1CU4Fv-9pKmFQB50qGv_hZT2dkGbkd9--8_saY7omV80vEw9ixVeEwda37fHswfmtyU4QSiBG5s3K5K-JnYr1dqNlPu0f3t008UcLh5-wyID"><strong>ç™¾åº¦ç™¾ç§‘ - å±…æ°‘èº«ä»½è¯å·ç </strong> (opens new window)</a></p>
</blockquote>
<p><strong>åœ°åŒºç ï¼ˆ6 ä½ï¼‰</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">(1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\d&#123;4&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>å‡ºç”Ÿæ—¥æœŸï¼ˆ8 ä½ï¼‰</strong></p>
<p>æ³¨ï¼šä¸‹é¢çš„æ˜¯ 18 ä½èº«ä»½è¯çš„æœ‰æ•ˆå‡ºç”Ÿæ—¥æœŸï¼Œå¦‚æœæ˜¯ 15 ä½èº«ä»½è¯ï¼Œåªè¦å°†ç¬¬ä¸€ä¸ª \d {4} æ”¹ä¸º \d {2} å³å¯ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">((\d&#123;4&#125;((0[13578]|1[02])(0[1-9]|[12]\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\d|30)|02(0[1-9]|1\d|2[0-8])))|([02468][048]|[13579][26])0229)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>15 ä½æœ‰æ•ˆèº«ä»½è¯</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\d&#123;4&#125;)((\d&#123;2&#125;((0[13578]|1[02])(0[1-9]|[12]\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\d|30)|02(0[1-9]|1\d|2[0-8])))|([02468][048]|[13579][26])0229)(\d&#123;3&#125;)$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**110001700101031</li>
<li>** ä¸åŒ¹é…ï¼š**110001701501031</li>
</ul>
<p><strong>18 ä½æœ‰æ•ˆèº«ä»½è¯</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^((1[1-5]|2[1-3]|3[1-7]|4[1-3]|5[0-4]|6[1-5])\d&#123;4&#125;)((\d&#123;4&#125;((0[13578]|1[02])(0[1-9]|[12]\d|3[01])|(0[13456789]|1[012])(0[1-9]|[12]\d|30)|02(0[1-9]|1\d|2[0-8])))|([02468][048]|[13579][26])0229)(\d&#123;3&#125;(\d|X))$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**110001199001010310 | 11000019900101015X</li>
<li>** ä¸åŒ¹é…ï¼š**990000199001010310 | 110001199013010310</li>
</ul>
<h4 id="-252"><a class="markdownIt-Anchor" href="#-252">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E6%9C%89%E6%95%88%E7%94%A8%E6%88%B7%E5%90%8D%E3%80%81%E5%AF%86%E7%A0%81">#</a>æ ¡éªŒæœ‰æ•ˆç”¨æˆ·åã€å¯†ç </h4>
<p>** æè¿°ï¼š** é•¿åº¦ä¸º 6-18 ä¸ªå­—ç¬¦ï¼Œå…è®¸è¾“å…¥å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œé¦–å­—ç¬¦å¿…é¡»ä¸ºå­—æ¯ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^[a-zA-Z]\w&#123;5,17&#125;$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**he_llo@worl.d.com | <a href="mailto:hel.l-o@wor-ld.museum">hel.l-o@wor-ld.museum</a> | <a href="mailto:h1ello@123.com">h1ello@123.com</a></li>
<li>** ä¸åŒ¹é…ï¼š**hello@worl_d.com | he&amp;llo@world.co1 | .hello@wor#.co.uk</li>
</ul>
<h4 id="-253"><a class="markdownIt-Anchor" href="#-253">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E9%82%AE%E7%AE%B1">#</a>æ ¡éªŒé‚®ç®±</h4>
<p>** æè¿°ï¼š** ä¸å…è®¸ä½¿ç”¨ IP ä½œä¸ºåŸŸåï¼Œå¦‚ : <a href="mailto:hello@154.145.68.12">hello@154.145.68.12</a></p>
<p><code>@</code> ç¬¦å·å‰çš„é‚®ç®±ç”¨æˆ·å’Œ <code>.</code>  ç¬¦å·å‰çš„åŸŸå (domain) å¿…é¡»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>å­—ç¬¦åªèƒ½æ˜¯è‹±æ–‡å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ <code>_</code> ã€ <code>.</code> ã€ <code>-</code>  ï¼›</li>
<li>é¦–å­—ç¬¦å¿…é¡»ä¸ºå­—æ¯æˆ–æ•°å­—ï¼›</li>
<li><code>_</code> ã€ <code>.</code> ã€ <code>-</code>  ä¸èƒ½è¿ç»­å‡ºç°ã€‚</li>
</ul>
<p>åŸŸåçš„æ ¹åŸŸåªèƒ½ä¸ºå­—æ¯ï¼Œä¸”è‡³å°‘ä¸ºä¸¤ä¸ªå­—ç¬¦ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^[A-Za-z0-9](([_\.\-]?[a-zA-Z0-9]+)*)@([A-Za-z0-9]+)(([\.\-]?[a-zA-Z0-9]+)*)\.([A-Za-z]&#123;2,&#125;)$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**he_llo@worl.d.com | <a href="mailto:hel.l-o@wor-ld.museum">hel.l-o@wor-ld.museum</a> | <a href="mailto:h1ello@123.com">h1ello@123.com</a></li>
<li>** ä¸åŒ¹é…ï¼š**hello@worl_d.com | he&amp;llo@world.co1 | .hello@wor#.co.uk</li>
</ul>
<h4 id="-254"><a class="markdownIt-Anchor" href="#-254">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C-url">#</a>æ ¡éªŒ URL</h4>
<p>** æè¿°ï¼š** æ ¡éªŒ URLã€‚æ”¯æŒ httpã€httpsã€ftpã€ftpsã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^(ht|f)(tp|tps)\://[a-zA-Z0-9\-\.]+\.([a-zA-Z]&#123;2,3&#125;)?(/\S*)?$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**<a target="_blank" rel="noopener" href="http://google.com/help/me">http://google.com/help/me</a> | <a target="_blank" rel="noopener" href="http://www.google.com/help/me/">http://www.google.com/help/me/</a> | <a target="_blank" rel="noopener" href="https://www.google.com/help.asp">https://www.google.com/help.asp</a> | <a href="ftp://www.google.com">ftp://www.google.com</a> | ftps://google.org</li>
<li>** ä¸åŒ¹é…ï¼š**<a target="_blank" rel="noopener" href="http://un/www.google.com/index.asp">http://un/www.google.com/index.asp</a></li>
</ul>
<h4 id="-255"><a class="markdownIt-Anchor" href="#-255">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E6%97%B6%E9%97%B4">#</a>æ ¡éªŒæ—¶é—´</h4>
<p>** æè¿°ï¼š** æ ¡éªŒæ—¶é—´ã€‚æ—¶ã€åˆ†ã€ç§’å¿…é¡»æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œå¦‚æœæ•°å€¼ä¸æ˜¯ä¸¤ä½æ•°ï¼Œåä½éœ€è¦è¡¥é›¶ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^([0-1][0-9]|[2][0-3]):([0-5][0-9])$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**00:00:00 | 23:59:59 | 17:06:30</li>
<li>** ä¸åŒ¹é…ï¼š**17:6:30 | 24:16:30</li>
</ul>
<h4 id="-256"><a class="markdownIt-Anchor" href="#-256">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E6%97%A5%E6%9C%9F">#</a>æ ¡éªŒæ—¥æœŸ</h4>
<p>** æè¿°ï¼š** æ ¡éªŒæ—¥æœŸã€‚æ—¥æœŸæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>æ ¼å¼ yyyy-MM-dd æˆ– yyyy-M-d</li>
<li>è¿å­—ç¬¦å¯ä»¥æ²¡æœ‰æˆ–æ˜¯ â€œ-â€ã€â€œ/â€ã€â€œ.â€ ä¹‹ä¸€</li>
<li>é—°å¹´çš„äºŒæœˆå¯ä»¥æœ‰ 29 æ—¥ï¼›è€Œå¹³å¹´ä¸å¯ä»¥ã€‚</li>
<li>ä¸€ã€ä¸‰ã€äº”ã€ä¸ƒã€å…«ã€åã€åäºŒæœˆä¸º 31 æ—¥ã€‚å››ã€å…­ã€ä¹ã€åä¸€æœˆä¸º 30 æ—¥ã€‚</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^(?:(?!0000)[0-9]&#123;4&#125;([-/.]?)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]&#123;2&#125;(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**2016/1/1 | 2016/01/01 | 20160101 | 2016-01-01 | 2016.01.01 | 2000-02-29</li>
<li>** ä¸åŒ¹é…ï¼š**2001-02-29 | 2016/12/32 | 2016/6/31 | 2016/13/1 | 2016/0/1</li>
</ul>
<h4 id="-257"><a class="markdownIt-Anchor" href="#-257">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E4%B8%AD%E5%9B%BD%E6%89%8B%E6%9C%BA%E5%8F%B7%E7%A0%81">#</a>æ ¡éªŒä¸­å›½æ‰‹æœºå·ç </h4>
<p>** æè¿°ï¼š** ä¸­å›½æ‰‹æœºå·ç æ­£ç¡®æ ¼å¼ï¼š11 ä½æ•°å­—ã€‚</p>
<blockquote>
<p>ç§»åŠ¨æœ‰ 16 ä¸ªå·æ®µï¼š134ã€135ã€136ã€137ã€138ã€139ã€147ã€150ã€151ã€152ã€157ã€158ã€159ã€182ã€187ã€188ã€‚å…¶ä¸­ 147ã€157ã€188 æ˜¯ 3G å·æ®µï¼Œå…¶ä»–éƒ½æ˜¯ 2G å·æ®µã€‚è”é€šæœ‰ 7 ç§å·æ®µï¼š130ã€131ã€132ã€155ã€156ã€185ã€186ã€‚å…¶ä¸­ 186 æ˜¯ 3Gï¼ˆWCDMAï¼‰å·æ®µï¼Œå…¶ä½™ä¸º 2G å·æ®µã€‚ç”µä¿¡æœ‰ 4 ä¸ªå·æ®µï¼š133ã€153ã€180ã€189ã€‚å…¶ä¸­ 189 æ˜¯ 3G å·æ®µï¼ˆCDMA2000ï¼‰ï¼Œ133 å·æ®µä¸»è¦ç”¨ä½œæ— çº¿ç½‘å¡å·ã€‚æ€»ç»“ï¼š13 å¼€å¤´æ‰‹æœºå· 0-9ï¼›15 å¼€å¤´æ‰‹æœºå· 0-3ã€5-9ï¼›18 å¼€å¤´æ‰‹æœºå· 0ã€2ã€5-9ã€‚</p>
<p>æ­¤å¤–ï¼Œä¸­å›½åœ¨å›½é™…ä¸Šçš„åŒºå·ä¸º 86ï¼Œæ‰€ä»¥æ‰‹æœºå·å¼€å¤´æœ‰ + 86ã€86 ä¹Ÿæ˜¯åˆæ³•çš„ã€‚</p>
<p>ä»¥ä¸Šä¿¡æ¯æ¥æºäº <a target="_blank" rel="noopener" href="http://baike.baidu.com/link?url=Bia2K_f8rGcakOlP4d9m_-DNSgXU5-0NDP0pPavS0ZbhRHQcUFUTbMERjdO4u7cvkpTJaIDeUXq_EXWnMqXMdSuMQDX3NAbZXAlZYl_V18KATWF7y1EFzUyJ62rf3bAN"><strong>ç™¾åº¦ç™¾ç§‘ - æ‰‹æœºå·</strong> (opens new window)</a></p>
</blockquote>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^((\+)?86\s*)?((13[0-9])|(15([0-3]|[5-9]))|(18[0,2,5-9]))\d&#123;8&#125;$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>åŒ¹é…ï¼š</strong>+86 18012345678 | 86 18012345678 | 15812345678</li>
<li>** ä¸åŒ¹é…ï¼š**15412345678 | 12912345678 | 180123456789</li>
</ul>
<h4 id="-258"><a class="markdownIt-Anchor" href="#-258">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C%E4%B8%AD%E5%9B%BD%E5%9B%BA%E8%AF%9D%E5%8F%B7%E7%A0%81">#</a>æ ¡éªŒä¸­å›½å›ºè¯å·ç </h4>
<p>** æè¿°ï¼š** å›ºè¯å·ç ï¼Œå¿…é¡»åŠ åŒºå·ï¼ˆä»¥ 0 å¼€å¤´ï¼‰ã€‚ 3 ä½æœ‰æ•ˆåŒºå·ï¼š010ã€020~029ï¼Œå›ºè¯ä½æ•°ä¸º 8 ä½ã€‚ 4 ä½æœ‰æ•ˆåŒºå·ï¼š03xx å¼€å¤´åˆ° 09xxï¼Œå›ºè¯ä½æ•°ä¸º 7ã€‚</p>
<blockquote>
<p>å¦‚æœæƒ³äº†è§£æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œè¯·å‚è€ƒ <a target="_blank" rel="noopener" href="http://baike.baidu.com/link?url=sX8JoxK1ja5uM5pDYvQe27_QsyqAZ_78DLSeEvwjqtG_uXqU6p5Oh7CPbImNbnwu1ClOmD8udgDIswZfYzQIw0z3BYZO3eTplvVDzieuowTYqt7yHGDAqyT7o4vvGhg4"><strong>ç™¾åº¦ç™¾ç§‘ - ç”µè¯åŒºå·</strong> (opens new window)</a>ã€‚</p>
</blockquote>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^(010|02[0-9])(\s|-)\d&#123;8&#125;|(0[3-9]\d&#123;2&#125;)(\s|-)\d&#123;7&#125;$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**010-12345678 | 010 12345678 | 0512-1234567 | 0512 1234567</li>
<li>** ä¸åŒ¹é…ï¼š**1234567 | 12345678</li>
</ul>
<h4 id="-259"><a class="markdownIt-Anchor" href="#-259">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C-ipv4-%E5%9C%B0%E5%9D%80">#</a>æ ¡éªŒ IPv4 åœ°å€</h4>
<p>** æè¿°ï¼š**IP åœ°å€æ˜¯ä¸€ä¸ª 32 ä½çš„äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸è¢«åˆ†å‰²ä¸º 4 ä¸ª â€œ8 ä½äºŒè¿›åˆ¶æ•°â€ï¼ˆä¹Ÿå°±æ˜¯ 4 ä¸ªå­—èŠ‚ï¼‰ã€‚IP åœ°å€é€šå¸¸ç”¨ â€œç‚¹åˆ†åè¿›åˆ¶â€ è¡¨ç¤ºæˆï¼ˆa.b.c.dï¼‰çš„å½¢å¼ï¼Œå…¶ä¸­ï¼Œa,b,c,d éƒ½æ˜¯ 0~255 ä¹‹é—´çš„åè¿›åˆ¶æ•´æ•°ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">^([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])\.([01]?\d\d?|2[0-4]\d|25[0-5])$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**0.0.0.0 | 255.255.255.255 | 127.0.0.1</li>
<li>** ä¸åŒ¹é…ï¼š**10.10.10 | 10.10.10.256</li>
</ul>
<h4 id="-260"><a class="markdownIt-Anchor" href="#-260">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%A0%A1%E9%AA%8C-ipv6-%E5%9C%B0%E5%9D%80">#</a>æ ¡éªŒ IPv6 åœ°å€</h4>
<p>** æè¿°ï¼š**IPv6 çš„ 128 ä½åœ°å€é€šå¸¸å†™æˆ 8 ç»„ï¼Œæ¯ç»„ä¸ºå››ä¸ªåå…­è¿›åˆ¶æ•°çš„å½¢å¼ã€‚</p>
<p>IPv6 åœ°å€å¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸‹å½¢å¼ï¼š</p>
<ul>
<li>IPv6 åœ°å€</li>
<li>é›¶å‹ç¼© IPv6 åœ°å€ (<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc5952#section-2.2">section 2.2 of rfc5952 (opens new window)</a>)</li>
<li>å¸¦æœ‰æœ¬åœ°é“¾æ¥åŒºåŸŸç´¢å¼•çš„ IPv6 åœ°å€ (<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc4007#section-11">section 11 of rfc4007 (opens new window)</a>)</li>
<li>åµŒå…¥ IPv4 çš„ IPv6 åœ°å€ (<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6052#section-2">section 2 of rfc6052(opens new window)</a></li>
<li>æ˜ å°„ IPv4 çš„ IPv6 åœ°å€ (<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2765#section-2.1">section 2.1 of rfc2765 (opens new window)</a>)</li>
<li>ç¿»è¯‘ IPv4 çš„ IPv6 åœ°å€ (<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc2765#section-2.1">section 2.1 of rfc2765 (opens new window)</a>)</li>
</ul>
<blockquote>
<p>æ˜¾ç„¶ï¼ŒIPv6 åœ°å€çš„è¡¨ç¤ºæ–¹å¼å¾ˆå¤æ‚ã€‚ä½ ä¹Ÿå¯ä»¥å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="http://baike.baidu.com/link?url=D3nmh0q_G_ZVmxXFG79mjjNfT4hs9fwjqUgygh-tvhq43KYqx88HV27WEXmoT4nA4iGzXwXMm5L-j50C2gSL5q"><strong>ç™¾åº¦ç™¾ç§‘ - IPv6</strong>(opens new window)</a></p>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/53497/regular-expression-that-matches-valid-ipv6-addresses"><strong>Stack overflow ä¸Šçš„ IPv6 æ­£åˆ™è¡¨è¾¾é«˜ç¥¨ç­”æ¡ˆ</strong> (opens new window)</a></p>
</blockquote>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">(([0-9a-fA-F]&#123;1,4&#125;:)&#123;7,7&#125;[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,7&#125;:|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,6&#125;:[0-9a-fA-F]&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,5&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,2&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,3&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,3&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,4&#125;|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,2&#125;(:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,5&#125;|[0-9a-fA-F]&#123;1,4&#125;:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,6&#125;)|:((:[0-9a-fA-F]&#123;1,4&#125;)&#123;1,7&#125;|:)|fe80:(:[0-9a-fA-F]&#123;0,4&#125;)&#123;0,4&#125;%[0-9a-zA-Z]&#123;1,&#125;|::(ffff(:0&#123;1,4&#125;)&#123;0,1&#125;:)&#123;0,1&#125;((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])|([0-9a-fA-F]&#123;1,4&#125;:)&#123;1,4&#125;:((25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9])\.)&#123;3,3&#125;(25[0-5]|(2[0-4]|1&#123;0,1&#125;[0-9])&#123;0,1&#125;[0-9]))<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>** åŒ¹é…ï¼š**1:2:3:4:5:6:7:8 | 1:: | 1::8 | 1::6:7:8 | 1::5:6:7:8 | 1::4:5:6:7:8 | 1::3:4:5:6:7:8 | ::2:3:4:5:6:7:8 | 1:2:3:4:5:6:7:: | 1:2:3:4:5:6::8 | 1:2:3:4:5::8 | 1:2:3:4::8 | 1:2:3::8 | 1:2::8 | 1::8 | ::8 | fe80::7:8%1 | ::255.255.255.255 | 2001:db8:3:4::192.0.2.33 | 64:ff9b::192.0.2.33</li>
<li>** ä¸åŒ¹é…ï¼š**1.2.3.4.5.6.7.8 | 1::2::3</li>
</ul>
<h3 id="-261"><a class="markdownIt-Anchor" href="#-261">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_7-2-%E7%89%B9%E5%AE%9A%E5%AD%97%E7%AC%A6">#</a>7.2. ç‰¹å®šå­—ç¬¦</h3>
<ul>
<li>åŒ¹é…é•¿åº¦ä¸º 3 çš„å­—ç¬¦ä¸²ï¼š <code>^.&#123;3&#125;$</code> ã€‚</li>
<li>åŒ¹é…ç”± 26 ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š <code>^[A-Za-z]+$</code> ã€‚</li>
<li>åŒ¹é…ç”± 26 ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š <code>^[A-Z]+$</code> ã€‚</li>
<li>åŒ¹é…ç”± 26 ä¸ªå°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š <code>^[a-z]+$</code> ã€‚</li>
<li>åŒ¹é…ç”±æ•°å­—å’Œ 26 ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š <code>^[A-Za-z0-9]+$</code> ã€‚</li>
<li>åŒ¹é…ç”±æ•°å­—ã€26 ä¸ªè‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼š <code>^\w+$</code> ã€‚</li>
</ul>
<h3 id="-262"><a class="markdownIt-Anchor" href="#-262">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_7-3-%E7%89%B9%E5%AE%9A%E6%95%B0%E5%AD%97">#</a>7.3. ç‰¹å®šæ•°å­—</h3>
<ul>
<li>åŒ¹é…æ­£æ•´æ•°ï¼š <code>^[1-9]\d*$</code></li>
<li>åŒ¹é…è´Ÿæ•´æ•°ï¼š <code>^-[1-9]\d*$</code></li>
<li>åŒ¹é…æ•´æ•°ï¼š <code>^(-?[1-9]\d*)|0$</code></li>
<li>åŒ¹é…æ­£æµ®ç‚¹æ•°ï¼š <code>^[1-9]\d*\.\d+|0\.\d+$</code></li>
<li>åŒ¹é…è´Ÿæµ®ç‚¹æ•°ï¼š <code>^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$</code></li>
<li>åŒ¹é…æµ®ç‚¹æ•°ï¼š <code>^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$</code></li>
</ul>
<h2 id="-263"><a class="markdownIt-Anchor" href="#-263">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_8-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E6%80%A7%E8%83%BD">#</a>8. æ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½</h2>
<p>ç›®å‰å®ç°æ­£åˆ™è¡¨è¾¾å¼å¼•æ“çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šDFA è‡ªåŠ¨æœºï¼ˆDeterministic Final Automata ç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰å’Œ NFA è‡ªåŠ¨æœºï¼ˆNon deterministic Finite Automaton éç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰ã€‚å¯¹æ¯”æ¥çœ‹ï¼Œæ„é€  DFA è‡ªåŠ¨æœºçš„ä»£ä»·è¿œå¤§äº NFA è‡ªåŠ¨æœºï¼Œä½† DFA è‡ªåŠ¨æœºçš„æ‰§è¡Œæ•ˆç‡é«˜äº NFA è‡ªåŠ¨æœºã€‚</p>
<p>å‡è®¾ä¸€ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯ nï¼Œå¦‚æœç”¨ DFA è‡ªåŠ¨æœºä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼Œåˆ™åŒ¹é…çš„æ—¶é—´å¤æ‚åº¦ä¸º O (n)ï¼›å¦‚æœç”¨ NFA è‡ªåŠ¨æœºä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼Œç”±äº NFA è‡ªåŠ¨æœºåœ¨åŒ¹é…è¿‡ç¨‹ä¸­å­˜åœ¨å¤§é‡çš„åˆ†æ”¯å’Œå›æº¯ï¼Œå‡è®¾ NFA çš„çŠ¶æ€æ•°ä¸º sï¼Œåˆ™è¯¥åŒ¹é…ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º Oï¼ˆnsï¼‰ã€‚</p>
<p>NFA è‡ªåŠ¨æœºçš„ä¼˜åŠ¿æ˜¯æ”¯æŒæ›´å¤šåŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæ•è· groupã€ç¯è§†ã€å æœ‰ä¼˜å…ˆé‡è¯ç­‰é«˜çº§åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½éƒ½æ˜¯åŸºäºå­è¡¨è¾¾å¼ç‹¬ç«‹è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤åœ¨ç¼–ç¨‹è¯­è¨€é‡Œï¼Œä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼åº“éƒ½æ˜¯åŸºäº NFA å®ç°çš„ã€‚</p>
<h3 id="-264"><a class="markdownIt-Anchor" href="#-264">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_8-1-nfa-%E8%87%AA%E5%8A%A8%E6%9C%BA%E7%9A%84%E5%9B%9E%E6%BA%AF">#</a>8.1. NFA è‡ªåŠ¨æœºçš„å›æº¯</h3>
<p>ç”¨ NFA è‡ªåŠ¨æœºå®ç°çš„æ¯”è¾ƒå¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œåœ¨åŒ¹é…è¿‡ç¨‹ä¸­ç»å¸¸ä¼šå¼•èµ·å›æº¯é—®é¢˜ã€‚å¤§é‡çš„å›æº¯ä¼šé•¿æ—¶é—´åœ°å ç”¨ CPUï¼Œä»è€Œå¸¦æ¥ç³»ç»Ÿæ€§èƒ½å¼€é”€ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">text=â€œabbcâ€
regex=â€œab&#123;1,3&#125;câ€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿™ä¸ªä¾‹å­åŒ¹é…ç›®çš„æ˜¯ï¼šåŒ¹é…ä»¥ a å¼€å¤´ï¼Œä»¥ c ç»“å°¾ï¼Œä¸­é—´æœ‰ 1-3 ä¸ª b å­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚NFA è‡ªåŠ¨æœºå¯¹å…¶è§£æçš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>è¯»å–æ­£åˆ™è¡¨è¾¾å¼ç¬¬ä¸€ä¸ªåŒ¹é…ç¬¦ a å’Œå­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦ a è¿›è¡Œæ¯”è¾ƒï¼Œa å¯¹ aï¼ŒåŒ¹é…ã€‚</li>
<li>ç„¶åï¼Œè¯»å–æ­£åˆ™è¡¨è¾¾å¼ç¬¬äºŒä¸ªåŒ¹é…ç¬¦  <code>b&#123;1,3&#125;</code>  å’Œå­—ç¬¦ä¸²çš„ç¬¬äºŒä¸ªå­—ç¬¦ b è¿›è¡Œæ¯”è¾ƒï¼ŒåŒ¹é…ã€‚ä½†å› ä¸º  <code>b&#123;1,3&#125;</code>  è¡¨ç¤º 1-3 ä¸ª b å­—ç¬¦ä¸²ï¼ŒNFA è‡ªåŠ¨æœºåˆå…·æœ‰è´ªå©ªç‰¹æ€§ï¼Œæ‰€ä»¥æ­¤æ—¶ä¸ä¼šç»§ç»­è¯»å–æ­£åˆ™è¡¨è¾¾å¼çš„ä¸‹ä¸€ä¸ªåŒ¹é…ç¬¦ï¼Œè€Œæ˜¯ä¾æ—§ä½¿ç”¨  <code>b&#123;1,3&#125;</code>  å’Œå­—ç¬¦ä¸²çš„ç¬¬ä¸‰ä¸ªå­—ç¬¦ b è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœè¿˜æ˜¯åŒ¹é…ã€‚</li>
<li>æ¥ç€ç»§ç»­ä½¿ç”¨  <code>b&#123;1,3&#125;</code>  å’Œå­—ç¬¦ä¸²çš„ç¬¬å››ä¸ªå­—ç¬¦ c è¿›è¡Œæ¯”è¾ƒï¼Œå‘ç°ä¸åŒ¹é…äº†ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿå›æº¯ï¼Œå·²ç»è¯»å–çš„å­—ç¬¦ä¸²ç¬¬å››ä¸ªå­—ç¬¦ c å°†è¢«åå‡ºå»ï¼ŒæŒ‡é’ˆå›åˆ°ç¬¬ä¸‰ä¸ªå­—ç¬¦ b çš„ä½ç½®ã€‚</li>
<li>é‚£ä¹ˆå‘ç”Ÿå›æº¯ä»¥åï¼ŒåŒ¹é…è¿‡ç¨‹æ€ä¹ˆç»§ç»­å‘¢ï¼Ÿç¨‹åºä¼šè¯»å–æ­£åˆ™è¡¨è¾¾å¼çš„ä¸‹ä¸€ä¸ªåŒ¹é…ç¬¦ cï¼Œå’Œå­—ç¬¦ä¸²ä¸­çš„ç¬¬å››ä¸ªå­—ç¬¦ c è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœåŒ¹é…ï¼Œç»“æŸã€‚</li>
</ul>
<h3 id="-265"><a class="markdownIt-Anchor" href="#-265">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_8-2-%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E5%9B%9E%E6%BA%AF">#</a>8.2. å¦‚ä½•é¿å…å›æº¯</h3>
<h4 id="-266"><a class="markdownIt-Anchor" href="#-266">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E8%B4%AA%E5%A9%AA%E6%A8%A1%E5%BC%8F-greedy">#</a>è´ªå©ªæ¨¡å¼ï¼ˆGreedyï¼‰</h4>
<p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨æ•°é‡åŒ¹é…ä¸­ï¼Œå¦‚æœå•ç‹¬ä½¿ç”¨ +ã€ ? ã€* æˆ– {min,max} ç­‰é‡è¯ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¼šåŒ¹é…å°½å¯èƒ½å¤šçš„å†…å®¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸Šè¾¹é‚£ä¸ªä¾‹å­ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">text=â€œabbcâ€
regex=â€œab&#123;1,3&#125;câ€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å°±æ˜¯åœ¨è´ªå©ªæ¨¡å¼ä¸‹ï¼ŒNFA è‡ªåŠ¨æœºè¯»å–äº†æœ€å¤§çš„åŒ¹é…èŒƒå›´ï¼Œå³åŒ¹é… 3 ä¸ª b å­—ç¬¦ã€‚åŒ¹é…å‘ç”Ÿäº†ä¸€æ¬¡å¤±è´¥ï¼Œå°±å¼•èµ·äº†ä¸€æ¬¡å›æº¯ã€‚å¦‚æœåŒ¹é…ç»“æœæ˜¯ â€œabbbcâ€ï¼Œå°±ä¼šåŒ¹é…æˆåŠŸã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">text=â€œabbbcâ€
regex=â€œab&#123;1,3&#125;câ€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="-267"><a class="markdownIt-Anchor" href="#-267">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E6%87%92%E6%83%B0%E6%A8%A1%E5%BC%8F-reluctant">#</a>æ‡’æƒ°æ¨¡å¼ï¼ˆReluctantï¼‰</h4>
<p>åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¼šå°½å¯èƒ½å°‘åœ°é‡å¤åŒ¹é…å­—ç¬¦ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œå®ƒä¼šç»§ç»­åŒ¹é…å‰©ä½™çš„å­—ç¬¦ä¸²ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢ä¾‹å­çš„å­—ç¬¦åé¢åŠ ä¸€ä¸ª â€œï¼Ÿâ€ï¼Œå°±å¯ä»¥å¼€å¯æ‡’æƒ°æ¨¡å¼ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">text=â€œabcâ€
regex=â€œab&#123;1,3&#125;?câ€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åŒ¹é…ç»“æœæ˜¯ â€œabcâ€ï¼Œè¯¥æ¨¡å¼ä¸‹ NFA è‡ªåŠ¨æœºé¦–å…ˆé€‰æ‹©æœ€å°çš„åŒ¹é…èŒƒå›´ï¼Œå³åŒ¹é… 1 ä¸ª b å­—ç¬¦ï¼Œå› æ­¤å°±é¿å…äº†å›æº¯é—®é¢˜ã€‚</p>
<h4 id="-268"><a class="markdownIt-Anchor" href="#-268">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E7%8B%AC%E5%8D%A0%E6%A8%A1%E5%BC%8F-possessive">#</a>ç‹¬å æ¨¡å¼ï¼ˆPossessiveï¼‰</h4>
<p>åŒè´ªå©ªæ¨¡å¼ä¸€æ ·ï¼Œç‹¬å æ¨¡å¼ä¸€æ ·ä¼šæœ€å¤§é™åº¦åœ°åŒ¹é…æ›´å¤šå†…å®¹ï¼›ä¸åŒçš„æ˜¯ï¼Œåœ¨ç‹¬å æ¨¡å¼ä¸‹ï¼ŒåŒ¹é…å¤±è´¥å°±ä¼šç»“æŸåŒ¹é…ï¼Œä¸ä¼šå‘ç”Ÿå›æº¯é—®é¢˜ã€‚</p>
<p>è¿˜æ˜¯ä¸Šè¾¹çš„ä¾‹å­ï¼Œåœ¨å­—ç¬¦åé¢åŠ ä¸€ä¸ª â€œ+â€ï¼Œå°±å¯ä»¥å¼€å¯ç‹¬å æ¨¡å¼ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">text=â€œabbcâ€
regex=â€œab&#123;1,3&#125;+bcâ€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ç»“æœæ˜¯ä¸åŒ¹é…ï¼Œç»“æŸåŒ¹é…ï¼Œä¸ä¼šå‘ç”Ÿå›æº¯é—®é¢˜ã€‚</p>
<blockquote>
<p>è®²åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥éå¸¸æ¸…æ¥šäº†ï¼Œ<strong>é¿å…å›æº¯çš„æ–¹æ³•å°±æ˜¯ï¼šä½¿ç”¨æ‡’æƒ°æ¨¡å¼å’Œç‹¬å æ¨¡å¼ã€‚</strong></p>
</blockquote>
<h3 id="-269"><a class="markdownIt-Anchor" href="#-269">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#_8-3-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E4%BC%98%E5%8C%96">#</a>8.3. æ­£åˆ™è¡¨è¾¾å¼çš„ä¼˜åŒ–</h3>
<h4 id="-270"><a class="markdownIt-Anchor" href="#-270">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%B0%91%E7%94%A8%E8%B4%AA%E5%A9%AA%E6%A8%A1%E5%BC%8F-%E5%A4%9A%E7%94%A8%E7%8B%AC%E5%8D%A0%E6%A8%A1%E5%BC%8F">#</a>å°‘ç”¨è´ªå©ªæ¨¡å¼ï¼Œå¤šç”¨ç‹¬å æ¨¡å¼</h4>
<p>è´ªå©ªæ¨¡å¼ä¼šå¼•èµ·å›æº¯é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ç‹¬å æ¨¡å¼æ¥é¿å…å›æº¯ã€‚</p>
<h4 id="-271"><a class="markdownIt-Anchor" href="#-271">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%87%8F%E5%B0%91%E5%88%86%E6%94%AF%E9%80%89%E6%8B%A9">#</a>å‡å°‘åˆ†æ”¯é€‰æ‹©</h4>
<p>åˆ†æ”¯é€‰æ‹©ç±»å‹  <code>(X|Y|Z)</code>  çš„æ­£åˆ™è¡¨è¾¾å¼ä¼šé™ä½æ€§èƒ½ï¼Œæˆ‘ä»¬åœ¨å¼€å‘çš„æ—¶å€™è¦å°½é‡å‡å°‘ä½¿ç”¨ã€‚å¦‚æœä¸€å®šè¦ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥ä¼˜åŒ–ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘é€‰æ‹©çš„é¡ºåºï¼Œå°†æ¯”è¾ƒå¸¸ç”¨çš„é€‰æ‹©é¡¹æ”¾åœ¨å‰é¢ï¼Œä½¿å®ƒä»¬å¯ä»¥è¾ƒå¿«åœ°è¢«åŒ¹é…ï¼›</li>
<li>å…¶æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æå–å…±ç”¨æ¨¡å¼ï¼Œä¾‹å¦‚ï¼Œå°†  <code>(abcd|abef)</code>  æ›¿æ¢ä¸º  <code>ab(cd|ef)</code> ï¼Œåè€…åŒ¹é…é€Ÿåº¦è¾ƒå¿«ï¼Œå› ä¸º NFA è‡ªåŠ¨æœºä¼šå°è¯•åŒ¹é… abï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±ä¸ä¼šå†å°è¯•ä»»ä½•é€‰é¡¹ï¼›</li>
<li>æœ€åï¼Œå¦‚æœæ˜¯ç®€å•çš„åˆ†æ”¯é€‰æ‹©ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‰æ¬¡ index ä»£æ›¿  <code>(X|Y|Z)</code> ï¼Œå¦‚æœæµ‹è¯•çš„è¯ï¼Œä½ å°±ä¼šå‘ç°ä¸‰æ¬¡ index çš„æ•ˆç‡è¦æ¯”  <code>(X|Y|Z)</code>  é«˜å‡ºä¸€äº›ã€‚</li>
</ul>
<h4 id="-272"><a class="markdownIt-Anchor" href="#-272">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-regex.html#%E5%87%8F%E5%B0%91%E6%8D%95%E8%8E%B7%E5%B5%8C%E5%A5%97">#</a>å‡å°‘æ•è·åµŒå¥—</h4>
<ul>
<li>æ•è·ç»„æ˜¯æŒ‡æŠŠæ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œå­è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹ä¿å­˜åˆ°ä»¥æ•°å­—ç¼–å·æˆ–æ˜¾å¼å‘½åçš„æ•°ç»„ä¸­ï¼Œæ–¹ä¾¿åé¢å¼•ç”¨ã€‚ä¸€èˆ¬ä¸€ä¸ª () å°±æ˜¯ä¸€ä¸ªæ•è·ç»„ï¼Œæ•è·ç»„å¯ä»¥è¿›è¡ŒåµŒå¥—ã€‚</li>
<li>éæ•è·ç»„åˆ™æ˜¯æŒ‡å‚ä¸åŒ¹é…å´ä¸è¿›è¡Œåˆ†ç»„ç¼–å·çš„æ•è·ç»„ï¼Œå…¶è¡¨è¾¾å¼ä¸€èˆ¬ç”±  <code>(?:exp)</code>  ç»„æˆã€‚</li>
</ul>
<p>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæ¯ä¸ªæ•è·ç»„éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼Œç¼–å· 0 ä»£è¡¨æ•´ä¸ªåŒ¹é…åˆ°çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">"&lt;input high=\"20\" weight=\"70\">test&lt;/input>"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> reg<span class="token operator">=</span><span class="token string">"(&lt;input.*?>)(.*?)(&lt;/input>)"</span><span class="token punctuation">;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ•´ä¸ªåŒ¹é…åˆ°çš„å†…å®¹</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(&lt;input.*?>)</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(.*?)</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(&lt;/input>)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">&lt;input high=\"20\" weight=\"70\">test&lt;/input>
&lt;input high=\"20\" weight=\"70\">
test
&lt;/input><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœä½ å¹¶ä¸éœ€è¦è·å–æŸä¸€ä¸ªåˆ†ç»„å†…çš„æ–‡æœ¬ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨éæ•è·åˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ â€œ(?:X)â€ ä»£æ›¿ â€œ(X)â€ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">"&lt;input high=\"20\" weight=\"70\">test&lt;/input>"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> reg<span class="token operator">=</span><span class="token string">"(?:&lt;input.*?>)(.*?)(?:&lt;/input>)"</span><span class="token punctuation">;</span>
	<span class="token class-name">Pattern</span> p <span class="token operator">=</span> <span class="token class-name">Pattern</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Matcher</span> m <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ•´ä¸ªåŒ¹é…åˆ°çš„å†…å®¹</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(.*?)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">&lt;input high=\"20\" weight=\"70\">test&lt;/input>
test<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ç»¼ä¸Šå¯çŸ¥ï¼šå‡å°‘ä¸éœ€è¦è·å–çš„åˆ†ç»„ï¼Œå¯ä»¥æé«˜æ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½ã€‚</p>
<hr>
<h1 id="java-ç¼–ç å’ŒåŠ å¯†"><a class="markdownIt-Anchor" href="#java-ç¼–ç å’ŒåŠ å¯†">#</a> Java ç¼–ç å’ŒåŠ å¯†</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>å…³é”®è¯ï¼š <code>Base64</code> ã€ <code>æ¶ˆæ¯æ‘˜è¦</code> ã€ <code>æ•°å­—ç­¾å</code> ã€ <code>å¯¹ç§°åŠ å¯†</code> ã€ <code>éå¯¹ç§°åŠ å¯†</code> ã€ <code>MD5</code> ã€ <code>SHA</code> ã€ <code>HMAC</code> ã€ <code>AES</code> ã€ <code>DES</code> ã€ <code>DESede</code> ã€ <code>RSA</code></p>
</blockquote>
<ul>
<li>ä¸€ã€Base64 ç¼–ç 
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#base64-%E5%8E%9F%E7%90%86">Base64 åŸç†</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#base64-%E5%BA%94%E7%94%A8">Base64 åº”ç”¨</a></li>
</ul>
</li>
<li>äºŒã€æ¶ˆæ¯æ‘˜è¦
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E6%A6%82%E8%BF%B0">æ¶ˆæ¯æ‘˜è¦æ¦‚è¿°</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E7%89%B9%E7%82%B9">æ¶ˆæ¯æ‘˜è¦ç‰¹ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95">æ¶ˆæ¯æ‘˜è¦å¸¸ç”¨ç®—æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E5%BA%94%E7%94%A8">æ¶ˆæ¯æ‘˜è¦åº”ç”¨</a></li>
</ul>
</li>
<li>ä¸‰ã€æ•°å­—ç­¾å
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E6%A6%82%E8%BF%B0">æ•°å­—ç­¾åæ¦‚è¿°</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E5%BA%94%E7%94%A8">æ•°å­—ç­¾åç®—æ³•åº”ç”¨</a></li>
</ul>
</li>
<li>å››ã€å¯¹ç§°åŠ å¯†
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E6%A6%82%E8%BF%B0">å¯¹ç§°åŠ å¯†æ¦‚è¿°</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%BA%94%E7%94%A8">å¯¹ç§°åŠ å¯†åº”ç”¨</a></li>
</ul>
</li>
<li>äº”ã€éå¯¹ç§°åŠ å¯†
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E6%A6%82%E8%BF%B0">éå¯¹ç§°åŠ å¯†æ¦‚è¿°</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%BA%94%E7%94%A8">éå¯¹ç§°åŠ å¯†ç®—æ³•åº”ç”¨</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%85%AD%E6%9C%AF%E8%AF%AD">å…­ã€æœ¯è¯­</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-273"><a class="markdownIt-Anchor" href="#-273">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E4%B8%80%E3%80%81base64-%E7%BC%96%E7%A0%81">#</a>ä¸€ã€Base64 ç¼–ç </h2>
<h3 id="-274"><a class="markdownIt-Anchor" href="#-274">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#base64-%E5%8E%9F%E7%90%86">#</a>Base64 åŸç†</h3>
<p>Base64 å†…å®¹ä¼ é€ç¼–ç æ˜¯ä¸€ç§ä»¥ä»»æ„ 8 ä½å­—èŠ‚åºåˆ—ç»„åˆçš„æè¿°å½¢å¼ï¼Œè¿™ç§å½¢å¼ä¸æ˜“è¢«äººç›´æ¥è¯†åˆ«ã€‚</p>
<p>Base64 æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„ç¼–ç è§„èŒƒï¼Œå…¶ä½œç”¨æ˜¯å°†äºŒè¿›åˆ¶åºåˆ—è½¬æ¢ä¸ºäººç±»å¯è¯»çš„ ASCII å­—ç¬¦åºåˆ—ï¼Œå¸¸ç”¨åœ¨éœ€ç”¨é€šè¿‡æ–‡æœ¬åè®®ï¼ˆæ¯”å¦‚ HTTP å’Œ SMTPï¼‰æ¥ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®çš„æƒ…å†µä¸‹ã€‚<strong>Base64 å¹¶ä¸æ˜¯åŠ å¯†è§£å¯†ç®—æ³•</strong>ï¼Œå°½ç®¡æˆ‘ä»¬æœ‰æ—¶ä¹Ÿå¬åˆ°ä½¿ç”¨ Base64 æ¥åŠ å¯†è§£å¯†çš„è¯´æ³•ï¼Œä½†è¿™é‡Œæ‰€è¯´çš„åŠ å¯†ä¸è§£å¯†å®é™…æ˜¯æŒ‡ ** ç¼–ç ï¼ˆencodeï¼‰<strong>å’Œ</strong>è§£ç ï¼ˆdecodeï¼‰** çš„è¿‡ç¨‹ï¼Œå…¶å˜æ¢æ˜¯éå¸¸ç®€å•çš„ï¼Œä»…ä»…èƒ½å¤Ÿé¿å…ä¿¡æ¯è¢«ç›´æ¥è¯†åˆ«ã€‚</p>
<p>Base64 ç®—æ³•ä¸»è¦æ˜¯å°†ç»™å®šçš„å­—ç¬¦ä»¥å­—ç¬¦ç¼–ç  (å¦‚ ASCII ç ï¼ŒUTF-8 ç ) å¯¹åº”çš„åè¿›åˆ¶æ•°ä¸ºåŸºå‡†ï¼Œåšç¼–ç æ“ä½œï¼š</p>
<ol>
<li>å°†ç»™å®šçš„å­—ç¬¦ä¸²ä»¥å­—ç¬¦ä¸ºå•ä½ï¼Œè½¬æ¢ä¸ºå¯¹åº”çš„å­—ç¬¦ç¼–ç ã€‚</li>
<li>å°†è·å¾—å­—ç¬¦ç¼–ç è½¬æ¢ä¸ºäºŒè¿›åˆ¶</li>
<li>å¯¹äºŒè¿›åˆ¶ç åšåˆ†ç»„è½¬æ¢ï¼Œæ¯ 3 ä¸ªå­—èŠ‚ä¸ºä¸€ç»„ï¼Œè½¬æ¢ä¸ºæ¯ 4 ä¸ª 6 ä½äºŒè¿›åˆ¶ä½ä¸€ç»„ï¼ˆä¸è¶³ 6 ä½æ—¶ä½ä½è¡¥ 0ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ†ç»„å˜åŒ–çš„è¿‡ç¨‹ï¼Œ3 ä¸ª 8 ä½äºŒè¿›åˆ¶ç å’Œ 4 ä¸ª 6 ä½äºŒè¿›åˆ¶ç çš„é•¿åº¦éƒ½æ˜¯ 24 ä½ï¼ˆ3<em>8 = 4</em>6 = 24ï¼‰ã€‚</li>
<li>å¯¹è·å¾—çš„ 4-6 äºŒè¿›åˆ¶ç è¡¥ä½ï¼Œå‘ 6 ä½äºŒè¿›åˆ¶ç æ·»åŠ  2 ä½é«˜ä½ 0ï¼Œç»„æˆ 4 ä¸ª 8 ä½äºŒè¿›åˆ¶ç ã€‚</li>
<li>å¯¹è·å¾—çš„ 4-8 äºŒè¿›åˆ¶ç è½¬æ¢ä¸ºåè¿›åˆ¶ç ã€‚</li>
<li>å°†è·å¾—çš„åè¿›åˆ¶ç è½¬æ¢ä¸º Base64 å­—ç¬¦è¡¨ä¸­å¯¹åº”çš„å­—ç¬¦ã€‚</li>
</ol>
<p>*<strong>Base64 ç¼–ç è¡¨ *</strong></p>
<table>
<thead>
<tr>
<th><strong>ç´¢å¼•</strong></th>
<th><strong>å¯¹åº”å­—ç¬¦</strong></th>
<th><strong>ç´¢å¼•</strong></th>
<th><strong>å¯¹åº”å­—ç¬¦</strong></th>
<th><strong>ç´¢å¼•</strong></th>
<th><strong>å¯¹åº”å­—ç¬¦</strong></th>
<th><strong>ç´¢å¼•</strong></th>
<th><strong>å¯¹åº”å­—ç¬¦</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>A</td>
<td>17</td>
<td>R</td>
<td>34</td>
<td>i</td>
<td>51</td>
<td>z</td>
</tr>
<tr>
<td>1</td>
<td>B</td>
<td>18</td>
<td>S</td>
<td>35</td>
<td>j</td>
<td>52</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>C</td>
<td>19</td>
<td>T</td>
<td>36</td>
<td>k</td>
<td>53</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>D</td>
<td>20</td>
<td>U</td>
<td>37</td>
<td>l</td>
<td>54</td>
<td>2</td>
</tr>
<tr>
<td>4</td>
<td>E</td>
<td>21</td>
<td>V</td>
<td>38</td>
<td>m</td>
<td>55</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>F</td>
<td>22</td>
<td>W</td>
<td>39</td>
<td>n</td>
<td>56</td>
<td>4</td>
</tr>
<tr>
<td>6</td>
<td>G</td>
<td>23</td>
<td>X</td>
<td>40</td>
<td>o</td>
<td>57</td>
<td>5</td>
</tr>
<tr>
<td>7</td>
<td>H</td>
<td>24</td>
<td>Y</td>
<td>41</td>
<td>p</td>
<td>58</td>
<td>6</td>
</tr>
<tr>
<td>8</td>
<td>I</td>
<td>25</td>
<td>Z</td>
<td>42</td>
<td>q</td>
<td>59</td>
<td>7</td>
</tr>
<tr>
<td>9</td>
<td>J</td>
<td>26</td>
<td>a</td>
<td>43</td>
<td>r</td>
<td>60</td>
<td>8</td>
</tr>
<tr>
<td>10</td>
<td>K</td>
<td>27</td>
<td>b</td>
<td>44</td>
<td>s</td>
<td>61</td>
<td>9</td>
</tr>
<tr>
<td>11</td>
<td>L</td>
<td>28</td>
<td>c</td>
<td>45</td>
<td>t</td>
<td>62</td>
<td>+</td>
</tr>
<tr>
<td>12</td>
<td>M</td>
<td>29</td>
<td>d</td>
<td>46</td>
<td>u</td>
<td>63</td>
<td>/</td>
</tr>
<tr>
<td>13</td>
<td>N</td>
<td>30</td>
<td>e</td>
<td>47</td>
<td>v</td>
<td></td>
<td></td>
</tr>
<tr>
<td>14</td>
<td>O</td>
<td>31</td>
<td>f</td>
<td>48</td>
<td>w</td>
<td></td>
<td></td>
</tr>
<tr>
<td>15</td>
<td>P</td>
<td>32</td>
<td>g</td>
<td>49</td>
<td>x</td>
<td></td>
<td></td>
</tr>
<tr>
<td>16</td>
<td>Q</td>
<td>33</td>
<td>h</td>
<td>50</td>
<td>y</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="-275"><a class="markdownIt-Anchor" href="#-275">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#base64-%E5%BA%94%E7%94%A8">#</a>Base64 åº”ç”¨</h3>
<p>Base64 ç¼–ç å¯ç”¨äºåœ¨ HTTP ç¯å¢ƒä¸‹ä¼ é€’è¾ƒé•¿çš„æ ‡è¯†ä¿¡æ¯ã€‚åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä¹Ÿå¸¸å¸¸éœ€è¦æŠŠäºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸ºé€‚åˆæ”¾åœ¨ URL (åŒ…æ‹¬éšè—è¡¨å•åŸŸ) ä¸­çš„å½¢å¼ã€‚æ­¤æ—¶ï¼Œé‡‡ç”¨ Base64 ç¼–ç å…·æœ‰ä¸å¯è¯»æ€§ï¼Œå³æ‰€ç¼–ç çš„æ•°æ®ä¸ä¼šè¢«äººç”¨è‚‰çœ¼æ‰€ç›´æ¥çœ‹åˆ°ï¼Œç®—æ˜¯èµ·åˆ°ä¸€ä¸ªåŠ å¯†çš„ä½œç”¨ã€‚</p>
<p>ç„¶è€Œï¼Œ<strong>æ ‡å‡†çš„ Base64 å¹¶ä¸é€‚åˆç›´æ¥æ”¾åœ¨ URL é‡Œä¼ è¾“</strong>ï¼Œå› ä¸º URL ç¼–ç å™¨ä¼šæŠŠæ ‡å‡† Base64 ä¸­çš„  <code>/</code>  å’Œ  <code>+</code>  å­—ç¬¦å˜ä¸ºå½¢å¦‚  <code>%XX</code>  çš„å½¢å¼ï¼Œè€Œè¿™äº›  <code>%</code>  å·åœ¨å­˜å…¥æ•°æ®åº“æ—¶è¿˜éœ€è¦å†è¿›è¡Œè½¬æ¢ï¼Œå› ä¸º ANSI SQL ä¸­å·²å°†  <code>%</code>  å·ç”¨ä½œé€šé…ç¬¦ã€‚</p>
<p>ä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œå¯é‡‡ç”¨ä¸€ç§ç”¨äº URL çš„æ”¹è¿› Base64 ç¼–ç ï¼Œå®ƒä¸ä»…åœ¨æœ«å°¾å¡«å……  <code>=</code>  å·ï¼Œå¹¶å°†æ ‡å‡† Base64 ä¸­çš„ â€œ+â€ å’Œ â€œ/â€ åˆ†åˆ«æ”¹æˆäº†  <code>-</code>  å’Œ  <code>_</code> ï¼Œè¿™æ ·å°±å…å»äº†åœ¨ URL ç¼–è§£ç å’Œæ•°æ®åº“å­˜å‚¨æ—¶æ‰€è¦ä½œçš„è½¬æ¢ï¼Œé¿å…äº†ç¼–ç ä¿¡æ¯é•¿åº¦åœ¨æ­¤è¿‡ç¨‹ä¸­çš„å¢åŠ ï¼Œå¹¶ç»Ÿä¸€äº†æ•°æ®åº“ã€è¡¨å•ç­‰å¤„å¯¹è±¡æ ‡è¯†ç¬¦çš„æ ¼å¼ã€‚</p>
<p>å¦æœ‰ä¸€ç§ç”¨äºæ­£åˆ™è¡¨è¾¾å¼çš„æ”¹è¿› Base64 å˜ç§ï¼Œå®ƒå°†  <code>+</code>  å’Œ  <code>/</code>  æ”¹æˆäº†  <code>!</code>  å’Œ  <code>-</code> ï¼Œå› ä¸º  <code>+</code> ,  <code>*</code>  ä»¥åŠå‰é¢åœ¨ IRCu ä¸­ç”¨åˆ°çš„  <code>[</code>  å’Œ  <code>]</code>  åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­éƒ½å¯èƒ½å…·æœ‰ç‰¹æ®Šå«ä¹‰ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ <code>java.util.Base64</code>  ç¼–ç ã€è§£ç ç¤ºä¾‹</p>
<p><code>Base64.getEncoder()</code>  å’Œ  <code>Base64.getDecoder()</code>  æä¾›äº†çš„æ˜¯æ ‡å‡†çš„ Base64 ç¼–ç ã€è§£ç æ–¹å¼ï¼›</p>
<p><code>Base64.getUrlEncoder()</code>  å’Œ  <code>Base64.getUrlDecoder()</code>  æä¾›äº† URL å®‰å…¨çš„ Base64 ç¼–ç ã€è§£ç æ–¹å¼ï¼ˆå°†  <code>+</code>  å’Œ  <code>/</code>  æ›¿æ¢ä¸º  <code>-</code>  å’Œ  <code>_</code> ï¼‰ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Base64Demo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://www.baidu.com"</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"url:"</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ ‡å‡†çš„ Base64 ç¼–ç ã€è§£ç </span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encoded <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decoded <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Url Safe Base64 encoded:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Url Safe Base64 decoded:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// URL å®‰å…¨çš„ Base64 ç¼–ç ã€è§£ç </span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encoded2 <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decoded2 <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>encoded2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Base64 encoded:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>encoded2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Base64 decoded:"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoded2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">url:https://www.baidu.com
Url Safe Base64 encoded:aHR0cHM6Ly93d3cuYmFpZHUuY29t
Url Safe Base64 decoded:https://www.baidu.com
Base64 encoded:aHR0cHM6Ly93d3cuYmFpZHUuY29t
Base64 decoded:https://www.baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-276"><a class="markdownIt-Anchor" href="#-276">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E4%BA%8C%E3%80%81%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81">#</a>äºŒã€æ¶ˆæ¯æ‘˜è¦</h2>
<h3 id="-277"><a class="markdownIt-Anchor" href="#-277">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E6%A6%82%E8%BF%B0">#</a>æ¶ˆæ¯æ‘˜è¦æ¦‚è¿°</h3>
<p><strong>æ¶ˆæ¯æ‘˜è¦ï¼Œå…¶å®å°±æ˜¯å°†éœ€è¦æ‘˜è¦çš„æ•°æ®ä½œä¸ºå‚æ•°ï¼Œç»è¿‡å“ˆå¸Œå‡½æ•° (Hash) çš„è®¡ç®—ï¼Œå¾—åˆ°çš„æ•£åˆ—å€¼</strong>ã€‚</p>
<p>æ¶ˆæ¯æ‘˜è¦æ˜¯ä¸€ä¸ªå”¯ä¸€å¯¹åº”ä¸€ä¸ªæ¶ˆæ¯æˆ–æ–‡æœ¬çš„å›ºå®šé•¿åº¦çš„å€¼ï¼Œå®ƒç”±ä¸€ä¸ªå•å‘ Hash åŠ å¯†å‡½æ•°å¯¹æ¶ˆæ¯è¿›è¡Œä½œç”¨è€Œäº§ç”Ÿã€‚å¦‚æœæ¶ˆæ¯åœ¨é€”ä¸­æ”¹å˜äº†ï¼Œåˆ™æ¥æ”¶è€…é€šè¿‡å¯¹æ”¶åˆ°æ¶ˆæ¯çš„æ–°äº§ç”Ÿçš„æ‘˜è¦ä¸åŸæ‘˜è¦æ¯”è¾ƒï¼Œå°±å¯çŸ¥é“æ¶ˆæ¯æ˜¯å¦è¢«æ”¹å˜äº†ã€‚å› æ­¤æ¶ˆæ¯æ‘˜è¦ä¿è¯äº†æ¶ˆæ¯çš„å®Œæ•´æ€§ã€‚æ¶ˆæ¯æ‘˜è¦é‡‡ç”¨å•å‘ Hash å‡½æ•°å°†éœ€åŠ å¯†çš„æ˜æ–‡ &quot;æ‘˜è¦&quot; æˆä¸€ä¸²å¯†æ–‡ï¼Œè¿™ä¸€ä¸²å¯†æ–‡äº¦ç§°ä¸ºæ•°å­—æŒ‡çº¹ (Finger Print)ã€‚å®ƒæœ‰å›ºå®šçš„é•¿åº¦ï¼Œä¸”ä¸åŒçš„æ˜æ–‡æ‘˜è¦æˆå¯†æ–‡ï¼Œå…¶ç»“æœæ€»æ˜¯ä¸åŒçš„ï¼Œè€ŒåŒæ ·çš„æ˜æ–‡å…¶æ‘˜è¦å¿…å®šä¸€è‡´ã€‚è¿™æ ·è¿™ä¸²æ‘˜è¦ä¾¿å¯æˆä¸ºéªŒè¯æ˜æ–‡æ˜¯å¦æ˜¯ &quot;çœŸèº«&quot; çš„ &quot;æŒ‡çº¹&quot; äº†ã€‚</p>
<h3 id="-278"><a class="markdownIt-Anchor" href="#-278">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E7%89%B9%E7%82%B9">#</a>æ¶ˆæ¯æ‘˜è¦ç‰¹ç‚¹</h3>
<ul>
<li>å”¯ä¸€æ€§ï¼šæ•°æ®åªè¦æœ‰ä¸€ç‚¹æ”¹å˜ï¼Œé‚£ä¹ˆå†é€šè¿‡æ¶ˆæ¯æ‘˜è¦ç®—æ³•å¾—åˆ°çš„æ‘˜è¦ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ã€‚è™½ç„¶ç†è®ºä¸Šæœ‰å¯èƒ½ä¼šå‘ç”Ÿç¢°æ’ï¼Œä½†æ˜¯æ¦‚ç‡æå…¶ä½ã€‚</li>
<li>ä¸å¯é€†ï¼šæ¶ˆæ¯æ‘˜è¦ç®—æ³•çš„å¯†æ–‡æ— æ³•è¢«è§£å¯†ã€‚</li>
<li>ä¸éœ€è¦å¯†é’¥ï¼Œå¯ä½¿ç”¨äºåˆ†å¸ƒå¼ç½‘ç»œã€‚</li>
<li>æ— è®ºè¾“å…¥çš„æ˜æ–‡æœ‰å¤šé•¿ï¼Œè®¡ç®—å‡ºæ¥çš„æ¶ˆæ¯æ‘˜è¦çš„é•¿åº¦æ€»æ˜¯å›ºå®šçš„ã€‚</li>
</ul>
<h3 id="-279"><a class="markdownIt-Anchor" href="#-279">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95">#</a>æ¶ˆæ¯æ‘˜è¦å¸¸ç”¨ç®—æ³•</h3>
<p>æ¶ˆæ¯æ‘˜è¦ç®—æ³•åŒ…æ‹¬<strong> MD (Message Digestï¼Œæ¶ˆæ¯æ‘˜è¦ç®—æ³•)</strong>ã€<strong>SHA (Secure Hash Algorithmï¼Œå®‰å…¨æ•£åˆ—ç®—æ³•)</strong>ã€**MAC (Message AuthenticationCodeï¼Œæ¶ˆæ¯è®¤è¯ç ç®—æ³•)** å…± 3 å¤§ç³»åˆ—ï¼Œå¸¸ç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œæ˜¯æ•°å­—ç­¾åç®—æ³•çš„æ ¸å¿ƒç®—æ³•ã€‚</p>
<p><strong>MD5</strong> å’Œ<strong> SHA1</strong> åˆ†åˆ«æ˜¯<strong> MD</strong>ã€<strong>SHA</strong> ç®—æ³•ç³»åˆ—ä¸­æœ€æœ‰ä»£è¡¨æ€§çš„ç®—æ³•ã€‚</p>
<p>å¦‚ä»Šï¼ŒMD5 å·²è¢«å‘ç°æœ‰è®¸å¤šæ¼æ´ï¼Œä»è€Œä¸å†å®‰å…¨ã€‚SHA ç®—æ³•æ¯” MD ç®—æ³•çš„æ‘˜è¦é•¿åº¦æ›´é•¿ï¼Œä¹Ÿæ›´åŠ å®‰å…¨ã€‚</p>
<h3 id="-280"><a class="markdownIt-Anchor" href="#-280">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81%E5%BA%94%E7%94%A8">#</a>æ¶ˆæ¯æ‘˜è¦åº”ç”¨</h3>
<h4 id="-281"><a class="markdownIt-Anchor" href="#-281">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#md5%E3%80%81sha-%E7%9A%84%E8%8C%83%E4%BE%8B">#</a>MD5ã€SHA çš„èŒƒä¾‹</h4>
<p>JDK ä¸­ä½¿ç”¨ MD5 å’Œ SHA è¿™ä¸¤ç§æ¶ˆæ¯æ‘˜è¦çš„æ–¹å¼åŸºæœ¬ä¸€è‡´ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆå§‹åŒ– MessageDigest å¯¹è±¡</li>
<li>æ›´æ–°è¦è®¡ç®—çš„å†…å®¹</li>
<li>ç”Ÿæˆæ‘˜è¦</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageDigestDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input<span class="token punctuation">,</span> <span class="token class-name">Type</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æ ¹æ®ç±»å‹ï¼Œåˆå§‹åŒ–æ¶ˆæ¯æ‘˜è¦å¯¹è±¡</span>
        <span class="token class-name">MessageDigest</span> md5Digest <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æ›´æ–°è¦è®¡ç®—çš„å†…å®¹</span>
        md5Digest<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å®Œæˆå“ˆå¸Œè®¡ç®—ï¼Œè¿”å›æ‘˜è¦</span>
        <span class="token keyword">return</span> md5Digest<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encodeWithBase64</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input<span class="token punctuation">,</span> <span class="token class-name">Type</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input<span class="token punctuation">,</span> <span class="token class-name">Type</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Type</span> <span class="token punctuation">&#123;</span>
        <span class="token function">MD2</span><span class="token punctuation">(</span><span class="token string">"MD2"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">MD5</span><span class="token punctuation">(</span><span class="token string">"MD5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">SHA1</span><span class="token punctuation">(</span><span class="token string">"SHA1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">SHA256</span><span class="token punctuation">(</span><span class="token string">"SHA-256"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">SHA384</span><span class="token punctuation">(</span><span class="token string">"SHA-384"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">SHA512</span><span class="token punctuation">(</span><span class="token string">"SHA-512"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token class-name">Type</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MD2: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>MD2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MD5: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>MD5<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SHA1: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SHA1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SHA256: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SHA256<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SHA384: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SHA384<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SHA512: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SHA512<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è¾“å‡ºã€‘</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">MD2: MV98ZyI_Aft8q0uVEA6HLg==
MD5: 7Qdih1MuhjZehB6Sv8UNjA==
SHA1: Lve95gjOVATpfV8EL5X4nxwjKHE=
SHA256: f4OxZX_x_FO5LcGBSKHWXfwtSx-j1ncoSt3SABJtkGk=
SHA384: v9dsDrvQBv7lg0EFR8GIewKSvnbVgtlsJC0qeScj4_1v0GH51c_RO4-WE1jmrbpK
SHA512: hhhE1nBOhXP-w02WfiC8_vPUJM9IvgTm3AjyvVjHKXQzcQFerYkcw88cnTS0kmS1EHUbH_nlN5N7xGtdb_TsyA==<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-282"><a class="markdownIt-Anchor" href="#-282">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#hmac-%E7%9A%84%E8%8C%83%E4%BE%8B">#</a>HMAC çš„èŒƒä¾‹</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Mac</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HmacMessageDigest</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salt <span class="token operator">=</span> <span class="token string">"My Salt"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åŸæ–‡: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HmacMD5: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn<span class="token punctuation">.</span>HmacMD5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HmacSHA1: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn<span class="token punctuation">.</span>HmacSHA1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HmacSHA256: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn<span class="token punctuation">.</span>HmacSHA256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HmacSHA384: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn<span class="token punctuation">.</span>HmacSHA384</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HmacSHA512: "</span> <span class="token operator">+</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn<span class="token punctuation">.</span>HmacSHA512</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SecretKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>salt<span class="token punctuation">,</span> type<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Mac</span> mac <span class="token operator">=</span> <span class="token class-name">Mac</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mac<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> mac<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encodeWithBase64</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encodeWithBase64String</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salt<span class="token punctuation">,</span> <span class="token class-name">HmacTypeEn</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">,</span> salt<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * JDKæ”¯æŒ HmacMD5, HmacSHA1, HmacSHA256, HmacSHA384, HmacSHA512
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">HmacTypeEn</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">HmacMD5</span><span class="token punctuation">,</span> <span class="token class-name">HmacSHA1</span><span class="token punctuation">,</span> <span class="token class-name">HmacSHA256</span><span class="token punctuation">,</span> <span class="token class-name">HmacSHA384</span><span class="token punctuation">,</span> <span class="token class-name">HmacSHA512</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">åŸæ–‡: Hello World!
HmacMD5: re6BLRsB1Q26SfJTwXZUSQ==
HmacSHA1: CFu8a9H6CbY9C5fo0OmJ2bnuILM=
HmacSHA256: Z1czUqDWWfYYl7qEDJ2sUH6iieHVI7o83dXMl0JYER0=
HmacSHA384: 34mKtRQBOYnwwznmQubjrDk_MsLDGqM2PmgcplZUpLsKNrG_cwfz4bLPJCbBW88b
HmacSHA512: 6n77htTZ_atc04-SsmxhSK3wzh1sAmdudCl0Cb_RZp4DpienG4LZkhXMbq8lcK7XSnz6my_wIpnStDp6PC_-5w==<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-283"><a class="markdownIt-Anchor" href="#-283">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E4%B8%89%E3%80%81%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D">#</a>ä¸‰ã€æ•°å­—ç­¾å</h2>
<h3 id="-284"><a class="markdownIt-Anchor" href="#-284">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E6%A6%82%E8%BF%B0">#</a>æ•°å­—ç­¾åæ¦‚è¿°</h3>
<p>æ•°å­—ç­¾åç®—æ³•å¯ä»¥çœ‹åšæ˜¯ä¸€ç§å¸¦æœ‰å¯†é’¥çš„æ¶ˆæ¯æ‘˜è¦ç®—æ³•ï¼Œå¹¶ä¸”è¿™ç§å¯†é’¥åŒ…å«äº†å…¬é’¥å’Œç§é’¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>æ•°å­—ç­¾åç®—æ³•æ˜¯éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œæ¶ˆæ¯æ‘˜è¦ç®—æ³•çš„ç»“åˆä½“</strong>ã€‚</p>
<p>æ•°å­—ç­¾åç®—æ³•è¦æ±‚èƒ½å¤ŸéªŒè¯æ•°æ®å®Œæ•´æ€§ã€è®¤è¯æ•°æ®æ¥æºï¼Œå¹¶èµ·åˆ°æŠ—å¦è®¤çš„ä½œç”¨ã€‚</p>
<p>æ•°å­—ç­¾åç®—æ³•åŒ…å«ç­¾åå’ŒéªŒè¯ä¸¤é¡¹æ“ä½œï¼Œéµå¾ªç§é’¥ç­¾åï¼Œå…¬é’¥éªŒè¯çš„æ–¹å¼ã€‚</p>
<p>ç­¾åæ—¶è¦ä½¿ç”¨ç§é’¥å’Œå¾…ç­¾åæ•°æ®ï¼ŒéªŒè¯æ—¶åˆ™éœ€è¦å…¬é’¥ã€ç­¾åå€¼å’Œå¾…ç­¾åæ•°æ®ï¼Œå…¶æ ¸å¿ƒç®—æ³•ä¸»è¦æ˜¯æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/java-message-digest-process.jpg" alt="img"></p>
<p>æ•°å­—ç­¾åå¸¸ç”¨ç®—æ³•ï¼š<strong>RSA</strong>ã€<strong>DSA</strong>ã€<strong>ECDSA</strong></p>
<h3 id="-285"><a class="markdownIt-Anchor" href="#-285">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E7%AE%97%E6%B3%95%E5%BA%94%E7%94%A8">#</a>æ•°å­—ç­¾åç®—æ³•åº”ç”¨</h3>
<h4 id="-286"><a class="markdownIt-Anchor" href="#-286">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#dsa-%E7%9A%84%E8%8C%83%E4%BE%8B">#</a>DSA çš„èŒƒä¾‹</h4>
<p>æ•°å­—ç­¾åæœ‰ä¸¤ä¸ªæµç¨‹ï¼šç­¾åå’ŒéªŒè¯ã€‚</p>
<p>å®ƒä»¬çš„å‰æéƒ½æ˜¯è¦æœ‰ä¸€ä¸ªå…¬é’¥ã€å¯†é’¥å¯¹ã€‚</p>
<p>æ•°å­—ç­¾åç”¨ç§é’¥ä¸ºæ¶ˆæ¯è®¡ç®—ç­¾åã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ç”¨å…¬é’¥éªŒè¯æ‘˜è¦</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DsaCoder</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"DSA"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SIGN_ALGORITHM <span class="token operator">=</span> <span class="token string">"SHA1withDSA"</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * DSAå¯†é’¥é•¿åº¦é»˜è®¤1024ä½ã€‚ å¯†é’¥é•¿åº¦å¿…é¡»æ˜¯64çš„æ•´æ•°å€ï¼ŒèŒƒå›´åœ¨512~1024ä¹‹é—´
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> KEY_SIZE <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">KeyPair</span> keyPair<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DsaCoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyPair <span class="token operator">=</span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">KeyPair</span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åˆå§‹åŒ–å¯†é’¥å¯¹ç”Ÿæˆå™¨</span>
        <span class="token class-name">KeyPairGenerator</span> keyPairGen <span class="token operator">=</span> <span class="token class-name">KeyPairGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">DsaCoder</span><span class="token punctuation">.</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å®ä¾‹åŒ–å¯†é’¥å¯¹ç”Ÿæˆå™¨</span>
        keyPairGen<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span>KEY_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å®ä¾‹åŒ–å¯†é’¥å¯¹</span>
        <span class="token keyword">return</span> keyPairGen<span class="token punctuation">.</span><span class="token function">genKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">signature</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> privateKey<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrivateKey</span> key <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SIGN_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> publicKey<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">X509EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PublicKey</span> key <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>SIGN_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">;</span>
        <span class="token class-name">DsaCoder</span> dsa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DsaCoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign <span class="token operator">=</span> dsa<span class="token punctuation">.</span><span class="token function">signature</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dsa<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> dsa<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dsa<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> flag <span class="token operator">?</span> <span class="token string">"æ•°å­—ç­¾ååŒ¹é…"</span> <span class="token operator">:</span> <span class="token string">"æ•°å­—ç­¾åä¸åŒ¹é…"</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ•°å­—ç­¾åï¼š"</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"éªŒè¯ç»“æœï¼š"</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è¾“å‡ºã€‘</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">æ•°å­—ç­¾åï¼šMCwCFDPUO_VrONl5ST0AWary-MLXJuSCAhRMeMnUVhpizfa2H2M37tne0pUtoA==
éªŒè¯ç»“æœï¼šæ•°å­—ç­¾ååŒ¹é…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-287"><a class="markdownIt-Anchor" href="#-287">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%9B%9B%E3%80%81%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86">#</a>å››ã€å¯¹ç§°åŠ å¯†</h2>
<h3 id="-288"><a class="markdownIt-Anchor" href="#-288">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E6%A6%82%E8%BF%B0">#</a>å¯¹ç§°åŠ å¯†æ¦‚è¿°</h3>
<p>å¯¹ç§°åŠ å¯†ç®—æ³•ä¸»è¦æœ‰ DESã€3DESï¼ˆTripleDESï¼‰ã€AESã€IDEAã€RC2ã€RC4ã€RC5 å’Œ Blowfish ç­‰ã€‚</p>
<p>å¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯åº”ç”¨è¾ƒæ—©çš„åŠ å¯†ç®—æ³•ï¼ŒæŠ€æœ¯æˆç†Ÿã€‚åœ¨å¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼Œæ•°æ®å‘ä¿¡æ–¹å°†æ˜æ–‡ï¼ˆåŸå§‹æ•°æ®ï¼‰å’ŒåŠ å¯†å¯†é’¥ï¼ˆmi yaoï¼‰ä¸€èµ·ç»è¿‡ç‰¹æ®ŠåŠ å¯†ç®—æ³•å¤„ç†åï¼Œä½¿å…¶å˜æˆå¤æ‚çš„åŠ å¯†å¯†æ–‡å‘é€å‡ºå»ã€‚æ”¶ä¿¡æ–¹æ”¶åˆ°å¯†æ–‡åï¼Œè‹¥æƒ³è§£è¯»åŸæ–‡ï¼Œåˆ™éœ€è¦ä½¿ç”¨åŠ å¯†ç”¨è¿‡çš„å¯†é’¥åŠç›¸åŒç®—æ³•çš„é€†ç®—æ³•å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œæ‰èƒ½ä½¿å…¶æ¢å¤æˆå¯è¯»æ˜æ–‡ã€‚åœ¨å¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼Œä½¿ç”¨çš„å¯†é’¥åªæœ‰ä¸€ä¸ªï¼Œå‘æ”¶ä¿¡åŒæ–¹éƒ½ä½¿ç”¨è¿™ä¸ªå¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œè¿™å°±è¦æ±‚è§£å¯†æ–¹äº‹å…ˆå¿…é¡»çŸ¥é“åŠ å¯†å¯†é’¥ã€‚</p>
<p>å¯¹ç§°åŠ å¯†ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šè®¡ç®—é‡å°ã€åŠ å¯†é€Ÿåº¦å¿«ã€åŠ å¯†æ•ˆç‡é«˜ã€‚</li>
<li>ç¼ºç‚¹ï¼šç®—æ³•æ˜¯å…¬å¼€çš„ï¼Œå®‰å…¨æ€§å¾—ä¸åˆ°ä¿è¯ã€‚</li>
</ul>
<p>é€šä¿¡åŒæ–¹æ¯æ¬¡ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ—¶ï¼Œéƒ½éœ€è¦ä½¿ç”¨å…¶ä»–äººä¸çŸ¥é“çš„æƒŸä¸€å¯†é’¥ï¼Œè¿™ä¼šä½¿å¾—é€šä¿¡åŒæ–¹æ‰€æ‹¥æœ‰çš„å¯†é’¥æ•°é‡å‘ˆå‡ ä½•çº§æ•°å¢é•¿ï¼Œå¯†é’¥ç®¡ç†æˆä¸ºç”¨æˆ·çš„è´Ÿæ‹…ã€‚å¯¹ç§°åŠ å¯†ç®—æ³•åœ¨åˆ†å¸ƒå¼ç½‘ç»œç³»ç»Ÿä¸Šä½¿ç”¨è¾ƒä¸ºå›°éš¾ï¼Œä¸»è¦æ˜¯å› ä¸ºå¯†é’¥ç®¡ç†å›°éš¾ï¼Œä½¿ç”¨æˆæœ¬è¾ƒé«˜ã€‚</p>
<p>è€Œä¸å…¬é’¥ã€å¯†é’¥åŠ å¯†ç®—æ³•æ¯”èµ·æ¥ï¼Œå¯¹ç§°åŠ å¯†ç®—æ³•èƒ½å¤Ÿæä¾›åŠ å¯†å’Œè®¤è¯å´ç¼ºä¹äº†ç­¾ååŠŸèƒ½ï¼Œä½¿å¾—ä½¿ç”¨èŒƒå›´æœ‰æ‰€ç¼©å°ã€‚</p>
<h4 id="-289"><a class="markdownIt-Anchor" href="#-289">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86">#</a>å¯¹ç§°åŠ å¯†åŸç†</h4>
<p>å¯¹ç§°åŠ å¯†è¦æ±‚åŠ å¯†ä¸è§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ï¼Œè§£å¯†æ˜¯åŠ å¯†çš„é€†è¿ç®—ã€‚ç”±äºåŠ å¯†ã€è§£å¯†ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ï¼Œè¿™è¦æ±‚é€šä¿¡åŒæ–¹å¿…é¡»åœ¨é€šä¿¡å‰å•†å®šè¯¥å¯†é’¥ï¼Œå¹¶å¦¥å–„ä¿å­˜è¯¥å¯†é’¥ã€‚</p>
<p>å¯¹ç§°åŠ å¯†ä½“åˆ¶åˆ†ä¸ºä¸¤ç§ï¼š</p>
<p>ä¸€ç§æ˜¯å¯¹æ˜æ–‡çš„å•ä¸ªä½ï¼ˆæˆ–å­—èŠ‚ï¼‰è¿›è¡Œè¿ç®—ï¼Œç§°ä¸ºæµå¯†ç ï¼Œä¹Ÿç§°ä¸ºåºåˆ—å¯†ç ï¼›</p>
<p>ä¸€ç§æ˜¯æŠŠæ˜æ–‡ä¿¡æ¯åˆ’åˆ†ä¸ºä¸åŒçš„ç»„ï¼ˆæˆ–å—ï¼‰ç»“æ„ï¼Œåˆ†åˆ«å¯¹æ¯ä¸ªç»„ï¼ˆæˆ–å—ï¼‰è¿›è¡ŒåŠ å¯†ã€è§£å¯†ï¼Œç§°ä¸ºåˆ†ç»„å¯†ç ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/symmetric-encryption.png" alt="img"></p>
<p>å‡è®¾ç”²ä¹™æ–¹ä½œä¸ºé€šä¿¡åŒæ–¹ã€‚å‡å®šç”²ä¹™åŒæ–¹åœ¨æ¶ˆæ¯ä¼ é€’å‰å·²å•†å®šåŠ å¯†ç®—æ³•ï¼Œæ¬²å®Œæˆä¸€æ¬¡æ¶ˆæ¯ä¼ é€’éœ€è¦ç»è¿‡å¦‚ä¸‹æ­¥éª¤ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/advanced/symmetric-encryption-progress.png" alt="img"></p>
<h4 id="-290"><a class="markdownIt-Anchor" href="#-290">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F">#</a>å¯¹ç§°åŠ å¯†å·¥ä½œæ¨¡å¼</h4>
<p>ä»¥ DES ç®—æ³•çš„å·¥ä½œæ¨¡å¼ä¸ºä¾‹ï¼ŒDES ç®—æ³•æ ¹æ®å…¶åŠ å¯†ç®—æ³•æ‰€å®šä¹‰çš„æ˜æ–‡åˆ†ç»„çš„å¤§å°ï¼ˆ56 ä½ï¼‰ï¼Œå°†æ•°æ®åˆ†å‰²æˆè‹¥å¹² 56 ä½çš„åŠ å¯†åŒºå—ï¼Œå†ä»¥åŠ å¯†åŒºå—ä¸ºå•ä½ï¼Œåˆ†åˆ«è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚å¦‚æœæœ€åå‰©ä¸‹ä¸è¶³ä¸€ä¸ªåŒºå—çš„å¤§å°ï¼Œç§°ä¹‹ä¸º<strong>çŸ­å—</strong>ã€‚çŸ­å—çš„å¤„ç†æ–¹æ³•æœ‰å¡«å……æ³•ã€æµå¯†ç åŠ å¯†æ³•ã€å¯†æ–‡æŒªç”¨æŠ€æœ¯ã€‚</p>
<p>æ ¹æ®æ•°æ®åŠ å¯†æ—¶æ¯ä¸ªåŠ å¯†åŒºå—è§å¾—å…³è”æ–¹å¼æ¥åŒºåˆ†ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ç§å·¥ä½œæ¨¡å¼ï¼š</p>
<p><strong>(1) ç”µå­å¯†ç æœ¬æ¨¡å¼ (Electronic Code Book, ECB)</strong></p>
<p>ç”¨é€”ï¼šé€‚åˆåŠ å¯†å¯†é’¥ï¼Œéšæœºæ•°ç­‰çŸ­æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå®‰å…¨åœ°ä¼ é€’ DES å¯†é’¥ï¼ŒECB æ˜¯æœ€åˆé€‚çš„æ¨¡å¼ã€‚</p>
<p><strong>(2) å¯†æ–‡é“¾æ¥æ¨¡å¼ (Cipher Booki Chaining, CBC)</strong></p>
<p>ç”¨é€”ï¼šå¯åŠ å¯†ä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œé€‚ç”¨äºè®¡ç®—äº§ç”Ÿæ£€æµ‹æ•°æ®å®Œæ•´æ€§çš„æ¶ˆæ¯è®¤è¯ MACã€‚</p>
<p><strong>(3) å¯†æ–‡åé¦ˆæ¨¡å¼ (Cipher Feed Back, CFB)</strong></p>
<p>ç”¨é€”ï¼šå› é”™è¯¯ä¼ æ’­æ— ç•Œï¼Œå¯ä»¥ç”¨äºæ£€æŸ¥å‘ç°æ˜æ–‡å¯†æ–‡çš„ç¯¡æ”¹ã€‚</p>
<p><strong>(4) è¾“å‡ºåé¦ˆæ¨¡å¼ (Output Feed Back, OFB)</strong></p>
<p>ç”¨é€”ï¼šä½¿ç”¨äºåŠ å¯†å†—ä½™æ€§è¾ƒå¤§çš„æ•°æ®ï¼Œæ¯”å¦‚è¯­éŸ³å’Œå›¾åƒæ•°æ®ã€‚</p>
<p>AES ç®—æ³•é™¤äº†ä»¥ä¸Š 4 ä¸­æ¨¡å¼å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ–°çš„å·¥ä½œæ¨¡å¼ï¼š</p>
<p><strong>(5) è®¡æ•°å™¨æ¨¡å¼ (Counter, CTR)</strong></p>
<p>ç”¨é€”ï¼šé€‚ç”¨äºå„ç§åŠ å¯†åº”ç”¨ã€‚</p>
<p>æœ¬æ–‡å¯¹äºå„ç§å·¥ä½œæ¨¡å¼çš„åŸç†å±•å¼€æè¿°ã€‚ä¸ªäººè®¤ä¸ºï¼Œä½œä¸ºå·¥ç¨‹åº”ç”¨ï¼Œäº†è§£å…¶ç”¨é€”å³å¯ã€‚</p>
<h4 id="-291"><a class="markdownIt-Anchor" href="#-291">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%A1%AB%E5%85%85%E6%96%B9%E6%B3%95">#</a>å¯¹ç§°åŠ å¯†å¡«å……æ–¹æ³•</h4>
<p>Java ä¸­å¯¹ç§°åŠ å¯†å¯¹äºçŸ­å—çš„å¤„ç†ï¼Œä¸€èˆ¬æ˜¯é‡‡ç”¨å¡«å……æ–¹å¼ã€‚</p>
<p>å¸¸é‡‡ç”¨çš„æ˜¯ï¼šNoPaddingï¼ˆä¸å¡«å……ï¼‰ã€Zeros å¡«å……ï¼ˆ0 å¡«å……ï¼‰ã€PKCS5Padding å¡«å……ã€‚</p>
<p><strong>ZerosPadding</strong></p>
<p>æ–¹å¼ï¼šå…¨éƒ¨å¡«å……ä¸º 0 çš„å­—èŠ‚</p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p>F1 F2 F3 F4 F5 F6 F7 F8 // ç¬¬ä¸€å—</p>
<p>F9 00 00 00 00 00 00 00 // ç¬¬äºŒå—</p>
<p><strong>PKCS5Padding</strong></p>
<p>æ–¹å¼ï¼šæ¯ä¸ªå¡«å……çš„å­—èŠ‚éƒ½è®°å½•äº†å¡«å……çš„æ€»å­—èŠ‚æ•°</p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<p>F1 F2 F3 F4 F5 F6 F7 F8 // ç¬¬ä¸€å—</p>
<p>F9 07 07 07 07 07 07 07 // ç¬¬äºŒå—</p>
<h3 id="-292"><a class="markdownIt-Anchor" href="#-292">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E5%BA%94%E7%94%A8">#</a>å¯¹ç§°åŠ å¯†åº”ç”¨</h3>
<h4 id="-293"><a class="markdownIt-Anchor" href="#-293">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%9F%BA%E4%BA%8E%E5%AF%86%E9%92%A5%E5%8A%A0%E5%AF%86%E7%9A%84%E6%B5%81%E7%A8%8B-des%E3%80%81desede%E3%80%81aes-%E5%92%8C-idea">#</a>åŸºäºå¯†é’¥åŠ å¯†çš„æµç¨‹ï¼ˆDESã€DESedeã€AES å’Œ IDEAï¼‰</h4>
<p>DESã€DESedeã€AES å’Œ IDEA ç­‰ç®—æ³•éƒ½æ˜¯åŸºäºå¯†é’¥åŠ å¯†çš„å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå®ƒä»¬çš„å®ç°æµç¨‹ä¹ŸåŸºæœ¬ä¸€è‡´ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰ç”Ÿæˆå¯†é’¥</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">KeyGenerator</span> kg <span class="token operator">=</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SecureRandom</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
kg<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>random<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> kg<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å»ºè®®ä½¿ç”¨éšæœºæ•°æ¥åˆå§‹åŒ–å¯†é’¥çš„ç”Ÿæˆã€‚</p>
<p>ï¼ˆ2ï¼‰åˆå§‹åŒ–å¯†ç å¯¹è±¡</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DES/ECB/PKCS5Padding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>ENCRYPT_MODE</code> ï¼šåŠ å¯†æ¨¡å¼</p>
<p><code>DECRYPT_MODE</code> ï¼šè§£å¯†æ¨¡å¼</p>
<p>ï¼ˆ3ï¼‰æ‰§è¡Œ</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">String plaintext = "Hello World";
byte[] ciphertext = cipher.doFinal(plaintext.getBytes());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä¸€ä¸ªå®Œæ•´çš„ DES åŠ å¯†è§£å¯†èŒƒä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">IvParameterSpec</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * DESå®‰å…¨ç¼–ç ï¼šæ˜¯ç»å…¸çš„å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å¯†é’¥ä»…56ä½ï¼Œä¸”è¿­ä»£æ¬¡æ•°åå°‘ã€‚å·²è¢«è§†ä¸ºå¹¶ä¸å®‰å…¨çš„åŠ å¯†ç®—æ³•ã€‚
 *
 * @author Zhang Peng
 * @since 2016å¹´7æœˆ14æ—¥
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DESCoder</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY_ALGORITHM_DES <span class="token operator">=</span> <span class="token string">"DES"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CIPHER_DES_DEFAULT <span class="token operator">=</span> <span class="token string">"DES"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CIPHER_DES_ECB_PKCS5PADDING <span class="token operator">=</span> <span class="token string">"DES/ECB/PKCS5Padding"</span><span class="token punctuation">;</span> <span class="token comment">// ç®—æ³•/æ¨¡å¼/è¡¥ç æ–¹å¼</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CIPHER_DES_CBC_PKCS5PADDING <span class="token operator">=</span> <span class="token string">"DES/CBC/PKCS5Padding"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CIPHER_DES_CBC_NOPADDING <span class="token operator">=</span> <span class="token string">"DES/CBC/NoPadding"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SEED <span class="token operator">=</span> <span class="token string">"%%%today is nice***"</span><span class="token punctuation">;</span> <span class="token comment">// ç”¨äºç”Ÿæˆéšæœºæ•°çš„ç§å­</span>

    <span class="token keyword">private</span> <span class="token class-name">Key</span> key<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Cipher</span> cipher<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> transformation<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DESCoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchPaddingException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchProviderException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>CIPHER_DES_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transformation <span class="token operator">=</span> CIPHER_DES_DEFAULT<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * æ ¹æ®éšæœºæ•°ç§å­ç”Ÿæˆä¸€ä¸ªå¯†é’¥
     *
     * @return Key
     * @throws NoSuchAlgorithmException
     * @throws NoSuchProviderException
     * @author Zhang Peng
     * @since 2016å¹´7æœˆ14æ—¥
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Key</span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchProviderException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æ ¹æ®ç§å­ç”Ÿæˆä¸€ä¸ªå®‰å…¨çš„éšæœºæ•°</span>
        <span class="token class-name">SecureRandom</span> secureRandom <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        secureRandom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span>SEED<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">KeyGenerator</span> keyGen <span class="token operator">=</span> <span class="token class-name">KeyGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM_DES<span class="token punctuation">)</span><span class="token punctuation">;</span>
        keyGen<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>secureRandom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyGen<span class="token punctuation">.</span><span class="token function">generateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">DESCoder</span><span class="token punctuation">(</span><span class="token class-name">String</span> transformation<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchPaddingException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchProviderException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>transformation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>transformation <span class="token operator">=</span> transformation<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * åŠ å¯†
     *
     * @param input æ˜æ–‡
     * @return byte[] å¯†æ–‡
     * @throws InvalidKeyException
     * @throws IllegalBlockSizeException
     * @throws BadPaddingException
     * @throws InvalidAlgorithmParameterException
     * @author Zhang Peng
     * @since 2016å¹´7æœˆ20æ—¥
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvalidKeyException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalBlockSizeException</span><span class="token punctuation">,</span> <span class="token class-name">BadPaddingException</span><span class="token punctuation">,</span>
        <span class="token class-name">InvalidAlgorithmParameterException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>transformation<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>CIPHER_DES_CBC_PKCS5PADDING<span class="token punctuation">)</span> <span class="token operator">||</span> transformation<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>CIPHER_DES_CBC_NOPADDING<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span><span class="token function">getIV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * è§£å¯†
     *
     * @param input å¯†æ–‡
     * @return byte[] æ˜æ–‡
     * @throws InvalidKeyException
     * @throws IllegalBlockSizeException
     * @throws BadPaddingException
     * @throws InvalidAlgorithmParameterException
     * @author Zhang Peng
     * @since 2016å¹´7æœˆ20æ—¥
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> input<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InvalidKeyException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalBlockSizeException</span><span class="token punctuation">,</span> <span class="token class-name">BadPaddingException</span><span class="token punctuation">,</span>
        <span class="token class-name">InvalidAlgorithmParameterException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>transformation<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>CIPHER_DES_CBC_PKCS5PADDING<span class="token punctuation">)</span> <span class="token operator">||</span> transformation<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>CIPHER_DES_CBC_NOPADDING<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span><span class="token function">getIV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getIV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> iv <span class="token operator">=</span> <span class="token string">"01234567"</span><span class="token punctuation">;</span> <span class="token comment">// IV length: must be 8 bytes long</span>
        <span class="token keyword">return</span> iv<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">DESCoder</span> aes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DESCoder</span><span class="token punctuation">(</span>CIPHER_DES_CBC_PKCS5PADDING<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åŸæ–‡: "</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encoded <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> encodedBase64 <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†æ–‡: "</span> <span class="token operator">+</span> encodedBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decodedBase64 <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>encodedBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decoded <span class="token operator">=</span> aes<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>decodedBase64<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ˜æ–‡: "</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>decoded<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">åŸæ–‡: Hello World!
å¯†æ–‡: TtnEu9ezNQtxFKpmq_37Qw==
æ˜æ–‡: Hello World!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="-294"><a class="markdownIt-Anchor" href="#-294">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%9F%BA%E4%BA%8E%E5%8F%A3%E4%BB%A4%E5%8A%A0%E5%AF%86%E7%9A%84%E6%B5%81%E7%A8%8B-pbe">#</a>åŸºäºå£ä»¤åŠ å¯†çš„æµç¨‹ï¼ˆPBEï¼‰</h4>
<p>DESã€DESedeã€AESã€IDEA è¿™å‡ ç§ç®—æ³•çš„åº”ç”¨æ¨¡å‹å‡ ä¹å¦‚å‡ºä¸€è¾™ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰å¯¹ç§°åŠ å¯†ç®—æ³•éƒ½æ˜¯å¦‚æ­¤ã€‚</p>
<p>åŸºäºå£ä»¤åŠ å¯† (Password Based Encryption, PBE) æ˜¯ä¸€ç§åŸºäºå£ä»¤åŠ å¯†çš„ç®—æ³•ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼šå£ä»¤ç”±ç”¨æˆ·è‡ªå·±æŒç®¡ï¼Œé‡‡ç”¨éšæœºæ•°ï¼ˆè¿™é‡Œå«åšç›ï¼‰æ‚å‡‘å¤šé‡åŠ å¯†ç­‰æ–¹æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p>
<p>PBE æ²¡æœ‰å¯†é’¥æ¦‚å¿µï¼Œå¯†é’¥åœ¨å…¶ä»–å¯¹ç§°åŠ å¯†ç®—æ³•ä¸­æ˜¯ç»è¿‡è®¡ç®—å¾—å‡ºçš„ï¼ŒPBE åˆ™ä½¿ç”¨å£ä»¤æ›¿ä»£äº†å¯†é’¥ã€‚</p>
<p>æµç¨‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/advanced/password-based-encryption-progress.png" alt="img"></p>
<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>ï¼ˆ1ï¼‰äº§ç”Ÿç›</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SecureRandom</span> secureRandom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salt <span class="token operator">=</span> secureRandom<span class="token punctuation">.</span><span class="token function">generateSeed</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›é•¿åº¦å¿…é¡»ä¸º8å­—èŠ‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>ï¼ˆ2ï¼‰æ ¹æ®å¯†ç äº§ç”Ÿ Key</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span>
<span class="token class-name">PBEKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEKeySpec</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SecretKeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">SecretKeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>ï¼ˆ3ï¼‰åˆå§‹åŒ–åŠ å¯†æˆ–è§£å¯†å¯¹è±¡</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">PBEParameterSpec</span> paramSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEParameterSpec</span><span class="token punctuation">(</span>salt<span class="token punctuation">,</span> ITERATION_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> paramSpec<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>ï¼ˆ4ï¼‰æ‰§è¡Œ</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ï¼ˆ5ï¼‰å®Œæ•´ PBE ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">Key</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">SecureRandom</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Cipher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">SecretKey</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">SecretKeyFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">PBEKeySpec</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">PBEParameterSpec</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * åŸºäºå£ä»¤åŠ å¯†(Password Based Encryption, PBE)ï¼Œæ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ å…¶ç‰¹ç‚¹æ˜¯ï¼šå£ä»¤ç”±ç”¨æˆ·è‡ªå·±æŒç®¡ï¼Œé‡‡ç”¨éšæœºæ•°ï¼ˆè¿™é‡Œå«åšç›ï¼‰æ‚å‡‘å¤šé‡åŠ å¯†ç­‰æ–¹æ³•ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚
 * PBEæ²¡æœ‰å¯†é’¥æ¦‚å¿µï¼Œå¯†é’¥åœ¨å…¶ä»–å¯¹ç§°åŠ å¯†ç®—æ³•ä¸­æ˜¯ç»è¿‡è®¡ç®—å¾—å‡ºçš„ï¼ŒPBEåˆ™ä½¿ç”¨å£ä»¤æ›¿ä»£äº†å¯†é’¥ã€‚
 *
 * @author Zhang Peng
 * @since 2016å¹´7æœˆ20æ—¥
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PBECoder</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"PBEWITHMD5andDES"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> ITERATION_COUNT <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Key</span> key<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salt<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PBECoder</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>salt <span class="token operator">=</span> <span class="token function">initSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token function">initKey</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">initSalt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SecureRandom</span> secureRandom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> secureRandom<span class="token punctuation">.</span><span class="token function">generateSeed</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›é•¿åº¦å¿…é¡»ä¸º8å­—èŠ‚</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">Key</span> <span class="token function">initKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PBEKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEKeySpec</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">SecretKeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PBEParameterSpec</span> paramSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEParameterSpec</span><span class="token punctuation">(</span>salt<span class="token punctuation">,</span> ITERATION_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> key<span class="token punctuation">,</span> paramSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PBEParameterSpec</span> paramSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEParameterSpec</span><span class="token punctuation">(</span>salt<span class="token punctuation">,</span> ITERATION_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> key<span class="token punctuation">,</span> paramSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// äº§ç”Ÿç›</span>
        <span class="token class-name">SecureRandom</span> secureRandom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecureRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> salt <span class="token operator">=</span> secureRandom<span class="token punctuation">.</span><span class="token function">generateSeed</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç›é•¿åº¦å¿…é¡»ä¸º8å­—èŠ‚</span>

        <span class="token comment">// äº§ç”ŸKey</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span>
        <span class="token class-name">PBEKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEKeySpec</span><span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">SecretKeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SecretKey</span> secretKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generateSecret</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">PBEParameterSpec</span> paramSpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBEParameterSpec</span><span class="token punctuation">(</span>salt<span class="token punctuation">,</span> ITERATION_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> paramSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext <span class="token operator">=</span> <span class="token string">"Hello World"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PBECoder</span> encode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PBECoder</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext <span class="token operator">=</span> encode<span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext <span class="token operator">=</span> encode<span class="token punctuation">.</span><span class="token function">decrypt</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åŸæ–‡ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†æ–‡ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ˜æ–‡ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-295"><a class="markdownIt-Anchor" href="#-295">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E4%BA%94%E3%80%81%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86">#</a>äº”ã€éå¯¹ç§°åŠ å¯†</h2>
<h3 id="-296"><a class="markdownIt-Anchor" href="#-296">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E6%A6%82%E8%BF%B0">#</a>éå¯¹ç§°åŠ å¯†æ¦‚è¿°</h3>
<p>éå¯¹ç§°åŠ å¯†å¸¸ç”¨ç®—æ³•ï¼šDH (Diffie-Hellmanï¼Œå¯†é’¥äº¤æ¢ç®—æ³•)ã€RSA</p>
<p>éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œå¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¸»è¦å·®åˆ«åœ¨äºéå¯¹ç§°åŠ å¯†ç®—æ³•ç”¨äºåŠ å¯†å’Œè§£å¯†çš„å¯†é’¥æ˜¯ä¸åŒçš„ã€‚ä¸€ä¸ªå…¬å¼€ï¼Œç§°ä¸ºå…¬é’¥ï¼ˆpublic keyï¼‰ï¼›ä¸€ä¸ªä¿å¯†ï¼Œç§°ä¸ºç§é’¥ï¼ˆprivate keyï¼‰ã€‚å› æ­¤ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•ä¹Ÿç§°ä¸ºåŒé’¥åŠ å¯†ç®—æ³•æˆ–å…¬é’¥åŠ å¯†ç®—æ³•ã€‚</p>
<p>éå¯¹ç§°åŠ å¯†ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šéå¯¹ç§°åŠ å¯†ç®—æ³•è§£å†³äº†å¯¹ç§°åŠ å¯†ç®—æ³•çš„å¯†é’¥åˆ†é…é—®é¢˜ï¼Œå¹¶æå¤§åœ°æé«˜äº†ç®—æ³•å®‰å…¨æ€§ã€‚</li>
<li>ç¼ºç‚¹ï¼šç®—æ³•æ¯”å¯¹ç§°ç®—æ³•æ›´å¤æ‚ï¼Œå› æ­¤åŠ å¯†ã€è§£å¯†é€Ÿåº¦éƒ½æ¯”å¯¹ç§°ç®—æ³•æ…¢å¾ˆå¤šã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/asymmetric-encryption.png" alt="img"></p>
<p>éå¯¹ç§°åŠ å¯†ç®—æ³•å®ç°æœºå¯†ä¿¡æ¯äº¤æ¢çš„åŸºæœ¬è¿‡ç¨‹æ˜¯ï¼šç”²æ–¹ç”Ÿæˆä¸€å¯¹å¯†é’¥å¹¶å°†å…¶ä¸­çš„ä¸€æŠŠä½œä¸ºå…¬ç”¨å¯†é’¥å‘å…¶å®ƒæ–¹å…¬å¼€ï¼›å¾—åˆ°è¯¥å…¬ç”¨å¯†é’¥çš„ä¹™æ–¹ä½¿ç”¨è¯¥å¯†é’¥å¯¹æœºå¯†ä¿¡æ¯è¿›è¡ŒåŠ å¯†åå†å‘é€ç»™ç”²æ–¹ï¼›ç”²æ–¹å†ç”¨è‡ªå·±ä¿å­˜çš„å¦ä¸€æŠŠä¸“ç”¨å¯†é’¥å¯¹åŠ å¯†åçš„ä¿¡æ¯è¿›è¡Œè§£å¯†ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œç”²æ–¹å¯ä»¥ä½¿ç”¨ä¹™æ–¹çš„å…¬é’¥å¯¹æœºå¯†ä¿¡æ¯è¿›è¡Œç­¾ååå†å‘é€ç»™ä¹™æ–¹ï¼›ä¹™æ–¹å†ç”¨è‡ªå·±çš„ç§åŒ™å¯¹æ•°æ®è¿›è¡ŒéªŒè¯ã€‚</p>
<p>ç”²æ–¹åªèƒ½ç”¨å…¶ç§é’¥è§£å¯†ï¼Œç”±å…¶å…¬é’¥åŠ å¯†åçš„ä»»ä½•ä¿¡æ¯ã€‚ éå¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¿å¯†æ€§æ¯”è¾ƒå¥½ï¼Œå®ƒæ¶ˆé™¤äº†æœ€ç»ˆç”¨æˆ·äº¤æ¢å¯†é’¥çš„éœ€è¦ã€‚</p>
<h3 id="-297"><a class="markdownIt-Anchor" href="#-297">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E5%BA%94%E7%94%A8">#</a>éå¯¹ç§°åŠ å¯†ç®—æ³•åº”ç”¨</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Cipher</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * RSAå®‰å…¨ç¼–ç ï¼šéå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚å®ƒæ—¢å¯ä»¥ç”¨æ¥åŠ å¯†ã€è§£å¯†ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åšæ•°å­—ç­¾å
 *
 * @author Zhang Peng
 * @since 2016å¹´7æœˆ20æ—¥
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RSACoder</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> KEY_ALGORITHM <span class="token operator">=</span> <span class="token string">"RSA"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> SIGN_ALGORITHM <span class="token operator">=</span> <span class="token string">"MD5WithRSA"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">KeyPair</span> keyPair<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RSACoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyPair <span class="token operator">=</span> <span class="token function">initKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">KeyPair</span> <span class="token function">initKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// KeyPairGeneratorç±»ç”¨äºç”Ÿæˆå…¬é’¥å’Œç§é’¥å¯¹ï¼ŒåŸºäºRSAç®—æ³•ç”Ÿæˆå¯¹è±¡</span>
        <span class="token class-name">KeyPairGenerator</span> keyPairGen <span class="token operator">=</span> <span class="token class-name">KeyPairGenerator</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆå§‹åŒ–å¯†é’¥å¯¹ç”Ÿæˆå™¨ï¼Œå¯†é’¥å¤§å°ä¸º1024ä½</span>
        keyPairGen<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹</span>
        <span class="token keyword">return</span> keyPairGen<span class="token punctuation">.</span><span class="token function">genKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">X509EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">X509EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>keyFactory<span class="token punctuation">.</span><span class="token function">getAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">signature</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> privateKey<span class="token punctuation">,</span> <span class="token class-name">RsaSignTypeEn</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PKCS8EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PKCS8EncodedKeySpec</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrivateKey</span> key <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePrivate</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initSign</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> publicKey<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign<span class="token punctuation">,</span> <span class="token class-name">RsaSignTypeEn</span> type<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">X509EncodedKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">X509EncodedKeySpec</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">KeyFactory</span> keyFactory <span class="token operator">=</span> <span class="token class-name">KeyFactory</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>KEY_ALGORITHM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PublicKey</span> key <span class="token operator">=</span> keyFactory<span class="token punctuation">.</span><span class="token function">generatePublic</span><span class="token punctuation">(</span>keySpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> <span class="token class-name">Signature</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">initVerify</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        signature<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> signature<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">RsaSignTypeEn</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">MD2WithRSA</span><span class="token punctuation">,</span>
        <span class="token class-name">MD5WithRSA</span><span class="token punctuation">,</span>
        <span class="token class-name">SHA1WithRSA</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
        <span class="token class-name">RSACoder</span> coder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RSACoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext <span class="token operator">=</span> coder<span class="token punctuation">.</span><span class="token function">encryptByPrivateKey</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">,</span> coder<span class="token punctuation">.</span>keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext <span class="token operator">=</span> coder<span class="token punctuation">.</span><span class="token function">decryptByPublicKey</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">,</span> coder<span class="token punctuation">.</span>keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ciphertext2 <span class="token operator">=</span> coder<span class="token punctuation">.</span><span class="token function">encryptByPublicKey</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> coder<span class="token punctuation">.</span>keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> plaintext2 <span class="token operator">=</span> coder<span class="token punctuation">.</span><span class="token function">decryptByPrivateKey</span><span class="token punctuation">(</span>ciphertext2<span class="token punctuation">,</span> coder<span class="token punctuation">.</span>keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sign <span class="token operator">=</span> coder<span class="token punctuation">.</span><span class="token function">signature</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> coder<span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">RsaSignTypeEn<span class="token punctuation">.</span>SHA1WithRSA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> coder<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> coder<span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sign<span class="token punctuation">,</span> <span class="token class-name">RsaSignTypeEn<span class="token punctuation">.</span>SHA1WithRSA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> flag <span class="token operator">?</span> <span class="token string">"æ•°å­—ç­¾ååŒ¹é…"</span> <span class="token operator">:</span> <span class="token string">"æ•°å­—ç­¾åä¸åŒ¹é…"</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åŸæ–‡ï¼š"</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å…¬é’¥ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>coder<span class="token punctuation">.</span>keyPair<span class="token punctuation">.</span><span class="token function">getPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç§é’¥ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>coder<span class="token punctuation">.</span>keyPair<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEncoded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============== ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯† =============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†æ–‡ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>ciphertext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ˜æ–‡ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plaintext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============== å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯† =============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†æ–‡ï¼š"</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>ciphertext2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ˜æ–‡ï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>plaintext2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============== æ•°å­—ç­¾å =============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ•°å­—ç­¾åï¼š"</span> <span class="token operator">+</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getUrlEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"éªŒè¯ç»“æœï¼š"</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">åŸæ–‡ï¼šHello World!
å…¬é’¥ï¼šMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCzPtRLErTUcYtr8GmIpvbso7FN18thuEq02U21mh7TA4FH4TjvNgOZrZEORYu94dxrPdnrPjh0p62P5pDIjx_dtGlZr0aGWgtTvBbPwAKE4keXyPqv4VV6iXRzyQ2HdOvFOovim5eu0Tu_TxGeNpFfp0pYj2LXCzpsgSrdUPuPmwIDAQAB
ç§é’¥ï¼šMIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBALM-1EsStNRxi2vwaYim9uyjsU3Xy2G4SrTZTbWaHtMDgUfhOO82A5mtkQ5Fi73h3Gs92es-OHSnrY_mkMiPH920aVmvRoZaC1O8Fs_AAoTiR5fI-q_hVXqJdHPJDYd068U6i-Kbl67RO79PEZ42kV-nSliPYtcLOmyBKt1Q-4-bAgMBAAECgYBJxOXiL8S0WjajKcKFNxIQuh3Sh6lwgkRcwcI1p0RgW-TtDEg-SuCYctJsKTsl3rq0eDQjmOvrNsc7ngygPidCiTdbD1H6m3tLrebBB-wZdXMSWPsHtQJsq4dE0e93mmfysciOP6QExOs0JqVjTyyBSK37LpUcLdalj2IJDtC0gQJBAPfMngZAuIPmXued7PUuWNBuwxnkmdMcs308eC_9vnLLXWhDB9xKMuXCMwqk16MJ6j1FQWtJu62T21yniWWQHIsCQQC5LWqKfRxVukgnBg0Pa95NVWWY01Yttnb125JsLxeKbR97KU4VgBaBcB9TyUdPr9lxAzGFg6Y3A1wfsfukaGsxAkEA1l719oLXHYSWZdmBvTozK14m-qeBS9lwjc9aSmpB8B1u2Vvj2Pd3wLyYW4Tv5-QT-J2JUr-e1TMseqOVgX-CsQJAETRoBq_zFv_0vjNwuTMTd2nsw5M3GY4vZU5eP1Dsxf63gxDmYVcCQEpzjqxPxNaYxEhArJ_7rHbSc1ts_ux4sQJBAIlbGQC4-92foXGzWT80rsqZlMQ8J8Nbjpoo7RUN9tgx60Vkr3xv26Vos77oqdufWlt5IiBZBS9acTA2suav6Qg=
============== ç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯† ==============
å¯†æ–‡ï¼šqn6iGjSJV45EnH21RYRx2UZfMueqplbm1g3VIpBBQBuF63RdHdSgMJsVPAuB__V0rxpPlU3gR6qLyWu1mpaJ-ix_6KogAH64wqTWqPRh7E6aj767rybNpt9JyVlCmmpy9DiqHAUFWtBJDo34q-a7Fhq9c8bWrJ6jnn47IdmzHfU=
æ˜æ–‡ï¼šHello World!
============== å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯† ==============
å¯†æ–‡ï¼šfsz2IFs69d7JDrH-yoe5pi5WKQU1Zml7SDSpPqTZUn6muSCjNp6x312deQCXKMGSeAdMpVeb01yZBfa0MT_6eYJYVseU7Rd6bDf6YIg3AZFC41yh5ITiTvQ-XzxugnppS12sLpXSWg0faa5qjcVZnoTX9p7nHr8n20y4CNMI6Rw=
æ˜æ–‡ï¼šHello World!
============== æ•°å­—ç­¾å ==============
æ•°å­—ç­¾åï¼šdTtUUlWX1wRQbW1PcA8O6WJcWcrHinEZRXwgLKEwBOm2DpvHnynvV_HYKS-qFE5_4vJQcPGJ2hZqWbfv1VKLHMUWuiXM7VJk70g3g7BF8i8RWbrCDOxgTR77jrEwidpr1PYJzWJVGq_HP36MxInGFLcVh2sN0fu8MppzsXUENZQ=
éªŒè¯ç»“æœï¼šæ•°å­—ç­¾ååŒ¹é…<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-298"><a class="markdownIt-Anchor" href="#-298">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-crypto.html#%E5%85%AD%E3%80%81%E6%9C%AF%E8%AF%AD">#</a>å…­ã€æœ¯è¯­</h2>
<ul>
<li><strong>æ˜æ–‡ (Plaintext)</strong>ï¼šæŒ‡å¾…åŠ å¯†ä¿¡æ¯ã€‚æ˜æ–‡å¯ä»¥æ˜¯æ–‡æœ¬æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶ã€äºŒè¿›åˆ¶æ•°æ®ç­‰ã€‚</li>
<li><strong>å¯†æ–‡ (Ciphertext)</strong>ï¼šæŒ‡ç»è¿‡åŠ å¯†åçš„æ˜æ–‡ã€‚å¯†æ–‡é€šå¸¸ä»¥æ–‡æœ¬ã€äºŒè¿›åˆ¶ç­‰å½¢å¼å­˜åœ¨ã€‚</li>
<li><strong>åŠ å¯† (Encryption)</strong>ï¼šæŒ‡å°†æ˜æ–‡è½¬æ¢ä¸ºå¯†æ–‡çš„è¿‡ç¨‹ã€‚</li>
<li><strong>è§£å¯† (Decryption)</strong>ï¼šæŒ‡å°†å¯†æ–‡è½¬æ¢ä¸ºæ˜æ–‡çš„è¿‡ç¨‹ã€‚</li>
<li><strong>åŠ å¯†å¯†é’¥ (Encryption Key)</strong>ï¼šæŒ‡é€šè¿‡åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†æ“ä½œç”¨çš„å¯†é’¥ã€‚</li>
<li><strong>è§£å¯†å¯†é’¥ (Decryption Key)</strong>ï¼šæŒ‡é€šè¿‡è§£å¯†ç®—æ³•è¿›è¡Œè§£å¯†æ“ä½œç”¨çš„å¯†é’¥ã€‚</li>
<li><strong>ä¿¡é“ (Channel)</strong>ï¼šé€šä¿¡çš„é€šé“ï¼Œæ˜¯ä¿¡å·ä¼ è¾“çš„åª’ä»‹ã€‚</li>
</ul>
<hr>
<h1 id="java-æœ¬åœ°åŒ–"><a class="markdownIt-Anchor" href="#java-æœ¬åœ°åŒ–">#</a> Java æœ¬åœ°åŒ–</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<h2 id="-299"><a class="markdownIt-Anchor" href="#-299">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86">#</a>èƒŒæ™¯çŸ¥è¯†</h2>
<p>é€šè®¯çš„å‘è¾¾ï¼Œä½¿å¾—ä¸–ç•Œå„åœ°äº¤æµè¶Šæ¥è¶Šç´§å¯†ã€‚è®¸å¤šçš„è½¯ä»¶äº§å“ä¹Ÿè¦é¢å‘ä¸–ç•Œä¸Šä¸åŒå›½å®¶çš„ç”¨æˆ·ã€‚å…¶ä¸­ï¼Œè¯­è¨€éšœç¢æ˜¾ç„¶æ˜¯äº§å“åœ¨ä¸åŒè¯­ç§ç”¨æˆ·ä¸­è¿›è¡Œæ¨å¹¿çš„ä¸€ä¸ªé‡è¦é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡å›´ç»•æœ¬åœ°åŒ–è¿™ä¸€ä¸»é¢˜ï¼Œå…ˆä»‹ç»å›½é™…æ ‡å‡†çš„è¯­è¨€ç¼–ç ï¼Œç„¶åè®²è§£åœ¨ Java åº”ç”¨ä¸­å¦‚ä½•å»å®ç°æœ¬åœ°åŒ–ã€‚</p>
<h3 id="-300"><a class="markdownIt-Anchor" href="#-300">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A0%81%E3%80%81%E5%9B%BD%E5%AE%B6-%E5%9C%B0%E5%8C%BA%E7%BC%96%E7%A0%81">#</a>è¯­è¨€ç¼–ç ã€å›½å®¶ / åœ°åŒºç¼–ç </h3>
<p>åš web å¼€å‘çš„æœ‹å‹å¯èƒ½å¤šå¤šå°‘å°‘æ¥è§¦è¿‡ç±»ä¼¼ <strong>zh-cn</strong>, <strong>en-us</strong> è¿™æ ·çš„ç¼–ç å­—æ ·ã€‚</p>
<p>è¿™äº›ç¼–ç æ˜¯ç”¨æ¥è¡¨ç¤ºæŒ‡å®šçš„å›½å®¶åœ°åŒºçš„è¯­è¨€ç±»å‹çš„ã€‚é‚£ä¹ˆï¼Œè¿™äº›å«æœ‰ç‰¹æ®Šå«ä¹‰çš„ç¼–ç æ˜¯å¦‚ä½•äº§ç”Ÿçš„å‘¢ï¼Ÿ</p>
<p><a target="_blank" rel="noopener" href="http://www.loc.gov/standards/iso639-2/php/English_list.php"><strong>ISO-639</strong> (opens new window)</a> æ ‡å‡†ä½¿ç”¨ç¼–ç å®šä¹‰äº†å›½é™…ä¸Šå¸¸è§çš„è¯­è¨€ï¼Œæ¯ä¸€ç§è¯­è¨€ç”±ä¸¤ä¸ªå°å†™å­—æ¯è¡¨ç¤ºã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.iso.org/obp/ui/#iso:std:iso:3166:-2:ed-3:v1:en,fr"><strong>ISO-3166</strong> (opens new window)</a> æ ‡å‡†ä½¿ç”¨ç¼–ç å®šä¹‰äº†å›½å®¶ / åœ°åŒºï¼Œæ¯ä¸ªå›½å®¶ / åœ°åŒºç”±ä¸¤ä¸ªå¤§å†™å­—æ¯è¡¨ç¤ºã€‚</p>
<p>ä¸‹è¡¨åˆ—ä¸¾äº†ä¸€äº›å¸¸è§å›½å®¶ã€åœ°åŒºçš„è¯­è¨€ç¼–ç ï¼š</p>
<table>
<thead>
<tr>
<th>å›½å®¶ / åœ°åŒº</th>
<th>è¯­è¨€ç¼–ç </th>
<th>å›½å®¶ / åœ°åŒº</th>
<th>è¯­è¨€ç¼–ç </th>
</tr>
</thead>
<tbody>
<tr>
<td>ç®€ä½“ä¸­æ–‡ (ä¸­å›½)</td>
<td>zh-cn</td>
<td>ç¹ä½“ä¸­æ–‡ (å°æ¹¾åœ°åŒº)</td>
<td>zh-tw</td>
</tr>
<tr>
<td>ç¹ä½“ä¸­æ–‡ (é¦™æ¸¯)</td>
<td>zh-hk</td>
<td>è‹±è¯­ (é¦™æ¸¯)</td>
<td>en-hk</td>
</tr>
<tr>
<td>è‹±è¯­ (ç¾å›½)</td>
<td>en-us</td>
<td>è‹±è¯­ (è‹±å›½)</td>
<td>en-gb</td>
</tr>
<tr>
<td>è‹±è¯­ (å…¨çƒ)</td>
<td>en-ww</td>
<td>è‹±è¯­ (åŠ æ‹¿å¤§)</td>
<td>en-ca</td>
</tr>
<tr>
<td>è‹±è¯­ (æ¾³å¤§åˆ©äºš)</td>
<td>en-au</td>
<td>è‹±è¯­ (çˆ±å°”å…°)</td>
<td>en-ie</td>
</tr>
<tr>
<td>è‹±è¯­ (èŠ¬å…°)</td>
<td>en-fi</td>
<td>èŠ¬å…°è¯­ (èŠ¬å…°)</td>
<td>fi-fi</td>
</tr>
<tr>
<td>è‹±è¯­ (ä¸¹éº¦)</td>
<td>en-dk</td>
<td>ä¸¹éº¦è¯­ (ä¸¹éº¦)</td>
<td>da-dk</td>
</tr>
<tr>
<td>è‹±è¯­ (ä»¥è‰²åˆ—)</td>
<td>en-il</td>
<td>å¸Œä¼¯æ¥è¯­ (ä»¥è‰²åˆ—)</td>
<td>he-il</td>
</tr>
<tr>
<td>è‹±è¯­ (å—é)</td>
<td>en-za</td>
<td>è‹±è¯­ (å°åº¦)</td>
<td>en-in</td>
</tr>
<tr>
<td>è‹±è¯­ (æŒªå¨)</td>
<td>en-no</td>
<td>è‹±è¯­ (æ–°åŠ å¡)</td>
<td>en-sg</td>
</tr>
<tr>
<td>è‹±è¯­ (æ–°è¥¿å…°)</td>
<td>en-nz</td>
<td>è‹±è¯­ (å°åº¦å°¼è¥¿äºš)</td>
<td>en-id</td>
</tr>
<tr>
<td>è‹±è¯­ (è²å¾‹å®¾)</td>
<td>en-ph</td>
<td>è‹±è¯­ (æ³°å›½)</td>
<td>en-th</td>
</tr>
<tr>
<td>è‹±è¯­ (é©¬æ¥è¥¿äºš)</td>
<td>en-my</td>
<td>è‹±è¯­ (é˜¿æ‹‰ä¼¯)</td>
<td>en-xa</td>
</tr>
<tr>
<td>éŸ©æ–‡ (éŸ©å›½)</td>
<td>ko-kr</td>
<td>æ—¥è¯­ (æ—¥æœ¬)</td>
<td>ja-jp</td>
</tr>
<tr>
<td>è·å…°è¯­ (è·å…°)</td>
<td>nl-nl</td>
<td>è·å…°è¯­ (æ¯”åˆ©æ—¶)</td>
<td>nl-be</td>
</tr>
<tr>
<td>è‘¡è„ç‰™è¯­ (è‘¡è„ç‰™)</td>
<td>pt-pt</td>
<td>è‘¡è„ç‰™è¯­ (å·´è¥¿)</td>
<td>pt-br</td>
</tr>
<tr>
<td>æ³•è¯­ (æ³•å›½)</td>
<td>fr-fr</td>
<td>æ³•è¯­ (å¢æ£®å ¡)</td>
<td>fr-lu</td>
</tr>
<tr>
<td>æ³•è¯­ (ç‘å£«)</td>
<td>fr-ch</td>
<td>æ³•è¯­ (æ¯”åˆ©æ—¶)</td>
<td>fr-be</td>
</tr>
<tr>
<td>æ³•è¯­ (åŠ æ‹¿å¤§)</td>
<td>fr-ca</td>
<td>è¥¿ç­ç‰™è¯­ (æ‹‰ä¸ç¾æ´²)</td>
<td>es-la</td>
</tr>
<tr>
<td>è¥¿ç­ç‰™è¯­ (è¥¿ç­ç‰™)</td>
<td>es-es</td>
<td>è¥¿ç­ç‰™è¯­ (é˜¿æ ¹å»·)</td>
<td>es-ar</td>
</tr>
<tr>
<td>è¥¿ç­ç‰™è¯­ (ç¾å›½)</td>
<td>es-us</td>
<td>è¥¿ç­ç‰™è¯­ (å¢¨è¥¿å“¥)</td>
<td>es-mx</td>
</tr>
<tr>
<td>è¥¿ç­ç‰™è¯­ (å“¥ä¼¦æ¯”äºš)</td>
<td>es-co</td>
<td>è¥¿ç­ç‰™è¯­ (æ³¢å¤šé»å„)</td>
<td>es-pr</td>
</tr>
<tr>
<td>å¾·è¯­ (å¾·å›½)</td>
<td>de-de</td>
<td>å¾·è¯­ (å¥¥åœ°åˆ©)</td>
<td>de-at</td>
</tr>
<tr>
<td>å¾·è¯­ (ç‘å£«)</td>
<td>de-ch</td>
<td>ä¿„è¯­ (ä¿„ç½—æ–¯)</td>
<td>ru-ru</td>
</tr>
<tr>
<td>æ„å¤§åˆ©è¯­ (æ„å¤§åˆ©)</td>
<td>it-it</td>
<td>å¸Œè…Šè¯­ (å¸Œè…Š)</td>
<td>el-gr</td>
</tr>
<tr>
<td>æŒªå¨è¯­ (æŒªå¨)</td>
<td>no-no</td>
<td>åŒˆç‰™åˆ©è¯­ (åŒˆç‰™åˆ©)</td>
<td>hu-hu</td>
</tr>
<tr>
<td>åœŸè€³å…¶è¯­ (åœŸè€³å…¶)</td>
<td>tr-tr</td>
<td>æ·å…‹è¯­ (æ·å…‹å…±å’Œå›½)</td>
<td>cs-cz</td>
</tr>
<tr>
<td>æ–¯æ´›æ–‡å°¼äºšè¯­</td>
<td>sl-sl</td>
<td>æ³¢å…°è¯­ (æ³¢å…°)</td>
<td>pl-pl</td>
</tr>
<tr>
<td>ç‘å…¸è¯­ (ç‘å…¸)</td>
<td>sv-se</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>æ³¨ï¼šç”±è¡¨ä¸­å¯ä»¥çœ‹å‡ºè¯­è¨€ã€å›½å®¶ / åœ°åŒºç¼–ç ä¸€èˆ¬éƒ½æ˜¯è‹±æ–‡å•è¯çš„ç¼©å†™ã€‚</strong></p>
<h3 id="-301"><a class="markdownIt-Anchor" href="#-301">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81">#</a>å­—ç¬¦ç¼–ç </h3>
<p>åœ¨æ­¤å¤„ï¼Œå¼•ç”³ä¸€ä¸‹å­—ç¬¦ç¼–ç çš„æ¦‚å¿µã€‚</p>
<p><strong>æ˜¯ä¸æ˜¯æœ‰äº†è¯­è¨€ã€å›½å®¶ / åœ°åŒºç¼–ç ï¼Œè®¡ç®—æœºå°±å¯ä»¥è¯†åˆ«å„ç§è¯­è¨€äº†ï¼Ÿ</strong></p>
<p>ç­”æ¡ˆæ˜¯å¦ã€‚ä½œä¸ºç¨‹åºå‘˜ï¼Œç›¸ä¿¡æ¯ä¸ªäººéƒ½ä¼šé‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼šæœŸæœ›æ‰“å°ä¸­æ–‡ï¼Œç»“æœè¾“å‡ºçš„å´æ˜¯ä¹±ç ã€‚</p>
<p>è¿™ç§æƒ…å†µï¼Œå¾€å¾€æ˜¯å› ä¸ºå­—ç¬¦ç¼–ç çš„é—®é¢˜ã€‚</p>
<p>è®¡ç®—æœºåœ¨è®¾è®¡ä¹‹åˆï¼Œå¹¶æ²¡æœ‰è€ƒè™‘å¤šä¸ªå›½å®¶ï¼Œå¤šç§ä¸åŒè¯­è¨€çš„åº”ç”¨åœºæ™¯ã€‚å½“æ—¶å®šä¹‰ä¸€ç§ <code>ASCII</code>  ç ï¼Œå°†å­—æ¯ã€æ•°å­—å’Œå…¶ä»–ç¬¦å·ç¼–å·ç”¨ 7 æ¯”ç‰¹çš„äºŒè¿›åˆ¶æ•°æ¥è¡¨ç¤ºã€‚åæ¥ï¼Œè®¡ç®—æœºåœ¨ä¸–ç•Œå¼€å§‹æ™®åŠï¼Œä¸ºäº†é€‚åº”å¤šç§æ–‡å­—ï¼Œå‡ºç°äº†å¤šç§ç¼–ç æ ¼å¼ï¼Œä¾‹å¦‚ä¸­æ–‡æ±‰å­—ä¸€èˆ¬ä½¿ç”¨çš„ç¼–ç æ ¼å¼ä¸º <code>GB2312</code> ã€ <code>GBK</code> ã€‚</p>
<p>ç”±æ­¤ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>ä¸åŒå­—ç¬¦ç¼–ç ä¹‹é—´äº’ç›¸æ— æ³•è¯†åˆ«</strong>ã€‚äºæ˜¯ï¼Œä¸ºäº†ä¸€ç»Ÿæ±Ÿæ¹–ï¼Œå‡ºç°äº†  <code>unicode</code>  ç¼–ç ã€‚å®ƒä¸ºæ¯ç§è¯­è¨€çš„æ¯ä¸ªå­—ç¬¦è®¾å®šäº†ç»Ÿä¸€å¹¶ä¸”å”¯ä¸€çš„äºŒè¿›åˆ¶ç¼–ç ï¼Œä»¥æ»¡è¶³è·¨è¯­è¨€ã€è·¨å¹³å°çš„æ–‡æœ¬è½¬æ¢éœ€æ±‚ã€‚</p>
<p>æœ‰äººä¸ç¦è¦é—®ï¼Œæ—¢ç„¶  <code>Unicode</code>  å¯ä»¥æ”¯æŒæ‰€æœ‰è¯­è¨€çš„å­—ç¬¦ï¼Œé‚£è¿˜è¦å…¶ä»–å­—ç¬¦ç¼–ç åšä»€ä¹ˆï¼Ÿ</p>
<p><code>Unicode</code>  æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼šä¸ºäº†æ”¯æŒæ‰€æœ‰è¯­è¨€çš„å­—ç¬¦ï¼Œæ‰€ä»¥å®ƒéœ€è¦ç”¨æ›´å¤šä½æ•°å»è¡¨ç¤ºï¼Œæ¯”å¦‚  <code>ASCII</code>  è¡¨ç¤ºä¸€ä¸ªè‹±æ–‡å­—ç¬¦åªéœ€è¦ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œ  <code>Unicode</code>  åˆ™éœ€è¦ä¸¤ä¸ªå­—èŠ‚ã€‚å¾ˆæ˜æ˜¾ï¼Œå¦‚æœå­—ç¬¦æ•°å¤šï¼Œè¿™æ ·çš„æ•ˆç‡ä¼šå¾ˆä½ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰å‡ºç°äº†ä¸€äº›ä¸­é—´æ ¼å¼çš„å­—ç¬¦ç¼–ç ï¼šå¦‚  <code>UTF-8</code> ã€ <code>UTF-16</code> ã€ <code>UTF-32</code>  ç­‰ï¼ˆä¸­å›½çš„ç¨‹åºå‘˜ä¸€èˆ¬ä½¿ç”¨<strong> UTF-8</strong> ç¼–ç ï¼‰ã€‚</p>
<h2 id="-302"><a class="markdownIt-Anchor" href="#-302">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#java-%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%9C%AC%E5%9C%B0%E5%8C%96">#</a>Java ä¸­å®ç°æœ¬åœ°åŒ–</h2>
<p>æœ¬åœ°åŒ–çš„å®ç°åŸç†å¾ˆç®€å•ï¼š</p>
<ol>
<li>å…ˆå®šä¹‰å¥½ä¸åŒè¯­ç§çš„æ¨¡æ¿ï¼›</li>
<li>é€‰æ‹©è¯­ç§ï¼›</li>
<li>åŠ è½½æŒ‡å®šè¯­ç§çš„æ¨¡æ¿ã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œæœ¬æ–‡ä¼šæŒ‰ç…§æ­¥éª¤é€ä¸€è®²è§£å®ç°æœ¬åœ°åŒ–çš„å…·ä½“æ­¥éª¤</p>
<h3 id="-303"><a class="markdownIt-Anchor" href="#-303">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E5%AE%9A%E4%B9%89%E4%B8%8D%E5%90%8C%E8%AF%AD%E7%A7%8D%E7%9A%84%E6%A8%A1%E6%9D%BF">#</a>å®šä¹‰ä¸åŒè¯­ç§çš„æ¨¡æ¿</h3>
<p><strong>Java ä¸­å°†å¤šè¯­è¨€æ–‡æœ¬å­˜å‚¨åœ¨æ ¼å¼ä¸º  <code>properties</code>  çš„èµ„æºæ–‡ä»¶ä¸­ã€‚</strong></p>
<p>å®ƒå¿…é¡»éµç…§ä»¥ä¸‹çš„å‘½åè§„èŒƒï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">&lt;èµ„æºå>_&lt;è¯­è¨€ä»£ç >_&lt;å›½å®¶/åœ°åŒºç¼–ç >.properties<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å…¶ä¸­ï¼Œè¯­è¨€ç¼–ç å’Œå›½å®¶ / åœ°åŒºç¼–ç éƒ½æ˜¯å¯é€‰çš„ã€‚</p>
<p>æ³¨ï¼š <code>&lt;èµ„æºå&gt;.properties</code>  å‘½åçš„æœ¬åœ°åŒ–èµ„æºæ–‡ä»¶æ˜¯<strong>é»˜è®¤çš„èµ„æºæ–‡ä»¶</strong>ï¼Œå³æŸä¸ªæœ¬åœ°åŒ–ç±»å‹åœ¨ç³»ç»Ÿä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æºæ–‡ä»¶ï¼Œå°±é‡‡ç”¨è¿™ä¸ªé»˜è®¤çš„èµ„æºæ–‡ä»¶ã€‚</p>
<h4 id="-304"><a class="markdownIt-Anchor" href="#-304">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E5%AE%9A%E4%B9%89-properties-%E6%96%87%E4%BB%B6">#</a>å®šä¹‰ properties æ–‡ä»¶</h4>
<p>åœ¨ <code>src/main/resources/locales</code>  è·¯å¾„ä¸‹å®šä¹‰åä¸º content çš„ä¸åŒè¯­ç§èµ„æºæ–‡ä»¶ï¼š</p>
<p><strong>content_en_US.properties</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">helloWorld = HelloWorld!
time = The current time is %s.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>content_zh_CN.properties</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">helloWorld = \u4e16\u754c\uff0c\u4f60\u597d\uff01
time = \u5f53\u524d\u65f6\u95f4\u662f\u0025\u0073\u3002<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼šå‡ ä¸ªèµ„æºæ–‡ä»¶ä¸­ï¼Œå®šä¹‰çš„ Key å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯ Value æ˜¯å¯¹åº”è¯­è¨€çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è™½ç„¶å±æ€§å€¼å„ä¸ç›¸åŒï¼Œä½†å±æ€§åå´æ˜¯ç›¸åŒçš„ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºå°±å¯ä»¥é€šè¿‡ Locale å¯¹è±¡å’Œå±æ€§åç²¾ç¡®è°ƒç”¨åˆ°æŸä¸ªå…·ä½“çš„å±æ€§å€¼äº†ã€‚</p>
<h4 id="-305"><a class="markdownIt-Anchor" href="#-305">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#unicode-%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7">#</a>Unicode è½¬æ¢å·¥å…·</h4>
<p>ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰çš„ä¸­æ–‡èµ„æºæ–‡ä»¶ä¸­çš„å±æ€§å€¼éƒ½æ˜¯ä»¥ \u å¼€å¤´çš„å››ä½ 16 è¿›åˆ¶æ•°ã€‚å…¶å®ï¼Œè¿™è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª Unicode ç¼–ç ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">helloWorld = \u4e16\u754c\uff0c\u4f60\u597d\uff01
time = \u5f53\u524d\u65f6\u95f4\u662f\u0025\u0073\u3002<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æœ¬æ–‡çš„å­—ç¬¦ç¼–ç ä¸­æåˆ°äº†ï¼Œä¸ºäº†è¾¾åˆ°è·¨ç¼–ç ä¹Ÿæ­£å¸¸æ˜¾ç¤ºçš„ç›®çš„ï¼Œæœ‰å¿…è¦å°†é  <code>ASCII</code>  å­—ç¬¦è½¬ä¸º  <code>Unicode</code>  ç¼–ç ã€‚ä¸Šé¢çš„ä¸­æ–‡èµ„æºæ–‡ä»¶å°±æ˜¯ä¸­æ–‡è½¬ä¸º  <code>Unicode</code>  çš„ç»“æœã€‚</p>
<p>æ€ä¹ˆå°†é  <code>ASCII</code>  å­—ç¬¦è½¬ä¸º  <code>Unicode</code>  ç¼–ç å‘¢ï¼Ÿ</p>
<p>JDK åœ¨ bin ç›®å½•ä¸‹ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè½¬æ¢å·¥å…·ï¼š<strong>native2ascii</strong>ã€‚</p>
<p>å®ƒå¯ä»¥å°†ä¸­æ–‡å­—ç¬¦çš„èµ„æºæ–‡ä»¶è½¬æ¢ä¸º  <code>Unicode</code>  ä»£ç æ ¼å¼çš„æ–‡ä»¶ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">native2ascii [-reverse] [-encoding ç¼–ç ] [è¾“å…¥æ–‡ä»¶ [è¾“å‡ºæ–‡ä»¶]]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‡è®¾<strong> content_zh_CN.properties</strong> åœ¨  <code>d:\</code>  ç›®å½•ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æ–°å»ºä¸€ä¸ªåä¸º <strong>content_zh_CN_new.properties</strong> çš„æ–‡ä»¶ï¼Œå…¶ä¸­çš„å†…å®¹å°±ä¸­æ–‡å­—ç¬¦è½¬ä¸º  <code>UTF-8</code>  ç¼–ç æ ¼å¼çš„ç»“æœã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">native2ascii -encoding utf-8 d:\content_zh_CN.properties d:\content_zh_CN_new.properties<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-306"><a class="markdownIt-Anchor" href="#-306">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E9%80%89%E6%8B%A9%E8%AF%AD%E7%A7%8D">#</a>é€‰æ‹©è¯­ç§</h3>
<p>å®šä¹‰äº†å¤šè¯­è¨€èµ„æºæ–‡ä»¶ï¼Œç¬¬äºŒæ­¥å°±æ˜¯æ ¹æ®æœ¬åœ°è¯­ç§é€‰æ‹©æ¨¡æ¿æ–‡ä»¶äº†ã€‚</p>
<h4 id="-307"><a class="markdownIt-Anchor" href="#-307">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#locale">#</a>Locale</h4>
<p>åœ¨ Java ä¸­ï¼Œä¸€ä¸ª  <code>java.util.Locale</code>  å¯¹è±¡è¡¨ç¤ºäº†ç‰¹å®šçš„åœ°ç†ã€æ”¿æ²»å’Œæ–‡åŒ–åœ°åŒºã€‚éœ€è¦ Locale æ¥æ‰§è¡Œå…¶ä»»åŠ¡çš„æ“ä½œç§°ä¸ºè¯­è¨€ç¯å¢ƒæ•æ„Ÿçš„æ“ä½œï¼Œå®ƒä½¿ç”¨ Locale ä¸ºç”¨æˆ·é‡èº«å®šåˆ¶æœ¬åœ°ä¿¡æ¯ã€‚</p>
<p>å®ƒæœ‰ä¸‰ä¸ªæ„é€ æ–¹æ³•</p>
<p><code>Locale(String language)</code>  ï¼šæ ¹æ®è¯­è¨€ç¼–ç åˆå§‹åŒ–  <code>Locale(String language, String country)</code>  ï¼šæ ¹æ®è¯­è¨€ç¼–ç ã€å›½å®¶ç¼–ç åˆå§‹åŒ–  <code>Locale(String language, String country, String variant)</code>  ï¼šæ ¹æ®è¯­è¨€ç¼–ç ã€å›½å®¶ç¼–ç ã€å˜ä½“åˆå§‹åŒ–</p>
<p>æ­¤å¤–ï¼ŒLocale å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„ Locale å¸¸é‡ï¼š <code>Locale.ENGLISH</code> ã€ <code>Locale.CHINESE</code>  ç­‰ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// åˆå§‹åŒ–ä¸€ä¸ªé€šç”¨è‹±è¯­çš„locale.</span>
<span class="token class-name">Locale</span> locale1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span><span class="token string">"en"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åˆå§‹åŒ–ä¸€ä¸ªåŠ æ‹¿å¤§è‹±è¯­çš„locale.</span>
<span class="token class-name">Locale</span> locale2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span><span class="token string">"en"</span><span class="token punctuation">,</span> <span class="token string">"CA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// åˆå§‹åŒ–ä¸€ä¸ªç¾å¼è‹±è¯­å˜ç§ç¡…è°·è‹±è¯­çš„locale</span>
<span class="token class-name">Locale</span> locale3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span><span class="token string">"en"</span><span class="token punctuation">,</span> <span class="token string">"US"</span><span class="token punctuation">,</span> <span class="token string">"SiliconValley"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ ¹æ®Localeå¸¸é‡åˆå§‹åŒ–ä¸€ä¸ªç®€ä½“ä¸­æ–‡</span>
<span class="token class-name">Locale</span> locale4 <span class="token operator">=</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-308"><a class="markdownIt-Anchor" href="#-308">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E5%8A%A0%E8%BD%BD%E6%8C%87%E5%AE%9A%E8%AF%AD%E7%A7%8D%E7%9A%84%E6%A8%A1%E6%9D%BF">#</a>åŠ è½½æŒ‡å®šè¯­ç§çš„æ¨¡æ¿</h3>
<h4 id="-309"><a class="markdownIt-Anchor" href="#-309">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#resourceboundle">#</a>ResourceBoundle</h4>
<p>Java ä¸ºæˆ‘ä»¬æä¾›äº†ç”¨äºåŠ è½½æœ¬åœ°åŒ–èµ„æºæ–‡ä»¶çš„å·¥å…·ç±»ï¼š <code>java.util.ResourceBoundle</code> ã€‚</p>
<p><code>ResourceBoundle</code>  æä¾›äº†å¤šä¸ªåä¸º  <code>getBundle</code>  çš„é™æ€é‡è½½æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„ä½œç”¨æ˜¯ç”¨æ¥æ ¹æ®èµ„æºåã€Locale é€‰æ‹©æŒ‡å®šè¯­ç§çš„èµ„æºæ–‡ä»¶ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼š  <code>getBundle</code>  æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸€èˆ¬éƒ½æ˜¯ <code>baseName</code>  ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºèµ„æºæ–‡ä»¶åã€‚</p>
<p><code>ResourceBoundle</code>  è¿˜æä¾›äº†åä¸º  <code>getString</code>  çš„æ–¹æ³•ï¼Œç”¨æ¥è·å–èµ„æºæ–‡ä»¶ä¸­ key å¯¹åº”çš„ valueã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ ¹æ®è¯­è¨€+åœ°åŒºç¼–ç åˆå§‹åŒ–</span>
    <span class="token class-name">ResourceBundle</span> rbUS <span class="token operator">=</span> <span class="token class-name">ResourceBundle</span><span class="token punctuation">.</span><span class="token function">getBundle</span><span class="token punctuation">(</span><span class="token string">"locales.content"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Locale</span><span class="token punctuation">(</span><span class="token string">"en"</span><span class="token punctuation">,</span> <span class="token string">"US"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æ ¹æ®Localeå¸¸é‡åˆå§‹åŒ–</span>
    <span class="token class-name">ResourceBundle</span> rbZhCN <span class="token operator">=</span> <span class="token class-name">ResourceBundle</span><span class="token punctuation">.</span><span class="token function">getBundle</span><span class="token punctuation">(</span><span class="token string">"locales.content"</span><span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–æœ¬åœ°ç³»ç»Ÿé»˜è®¤çš„Localeåˆå§‹åŒ–</span>
    <span class="token class-name">ResourceBundle</span> rbDefault <span class="token operator">=</span> <span class="token class-name">ResourceBundle</span><span class="token punctuation">.</span><span class="token function">getBundle</span><span class="token punctuation">(</span><span class="token string">"locales.content"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ResourceBundle rbDefault =ResourceBundle.getBundle("locales.content", Locale.getDefault()); // ä¸ä¸Šè¡Œä»£ç ç­‰ä»·</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"us-US:"</span> <span class="token operator">+</span> rbUS<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"helloWorld"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"us-US:"</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>rbUS<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"08:00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"zh-CNï¼š"</span> <span class="token operator">+</span> rbZhCN<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"helloWorld"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"zh-CNï¼š"</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>rbZhCN<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"08:00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"defaultï¼š"</span> <span class="token operator">+</span> rbDefault<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"helloWorld"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"defaultï¼š"</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>rbDefault<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"08:00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">us-US:HelloWorld!
us-US:The current time is 08:00.
zh-CNï¼šä¸–ç•Œï¼Œä½ å¥½ï¼
zh-CNï¼šå½“å‰æ—¶é—´æ˜¯08:00ã€‚
defaultï¼šä¸–ç•Œï¼Œä½ å¥½ï¼
defaultï¼šå½“å‰æ—¶é—´æ˜¯08:00ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨ï¼šåœ¨åŠ è½½èµ„æºæ—¶ï¼Œå¦‚æœæŒ‡å®šçš„æœ¬åœ°åŒ–èµ„æºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒä¼šå°è¯•æŒ‰ä¸‹é¢çš„é¡ºåºåŠ è½½å…¶ä»–çš„èµ„æºï¼šæœ¬åœ°ç³»ç»Ÿé»˜è®¤æœ¬åœ°åŒ–å¯¹è±¡å¯¹åº”çš„èµ„æº -&gt; é»˜è®¤çš„èµ„æºã€‚å¦‚æœæŒ‡å®šé”™è¯¯ï¼ŒJava ä¼šæç¤ºæ‰¾ä¸åˆ°èµ„æºæ–‡ä»¶ã€‚</p>
<h2 id="-310"><a class="markdownIt-Anchor" href="#-310">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#%E6%94%AF%E6%8C%81%E6%9C%AC%E5%9C%B0%E5%8C%96%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB">#</a>æ”¯æŒæœ¬åœ°åŒ–çš„å·¥å…·ç±»</h2>
<p>Java ä¸­ä¹Ÿæä¾›äº†å‡ ä¸ªæ”¯æŒæœ¬åœ°åŒ–çš„æ ¼å¼åŒ–å·¥å…·ç±»ã€‚ä¾‹å¦‚ï¼š <code>NumberFormat</code> ã€ <code>DateFormat</code> ã€ <code>MessageFormat</code></p>
<h3 id="-311"><a class="markdownIt-Anchor" href="#-311">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#numberformat">#</a>NumberFormat</h3>
<p><code>NumberFormat</code>  æ˜¯æ‰€æœ‰æ•°å­—æ ¼å¼ç±»çš„åŸºç±»ã€‚å®ƒæä¾›æ ¼å¼åŒ–å’Œè§£ææ•°å­—çš„æ¥å£ã€‚å®ƒä¹Ÿæä¾›äº†å†³å®šæ•°å­—æ‰€å±è¯­è¨€ç±»å‹çš„æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">double</span> num <span class="token operator">=</span> <span class="token number">123456.78</span><span class="token punctuation">;</span>
	<span class="token class-name">NumberFormat</span> format <span class="token operator">=</span> <span class="token class-name">NumberFormat</span><span class="token punctuation">.</span><span class="token function">getCurrencyInstance</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%f çš„æœ¬åœ°åŒ–ï¼ˆ%sï¼‰ç»“æœ: %s"</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">,</span> format<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-312"><a class="markdownIt-Anchor" href="#-312">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#dateformat">#</a>DateFormat</h3>
<p>DateFormat æ˜¯æ—¥æœŸã€æ—¶é—´æ ¼å¼åŒ–ç±»çš„æŠ½è±¡ç±»ã€‚å®ƒæ”¯æŒåŸºäºè¯­è¨€ä¹ æƒ¯çš„æ—¥æœŸã€æ—¶é—´æ ¼å¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">DateFormat</span> df <span class="token operator">=</span> <span class="token class-name">DateFormat</span><span class="token punctuation">.</span><span class="token function">getDateInstance</span><span class="token punctuation">(</span><span class="token class-name">DateFormat</span><span class="token punctuation">.</span>MEDIUM<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>ENGLISH<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">DateFormat</span> df2 <span class="token operator">=</span> <span class="token class-name">DateFormat</span><span class="token punctuation">.</span><span class="token function">getDateInstance</span><span class="token punctuation">(</span><span class="token class-name">DateFormat</span><span class="token punctuation">.</span>MEDIUM<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s çš„æœ¬åœ°åŒ–ï¼ˆ%sï¼‰ç»“æœ: %s\n"</span><span class="token punctuation">,</span> date<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">,</span> df<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s çš„æœ¬åœ°åŒ–ï¼ˆ%sï¼‰ç»“æœ: %s\n"</span><span class="token punctuation">,</span> date<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>SIMPLIFIED_CHINESE<span class="token punctuation">,</span> df2<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-313"><a class="markdownIt-Anchor" href="#-313">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/java-locale.html#messageformat">#</a>MessageFormat</h3>
<p>Messageformat æä¾›ä¸€ç§ä¸è¯­è¨€æ— å…³çš„æ‹¼æ¥æ¶ˆæ¯çš„æ–¹å¼ã€‚é€šè¿‡è¿™ç§æ‹¼æ¥æ–¹å¼ï¼Œå°†æœ€ç»ˆå‘ˆç°è¿”å›ç»™ä½¿ç”¨è€…ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> pattern1 <span class="token operator">=</span> <span class="token string">"&#123;0&#125;ï¼Œä½ å¥½ï¼ä½ äº  &#123;1&#125; æ¶ˆè´¹  &#123;2&#125; å…ƒã€‚"</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> pattern2 <span class="token operator">=</span> <span class="token string">"At &#123;1,time,short&#125; On &#123;1,date,long&#125;ï¼Œ&#123;0&#125; paid &#123;2,number, currency&#125;."</span><span class="token punctuation">;</span>
	<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> params <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">GregorianCalendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> msg1 <span class="token operator">=</span> <span class="token class-name">MessageFormat</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>pattern1<span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">MessageFormat</span> mf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageFormat</span><span class="token punctuation">(</span>pattern2<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span>US<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> msg2 <span class="token operator">=</span> mf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="jdk8-å…¥é—¨æŒ‡å—"><a class="markdownIt-Anchor" href="#jdk8-å…¥é—¨æŒ‡å—">#</a> JDK8 å…¥é—¨æŒ‡å—</h1>
<blockquote>
<p>JDK8 å‡çº§å¸¸è§é—®é¢˜ç« èŠ‚æ˜¯æˆ‘ä¸ªäººçš„ç»éªŒæ•´ç†ã€‚å…¶ä»–å†…å®¹åŸºæœ¬ç¿»è¯‘è‡ª <a target="_blank" rel="noopener" href="https://github.com/winterbe/java8-tutorial">java8-tutorial(opens new window)</a></p>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>å…³é”®è¯ï¼š <code>Stream</code> ã€ <code>lambda</code> ã€ <code>Optional</code> ã€ <code>@FunctionalInterface</code></p>
</blockquote>
<h2 id="-314"><a class="markdownIt-Anchor" href="#-314">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#default-methods-for-interfaces-%E6%8E%A5%E5%8F%A3%E7%9A%84%E9%BB%98%E8%AE%A4%E6%96%B9%E6%B3%95">#</a>Default Methods for Interfaces (æ¥å£çš„é»˜è®¤æ–¹æ³•)</h2>
<p>Java 8 ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ä½¿ç”¨  <code>default</code>  å…³é”®å­—å°†éæŠ½è±¡æ–¹æ³•å®ç°æ·»åŠ åˆ°æ¥å£ã€‚è¿™ä¸ªåŠŸèƒ½ä¹Ÿè¢«ç§°ä¸ºè™šæ‹Ÿæ‰©å±•æ–¹æ³•ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">Formula</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">double</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span> <span class="token keyword">double</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é™¤äº†æŠ½è±¡æ–¹æ³•  <code>calculate</code>  ï¼Œæ¥å£  <code>Formula</code>  è¿˜å®šä¹‰äº†é»˜è®¤æ–¹æ³•  <code>sqrt</code> ã€‚å…·ä½“ç±»åªéœ€è¦æ‰§è¡ŒæŠ½è±¡æ–¹æ³•è®¡ç®—ã€‚é»˜è®¤çš„æ–¹æ³•  <code>sqrt</code>  å¯ä»¥ç”¨äºå¼€ç®±å³ç”¨ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Formula</span> formula <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Formula</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

formula<span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 100.0</span>
formula<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 4.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Formula</code>  è¢«å®ç°ä¸ºä¸€ä¸ªåŒ¿åå¯¹è±¡ã€‚ä»£ç éå¸¸å†—é•¿ï¼šç”¨äº  <code>sqrt(a * 100)</code>  è¿™æ ·ç®€å•çš„è®¡ç®—çš„ 6 è¡Œä»£ç ã€‚æ­£å¦‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹åˆ°çš„ï¼Œåœ¨ Java 8 ä¸­å®ç°å•ä¸ªæ–¹æ³•å¯¹è±¡æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚</p>
<h2 id="-315"><a class="markdownIt-Anchor" href="#-315">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#lambda-expressions-lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F">#</a>Lambda expressions (Lambda è¡¨è¾¾å¼)</h2>
<p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜å¦‚ä½•åœ¨ä»¥å‰ç‰ˆæœ¬çš„ Java ä¸­å¯¹å­—ç¬¦ä¸²åˆ—è¡¨è¿›è¡Œæ’åºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> names <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"peter"</span><span class="token punctuation">,</span> <span class="token string">"anna"</span><span class="token punctuation">,</span> <span class="token string">"mike"</span><span class="token punctuation">,</span> <span class="token string">"xenia"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é™æ€å·¥å…·æ–¹æ³•  <code>Collections.sort</code>  ä¸ºäº†å¯¹æŒ‡å®šçš„åˆ—è¡¨è¿›è¡Œæ’åºï¼Œæ¥å—ä¸€ä¸ªåˆ—è¡¨å’Œä¸€ä¸ªæ¯”è¾ƒå™¨ã€‚æ‚¨ä¼šå‘ç°è‡ªå·±ç»å¸¸éœ€è¦åˆ›å»ºåŒ¿åæ¯”è¾ƒå™¨å¹¶å°†å…¶ä¼ é€’ç»™æ’åºæ–¹æ³•ã€‚</p>
<p>Java 8 ä½¿ç”¨æ›´ç®€çŸ­çš„ <strong>lambda è¡¨è¾¾å¼</strong>æ¥é¿å…å¸¸å¸¸åˆ›å»ºåŒ¿åå¯¹è±¡çš„é—®é¢˜ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æ‚¨æ‰€è§ï¼Œè¿™æ®µä»£ç æ¯”ä¸Šæ®µä»£ç ç®€æ´å¾ˆå¤šã€‚ä½†æ˜¯ï¼Œè¿˜å¯ä»¥æ›´åŠ ç®€æ´ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™è¡Œä»£ç ä¸­ï¼Œä½ çœå»äº†èŠ±æ‹¬å·  <code>&#123;&#125;</code>  å’Œ return å…³é”®å­—ã€‚ä½†æ˜¯ï¼Œè¿™è¿˜ä¸ç®—å®Œï¼Œå®ƒè¿˜å¯ä»¥å†è¿›ä¸€æ­¥ç®€æ´ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">names<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆ—è¡¨ç°åœ¨æœ‰ä¸€ä¸ª  <code>sort</code>  æ–¹æ³•ã€‚æ­¤å¤–ï¼Œjava ç¼–è¯‘å™¨çŸ¥é“å‚æ•°ç±»å‹ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä¸æŒ‡å®šå…¥å‚çš„æ•°æ®ç±»å‹ã€‚è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨å¦‚ä½•ä½¿ç”¨ lambda è¡¨è¾¾å¼ã€‚</p>
<h2 id="-316"><a class="markdownIt-Anchor" href="#-316">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#functional-interfaces-%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3">#</a>Functional Interfaces (å‡½æ•°æ¥å£)</h2>
<p>lambda è¡¨è¾¾å¼å¦‚ä½•é€‚åº” Java çš„ç±»å‹ç³»ç»Ÿï¼Ÿæ¯ä¸ª lambda å¯¹åº”ä¸€ä¸ªç”±æ¥å£æŒ‡å®šçš„ç±»å‹ã€‚ä¸€ä¸ªæ‰€è°“çš„<em>å‡½æ•°æ¥å£</em>å¿…é¡»åŒ…å«ä¸€ä¸ª<strong>æŠ½è±¡æ–¹æ³•å£°æ˜</strong>ã€‚è¯¥ç±»å‹çš„æ¯ä¸ª lambda è¡¨è¾¾å¼éƒ½å°†ä¸æ­¤æŠ½è±¡æ–¹æ³•åŒ¹é…ã€‚ç”±äºé»˜è®¤æ–¹æ³•ä¸æ˜¯æŠ½è±¡çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥è‡ªç”±åœ°æ·»åŠ é»˜è®¤æ–¹æ³•åˆ°ä½ çš„å‡½æ•°æ¥å£ã€‚</p>
<p>åªè¦ä¿è¯æ¥å£ä»…åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå°±å¯ä»¥ä½¿ç”¨ä»»æ„çš„æ¥å£ä½œä¸º lambda è¡¨è¾¾å¼ã€‚ä¸ºç¡®ä¿æ‚¨çš„æ¥å£ç¬¦åˆè¦æ±‚ï¼Œæ‚¨åº”è¯¥æ·»åŠ   <code>@FunctionalInterface</code>  æ³¨è§£ã€‚ç¼–è¯‘å™¨æ³¨æ„åˆ°è¿™ä¸ªæ³¨è§£åï¼Œä¸€æ—¦æ‚¨å°è¯•åœ¨æ¥å£ä¸­æ·»åŠ ç¬¬äºŒä¸ªæŠ½è±¡æ–¹æ³•å£°æ˜ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ›å‡ºç¼–è¯‘å™¨é”™è¯¯ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">interface</span> <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">T</span> <span class="token function">convert</span><span class="token punctuation">(</span><span class="token class-name">F</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> converter <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> converted <span class="token operator">=</span> converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>converted<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯·è®°ä½ï¼Œå¦‚æœ  <code>@FunctionalInterface</code>  æ³¨è§£è¢«çœç•¥ï¼Œä»£ç ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p>
<h2 id="-317"><a class="markdownIt-Anchor" href="#-317">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#method-and-constructor-references-%E6%96%B9%E6%B3%95%E5%92%8C%E6%9E%84%E9%80%A0%E5%99%A8%E5%BC%95%E7%94%A8">#</a>Method and Constructor References (æ–¹æ³•å’Œæ„é€ å™¨å¼•ç”¨)</h2>
<p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç å¯ä»¥é€šè¿‡ä½¿ç”¨é™æ€æ–¹æ³•å¼•ç”¨è¿›ä¸€æ­¥ç®€åŒ–ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> converter <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> converted <span class="token operator">=</span> converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>converted<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>Java 8 å…è®¸æ‚¨é€šè¿‡  <code>::</code>  å…³é”®å­—ä¼ é€’æ–¹æ³•æˆ–æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å¼•ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼•ç”¨å¯¹è±¡æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Something</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> <span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token class-name">Something</span> something <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> converter <span class="token operator">=</span> something<span class="token operator">::</span><span class="token function">startsWith</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> converted <span class="token operator">=</span> converter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>converted<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// "J"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸‹  <code>::</code>  å…³é”®å­—æ˜¯å¦‚ä½•ä½œç”¨äºæ„é€ å™¨çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæœ‰å¤šä¸ªæ„é€ å™¨çš„ç¤ºä¾‹ç±»ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> firstName<span class="token punctuation">;</span>
    <span class="token class-name">String</span> lastName<span class="token punctuation">;</span>

    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">String</span> lastName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> lastName<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¥ç€ï¼Œæˆ‘ä»¬æŒ‡å®šä¸€ä¸ªç”¨äºåˆ›å»º Person å¯¹è±¡çš„ PersonFactory æ¥å£ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">interface</span> <span class="token class-name">PersonFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">P</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">P</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> firstName<span class="token punctuation">,</span> <span class="token class-name">String</span> lastName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬ä¸æ˜¯æ‰‹åŠ¨å®ç°å·¥å‚ï¼Œè€Œæ˜¯é€šè¿‡æ„é€ å¼•ç”¨å°†æ‰€æœ‰ä¸œè¥¿ç²˜åˆåœ¨ä¸€èµ·ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">PersonFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> personFactory <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span> person <span class="token operator">=</span> personFactory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"Peter"</span><span class="token punctuation">,</span> <span class="token string">"Parker"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æˆ‘ä»¬é€šè¿‡  <code>Person::new</code>  æ¥åˆ›å»ºä¸€ä¸ª Person æ„é€ å™¨çš„å¼•ç”¨ã€‚Java ç¼–è¯‘å™¨ä¼šæ ¹æ® <code>PersonFactory.create</code>  çš„ç­¾åè‡ªåŠ¨åŒ¹é…æ­£ç¡®çš„æ„é€ å™¨ã€‚</p>
<h2 id="-318"><a class="markdownIt-Anchor" href="#-318">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#lambda-scopes-lambda-%E4%BD%9C%E7%94%A8%E5%9F%9F">#</a>Lambda Scopes (Lambda ä½œç”¨åŸŸ)</h2>
<p>ä» lambda è¡¨è¾¾å¼è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸå˜é‡ä¸åŒ¿åå¯¹è±¡éå¸¸ç›¸ä¼¼ã€‚æ‚¨å¯ä»¥è®¿é—®æœ¬åœ°å¤–éƒ¨ä½œç”¨åŸŸçš„å¸¸é‡ä»¥åŠå®ä¾‹çš„æˆå‘˜å˜é‡å’Œé™æ€å˜é‡ã€‚</p>
<h3 id="-319"><a class="markdownIt-Anchor" href="#-319">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#accessing-local-variables-%E8%AE%BF%E9%97%AE%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F">#</a>Accessing local variables (è®¿é—®æœ¬åœ°å˜é‡)</h3>
<p>æˆ‘ä»¬å¯ä»¥è®¿é—® lambda è¡¨è¾¾å¼ä½œç”¨åŸŸå¤–éƒ¨çš„å¸¸é‡ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter <span class="token operator">=</span>
        <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

stringConverter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸åŒäºåŒ¿åå¯¹è±¡çš„æ˜¯ï¼šè¿™ä¸ªå˜é‡  <code>num</code>  ä¸æ˜¯ä¸€å®šè¦è¢«  <code>final</code>  ä¿®é¥°ã€‚ä¸‹é¢çš„ä»£ç ä¸€æ ·åˆæ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter <span class="token operator">=</span>
        <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>

stringConverter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä½†æ˜¯ï¼Œ <code>num</code>  å¿…é¡»æ˜¯éšå¼å¸¸é‡çš„ã€‚ä¸‹é¢çš„ä»£ç ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter <span class="token operator">=</span>
        <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
num <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ­¤å¤–ï¼Œåœ¨ lambda è¡¨è¾¾å¼ä¸­å¯¹  <code>num</code>  åšå†™æ“ä½œä¹Ÿæ˜¯è¢«ç¦æ­¢çš„ã€‚</p>
<h3 id="-320"><a class="markdownIt-Anchor" href="#-320">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#accessing-fields-and-static-variables-%E8%AE%BF%E9%97%AE%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%92%8C%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F">#</a>Accessing fields and static variables (è®¿é—®æˆå‘˜å˜é‡å’Œé™æ€å˜é‡)</h3>
<p>ä¸å±€éƒ¨å˜é‡ç›¸æ¯”ï¼Œæˆ‘ä»¬æ—¢å¯ä»¥åœ¨ lambda è¡¨è¾¾å¼ä¸­è¯»å†™å®ä¾‹çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå¯ä»¥è¯»å†™å®ä¾‹çš„é™æ€å˜é‡ã€‚è¿™ç§è¡Œä¸ºåœ¨åŒ¿åå¯¹è±¡ä¸­æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Lambda4</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> outerStaticNum<span class="token punctuation">;</span>
    <span class="token keyword">int</span> outerNum<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">testScopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter1 <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            outerNum <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token class-name">Converter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> stringConverter2 <span class="token operator">=</span> <span class="token punctuation">(</span>from<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            outerStaticNum <span class="token operator">=</span> <span class="token number">72</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>from<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-321"><a class="markdownIt-Anchor" href="#-321">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#accessing-default-interface-methods-%E8%AE%BF%E9%97%AE%E9%BB%98%E8%AE%A4%E7%9A%84%E6%8E%A5%E5%8F%A3%E6%96%B9%E6%B3%95">#</a>Accessing Default Interface Methodsï¼ˆè®¿é—®é»˜è®¤çš„æ¥å£æ–¹æ³•ï¼‰</h3>
<p>è¿˜è®°å¾—ç¬¬ä¸€èŠ‚çš„ formula ä¾‹å­å—ï¼Ÿ  <code>Formula</code>  æ¥å£å®šä¹‰äº†ä¸€ä¸ªé»˜è®¤æ–¹æ³•  <code>sqrt</code> ï¼Œå®ƒå¯ä»¥è¢«æ¯ä¸ª formula å®ä¾‹ï¼ˆåŒ…æ‹¬åŒ¿åå¯¹è±¡ï¼‰è®¿é—®ã€‚è¿™ä¸ªç‰¹æ€§ä¸é€‚ç”¨äº lambda è¡¨è¾¾å¼ã€‚</p>
<p>é»˜è®¤æ–¹æ³•<strong>ä¸èƒ½</strong>è¢« lambda è¡¨è¾¾å¼è®¿é—®ã€‚ä¸‹é¢çš„ä»£ç ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Formula</span> formula <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token function">sqrt</span><span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="-322"><a class="markdownIt-Anchor" href="#-322">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#built-in-functional-interfaces-%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3">#</a>Built-in Functional Interfaces (å†…ç½®å‡½æ•°æ¥å£)</h2>
<p>JDK 1.8 API åŒ…å«è®¸å¤šå†…ç½®çš„åŠŸèƒ½æ¥å£ã€‚å®ƒä»¬ä¸­çš„ä¸€äº›åœ¨è¾ƒæ—©çš„ Java ç‰ˆæœ¬ï¼ˆæ¯”å¦‚  <code>Comparator</code>  æˆ–  <code>Runnable</code> ï¼‰ä¸­æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ã€‚è¿™äº›ç°æœ‰çš„æ¥å£é€šè¿‡  <code>@FunctionalInterfaceannotation</code>  æ³¨è§£è¢«æ‰©å±•ä¸ºæ”¯æŒ Lambdaã€‚</p>
<p>ä½†æ˜¯ï¼ŒJava 8 API ä¹Ÿæä¾›äº†ä¸å°‘æ–°çš„å‡½æ•°æ¥å£ã€‚å…¶ä¸­ä¸€äº›æ–°æ¥å£åœ¨ <a target="_blank" rel="noopener" href="https://code.google.com/p/guava-libraries/">Google Guava (opens new window)</a> åº“ä¸­æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ã€‚å³ä½¿æ‚¨ç†Ÿæ‚‰è¿™ä¸ªåº“ï¼Œä¹Ÿåº”è¯¥å¯†åˆ‡å…³æ³¨å¦‚ä½•é€šè¿‡ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•æ‰©å±•æ¥æ‰©å±•è¿™äº›æ¥å£ã€‚</p>
<h3 id="-323"><a class="markdownIt-Anchor" href="#-323">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#predicates">#</a>Predicates</h3>
<p><code>Predicate</code>  æ˜¯åªæœ‰ä¸€ä¸ªå‚æ•°çš„å¸ƒå°”å€¼å‡½æ•°ã€‚è¯¥æ¥å£åŒ…å«å„ç§é»˜è®¤æ–¹æ³•ï¼Œç”¨äºå°†è°“è¯ç»„åˆæˆå¤æ‚çš„é€»è¾‘æœ¯è¯­ï¼ˆä¸ã€æˆ–ã€éï¼‰</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> predicate <span class="token operator">=</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>

predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// true</span>
predicate<span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// false</span>

<span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> nonNull <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token operator">::</span><span class="token function">nonNull</span><span class="token punctuation">;</span>
<span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">></span></span> isNull <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token operator">::</span><span class="token function">isNull</span><span class="token punctuation">;</span>

<span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> isEmpty <span class="token operator">=</span> <span class="token class-name">String</span><span class="token operator">::</span><span class="token function">isEmpty</span><span class="token punctuation">;</span>
<span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> isNotEmpty <span class="token operator">=</span> isEmpty<span class="token punctuation">.</span><span class="token function">negate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-324"><a class="markdownIt-Anchor" href="#-324">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#functions">#</a>Functions</h3>
<p><code>Function</code>  æ¥å—ä¸€ä¸ªå‚æ•°å¹¶äº§ç”Ÿä¸€ä¸ªç»“æœã€‚å¯ä»¥ä½¿ç”¨é»˜è®¤æ–¹æ³•å°†å¤šä¸ªå‡½æ•°é“¾æ¥åœ¨ä¸€èµ·ï¼ˆcomposeã€andThenï¼‰ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> toInteger <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">;</span>
<span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> backToString <span class="token operator">=</span> toInteger<span class="token punctuation">.</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">valueOf</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

backToString<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// "123"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-325"><a class="markdownIt-Anchor" href="#-325">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#suppliers">#</a>Suppliers</h3>
<p><code>Supplier</code>  äº§ç”Ÿä¸€ä¸ªæ³›å‹ç»“æœã€‚ä¸  <code>Function</code>  ä¸åŒï¼Œ <code>Supplier</code>  ä¸æ¥å—å‚æ•°ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> personSupplier <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">;</span>
personSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// new Person</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-326"><a class="markdownIt-Anchor" href="#-326">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#consumers">#</a>Consumers</h3>
<p>Consumer è¡¨ç¤ºè¦åœ¨ä¸€ä¸ªè¾“å…¥å‚æ•°ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> greeter <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello, "</span> <span class="token operator">+</span> p<span class="token punctuation">.</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>
greeter<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Luke"</span><span class="token punctuation">,</span> <span class="token string">"Skywalker"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-327"><a class="markdownIt-Anchor" href="#-327">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#comparators">#</a>Comparators</h3>
<p>æ¯”è¾ƒå™¨åœ¨è€ç‰ˆæœ¬çš„ Java ä¸­æ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ã€‚ Java 8 ä¸ºæ¥å£æ·»åŠ äº†å„ç§é»˜è®¤æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">></span></span> comparator <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span> <span class="token operator">-></span> p1<span class="token punctuation">.</span>firstName<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>firstName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Person</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> <span class="token string">"Doe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Person</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Wonderland"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

comparator<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// > 0</span>
comparator<span class="token punctuation">.</span><span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &lt; 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-328"><a class="markdownIt-Anchor" href="#-328">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#optionals">#</a>Optionals</h2>
<p><code>Optional</code>  ä¸æ˜¯åŠŸèƒ½æ€§æ¥å£ï¼Œè€Œæ˜¯é˜²æ­¢  <code>NullPointerException</code>  çš„å¥½å·¥å…·ã€‚è¿™æ˜¯ä¸‹ä¸€èŠ‚çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å¿«é€Ÿçœ‹çœ‹  <code>Optional</code>  æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p><code>Optional</code>  æ˜¯ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼Œå…¶å€¼å¯ä»¥æ˜¯ null æˆ–é nullã€‚æƒ³æƒ³ä¸€ä¸ªå¯èƒ½è¿”å›ä¸€ä¸ªéç©ºç»“æœçš„æ–¹æ³•ï¼Œä½†æœ‰æ—¶å€™ä»€ä¹ˆéƒ½ä¸è¿”å›ã€‚ä¸æ˜¯è¿”å› nullï¼Œè€Œæ˜¯è¿”å› Java 8 ä¸­çš„  <code>Optional</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"bam"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

optional<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// true</span>
optional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// "bam"</span>
optional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"fallback"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// "bam"</span>

optional<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// "b"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-329"><a class="markdownIt-Anchor" href="#-329">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#streams">#</a>Streams</h2>
<p><code>java.util.Stream</code>  è¡¨ç¤ºå¯ä»¥åœ¨å…¶ä¸Šæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œçš„å…ƒç´ åºåˆ—ã€‚æµæ“ä½œæ˜¯ä¸­é—´æˆ–ç»ˆç«¯ã€‚å½“ç»ˆç«¯æ“ä½œè¿”å›ä¸€ä¸ªç‰¹å®šç±»å‹çš„ç»“æœæ—¶ï¼Œä¸­é—´æ“ä½œè¿”å›æµæœ¬èº«ï¼Œæ‰€ä»¥ä½ å¯ä»¥é“¾æ¥å¤šä¸ªæ–¹æ³•è°ƒç”¨ã€‚æµåœ¨æºä¸Šåˆ›å»ºï¼Œä¾‹å¦‚ä¸€ä¸ª  <code>java.util.Collection</code>  åƒåˆ—è¡¨æˆ–é›†åˆï¼ˆä¸æ”¯æŒæ˜ å°„ï¼‰ã€‚æµæ“ä½œæ—¢å¯ä»¥æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚</p>
<blockquote>
<p>æµæ˜¯éå¸¸å¼ºå¤§çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç‹¬ç«‹çš„ <a target="_blank" rel="noopener" href="http://winterbe.com/posts/2014/07/31/java8-stream-tutorial-examples/">Java8 Streams æ•™ç¨‹ (opens new window)</a>ã€‚<strong>æ‚¨è¿˜åº”è¯¥æŸ¥çœ‹ Sequentï¼Œå°†å…¶ä½œä¸º Web çš„ç±»ä¼¼åº“ã€‚</strong></p>
</blockquote>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹é¡ºåºæµå¦‚ä½•å·¥ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»¥å­—ç¬¦ä¸²åˆ—è¡¨çš„å½¢å¼åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æºä»£ç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> stringCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ddd2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"aaa2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bbb1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"aaa1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bbb3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ccc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bbb2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stringCollection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"ddd1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Java 8 ä¸­çš„é›†åˆå·²è¢«æ‰©å±•ï¼Œå› æ­¤æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨  <code>Collection.stream()</code>  æˆ– <code>Collection.parallelStream()</code>  æ¥ç®€å•åœ°åˆ›å»ºæµã€‚ä»¥ä¸‹å„èŠ‚ä»‹ç»æœ€å¸¸è§çš„æµæ“ä½œã€‚</p>
<h3 id="-330"><a class="markdownIt-Anchor" href="#-330">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#filter">#</a>Filter</h3>
<p>è¿‡æ»¤å™¨æ¥å—ä¸€ä¸ªè°“è¯æ¥è¿‡æ»¤æµçš„æ‰€æœ‰å…ƒç´ ã€‚è¿™ä¸ªæ“ä½œæ˜¯ä¸­é—´çš„ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè°ƒç”¨å¦ä¸€ä¸ªæµæ“ä½œï¼ˆ <code>forEach</code> ï¼‰çš„ç»“æœã€‚ ForEach æ¥å—ä¸€ä¸ªæ¶ˆè´¹è€…è¢«æ‰§è¡Œçš„è¿‡æ»¤æµä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚ ForEach æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œã€‚å®ƒæ˜¯æ— æ•ˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è°ƒç”¨å¦ä¸€ä¸ªæµæ“ä½œã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">stringCollection
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// "aaa2", "aaa1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-331"><a class="markdownIt-Anchor" href="#-331">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#sorted">#</a>Sorted</h3>
<p>æ’åºæ˜¯ä¸€ä¸ªä¸­é—´æ“ä½œï¼Œè¿”å›æµçš„æ’åºè§†å›¾ã€‚å…ƒç´ æŒ‰è‡ªç„¶é¡ºåºæ’åºï¼Œé™¤éæ‚¨ä¼ é€’è‡ªå®šä¹‰æ¯”è¾ƒå™¨ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">stringCollection
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// "aaa1", "aaa2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯·è®°ä½ï¼Œæ’åºåªä¼šåˆ›å»ºæµçš„æ’åºè§†å›¾ï¼Œè€Œä¸ä¼šæ“çºµæ”¯æŒçš„é›†åˆçš„æ’åºã€‚  <code>stringCollection</code>  çš„æ’åºæ˜¯ä¸å˜çš„ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringCollection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ddd2, aaa2, bbb1, aaa1, bbb3, ccc, bbb2, ddd1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-332"><a class="markdownIt-Anchor" href="#-332">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#map">#</a>Map</h3>
<p>ä¸­é—´æ“ä½œæ˜ å°„é€šè¿‡ç»™å®šå‡½æ•°å°†æ¯ä¸ªå…ƒç´ è½¬æ¢ä¸ºå¦ä¸€ä¸ªå¯¹è±¡ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†æ¯ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™å­—æ¯å­—ç¬¦ä¸²ã€‚ä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨  <code>map</code>  å°†æ¯ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚ç»“æœæµçš„æ³›å‹ç±»å‹å–å†³äºæ‚¨ä¼ é€’ç»™  <code>map</code>  çš„å‡½æ•°çš„æ³›å‹ç±»å‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">stringCollection
    <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">toUpperCase</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-></span> b<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// "DDD2", "DDD1", "CCC", "BBB3", "BBB2", "AAA2", "AAA1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-333"><a class="markdownIt-Anchor" href="#-333">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#match">#</a>Match</h3>
<p>å¯ä»¥ä½¿ç”¨å„ç§åŒ¹é…æ“ä½œæ¥æ£€æŸ¥æŸä¸ªè°“è¯æ˜¯å¦ä¸æµåŒ¹é…ã€‚æ‰€æœ‰è¿™äº›æ“ä½œéƒ½æ˜¯ç»ˆç«¯å¹¶è¿”å›å¸ƒå°”ç»“æœã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">boolean</span> anyStartsWithA <span class="token operator">=</span>
    stringCollection
        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>anyStartsWithA<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// true</span>

<span class="token keyword">boolean</span> allStartsWithA <span class="token operator">=</span>
    stringCollection
        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">allMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>allStartsWithA<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// false</span>

<span class="token keyword">boolean</span> noneStartsWithZ <span class="token operator">=</span>
    stringCollection
        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">noneMatch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"z"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>noneStartsWithZ<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-334"><a class="markdownIt-Anchor" href="#-334">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#count">#</a>Count</h4>
<p>Count æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œè¿”å›æµä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> startsWithB <span class="token operator">=</span>
    stringCollection
        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">-></span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startsWithB<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-335"><a class="markdownIt-Anchor" href="#-335">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#reduce">#</a>Reduce</h3>
<p>è¯¥ç»ˆç«¯æ“ä½œä½¿ç”¨ç»™å®šçš„åŠŸèƒ½å¯¹æµçš„å…ƒç´ è¿›è¡Œç¼©å‡ã€‚ç»“æœæ˜¯ä¸€ä¸ª  <code>Optional</code>  æŒæœ‰ç¼©å°åçš„å€¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> reduced <span class="token operator">=</span>
    stringCollection
        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-></span> s1 <span class="token operator">+</span> <span class="token string">"#"</span> <span class="token operator">+</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

reduced<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// "aaa1##aaa2##bbb1##bbb2##bbb3##ccc##ddd1##ddd2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-336"><a class="markdownIt-Anchor" href="#-336">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#parallel-streams">#</a>Parallel Streams</h2>
<p>å¦‚ä¸Šæ‰€è¿°ï¼Œæµå¯ä»¥æ˜¯é¡ºåºçš„ä¹Ÿå¯ä»¥æ˜¯å¹¶è¡Œçš„ã€‚é¡ºåºæµä¸Šçš„æ“ä½œåœ¨å•ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè€Œå¹¶è¡Œæµä¸Šçš„æ“ä½œåœ¨å¤šä¸ªçº¿ç¨‹ä¸ŠåŒæ—¶æ‰§è¡Œã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†é€šè¿‡ä½¿ç”¨å¹¶è¡Œæµæé«˜æ€§èƒ½æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¾ƒå¤§çš„ç‹¬ç‰¹å…ƒç´ çš„åˆ—è¡¨ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">UUID</span> uuid <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    values<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç°åœ¨æˆ‘ä»¬æµ‹é‡å¯¹è¿™ä¸ªé›†åˆè¿›è¡Œæ’åºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p>
<h3 id="-337"><a class="markdownIt-Anchor" href="#-337">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#sequential-sort">#</a>Sequential Sort</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> t0 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> count <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> t1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> millis <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"sequential sort took: %d ms"</span><span class="token punctuation">,</span> millis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// sequential sort took: 899 ms</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-338"><a class="markdownIt-Anchor" href="#-338">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#parallel-sort">#</a>Parallel Sort</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> t0 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> count <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> t1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">long</span> millis <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>NANOSECONDS<span class="token punctuation">.</span><span class="token function">toMillis</span><span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"parallel sort took: %d ms"</span><span class="token punctuation">,</span> millis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// parallel sort took: 472 ms</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚ä½ æ‰€è§ï¼Œä¸¤ä¸ªä»£ç æ®µå·®ä¸å¤šï¼Œä½†æ˜¯å¹¶è¡Œæ’åºå¿«äº†è¿‘ 50%ã€‚ä½ æ‰€éœ€åšçš„ä»…ä»…æ˜¯å°†  <code>stream()</code>  æ”¹ä¸º  <code>parallelStream()</code>  ã€‚</p>
<h2 id="-339"><a class="markdownIt-Anchor" href="#-339">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#maps">#</a>Maps</h2>
<p>å¦‚å‰æ‰€è¿°ï¼Œmap ä¸ç›´æ¥æ”¯æŒæµã€‚Map æ¥å£æœ¬èº«æ²¡æœ‰å¯ç”¨çš„  <code>stream()</code>  æ–¹æ³•ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡  <code>map.keySet().stream()</code>  ã€  <code>map.values().stream()</code>  å’Œ  <code>map.entrySet().stream()</code>  åˆ›å»ºæŒ‡å®šçš„æµã€‚</p>
<p>æ­¤å¤–ï¼Œmap æ”¯æŒå„ç§æ–°çš„ã€æœ‰ç”¨çš„æ–¹æ³•æ¥å¤„ç†å¸¸è§ä»»åŠ¡ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    map<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">"val"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„ä»£ç åº”è¯¥æ˜¯è‡ªæˆ‘è§£é‡Šçš„ï¼š <code>putIfAbsent</code>  é˜»æ­¢æˆ‘ä»¬å†™å…¥é¢å¤–çš„ç©ºå€¼æ£€æŸ¥ï¼› <code>forEach</code>  æ¥å—æ¶ˆè´¹è€…ä¸º map çš„æ¯ä¸ªå€¼å®ç°æ“ä½œã€‚</p>
<p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨å‡½æ•°æ¥è®¡ç®— map ä¸Šçš„ä»£ç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">computeIfPresent</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">-></span> val <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val33</span>

map<span class="token punctuation">.</span><span class="token function">computeIfPresent</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// false</span>

map<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> num <span class="token operator">-></span> <span class="token string">"val"</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// true</span>

map<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> num <span class="token operator">-></span> <span class="token string">"bam"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val33</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å­¦ä¹ å¦‚ä½•åˆ é™¤ç»™å®šé”®çš„æ¡ç›®ï¼Œåªæœ‰å½“å‰é”®æ˜ å°„åˆ°ç»™å®šå€¼æ—¶ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"val3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val33</span>

map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"val33"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦ä¸€ä¸ªæœ‰ç”¨æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span> <span class="token string">"not found"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// not found</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åˆå¹¶ä¸€ä¸ª map çš„ entry å¾ˆç®€å•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">map<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">"val9"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span> <span class="token operator">-></span> value<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val9</span>

map<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">"concat"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>value<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span> <span class="token operator">-></span> value<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// val9concat</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœä¸å­˜åœ¨è¯¥é”®çš„æ¡ç›®ï¼Œåˆå¹¶æˆ–è€…å°†é”® / å€¼æ”¾å…¥ map ä¸­ï¼›å¦åˆ™å°†è°ƒç”¨åˆå¹¶å‡½æ•°æ¥æ›´æ”¹ç°æœ‰å€¼ã€‚</p>
<h2 id="-340"><a class="markdownIt-Anchor" href="#-340">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#date-api">#</a>Date API</h2>
<p>Java 8 åœ¨  <code>java.time</code>  åŒ…ä¸‹æ–°å¢äº†ä¸€ä¸ªå…¨æ–°çš„æ—¥æœŸå’Œæ—¶é—´ APIã€‚æ–°çš„æ—¥æœŸ API ä¸ <a target="_blank" rel="noopener" href="http://www.joda.org/joda-time/">Joda-Time (opens new window)</a> åº“ç›¸ä¼¼ï¼Œä½†ä¸ä¸€æ ·ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¶µç›–äº†æ­¤æ–° API çš„æœ€é‡è¦éƒ¨åˆ†ã€‚</p>
<h3 id="-341"><a class="markdownIt-Anchor" href="#-341">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#clock">#</a>Clock</h3>
<p><code>Clock</code>  æä¾›å¯¹å½“å‰æ—¥æœŸå’Œæ—¶é—´çš„è®¿é—®ã€‚ <code>Clock</code>  çŸ¥é“ä¸€ä¸ªæ—¶åŒºï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥ä»£æ›¿  <code>System.currentTimeMillis()</code>  ï¼Œè·å–ä» <strong>Unix EPOCH</strong> å¼€å§‹çš„ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´ã€‚æ—¶é—´çº¿ä¸Šçš„æŸä¸€æ—¶åˆ»ä¹Ÿç”±ç±»  <code>Instant</code>  è¡¨ç¤ºã€‚ Instants å¯ä»¥ç”¨æ¥åˆ›å»ºé—ç•™çš„  <code>java.util.Date</code>  å¯¹è±¡ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Clock</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">.</span><span class="token function">systemDefaultZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> millis <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Instant</span> instant <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">instant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Date</span> legacyDate <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// legacy java.util.Date</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-342"><a class="markdownIt-Anchor" href="#-342">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#timezones">#</a>Timezones</h3>
<p>æ—¶åŒºç”±  <code>ZoneId</code>  è¡¨ç¤ºã€‚ä»–ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡é™æ€å·¥å‚æ–¹æ³•è®¿é—®ã€‚æ—¶åŒºå®šä¹‰äº†æŸä¸€æ—¶åˆ»å’Œå½“åœ°æ—¥æœŸã€æ—¶é—´ä¹‹é—´è½¬æ¢çš„é‡è¦åç§»é‡ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">getAvailableZoneIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// prints all available timezone ids</span>

<span class="token class-name">ZoneId</span> zone1 <span class="token operator">=</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Europe/Berlin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ZoneId</span> zone2 <span class="token operator">=</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Brazil/East"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>zone1<span class="token punctuation">.</span><span class="token function">getRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>zone2<span class="token punctuation">.</span><span class="token function">getRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ZoneRules[currentStandardOffset=+01:00]</span>
<span class="token comment">// ZoneRules[currentStandardOffset=-03:00]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-343"><a class="markdownIt-Anchor" href="#-343">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#localtime">#</a>LocalTime</h3>
<p><code>LocalTime</code>  ä»£è¡¨æ²¡æœ‰æ—¶åŒºçš„æ—¶é—´ï¼Œä¾‹å¦‚æ™šä¸Š 10 ç‚¹æˆ– 17:30:15ã€‚ä»¥ä¸‹ç¤ºä¾‹ä¸ºä¸Šé¢å®šä¹‰çš„æ—¶åŒºåˆ›å»ºä¸¤ä¸ªæœ¬åœ°æ—¶é—´ã€‚ç„¶åæˆ‘ä»¬æ¯”è¾ƒä¸¤æ¬¡ï¼Œå¹¶è®¡ç®—ä¸¤æ¬¡ä¹‹é—´çš„å°æ—¶å’Œåˆ†é’Ÿçš„å·®å¼‚ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalTime</span> now1 <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>zone1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LocalTime</span> now2 <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>zone2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>now1<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>now2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>

<span class="token keyword">long</span> hoursBetween <span class="token operator">=</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>now1<span class="token punctuation">,</span> now2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> minutesBetween <span class="token operator">=</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>now1<span class="token punctuation">,</span> now2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hoursBetween<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// -3</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>minutesBetween<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// -239</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>LocalTime</code>  å¸¦æœ‰å„ç§å·¥å‚æ–¹æ³•ï¼Œä»¥ç®€åŒ–æ–°å®ä¾‹çš„åˆ›å»ºï¼ŒåŒ…æ‹¬è§£ææ—¶é—´å­—ç¬¦ä¸²ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalTime</span> late <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>late<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 23:59:59</span>

<span class="token class-name">DateTimeFormatter</span> germanFormatter <span class="token operator">=</span>
    <span class="token class-name">DateTimeFormatter</span>
        <span class="token punctuation">.</span><span class="token function">ofLocalizedTime</span><span class="token punctuation">(</span><span class="token class-name">FormatStyle</span><span class="token punctuation">.</span>SHORT<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withLocale</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>GERMAN<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">LocalTime</span> leetTime <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"13:37"</span><span class="token punctuation">,</span> germanFormatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>leetTime<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 13:37</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-344"><a class="markdownIt-Anchor" href="#-344">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#localdate">#</a>LocalDate</h3>
<p><code>LocalDate</code>  è¡¨ç¤ºä¸åŒçš„æ—¥æœŸï¼Œä¾‹å¦‚ï¼š2014 å¹´ 3 æœˆ 11 æ—¥ã€‚å®ƒæ˜¯ä¸å¯å˜çš„ï¼Œå¹¶ä¸”ä¸  <code>LocalTime</code>  å®Œå…¨ç±»ä¼¼ã€‚è¯¥ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•é€šè¿‡åŠ å‡æ—¥ã€æœˆæˆ–å¹´æ¥è®¡ç®—æ–°æ—¥æœŸã€‚è¯·è®°ä½ï¼Œæ¯ä¸ªæ“ä½œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LocalDate</span> tomorrow <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span>DAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">LocalDate</span> yesterday <span class="token operator">=</span> tomorrow<span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">LocalDate</span> independenceDay <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span>JULY<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">DayOfWeek</span> dayOfWeek <span class="token operator">=</span> independenceDay<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// FRIDAY</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­è§£æå‡º LocalDate å¯¹è±¡ï¼Œå’Œè§£æ LocalTime ä¸€æ ·çš„ç®€å•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DateTimeFormatter</span> germanFormatter <span class="token operator">=</span>
    <span class="token class-name">DateTimeFormatter</span>
        <span class="token punctuation">.</span><span class="token function">ofLocalizedDate</span><span class="token punctuation">(</span><span class="token class-name">FormatStyle</span><span class="token punctuation">.</span>MEDIUM<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withLocale</span><span class="token punctuation">(</span><span class="token class-name">Locale</span><span class="token punctuation">.</span>GERMAN<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">LocalDate</span> xmas <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"24.12.2014"</span><span class="token punctuation">,</span> germanFormatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>xmas<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 2014-12-24</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-345"><a class="markdownIt-Anchor" href="#-345">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#localdatetime">#</a>LocalDateTime</h3>
<p>LocalDateTime è¡¨ç¤ºæ—¥æœŸæ—¶é—´ã€‚å®ƒå°†æ—¥æœŸå’Œæ—¶é—´ç»„åˆæˆä¸€ä¸ªå®ä¾‹ã€‚  <code>LocalDateTime</code>  æ˜¯ä¸å¯å˜çš„ï¼Œå…¶ä½œç”¨ç±»ä¼¼äº  <code>LocalTime</code>  å’Œ  <code>LocalDate</code> ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ–¹æ³•å»è·å–æ—¥æœŸæ—¶é—´ä¸­æŸä¸ªå•ä½çš„å€¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDateTime</span> sylvester <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span>DECEMBER<span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">DayOfWeek</span> dayOfWeek <span class="token operator">=</span> sylvester<span class="token punctuation">.</span><span class="token function">getDayOfWeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dayOfWeek<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// WEDNESDAY</span>

<span class="token class-name">Month</span> month <span class="token operator">=</span> sylvester<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// DECEMBER</span>

<span class="token keyword">long</span> minuteOfDay <span class="token operator">=</span> sylvester<span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token class-name">ChronoField</span><span class="token punctuation">.</span>MINUTE_OF_DAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>minuteOfDay<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 1439</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šè¿‡ä¸€ä¸ªæ—¶åŒºçš„é™„åŠ ä¿¡æ¯å¯ä»¥è½¬ä¸ºä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹å¾ˆå®¹æ˜“è½¬ä¸º <code>java.util.Date</code>  ç±»å‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Instant</span> instant <span class="token operator">=</span> sylvester
        <span class="token punctuation">.</span><span class="token function">atZone</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">systemDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Date</span> legacyDate <span class="token operator">=</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>instant<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>legacyDate<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Wed Dec 31 23:59:59 CET 2014</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ—¥æœŸæ—¶é—´çš„æ ¼å¼åŒ–ç±»ä¼¼äº Date æˆ– Timeã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å¼åˆ›å»ºæ ¼å¼åŒ–ç¨‹åºï¼Œè€Œä¸æ˜¯ä½¿ç”¨é¢„å®šä¹‰çš„æ ¼å¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">DateTimeFormatter</span> formatter <span class="token operator">=</span>
    <span class="token class-name">DateTimeFormatter</span>
        <span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"MMM dd, yyyy - HH:mm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">LocalDateTime</span> parsed <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"Nov 03, 2014 - 07:13"</span><span class="token punctuation">,</span> formatter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> string <span class="token operator">=</span> formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>parsed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Nov 03, 2014 - 07:13</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸åŒäº  <code>java.text.NumberFormat</code>  ï¼Œ  <code>DateTimeFormatter</code>  æ˜¯ä¸å¯å˜ä¸”<strong>çº¿ç¨‹å®‰å…¨çš„</strong> ã€‚</p>
<p>æ›´å¤šå…³äºæ—¥æœŸæ ¼å¼åŒ–çš„å†…å®¹å¯ä»¥å‚è€ƒ<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html">è¿™é‡Œ (opens new window)</a>.</p>
<h2 id="-346"><a class="markdownIt-Anchor" href="#-346">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#annotations">#</a>Annotations</h2>
<p>Java 8 ä¸­çš„æ³¨é‡Šæ˜¯å¯é‡å¤çš„ã€‚è®©æˆ‘ä»¬ç›´æ¥çœ‹ä¸€ä¸ªä¾‹å­æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåŒ…å«å®é™…æ³¨é‡Šæ•°ç»„çš„å¤–å±‚æ³¨é‡Šï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@interface</span> <span class="token class-name">Hints</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Hint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">Hints</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@interface</span> <span class="token class-name">Hint</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Java8 å…è®¸æˆ‘ä»¬é€šè¿‡ä½¿ç”¨  <code>@Repeatable</code>  æ³¨è§£æ¥å¼•å…¥å¤šä¸ªåŒç±»å‹çš„æ³¨è§£ã€‚</p>
<h3 id="-347"><a class="markdownIt-Anchor" href="#-347">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#variant-1-%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8%E6%B3%A8%E8%A7%A3-%E8%80%81%E5%A5%97%E8%B7%AF">#</a>Variant 1: ä½¿ç”¨å®¹å™¨æ³¨è§£ (è€å¥—è·¯)</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Hints</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint2"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-348"><a class="markdownIt-Anchor" href="#-348">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#variant-2-%E4%BD%BF%E7%94%A8-repeatable-%E6%B3%A8%E8%A7%A3-%E6%96%B0%E5%A5%97%E8%B7%AF">#</a>Variant 2: ä½¿ç”¨ repeatable æ³¨è§£ (æ–°å¥—è·¯)</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint1"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Hint</span><span class="token punctuation">(</span><span class="token string">"hint2"</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä½¿ç”¨åœºæ™¯ 2ï¼ŒJava ç¼–è¯‘å™¨éšå¼åœ°è®¾ç½®äº†  <code>@Hints</code>  æ³¨è§£ã€‚</p>
<p>è¿™å¯¹äºé€šè¿‡åå°„æ¥è¯»å–æ³¨è§£ä¿¡æ¯å¾ˆé‡è¦ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Hint</span> hint <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Hint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// null</span>

<span class="token class-name">Hints</span> hints1 <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Hints</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hints1<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>

<span class="token class-name">Hint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hints2 <span class="token operator">=</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getAnnotationsByType</span><span class="token punctuation">(</span><span class="token class-name">Hint</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hints2<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å°½ç®¡ï¼Œæˆ‘ä»¬ä»æ²¡æœ‰åœ¨ Person ç±»ä¸Šå£°æ˜  <code>@Hints</code>  æ³¨è§£ï¼Œä½†æ˜¯ä»å¯ä»¥é€šè¿‡ <code>getAnnotation(Hints.class)</code>  è¯»å–å®ƒã€‚ç„¶è€Œï¼Œæ›´ä¾¿åˆ©çš„æ–¹å¼æ˜¯  <code>getAnnotationsByType</code>  ï¼Œå®ƒå¯ä»¥ç›´æ¥è®¿é—®æ‰€æœ‰  <code>@Hint</code>  æ³¨è§£ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava 8 ä¸­çš„æ³¨é‡Šä½¿ç”¨æ‰©å±•äº†ä¸¤ä¸ªæ–°çš„ç›®æ ‡ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE_PARAMETER<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE_USE<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAnnotation</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ°´å¹³çº¿ä»¥ä¸Šä¸º <a target="_blank" rel="noopener" href="https://github.com/winterbe/java8-tutorial">java8-tutorial (opens new window)</a> ç¿»è¯‘å†…å®¹ã€‚</p>
<hr>
<h2 id="-349"><a class="markdownIt-Anchor" href="#-349">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#jdk8-%E5%8D%87%E7%BA%A7%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">#</a>JDK8 å‡çº§å¸¸è§é—®é¢˜</h2>
<blockquote>
<p>JDK8 å‘å¸ƒå¾ˆä¹…äº†ï¼Œå®ƒæä¾›äº†è®¸å¤šå¸å¼•äººçš„æ–°ç‰¹æ€§ï¼Œèƒ½å¤Ÿæé«˜ç¼–ç¨‹æ•ˆç‡ã€‚</p>
<p>å¦‚æœæ˜¯æ–°çš„é¡¹ç›®ï¼Œä½¿ç”¨ JDK8 å½“ç„¶æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€äº›è€çš„é¡¹ç›®ï¼Œå‡çº§åˆ° JDK8 åˆ™å­˜åœ¨ä¸€äº›å…¼å®¹æ€§é—®é¢˜ï¼Œæ˜¯å¦å‡çº§éœ€è¦é…Œæƒ…è€ƒè™‘ã€‚</p>
<p>è¿‘æœŸï¼Œæˆ‘åœ¨å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªä»»åŠ¡ï¼Œå°†éƒ¨é—¨æ‰€æœ‰é¡¹ç›®çš„ JDK ç‰ˆæœ¬å‡çº§åˆ° 1.8 ï¼ˆè€ç‰ˆæœ¬å¤§å¤šæ˜¯ 1.6ï¼‰ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€äº›é—®é¢˜ç‚¹ï¼Œå¹¶ç»“åˆåœ¨ç½‘ä¸Šçœ‹åˆ°çš„å‘ï¼Œåœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚</p>
</blockquote>
<h3 id="-350"><a class="markdownIt-Anchor" href="#-350">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#intellij-%E4%B8%AD%E7%9A%84-jdk-%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE">#</a>Intellij ä¸­çš„ JDK ç¯å¢ƒè®¾ç½®</h3>
<h4 id="-351"><a class="markdownIt-Anchor" href="#-351">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#settings">#</a>Settings</h4>
<p>ç‚¹å‡» <strong>File &gt; Settings &gt; Java Compiler</strong></p>
<p>Project bytecode version é€‰æ‹© 1.8</p>
<p>ç‚¹å‡» <strong>File &gt; Settings &gt; Build Tools &gt; Maven &gt; Importing</strong></p>
<p>é€‰æ‹© JDK for importer ä¸º 1.8</p>
<h4 id="-352"><a class="markdownIt-Anchor" href="#-352">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#projcet-settings">#</a>Projcet Settings</h4>
<p><strong>Project SDK</strong> é€‰æ‹© 1.8</p>
<h4 id="-353"><a class="markdownIt-Anchor" href="#-353">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#application">#</a>Application</h4>
<p>å¦‚æœ web åº”ç”¨çš„å¯åŠ¨æ–¹å¼ä¸º Application ï¼Œéœ€è¦ä¿®æ”¹ JRE</p>
<p>ç‚¹å‡» <strong>Run/Debug Configurations &gt; Configuration</strong></p>
<p>é€‰æ‹© JRE ä¸º 1.8</p>
<h3 id="-354"><a class="markdownIt-Anchor" href="#-354">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#linux-%E7%8E%AF%E5%A2%83%E4%BF%AE%E6%94%B9">#</a>Linux ç¯å¢ƒä¿®æ”¹</h3>
<h4 id="-355"><a class="markdownIt-Anchor" href="#-355">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#%E4%BF%AE%E6%94%B9%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">#</a>ä¿®æ”¹ç¯å¢ƒå˜é‡</h4>
<p>ä¿®æ”¹  <code>/etc/profile</code>  ä¸­çš„ <strong>JAVA_HOME</strong>ï¼Œè®¾ç½® ä¸º jdk8 æ‰€åœ¨è·¯å¾„ã€‚</p>
<p>ä¿®æ”¹åï¼Œæ‰§è¡Œ  <code>source /etc/profile</code>  ç”Ÿæ•ˆã€‚</p>
<p>ç¼–è¯‘ã€å‘å¸ƒè„šæœ¬ä¸­å¦‚æœæœ‰  <code>export JAVA_HOME</code>  ï¼Œéœ€è¦æ³¨æ„ï¼Œéœ€è¦ä½¿ç”¨ jdk8 çš„è·¯å¾„ã€‚</p>
<h4 id="-356"><a class="markdownIt-Anchor" href="#-356">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#%E4%BF%AE%E6%94%B9-maven">#</a>ä¿®æ”¹ maven</h4>
<p>settings.xml ä¸­ profile çš„æ¿€æ´»æ¡ä»¶å¦‚æœæ˜¯ jdkï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ jdk ç‰ˆæœ¬</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdk</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdk</span><span class="token punctuation">></span></span> <span class="token comment">&lt;!-- ä¿®æ”¹ä¸º 1.8 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="-357"><a class="markdownIt-Anchor" href="#-357">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#%E4%BF%AE%E6%94%B9-server">#</a>ä¿®æ”¹ server</h4>
<p>ä¿®æ”¹ server ä¸­çš„ javac ç‰ˆæœ¬ï¼Œä»¥ resin ä¸ºä¾‹ï¼š</p>
<p>ä¿®æ”¹ resin é…ç½®æ–‡ä»¶ä¸­çš„ javac å‚æ•°ã€‚</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>javac</span> <span class="token attr-name">compiler</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>internal<span class="token punctuation">"</span></span> <span class="token attr-name">args</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-source 1.8<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-358"><a class="markdownIt-Anchor" href="#-358">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#sun-%E5%8C%85%E7%BC%BA%E5%A4%B1%E9%97%AE%E9%A2%98">#</a>sun.* åŒ…ç¼ºå¤±é—®é¢˜</h3>
<p>JDK8 ä¸å†æä¾›  <code>sun.*</code>  åŒ…ä¾›å¼€å‘è€…ä½¿ç”¨ï¼Œå› ä¸ºè¿™äº›æ¥å£ä¸æ˜¯å…¬å…±æ¥å£ï¼Œä¸èƒ½ä¿è¯åœ¨æ‰€æœ‰ Java å…¼å®¹çš„å¹³å°ä¸Šå·¥ä½œã€‚</p>
<p>ä½¿ç”¨äº†è¿™äº› API çš„ç¨‹åºå¦‚æœè¦å‡çº§åˆ° JDK 1.8 éœ€è¦å¯»æ±‚æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p>è™½ç„¶ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å¯¼å…¥åŒ…å«  <code>sun.*</code>  æ¥å£ jar åŒ…åˆ° classpath ç›®å½•ï¼Œä½†è¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚</p>
<p>éœ€è¦è¯¦ç»†äº†è§£ä¸ºä»€ä¹ˆä¸è¦ä½¿ç”¨  <code>sun.*</code>  ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/faq-sun-packages-142232.html">Why Developers Should Not Write Programs That Call â€˜sunâ€™ Packages(opens new window)</a></p>
<h3 id="-359"><a class="markdownIt-Anchor" href="#-359">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#%E9%BB%98%E8%AE%A4%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E4%BF%AE%E6%94%B9">#</a>é»˜è®¤å®‰å…¨ç­–ç•¥ä¿®æ”¹</h3>
<p>å‡çº§åä¼°è®¡æœ‰äº›å°ä¼™ä¼´åœ¨ä½¿ç”¨ä¸å®‰å…¨ç®—æ³•æ—¶å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ï¼Œsoï¼Œæ”¯æŒä¸å®‰å…¨ç®—æ³•è¿˜æ˜¯æœ‰å¿…è¦çš„</p>
<p>æ‰¾åˆ° $JAVA_HOME ä¸‹  <code>jre/lib/security/java.security</code>  ï¼Œå°†ç¦ç”¨çš„ç®—æ³•è®¾ç½®ä¸ºç©ºï¼š <code>jdk.certpath.disabledAlgorithms=</code>  ã€‚</p>
<h3 id="-360"><a class="markdownIt-Anchor" href="#-360">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#jvm-%E5%8F%82%E6%95%B0%E8%B0%83%E6%95%B4">#</a>JVM å‚æ•°è°ƒæ•´</h3>
<p>åœ¨ jdk8 ä¸­ï¼ŒPermSize ç›¸å…³çš„å‚æ•°å·²ç»ä¸è¢«ä½¿ç”¨ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-XX:MaxPermSize=size

Sets the maximum permanent generation space size (in bytes). This option was deprecated in JDK 8, and superseded by the -XX:MaxMetaspaceSize option.

-XX:PermSize=size

Sets the space (in bytes) allocated to the permanent generation that triggers a garbage collection if it is exceeded. This option was deprecated un JDK 8, and superseded by the -XX:MetaspaceSize option.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>JDK8 ä¸­å†ä¹Ÿæ²¡æœ‰  <code>PermGen</code>  äº†ã€‚å…¶ä¸­çš„æŸäº›éƒ¨åˆ†ï¼Œå¦‚è¢« intern çš„å­—ç¬¦ä¸²ï¼Œåœ¨ JDK7 ä¸­å·²ç»ç§»åˆ°äº†æ™®é€šå †é‡Œã€‚<strong>å…¶ä½™ç»“æ„åœ¨ JDK8 ä¸­ä¼šè¢«ç§»åˆ°ç§°ä½œ â€œMetaspaceâ€ çš„æœ¬æœºå†…å­˜åŒºä¸­ï¼Œè¯¥åŒºåŸŸåœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨ç”Ÿé•¿ï¼Œä¹Ÿä¼šè¢«åƒåœ¾å›æ”¶ã€‚å®ƒæœ‰ä¸¤ä¸ªæ ‡è®°ï¼šMetaspaceSize å’Œ MaxMetaspaceSizeã€‚</strong></p>
<p>-XX:MetaspaceSize=size</p>
<blockquote>
<p>Sets the size of the allocated class metadata space that will trigger a garbage collection the first time it is exceeded. This threshold for a garbage collection is increased or decreased depending on the amount of metadata used. The default size depends on the platform.</p>
</blockquote>
<p>-XX:MaxMetaspaceSize=size</p>
<blockquote>
<p>Sets the maximum amount of native memory that can be allocated for class metadata. By default, the size is not limited. The amount of metadata for an application depends on the application itself, other running applications, and the amount of memory available on the system.</p>
</blockquote>
<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•å°†ç±»ç±»å…ƒæ•°æ®çš„ä¸Šé™è®¾ç½®ä¸º 256 MBï¼š</p>
<p>XX:MaxMetaspaceSize=256m</p>
<h3 id="-361"><a class="markdownIt-Anchor" href="#-361">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#%E5%AD%97%E8%8A%82%E7%A0%81%E9%97%AE%E9%A2%98">#</a>å­—èŠ‚ç é—®é¢˜</h3>
<p>ASM 5.0 beta å¼€å§‹æ”¯æŒ JDK8</p>
<p><strong>å­—èŠ‚ç é”™è¯¯</strong></p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Caused by: java.io.IOException: invalid constant type: 15
	at javassist.bytecode.ConstPool.readOne(ConstPool.java:1113)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>æŸ¥æ‰¾ç»„ä»¶ç”¨åˆ°äº† mvelï¼Œmvel ä¸ºäº†æé«˜æ•ˆç‡è¿›è¡Œäº†å­—èŠ‚ç ä¼˜åŒ–ï¼Œæ­£å¥½ç¢°ä¸Š JDK8 æ­»ç©´ï¼Œæ‰€ä»¥éœ€è¦å‡çº§ã€‚</li>
</ul>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mvel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mvel2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.7.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>javassist</li>
</ul>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>javassist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.18.1-GA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>æ³¨æ„</strong></p>
<p>æœ‰äº›éƒ¨ç½²å·¥å…·ä¸ä¼šåˆ é™¤æ—§ç‰ˆæœ¬ jar åŒ…ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•æ‰‹åŠ¨åˆ é™¤è€ç‰ˆæœ¬ jar åŒ…ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://asm.ow2.org/history.html">http://asm.ow2.org/history.html</a></p>
<h3 id="-362"><a class="markdownIt-Anchor" href="#-362">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#java-%E8%BF%9E%E6%8E%A5-redis-%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99-error-redis-clients-jedis-hostandport-cant-resolve-localhost-address">#</a>Java è¿æ¥ redis å¯åŠ¨æŠ¥é”™ Error redis clients jedis HostAndPort cant resolve localhost address</h3>
<p>é”™è¯¯ç¯å¢ƒï¼šæœ¬åœ° window å¼€å‘ç¯å¢ƒæ²¡æœ‰é—®é¢˜ã€‚ä¸Šåˆ° Linux ç¯å¢ƒï¼Œå¯åŠ¨å‡ºç°é—®é¢˜ã€‚ é”™è¯¯ä¿¡æ¯: Error redis clients jedis HostAndPort cant resolve localhost address</p>
<p>è§£å†³åŠæ³•:</p>
<p>ï¼ˆ1ï¼‰æŸ¥çœ‹ Linux ç³»ç»Ÿçš„ä¸»æœºå</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text"># hostname
template<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ï¼ˆ2ï¼‰æŸ¥çœ‹ /etc/hosts æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ 127.0.0.1 å¯¹åº”ä¸»æœºåï¼Œå¦‚æœæ²¡æœ‰åˆ™æ·»åŠ </p>
<h3 id="-363"><a class="markdownIt-Anchor" href="#-363">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/advanced/jdk8.html#resin-%E5%AE%B9%E5%99%A8%E6%8C%87%E5%AE%9A-jdk-1-8">#</a>Resin å®¹å™¨æŒ‡å®š JDK 1.8</h3>
<p>å¦‚æœ resin å®¹å™¨åŸæ¥ç‰ˆæœ¬ä½äº JDK1.8ï¼Œè¿è¡Œ JDK 1.8 ç¼–è¯‘çš„ web app æ—¶ï¼Œå¯èƒ½ä¼šæç¤ºé”™è¯¯ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">java.lang.UnsupportedClassVersionError: PR/Sort : Unsupported major.minor version 52.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è§£å†³æ–¹æ³•å°±æ˜¯ï¼Œä½¿ç”¨ JDK 1.8 è¦é‡æ–°ç¼–è¯‘ä¸€ä¸‹ã€‚ç„¶åï¼Œæˆ‘åœ¨éƒ¨ç½²æ—¶å‡ºç°è¿‡ç¼–è¯‘åä»æŠ¥é”™çš„æƒ…å†µï¼Œé‡å¯ä¸€ä¸‹æœåŠ¡å™¨åï¼Œé—®é¢˜è§£å†³ï¼Œä¸çŸ¥æ˜¯ä»€ä¹ˆåŸå› ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">./configure --prefix=/usr/local/resin  --with-java=/usr/local/jdk1.8.0_121
make &amp; make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<hr>
<h1 id="java-å®¹å™¨ç®€ä»‹"><a class="markdownIt-Anchor" href="#java-å®¹å™¨ç®€ä»‹">#</a> Java å®¹å™¨ç®€ä»‹</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200221175550.png" alt="img"></p>
<ul>
<li>\1. å®¹å™¨ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#11-%E6%95%B0%E7%BB%84%E4%B8%8E%E5%AE%B9%E5%99%A8">1.1. æ•°ç»„ä¸å®¹å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#12-%E5%AE%B9%E5%99%A8%E6%A1%86%E6%9E%B6">1.2. å®¹å™¨æ¡†æ¶</a></li>
</ul>
</li>
<li>\2. å®¹å™¨çš„åŸºæœ¬æœºåˆ¶
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#21-%E6%B3%9B%E5%9E%8B">2.1. æ³›å‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#22-iterable-%E5%92%8C-iterator">2.2. Iterable å’Œ Iterator</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#23-comparable-%E5%92%8C-comparator">2.3. Comparable å’Œ Comparator</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#24-cloneable">2.4. Cloneable</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#25-fail-fast">2.5. fail-fast</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#3-%E5%AE%B9%E5%99%A8%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8">3. å®¹å™¨å’Œçº¿ç¨‹å®‰å…¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#4-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">4. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-364"><a class="markdownIt-Anchor" href="#-364">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_1-%E5%AE%B9%E5%99%A8%E7%AE%80%E4%BB%8B">#</a>1. å®¹å™¨ç®€ä»‹</h2>
<h3 id="-365"><a class="markdownIt-Anchor" href="#-365">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_1-1-%E6%95%B0%E7%BB%84%E4%B8%8E%E5%AE%B9%E5%99%A8">#</a>1.1. æ•°ç»„ä¸å®¹å™¨</h3>
<p>Java ä¸­å¸¸ç”¨çš„å­˜å‚¨å®¹å™¨å°±æ˜¯æ•°ç»„å’Œå®¹å™¨ï¼ŒäºŒè€…æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p>
<ul>
<li>å­˜å‚¨å¤§å°æ˜¯å¦å›ºå®š
<ul>
<li>æ•°ç»„çš„<strong>é•¿åº¦å›ºå®š</strong>ï¼›</li>
<li>å®¹å™¨çš„<strong>é•¿åº¦å¯å˜</strong>ã€‚</li>
</ul>
</li>
<li>æ•°æ®ç±»å‹
<ul>
<li><strong>æ•°ç»„å¯ä»¥å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹</strong>ï¼›</li>
<li><strong>å®¹å™¨åªèƒ½å­˜å‚¨å¼•ç”¨æ•°æ®ç±»å‹</strong>ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡è¦è½¬æ¢æˆå¯¹åº”çš„åŒ…è£…ç±»æ‰èƒ½æ”¾å…¥å®¹å™¨ç±»ä¸­ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ’¡ ä¸äº†è§£ä»€ä¹ˆæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹ã€åŒ…è£…ç±»è¿™äº›æ¦‚å¿µï¼Œå¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-data-type.md">Java åŸºæœ¬æ•°æ®ç±»å‹ (opens new window)</a></p>
</blockquote>
<h3 id="-366"><a class="markdownIt-Anchor" href="#-366">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_1-2-%E5%AE%B9%E5%99%A8%E6%A1%86%E6%9E%B6">#</a>1.2. å®¹å™¨æ¡†æ¶</h3>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/java-container-structure.png" alt="img"></p>
<p>Java å®¹å™¨æ¡†æ¶ä¸»è¦åˆ†ä¸º  <code>Collection</code>  å’Œ  <code>Map</code>  ä¸¤ç§ã€‚å…¶ä¸­ï¼Œ <code>Collection</code>  åˆåˆ†ä¸º  <code>List</code> ã€ <code>Set</code>  ä»¥åŠ  <code>Queue</code> ã€‚</p>
<ul>
<li>
<pre><code>  Collection
  <pre class="line-numbers language-none"><code class="language-none">
	 

	\- ä¸€ä¸ªç‹¬ç«‹å…ƒç´ çš„åºåˆ—ï¼Œè¿™äº›å…ƒç´ éƒ½æœä»ä¸€æ¡æˆ–è€…å¤šæ¡è§„åˆ™ã€‚

	- &#96;List&#96; - å¿…é¡»æŒ‰ç…§æ’å…¥çš„é¡ºåºä¿å­˜å…ƒç´ ã€‚
	- &#96;Set&#96; - ä¸èƒ½æœ‰é‡å¤çš„å…ƒç´ ã€‚
	- &#96;Queue&#96; - æŒ‰ç…§æ’é˜Ÿè§„åˆ™æ¥ç¡®å®šå¯¹è±¡äº§ç”Ÿçš„é¡ºåºï¼ˆé€šå¸¸ä¸å®ƒä»¬è¢«æ’å…¥çš„é¡ºåºç›¸åŒï¼‰ã€‚

- &#96;Map&#96; - ä¸€ç»„æˆå¯¹çš„â€œé”®å€¼å¯¹â€å¯¹è±¡ï¼Œå…è®¸ä½ ä½¿ç”¨é”®æ¥æŸ¥æ‰¾å€¼ã€‚

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;container&#x2F;java-container.html#_2-å®¹å™¨çš„åŸºæœ¬æœºåˆ¶)2. å®¹å™¨çš„åŸºæœ¬æœºåˆ¶

&gt; Java çš„å®¹å™¨å…·æœ‰ä¸€å®šçš„å…±æ€§ï¼Œå®ƒä»¬æˆ–å…¨éƒ¨æˆ–éƒ¨åˆ†ä¾èµ–ä»¥ä¸‹æŠ€æœ¯ã€‚æ‰€ä»¥ï¼Œå­¦ä¹ ä»¥ä¸‹æŠ€æœ¯ç‚¹ï¼Œå¯¹äºç†è§£ Java å®¹å™¨çš„ç‰¹æ€§å’ŒåŸç†æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;container&#x2F;java-container.html#_2-1-æ³›å‹)2.1. æ³›å‹

Java 1.5 å¼•å…¥äº†æ³›å‹æŠ€æœ¯ã€‚

Java **å®¹å™¨é€šè¿‡æ³›å‹æŠ€æœ¯æ¥ä¿è¯å…¶æ•°æ®çš„ç±»å‹å®‰å…¨**ã€‚ä»€ä¹ˆæ˜¯ç±»å‹å®‰å…¨å‘¢ï¼Ÿ

ä¸¾ä¾‹æ¥è¯´ï¼šå¦‚æœæœ‰ä¸€ä¸ª &#96;List&lt;Object&gt;&#96; å®¹å™¨ï¼ŒJava **ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¸ä¼šå¯¹åŸå§‹ç±»å‹è¿›è¡Œç±»å‹å®‰å…¨æ£€æŸ¥**ï¼Œå´ä¼šå¯¹å¸¦å‚æ•°çš„ç±»å‹è¿›è¡Œæ£€æŸ¥ï¼Œé€šè¿‡ä½¿ç”¨ Object ä½œä¸ºç±»å‹ï¼Œå¯ä»¥å‘ŠçŸ¥ç¼–è¯‘å™¨è¯¥æ–¹æ³•å¯ä»¥æ¥å—ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œæ¯”å¦‚ String æˆ– Integerã€‚

&#96;&#96;&#96;java
List&lt;Object&gt; list &#x3D; new ArrayList&lt;Object&gt;();
list.add(&quot;123&quot;);
list.add(123);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>å¦‚æœæ²¡æœ‰æ³›å‹æŠ€æœ¯ï¼Œå¦‚ç¤ºä¾‹ä¸­çš„ä»£ç é‚£æ ·ï¼Œå®¹å™¨ä¸­å°±å¯èƒ½å­˜å‚¨ä»»æ„æ•°æ®ç±»å‹ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„è¡Œä¸ºã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">List&lt;String> list = new ArrayList&lt;String>();
list.add("123");
list.add(123);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>ğŸ’¡ æƒ³æ·±å…¥äº†è§£ Java æ³›å‹æŠ€æœ¯çš„ç”¨æ³•å’ŒåŸç†å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-generic.md">æ·±å…¥ç†è§£ Java æ³›å‹ (opens new window)</a></p>
</blockquote>
<h3 id="-367"><a class="markdownIt-Anchor" href="#-367">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_2-2-iterable-%E5%92%8C-iterator">#</a>2.2. Iterable å’Œ Iterator</h3>
<blockquote>
<p>Iterable å’Œ Iterator ç›®çš„åœ¨äºéå†è®¿é—®å®¹å™¨ä¸­çš„å…ƒç´ ã€‚</p>
</blockquote>
<p><code>Iterator</code>  æ¥å£å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">E</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"remove"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">forEachRemaining</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            action<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Iterable</code>  æ¥å£å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> t <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            action<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">default</span> <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">spliterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Spliterators</span><span class="token punctuation">.</span><span class="token function">spliteratorUnknownSize</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Collection</code>  æ¥å£æ‰©å±•äº†  <code>Iterable</code>  æ¥å£ã€‚</p>
<p>è¿­ä»£å…¶å®æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºéå†ï¼Œæ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–éå†å„ç±»å®¹å™¨é‡Œé¢çš„æ‰€æœ‰å¯¹è±¡çš„æ¥å£ã€‚å®ƒæ˜¯ä¸€ä¸ªç»å…¸çš„è®¾è®¡æ¨¡å¼ â€”â€” è¿­ä»£å™¨æ¨¡å¼ï¼ˆIteratorï¼‰ã€‚</p>
<p><strong>è¿­ä»£å™¨æ¨¡å¼</strong> - <strong>æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆæ— é¡»æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤º</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/iterator-pattern.png" alt="img"></p>
<p>ç¤ºä¾‹ï¼šè¿­ä»£å™¨éå†</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IteratorDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span> it <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-368"><a class="markdownIt-Anchor" href="#-368">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_2-3-comparable-%E5%92%8C-comparator">#</a>2.3. Comparable å’Œ Comparator</h3>
<p><code>Comparable</code>  æ˜¯æ’åºæ¥å£ã€‚è‹¥ä¸€ä¸ªç±»å®ç°äº†  <code>Comparable</code>  æ¥å£ï¼Œè¡¨ç¤ºè¯¥ç±»çš„å®ä¾‹å¯ä»¥æ¯”è¾ƒï¼Œä¹Ÿå°±æ„å‘³ç€æ”¯æŒæ’åºã€‚å®ç°äº†  <code>Comparable</code>  æ¥å£çš„ç±»çš„å¯¹è±¡çš„åˆ—è¡¨æˆ–æ•°ç»„å¯ä»¥é€šè¿‡  <code>Collections.sort</code>  æˆ–  <code>Arrays.sort</code>  è¿›è¡Œè‡ªåŠ¨æ’åºã€‚</p>
<p><code>Comparable</code>  æ¥å£å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">T</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>Comparator</code>  æ˜¯æ¯”è¾ƒæ¥å£ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦æ§åˆ¶æŸä¸ªç±»çš„æ¬¡åºï¼Œè€Œè¯¥ç±»æœ¬èº«ä¸æ”¯æŒæ’åº (å³æ²¡æœ‰å®ç°  <code>Comparable</code>  æ¥å£)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å»ºç«‹ä¸€ä¸ª â€œè¯¥ç±»çš„æ¯”è¾ƒå™¨â€ æ¥è¿›è¡Œæ’åºï¼Œè¿™ä¸ª â€œæ¯”è¾ƒå™¨â€ åªéœ€è¦å®ç°  <code>Comparator</code>  æ¥å£å³å¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°  <code>Comparator</code>  æ¥æ–°å»ºä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œç„¶åé€šè¿‡è¿™ä¸ªæ¯”è¾ƒå™¨å¯¹ç±»è¿›è¡Œæ’åºã€‚</p>
<p><code>Comparator</code>  æ¥å£å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">T</span> o1<span class="token punctuation">,</span> <span class="token class-name">T</span> o2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åè½¬</span>
    <span class="token keyword">default</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">reversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">reverseOrder</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">default</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">thenComparing</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">></span></span> other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token operator">&amp;</span> <span class="token class-name">Serializable</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">compare</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>res <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> res <span class="token operator">:</span> other<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// thenComparingXXX æ–¹æ³•ç•¥</span>

    <span class="token comment">// é™æ€æ–¹æ³•ç•¥</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨ Java å®¹å™¨ä¸­ï¼Œä¸€äº›å¯ä»¥æ’åºçš„å®¹å™¨ï¼Œå¦‚  <code>TreeMap</code> ã€ <code>TreeSet</code> ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¼ å…¥  <code>Comparator</code> ï¼Œæ¥å®šä¹‰å†…éƒ¨å…ƒç´ çš„æ’åºè§„åˆ™ã€‚</p>
<h3 id="-369"><a class="markdownIt-Anchor" href="#-369">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_2-4-cloneable">#</a>2.4. Cloneable</h3>
<p>Java ä¸­ ä¸€ä¸ªç±»è¦å®ç°  <code>clone</code>  åŠŸèƒ½ å¿…é¡»å®ç°  <code>Cloneable</code>  æ¥å£ï¼Œå¦åˆ™åœ¨è°ƒç”¨  <code>clone()</code>  æ—¶ä¼šæŠ¥  <code>CloneNotSupportedException</code>  å¼‚å¸¸ã€‚</p>
<p>Java ä¸­æ‰€æœ‰ç±»éƒ½é»˜è®¤ç»§æ‰¿  <code>java.lang.Object</code>  ç±»ï¼Œåœ¨  <code>java.lang.Object</code>  ç±»ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•  <code>clone()</code> ï¼Œè¿™ä¸ªæ–¹æ³•å°†è¿”å›  <code>Object</code>  å¯¹è±¡çš„ä¸€ä¸ªæ‹·è´ã€‚ <code>Object</code>  ç±»é‡Œçš„  <code>clone()</code>  æ–¹æ³•ä»…ä»…ç”¨äºæµ…æ‹·è´ï¼ˆæ‹·è´åŸºæœ¬æˆå‘˜å±æ€§ï¼Œå¯¹äºå¼•ç”¨ç±»å‹ä»…è¿”å›æŒ‡å‘æ”¹åœ°å€çš„å¼•ç”¨ï¼‰ã€‚</p>
<p>å¦‚æœ Java ç±»éœ€è¦æ·±æ‹·è´ï¼Œéœ€è¦è¦†å†™  <code>clone()</code>  æ–¹æ³•ã€‚</p>
<h3 id="-370"><a class="markdownIt-Anchor" href="#-370">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_2-5-fail-fast">#</a>2.5. fail-fast</h3>
<h4 id="-371"><a class="markdownIt-Anchor" href="#-371">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#fail-fast-%E7%9A%84%E8%A6%81%E7%82%B9">#</a>fail-fast çš„è¦ç‚¹</h4>
<p>Java å®¹å™¨ï¼ˆå¦‚ï¼šArrayListã€HashMapã€TreeSet ç­‰å¾…ï¼‰çš„ javadoc ä¸­å¸¸å¸¸æåˆ°ç±»ä¼¼çš„æè¿°ï¼š</p>
<blockquote>
<p>æ³¨æ„ï¼Œè¿­ä»£å™¨çš„å¿«é€Ÿå¤±è´¥è¡Œä¸ºæ— æ³•å¾—åˆ°ä¿è¯ï¼Œå› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œä¸å¯èƒ½å¯¹æ˜¯å¦å‡ºç°ä¸åŒæ­¥å¹¶å‘ä¿®æ”¹åšå‡ºä»»ä½•ç¡¬æ€§ä¿è¯ã€‚å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰è¿­ä»£å™¨ä¼šå°½æœ€å¤§åŠªåŠ›æŠ›å‡º  <code>ConcurrentModificationException</code> ã€‚å› æ­¤ï¼Œä¸ºæé«˜è¿™ç±»è¿­ä»£å™¨çš„æ­£ç¡®æ€§è€Œç¼–å†™ä¸€ä¸ªä¾èµ–äºæ­¤å¼‚å¸¸çš„ç¨‹åºæ˜¯é”™è¯¯çš„åšæ³•ï¼šè¿­ä»£å™¨çš„å¿«é€Ÿå¤±è´¥è¡Œä¸ºåº”è¯¥ä»…ç”¨äºæ£€æµ‹ bugã€‚</p>
</blockquote>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ä¸ç¦è¦é—®ï¼Œä»€ä¹ˆæ˜¯ fail-fastï¼Œä¸ºä»€ä¹ˆè¦æœ‰ fail-fast æœºåˆ¶ï¼Ÿ</p>
<p><strong>fail-fast æ˜¯ Java å®¹å™¨çš„ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶</strong>ã€‚å½“å¤šä¸ªçº¿ç¨‹å¯¹å®¹å™¨è¿›è¡Œç»“æ„ä¸Šçš„æ”¹å˜çš„æ“ä½œæ—¶ï¼Œå°±å¯èƒ½è§¦å‘ fail-fast æœºåˆ¶ã€‚è®°ä½æ˜¯æœ‰å¯èƒ½ï¼Œè€Œä¸æ˜¯ä¸€å®šã€‚</p>
<p>ä¾‹å¦‚ï¼šå‡è®¾å­˜åœ¨ä¸¤ä¸ªçº¿ç¨‹ï¼ˆçº¿ç¨‹ 1ã€çº¿ç¨‹ 2ï¼‰ï¼Œçº¿ç¨‹ 1 é€šè¿‡  <code>Iterator</code>  åœ¨éå†å®¹å™¨ A ä¸­çš„å…ƒç´ ï¼Œåœ¨æŸä¸ªæ—¶å€™çº¿ç¨‹ 2 ä¿®æ”¹äº†å®¹å™¨ A çš„ç»“æ„ï¼ˆæ˜¯ç»“æ„ä¸Šé¢çš„ä¿®æ”¹ï¼Œè€Œä¸æ˜¯ç®€å•çš„ä¿®æ”¹å®¹å™¨å…ƒç´ çš„å†…å®¹ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ç¨‹åºå°±ä¼šæŠ›å‡º  <code>ConcurrentModificationException</code>  å¼‚å¸¸ï¼Œä»è€Œäº§ç”Ÿ fail-fast æœºåˆ¶ã€‚</p>
<p><strong>å®¹å™¨åœ¨è¿­ä»£æ“ä½œä¸­æ”¹å˜å…ƒç´ ä¸ªæ•°ï¼ˆæ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼‰éƒ½å¯èƒ½ä¼šå¯¼è‡´ fail-fast</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼šfail-fast ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FailFastDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> MAX <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThreadA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThreadB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/** è¿­ä»£éå†å®¹å™¨æ‰€æœ‰å…ƒç´  */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadA</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> iterator <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MyThreadA è®¿é—®å…ƒç´ :"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token comment">/** éå†åˆ é™¤æŒ‡å®šèŒƒå›´å†…çš„æ‰€æœ‰å¶æ•° */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadB</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> MAX<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MyThreadB åˆ é™¤å…ƒç´ "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œåï¼Œä¼šæŠ›å‡º  <code>java.util.ConcurrentModificationException</code>  å¼‚å¸¸ã€‚</p>
<h4 id="-372"><a class="markdownIt-Anchor" href="#-372">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#%E8%A7%A3%E5%86%B3-fail-fast">#</a>è§£å†³ fail-fast</h4>
<p>fail-fast æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>åœ¨éå†è¿‡ç¨‹ä¸­æ‰€æœ‰æ¶‰åŠåˆ°æ”¹å˜å®¹å™¨ä¸ªæ•°çš„åœ°æ–¹å…¨éƒ¨åŠ ä¸Š  <code>synchronized</code>  æˆ–è€…ç›´æ¥ä½¿ç”¨  <code>Collections.synchronizedXXX</code>  å®¹å™¨ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ã€‚ä½†æ˜¯ä¸æ¨èï¼Œå› ä¸ºå¢åˆ é€ æˆçš„åŒæ­¥é”å¯èƒ½ä¼šé˜»å¡éå†æ“ä½œï¼Œå½±å“ååã€‚</li>
<li>ä½¿ç”¨å¹¶å‘å®¹å™¨ï¼Œå¦‚ï¼š <code>CopyOnWriterArrayList</code> ã€‚</li>
</ul>
<h2 id="-373"><a class="markdownIt-Anchor" href="#-373">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container.html#_3-%E5%AE%B9%E5%99%A8%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8">#</a>3. å®¹å™¨å’Œçº¿ç¨‹å®‰å…¨</h2>
<p>ä¸ºäº†åœ¨å¹¶å‘ç¯å¢ƒä¸‹å®‰å…¨åœ°ä½¿ç”¨å®¹å™¨ï¼ŒJava æä¾›äº†åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨ã€‚</p>
<blockquote>
<p>åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨è¯¦æƒ…è¯·å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/5-%E5%90%8C%E6%AD%A5%E5%AE%B9%E5%99%A8%E5%92%8C%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8.md">åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨</a></p>
</blockquote>
<hr>
<h1 id="java-å®¹å™¨ä¹‹-list"><a class="markdownIt-Anchor" href="#java-å®¹å™¨ä¹‹-list">#</a> Java å®¹å™¨ä¹‹ List</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p><code>List</code>  æ˜¯  <code>Collection</code>  çš„å­æ¥å£ï¼Œå…¶ä¸­å¯ä»¥ä¿å­˜å„ä¸ªé‡å¤çš„å†…å®¹ã€‚</p>
</blockquote>
<ul>
<li>\1. List ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#11-arraylist-%E5%92%8C-linkedlist">1.1. ArrayList å’Œ LinkedList</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#12-vector-%E5%92%8C-stack">1.2. Vector å’Œ Stack</a></li>
</ul>
</li>
<li>\2. ArrayList
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#21-arraylist-%E8%A6%81%E7%82%B9">2.1. ArrayList è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#22-arraylist-%E5%8E%9F%E7%90%86">2.2. ArrayList åŸç†</a></li>
</ul>
</li>
<li>\3. LinkedList
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#31-linkedlist-%E8%A6%81%E7%82%B9">3.1. LinkedList è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#32-linkedlist-%E5%8E%9F%E7%90%86">3.2. LinkedList åŸç†</a></li>
</ul>
</li>
<li>\4. List å¸¸è§é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#41-arraysaslist-%E9%97%AE%E9%A2%98%E7%82%B9">4.1. Arrays.asList é—®é¢˜ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#42-listsublist-%E9%97%AE%E9%A2%98%E7%82%B9">4.2. List.subList é—®é¢˜ç‚¹</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-374"><a class="markdownIt-Anchor" href="#-374">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_1-list-%E7%AE%80%E4%BB%8B">#</a>1. List ç®€ä»‹</h2>
<p><code>List</code>  æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒç»§æ‰¿äº  <code>Collection</code>  çš„æ¥å£ã€‚å®ƒä»£è¡¨ç€æœ‰åºçš„é˜Ÿåˆ—ã€‚</p>
<p><code>AbstractList</code>  æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒç»§æ‰¿äº  <code>AbstractCollection</code> ã€‚ <code>AbstractList</code>  å®ç°äº†  <code>List</code>  æ¥å£ä¸­é™¤  <code>size()</code> ã€ <code>get(int location)</code>  ä¹‹å¤–çš„å‡½æ•°ã€‚</p>
<p><code>AbstractSequentialList</code>  æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒç»§æ‰¿äº  <code>AbstractList</code> ã€‚ <code>AbstractSequentialList</code>  å®ç°äº† â€œé“¾è¡¨ä¸­ï¼Œæ ¹æ® index ç´¢å¼•å€¼æ“ä½œé“¾è¡¨çš„å…¨éƒ¨å‡½æ•°â€ã€‚</p>
<h3 id="-375"><a class="markdownIt-Anchor" href="#-375">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_1-1-arraylist-%E5%92%8C-linkedlist">#</a>1.1. ArrayList å’Œ LinkedList</h3>
<p><code>ArrayList</code> ã€ <code>LinkedList</code>  æ˜¯  <code>List</code>  æœ€å¸¸ç”¨çš„å®ç°ã€‚</p>
<ul>
<li><code>ArrayList</code>  åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œå­˜åœ¨å®¹é‡é™åˆ¶ï¼Œå½“å…ƒç´ æ•°è¶…è¿‡æœ€å¤§å®¹é‡æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰©å®¹ï¼› <code>LinkedList</code>  åŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œä¸å­˜åœ¨å®¹é‡é™åˆ¶ã€‚</li>
<li><code>ArrayList</code>  éšæœºè®¿é—®é€Ÿåº¦è¾ƒå¿«ï¼Œéšæœºæ’å…¥ã€åˆ é™¤é€Ÿåº¦è¾ƒæ…¢ï¼› <code>LinkedList</code>  éšæœºæ’å…¥ã€åˆ é™¤é€Ÿåº¦è¾ƒå¿«ï¼Œéšæœºè®¿é—®é€Ÿåº¦è¾ƒæ…¢ã€‚</li>
<li><code>ArrayList</code>  å’Œ  <code>LinkedList</code>  éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<h3 id="-376"><a class="markdownIt-Anchor" href="#-376">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_1-2-vector-%E5%92%8C-stack">#</a>1.2. Vector å’Œ Stack</h3>
<p><code>Vector</code>  å’Œ  <code>Stack</code>  çš„è®¾è®¡ç›®æ ‡æ˜¯ä½œä¸ºçº¿ç¨‹å®‰å…¨çš„  <code>List</code>  å®ç°ï¼Œæ›¿ä»£  <code>ArrayList</code> ã€‚</p>
<ul>
<li><code>Vector</code>  -  <code>Vector</code>  å’Œ  <code>ArrayList</code>  ç±»ä¼¼ï¼Œä¹Ÿå®ç°äº†  <code>List</code>  æ¥å£ã€‚ä½†æ˜¯ï¼Œ  <code>Vector</code>  ä¸­çš„ä¸»è¦æ–¹æ³•éƒ½æ˜¯  <code>synchronized</code>  æ–¹æ³•ï¼Œå³é€šè¿‡äº’æ–¥åŒæ­¥æ–¹å¼ä¿è¯æ“ä½œçš„çº¿ç¨‹å®‰å…¨ã€‚</li>
<li><code>Stack</code>  -  <code>Stack</code>  ä¹Ÿæ˜¯ä¸€ä¸ªåŒæ­¥å®¹å™¨ï¼Œå®ƒçš„æ–¹æ³•ä¹Ÿç”¨  <code>synchronized</code>  è¿›è¡Œäº†åŒæ­¥ï¼Œå®ƒå®é™…ä¸Šæ˜¯ç»§æ‰¿äº  <code>Vector</code>  ç±»ã€‚</li>
</ul>
<h2 id="-377"><a class="markdownIt-Anchor" href="#-377">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_2-arraylist">#</a>2. ArrayList</h2>
<blockquote>
<p>ArrayList ä»æ•°æ®ç»“æ„è§’åº¦æ¥çœ‹ï¼Œå¯ä»¥è§†ä¸ºæ”¯æŒåŠ¨æ€æ‰©å®¹çš„çº¿æ€§è¡¨ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200221142803.png" alt="img"></p>
<h3 id="-378"><a class="markdownIt-Anchor" href="#-378">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_2-1-arraylist-%E8%A6%81%E7%82%B9">#</a>2.1. ArrayList è¦ç‚¹</h3>
<p><code>ArrayList</code>  æ˜¯ä¸€ä¸ªæ•°ç»„é˜Ÿåˆ—ï¼Œç›¸å½“äº<strong>åŠ¨æ€æ•°ç»„</strong>ã€‚<strong> <code>ArrayList</code>  é»˜è®¤åˆå§‹å®¹é‡å¤§å°ä¸º  <code>10</code>  ï¼Œæ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœå‘ç°å®¹é‡å·²æ»¡ï¼Œä¼šè‡ªåŠ¨æ‰©å®¹ä¸ºåŸå§‹å¤§å°çš„ 1.5 å€</strong>ã€‚å› æ­¤ï¼Œåº”è¯¥å°½é‡åœ¨åˆå§‹åŒ–  <code>ArrayList</code>  æ—¶ï¼Œä¸ºå…¶æŒ‡å®šåˆé€‚çš„åˆå§‹åŒ–å®¹é‡å¤§å°ï¼Œå‡å°‘æ‰©å®¹æ“ä½œäº§ç”Ÿçš„æ€§èƒ½å¼€é”€ã€‚</p>
<p><code>ArrayList</code>  å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ä» ArrayList çš„å®šä¹‰ï¼Œä¸éš¾çœ‹å‡º ArrayList çš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ï¼š</p>
<ul>
<li><code>ArrayList</code>  å®ç°äº†  <code>List</code>  æ¥å£ï¼Œå¹¶ç»§æ‰¿äº†  <code>AbstractList</code> ï¼Œå®ƒæ”¯æŒæ‰€æœ‰  <code>List</code>  çš„æ“ä½œã€‚</li>
<li><code>ArrayList</code>  å®ç°äº†  <code>RandomAccess</code>  æ¥å£ï¼Œ<strong>æ”¯æŒéšæœºè®¿é—®</strong>ã€‚ <code>RandomAccess</code>  æ˜¯ä¸€ä¸ªæ ‡å¿—æ¥å£ï¼Œå®ƒæ„å‘³ç€ â€œåªè¦å®ç°è¯¥æ¥å£çš„  <code>List</code>  ç±»ï¼Œéƒ½æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®â€ã€‚åœ¨  <code>ArrayList</code>  ä¸­ï¼Œæˆ‘ä»¬å³å¯ä»¥<strong>é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡</strong>ï¼›è¿™å°±æ˜¯å¿«é€Ÿéšæœºè®¿é—®ã€‚</li>
<li><code>ArrayList</code>  å®ç°äº†  <code>Cloneable</code>  æ¥å£ï¼Œé»˜è®¤ä¸º<strong>æµ…æ‹·è´</strong>ã€‚</li>
<li><code>ArrayList</code>  å®ç°äº†  <code>Serializable</code>  æ¥å£ï¼Œ<strong>æ”¯æŒåºåˆ—åŒ–</strong>ï¼Œèƒ½é€šè¿‡åºåˆ—åŒ–æ–¹å¼ä¼ è¾“ã€‚</li>
<li><code>ArrayList</code>  æ˜¯<strong>éçº¿ç¨‹å®‰å…¨</strong>çš„ã€‚</li>
</ul>
<h3 id="-379"><a class="markdownIt-Anchor" href="#-379">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_2-2-arraylist-%E5%8E%9F%E7%90%86">#</a>2.2. ArrayList åŸç†</h3>
<h4 id="-380"><a class="markdownIt-Anchor" href="#-380">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#arraylist-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">#</a>ArrayList çš„æ•°æ®ç»“æ„</h4>
<p>ArrayList åŒ…å«äº†ä¸¤ä¸ªé‡è¦çš„å…ƒç´ ï¼š <code>elementData</code>  å’Œ  <code>size</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// é»˜è®¤åˆå§‹åŒ–å®¹é‡</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_CAPACITY <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">// å¯¹è±¡æ•°ç»„</span>
<span class="token keyword">transient</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elementData<span class="token punctuation">;</span>
<span class="token comment">// æ•°ç»„é•¿åº¦</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>size</code>  - æ˜¯åŠ¨æ€æ•°ç»„çš„å®é™…å¤§å°ã€‚</li>
<li><code>elementData</code>  - æ˜¯ä¸€ä¸ª  <code>Object</code>  æ•°ç»„ï¼Œç”¨äºä¿å­˜æ·»åŠ åˆ°  <code>ArrayList</code>  ä¸­çš„å…ƒç´ ã€‚</li>
</ul>
<h4 id="-381"><a class="markdownIt-Anchor" href="#-381">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#arraylist-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96">#</a>ArrayList çš„åºåˆ—åŒ–</h4>
<p><code>ArrayList</code>  å…·æœ‰åŠ¨æ€æ‰©å®¹ç‰¹æ€§ï¼Œå› æ­¤ä¿å­˜å…ƒç´ çš„æ•°ç»„ä¸ä¸€å®šéƒ½ä¼šè¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦å…¨éƒ¨è¿›è¡Œåºåˆ—åŒ–ã€‚ä¸ºæ­¤ï¼Œ <code>ArrayList</code>  å®šåˆ¶äº†å…¶åºåˆ—åŒ–æ–¹å¼ã€‚å…·ä½“åšæ³•æ˜¯ï¼š</p>
<ul>
<li>å­˜å‚¨å…ƒç´ çš„  <code>Object</code>  æ•°ç»„ï¼ˆå³  <code>elementData</code> ï¼‰ä½¿ç”¨  <code>transient</code>  ä¿®é¥°ï¼Œä½¿å¾—å®ƒå¯ä»¥è¢« Java åºåˆ—åŒ–æ‰€å¿½ç•¥ã€‚</li>
<li><code>ArrayList</code>  é‡å†™äº†  <code>writeObject()</code>  å’Œ  <code>readObject()</code>  æ¥æ§åˆ¶åºåˆ—åŒ–æ•°ç»„ä¸­æœ‰å…ƒç´ å¡«å……é‚£éƒ¨åˆ†å†…å®¹ã€‚</li>
</ul>
<blockquote>
<p>ğŸ’¡ ä¸äº†è§£ Java åºåˆ—åŒ–æ–¹å¼ï¼Œå¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/io/java-serialization.md">Java åºåˆ—åŒ– (opens new window)</a></p>
</blockquote>
<h4 id="-382"><a class="markdownIt-Anchor" href="#-382">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#arraylist-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">#</a>ArrayList æ„é€ æ–¹æ³•</h4>
<p>ArrayList ç±»å®ç°äº†ä¸‰ä¸ªæ„é€ å‡½æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªæ˜¯é»˜è®¤æ„é€ æ–¹æ³•ï¼ŒArrayList ä¼šåˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ï¼›</li>
<li>ç¬¬äºŒä¸ªæ˜¯åˆ›å»º ArrayList å¯¹è±¡æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªåˆå§‹åŒ–å€¼ï¼›</li>
<li>ç¬¬ä¸‰ä¸ªæ˜¯ä¼ å…¥ä¸€ä¸ªé›†åˆç±»å‹è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
</ul>
<p>å½“ ArrayList æ–°å¢å…ƒç´ æ—¶ï¼Œå¦‚æœæ‰€å­˜å‚¨çš„å…ƒç´ å·²ç»è¶…è¿‡å…¶å½“å‰å®¹é‡ï¼Œå®ƒä¼šè®¡ç®—å®¹é‡åå†è¿›è¡ŒåŠ¨æ€æ‰©å®¹ã€‚æ•°ç»„çš„åŠ¨æ€æ‰©å®¹ä¼šå¯¼è‡´æ•´ä¸ªæ•°ç»„è¿›è¡Œä¸€æ¬¡å†…å­˜å¤åˆ¶ã€‚å› æ­¤ï¼Œ<strong>åˆå§‹åŒ– ArrayList æ—¶ï¼ŒæŒ‡å®šæ•°ç»„åˆå§‹å¤§å°ï¼Œæœ‰åŠ©äºå‡å°‘æ•°ç»„çš„æ‰©å®¹æ¬¡æ•°ï¼Œä»è€Œæé«˜ç³»ç»Ÿæ€§èƒ½</strong>ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æ ¹æ®åˆå§‹åŒ–å€¼åˆ›å»ºæ•°ç»„å¤§å°</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>initialCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// åˆå§‹åŒ–å€¼ä¸º 0 æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>elementData <span class="token operator">=</span> EMPTY_ELEMENTDATA<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal Capacity: "</span><span class="token operator">+</span>
										   initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-383"><a class="markdownIt-Anchor" href="#-383">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#arraylist-%E8%AE%BF%E9%97%AE%E5%85%83%E7%B4%A0">#</a>ArrayList è®¿é—®å…ƒç´ </h4>
<p><code>ArrayList</code>  è®¿é—®å…ƒç´ çš„å®ç°ä¸»è¦åŸºäºä»¥ä¸‹å…³é”®æ€§æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è·å–ç¬¬ index ä¸ªå…ƒç´ </span>
<span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">rangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">E</span> <span class="token function">elementData</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å®ç°éå¸¸ç®€å•ï¼Œå…¶å®å°±æ˜¯<strong>é€šè¿‡æ•°ç»„ä¸‹æ ‡è®¿é—®æ•°ç»„å…ƒç´ ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸º O (1)</strong>ï¼Œæ‰€ä»¥å¾ˆå¿«ã€‚</p>
<h4 id="-384"><a class="markdownIt-Anchor" href="#-384">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#arraylist-%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0">#</a>ArrayList æ·»åŠ å…ƒç´ </h4>
<p><code>ArrayList</code>  æ·»åŠ å…ƒç´ æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯æ·»åŠ å…ƒç´ åˆ°æ•°ç»„æœ«å°¾ï¼Œå¦å¤–ä¸€ç§æ˜¯æ·»åŠ å…ƒç´ åˆ°ä»»æ„ä½ç½®ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ·»åŠ å…ƒç´ åˆ°æ•°ç»„æœ«å°¾</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>
    elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// æ·»åŠ å…ƒç´ åˆ°ä»»æ„ä½ç½®</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">rangeCheckForAdd</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
					 size <span class="token operator">-</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	elementData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
	size<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸¤ç§æ·»åŠ å…ƒç´ æ–¹æ³•çš„<strong>ä¸åŒç‚¹</strong>æ˜¯ï¼š</p>
<ul>
<li>æ·»åŠ å…ƒç´ åˆ°ä»»æ„ä½ç½®ï¼Œä¼šå¯¼è‡´åœ¨<strong>è¯¥ä½ç½®åçš„æ‰€æœ‰å…ƒç´ éƒ½éœ€è¦é‡æ–°æ’åˆ—</strong>ï¼›</li>
<li>è€Œæ·»åŠ å…ƒç´ åˆ°æ•°ç»„æœ«å°¾ï¼Œåœ¨æ²¡æœ‰å‘ç”Ÿæ‰©å®¹çš„å‰æä¸‹ï¼Œæ˜¯ä¸ä¼šæœ‰å…ƒç´ å¤åˆ¶æ’åºè¿‡ç¨‹çš„ã€‚</li>
</ul>
<p>ä¸¤ç§æ·»åŠ å…ƒç´ æ–¹æ³•çš„<strong>å…±åŒç‚¹</strong>æ˜¯ï¼šæ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥å®¹é‡å¤§å°ï¼Œ<strong>å¦‚æœå‘ç°å®¹é‡ä¸è¶³ï¼Œä¼šè‡ªåŠ¨æ‰©å®¹ä¸ºåŸå§‹å¤§å°çš„ 1.5 å€</strong>ã€‚</p>
<p><code>ArrayList</code>  æ·»åŠ å…ƒç´ çš„å®ç°ä¸»è¦åŸºäºä»¥ä¸‹å…³é”®æ€§æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>elementData <span class="token operator">==</span> DEFAULTCAPACITY_EMPTY_ELEMENTDATA<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        minCapacity <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>DEFAULT_CAPACITY<span class="token punctuation">,</span> minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">ensureExplicitCapacity</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token comment">// overflow-conscious code</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>minCapacity <span class="token operator">-</span> elementData<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token function">grow</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">grow</span><span class="token punctuation">(</span><span class="token keyword">int</span> minCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// overflow-conscious code</span>
    <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> elementData<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> oldCapacity <span class="token operator">+</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> minCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        newCapacity <span class="token operator">=</span> minCapacity<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newCapacity <span class="token operator">-</span> MAX_ARRAY_SIZE <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
        newCapacity <span class="token operator">=</span> <span class="token function">hugeCapacity</span><span class="token punctuation">(</span>minCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// minCapacity is usually close to size, so this is a win:</span>
    elementData <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ArrayList</code>  æ‰§è¡Œæ·»åŠ å…ƒç´ åŠ¨ä½œï¼ˆ <code>add</code>  æ–¹æ³•ï¼‰æ—¶ï¼Œè°ƒç”¨  <code>ensureCapacityInternal</code>  æ–¹æ³•æ¥ä¿è¯å®¹é‡è¶³å¤Ÿã€‚</p>
<ul>
<li>å¦‚æœå®¹é‡è¶³å¤Ÿæ—¶ï¼Œå°†æ•°æ®ä½œä¸ºæ•°ç»„ä¸­  <code>size+1</code>  ä½ç½®ä¸Šçš„å…ƒç´ å†™å…¥ï¼Œå¹¶å°†  <code>size</code>  è‡ªå¢ 1ã€‚</li>
<li>å¦‚æœå®¹é‡ä¸å¤Ÿæ—¶ï¼Œéœ€è¦ä½¿ç”¨  <code>grow</code>  æ–¹æ³•è¿›è¡Œæ‰©å®¹æ•°ç»„ï¼Œæ–°å®¹é‡çš„å¤§å°ä¸º  <code>oldCapacity + (oldCapacity &gt;&gt; 1)</code> ï¼Œä¹Ÿå°±æ˜¯æ—§å®¹é‡çš„ 1.5 å€ã€‚æ‰©å®¹æ“ä½œå®é™…ä¸Šæ˜¯<strong>è°ƒç”¨  <code>Arrays.copyOf()</code>  æŠŠåŸæ•°ç»„æ‹·è´ä¸ºä¸€ä¸ªæ–°æ•°ç»„</strong>ï¼Œå› æ­¤æœ€å¥½åœ¨åˆ›å»º  <code>ArrayList</code>  å¯¹è±¡æ—¶å°±æŒ‡å®šå¤§æ¦‚çš„å®¹é‡å¤§å°ï¼Œå‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°ã€‚</li>
</ul>
<h4 id="-385"><a class="markdownIt-Anchor" href="#-385">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#arraylist-%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0">#</a>ArrayList åˆ é™¤å…ƒç´ </h4>
<p><code>ArrayList</code>  çš„åˆ é™¤æ–¹æ³•å’Œæ·»åŠ å…ƒç´ åˆ°ä»»æ„ä½ç½®æ–¹æ³•æœ‰äº›ç›¸ä¼¼ã€‚</p>
<p><code>ArrayList</code>  åœ¨æ¯ä¸€æ¬¡æœ‰æ•ˆçš„åˆ é™¤æ“ä½œåï¼Œéƒ½è¦è¿›è¡Œæ•°ç»„çš„é‡ç»„ï¼Œå¹¶ä¸”åˆ é™¤çš„å…ƒç´ ä½ç½®è¶Šé å‰ï¼Œæ•°ç»„é‡ç»„çš„å¼€é”€å°±è¶Šå¤§ã€‚å…·ä½“æ¥è¯´ï¼Œ <code>ArrayList</code>  ä¼š ** è°ƒç”¨  <code>System.arraycopy()</code>  å°†  <code>index+1</code>  åé¢çš„å…ƒç´ éƒ½å¤åˆ¶åˆ°  <code>index</code>  ä½ç½®ä¸Šã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">rangeCheck</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">elementData</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> numMoved <span class="token operator">=</span> size <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elementData<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> index<span class="token punctuation">,</span> numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
    elementData<span class="token punctuation">[</span><span class="token operator">--</span>size<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// clear to let GC do its work</span>

    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-386"><a class="markdownIt-Anchor" href="#-386">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#arraylist-%E7%9A%84-fail-fast">#</a>ArrayList çš„ Fail-Fast</h4>
<p><code>ArrayList</code>  ä½¿ç”¨  <code>modCount</code>  æ¥è®°å½•ç»“æ„å‘ç”Ÿå˜åŒ–çš„æ¬¡æ•°ã€‚ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯æŒ‡æ·»åŠ æˆ–è€…åˆ é™¤è‡³å°‘ä¸€ä¸ªå…ƒç´ çš„æ‰€æœ‰æ“ä½œï¼Œæˆ–è€…æ˜¯è°ƒæ•´å†…éƒ¨æ•°ç»„çš„å¤§å°ï¼Œä»…ä»…åªæ˜¯è®¾ç½®å…ƒç´ çš„å€¼ä¸ç®—ç»“æ„å‘ç”Ÿå˜åŒ–ã€‚</p>
<p>åœ¨è¿›è¡Œåºåˆ—åŒ–æˆ–è€…è¿­ä»£ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦æ¯”è¾ƒæ“ä½œå‰å  <code>modCount</code>  æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœå‘ç”Ÿæ”¹å˜ï¼Œ <code>ArrayList</code>  ä¼šæŠ›å‡º  <code>ConcurrentModificationException</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectOutputStream</span> s<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// Write out element count, and any hidden stuff</span>
    <span class="token keyword">int</span> expectedModCount <span class="token operator">=</span> modCount<span class="token punctuation">;</span>
    s<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Write out size as capacity for behavioural compatibility with clone()</span>
    s<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Write out all elements in the proper order.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        s<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>modCount <span class="token operator">!=</span> expectedModCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-387"><a class="markdownIt-Anchor" href="#-387">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_3-linkedlist">#</a>3. LinkedList</h2>
<blockquote>
<p>LinkedList ä»æ•°æ®ç»“æ„è§’åº¦æ¥çœ‹ï¼Œå¯ä»¥è§†ä¸ºåŒé“¾è¡¨ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200221142535.png" alt="img"></p>
<h3 id="-388"><a class="markdownIt-Anchor" href="#-388">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_3-1-linkedlist-%E8%A6%81%E7%82%B9">#</a>3.1. LinkedList è¦ç‚¹</h3>
<p><code>LinkedList</code>  åŸºäºåŒé“¾è¡¨ç»“æ„å®ç°ã€‚ç”±äºæ˜¯åŒé“¾è¡¨ï¼Œæ‰€ä»¥<strong>é¡ºåºè®¿é—®ä¼šéå¸¸é«˜æ•ˆï¼Œè€Œéšæœºè®¿é—®æ•ˆç‡æ¯”è¾ƒä½ã€‚</strong></p>
<p><code>LinkedList</code>  å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractSequentialList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Deque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä»  <code>LinkedList</code>  çš„å®šä¹‰ï¼Œå¯ä»¥å¾—å‡º  <code>LinkedList</code>  çš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ï¼š</p>
<ul>
<li><code>LinkedList</code>  å®ç°äº†  <code>List</code>  æ¥å£ï¼Œå¹¶ç»§æ‰¿äº†  <code>AbstractSequentialList</code>  ï¼Œå®ƒæ”¯æŒæ‰€æœ‰  <code>List</code>  çš„æ“ä½œã€‚</li>
<li><code>LinkedList</code>  å®ç°äº†  <code>Deque</code>  æ¥å£ï¼Œä¹Ÿå¯ä»¥è¢«å½“ä½œé˜Ÿåˆ—ï¼ˆ <code>Queue</code> ï¼‰æˆ–åŒç«¯é˜Ÿåˆ—ï¼ˆ <code>Deque</code> ï¼‰è¿›è¡Œæ“ä½œï¼Œæ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å®ç°æ ˆã€‚</li>
<li><code>LinkedList</code>  å®ç°äº†  <code>Cloneable</code>  æ¥å£ï¼Œé»˜è®¤ä¸º<strong>æµ…æ‹·è´</strong>ã€‚</li>
<li><code>LinkedList</code>  å®ç°äº†  <code>Serializable</code>  æ¥å£ï¼Œ<strong>æ”¯æŒåºåˆ—åŒ–</strong>ã€‚</li>
<li><code>LinkedList</code>  æ˜¯<strong>éçº¿ç¨‹å®‰å…¨</strong>çš„ã€‚</li>
</ul>
<h3 id="-389"><a class="markdownIt-Anchor" href="#-389">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_3-2-linkedlist-%E5%8E%9F%E7%90%86">#</a>3.2. LinkedList åŸç†</h3>
<h4 id="-390"><a class="markdownIt-Anchor" href="#-390">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#linkedlist-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">#</a>LinkedList çš„æ•°æ®ç»“æ„</h4>
<p><strong> <code>LinkedList</code>  å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒé“¾è¡¨</strong>ã€‚</p>
<p><code>LinkedList</code>  é€šè¿‡  <code>Node</code>  ç±»å‹çš„å¤´å°¾æŒ‡é’ˆï¼ˆ <code>first</code>  å’Œ  <code>last</code> ï¼‰æ¥è®¿é—®æ•°æ®ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// é“¾è¡¨é•¿åº¦</span>
<span class="token keyword">transient</span> <span class="token keyword">int</span> size <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">// é“¾è¡¨å¤´èŠ‚ç‚¹</span>
<span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> first<span class="token punctuation">;</span>
<span class="token comment">// é“¾è¡¨å°¾èŠ‚ç‚¹</span>
<span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> last<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>size</code>  - <strong>è¡¨ç¤ºåŒé“¾è¡¨ä¸­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œåˆå§‹ä¸º 0</strong>ã€‚</li>
<li><code>first</code>  å’Œ  <code>last</code>  - <strong>åˆ†åˆ«æ˜¯åŒé“¾è¡¨çš„å¤´èŠ‚ç‚¹å’Œå°¾èŠ‚ç‚¹</strong>ã€‚</li>
</ul>
<p><code>Node</code>  æ˜¯  <code>LinkedList</code>  çš„å†…éƒ¨ç±»ï¼Œå®ƒè¡¨ç¤ºé“¾è¡¨ä¸­çš„å…ƒç´ å®ä¾‹ã€‚Node ä¸­åŒ…å«ä¸‰ä¸ªå…ƒç´ ï¼š</p>
<ul>
<li><code>prev</code>  æ˜¯è¯¥èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼›</li>
<li><code>next</code>  æ˜¯è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼›</li>
<li><code>item</code>  æ˜¯è¯¥èŠ‚ç‚¹æ‰€åŒ…å«çš„å€¼ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">E</span> item<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> prev<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-391"><a class="markdownIt-Anchor" href="#-391">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#linkedlist-%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96">#</a>LinkedList çš„åºåˆ—åŒ–</h4>
<p><code>LinkedList</code>  ä¸  <code>ArrayList</code>  ä¸€æ ·ä¹Ÿå®šåˆ¶äº†è‡ªèº«çš„åºåˆ—åŒ–æ–¹å¼ã€‚å…·ä½“åšæ³•æ˜¯ï¼š</p>
<ul>
<li>å°†  <code>size</code>  ï¼ˆåŒé“¾è¡¨å®¹é‡å¤§å°ï¼‰ã€ <code>first</code>  å’Œ <code>last</code>  ï¼ˆåŒé“¾è¡¨çš„å¤´å°¾èŠ‚ç‚¹ï¼‰ä¿®é¥°ä¸º  <code>transient</code> ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥è¢« Java åºåˆ—åŒ–æ‰€å¿½ç•¥ã€‚</li>
<li>é‡å†™äº†  <code>writeObject()</code>  å’Œ  <code>readObject()</code>  æ¥æ§åˆ¶åºåˆ—åŒ–æ—¶ï¼Œåªå¤„ç†åŒé“¾è¡¨ä¸­èƒ½è¢«å¤´èŠ‚ç‚¹é“¾å¼å¼•ç”¨çš„èŠ‚ç‚¹å…ƒç´ ã€‚</li>
</ul>
<h4 id="-392"><a class="markdownIt-Anchor" href="#-392">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#linkedlist-%E8%AE%BF%E9%97%AE%E5%85%83%E7%B4%A0">#</a>LinkedList è®¿é—®å…ƒç´ </h4>
<p><code>LinkedList</code>  è®¿é—®å…ƒç´ çš„å®ç°ä¸»è¦åŸºäºä»¥ä¸‹å…³é”®æ€§æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">checkElementIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">node</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>item<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token function">node</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// assert isElementIndex(index);</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token punctuation">(</span>size <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> x <span class="token operator">=</span> first<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> index<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            x <span class="token operator">=</span> x<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> x <span class="token operator">=</span> last<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">></span> index<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>
            x <span class="token operator">=</span> x<span class="token punctuation">.</span>prev<span class="token punctuation">;</span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è·å–  <code>LinkedList</code>  ç¬¬ index ä¸ªå…ƒç´ çš„ç®—æ³•æ˜¯ï¼š</p>
<ul>
<li>åˆ¤æ–­ index åœ¨é“¾è¡¨å‰åŠéƒ¨åˆ†ï¼Œè¿˜æ˜¯ååŠéƒ¨åˆ†ã€‚</li>
<li>å¦‚æœæ˜¯å‰åŠéƒ¨åˆ†ï¼Œä»å¤´èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ï¼›å¦‚æœæ˜¯ååŠéƒ¨åˆ†ï¼Œä»å°¾ç»“ç‚¹å¼€å§‹æŸ¥æ‰¾ã€‚</li>
</ul>
<p><code>LinkedList</code>  è¿™ç§è®¿é—®å…ƒç´ çš„æ€§èƒ½æ˜¯  <code>O(N)</code>  çº§åˆ«çš„ï¼ˆæç«¯æƒ…å†µä¸‹ï¼Œæ‰«æ N/2 ä¸ªå…ƒç´ ï¼‰ï¼›ç›¸æ¯”äº  <code>ArrayList</code>  çš„  <code>O(1)</code> ï¼Œæ˜¾ç„¶è¦æ…¢ä¸å°‘ã€‚</p>
<p><strong>æ¨èä½¿ç”¨è¿­ä»£å™¨éå†  <code>LinkedList</code>  ï¼Œä¸è¦ä½¿ç”¨ä¼ ç»Ÿçš„  <code>for</code>  å¾ªç¯</strong>ã€‚æ³¨ï¼šforeach è¯­æ³•ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢æˆè¿­ä»£å™¨éå†ï¼Œä½†æ˜¯å®ƒçš„éå†è¿‡ç¨‹ä¸­ä¸å…è®¸ä¿®æ”¹  <code>List</code>  é•¿åº¦ï¼Œå³ä¸èƒ½è¿›è¡Œå¢åˆ æ“ä½œã€‚</p>
<h4 id="-393"><a class="markdownIt-Anchor" href="#-393">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#linkedlist-%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0">#</a>LinkedList æ·»åŠ å…ƒç´ </h4>
<p><code>LinkedList</code>  æœ‰å¤šç§æ·»åŠ å…ƒç´ æ–¹æ³•ï¼š</p>
<ul>
<li><code>add(E e)</code> ï¼šé»˜è®¤æ·»åŠ å…ƒç´ æ–¹æ³•ï¼ˆæ’å…¥å°¾éƒ¨ï¼‰</li>
<li><code>add(int index, E element)</code> ï¼šæ·»åŠ å…ƒç´ åˆ°ä»»æ„ä½ç½®</li>
<li><code>addFirst(E e)</code> ï¼šåœ¨å¤´éƒ¨æ·»åŠ å…ƒç´ </li>
<li><code>addLast(E e)</code> ï¼šåœ¨å°¾éƒ¨æ·»åŠ å…ƒç´ </li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">linkLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">checkPositionIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> size<span class="token punctuation">)</span>
		<span class="token function">linkLast</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		<span class="token function">linkBefore</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token function">node</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addFirst</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">linkFirst</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addLast</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">linkLast</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>LinkedList</code>  æ·»åŠ å…ƒç´ çš„å®ç°ä¸»è¦åŸºäºä»¥ä¸‹å…³é”®æ€§æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">linkFirst</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> f <span class="token operator">=</span> first<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
	first <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
		last <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		f<span class="token punctuation">.</span>prev <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	size<span class="token operator">++</span><span class="token punctuation">;</span>
	modCount<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">linkLast</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> l <span class="token operator">=</span> last<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	last <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
		first <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		l<span class="token punctuation">.</span>next <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	size<span class="token operator">++</span><span class="token punctuation">;</span>
	modCount<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">linkBefore</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> succ<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// assert succ != null;</span>
	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> pred <span class="token operator">=</span> succ<span class="token punctuation">.</span>prev<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> newNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>pred<span class="token punctuation">,</span> e<span class="token punctuation">,</span> succ<span class="token punctuation">)</span><span class="token punctuation">;</span>
	succ<span class="token punctuation">.</span>prev <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pred <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
		first <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		pred<span class="token punctuation">.</span>next <span class="token operator">=</span> newNode<span class="token punctuation">;</span>
	size<span class="token operator">++</span><span class="token punctuation">;</span>
	modCount<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç®—æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°†æ–°æ·»åŠ çš„æ•°æ®åŒ…è£…ä¸º  <code>Node</code> ï¼›</li>
<li>å¦‚æœå¾€å¤´éƒ¨æ·»åŠ å…ƒç´ ï¼Œå°†å¤´æŒ‡é’ˆ  <code>first</code>  æŒ‡å‘æ–°çš„  <code>Node</code> ï¼Œä¹‹å‰çš„  <code>first</code>  å¯¹è±¡çš„  <code>prev</code>  æŒ‡å‘æ–°çš„  <code>Node</code> ã€‚</li>
<li>å¦‚æœæ˜¯å‘å°¾éƒ¨æ·»åŠ å…ƒç´ ï¼Œåˆ™å°†å°¾æŒ‡é’ˆ  <code>last</code>  æŒ‡å‘æ–°çš„  <code>Node</code> ï¼Œä¹‹å‰çš„  <code>last</code>  å¯¹è±¡çš„  <code>next</code>  æŒ‡å‘æ–°çš„  <code>Node</code> ã€‚</li>
</ul>
<h4 id="-394"><a class="markdownIt-Anchor" href="#-394">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#linkedlist-%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0">#</a>LinkedList åˆ é™¤å…ƒç´ </h4>
<p><code>LinkedList</code>  åˆ é™¤å…ƒç´ çš„å®ç°ä¸»è¦åŸºäºä»¥ä¸‹å…³é”®æ€§æºç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// éå†æ‰¾åˆ°è¦åˆ é™¤çš„å…ƒç´ èŠ‚ç‚¹</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> x <span class="token operator">=</span> first<span class="token punctuation">;</span> x <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> x <span class="token operator">=</span> x<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>item <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">unlink</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// éå†æ‰¾åˆ°è¦åˆ é™¤çš„å…ƒç´ èŠ‚ç‚¹</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> x <span class="token operator">=</span> first<span class="token punctuation">;</span> x <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> x <span class="token operator">=</span> x<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">unlink</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">E</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// assert x != null;</span>
    <span class="token keyword">final</span> <span class="token class-name">E</span> element <span class="token operator">=</span> x<span class="token punctuation">.</span>item<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> next <span class="token operator">=</span> x<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> prev <span class="token operator">=</span> x<span class="token punctuation">.</span>prev<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>prev <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        first <span class="token operator">=</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        prev<span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
        x<span class="token punctuation">.</span>prev <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        last <span class="token operator">=</span> prev<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        next<span class="token punctuation">.</span>prev <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        x<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    x<span class="token punctuation">.</span>item <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    size<span class="token operator">--</span><span class="token punctuation">;</span>
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç®—æ³•è¯´æ˜ï¼š</p>
<ul>
<li>
<p>éå†æ‰¾åˆ°è¦åˆ é™¤çš„å…ƒç´ èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨  <code>unlink</code>  æ–¹æ³•åˆ é™¤èŠ‚ç‚¹ï¼›</p>
</li>
<li>
<pre><code>  unlink
  <pre class="line-numbers language-none"><code class="language-none">
	 

	åˆ é™¤èŠ‚ç‚¹çš„æ–¹æ³•ï¼š

	- å¦‚æœå½“å‰èŠ‚ç‚¹æœ‰å‰é©±èŠ‚ç‚¹ï¼Œåˆ™è®©å‰é©±èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼›å¦åˆ™ï¼Œè®©åŒé“¾è¡¨å¤´æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚
	- å¦‚æœå½“å‰èŠ‚ç‚¹æœ‰åç»§èŠ‚ç‚¹ï¼Œåˆ™è®©åç»§èŠ‚ç‚¹æŒ‡å‘å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼›å¦åˆ™ï¼Œè®©åŒé“¾è¡¨å°¾æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€ä¸ªèŠ‚ç‚¹ã€‚

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;container&#x2F;java-container-list.html#_4-list-å¸¸è§é—®é¢˜)4. List å¸¸è§é—®é¢˜

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;container&#x2F;java-container-list.html#_4-1-arrays-aslist-é—®é¢˜ç‚¹)4.1. Arrays.asList é—®é¢˜ç‚¹

åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šæŠŠåŸå§‹çš„æ•°ç»„è½¬æ¢ä¸º &#96;List&#96; ç±»æ•°æ®ç»“æ„ï¼Œæ¥ç»§ç»­å±•å¼€å„ç§ &#96;Stream&#96; æ“ä½œã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ &#96;Arrays.asList&#96; æ–¹æ³•å¯ä»¥æŠŠæ•°ç»„ä¸€é”®è½¬æ¢ä¸º &#96;List&#96;ã€‚

ã€ç¤ºä¾‹ã€‘Arrays.asList è½¬æ¢åŸºæœ¬ç±»å‹æ•°ç»„

&#96;&#96;&#96;java
int[] arr &#x3D; &#123; 1, 2, 3 &#125;;
List list &#x3D; Arrays.asList(arr);
log.info(&quot;list:&#123;&#125; size:&#123;&#125; class:&#123;&#125;&quot;, list, list.size(), list.get(0).getClass());<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>ã€è¾“å‡ºã€‘</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">11:26:33.214 [main] INFO io.github.dunwu.javacore.container.list.AsListç¤ºä¾‹ - list:[[I@ae45eb6] size:1 class:class [I<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ•°ç»„å…ƒç´ ä¸ªæ•°ä¸º 3ï¼Œä½†è½¬æ¢åçš„åˆ—è¡¨ä¸ªæ•°ä¸º 1ã€‚</p>
<p>ç”±æ­¤å¯çŸ¥ï¼Œ  <code>Arrays.asList</code>  ç¬¬ä¸€ä¸ªé—®é¢˜ç‚¹ï¼š<strong>ä¸èƒ½ç›´æ¥ä½¿ç”¨  <code>Arrays.asList</code>  æ¥è½¬æ¢åŸºæœ¬ç±»å‹æ•°ç»„</strong>ã€‚</p>
<p>å…¶åŸå› æ˜¯ï¼š <code>Arrays.asList</code>  æ–¹æ³•ä¼ å…¥çš„æ˜¯ä¸€ä¸ªæ³›å‹ T ç±»å‹å¯å˜å‚æ•°ï¼Œæœ€ç»ˆ  <code>int</code>  æ•°ç»„æ•´ä½“ä½œä¸ºäº†ä¸€ä¸ªå¯¹è±¡æˆä¸ºäº†æ³›å‹ç±»å‹ Tï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">asList</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç›´æ¥éå†è¿™æ ·çš„  <code>List</code>  å¿…ç„¶ä¼šå‡ºç° Bugï¼Œä¿®å¤æ–¹å¼æœ‰ä¸¤ç§ï¼Œå¦‚æœä½¿ç”¨ Java8 ä»¥ä¸Šç‰ˆæœ¬å¯ä»¥ä½¿ç”¨  <code>Arrays.stream</code>  æ–¹æ³•æ¥è½¬æ¢ï¼Œå¦åˆ™å¯ä»¥æŠŠ  <code>int</code>  æ•°ç»„å£°æ˜ä¸ºåŒ…è£…ç±»å‹  <code>Integer</code>  æ•°ç»„ï¼š</p>
<p>ã€ç¤ºä¾‹ã€‘è½¬æ¢æ•´å‹æ•°ç»„ä¸º List çš„æ­£ç¡®æ–¹å¼</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span> list1 <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"list:&#123;&#125; size:&#123;&#125; class:&#123;&#125;"</span><span class="token punctuation">,</span> list1<span class="token punctuation">,</span> list1<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span> list2 <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"list:&#123;&#125; size:&#123;&#125; class:&#123;&#125;"</span><span class="token punctuation">,</span> list2<span class="token punctuation">,</span> list2<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> list2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘Arrays.asList è½¬æ¢å¼•ç”¨ç±»å‹æ•°ç»„</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"4"</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"arr:&#123;&#125; list:&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŠ›å‡º  <code>java.lang.UnsupportedOperationException</code> ã€‚</p>
<p>æŠ›å‡ºå¼‚å¸¸çš„åŸå› åœ¨äº  <code>Arrays.asList</code>  ç¬¬äºŒä¸ªé—®é¢˜ç‚¹ï¼š<strong> <code>Arrays.asList</code>  è¿”å›çš„  <code>List</code>  ä¸æ”¯æŒå¢åˆ æ“ä½œ</strong>ã€‚ <code>Arrays.asList</code>  è¿”å›çš„ List å¹¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„  <code>java.util.ArrayList</code> ï¼Œè€Œæ˜¯  <code>Arrays</code>  çš„å†…éƒ¨ç±»  <code>ArrayList</code> ã€‚</p>
<p>æŸ¥çœ‹æºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°  <code>Arrays.asList</code>  è¿”å›çš„  <code>ArrayList</code>  ç»§æ‰¿äº†  <code>AbstractList</code> ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¦†å†™  <code>add</code>  å’Œ  <code>remove</code>  æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">RandomAccess</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2764017481108945198L</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">E</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">;</span>

    <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        a <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// ...</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">E</span> oldValue <span class="token operator">=</span> a<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        a<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">E</span> element<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>Arrays.asList</code>  ç¬¬ä¸‰ä¸ªé—®é¢˜ç‚¹ï¼š<strong>å¯¹åŸå§‹æ•°ç»„çš„ä¿®æ”¹ä¼šå½±å“åˆ°æˆ‘ä»¬è·å¾—çš„é‚£ä¸ª  <code>List</code> </strong>ã€‚ <code>ArrayList</code>  å…¶å®æ˜¯ç›´æ¥ä½¿ç”¨äº†åŸå§‹çš„æ•°ç»„ã€‚</p>
<p>è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œé‡æ–°  <code>new</code>  ä¸€ä¸ª  <code>ArrayList</code>  åˆå§‹åŒ–  <code>Arrays.asList</code>  è¿”å›çš„  <code>List</code>  å³å¯ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"4"</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"arr:&#123;&#125; list:&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-395"><a class="markdownIt-Anchor" href="#-395">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-list.html#_4-2-list-sublist-%E9%97%AE%E9%A2%98%E7%82%B9">#</a>4.2. List.subList é—®é¢˜ç‚¹</h3>
<p>List.subList ç›´æ¥å¼•ç”¨äº†åŸå§‹çš„ Listï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯å…±äº« â€œå­˜å‚¨â€ï¼Œè€Œä¸”å¯¹åŸå§‹ List ç›´æ¥è¿›è¡Œç»“æ„æ€§ä¿®æ”¹ä¼šå¯¼è‡´ SubList å‡ºç°å¼‚å¸¸ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span><span class="token punctuation">></span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">oom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> rawList <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rawList<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‡ºç° OOM çš„åŸå› æ˜¯ï¼Œå¾ªç¯ä¸­çš„ 1000 ä¸ªå…·æœ‰ 10 ä¸‡ä¸ªå…ƒç´ çš„ List å§‹ç»ˆå¾—ä¸åˆ°å›æ”¶ï¼Œå› ä¸ºå®ƒå§‹ç»ˆè¢« subList æ–¹æ³•è¿”å›çš„ List å¼ºå¼•ç”¨ã€‚</p>
<p>è§£å†³æ–¹æ³•æ˜¯ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">oomfix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> rawList <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>rawList<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘å­ List å¼ºå¼•ç”¨åŸå§‹çš„ List</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">wrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> subList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>subList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    subList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        subList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æŠ›å‡º  <code>java.util.ConcurrentModificationException</code> ã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>ä¸€ç§æ˜¯ï¼Œä¸ç›´æ¥ä½¿ç”¨ subList æ–¹æ³•è¿”å›çš„ SubListï¼Œè€Œæ˜¯é‡æ–°ä½¿ç”¨ new ArrayListï¼Œåœ¨æ„é€ æ–¹æ³•ä¼ å…¥ SubListï¼Œæ¥æ„å»ºä¸€ä¸ªç‹¬ç«‹çš„ ArrayListï¼›</p>
<p>å¦ä¸€ç§æ˜¯ï¼Œå¯¹äº Java 8 ä½¿ç”¨ Stream çš„ skip å’Œ limit API æ¥è·³è¿‡æµä¸­çš„å…ƒç´ ï¼Œä»¥åŠé™åˆ¶æµä¸­å…ƒç´ çš„ä¸ªæ•°ï¼ŒåŒæ ·å¯ä»¥è¾¾åˆ° SubList åˆ‡ç‰‡çš„ç›®çš„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//æ–¹å¼ä¸€ï¼š</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> subList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">subList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//æ–¹å¼äºŒï¼š</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> subList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="java-å®¹å™¨ä¹‹-map"><a class="markdownIt-Anchor" href="#java-å®¹å™¨ä¹‹-map">#</a> Java å®¹å™¨ä¹‹ Map</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. Map ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#11-map-%E6%9E%B6%E6%9E%84">1.1. Map æ¶æ„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#12-map-%E6%8E%A5%E5%8F%A3">1.2. Map æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#13-mapentry-%E6%8E%A5%E5%8F%A3">1.3. Map.Entry æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#14-abstractmap-%E6%8A%BD%E8%B1%A1%E7%B1%BB">1.4. AbstractMap æŠ½è±¡ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#15-sortedmap-%E6%8E%A5%E5%8F%A3">1.5. SortedMap æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#16-navigablemap-%E6%8E%A5%E5%8F%A3">1.6. NavigableMap æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#17-dictionary-%E6%8A%BD%E8%B1%A1%E7%B1%BB">1.7. Dictionary æŠ½è±¡ç±»</a></li>
</ul>
</li>
<li>\2. HashMap ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#21-hashmap-%E8%A6%81%E7%82%B9">2.1. HashMap è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#22-hashmap-%E5%8E%9F%E7%90%86">2.2. HashMap åŸç†</a></li>
</ul>
</li>
<li>\3. LinkedHashMap ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#31-linkedhashmap-%E8%A6%81%E7%82%B9">3.1. LinkedHashMap è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#32-linkedhashmap-%E8%A6%81%E7%82%B9">3.2. LinkedHashMap è¦ç‚¹</a></li>
</ul>
</li>
<li>\4. TreeMap ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#41-treemap-%E8%A6%81%E7%82%B9">4.1. TreeMap è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#42-treemap-%E5%8E%9F%E7%90%86">4.2. TreeMap åŸç†</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#43-remove-%E6%96%B9%E6%B3%95">4.3. remove æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#44-treemap-%E7%A4%BA%E4%BE%8B">4.4. TreeMap ç¤ºä¾‹</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#5-weakhashmap">5. WeakHashMap</a></li>
<li>\6. æ€»ç»“
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#61-map-%E7%AE%80%E4%BB%8B">6.1. Map ç®€ä»‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#62-hashmap">6.2. HashMap</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#63-%E5%85%B6%E4%BB%96-map">6.3. å…¶ä»– Map</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-396"><a class="markdownIt-Anchor" href="#-396">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-map-%E7%AE%80%E4%BB%8B">#</a>1. Map ç®€ä»‹</h2>
<h3 id="-397"><a class="markdownIt-Anchor" href="#-397">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-1-map-%E6%9E%B6%E6%9E%84">#</a>1.1. Map æ¶æ„</h3>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/Map-diagrams.png" alt="img"></p>
<p>Map å®¶æ—ä¸»è¦æˆå‘˜åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>Map</code>  æ˜¯ Map å®¹å™¨å®¶æ—çš„ç¥–å…ˆï¼ŒMap æ˜¯ä¸€ä¸ªç”¨äºä¿å­˜é”®å€¼å¯¹ (key-value) çš„æ¥å£ã€‚<strong>Map ä¸­ä¸èƒ½åŒ…å«é‡å¤çš„é”®ï¼›æ¯ä¸ªé”®æœ€å¤šåªèƒ½æ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚</strong></li>
<li><code>AbstractMap</code>  ç»§æ‰¿äº†  <code>Map</code>  çš„æŠ½è±¡ç±»ï¼Œå®ƒå®ç°äº†  <code>Map</code>  ä¸­çš„æ ¸å¿ƒ APIã€‚å…¶å®ƒ  <code>Map</code>  çš„å®ç°ç±»å¯ä»¥é€šè¿‡ç»§æ‰¿  <code>AbstractMap</code>  æ¥å‡å°‘é‡å¤ç¼–ç ã€‚</li>
<li><code>SortedMap</code>  ç»§æ‰¿äº†  <code>Map</code>  çš„æ¥å£ã€‚ <code>SortedMap</code>  ä¸­çš„å†…å®¹æ˜¯æ’åºçš„é”®å€¼å¯¹ï¼Œæ’åºçš„æ–¹æ³•æ˜¯é€šè¿‡å®ç°æ¯”è¾ƒå™¨ ( <code>Comparator</code> ) å®Œæˆçš„ã€‚</li>
<li><code>NavigableMap</code>  ç»§æ‰¿äº†  <code>SortedMap</code>  çš„æ¥å£ã€‚ç›¸æ¯”äº  <code>SortedMap</code> ï¼Œ <code>NavigableMap</code>  æœ‰ä¸€ç³»åˆ—çš„ â€œå¯¼èˆªâ€ æ–¹æ³•ï¼›å¦‚ &quot;è·å–å¤§äº / ç­‰äºæŸå¯¹è±¡çš„é”®å€¼å¯¹&quot;ã€â€œè·å–å°äº / ç­‰äºæŸå¯¹è±¡çš„é”®å€¼å¯¹â€ ç­‰ç­‰ã€‚</li>
<li><code>HashMap</code>  ç»§æ‰¿äº†  <code>AbstractMap</code> ï¼Œä½†æ²¡å®ç°  <code>NavigableMap</code>  æ¥å£ã€‚ <code>HashMap</code>  çš„ä¸»è¦ä½œç”¨æ˜¯å‚¨å­˜æ— åºçš„é”®å€¼å¯¹ï¼Œè€Œ  <code>Hash</code>  ä¹Ÿä½“ç°äº†å®ƒçš„æŸ¥æ‰¾æ•ˆç‡å¾ˆé«˜ã€‚ <code>HashMap</code>  æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„  <code>Map</code> ã€‚</li>
<li><code>Hashtable</code>  è™½ç„¶æ²¡æœ‰ç»§æ‰¿  <code>AbstractMap</code> ï¼Œä½†å®ƒç»§æ‰¿äº†  <code>Dictionary</code> ï¼ˆ <code>Dictionary</code>  ä¹Ÿæ˜¯é”®å€¼å¯¹çš„æ¥å£ï¼‰ï¼Œè€Œä¸”ä¹Ÿå®ç°  <code>Map</code>  æ¥å£ã€‚å› æ­¤ï¼Œ <code>Hashtable</code>  çš„ä¸»è¦ä½œç”¨æ˜¯å‚¨å­˜æ— åºçš„é”®å€¼å¯¹ã€‚å’Œ HashMap ç›¸æ¯”ï¼Œ <code>Hashtable</code>  åœ¨å®ƒçš„ä¸»è¦æ–¹æ³•ä¸­ä½¿ç”¨  <code>synchronized</code>  å…³é”®å­—ä¿®é¥°ï¼Œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ä½†æ˜¯ï¼Œç”±äºå®ƒçš„é”ç²’åº¦å¤ªå¤§ï¼Œéå¸¸å½±å“è¯»å†™é€Ÿåº¦ï¼Œæ‰€ä»¥ï¼Œç°ä»£ Java ç¨‹åºå‡ ä¹ä¸ä¼šä½¿ç”¨  <code>Hashtable</code>  ï¼Œå¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸€èˆ¬ä¼šç”¨  <code>ConcurrentHashMap</code>  æ¥æ›¿ä»£ã€‚</li>
<li><code>TreeMap</code>  ç»§æ‰¿äº†  <code>AbstractMap</code> ï¼Œä¸”å®ç°äº†  <code>NavigableMap</code>  æ¥å£ã€‚ <code>TreeMap</code>  çš„ä¸»è¦ä½œç”¨æ˜¯å‚¨å­˜æœ‰åºçš„é”®å€¼å¯¹ï¼Œæ’åºä¾æ®æ ¹æ®å…ƒç´ ç±»å‹çš„  <code>Comparator</code>  è€Œå®šã€‚</li>
<li><code>WeakHashMap</code>  ç»§æ‰¿äº†  <code>AbstractMap</code> ã€‚ <code>WeakHashMap</code>  çš„é”®æ˜¯<strong>å¼±å¼•ç”¨</strong> ï¼ˆå³  <code>WeakReference</code> ï¼‰ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å½“ GC å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šè‡ªåŠ¨å°†  <code>WeakHashMap</code>  ä¸­çš„ key å›æ”¶ï¼Œè¿™é¿å…äº†  <code>WeakHashMap</code>  çš„å†…å­˜ç©ºé—´æ— é™è†¨èƒ€ã€‚å¾ˆæ˜æ˜¾ï¼Œ <code>WeakHashMap</code>  é€‚ç”¨äºä½œä¸ºç¼“å­˜ã€‚</li>
</ul>
<h3 id="-398"><a class="markdownIt-Anchor" href="#-398">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-2-map-%E6%8E%A5%E5%8F%A3">#</a>1.2. Map æ¥å£</h3>
<p>Map çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Map æ˜¯ä¸€ä¸ªç”¨äºä¿å­˜é”®å€¼å¯¹ (key-value) çš„æ¥å£ã€‚<strong>Map ä¸­ä¸èƒ½åŒ…å«é‡å¤çš„é”®ï¼›æ¯ä¸ªé”®æœ€å¤šåªèƒ½æ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚</strong></p>
<p>Map æ¥å£æä¾›ä¸‰ç§  <code>Collection</code>  è§†å›¾ï¼Œå…è®¸ä»¥<strong>é”®é›†</strong>ã€<strong>å€¼é›†</strong>æˆ–<strong>é”® - å€¼æ˜ å°„å…³ç³»é›†</strong>çš„å½¢å¼è®¿é—®æ•°æ®ã€‚</p>
<p>Map æœ‰äº›å®ç°ç±»ï¼Œå¯ä»¥æœ‰åºçš„ä¿å­˜å…ƒç´ ï¼Œå¦‚  <code>TreeMap</code> ï¼›å¦ä¸€äº›å®ç°ç±»åˆ™ä¸ä¿è¯é¡ºåºï¼Œå¦‚  <code>HashMap</code>  ç±»ã€‚</p>
<p>Map çš„å®ç°ç±»åº”è¯¥æä¾› 2 ä¸ª â€œæ ‡å‡†çš„â€ æ„é€ æ–¹æ³•ï¼š</p>
<ul>
<li>voidï¼ˆæ— å‚æ•°ï¼‰æ„é€ æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºç©º Mapï¼›</li>
<li>å¸¦æœ‰å•ä¸ª Map ç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªä¸å…¶å‚æ•°å…·æœ‰ç›¸åŒé”® - å€¼æ˜ å°„å…³ç³»çš„æ–° Mapã€‚</li>
</ul>
<p>å®é™…ä¸Šï¼Œåä¸€ä¸ªæ„é€ æ–¹æ³•å…è®¸ç”¨æˆ·å¤åˆ¶ä»»æ„ Mapï¼Œç”Ÿæˆæ‰€éœ€ç±»çš„ä¸€ä¸ªç­‰ä»· Mapã€‚å°½ç®¡æ— æ³•å¼ºåˆ¶æ‰§è¡Œæ­¤å»ºè®®ï¼ˆå› ä¸ºæ¥å£ä¸èƒ½åŒ…å«æ„é€ æ–¹æ³•ï¼‰ï¼Œä½†æ˜¯ JDK ä¸­æ‰€æœ‰é€šç”¨çš„ Map å®ç°éƒ½éµä»å®ƒã€‚</p>
<h3 id="-399"><a class="markdownIt-Anchor" href="#-399">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-3-map-entry-%E6%8E%A5%E5%8F%A3">#</a>1.3. Map.Entry æ¥å£</h3>
<p><code>Map.Entry</code>  ä¸€èˆ¬ç”¨äºé€šè¿‡è¿­ä»£å™¨ï¼ˆ <code>Iterator</code> ï¼‰è®¿é—®é—®  <code>Map</code> ã€‚</p>
<p><code>Map.Entry</code>  æ˜¯ Map ä¸­å†…éƒ¨çš„ä¸€ä¸ªæ¥å£ï¼Œ <code>Map.Entry</code>  ä»£è¡¨äº† <strong>é”®å€¼å¯¹</strong> å®ä½“ï¼ŒMap é€šè¿‡  <code>entrySet()</code>  è·å–  <code>Map.Entry</code>  é›†åˆï¼Œä»è€Œé€šè¿‡è¯¥é›†åˆå®ç°å¯¹é”®å€¼å¯¹çš„æ“ä½œã€‚</p>
<h3 id="-400"><a class="markdownIt-Anchor" href="#-400">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-4-abstractmap-%E6%8A%BD%E8%B1%A1%E7%B1%BB">#</a>1.4. AbstractMap æŠ½è±¡ç±»</h3>
<p><code>AbstractMap</code>  çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>AbstractMap</code>  æŠ½è±¡ç±»æä¾›äº†  <code>Map</code>  æ¥å£çš„æ ¸å¿ƒå®ç°ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å®ç°  <code>Map</code>  æ¥å£æ‰€éœ€çš„å·¥ä½œã€‚</p>
<p>è¦å®ç°ä¸å¯ä¿®æ”¹çš„ Mapï¼Œç¼–ç¨‹äººå‘˜åªéœ€æ‰©å±•æ­¤ç±»å¹¶æä¾›  <code>entrySet()</code>  æ–¹æ³•çš„å®ç°å³å¯ï¼Œè¯¥æ–¹æ³•å°†è¿”å›  <code>Map</code>  çš„æ˜ å°„å…³ç³» Set è§†å›¾ã€‚é€šå¸¸ï¼Œè¿”å›çš„ set å°†ä¾æ¬¡åœ¨  <code>AbstractSet</code>  ä¸Šå®ç°ã€‚æ­¤ Set ä¸æ”¯æŒ  <code>add()</code>  æˆ–  <code>remove()</code>  æ–¹æ³•ï¼Œå…¶è¿­ä»£å™¨ä¹Ÿä¸æ”¯æŒ  <code>remove()</code>  æ–¹æ³•ã€‚</p>
<p>è¦å®ç°å¯ä¿®æ”¹çš„  <code>Map</code> ï¼Œç¼–ç¨‹äººå‘˜å¿…é¡»å¦å¤–é‡å†™æ­¤ç±»çš„  <code>put</code>  æ–¹æ³•ï¼ˆå¦åˆ™å°†æŠ›å‡º  <code>UnsupportedOperationException</code> ï¼‰ï¼Œ <code>entrySet().iterator()</code>  è¿”å›çš„è¿­ä»£å™¨ä¹Ÿå¿…é¡»å¦å¤–å®ç°å…¶  <code>remove()</code>  æ–¹æ³•ã€‚</p>
<h3 id="-401"><a class="markdownIt-Anchor" href="#-401">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-5-sortedmap-%E6%8E%A5%E5%8F%A3">#</a>1.5. SortedMap æ¥å£</h3>
<p><code>SortedMap</code>  çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SortedMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>SortedMap</code>  ç»§æ‰¿äº†  <code>Map</code>  ï¼Œå®ƒæ˜¯ä¸€ä¸ªæœ‰åºçš„  <code>Map</code> ã€‚</p>
<p><code>SortedMap</code>  çš„æ’åºæ–¹å¼æœ‰ä¸¤ç§ï¼š<strong>è‡ªç„¶æ’åº</strong>æˆ–è€…<strong>ç”¨æˆ·æŒ‡å®šæ¯”è¾ƒå™¨</strong>ã€‚<strong>æ’å…¥æœ‰åº  <code>SortedMap</code>  çš„æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»å®ç°  <code>Comparable</code>  æ¥å£ï¼ˆæˆ–è€…è¢«æŒ‡å®šçš„æ¯”è¾ƒå™¨æ‰€æ¥å—ï¼‰</strong>ã€‚</p>
<p>å¦å¤–ï¼Œæ‰€æœ‰  <code>SortedMap</code>  å®ç°ç±»éƒ½åº”è¯¥æä¾› 4 ä¸ª â€œæ ‡å‡†â€ æ„é€ æ–¹æ³•ï¼š</p>
<ol>
<li><code>void</code> ï¼ˆæ— å‚æ•°ï¼‰æ„é€ æ–¹æ³•ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªç©ºçš„æœ‰åº  <code>Map</code> ï¼ŒæŒ‰ç…§é”®çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºã€‚</li>
<li>å¸¦æœ‰ä¸€ä¸ª  <code>Comparator</code>  ç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªç©ºçš„æœ‰åº  <code>Map</code> ï¼Œæ ¹æ®æŒ‡å®šçš„æ¯”è¾ƒå™¨è¿›è¡Œæ’åºã€‚</li>
<li>å¸¦æœ‰ä¸€ä¸ª  <code>Map</code>  ç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„æœ‰åº  <code>Map</code> ï¼Œå…¶é”® - å€¼æ˜ å°„å…³ç³»ä¸å‚æ•°ç›¸åŒï¼ŒæŒ‰ç…§é”®çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºã€‚</li>
<li>å¸¦æœ‰ä¸€ä¸ª  <code>SortedMap</code>  ç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„æœ‰åº  <code>Map</code> ï¼Œå…¶é”® - å€¼æ˜ å°„å…³ç³»å’Œæ’åºæ–¹æ³•ä¸è¾“å…¥çš„æœ‰åº Map ç›¸åŒã€‚æ— æ³•ä¿è¯å¼ºåˆ¶å®æ–½æ­¤å»ºè®®ï¼Œå› ä¸ºæ¥å£ä¸èƒ½åŒ…å«æ„é€ æ–¹æ³•ã€‚</li>
</ol>
<h3 id="-402"><a class="markdownIt-Anchor" href="#-402">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-6-navigablemap-%E6%8E%A5%E5%8F%A3">#</a>1.6. NavigableMap æ¥å£</h3>
<p><code>NavigableMap</code>  çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">public interface NavigableMap&lt;K,V> extends SortedMap&lt;K,V> &#123; &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>NavigableMap</code>  ç»§æ‰¿äº†  <code>SortedMap</code>  ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„æŸ¥æ‰¾æ–¹æ³•ã€‚</p>
<p>NavigableMap åˆ†åˆ«æä¾›äº†è·å– â€œé”®â€ã€â€œé”® - å€¼å¯¹â€ã€â€œé”®é›†â€ã€â€œé”® - å€¼å¯¹é›†â€ çš„ç›¸å…³æ–¹æ³•ã€‚</p>
<p><code>NavigableMap</code>  æä¾›çš„åŠŸèƒ½å¯ä»¥åˆ†ä¸º 4 ç±»ï¼š</p>
<ul>
<li>
<p>è·å–é”® - å€¼å¯¹</p>
<ul>
<li><code>lowerEntry</code> ã€ <code>floorEntry</code> ã€ <code>ceilingEntry</code>  å’Œ  <code>higherEntry</code>  æ–¹æ³•ï¼Œå®ƒä»¬åˆ†åˆ«è¿”å›ä¸å°äºã€å°äºç­‰äºã€å¤§äºç­‰äºã€å¤§äºç»™å®šé”®çš„é”®å…³è”çš„ Map.Entry å¯¹è±¡ã€‚</li>
<li><code>firstEntry</code> ã€ <code>pollFirstEntry</code> ã€ <code>lastEntry</code>  å’Œ  <code>pollLastEntry</code>  æ–¹æ³•ï¼Œå®ƒä»¬è¿”å›å’Œ / æˆ–ç§»é™¤æœ€å°å’Œæœ€å¤§çš„æ˜ å°„å…³ç³»ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œå¦åˆ™è¿”å› nullã€‚</li>
</ul>
</li>
<li>
<p>è·å–é”®</p>
<p>ã€‚è¿™ä¸ªå’Œç¬¬ 1 ç±»æ¯”è¾ƒç±»ä¼¼ã€‚</p>
<ul>
<li><code>lowerKey</code> ã€ <code>floorKey</code> ã€ <code>ceilingKey</code>  å’Œ  <code>higherKey</code>  æ–¹æ³•ï¼Œå®ƒä»¬åˆ†åˆ«è¿”å›ä¸å°äºã€å°äºç­‰äºã€å¤§äºç­‰äºã€å¤§äºç»™å®šé”®çš„é”®ã€‚</li>
</ul>
</li>
<li>
<p>è·å–é”®çš„é›†åˆ</p>
<ul>
<li><code>navigableKeySet</code> ã€ <code>descendingKeySet</code>  åˆ†åˆ«è·å–æ­£åº / ååºçš„é”®é›†ã€‚</li>
</ul>
</li>
<li>
<p><strong>è·å–é”® - å€¼å¯¹çš„å­é›†</strong></p>
</li>
</ul>
<h3 id="-403"><a class="markdownIt-Anchor" href="#-403">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_1-7-dictionary-%E6%8A%BD%E8%B1%A1%E7%B1%BB">#</a>1.7. Dictionary æŠ½è±¡ç±»</h3>
<p><code>Dictionary</code>  çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Dictionary</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>Dictionary</code>  æ˜¯ JDK 1.0 å®šä¹‰çš„æ“ä½œé”®å€¼å¯¹çš„æŠ½è±¡ç±»ï¼Œå®ƒåŒ…æ‹¬äº†æ“ä½œé”®å€¼å¯¹çš„åŸºæœ¬æ–¹æ³•ã€‚</p>
<h2 id="-404"><a class="markdownIt-Anchor" href="#-404">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_2-hashmap-%E7%B1%BB">#</a>2. HashMap ç±»</h2>
<p><code>HashMap</code>  ç±»æ˜¯æœ€å¸¸ç”¨çš„  <code>Map</code> ã€‚</p>
<h3 id="-405"><a class="markdownIt-Anchor" href="#-405">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_2-1-hashmap-%E8%A6%81%E7%82%B9">#</a>2.1. HashMap è¦ç‚¹</h3>
<p>ä»  <code>HashMap</code>  çš„å‘½åï¼Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼š<strong> <code>HashMap</code>  ä»¥æ•£åˆ—æ–¹å¼å­˜å‚¨é”®å€¼å¯¹</strong>ã€‚</p>
<p><strong> <code>HashMap</code>  å…è®¸ä½¿ç”¨ç©ºå€¼å’Œç©ºé”®</strong>ã€‚ï¼ˆ <code>HashMap</code>  ç±»å¤§è‡´ç­‰åŒäº  <code>Hashtable</code> ï¼Œé™¤äº†å®ƒæ˜¯ä¸åŒæ­¥çš„å¹¶ä¸”å…è®¸ä¸ºç©ºå€¼ã€‚ï¼‰è¿™ä¸ªç±»ä¸ä¿åºï¼›ç‰¹åˆ«æ˜¯ï¼Œå®ƒçš„å…ƒç´ é¡ºåºå¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»å˜åŒ–ã€‚</p>
<p><strong> <code>HashMap</code>  æœ‰ä¸¤ä¸ªå½±å“å…¶æ€§èƒ½çš„å‚æ•°ï¼šåˆå§‹å®¹é‡å’Œè´Ÿè½½å› å­</strong>ã€‚</p>
<ul>
<li>å®¹é‡æ˜¯å“ˆå¸Œè¡¨ä¸­æ¡¶çš„æ•°é‡ï¼Œåˆå§‹å®¹é‡å°±æ˜¯å“ˆå¸Œè¡¨åˆ›å»ºæ—¶çš„å®¹é‡ã€‚</li>
<li>åŠ è½½å› å­æ˜¯æ•£åˆ—è¡¨åœ¨å…¶å®¹é‡è‡ªåŠ¨æ‰©å®¹ä¹‹å‰è¢«å…è®¸çš„æœ€å¤§é¥±å’Œé‡ã€‚å½“å“ˆå¸Œè¡¨ä¸­çš„ entry æ•°é‡è¶…è¿‡è´Ÿè½½å› å­å’Œå½“å‰å®¹é‡çš„ä¹˜ç§¯æ—¶ï¼Œæ•£åˆ—è¡¨å°±ä¼šè¢«é‡æ–°æ˜ å°„ï¼ˆå³é‡å»ºå†…éƒ¨æ•°æ®ç»“æ„ï¼‰ï¼Œä¸€èˆ¬æ•£åˆ—è¡¨å¤§çº¦æ˜¯å­˜å‚¨æ¡¶æ•°é‡çš„ä¸¤å€ã€‚</li>
</ul>
<p>é€šå¸¸ï¼Œé»˜è®¤åŠ è½½å› å­ï¼ˆ0.75ï¼‰åœ¨æ—¶é—´å’Œç©ºé—´æˆæœ¬ä¹‹é—´æä¾›äº†è‰¯å¥½çš„å¹³è¡¡ã€‚è¾ƒé«˜çš„å€¼ä¼šå‡å°‘ç©ºé—´å¼€é”€ï¼Œä½†ä¼šå¢åŠ æŸ¥æ‰¾æˆæœ¬ï¼ˆåæ˜ åœ¨å¤§éƒ¨åˆ†  <code>HashMap</code>  ç±»çš„æ“ä½œä¸­ï¼ŒåŒ…æ‹¬  <code>get</code>  å’Œ  <code>put</code> ï¼‰ã€‚åœ¨è®¾ç½®åˆå§‹å®¹é‡æ—¶ï¼Œåº”è€ƒè™‘æ˜ å°„ä¸­çš„æ¡ç›®æ•°é‡åŠå…¶è´Ÿè½½å› å­ï¼Œä»¥å°½é‡å‡å°‘é‡æ–°è¿è¡Œæ“ä½œçš„æ¬¡æ•°ã€‚å¦‚æœåˆå§‹å®¹é‡å¤§äºæœ€å¤§å…¥å£æ•°é™¤ä»¥è´Ÿè½½å› å­ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿé‡æ–°åˆ·æ–°æ“ä½œã€‚</p>
<p>å¦‚æœè®¸å¤šæ˜ å°„è¦å­˜å‚¨åœ¨  <code>HashMap</code>  å®ä¾‹ä¸­ï¼Œä½¿ç”¨è¶³å¤Ÿå¤§çš„å®¹é‡åˆ›å»ºæ˜ å°„å°†å…è®¸æ˜ å°„å­˜å‚¨çš„æ•ˆç‡é«˜äºæ ¹æ®éœ€è¦æ‰§è¡Œè‡ªåŠ¨é‡æ–°æ•£åˆ—ä»¥å¢é•¿è¡¨ã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨å¤šä¸ªå…·æœ‰ç›¸åŒ  <code>hashCode()</code>  çš„å¯†é’¥æ˜¯é™ä½ä»»ä½•æ•£åˆ—è¡¨æ€§èƒ½çš„ä¸€ä¸ªå¯é æ–¹æ³•ã€‚ä¸ºäº†æ”¹å–„å½±å“ï¼Œå½“é”®æ˜¯  <code>Comparable</code>  æ—¶ï¼Œè¯¥ç±»å¯ä»¥ä½¿ç”¨é”®ä¹‹é—´çš„æ¯”è¾ƒé¡ºåºæ¥å¸®åŠ©æ–­å¼€å…³ç³»ã€‚</p>
<p><code>HashMap</code>  ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<h3 id="-406"><a class="markdownIt-Anchor" href="#-406">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_2-2-hashmap-%E5%8E%9F%E7%90%86">#</a>2.2. HashMap åŸç†</h3>
<h4 id="-407"><a class="markdownIt-Anchor" href="#-407">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#hashmap-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">#</a>HashMap æ•°æ®ç»“æ„</h4>
<p><code>HashMap</code>  çš„æ ¸å¿ƒå­—æ®µï¼š</p>
<ul>
<li><code>table</code>  -  <code>HashMap</code>  ä½¿ç”¨ä¸€ä¸ª  <code>Node&lt;K,V&gt;[]</code>  ç±»å‹çš„æ•°ç»„  <code>table</code>  æ¥å‚¨å­˜å…ƒç´ ã€‚</li>
<li><code>size</code>  - åˆå§‹å®¹é‡ã€‚ åˆå§‹ä¸º 16ï¼Œæ¯æ¬¡å®¹é‡ä¸å¤Ÿè‡ªåŠ¨æ‰©å®¹</li>
<li><code>loadFactor</code>  - è´Ÿè½½å› å­ã€‚è‡ªåŠ¨æ‰©å®¹ä¹‹å‰è¢«å…è®¸çš„æœ€å¤§é¥±å’Œé‡ï¼Œé»˜è®¤ 0.75ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// è¯¥è¡¨åœ¨åˆæ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ï¼Œå¹¶æ ¹æ®éœ€è¦è°ƒæ•´å¤§å°ã€‚åˆ†é…æ—¶ï¼Œé•¿åº¦æ€»æ˜¯2çš„å¹‚ã€‚</span>
    <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>
    <span class="token comment">// ä¿å­˜ç¼“å­˜çš„ entrySet()ã€‚è¯·æ³¨æ„ï¼ŒAbstractMap å­—æ®µç”¨äº keySet() å’Œ values()ã€‚</span>
    <span class="token keyword">transient</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span><span class="token punctuation">></span></span> entrySet<span class="token punctuation">;</span>
    <span class="token comment">// map ä¸­çš„é”®å€¼å¯¹æ•°</span>
    <span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>
    <span class="token comment">// è¿™ä¸ªHashMapè¢«ç»“æ„ä¿®æ”¹çš„æ¬¡æ•°ç»“æ„ä¿®æ”¹æ˜¯é‚£äº›æ”¹å˜HashMapä¸­çš„æ˜ å°„æ•°é‡æˆ–è€…ä¿®æ”¹å…¶å†…éƒ¨ç»“æ„ï¼ˆä¾‹å¦‚ï¼Œé‡æ–°æ•£åˆ—ï¼‰çš„ä¿®æ”¹ã€‚</span>
    <span class="token keyword">transient</span> <span class="token keyword">int</span> modCount<span class="token punctuation">;</span>
    <span class="token comment">// ä¸‹ä¸€ä¸ªè°ƒæ•´å¤§å°çš„å€¼ï¼ˆå®¹é‡*åŠ è½½å› å­ï¼‰ã€‚</span>
    <span class="token keyword">int</span> threshold<span class="token punctuation">;</span>
    <span class="token comment">// æ•£åˆ—è¡¨çš„åŠ è½½å› å­</span>
    <span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-408"><a class="markdownIt-Anchor" href="#-408">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#hashmap-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">#</a>HashMap æ„é€ æ–¹æ³•</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤åŠ è½½å› å­0.75</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é»˜è®¤åŠ è½½å› å­0.75ï¼›ä»¥ initialCapacity åˆå§‹åŒ–å®¹é‡</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»¥ initialCapacity åˆå§‹åŒ–å®¹é‡ï¼›ä»¥ loadFactor åˆå§‹åŒ–åŠ è½½å› å­</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> m<span class="token punctuation">)</span> <span class="token comment">// é»˜è®¤åŠ è½½å› å­0.75</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-409"><a class="markdownIt-Anchor" href="#-409">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#put-%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0">#</a>put æ–¹æ³•çš„å®ç°</h4>
<p>put æ–¹æ³•å¤§è‡´çš„æ€è·¯ä¸ºï¼š</p>
<ul>
<li>å¯¹ key çš„  <code>hashCode()</code>  åš hash è®¡ç®—ï¼Œç„¶åæ ¹æ® hash å€¼å†è®¡ç®— Node çš„å­˜å‚¨ä½ç½®ï¼›</li>
<li>å¦‚æœæ²¡æœ‰å“ˆå¸Œç¢°æ’ï¼Œç›´æ¥æ”¾åˆ°æ¡¶é‡Œï¼›å¦‚æœæœ‰å“ˆå¸Œç¢°æ’ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜åœ¨æ¡¶åã€‚</li>
<li>å¦‚æœå“ˆå¸Œç¢°æ’å¯¼è‡´é“¾è¡¨è¿‡é•¿ (å¤§äºç­‰äº  <code>TREEIFY_THRESHOLD</code> ï¼Œæ•°å€¼ä¸º 8)ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼›</li>
<li>å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢æ—§å€¼</li>
<li>æ¡¶æ•°é‡è¶…è¿‡å®¹é‡ * è´Ÿè½½å› å­ï¼ˆå³ load factor * current capacityï¼‰ï¼ŒHashMap è°ƒç”¨  <code>resize</code>  è‡ªåŠ¨æ‰©å®¹ä¸€å€</li>
</ul>
<p>å…·ä½“ä»£ç çš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// hashcode æ— ç¬¦å·ä½ç§» 16 ä½</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> h<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
                   <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    <span class="token comment">// tab ä¸ºç©ºåˆ™åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token comment">// è®¡ç®— indexï¼Œå¹¶å¯¹ null åšå¤„ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
        <span class="token comment">// èŠ‚ç‚¹å­˜åœ¨</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token comment">// è¯¥é“¾ä¸ºæ ‘</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¯¥é“¾ä¸ºé“¾è¡¨</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> TREEIFY_THRESHOLD <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>
                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                p <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// å†™å…¥</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// existing mapping for key</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸ºä»€ä¹ˆè®¡ç®— hash ä½¿ç”¨ hashcode æ— ç¬¦å·ä½ç§» 16 ä½ã€‚</p>
<p>å‡è®¾è¦æ·»åŠ ä¸¤ä¸ªå¯¹è±¡ a å’Œ bï¼Œå¦‚æœæ•°ç»„é•¿åº¦æ˜¯ 16ï¼Œè¿™æ—¶å¯¹è±¡ a å’Œ b é€šè¿‡å…¬å¼ (n - 1) &amp; hash è¿ç®—ï¼Œä¹Ÿå°±æ˜¯ (16-1)ï¼†a.hashCode å’Œ (16-1)ï¼†b.hashCodeï¼Œ15 çš„äºŒè¿›åˆ¶ä¸º 0000000000000000000000000001111ï¼Œå‡è®¾å¯¹è±¡ A çš„ hashCode ä¸º 1000010001110001000001111000000ï¼Œå¯¹è±¡ B çš„ hashCode ä¸º 0111011100111000101000010100000ï¼Œä½ ä¼šå‘ç°ä¸Šè¿°ä¸è¿ç®—ç»“æœéƒ½æ˜¯ 0ã€‚è¿™æ ·çš„å“ˆå¸Œç»“æœå°±å¤ªè®©äººå¤±æœ›äº†ï¼Œå¾ˆæ˜æ˜¾ä¸æ˜¯ä¸€ä¸ªå¥½çš„å“ˆå¸Œç®—æ³•ã€‚</p>
<p>ä½†å¦‚æœæˆ‘ä»¬å°† hashCode å€¼å³ç§» 16 ä½ï¼ˆh &gt;&gt;&gt; 16 ä»£è¡¨æ— ç¬¦å·å³ç§» 16 ä½ï¼‰ï¼Œä¹Ÿå°±æ˜¯å– int ç±»å‹çš„ä¸€åŠï¼Œåˆšå¥½å¯ä»¥å°†è¯¥äºŒè¿›åˆ¶æ•°å¯¹åŠåˆ‡å¼€ï¼Œå¹¶ä¸”ä½¿ç”¨ä½å¼‚æˆ–è¿ç®—ï¼ˆå¦‚æœä¸¤ä¸ªæ•°å¯¹åº”çš„ä½ç½®ç›¸åï¼Œåˆ™ç»“æœä¸º 1ï¼Œåä¹‹ä¸º 0ï¼‰ï¼Œè¿™æ ·çš„è¯ï¼Œå°±èƒ½é¿å…ä¸Šé¢çš„æƒ…å†µå‘ç”Ÿã€‚è¿™å°±æ˜¯ hash () æ–¹æ³•çš„å…·ä½“å®ç°æ–¹å¼ã€‚<strong>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å°½é‡æ‰“ä¹± hashCode çœŸæ­£å‚ä¸è¿ç®—çš„ä½ 16 ä½ã€‚</strong></p>
<h4 id="-410"><a class="markdownIt-Anchor" href="#-410">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#get-%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0">#</a>get æ–¹æ³•çš„å®ç°</h4>
<p>åœ¨ç†è§£äº† put ä¹‹åï¼Œget å°±å¾ˆç®€å•äº†ã€‚å¤§è‡´æ€è·¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¯¹ key çš„ hashCode () åš hash è®¡ç®—ï¼Œç„¶åæ ¹æ® hash å€¼å†è®¡ç®—æ¡¶çš„ index</li>
<li>å¦‚æœæ¡¶ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å‘½ä¸­ï¼Œç›´æ¥è¿”å›ï¼›</li>
<li>å¦‚æœæœ‰å†²çªï¼Œåˆ™é€šè¿‡  <code>key.equals(k)</code>  å»æŸ¥æ‰¾å¯¹åº”çš„ entry
<ul>
<li>è‹¥ä¸ºæ ‘ï¼Œåˆ™åœ¨çº¢é»‘æ ‘ä¸­é€šè¿‡ key.equals (k) æŸ¥æ‰¾ï¼ŒO (logn)ï¼›</li>
<li>è‹¥ä¸ºé“¾è¡¨ï¼Œåˆ™åœ¨é“¾è¡¨ä¸­é€šè¿‡ key.equals (k) æŸ¥æ‰¾ï¼ŒO (n)ã€‚</li>
</ul>
</li>
</ul>
<p>å…·ä½“ä»£ç çš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> first<span class="token punctuation">,</span> e<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>first <span class="token operator">=</span> tab<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ç›´æ¥å‘½ä¸­</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token comment">// always check first node</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> first<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> first<span class="token punctuation">;</span>
        <span class="token comment">// æœªå‘½ä¸­</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> first<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// åœ¨æ ‘ä¸­ get</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>first<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTreeNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// åœ¨é“¾è¡¨ä¸­ get</span>
            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-411"><a class="markdownIt-Anchor" href="#-411">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#hash-%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0">#</a>hash æ–¹æ³•çš„å®ç°</h4>
<p>HashMap <strong>è®¡ç®—æ¡¶ä¸‹æ ‡ï¼ˆindexï¼‰å…¬å¼ï¼š <code>key.hashCode() ^ (h &gt;&gt;&gt; 16)</code> </strong>ã€‚</p>
<p>ä¸‹é¢é’ˆå¯¹è¿™ä¸ªå…¬å¼æ¥è¯¦ç»†è®²è§£ã€‚</p>
<p>åœ¨  <code>get</code>  å’Œ  <code>put</code>  çš„è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—ä¸‹æ ‡æ—¶ï¼Œå…ˆå¯¹  <code>hashCode</code>  è¿›è¡Œ  <code>hash</code>  æ“ä½œï¼Œç„¶åå†é€šè¿‡  <code>hash</code>  å€¼è¿›ä¸€æ­¥è®¡ç®—ä¸‹æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/container/HashMap-hash.png" alt="img"></p>
<p>åœ¨å¯¹  <code>hashCode()</code>  è®¡ç®— hash æ—¶å…·ä½“å®ç°æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> h<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•å¤§æ¦‚çš„ä½œç”¨å°±æ˜¯ï¼šé«˜ 16bit ä¸å˜ï¼Œä½ 16bit å’Œé«˜ 16bit åšäº†ä¸€ä¸ªå¼‚æˆ–ã€‚</p>
<p>åœ¨è®¾è®¡ hash æ–¹æ³•æ—¶ï¼Œå› ä¸ºç›®å‰çš„ table é•¿åº¦ n ä¸º 2 çš„å¹‚ï¼Œè€Œè®¡ç®—ä¸‹æ ‡çš„æ—¶å€™ï¼Œæ˜¯è¿™æ ·å®ç°çš„ (ä½¿ç”¨  <code>&amp;</code>  ä½æ“ä½œï¼Œè€Œé  <code>%</code>  æ±‚ä½™)ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è®¾è®¡è€…è®¤ä¸ºè¿™æ–¹æ³•å¾ˆå®¹æ˜“å‘ç”Ÿç¢°æ’ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼Œåœ¨ n - 1 ä¸º 15 (0x1111) æ—¶ï¼Œå…¶å®æ•£åˆ—çœŸæ­£ç”Ÿæ•ˆçš„åªæ˜¯ä½ 4bit çš„æœ‰æ•ˆä½ï¼Œå½“ç„¶å®¹æ˜“ç¢°æ’äº†ã€‚</p>
<p>å› æ­¤ï¼Œè®¾è®¡è€…æƒ³äº†ä¸€ä¸ªé¡¾å…¨å¤§å±€çš„æ–¹æ³• (ç»¼åˆè€ƒè™‘äº†é€Ÿåº¦ã€ä½œç”¨ã€è´¨é‡)ï¼Œå°±æ˜¯æŠŠé«˜ 16bit å’Œä½ 16bit å¼‚æˆ–äº†ä¸€ä¸‹ã€‚è®¾è®¡è€…è¿˜è§£é‡Šåˆ°å› ä¸ºç°åœ¨å¤§å¤šæ•°çš„ hashCode çš„åˆ†å¸ƒå·²ç»å¾ˆä¸é”™äº†ï¼Œå°±ç®—æ˜¯å‘ç”Ÿäº†ç¢°æ’ä¹Ÿç”¨ O (logn) çš„ tree å»åšäº†ã€‚ä»…ä»…å¼‚æˆ–ä¸€ä¸‹ï¼Œæ—¢å‡å°‘äº†ç³»ç»Ÿçš„å¼€é”€ï¼Œä¹Ÿä¸ä¼šé€ æˆçš„å› ä¸ºé«˜ä½æ²¡æœ‰å‚ä¸ä¸‹æ ‡çš„è®¡ç®— (table é•¿åº¦æ¯”è¾ƒå°æ—¶)ï¼Œä»è€Œå¼•èµ·çš„ç¢°æ’ã€‚</p>
<p>å¦‚æœè¿˜æ˜¯äº§ç”Ÿäº†é¢‘ç¹çš„ç¢°æ’ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿä½œè€…æ³¨é‡Šè¯´ï¼Œä»–ä»¬ä½¿ç”¨æ ‘æ¥å¤„ç†é¢‘ç¹çš„ç¢°æ’ (we use trees to handle large sets of collisions in bins)ï¼Œåœ¨ <a target="_blank" rel="noopener" href="http://openjdk.java.net/jeps/180">JEP-180 (opens new window)</a> ä¸­ï¼Œæè¿°äº†è¿™ä¸ªé—®é¢˜ï¼š</p>
<blockquote>
<p>Improve the performance of java.util.HashMap under high hash-collision conditions by using balanced trees rather than linked lists to store map entries. Implement the same improvement in the LinkedHashMap class.</p>
</blockquote>
<p>ä¹‹å‰å·²ç»æè¿‡ï¼Œåœ¨è·å– HashMap çš„å…ƒç´ æ—¶ï¼ŒåŸºæœ¬åˆ†ä¸¤æ­¥ï¼š</p>
<ol>
<li>é¦–å…ˆæ ¹æ® hashCode () åš hashï¼Œç„¶åç¡®å®š bucket çš„ indexï¼›</li>
<li>å¦‚æœ bucket çš„èŠ‚ç‚¹çš„ key ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œåˆ™é€šè¿‡ keys.equals () åœ¨é“¾ä¸­æ‰¾ã€‚</li>
</ol>
<p>åœ¨ JDK8 ä¹‹å‰çš„å®ç°ä¸­æ˜¯ç”¨é“¾è¡¨è§£å†³å†²çªçš„ï¼Œåœ¨äº§ç”Ÿç¢°æ’çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œ get æ—¶ï¼Œä¸¤æ­¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O (1)+O (n)ã€‚å› æ­¤ï¼Œå½“ç¢°æ’å¾ˆå‰å®³çš„æ—¶å€™ n å¾ˆå¤§ï¼ŒO (n) çš„é€Ÿåº¦æ˜¾ç„¶æ˜¯å½±å“é€Ÿåº¦çš„ã€‚</p>
<p>å› æ­¤åœ¨ JDK8 ä¸­ï¼Œåˆ©ç”¨çº¢é»‘æ ‘æ›¿æ¢é“¾è¡¨ï¼Œè¿™æ ·å¤æ‚åº¦å°±å˜æˆäº† O (1)+O (logn) äº†ï¼Œè¿™æ ·åœ¨ n å¾ˆå¤§çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ¯”è¾ƒç†æƒ³çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ JDK8ï¼šHashMap çš„æ€§èƒ½æå‡ä¸€æ–‡ä¸­æœ‰æ€§èƒ½æµ‹è¯•çš„ç»“æœã€‚</p>
<h4 id="-412"><a class="markdownIt-Anchor" href="#-412">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#resize-%E7%9A%84%E5%AE%9E%E7%8E%B0">#</a>resize çš„å®ç°</h4>
<p>å½“  <code>put</code>  æ—¶ï¼Œå¦‚æœå‘ç°ç›®å‰çš„ bucket å ç”¨ç¨‹åº¦å·²ç»è¶…è¿‡äº† Load Factor æ‰€å¸Œæœ›çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿ resizeã€‚åœ¨ resize çš„è¿‡ç¨‹ï¼Œç®€å•çš„è¯´å°±æ˜¯æŠŠ bucket æ‰©å……ä¸º 2 å€ï¼Œä¹‹åé‡æ–°è®¡ç®— indexï¼ŒæŠŠèŠ‚ç‚¹å†æ”¾åˆ°æ–°çš„ bucket ä¸­ã€‚</p>
<p>å½“è¶…è¿‡é™åˆ¶çš„æ—¶å€™ä¼š resizeï¼Œç„¶è€Œåˆå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ 2 æ¬¡å¹‚çš„æ‰©å±• (æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥ 2 å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨ 2 æ¬¡å¹‚çš„ä½ç½®ã€‚</p>
<p>æ€ä¹ˆç†è§£å‘¢ï¼Ÿä¾‹å¦‚æˆ‘ä»¬ä» 16 æ‰©å±•ä¸º 32 æ—¶ï¼Œå…·ä½“çš„å˜åŒ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/HashMap-resize-01.png" alt="img"></p>
<p>å› æ­¤å…ƒç´ åœ¨é‡æ–°è®¡ç®— hash ä¹‹åï¼Œå› ä¸º n å˜ä¸º 2 å€ï¼Œé‚£ä¹ˆ n-1 çš„ mask èŒƒå›´åœ¨é«˜ä½å¤š 1bit (çº¢è‰²)ï¼Œå› æ­¤æ–°çš„ index å°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/container/HashMap-resize-02.png" alt="img"></p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å…… HashMap çš„æ—¶å€™ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®— hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„ hash å€¼æ–°å¢çš„é‚£ä¸ª bit æ˜¯ 1 è¿˜æ˜¯ 0 å°±å¥½äº†ï¼Œæ˜¯ 0 çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯ 1 çš„è¯ç´¢å¼•å˜æˆ â€œåŸç´¢å¼• + oldCapâ€ã€‚å¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º 16 æ‰©å……ä¸º 32 çš„ resize ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/HashMap-resize-03.png" alt="img"></p>
<p>è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®— hash å€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„ 1bit æ˜¯ 0 è¿˜æ˜¯ 1 å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤ resize çš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„ bucket äº†ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span>
    <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å……äº†ï¼Œå°±åªå¥½éšä½ ç¢°æ’å»å§</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">>=</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// æ²¡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±æ‰©å……ä¸ºåŸæ¥çš„ 2 å€</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;&amp;</span>
                    oldCap <span class="token operator">>=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span>
            newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// double threshold</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// initial capacity was placed in threshold</span>
        newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>               <span class="token comment">// zero initial threshold signifies using defaults</span>
        newCap <span class="token operator">=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DEFAULT_LOAD_FACTOR <span class="token operator">*</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// è®¡ç®—æ–°çš„ resize ä¸Šé™</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>MAXIMUM_CAPACITY <span class="token operator">?</span>
                    <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// æŠŠæ¯ä¸ª bucket éƒ½ç§»åŠ¨åˆ°æ–°çš„ buckets ä¸­</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// preserve order</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>
                    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
                        next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                        <span class="token comment">// åŸç´¢å¼•</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                loHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            loTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token comment">// åŸç´¢å¼•+oldCap</span>
                        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                                hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>
                                hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token comment">// åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> newTab<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-413"><a class="markdownIt-Anchor" href="#-413">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_3-linkedhashmap-%E7%B1%BB">#</a>3. LinkedHashMap ç±»</h2>
<h3 id="-414"><a class="markdownIt-Anchor" href="#-414">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_3-1-linkedhashmap-%E8%A6%81%E7%82%B9">#</a>3.1. LinkedHashMap è¦ç‚¹</h3>
<p><strong> <code>LinkedHashMap</code>  é€šè¿‡ç»´æŠ¤ä¸€ä¸ªä¿å­˜æ‰€æœ‰æ¡ç›®ï¼ˆEntryï¼‰çš„åŒå‘é“¾è¡¨ï¼Œä¿è¯äº†å…ƒç´ è¿­ä»£çš„é¡ºåºï¼ˆå³æ’å…¥é¡ºåºï¼‰</strong>ã€‚</p>
<table>
<thead>
<tr>
<th>å…³æ³¨ç‚¹</th>
<th>ç»“è®º</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ˜¯å¦å…è®¸é”®å€¼å¯¹ä¸º null</td>
<td>Key å’Œ Value éƒ½å…è®¸ null</td>
</tr>
<tr>
<td>æ˜¯å¦å…è®¸é‡å¤æ•°æ®</td>
<td>Key é‡å¤ä¼šè¦†ç›–ã€Value å…è®¸é‡å¤</td>
</tr>
<tr>
<td>æ˜¯å¦æœ‰åº</td>
<td>æŒ‰ç…§å…ƒç´ æ’å…¥é¡ºåºå­˜å‚¨</td>
</tr>
<tr>
<td>æ˜¯å¦çº¿ç¨‹å®‰å…¨</td>
<td>éçº¿ç¨‹å®‰å…¨</td>
</tr>
</tbody>
</table>
<h3 id="-415"><a class="markdownIt-Anchor" href="#-415">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_3-2-linkedhashmap-%E8%A6%81%E7%82%B9">#</a>3.2. LinkedHashMap è¦ç‚¹</h3>
<h4 id="-416"><a class="markdownIt-Anchor" href="#-416">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#linkedhashmap-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">#</a>LinkedHashMap æ•°æ®ç»“æ„</h4>
<p><strong> <code>LinkedHashMap</code>  é€šè¿‡ç»´æŠ¤ä¸€å¯¹  <code>LinkedHashMap.Entry&lt;K,V&gt;</code>  ç±»å‹çš„å¤´å°¾æŒ‡é’ˆï¼Œä»¥åŒé“¾è¡¨å½¢å¼ï¼Œä¿å­˜æ‰€æœ‰æ•°æ®</strong>ã€‚</p>
<p>å­¦ä¹ è¿‡æ•°æ®ç»“æ„çš„åŒé“¾è¡¨ï¼Œå°±èƒ½ç†è§£å…¶å…ƒç´ å­˜å‚¨ä»¥åŠè®¿é—®å¿…ç„¶æ˜¯æœ‰åºçš„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// åŒé“¾è¡¨çš„å¤´æŒ‡é’ˆ</span>
    <span class="token keyword">transient</span> <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> head<span class="token punctuation">;</span>
    <span class="token comment">// åŒé“¾è¡¨çš„å°¾æŒ‡é’ˆ</span>
    <span class="token keyword">transient</span> <span class="token class-name">LinkedHashMap<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> tail<span class="token punctuation">;</span>
    <span class="token comment">// è¿­ä»£æ’åºæ–¹æ³•ï¼štrue è¡¨ç¤ºè®¿é—®é¡ºåºï¼›false è¡¨ç¤ºæ’å…¥é¡ºåº</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> accessOrder<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>LinkedHashMap</code>  ç»§æ‰¿äº†  <code>HashMap</code>  çš„  <code>put</code>  æ–¹æ³•ï¼Œæœ¬èº«æ²¡æœ‰å®ç°  <code>put</code>  æ–¹æ³•ã€‚</p>
<h2 id="-417"><a class="markdownIt-Anchor" href="#-417">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_4-treemap-%E7%B1%BB">#</a>4. TreeMap ç±»</h2>
<h3 id="-418"><a class="markdownIt-Anchor" href="#-418">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_4-1-treemap-%E8%A6%81%E7%82%B9">#</a>4.1. TreeMap è¦ç‚¹</h3>
<p><code>TreeMap</code>  åŸºäºçº¢é»‘æ ‘å®ç°ã€‚</p>
<p><code>TreeMap</code>  æ˜¯æœ‰åºçš„ã€‚å®ƒçš„æ’åºè§„åˆ™æ˜¯ï¼šæ ¹æ® map ä¸­çš„ key çš„è‡ªç„¶è¯­ä¹‰é¡ºåºæˆ–æä¾›çš„æ¯”è¾ƒå™¨ï¼ˆ <code>Comparator</code> ï¼‰çš„è‡ªå®šä¹‰æ¯”è¾ƒé¡ºåºã€‚</p>
<p>TreeMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<h3 id="-419"><a class="markdownIt-Anchor" href="#-419">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_4-2-treemap-%E5%8E%9F%E7%90%86">#</a>4.2. TreeMap åŸç†</h3>
<h4 id="-420"><a class="markdownIt-Anchor" href="#-420">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#put-%E6%96%B9%E6%B3%95">#</a>put æ–¹æ³•</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> t <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœæ ¹èŠ‚ç‚¹ä¸º nullï¼Œæ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">compare</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// type (and possibly null) check</span>

        root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        size <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        modCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">int</span> cmp<span class="token punctuation">;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> parent<span class="token punctuation">;</span>
    <span class="token comment">// split comparator and comparable paths</span>
    <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> cpr <span class="token operator">=</span> comparator<span class="token punctuation">;</span>
    <span class="token comment">// æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­©å­èŠ‚ç‚¹çš„å€¼å°äºå®ƒï¼›å³å­©å­èŠ‚ç‚¹çš„å€¼å¤§äºå®ƒ</span>
    <span class="token comment">// å¦‚æœæœ‰æ¯”è¾ƒå™¨ï¼Œä½¿ç”¨æ¯”è¾ƒå™¨è¿›è¡Œæ¯”è¾ƒ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cpr <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            parent <span class="token operator">=</span> t<span class="token punctuation">;</span>
            cmp <span class="token operator">=</span> cpr<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                t <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
                t <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// æ²¡æœ‰æ¯”è¾ƒå™¨ï¼Œä½¿ç”¨ key çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ¯”è¾ƒ</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
            <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> k <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> key<span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
            parent <span class="token operator">=</span> t<span class="token punctuation">;</span>
            cmp <span class="token operator">=</span> k<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                t <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
                t <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                <span class="token keyword">return</span> t<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// é€šè¿‡ä¸Šé¢çš„éå†æœªæ‰¾åˆ° key å€¼ï¼Œåˆ™æ–°æ’å…¥èŠ‚ç‚¹</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        parent<span class="token punctuation">.</span>left <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        parent<span class="token punctuation">.</span>right <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token comment">// æ’å…¥åï¼Œä¸ºäº†ç»´æŒçº¢é»‘æ ‘çš„å¹³è¡¡éœ€è¦è°ƒæ•´</span>
    <span class="token function">fixAfterInsertion</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size<span class="token operator">++</span><span class="token punctuation">;</span>
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-421"><a class="markdownIt-Anchor" href="#-421">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#get-%E6%96%B9%E6%B3%95">#</a>get æ–¹æ³•</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token function">getEntry</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>p<span class="token operator">==</span><span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> p<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Offload comparator-based version for sake of performance</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>comparator <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">getEntryUsingComparator</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
        <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> k <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">K</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> key<span class="token punctuation">;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token comment">// æŒ‰ç…§äºŒå‰æ ‘æœç´¢çš„æ–¹å¼è¿›è¡Œæœç´¢ï¼Œæœåˆ°è¿”å›</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> cmp <span class="token operator">=</span> k<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-422"><a class="markdownIt-Anchor" href="#-422">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_4-3-remove-%E6%96%B9%E6%B3%95">#</a>4.3. remove æ–¹æ³•</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p <span class="token operator">=</span> <span class="token function">getEntry</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token class-name">V</span> oldValue <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token function">deleteEntry</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">deleteEntry</span><span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    size<span class="token operator">--</span><span class="token punctuation">;</span>

    <span class="token comment">// å¦‚æœå½“å‰èŠ‚ç‚¹æœ‰å·¦å³å­©å­èŠ‚ç‚¹ï¼Œä½¿ç”¨åç»§èŠ‚ç‚¹æ›¿æ¢è¦åˆ é™¤çš„èŠ‚ç‚¹</span>
    <span class="token comment">// If strictly internal, copy successor's element to p and then make p</span>
    <span class="token comment">// point to successor.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>right <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> s <span class="token operator">=</span> <span class="token function">successor</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>key <span class="token operator">=</span> s<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>value <span class="token operator">=</span> s<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        p <span class="token operator">=</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token comment">// p has 2 children</span>

    <span class="token comment">// Start fixup at replacement node, if it exists.</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> replacement <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> p<span class="token punctuation">.</span>left <span class="token operator">:</span> p<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>replacement <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// è¦åˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹</span>
        <span class="token comment">// Link replacement to parent</span>
        replacement<span class="token punctuation">.</span>parent <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            root <span class="token operator">=</span> replacement<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
            p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left  <span class="token operator">=</span> replacement<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
 <span class="token class-name">D</span><span class="token operator">:</span>\codes\zp\java\database\docs\redis\åˆ†å¸ƒå¼é”<span class="token punctuation">.</span>md           p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> replacement<span class="token punctuation">;</span>

        <span class="token comment">// Null out links so they are OK to use by fixAfterDeletion.</span>
        p<span class="token punctuation">.</span>left <span class="token operator">=</span> p<span class="token punctuation">.</span>right <span class="token operator">=</span> p<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token comment">// Fix replacement</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>color <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
            <span class="token function">fixAfterDeletion</span><span class="token punctuation">(</span>replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// return if we are the only node.</span>
        root <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">//  No children. Use self as phantom replacement and unlink.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>color <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
            <span class="token function">fixAfterDeletion</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
                p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
                p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            p<span class="token punctuation">.</span>parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-423"><a class="markdownIt-Anchor" href="#-423">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_4-4-treemap-%E7%A4%BA%E4%BE%8B">#</a>4.4. TreeMap ç¤ºä¾‹</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeMapDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chars <span class="token operator">=</span> <span class="token string">"A B C D E F G H I J K L M N O P Q R S T U V W X Y Z"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> treeMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chars<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            treeMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> chars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>treeMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> low <span class="token operator">=</span> treeMap<span class="token punctuation">.</span><span class="token function">firstKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> high <span class="token operator">=</span> treeMap<span class="token punctuation">.</span><span class="token function">lastKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>low<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>high<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> it <span class="token operator">=</span> treeMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> low <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> high <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>low<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>high<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>treeMap<span class="token punctuation">.</span><span class="token function">subMap</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span> high<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>treeMap<span class="token punctuation">.</span><span class="token function">headMap</span><span class="token punctuation">(</span>high<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>treeMap<span class="token punctuation">.</span><span class="token function">tailMap</span><span class="token punctuation">(</span>low<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-424"><a class="markdownIt-Anchor" href="#-424">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-map.html#_5-weakhashmap">#</a>5. WeakHashMap</h2>
<p>WeakHashMap çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeakHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>WeakHashMap ç»§æ‰¿äº† AbstractMapï¼Œå®ç°äº† Map æ¥å£ã€‚</p>
<p>å’Œ HashMap ä¸€æ ·ï¼ŒWeakHashMap ä¹Ÿæ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨ï¼Œå®ƒå­˜å‚¨çš„å†…å®¹ä¹Ÿæ˜¯é”®å€¼å¯¹ (key-value) æ˜ å°„ï¼Œè€Œä¸”é”®å’Œå€¼éƒ½å¯ä»¥æ˜¯ nullã€‚</p>
<p>ä¸è¿‡ WeakHashMap çš„é”®æ˜¯<strong>å¼±é”®</strong>ã€‚åœ¨ WeakHashMap ä¸­ï¼Œå½“æŸä¸ªé”®ä¸å†è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨ï¼Œä¼šè¢«ä» WeakHashMap ä¸­è¢«è‡ªåŠ¨ç§»é™¤ã€‚æ›´ç²¾ç¡®åœ°è¯´ï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„é”®ï¼Œå…¶æ˜ å°„çš„å­˜åœ¨å¹¶ä¸é˜»æ­¢åƒåœ¾å›æ”¶å™¨å¯¹è¯¥é”®çš„ä¸¢å¼ƒï¼Œè¿™å°±ä½¿è¯¥é”®æˆä¸ºå¯ç»ˆæ­¢çš„ï¼Œè¢«ç»ˆæ­¢ï¼Œç„¶åè¢«å›æ”¶ã€‚æŸä¸ªé”®è¢«ç»ˆæ­¢æ—¶ï¼Œå®ƒå¯¹åº”çš„é”®å€¼å¯¹ä¹Ÿå°±ä»æ˜ å°„ä¸­æœ‰æ•ˆåœ°ç§»é™¤äº†ã€‚</p>
<p>è¿™ä¸ª<strong>å¼±é”®</strong>çš„åŸç†å‘¢ï¼Ÿå¤§è‡´ä¸Šå°±æ˜¯ï¼Œé€šè¿‡ WeakReference å’Œ ReferenceQueue å®ç°çš„ã€‚</p>
<p>WeakHashMap çš„ key æ˜¯<strong>å¼±é”®</strong>ï¼Œå³æ˜¯ WeakReference ç±»å‹çš„ï¼›ReferenceQueue æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå®ƒä¼šä¿å­˜è¢« GC å›æ”¶çš„<strong>å¼±é”®</strong>ã€‚å®ç°æ­¥éª¤æ˜¯ï¼š</p>
<ol>
<li>æ–°å»º WeakHashMapï¼Œå°†<strong>é”®å€¼å¯¹</strong>æ·»åŠ åˆ° WeakHashMap ä¸­ã€‚å®é™…ä¸Šï¼ŒWeakHashMap æ˜¯é€šè¿‡æ•°ç»„ table ä¿å­˜ Entry (é”®å€¼å¯¹)ï¼›æ¯ä¸€ä¸ª Entry å®é™…ä¸Šæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œå³ Entry æ˜¯é”®å€¼å¯¹é“¾è¡¨ã€‚</li>
<li>å½“æŸ<strong>å¼±é”®</strong>ä¸å†è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨ï¼Œå¹¶è¢« GC å›æ”¶æ—¶ã€‚åœ¨ GC å›æ”¶è¯¥<strong>å¼±é”®</strong>æ—¶ï¼Œè¿™ä¸ª<strong>å¼±é”®</strong>ä¹ŸåŒæ—¶ä¼šè¢«æ·»åŠ åˆ° ReferenceQueue (queue) é˜Ÿåˆ—ä¸­ã€‚</li>
<li>å½“ä¸‹ä¸€æ¬¡æˆ‘ä»¬éœ€è¦æ“ä½œ WeakHashMap æ—¶ï¼Œä¼šå…ˆåŒæ­¥ table å’Œ queueã€‚table ä¸­ä¿å­˜äº†å…¨éƒ¨çš„é”®å€¼å¯¹ï¼Œè€Œ queue ä¸­ä¿å­˜è¢« GC å›æ”¶çš„é”®å€¼å¯¹ï¼›åŒæ­¥å®ƒä»¬ï¼Œå°±æ˜¯åˆ é™¤ table ä¸­è¢« GC å›æ”¶çš„é”®å€¼å¯¹ã€‚</li>
</ol>
<p>è¿™å°±æ˜¯<strong>å¼±é”®</strong>å¦‚ä½•è¢«è‡ªåŠ¨ä» WeakHashMap ä¸­åˆ é™¤çš„æ­¥éª¤äº†ã€‚</p>
<p>å’Œ HashMap ä¸€æ ·ï¼ŒWeakHashMap æ˜¯ä¸åŒæ­¥çš„ã€‚å¯ä»¥ä½¿ç”¨ Collections.synchronizedMap æ–¹æ³•æ¥æ„é€ åŒæ­¥çš„ WeakHashMapã€‚</p>
<hr>
<h1 id="java-å®¹å™¨ä¹‹-set"><a class="markdownIt-Anchor" href="#java-å®¹å™¨ä¹‹-set">#</a> Java å®¹å™¨ä¹‹ Set</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. Set ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#11-set-%E6%8E%A5%E5%8F%A3">1.1. Set æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#12-sortedset-%E6%8E%A5%E5%8F%A3">1.2. SortedSet æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#13-navigableset-%E6%8E%A5%E5%8F%A3">1.3. NavigableSet æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#14-abstractset-%E6%8A%BD%E8%B1%A1%E7%B1%BB">1.4. AbstractSet æŠ½è±¡ç±»</a></li>
</ul>
</li>
<li>\2. HashSet ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#21-hashset-%E8%A6%81%E7%82%B9">2.1. HashSet è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#22-hashset-%E5%8E%9F%E7%90%86">2.2. HashSet åŸç†</a></li>
</ul>
</li>
<li>\3. TreeSet ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#31-treeset-%E8%A6%81%E7%82%B9">3.1. TreeSet è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#32-treeset-%E6%BA%90%E7%A0%81">3.2. TreeSet æºç </a></li>
</ul>
</li>
<li>\4. LinkedHashSet ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#41-linkedhashset-%E8%A6%81%E7%82%B9">4.1. LinkedHashSet è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#42-linkedhashset-%E5%8E%9F%E7%90%86">4.2. LinkedHashSet åŸç†</a></li>
</ul>
</li>
<li>\5. EnumSet ç±»
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#51-enumset-%E8%A6%81%E7%82%B9">5.1. EnumSet è¦ç‚¹</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#6-%E8%A6%81%E7%82%B9%E6%80%BB%E7%BB%93">6. è¦ç‚¹æ€»ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-425"><a class="markdownIt-Anchor" href="#-425">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_1-set-%E7%AE%80%E4%BB%8B">#</a>1. Set ç®€ä»‹</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/Set-diagrams.png" alt="img"></p>
<p>Set å®¶æ—æˆå‘˜ç®€ä»‹ï¼š</p>
<ul>
<li><code>Set</code>  ç»§æ‰¿äº†  <code>Collection</code>  çš„æ¥å£ã€‚å®é™…ä¸Š  <code>Set</code>  å°±æ˜¯  <code>Collection</code> ï¼Œåªæ˜¯è¡Œä¸ºç•¥æœ‰ä¸åŒï¼š <code>Set</code>  é›†åˆä¸å…è®¸æœ‰é‡å¤å…ƒç´ ã€‚</li>
<li><code>SortedSet</code>  ç»§æ‰¿äº†  <code>Set</code>  çš„æ¥å£ã€‚ <code>SortedSet</code>  ä¸­çš„å†…å®¹æ˜¯æ’åºçš„å”¯ä¸€å€¼ï¼Œæ’åºçš„æ–¹æ³•æ˜¯é€šè¿‡æ¯”è¾ƒå™¨ (Comparator)ã€‚</li>
<li><code>NavigableSet</code>  ç»§æ‰¿äº†  <code>SortedSet</code>  çš„æ¥å£ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„æŸ¥æ‰¾æ–¹æ³•ï¼šå¦‚ &quot;è·å–å¤§äº / ç­‰äºæŸå€¼çš„å…ƒç´ &quot;ã€â€œè·å–å°äº / ç­‰äºæŸå€¼çš„å…ƒç´ â€ ç­‰ç­‰ã€‚</li>
<li><code>AbstractSet</code>  æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒç»§æ‰¿äº  <code>AbstractCollection</code> ï¼Œ <code>AbstractCollection</code>  å®ç°äº† Set ä¸­çš„ç»å¤§éƒ¨åˆ†æ–¹æ³•ï¼Œä¸ºå®ç°  <code>Set</code>  çš„å®ä¾‹ç±»æä¾›äº†ä¾¿åˆ©ã€‚</li>
<li><code>HashSet</code>  ç±»ä¾èµ–äº  <code>HashMap</code> ï¼Œå®ƒå®é™…ä¸Šæ˜¯é€šè¿‡  <code>HashMap</code>  å®ç°çš„ã€‚ <code>HashSet</code>  ä¸­çš„å…ƒç´ æ˜¯æ— åºçš„ã€æ•£åˆ—çš„ã€‚</li>
<li><code>TreeSet</code>  ç±»ä¾èµ–äº  <code>TreeMap</code> ï¼Œå®ƒå®é™…ä¸Šæ˜¯é€šè¿‡  <code>TreeMap</code>  å®ç°çš„ã€‚ <code>TreeSet</code>  ä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå®ƒæ˜¯æŒ‰è‡ªç„¶æ’åºæˆ–è€…ç”¨æˆ·æŒ‡å®šæ¯”è¾ƒå™¨æ’åºçš„ Setã€‚</li>
<li><code>LinkedHashSet</code>  æ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºçš„ Setã€‚</li>
<li><code>EnumSet</code>  æ˜¯åªèƒ½å­˜æ”¾ Emum æšä¸¾ç±»å‹çš„ Setã€‚</li>
</ul>
<h3 id="-426"><a class="markdownIt-Anchor" href="#-426">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_1-1-set-%E6%8E%A5%E5%8F%A3">#</a>1.1. Set æ¥å£</h3>
<p><code>Set</code>  ç»§æ‰¿äº†  <code>Collection</code>  çš„æ¥å£ã€‚å®é™…ä¸Šï¼Œ <code>Set</code>  å°±æ˜¯  <code>Collection</code> ï¼ŒäºŒè€…æä¾›çš„æ–¹æ³•å®Œå…¨ç›¸åŒã€‚</p>
<p><code>Set</code>  æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-427"><a class="markdownIt-Anchor" href="#-427">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_1-2-sortedset-%E6%8E%A5%E5%8F%A3">#</a>1.2. SortedSet æ¥å£</h3>
<p>ç»§æ‰¿äº†  <code>Set</code>  çš„æ¥å£ã€‚ <code>SortedSet</code>  ä¸­çš„å†…å®¹æ˜¯æ’åºçš„å”¯ä¸€å€¼ï¼Œæ’åºçš„æ–¹æ³•æ˜¯é€šè¿‡æ¯”è¾ƒå™¨ (Comparator)ã€‚</p>
<p><code>SortedSet</code>  æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SortedSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>SortedSet</code>  æ¥å£æ–°æ‰©å±•çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>comparator</code>  - è¿”å› Comparator</li>
<li><code>subSet</code>  - è¿”å›æŒ‡å®šåŒºé—´çš„å­é›†</li>
<li><code>headSet</code>  - è¿”å›å°äºæŒ‡å®šå…ƒç´ çš„å­é›†</li>
<li><code>tailSet</code>  - è¿”å›å¤§äºæŒ‡å®šå…ƒç´ çš„å­é›†</li>
<li><code>first</code>  - è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </li>
<li><code>last</code>  - è¿”å›æœ€åä¸€ä¸ªå…ƒç´ </li>
<li>spliterator</li>
</ul>
<h3 id="-428"><a class="markdownIt-Anchor" href="#-428">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_1-3-navigableset-%E6%8E%A5%E5%8F%A3">#</a>1.3. NavigableSet æ¥å£</h3>
<p><code>NavigableSet</code>  ç»§æ‰¿äº†  <code>SortedSet</code> ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„æŸ¥æ‰¾æ–¹æ³•ã€‚</p>
<p><code>NavigableSet</code>  æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">NavigableSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">SortedSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>NavigableSet</code>  æ¥å£æ–°æ‰©å±•çš„æ–¹æ³•ï¼š</p>
<ul>
<li>lower - è¿”å›å°äºæŒ‡å®šå€¼çš„å…ƒç´ ä¸­æœ€æ¥è¿‘çš„å…ƒç´ </li>
<li>higher - è¿”å›å¤§äºæŒ‡å®šå€¼çš„å…ƒç´ ä¸­æœ€æ¥è¿‘çš„å…ƒç´ </li>
<li>floor - è¿”å›å°äºæˆ–ç­‰äºæŒ‡å®šå€¼çš„å…ƒç´ ä¸­æœ€æ¥è¿‘çš„å…ƒç´ </li>
<li>ceiling - è¿”å›å¤§äºæˆ–ç­‰äºæŒ‡å®šå€¼çš„å…ƒç´ ä¸­æœ€æ¥è¿‘çš„å…ƒç´ </li>
<li>pollFirst - æ£€ç´¢å¹¶ç§»é™¤ç¬¬ä¸€ä¸ªï¼ˆæœ€å°çš„ï¼‰å…ƒç´ </li>
<li>pollLast - æ£€ç´¢å¹¶ç§»é™¤æœ€åä¸€ä¸ªï¼ˆæœ€å¤§çš„ï¼‰å…ƒç´ </li>
<li>descendingSet - è¿”å›ååºæ’åˆ—çš„ Set</li>
<li>descendingIterator - è¿”å›ååºæ’åˆ—çš„ Set çš„è¿­ä»£å™¨</li>
<li>subSet - è¿”å›æŒ‡å®šåŒºé—´çš„å­é›†</li>
<li>headSet - è¿”å›å°äºæŒ‡å®šå…ƒç´ çš„å­é›†</li>
<li>tailSet - è¿”å›å¤§äºæŒ‡å®šå…ƒç´ çš„å­é›†</li>
</ul>
<h3 id="-429"><a class="markdownIt-Anchor" href="#-429">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_1-4-abstractset-%E6%8A%BD%E8%B1%A1%E7%B1%BB">#</a>1.4. AbstractSet æŠ½è±¡ç±»</h3>
<p><code>AbstractSet</code>  ç±»æä¾›  <code>Set</code>  æ¥å£çš„æ ¸å¿ƒå®ç°ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å®ç°  <code>Set</code>  æ¥å£æ‰€éœ€çš„å·¥ä½œã€‚</p>
<p><code>AbstractSet</code>  æŠ½è±¡ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>äº‹å®ä¸Šï¼Œä¸»è¦çš„å®ç°å·²ç»åœ¨  <code>AbstractCollection</code>  ä¸­å®Œæˆã€‚</p>
<h2 id="-430"><a class="markdownIt-Anchor" href="#-430">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_2-hashset-%E7%B1%BB">#</a>2. HashSet ç±»</h2>
<p><code>HashSet</code>  ç±»ä¾èµ–äº  <code>HashMap</code> ï¼Œå®ƒå®é™…ä¸Šæ˜¯é€šè¿‡  <code>HashMap</code>  å®ç°çš„ã€‚ <code>HashSet</code>  ä¸­çš„å…ƒç´ æ˜¯æ— åºçš„ã€æ•£åˆ—çš„ã€‚</p>
<p><code>HashSet</code>  ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="-431"><a class="markdownIt-Anchor" href="#-431">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_2-1-hashset-%E8%A6%81%E7%82%B9">#</a>2.1. HashSet è¦ç‚¹</h3>
<ul>
<li><code>HashSet</code>  é€šè¿‡ç»§æ‰¿  <code>AbstractSet</code>  å®ç°äº†  <code>Set</code>  æ¥å£ä¸­çš„éª¨å¹²æ–¹æ³•ã€‚</li>
<li><code>HashSet</code>  å®ç°äº†  <code>Cloneable</code> ï¼Œæ‰€ä»¥æ”¯æŒå…‹éš†ã€‚</li>
<li><code>HashSet</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ‰€ä»¥æ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>HashSet</code>  ä¸­å­˜å‚¨çš„å…ƒç´ æ˜¯æ— åºçš„ã€‚</li>
<li><code>HashSet</code>  å…è®¸ null å€¼çš„å…ƒç´ ã€‚</li>
<li><code>HashSet</code>  ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<h3 id="-432"><a class="markdownIt-Anchor" href="#-432">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_2-2-hashset-%E5%8E%9F%E7%90%86">#</a>2.2. HashSet åŸç†</h3>
<p><strong> <code>HashSet</code>  æ˜¯åŸºäº  <code>HashMap</code>  å®ç°çš„ã€‚</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// HashSet çš„æ ¸å¿ƒï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ª HashMap å®ä½“æ¥å®ç° HashSet æ–¹æ³•</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token punctuation">;</span>

<span class="token comment">// PRESENT æ˜¯ç”¨äºå…³è” map ä¸­å½“å‰æ“ä½œå…ƒç´ çš„ä¸€ä¸ªè™šæ‹Ÿå€¼</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> PRESENT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<pre><code>  HashSet
  <pre class="line-numbers language-none"><code class="language-none">
 

ä¸­ç»´æŠ¤äº†ä¸€ä¸ª

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  HashMap
  <pre class="line-numbers language-none"><code class="language-none">
 

å¯¹è±¡ mapï¼Œ
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
  HashSet
  <pre class="line-numbers language-none"><code class="language-none">
 

çš„é‡è¦æ–¹æ³•ï¼Œå¦‚

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  add
  <pre class="line-numbers language-none"><code class="language-none">
ã€
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
  remove
  <pre class="line-numbers language-none"><code class="language-none">
ã€
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
  iterator
  <pre class="line-numbers language-none"><code class="language-none">
ã€
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
  clear
  <pre class="line-numbers language-none"><code class="language-none">
ã€
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
  size
  <pre class="line-numbers language-none"><code class="language-none">
	 

	ç­‰éƒ½æ˜¯å›´ç»• map å®ç°çš„ã€‚

	- &#96;HashSet&#96; ç±»ä¸­é€šè¿‡å®šä¹‰ &#96;writeObject()&#96; å’Œ &#96;readObject()&#96; æ–¹æ³•ç¡®å®šäº†å…¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æœºåˆ¶ã€‚

- PRESENT æ˜¯ç”¨äºå…³è” map ä¸­å½“å‰æ“ä½œå…ƒç´ çš„ä¸€ä¸ªè™šæ‹Ÿå€¼ã€‚

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;container&#x2F;java-container-set.html#_3-treeset-ç±»)3. TreeSet ç±»

&#96;TreeSet&#96; ç±»ä¾èµ–äº &#96;TreeMap&#96;ï¼Œå®ƒå®é™…ä¸Šæ˜¯é€šè¿‡ &#96;TreeMap&#96; å®ç°çš„ã€‚&#96;TreeSet&#96; ä¸­çš„å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå®ƒæ˜¯æŒ‰è‡ªç„¶æ’åºæˆ–è€…ç”¨æˆ·æŒ‡å®šæ¯”è¾ƒå™¨æ’åºçš„ Setã€‚

&#96;TreeSet&#96; ç±»å®šä¹‰å¦‚ä¸‹ï¼š

&#96;&#96;&#96;java
public class TreeSet&lt;E&gt; extends AbstractSet&lt;E&gt;
    implements NavigableSet&lt;E&gt;, Cloneable, java.io.Serializable &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<h3 id="-433"><a class="markdownIt-Anchor" href="#-433">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_3-1-treeset-%E8%A6%81%E7%82%B9">#</a>3.1. TreeSet è¦ç‚¹</h3>
<ul>
<li><code>TreeSet</code>  é€šè¿‡ç»§æ‰¿  <code>AbstractSet</code>  å®ç°äº†  <code>NavigableSet</code>  æ¥å£ä¸­çš„éª¨å¹²æ–¹æ³•ã€‚</li>
<li><code>TreeSet</code>  å®ç°äº†  <code>Cloneable</code> ï¼Œæ‰€ä»¥æ”¯æŒå…‹éš†ã€‚</li>
<li><code>TreeSet</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ‰€ä»¥æ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>TreeSet</code>  ä¸­å­˜å‚¨çš„å…ƒç´ æ˜¯æœ‰åºçš„ã€‚æ’åºè§„åˆ™æ˜¯è‡ªç„¶é¡ºåºæˆ–æ¯”è¾ƒå™¨ï¼ˆ <code>Comparator</code> ï¼‰ä¸­æä¾›çš„é¡ºåºè§„åˆ™ã€‚</li>
<li><code>TreeSet</code>  ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<h3 id="-434"><a class="markdownIt-Anchor" href="#-434">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_3-2-treeset-%E6%BA%90%E7%A0%81">#</a>3.2. TreeSet æºç </h3>
<p><strong>TreeSet æ˜¯åŸºäº TreeMap å®ç°çš„ã€‚</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// TreeSet çš„æ ¸å¿ƒï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ª NavigableMap å®ä½“æ¥å®ç° TreeSet æ–¹æ³•</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">NavigableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> m<span class="token punctuation">;</span>

<span class="token comment">// PRESENT æ˜¯ç”¨äºå…³è” map ä¸­å½“å‰æ“ä½œå…ƒç´ çš„ä¸€ä¸ªè™šæ‹Ÿå€¼</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> PRESENT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>TreeSet</code>  ä¸­ç»´æŠ¤äº†ä¸€ä¸ª  <code>NavigableMap</code>  å¯¹è±¡ mapï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ª TreeMap å®ä¾‹ï¼‰ï¼Œ <code>TreeSet</code>  çš„é‡è¦æ–¹æ³•ï¼Œå¦‚  <code>add</code> ã€ <code>remove</code> ã€ <code>iterator</code> ã€ <code>clear</code> ã€ <code>size</code>  ç­‰éƒ½æ˜¯å›´ç»• map å®ç°çš„ã€‚</li>
<li><code>PRESENT</code>  æ˜¯ç”¨äºå…³è”  <code>map</code>  ä¸­å½“å‰æ“ä½œå…ƒç´ çš„ä¸€ä¸ªè™šæ‹Ÿå€¼ã€‚ <code>TreeSet</code>  ä¸­çš„å…ƒç´ éƒ½è¢«å½“æˆ  <code>TreeMap</code>  çš„ key å­˜å‚¨ï¼Œè€Œ value éƒ½å¡«çš„æ˜¯  <code>PRESENT</code> ã€‚</li>
</ul>
<h2 id="-435"><a class="markdownIt-Anchor" href="#-435">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_4-linkedhashset-%E7%B1%BB">#</a>4. LinkedHashSet ç±»</h2>
<p><code>LinkedHashSet</code>  æ˜¯æŒ‰æ’å…¥é¡ºåºæ’åºçš„ Setã€‚</p>
<p><code>LinkedHashSet</code>  ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="-436"><a class="markdownIt-Anchor" href="#-436">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_4-1-linkedhashset-%E8%A6%81%E7%82%B9">#</a>4.1. LinkedHashSet è¦ç‚¹</h3>
<ul>
<li><code>LinkedHashSet</code>  é€šè¿‡ç»§æ‰¿  <code>HashSet</code>  å®ç°äº†  <code>Set</code>  æ¥å£ä¸­çš„éª¨å¹²æ–¹æ³•ã€‚</li>
<li><code>LinkedHashSet</code>  å®ç°äº†  <code>Cloneable</code> ï¼Œæ‰€ä»¥æ”¯æŒå…‹éš†ã€‚</li>
<li><code>LinkedHashSet</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ‰€ä»¥æ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>LinkedHashSet</code>  ä¸­å­˜å‚¨çš„å…ƒç´ æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºä¿å­˜çš„ã€‚</li>
<li><code>LinkedHashSet</code>  ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<h3 id="-437"><a class="markdownIt-Anchor" href="#-437">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_4-2-linkedhashset-%E5%8E%9F%E7%90%86">#</a>4.2. LinkedHashSet åŸç†</h3>
<p><code>LinkedHashSet</code>  æœ‰ä¸‰ä¸ªæ„é€ æ–¹æ³•ï¼Œæ— ä¸€ä¾‹å¤–ï¼Œéƒ½æ˜¯è°ƒç”¨çˆ¶ç±»  <code>HashSet</code>  çš„æ„é€ æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">LinkedHashSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> loadFactor<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token class-name">LinkedHashSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> <span class="token number">.75f</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token class-name">LinkedHashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">.75f</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼š<strong>LinkedHashSet æ„é€ æ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯çˆ¶ç±» HashSet çš„é public æ„é€ æ–¹æ³•ã€‚</strong></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">,</span> <span class="token keyword">boolean</span> dummy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä¸åŒäº  <code>HashSet</code>   <code>public</code>  æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–çš„  <code>HashMap</code>  å®ä¾‹ï¼Œè¿™ä¸ªæ„é€ æ–¹æ³•ä¸­ï¼Œåˆå§‹åŒ–äº†  <code>LinkedHashMap</code>  å®ä¾‹ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®é™…ä¸Šï¼Œ <code>LinkedHashSet</code>  ç»´æŠ¤äº†ä¸€ä¸ªåŒé“¾è¡¨ã€‚ç”±åŒé“¾è¡¨çš„ç‰¹æ€§å¯ä»¥çŸ¥é“ï¼Œå®ƒæ˜¯æŒ‰ç…§å…ƒç´ çš„æ’å…¥é¡ºåºä¿å­˜çš„ã€‚æ‰€ä»¥ï¼Œè¿™å°±æ˜¯  <code>LinkedHashSet</code>  ä¸­å­˜å‚¨çš„å…ƒç´ æ˜¯æŒ‰ç…§æ’å…¥é¡ºåºä¿å­˜çš„åŸç†ã€‚</p>
<h2 id="-438"><a class="markdownIt-Anchor" href="#-438">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_5-enumset-%E7%B1%BB">#</a>5. EnumSet ç±»</h2>
<p><code>EnumSet</code>  ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">EnumSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span> <span class="token keyword">extends</span> <span class="token class-name">Enum</span><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-439"><a class="markdownIt-Anchor" href="#-439">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_5-1-enumset-%E8%A6%81%E7%82%B9">#</a>5.1. EnumSet è¦ç‚¹</h3>
<ul>
<li><code>EnumSet</code>  ç»§æ‰¿äº†  <code>AbstractSet</code> ï¼Œæ‰€ä»¥æœ‰  <code>Set</code>  æ¥å£ä¸­çš„éª¨å¹²æ–¹æ³•ã€‚</li>
<li><code>EnumSet</code>  å®ç°äº†  <code>Cloneable</code> ï¼Œæ‰€ä»¥æ”¯æŒå…‹éš†ã€‚</li>
<li><code>EnumSet</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ‰€ä»¥æ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>EnumSet</code>  é€šè¿‡  <code>&lt;E extends Enum&lt;E&gt;&gt;</code>  é™å®šäº†å­˜å‚¨å…ƒç´ å¿…é¡»æ˜¯æšä¸¾å€¼ã€‚</li>
<li><code>EnumSet</code>  æ²¡æœ‰æ„é€ æ–¹æ³•ï¼Œåªèƒ½é€šè¿‡ç±»ä¸­çš„  <code>static</code>  æ–¹æ³•æ¥åˆ›å»º  <code>EnumSet</code>  å¯¹è±¡ã€‚</li>
<li><code>EnumSet</code>  æ˜¯æœ‰åºçš„ã€‚ä»¥æšä¸¾å€¼åœ¨  <code>EnumSet</code>  ç±»ä¸­çš„å®šä¹‰é¡ºåºæ¥å†³å®šé›†åˆå…ƒç´ çš„é¡ºåºã€‚</li>
<li><code>EnumSet</code>  ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<h2 id="-440"><a class="markdownIt-Anchor" href="#-440">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-set.html#_6-%E8%A6%81%E7%82%B9%E6%80%BB%E7%BB%93">#</a>6. è¦ç‚¹æ€»ç»“</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200221190717.png" alt="img"></p>
<hr>
<h1 id="java-å®¹å™¨ä¹‹-queue"><a class="markdownIt-Anchor" href="#java-å®¹å™¨ä¹‹-queue">#</a> Java å®¹å™¨ä¹‹ Queue</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. Queue ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#11-queue-%E6%8E%A5%E5%8F%A3">1.1. Queue æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#12-abstractqueue-%E6%8A%BD%E8%B1%A1%E7%B1%BB">1.2. AbstractQueue æŠ½è±¡ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#13-deque-%E6%8E%A5%E5%8F%A3">1.3. Deque æ¥å£</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#2-arraydeque">2. ArrayDeque</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#3-linkedlist">3. LinkedList</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#4-priorityqueue">4. PriorityQueue</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-441"><a class="markdownIt-Anchor" href="#-441">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#_1-queue-%E7%AE%80%E4%BB%8B">#</a>1. Queue ç®€ä»‹</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/Queue-diagrams.png" alt="img"></p>
<h3 id="-442"><a class="markdownIt-Anchor" href="#-442">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#_1-1-queue-%E6%8E%A5%E5%8F%A3">#</a>1.1. Queue æ¥å£</h3>
<p><code>Queue</code>  æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-443"><a class="markdownIt-Anchor" href="#-443">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#_1-2-abstractqueue-%E6%8A%BD%E8%B1%A1%E7%B1%BB">#</a>1.2. AbstractQueue æŠ½è±¡ç±»</h3>
<p><strong> <code>AbstractQueue</code>  ç±»æä¾›  <code>Queue</code>  æ¥å£çš„æ ¸å¿ƒå®ç°</strong>ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘å®ç°  <code>Queue</code>  æ¥å£æ‰€éœ€çš„å·¥ä½œã€‚</p>
<p><code>AbstractQueue</code>  æŠ½è±¡ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractCollection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="-444"><a class="markdownIt-Anchor" href="#-444">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#_1-3-deque-%E6%8E%A5%E5%8F%A3">#</a>1.3. Deque æ¥å£</h3>
<p>Deque æ¥å£æ˜¯ double ended queue çš„ç¼©å†™ï¼Œå³<strong>åŒç«¯é˜Ÿåˆ—</strong>ã€‚Deque ç»§æ‰¿ Queue æ¥å£ï¼Œå¹¶æ‰©å±•æ”¯æŒ<strong>åœ¨é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤å…ƒç´ </strong>ã€‚</p>
<p>æ‰€ä»¥æä¾›äº†ç‰¹å®šçš„æ–¹æ³•ï¼Œå¦‚:</p>
<ul>
<li>å°¾éƒ¨æ’å…¥æ—¶éœ€è¦çš„ <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/util/Deque.html#addLast-E-">addLast(e) (opens new window)</a>ã€<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/util/Deque.html#offerLast-E-">offerLast(e) (opens new window)</a>ã€‚</li>
<li>å°¾éƒ¨åˆ é™¤æ‰€éœ€è¦çš„ <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/util/Deque.html#removeLast--">removeLast() (opens new window)</a>ã€<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/9/docs/api/java/util/Deque.html#pollLast--">pollLast() (opens new window)</a>ã€‚</li>
</ul>
<p>å¤§å¤šæ•°çš„å®ç°å¯¹å…ƒç´ çš„æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œä½†è¿™ä¸ªæ¥å£æ—¢æ”¯æŒæœ‰å®¹é‡é™åˆ¶çš„ dequeï¼Œä¹Ÿæ”¯æŒæ²¡æœ‰å›ºå®šå¤§å°é™åˆ¶çš„ã€‚</p>
<h2 id="-445"><a class="markdownIt-Anchor" href="#-445">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#_2-arraydeque">#</a>2. ArrayDeque</h2>
<p><code>ArrayDeque</code>  æ˜¯  <code>Deque</code>  çš„é¡ºåºè¡¨å®ç°ã€‚</p>
<p><code>ArrayDeque</code>  ç”¨ä¸€ä¸ªåŠ¨æ€æ•°ç»„å®ç°äº†æ ˆå’Œé˜Ÿåˆ—æ‰€éœ€çš„æ‰€æœ‰æ“ä½œã€‚</p>
<h2 id="-446"><a class="markdownIt-Anchor" href="#-446">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#_3-linkedlist">#</a>3. LinkedList</h2>
<p><code>LinkedList</code>  æ˜¯  <code>Deque</code>  çš„é“¾è¡¨å®ç°ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedListQueueDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//add()å’Œremove()æ–¹æ³•åœ¨å¤±è´¥çš„æ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸(ä¸æ¨è)</span>
        <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…¥é˜Ÿ</span>
        queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…¥é˜Ÿ</span>
        queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…¥é˜Ÿ</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> q <span class="token operator">:</span> queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"poll="</span> <span class="token operator">+</span> queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‡ºé˜Ÿ</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> q <span class="token operator">:</span> queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"element="</span> <span class="token operator">+</span> queue<span class="token punctuation">.</span><span class="token function">element</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> q <span class="token operator">:</span> queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"peek="</span> <span class="token operator">+</span> queue<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> q <span class="token operator">:</span> queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-447"><a class="markdownIt-Anchor" href="#-447">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/container/java-container-queue.html#_4-priorityqueue">#</a>4. PriorityQueue</h2>
<p><code>PriorityQueue</code>  ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>PriorityQueue</code>  è¦ç‚¹ï¼š</p>
<ul>
<li><code>PriorityQueue</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>PriorityQueue</code>  ç±»æ˜¯æ— ç•Œä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</li>
<li><code>PriorityQueue</code>  ä¸­çš„å…ƒç´ æ ¹æ®è‡ªç„¶é¡ºåºæˆ–  <code>Comparator</code>  æä¾›çš„é¡ºåºæ’åºã€‚</li>
<li><code>PriorityQueue</code>  ä¸æ¥å— null å€¼å…ƒç´ ã€‚</li>
<li><code>PriorityQueue</code>  ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<hr>
<h1 id="java-io-æ¨¡å‹"><a class="markdownIt-Anchor" href="#java-io-æ¨¡å‹">#</a> Java IO æ¨¡å‹</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>æ‰€è°“çš„<strong> I/Oï¼Œå°±æ˜¯è®¡ç®—æœºå†…å­˜ä¸å¤–éƒ¨è®¾å¤‡ä¹‹é—´æ‹·è´æ•°æ®çš„è¿‡ç¨‹</strong>ã€‚ç”±äº CPU è®¿é—®å†…å­˜çš„é€Ÿåº¦è¿œè¿œé«˜äºå¤–éƒ¨è®¾å¤‡ï¼Œå› æ­¤ CPU æ˜¯å…ˆæŠŠå¤–éƒ¨è®¾å¤‡çš„æ•°æ®è¯»åˆ°å†…å­˜é‡Œï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚</p>
<p><strong>å…³é”®è¯ï¼š <code>InputStream</code> ã€ <code>OutputStream</code> ã€ <code>Reader</code> ã€ <code>Writer</code> </strong></p>
</blockquote>
<ul>
<li>ä¸€ã€ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#bio">BIO</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#nio">NIO</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#aio">AIO</a></li>
</ul>
</li>
<li>äºŒã€IO æµ
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AD%97%E8%8A%82%E6%B5%81">å­—èŠ‚æµ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AD%97%E7%AC%A6%E6%B5%81">å­—ç¬¦æµ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AD%97%E8%8A%82%E6%B5%81-vs-%E5%AD%97%E7%AC%A6%E6%B5%81">å­—èŠ‚æµ vs. å­—ç¬¦æµ</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E4%B8%89%E4%BC%A0%E7%BB%9F-bio">ä¸‰ã€ä¼ ç»Ÿ BIO</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%9B%9B%E4%BC%AA%E5%BC%82%E6%AD%A5-bio">å››ã€ä¼ªå¼‚æ­¥ BIO</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-448"><a class="markdownIt-Anchor" href="#-448">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#unix-i-o-%E6%A8%A1%E5%9E%8B">#</a>UNIX I/O æ¨¡å‹</h2>
<p>UNIX ç³»ç»Ÿä¸‹çš„ I/O æ¨¡å‹æœ‰ 5 ç§ï¼š</p>
<ul>
<li>åŒæ­¥é˜»å¡ I/O</li>
<li>åŒæ­¥éé˜»å¡ I/O</li>
<li>I/O å¤šè·¯å¤ç”¨</li>
<li>ä¿¡å·é©±åŠ¨ I/O</li>
<li>å¼‚æ­¥ I/O</li>
</ul>
<p>å¦‚ä½•å»ç†è§£ UNIX I/O æ¨¡å‹ï¼Œå¤§è‡´æœ‰ä»¥ä¸‹ä¸¤ä¸ªç»´åº¦ï¼š</p>
<ul>
<li>åŒºåˆ†åŒæ­¥æˆ–å¼‚æ­¥ï¼ˆsynchronous/asynchronousï¼‰ã€‚ç®€å•æ¥è¯´ï¼ŒåŒæ­¥æ˜¯ä¸€ç§å¯é çš„æœ‰åºè¿è¡Œæœºåˆ¶ï¼Œå½“æˆ‘ä»¬è¿›è¡ŒåŒæ­¥æ“ä½œæ—¶ï¼Œåç»­çš„ä»»åŠ¡æ˜¯ç­‰å¾…å½“å‰è°ƒç”¨è¿”å›ï¼Œæ‰ä¼šè¿›è¡Œä¸‹ä¸€æ­¥ï¼›è€Œå¼‚æ­¥åˆ™ç›¸åï¼Œå…¶ä»–ä»»åŠ¡ä¸éœ€è¦ç­‰å¾…å½“å‰è°ƒç”¨è¿”å›ï¼Œé€šå¸¸ä¾é äº‹ä»¶ã€å›è°ƒç­‰æœºåˆ¶æ¥å®ç°ä»»åŠ¡é—´æ¬¡åºå…³ç³»ã€‚</li>
<li>åŒºåˆ†é˜»å¡ä¸éé˜»å¡ï¼ˆblocking/non-blockingï¼‰ã€‚åœ¨è¿›è¡Œé˜»å¡æ“ä½œæ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œæ— æ³•ä»äº‹å…¶ä»–ä»»åŠ¡ï¼Œåªæœ‰å½“æ¡ä»¶å°±ç»ªæ‰èƒ½ç»§ç»­ï¼Œæ¯”å¦‚ ServerSocket æ–°è¿æ¥å»ºç«‹å®Œæ¯•ï¼Œæˆ–æ•°æ®è¯»å–ã€å†™å…¥æ“ä½œå®Œæˆï¼›è€Œéé˜»å¡åˆ™æ˜¯ä¸ç®¡ IO æ“ä½œæ˜¯å¦ç»“æŸï¼Œç›´æ¥è¿”å›ï¼Œç›¸åº”æ“ä½œåœ¨åå°ç»§ç»­å¤„ç†ã€‚</li>
</ul>
<p>ä¸èƒ½ä¸€æ¦‚è€Œè®ºè®¤ä¸ºåŒæ­¥æˆ–é˜»å¡å°±æ˜¯ä½æ•ˆï¼Œå…·ä½“è¿˜è¦çœ‹åº”ç”¨å’Œç³»ç»Ÿç‰¹å¾ã€‚</p>
<p>å¯¹äºä¸€ä¸ªç½‘ç»œ I/O é€šä¿¡è¿‡ç¨‹ï¼Œæ¯”å¦‚ç½‘ç»œæ•°æ®è¯»å–ï¼Œä¼šæ¶‰åŠä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªæ˜¯è°ƒç”¨è¿™ä¸ª I/O æ“ä½œçš„ç”¨æˆ·çº¿ç¨‹ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ã€‚ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼Œç”¨æˆ·çº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®å†…æ ¸ç©ºé—´ã€‚</p>
<p>å½“ç”¨æˆ·çº¿ç¨‹å‘èµ· I/O æ“ä½œåï¼Œç½‘ç»œæ•°æ®è¯»å–æ“ä½œä¼šç»å†ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li><strong>ç”¨æˆ·çº¿ç¨‹ç­‰å¾…å†…æ ¸å°†æ•°æ®ä»ç½‘å¡æ‹·è´åˆ°å†…æ ¸ç©ºé—´ã€‚</strong></li>
<li><strong>å†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ã€‚</strong></li>
</ul>
<p>å„ç§ I/O æ¨¡å‹çš„åŒºåˆ«å°±æ˜¯ï¼šå®ƒä»¬å®ç°è¿™ä¸¤ä¸ªæ­¥éª¤çš„æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p>
<h3 id="-449"><a class="markdownIt-Anchor" href="#-449">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9E-i-o">#</a>åŒæ­¥é˜»å¡ I/O</h3>
<p>ç”¨æˆ·çº¿ç¨‹å‘èµ· read è°ƒç”¨åå°±é˜»å¡äº†ï¼Œè®©å‡º CPUã€‚å†…æ ¸ç­‰å¾…ç½‘å¡æ•°æ®åˆ°æ¥ï¼ŒæŠŠæ•°æ®ä»ç½‘å¡æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œæ¥ç€æŠŠæ•°æ®æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼Œå†æŠŠç”¨æˆ·çº¿ç¨‹å«é†’ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201121163321.jpg" alt="img"></p>
<h3 id="-450"><a class="markdownIt-Anchor" href="#-450">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%90%8C%E6%AD%A5%E9%9D%9E%E9%98%BB%E5%A1%9E-i-o">#</a>åŒæ­¥éé˜»å¡ I/O</h3>
<p>ç”¨æˆ·çº¿ç¨‹ä¸æ–­çš„å‘èµ· read è°ƒç”¨ï¼Œæ•°æ®æ²¡åˆ°å†…æ ¸ç©ºé—´æ—¶ï¼Œæ¯æ¬¡éƒ½è¿”å›å¤±è´¥ï¼Œç›´åˆ°æ•°æ®åˆ°äº†å†…æ ¸ç©ºé—´ï¼Œè¿™ä¸€æ¬¡ read è°ƒç”¨åï¼Œåœ¨ç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´è¿™æ®µæ—¶é—´é‡Œï¼Œçº¿ç¨‹è¿˜æ˜¯é˜»å¡çš„ï¼Œç­‰æ•°æ®åˆ°äº†ç”¨æˆ·ç©ºé—´å†æŠŠçº¿ç¨‹å«é†’ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201121163344.jpg" alt="img"></p>
<h3 id="-451"><a class="markdownIt-Anchor" href="#-451">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#i-o-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8">#</a>I/O å¤šè·¯å¤ç”¨</h3>
<p>ç”¨æˆ·çº¿ç¨‹çš„è¯»å–æ“ä½œåˆ†æˆä¸¤æ­¥äº†ï¼Œçº¿ç¨‹å…ˆå‘èµ· select è°ƒç”¨ï¼Œç›®çš„æ˜¯é—®å†…æ ¸æ•°æ®å‡†å¤‡å¥½äº†å—ï¼Ÿç­‰å†…æ ¸æŠŠæ•°æ®å‡†å¤‡å¥½äº†ï¼Œç”¨æˆ·çº¿ç¨‹å†å‘èµ· read è°ƒç”¨ã€‚åœ¨ç­‰å¾…æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´è¿™æ®µæ—¶é—´é‡Œï¼Œçº¿ç¨‹è¿˜æ˜¯é˜»å¡çš„ã€‚é‚£ä¸ºä»€ä¹ˆå« I/O å¤šè·¯å¤ç”¨å‘¢ï¼Ÿå› ä¸ºä¸€æ¬¡ select è°ƒç”¨å¯ä»¥å‘å†…æ ¸æŸ¥å¤šä¸ªæ•°æ®é€šé“ï¼ˆChannelï¼‰çš„çŠ¶æ€ï¼Œæ‰€ä»¥å«å¤šè·¯å¤ç”¨ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201121163408.jpg" alt="img"></p>
<h3 id="-452"><a class="markdownIt-Anchor" href="#-452">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E4%BF%A1%E5%8F%B7%E9%A9%B1%E5%8A%A8-i-o">#</a>ä¿¡å·é©±åŠ¨ I/O</h3>
<p>é¦–å…ˆå¼€å¯ Socket çš„ä¿¡å·é©±åŠ¨ I/O åŠŸèƒ½ï¼Œå¹¶å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œå¹¶ä¸é˜»å¡ã€‚å½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œè¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ª SIGIO ä¿¡å·ï¼Œå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨ I/O æ“ä½œå‡½æ•°å¤„ç†æ•°æ®ã€‚<strong>ä¿¡å·é©±åŠ¨å¼ I/O æ¨¡å‹çš„ä¼˜ç‚¹æ˜¯æˆ‘ä»¬åœ¨æ•°æ®æŠ¥åˆ°è¾¾æœŸé—´è¿›ç¨‹ä¸ä¼šè¢«é˜»å¡ï¼Œæˆ‘ä»¬åªè¦ç­‰å¾…ä¿¡å·å¤„ç†å‡½æ•°çš„é€šçŸ¥å³å¯</strong></p>
<h3 id="-453"><a class="markdownIt-Anchor" href="#-453">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%BC%82%E6%AD%A5-i-o">#</a>å¼‚æ­¥ I/O</h3>
<p>ç”¨æˆ·çº¿ç¨‹å‘èµ· read è°ƒç”¨çš„åŒæ—¶æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œread ç«‹å³è¿”å›ï¼Œç­‰å†…æ ¸å°†æ•°æ®å‡†å¤‡å¥½åï¼Œå†è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°å®Œæˆå¤„ç†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹ä¸€ç›´æ²¡æœ‰é˜»å¡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20201121163428.jpg" alt="img"></p>
<h2 id="-454"><a class="markdownIt-Anchor" href="#-454">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#java-i-o-%E6%A8%A1%E5%9E%8B">#</a>Java I/O æ¨¡å‹</h2>
<h3 id="-455"><a class="markdownIt-Anchor" href="#-455">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#bio">#</a>BIO</h3>
<blockquote>
<p>BIOï¼ˆblocking IOï¼‰ å³é˜»å¡ IOã€‚æŒ‡çš„ä¸»è¦æ˜¯ä¼ ç»Ÿçš„  <code>java.io</code>  åŒ…ï¼Œå®ƒåŸºäºæµæ¨¡å‹å®ç°ã€‚</p>
</blockquote>
<h4 id="-456"><a class="markdownIt-Anchor" href="#-456">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#bio-%E7%AE%80%E4%BB%8B">#</a>BIO ç®€ä»‹</h4>
<p><code>java.io</code>  åŒ…æä¾›äº†æˆ‘ä»¬æœ€ç†ŸçŸ¥çš„ä¸€äº› IO åŠŸèƒ½ï¼Œæ¯”å¦‚ File æŠ½è±¡ã€è¾“å…¥è¾“å‡ºæµç­‰ã€‚äº¤äº’æ–¹å¼æ˜¯åŒæ­¥ã€é˜»å¡çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¯»å–è¾“å…¥æµæˆ–è€…å†™å…¥è¾“å‡ºæµæ—¶ï¼Œåœ¨è¯»ã€å†™åŠ¨ä½œå®Œæˆä¹‹å‰ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨æ˜¯å¯é çš„çº¿æ€§é¡ºåºã€‚</p>
<p>å¾ˆå¤šæ—¶å€™ï¼Œäººä»¬ä¹ŸæŠŠ <a target="_blank" rel="noopener" href="http://java.net">java.net</a> ä¸‹é¢æä¾›çš„éƒ¨åˆ†ç½‘ç»œ APIï¼Œæ¯”å¦‚  <code>Socket</code> ã€ <code>ServerSocket</code> ã€ <code>HttpURLConnection</code>  ä¹Ÿå½’ç±»åˆ°åŒæ­¥é˜»å¡ IO ç±»åº“ï¼Œå› ä¸ºç½‘ç»œé€šä¿¡åŒæ ·æ˜¯ IO è¡Œä¸ºã€‚</p>
<p>BIO çš„ä¼˜ç‚¹æ˜¯ä»£ç æ¯”è¾ƒç®€å•ã€ç›´è§‚ï¼›ç¼ºç‚¹åˆ™æ˜¯ IO æ•ˆç‡å’Œæ‰©å±•æ€§å­˜åœ¨å±€é™æ€§ï¼Œå®¹æ˜“æˆä¸ºåº”ç”¨æ€§èƒ½çš„ç“¶é¢ˆã€‚</p>
<h4 id="-457"><a class="markdownIt-Anchor" href="#-457">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#bio-%E7%9A%84%E6%80%A7%E8%83%BD%E7%BC%BA%E9%99%B7">#</a>BIO çš„æ€§èƒ½ç¼ºé™·</h4>
<p><strong>BIO ä¼šé˜»å¡è¿›ç¨‹ï¼Œä¸é€‚åˆé«˜å¹¶å‘åœºæ™¯</strong>ã€‚</p>
<p>é‡‡ç”¨ BIO çš„æœåŠ¡ç«¯ï¼Œé€šå¸¸ç”±ä¸€ä¸ªç‹¬ç«‹çš„ Acceptor çº¿ç¨‹è´Ÿè´£ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ã€‚æœåŠ¡ç«¯ä¸€èˆ¬åœ¨ <code>while(true)</code>  å¾ªç¯ä¸­è°ƒç”¨  <code>accept()</code>  æ–¹æ³•ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œä¸€æ—¦æ¥æ”¶åˆ°ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œå°±å¯ä»¥å»ºç«‹ Socketï¼Œå¹¶åŸºäºè¿™ä¸ª Socket è¿›è¡Œè¯»å†™æ“ä½œã€‚æ­¤æ—¶ï¼Œä¸èƒ½å†æ¥æ”¶å…¶ä»–å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œåªèƒ½ç­‰å¾…å½“å‰è¿æ¥çš„æ“ä½œæ‰§è¡Œå®Œæˆã€‚</p>
<p>å¦‚æœè¦è®© <strong>BIO é€šä¿¡æ¨¡å‹</strong> èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°±å¿…é¡»ä½¿ç”¨å¤šçº¿ç¨‹ï¼ˆä¸»è¦åŸå› æ˜¯ <code>socket.accept()</code> ã€ <code>socket.read()</code> ã€ <code>socket.write()</code>  æ¶‰åŠçš„ä¸‰ä¸ªä¸»è¦å‡½æ•°éƒ½æ˜¯åŒæ­¥é˜»å¡çš„ï¼‰ï¼Œä½†ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ã€‚ä¸è¿‡å¯ä»¥é€šè¿‡ <strong>çº¿ç¨‹æ± æœºåˆ¶</strong> æ”¹å–„ï¼Œçº¿ç¨‹æ± è¿˜å¯ä»¥è®©çº¿ç¨‹çš„åˆ›å»ºå’Œå›æ”¶æˆæœ¬ç›¸å¯¹è¾ƒä½ã€‚</p>
<p><strong>å³ä½¿å¯ä»¥ç”¨çº¿ç¨‹æ± ç•¥å¾®ä¼˜åŒ–ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—å®è´µçš„çº¿ç¨‹èµ„æºï¼Œå¹¶ä¸”åœ¨ç™¾ä¸‡çº§å¹¶å‘åœºæ™¯ä¸‹ä¹Ÿæ’‘ä¸ä½</strong>ã€‚å¦‚æœå¹¶å‘è®¿é—®é‡å¢åŠ ä¼šå¯¼è‡´çº¿ç¨‹æ•°æ€¥å‰§è†¨èƒ€å¯èƒ½ä¼šå¯¼è‡´çº¿ç¨‹å †æ ˆæº¢å‡ºã€åˆ›å»ºæ–°çº¿ç¨‹å¤±è´¥ç­‰é—®é¢˜ï¼Œæœ€ç»ˆå¯¼è‡´è¿›ç¨‹å®•æœºæˆ–è€…åƒµæ­»ï¼Œä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚</p>
<h3 id="-458"><a class="markdownIt-Anchor" href="#-458">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#nio">#</a>NIO</h3>
<blockquote>
<p>NIOï¼ˆnon-blocking IOï¼‰ å³éé˜»å¡ IOã€‚æŒ‡çš„æ˜¯ Java 1.4 ä¸­å¼•å…¥çš„  <code>java.nio</code>  åŒ…ã€‚</p>
</blockquote>
<p>ä¸ºäº†è§£å†³ BIO çš„æ€§èƒ½é—®é¢˜ï¼Œ Java 1.4 ä¸­å¼•å…¥çš„  <code>java.nio</code>  åŒ…ã€‚NIO ä¼˜åŒ–äº†å†…å­˜å¤åˆ¶ä»¥åŠé˜»å¡å¯¼è‡´çš„ä¸¥é‡æ€§èƒ½é—®é¢˜ã€‚</p>
<p><code>java.nio</code>  åŒ…æä¾›äº†  <code>Channel</code> ã€ <code>Selector</code> ã€ <code>Buffer</code>  ç­‰æ–°çš„æŠ½è±¡ï¼Œå¯ä»¥æ„å»ºå¤šè·¯å¤ç”¨çš„ã€åŒæ­¥éé˜»å¡ IO ç¨‹åºï¼ŒåŒæ—¶æä¾›äº†æ›´æ¥è¿‘æ“ä½œç³»ç»Ÿåº•å±‚çš„é«˜æ€§èƒ½æ•°æ®æ“ä½œæ–¹å¼ã€‚</p>
<p>NIO æœ‰å“ªäº›æ€§èƒ½ä¼˜åŒ–ç‚¹å‘¢ï¼Ÿ</p>
<h4 id="-459"><a class="markdownIt-Anchor" href="#-459">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E4%BD%BF%E7%94%A8%E7%BC%93%E5%86%B2%E5%8C%BA%E4%BC%98%E5%8C%96%E8%AF%BB%E5%86%99%E6%B5%81">#</a>ä½¿ç”¨ç¼“å†²åŒºä¼˜åŒ–è¯»å†™æµ</h4>
<p>NIO ä¸ä¼ ç»Ÿ I/O ä¸åŒï¼Œå®ƒæ˜¯åŸºäºå—ï¼ˆBlockï¼‰çš„ï¼Œå®ƒä»¥å—ä¸ºåŸºæœ¬å•ä½å¤„ç†æ•°æ®ã€‚åœ¨ NIO ä¸­ï¼Œæœ€ä¸ºé‡è¦çš„ä¸¤ä¸ªç»„ä»¶æ˜¯ç¼“å†²åŒºï¼ˆ <code>Buffer</code> ï¼‰å’Œé€šé“ï¼ˆ <code>Channel</code> ï¼‰ã€‚</p>
<p><code>Buffer</code>  æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜å—ï¼Œæ˜¯ NIO è¯»å†™æ•°æ®çš„ç¼“å†²ã€‚ <code>Buffer</code>  å¯ä»¥å°†æ–‡ä»¶ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜å†åšåç»­å¤„ç†ï¼Œè€Œä¼ ç»Ÿçš„æ–¹å¼æ˜¯è¾¹è¯»æ–‡ä»¶è¾¹å¤„ç†æ•°æ®ã€‚ <code>Channel</code>  è¡¨ç¤ºç¼“å†²æ•°æ®çš„æºå¤´æˆ–è€…ç›®çš„åœ°ï¼Œå®ƒç”¨äºè¯»å–ç¼“å†²æˆ–è€…å†™å…¥æ•°æ®ï¼Œæ˜¯è®¿é—®ç¼“å†²çš„æ¥å£ã€‚</p>
<h4 id="-460"><a class="markdownIt-Anchor" href="#-460">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E4%BD%BF%E7%94%A8-directbuffer-%E5%87%8F%E5%B0%91%E5%86%85%E5%AD%98%E5%A4%8D%E5%88%B6">#</a>ä½¿ç”¨ DirectBuffer å‡å°‘å†…å­˜å¤åˆ¶</h4>
<p>NIO è¿˜æä¾›äº†ä¸€ä¸ªå¯ä»¥ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜çš„ç±»  <code>DirectBuffer</code> ã€‚æ™®é€šçš„  <code>Buffer</code>  åˆ†é…çš„æ˜¯ JVM å †å†…å­˜ï¼Œè€Œ  <code>DirectBuffer</code>  æ˜¯ç›´æ¥åˆ†é…ç‰©ç†å†…å­˜ã€‚</p>
<p>æ•°æ®è¦è¾“å‡ºåˆ°å¤–éƒ¨è®¾å¤‡ï¼Œå¿…é¡»å…ˆä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œå†å¤åˆ¶åˆ°è¾“å‡ºè®¾å¤‡ï¼Œè€Œ  <code>DirectBuffer</code>  åˆ™æ˜¯ç›´æ¥å°†æ­¥éª¤ç®€åŒ–ä¸ºä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°å¤–éƒ¨è®¾å¤‡ï¼Œå‡å°‘äº†æ•°æ®æ‹·è´ã€‚</p>
<p>è¿™é‡Œæ‹“å±•ä¸€ç‚¹ï¼Œç”±äº  <code>DirectBuffer</code>  ç”³è¯·çš„æ˜¯é JVM çš„ç‰©ç†å†…å­˜ï¼Œæ‰€ä»¥åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·å¾ˆé«˜ã€‚ <code>DirectBuffer</code>  ç”³è¯·çš„å†…å­˜å¹¶ä¸æ˜¯ç›´æ¥ç”± JVM è´Ÿè´£åƒåœ¾å›æ”¶ï¼Œä½†åœ¨  <code>DirectBuffer</code>  åŒ…è£…ç±»è¢«å›æ”¶æ—¶ï¼Œä¼šé€šè¿‡ Java å¼•ç”¨æœºåˆ¶æ¥é‡Šæ”¾è¯¥å†…å­˜å—ã€‚</p>
<h4 id="-461"><a class="markdownIt-Anchor" href="#-461">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E4%BC%98%E5%8C%96-i-o-%E9%81%BF%E5%85%8D%E9%98%BB%E5%A1%9E">#</a>ä¼˜åŒ– I/Oï¼Œé¿å…é˜»å¡</h4>
<p>ä¼ ç»Ÿ I/O çš„æ•°æ®è¯»å†™æ˜¯åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´æ¥å›å¤åˆ¶ï¼Œè€Œå†…æ ¸ç©ºé—´çš„æ•°æ®æ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿå±‚é¢çš„ I/O æ¥å£ä»ç£ç›˜è¯»å–æˆ–å†™å…¥ã€‚</p>
<p>NIO çš„  <code>Channel</code>  æœ‰è‡ªå·±çš„å¤„ç†å™¨ï¼Œå¯ä»¥å®Œæˆå†…æ ¸ç©ºé—´å’Œç£ç›˜ä¹‹é—´çš„ I/O æ“ä½œã€‚åœ¨ NIO ä¸­ï¼Œæˆ‘ä»¬è¯»å–å’Œå†™å…¥æ•°æ®éƒ½è¦é€šè¿‡  <code>Channel</code> ï¼Œç”±äº  <code>Channel</code>  æ˜¯åŒå‘çš„ï¼Œæ‰€ä»¥è¯»ã€å†™å¯ä»¥åŒæ—¶è¿›è¡Œã€‚</p>
<h3 id="-462"><a class="markdownIt-Anchor" href="#-462">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#aio">#</a>AIO</h3>
<blockquote>
<p>AIOï¼ˆAsynchronous IOï¼‰ å³å¼‚æ­¥éé˜»å¡ IOï¼ŒæŒ‡çš„æ˜¯ Java 7 ä¸­ï¼Œå¯¹ NIO æœ‰äº†è¿›ä¸€æ­¥çš„æ”¹è¿›ï¼Œä¹Ÿç§°ä¸º NIO2ï¼Œå¼•å…¥äº†å¼‚æ­¥éé˜»å¡ IO æ–¹å¼ã€‚</p>
</blockquote>
<p>åœ¨ Java 7 ä¸­ï¼ŒNIO æœ‰äº†è¿›ä¸€æ­¥çš„æ”¹è¿›ï¼Œä¹Ÿå°±æ˜¯ NIO 2ï¼Œå¼•å…¥äº†å¼‚æ­¥éé˜»å¡ IO æ–¹å¼ï¼Œä¹Ÿæœ‰å¾ˆå¤šäººå«å®ƒ AIOï¼ˆAsynchronous IOï¼‰ã€‚å¼‚æ­¥ IO æ“ä½œåŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œåº”ç”¨æ“ä½œç›´æ¥è¿”å›ï¼Œè€Œä¸ä¼šé˜»å¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çº¿ç¨‹è¿›è¡Œåç»­å·¥ä½œã€‚</p>
<h2 id="-463"><a class="markdownIt-Anchor" href="#-463">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E4%BC%A0%E7%BB%9F-io-%E6%B5%81">#</a>ä¼ ç»Ÿ IO æµ</h2>
<p>æµä»æ¦‚å¿µä¸Šæ¥è¯´æ˜¯ä¸€ä¸ªè¿ç»­çš„æ•°æ®æµã€‚å½“ç¨‹åºéœ€è¦è¯»æ•°æ®çš„æ—¶å€™å°±éœ€è¦ä½¿ç”¨è¾“å…¥æµè¯»å–æ•°æ®ï¼Œå½“éœ€è¦å¾€å¤–å†™æ•°æ®çš„æ—¶å€™å°±éœ€è¦è¾“å‡ºæµã€‚</p>
<p>BIO ä¸­æ“ä½œçš„æµä¸»è¦æœ‰ä¸¤å¤§ç±»ï¼Œå­—èŠ‚æµå’Œå­—ç¬¦æµï¼Œä¸¤ç±»æ ¹æ®æµçš„æ–¹å‘éƒ½å¯ä»¥åˆ†ä¸ºè¾“å…¥æµå’Œè¾“å‡ºæµã€‚</p>
<ul>
<li>å­—èŠ‚æµ
<ul>
<li>è¾“å…¥å­—èŠ‚æµï¼š <code>InputStream</code></li>
<li>è¾“å‡ºå­—èŠ‚æµï¼š <code>OutputStream</code></li>
</ul>
</li>
<li>å­—ç¬¦æµ
<ul>
<li>è¾“å…¥å­—ç¬¦æµï¼š <code>Reader</code></li>
<li>è¾“å‡ºå­—ç¬¦æµï¼š <code>Writer</code></li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200219130627.png" alt="img"></p>
<h3 id="-464"><a class="markdownIt-Anchor" href="#-464">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AD%97%E8%8A%82%E6%B5%81">#</a>å­—èŠ‚æµ</h3>
<p>å­—èŠ‚æµä¸»è¦æ“ä½œå­—èŠ‚æ•°æ®æˆ–äºŒè¿›åˆ¶å¯¹è±¡ã€‚</p>
<p>å­—èŠ‚æµæœ‰ä¸¤ä¸ªæ ¸å¿ƒæŠ½è±¡ç±»ï¼š <code>InputStream</code>  å’Œ  <code>OutputStream</code> ã€‚æ‰€æœ‰çš„å­—èŠ‚æµç±»éƒ½ç»§æ‰¿è‡ªè¿™ä¸¤ä¸ªæŠ½è±¡ç±»ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200219133627.png" alt="img"></p>
<h4 id="-465"><a class="markdownIt-Anchor" href="#-465">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E6%96%87%E4%BB%B6%E5%AD%97%E8%8A%82%E6%B5%81">#</a>æ–‡ä»¶å­—èŠ‚æµ</h4>
<p><code>FileOutputStream</code>  å’Œ  <code>FileInputStream</code>  æä¾›äº†è¯»å†™å­—èŠ‚åˆ°æ–‡ä»¶çš„èƒ½åŠ›ã€‚</p>
<p>æ–‡ä»¶æµæ“ä½œä¸€èˆ¬æ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨  <code>File</code>  ç±»ç»‘å®šä¸€ä¸ªæ–‡ä»¶ã€‚</li>
<li>æŠŠ  <code>File</code>  å¯¹è±¡ç»‘å®šåˆ°æµå¯¹è±¡ä¸Šã€‚</li>
<li>è¿›è¡Œè¯»æˆ–å†™æ“ä½œã€‚</li>
<li>å…³é—­æµ</li>
</ol>
<p><code>FileOutputStream</code>  å’Œ  <code>FileInputStream</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileStreamDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> FILEPATH <span class="token operator">=</span> <span class="token string">"temp.log"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token function">write</span><span class="token punctuation">(</span>FILEPATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">read</span><span class="token punctuation">(</span>FILEPATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span> filepath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ç¬¬1æ­¥ã€ä½¿ç”¨Fileç±»æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç¬¬2æ­¥ã€é€šè¿‡å­ç±»å®ä¾‹åŒ–çˆ¶ç±»å¯¹è±¡</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å®ä¾‹åŒ–æ—¶ï¼Œé»˜è®¤ä¸ºè¦†ç›–åŸæ–‡ä»¶å†…å®¹æ–¹å¼ï¼›å¦‚æœæ·»åŠ trueå‚æ•°ï¼Œåˆ™å˜ä¸ºå¯¹åŸæ–‡ä»¶è¿½åŠ å†…å®¹çš„æ–¹å¼ã€‚</span>
        <span class="token comment">// OutputStream out = new FileOutputStream(f, true);</span>

        <span class="token comment">// ç¬¬3æ­¥ã€è¿›è¡Œå†™æ“ä½œ</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello World\n"</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç¬¬4æ­¥ã€å…³é—­è¾“å‡ºæµ</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">String</span> filepath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ç¬¬1æ­¥ã€ä½¿ç”¨Fileç±»æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç¬¬2æ­¥ã€é€šè¿‡å­ç±»å®ä¾‹åŒ–çˆ¶ç±»å¯¹è±¡</span>
        <span class="token class-name">InputStream</span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç¬¬3æ­¥ã€è¿›è¡Œè¯»æ“ä½œ</span>
        <span class="token comment">// æœ‰ä¸‰ç§è¯»å–æ–¹å¼ï¼Œä½“ä¼šå…¶å·®å¼‚</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> f<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–å†…å®¹</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯»å…¥æ•°æ®çš„é•¿åº¦ï¼š"</span> <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç¬¬4æ­¥ã€å…³é—­è¾“å…¥æµ</span>
        input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å†…å®¹ä¸ºï¼š\n"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-466"><a class="markdownIt-Anchor" href="#-466">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%86%85%E5%AD%98%E5%AD%97%E8%8A%82%E6%B5%81">#</a>å†…å­˜å­—èŠ‚æµ</h4>
<p><code>ByteArrayInputStream</code>  å’Œ  <code>ByteArrayOutputStream</code>  æ˜¯ç”¨æ¥å®Œæˆå†…å­˜çš„è¾“å…¥å’Œè¾“å‡ºåŠŸèƒ½ã€‚</p>
<p>å†…å­˜æ“ä½œæµä¸€èˆ¬åœ¨ç”Ÿæˆä¸€äº›ä¸´æ—¶ä¿¡æ¯æ—¶æ‰ä½¿ç”¨ã€‚ å¦‚æœä¸´æ—¶ä¿¡æ¯ä¿å­˜åœ¨æ–‡ä»¶ä¸­ï¼Œè¿˜éœ€è¦åœ¨æœ‰æ•ˆæœŸè¿‡ååˆ é™¤æ–‡ä»¶ï¼Œè¿™æ ·æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p><code>ByteArrayInputStream</code>  å’Œ  <code>ByteArrayOutputStream</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ByteArrayStreamDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"HELLOWORLD"</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¨éƒ¨ç”±å¤§å†™å­—æ¯ç»„æˆ</span>
        <span class="token class-name">ByteArrayInputStream</span> bis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‡†å¤‡ä»å†…å­˜ByteArrayInputStreamä¸­è¯»å–å†…å®¹</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> bis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> temp<span class="token punctuation">;</span> <span class="token comment">// è¯»å–çš„æ•°å­—å˜ä¸ºå­—ç¬¦</span>
            bos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Character</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å­—ç¬¦å˜ä¸ºå°å†™</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// æ‰€æœ‰çš„æ•°æ®å°±å…¨éƒ¨éƒ½åœ¨ByteArrayOutputStreamä¸­</span>
        <span class="token class-name">String</span> newStr <span class="token operator">=</span> bos<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å–å‡ºå†…å®¹</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            bis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>newStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-467"><a class="markdownIt-Anchor" href="#-467">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E7%AE%A1%E9%81%93%E6%B5%81">#</a>ç®¡é“æµ</h4>
<p>ç®¡é“æµçš„ä¸»è¦ä½œç”¨æ˜¯å¯ä»¥è¿›è¡Œä¸¤ä¸ªçº¿ç¨‹é—´çš„é€šä¿¡ã€‚</p>
<p>å¦‚æœè¦è¿›è¡Œç®¡é“é€šä¿¡ï¼Œåˆ™å¿…é¡»æŠŠ  <code>PipedOutputStream</code>  è¿æ¥åœ¨  <code>PipedInputStream</code>  ä¸Šã€‚ä¸ºæ­¤ï¼Œ <code>PipedOutputStream</code>  ä¸­æä¾›äº†  <code>connect()</code>  æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PipedStreamDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Send</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Receive</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            s<span class="token punctuation">.</span><span class="token function">getPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">getPis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿æ¥ç®¡é“</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">PipedOutputStream</span> pos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token class-name">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            pos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PipedOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®ä¾‹åŒ–è¾“å‡ºæµ</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello World!!!"</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                pos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                pos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * å¾—åˆ°æ­¤çº¿ç¨‹çš„ç®¡é“è¾“å‡ºæµ
         */</span>
        <span class="token class-name">PipedOutputStream</span> <span class="token function">getPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> pos<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Receive</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">PipedInputStream</span> pis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token class-name">Receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            pis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PipedInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                len <span class="token operator">=</span> pis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                pis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶çš„å†…å®¹ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * å¾—åˆ°æ­¤çº¿ç¨‹çš„ç®¡é“è¾“å…¥æµ
         */</span>
        <span class="token class-name">PipedInputStream</span> <span class="token function">getPis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> pis<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-468"><a class="markdownIt-Anchor" href="#-468">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AF%B9%E8%B1%A1%E5%AD%97%E8%8A%82%E6%B5%81">#</a>å¯¹è±¡å­—èŠ‚æµ</h4>
<p><strong>ObjectInputStream å’Œ ObjectOutputStream æ˜¯å¯¹è±¡è¾“å…¥è¾“å‡ºæµï¼Œä¸€èˆ¬ç”¨äºå¯¹è±¡åºåˆ—åŒ–ã€‚</strong></p>
<p>è¿™é‡Œä¸å±•å¼€å™è¿°ï¼Œæƒ³äº†è§£è¯¦ç»†å†…å®¹å’Œç¤ºä¾‹å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html">Java åºåˆ—åŒ–</a></p>
<h4 id="-469"><a class="markdownIt-Anchor" href="#-469">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E6%B5%81">#</a>æ•°æ®æ“ä½œæµ</h4>
<p>æ•°æ®æ“ä½œæµæä¾›äº†æ ¼å¼åŒ–è¯»å…¥å’Œè¾“å‡ºæ•°æ®çš„æ–¹æ³•ï¼Œåˆ†åˆ«ä¸º  <code>DataInputStream</code>  å’Œ  <code>DataOutputStream</code> ã€‚</p>
<p><code>DataInputStream</code>  å’Œ  <code>DataOutputStream</code>  æ ¼å¼åŒ–è¯»å†™æ•°æ®ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataStreamDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> FILEPATH <span class="token operator">=</span> <span class="token string">"temp.log"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token function">write</span><span class="token punctuation">(</span>FILEPATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">read</span><span class="token punctuation">(</span>FILEPATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span> filepath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1.ä½¿ç”¨ File ç±»ç»‘å®šä¸€ä¸ªæ–‡ä»¶</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.æŠŠ File å¯¹è±¡ç»‘å®šåˆ°æµå¯¹è±¡ä¸Š</span>
        <span class="token class-name">DataOutputStream</span> dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.è¿›è¡Œè¯»æˆ–å†™æ“ä½œ</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> names <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"è¡¬è¡£"</span><span class="token punctuation">,</span> <span class="token string">"æ‰‹å¥—"</span><span class="token punctuation">,</span> <span class="token string">"å›´å·¾"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> prices <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">98.3f</span><span class="token punctuation">,</span> <span class="token number">30.3f</span><span class="token punctuation">,</span> <span class="token number">50.5f</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> names<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            dos<span class="token punctuation">.</span><span class="token function">writeChars</span><span class="token punctuation">(</span>names<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dos<span class="token punctuation">.</span><span class="token function">writeChar</span><span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dos<span class="token punctuation">.</span><span class="token function">writeFloat</span><span class="token punctuation">(</span>prices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dos<span class="token punctuation">.</span><span class="token function">writeChar</span><span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dos<span class="token punctuation">.</span><span class="token function">writeChar</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 4.å…³é—­æµ</span>
        dos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">String</span> filepath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1.ä½¿ç”¨ File ç±»ç»‘å®šä¸€ä¸ªæ–‡ä»¶</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.æŠŠ File å¯¹è±¡ç»‘å®šåˆ°æµå¯¹è±¡ä¸Š</span>
        <span class="token class-name">DataInputStream</span> dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.è¿›è¡Œè¯»æˆ–å†™æ“ä½œ</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// æ¥æ”¶åç§°</span>
        <span class="token keyword">float</span> price <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span> <span class="token comment">// æ¥æ”¶ä»·æ ¼</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æ¥æ”¶æ•°é‡</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> temp <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// æ¥æ”¶å•†å“åç§°</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜è¯»å–æ•°æ®çš„ä¸ªæ•°</span>
        <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// '\u0000'</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                temp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å¼€è¾Ÿç©ºé—´</span>
                len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'\t'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ¥æ”¶å†…å®¹</span>
                    temp<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>
                    len<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–é•¿åº¦åŠ 1</span>
                <span class="token punctuation">&#125;</span>
                name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>temp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å­—ç¬¦æ•°ç»„å˜ä¸ºString</span>
                price <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–ä»·æ ¼</span>
                dis<span class="token punctuation">.</span><span class="token function">readChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–\t</span>
                num <span class="token operator">=</span> dis<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–int</span>
                dis<span class="token punctuation">.</span><span class="token function">readChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–\n</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"åç§°ï¼š%sï¼›ä»·æ ¼ï¼š%5.2fï¼›æ•°é‡ï¼š%d\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> price<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">EOFException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 4.å…³é—­æµ</span>
        dis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-470"><a class="markdownIt-Anchor" href="#-470">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%90%88%E5%B9%B6%E6%B5%81">#</a>åˆå¹¶æµ</h4>
<p>åˆå¹¶æµçš„ä¸»è¦åŠŸèƒ½æ˜¯å°†å¤šä¸ª  <code>InputStream</code>  åˆå¹¶ä¸ºä¸€ä¸ª  <code>InputStream</code>  æµã€‚åˆå¹¶æµçš„åŠŸèƒ½ç”±  <code>SequenceInputStream</code>  å®Œæˆã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SequenceInputStreamDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">InputStream</span> is1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"temp1.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> is2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"temp2.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SequenceInputStream</span> sis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SequenceInputStream</span><span class="token punctuation">(</span>is1<span class="token punctuation">,</span> is2<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æ¥æ”¶å†…å®¹</span>
        <span class="token class-name">OutputStream</span> os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"temp3.logt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> sis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¾ªç¯è¾“å‡º</span>
            os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜å†…å®¹</span>
        <span class="token punctuation">&#125;</span>

        sis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…³é—­åˆå¹¶æµ</span>
        is1<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…³é—­è¾“å…¥æµ1</span>
        is2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…³é—­è¾“å…¥æµ2</span>
        os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…³é—­è¾“å‡ºæµ</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-471"><a class="markdownIt-Anchor" href="#-471">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AD%97%E7%AC%A6%E6%B5%81">#</a>å­—ç¬¦æµ</h3>
<p>å­—ç¬¦æµä¸»è¦æ“ä½œå­—ç¬¦ï¼Œä¸€ä¸ªå­—ç¬¦ç­‰äºä¸¤ä¸ªå­—èŠ‚ã€‚</p>
<p>å­—ç¬¦æµæœ‰ä¸¤ä¸ªæ ¸å¿ƒç±»ï¼š <code>Reader</code>  ç±»å’Œ  <code>Writer</code>  ã€‚æ‰€æœ‰çš„å­—ç¬¦æµç±»éƒ½ç»§æ‰¿è‡ªè¿™ä¸¤ä¸ªæŠ½è±¡ç±»ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200219133648.png" alt="img"></p>
<h4 id="-472"><a class="markdownIt-Anchor" href="#-472">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E6%96%87%E4%BB%B6%E5%AD%97%E7%AC%A6%E6%B5%81">#</a>æ–‡ä»¶å­—ç¬¦æµ</h4>
<p>æ–‡ä»¶å­—ç¬¦æµ  <code>FileReader</code>  å’Œ  <code>FileWriter</code>  å¯ä»¥å‘æ–‡ä»¶è¯»å†™æ–‡æœ¬æ•°æ®ã€‚</p>
<p><code>FileReader</code>  å’Œ  <code>FileWriter</code>  è¯»å†™æ–‡ä»¶ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileReadWriteDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> FILEPATH <span class="token operator">=</span> <span class="token string">"temp.log"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token function">write</span><span class="token punctuation">(</span>FILEPATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å†…å®¹ä¸ºï¼š"</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>FILEPATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span> filepath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1.ä½¿ç”¨ File ç±»ç»‘å®šä¸€ä¸ªæ–‡ä»¶</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.æŠŠ File å¯¹è±¡ç»‘å®šåˆ°æµå¯¹è±¡ä¸Š</span>
        <span class="token class-name">Writer</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileWriter</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Writer out = new FileWriter(f, true); // è¿½åŠ å†…å®¹æ–¹å¼</span>

        <span class="token comment">// 3.è¿›è¡Œè¯»æˆ–å†™æ“ä½œ</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"Hello World!!!\r\n"</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4.å…³é—­æµ</span>
        <span class="token comment">// å­—ç¬¦æµæ“ä½œæ—¶ä½¿ç”¨äº†ç¼“å†²åŒºï¼Œå¹¶åœ¨å…³é—­å­—ç¬¦æµæ—¶ä¼šå¼ºåˆ¶å°†ç¼“å†²åŒºå†…å®¹è¾“å‡º</span>
        <span class="token comment">// å¦‚æœä¸å…³é—­æµï¼Œåˆ™ç¼“å†²åŒºçš„å†…å®¹æ˜¯æ— æ³•è¾“å‡ºçš„</span>
        <span class="token comment">// å¦‚æœæƒ³åœ¨ä¸å…³é—­æµæ—¶ï¼Œå°†ç¼“å†²åŒºå†…å®¹è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ flush å¼ºåˆ¶æ¸…ç©ºç¼“å†²åŒº</span>
        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">String</span> filepath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1.ä½¿ç”¨ File ç±»ç»‘å®šä¸€ä¸ªæ–‡ä»¶</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2.æŠŠ File å¯¹è±¡ç»‘å®šåˆ°æµå¯¹è±¡ä¸Š</span>
        <span class="token class-name">Reader</span> input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3.è¿›è¡Œè¯»æˆ–å†™æ“ä½œ</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æ¥æ”¶æ¯ä¸€ä¸ªå†…å®¹</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–å†…å®¹</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// å¦‚æœä¸æ˜¯-1å°±è¡¨ç¤ºè¿˜æœ‰å†…å®¹ï¼Œå¯ä»¥ç»§ç»­è¯»å–</span>
            c<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> temp<span class="token punctuation">;</span>
            len<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶å­—ç¬¦æ•°ä¸ºï¼š"</span> <span class="token operator">+</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4.å…³é—­æµ</span>
        input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-473"><a class="markdownIt-Anchor" href="#-473">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AD%97%E8%8A%82%E6%B5%81%E8%BD%AC%E6%8D%A2%E5%AD%97%E7%AC%A6%E6%B5%81">#</a>å­—èŠ‚æµè½¬æ¢å­—ç¬¦æµ</h4>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ç¨‹åºä¸­é€šè¿‡  <code>InputStream</code>  å’Œ  <code>Reader</code>  ä»æ•°æ®æºä¸­è¯»å–æ•°æ®ï¼Œç„¶åä¹Ÿå¯ä»¥åœ¨ç¨‹åºä¸­å°†æ•°æ®é€šè¿‡  <code>OutputStream</code>  å’Œ  <code>Writer</code>  è¾“å‡ºåˆ°ç›®æ ‡åª’ä»‹ä¸­</p>
<p>ä½¿ç”¨  <code>InputStreamReader</code>  å¯ä»¥å°†è¾“å…¥å­—èŠ‚æµè½¬åŒ–ä¸ºè¾“å…¥å­—ç¬¦æµï¼›ä½¿ç”¨ <code>OutputStreamWriter</code>  å¯ä»¥å°†è¾“å‡ºå­—èŠ‚æµè½¬åŒ–ä¸ºè¾“å‡ºå­—ç¬¦æµã€‚</p>
<p><code>OutputStreamWriter</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OutputStreamWriterDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"temp.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Writer</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OutputStreamWriter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello world!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>InputStreamReader</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InputStreamReaderDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"temp.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Reader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-474"><a class="markdownIt-Anchor" href="#-474">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io.html#%E5%AD%97%E8%8A%82%E6%B5%81-vs-%E5%AD%97%E7%AC%A6%E6%B5%81">#</a>å­—èŠ‚æµ vs. å­—ç¬¦æµ</h3>
<p>ç›¸åŒç‚¹ï¼š</p>
<p>å­—èŠ‚æµå’Œå­—ç¬¦æµéƒ½æœ‰  <code>read()</code> ã€ <code>write()</code> ã€ <code>flush()</code> ã€ <code>close()</code>  è¿™æ ·çš„æ–¹æ³•ï¼Œè¿™å†³å®šäº†å®ƒä»¬çš„æ“ä½œæ–¹å¼è¿‘ä¼¼ã€‚</p>
<p>ä¸åŒç‚¹ï¼š</p>
<ul>
<li>æ•°æ®ç±»å‹
<ul>
<li>å­—èŠ‚æµçš„æ•°æ®æ˜¯å­—èŠ‚ï¼ˆäºŒè¿›åˆ¶å¯¹è±¡ï¼‰ã€‚ä¸»è¦æ ¸å¿ƒç±»æ˜¯  <code>InputStream</code>  ç±»å’Œ  <code>OutputStream</code>  ç±»ã€‚</li>
<li>å­—ç¬¦æµçš„æ•°æ®æ˜¯å­—ç¬¦ï¼Œä¸€ä¸ªå­—ç¬¦ç­‰äºä¸¤ä¸ªå­—èŠ‚ã€‚ä¸»è¦æ ¸å¿ƒç±»æ˜¯  <code>Reader</code>  ç±»å’Œ  <code>Writer</code>  ç±»ã€‚</li>
</ul>
</li>
<li>ç¼“å†²åŒº
<ul>
<li>å­—èŠ‚æµåœ¨æ“ä½œæ—¶æœ¬èº«ä¸ä¼šç”¨åˆ°ç¼“å†²åŒºï¼ˆå†…å­˜ï¼‰ï¼Œæ˜¯æ–‡ä»¶ç›´æ¥æ“ä½œçš„ã€‚</li>
<li>å­—ç¬¦æµåœ¨æ“ä½œæ—¶æ˜¯ä½¿ç”¨äº†ç¼“å†²åŒºï¼Œé€šè¿‡ç¼“å†²åŒºå†æ“ä½œæ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<p>é€‰æ‹©ï¼š</p>
<p>æ‰€æœ‰çš„æ–‡ä»¶åœ¨ç¡¬ç›˜æˆ–ä¼ è¾“æ—¶éƒ½æ˜¯ä»¥å­—èŠ‚æ–¹å¼ä¿å­˜çš„ï¼Œä¾‹å¦‚å›¾ç‰‡ï¼Œå½±éŸ³æ–‡ä»¶ç­‰éƒ½æ˜¯æŒ‰å­—èŠ‚æ–¹å¼å­˜å‚¨çš„ã€‚å­—ç¬¦æµæ— æ³•è¯»å†™è¿™äº›æ–‡ä»¶ã€‚</p>
<p>æ‰€ä»¥ï¼Œé™¤äº†çº¯æ–‡æœ¬æ•°æ®æ–‡ä»¶ä½¿ç”¨å­—ç¬¦æµä»¥å¤–ï¼Œå…¶ä»–æ–‡ä»¶ç±»å‹éƒ½åº”è¯¥ä½¿ç”¨å­—èŠ‚æµæ–¹å¼ã€‚</p>
<hr>
<h1 id="java-nio"><a class="markdownIt-Anchor" href="#java-nio">#</a> Java NIO</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>å…³é”®è¯ï¼š <code>Channel</code> ã€ <code>Buffer</code> ã€ <code>Selector</code> ã€ <code>éé˜»å¡</code> ã€ <code>å¤šè·¯å¤ç”¨</code></p>
</blockquote>
<ul>
<li>ä¸€ã€NIO ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#nio-%E5%92%8C-bio-%E7%9A%84%E5%8C%BA%E5%88%AB">NIO å’Œ BIO çš„åŒºåˆ«</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#nio-%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B">NIO çš„åŸºæœ¬æµç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#nio-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">NIO æ ¸å¿ƒç»„ä»¶</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%BA%8Cchannel%E9%80%9A%E9%81%93">äºŒã€Channel (é€šé“)</a></li>
<li>ä¸‰ã€Buffer (ç¼“å†²åŒº)
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F">ç¼“å†²åŒºçŠ¶æ€å˜é‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E6%96%87%E4%BB%B6-nio-%E7%A4%BA%E4%BE%8B">æ–‡ä»¶ NIO ç¤ºä¾‹</a></li>
</ul>
</li>
<li>å››ã€Selector (é€‰æ‹©å™¨)
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%88%9B%E5%BB%BA%E9%80%89%E6%8B%A9%E5%99%A8">åˆ›å»ºé€‰æ‹©å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%B0%86%E9%80%9A%E9%81%93%E6%B3%A8%E5%86%8C%E5%88%B0%E9%80%89%E6%8B%A9%E5%99%A8%E4%B8%8A">å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6">ç›‘å¬äº‹ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E8%8E%B7%E5%8F%96%E5%88%B0%E8%BE%BE%E7%9A%84%E4%BA%8B%E4%BB%B6">è·å–åˆ°è¾¾çš„äº‹ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF">äº‹ä»¶å¾ªç¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%A5%97%E6%8E%A5%E5%AD%97-nio-%E7%A4%BA%E4%BE%8B">å¥—æ¥å­— NIO ç¤ºä¾‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6">å†…å­˜æ˜ å°„æ–‡ä»¶</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%BA%94nio-vs-bio">äº”ã€NIO vs. BIO</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-475"><a class="markdownIt-Anchor" href="#-475">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%B8%80%E3%80%81nio-%E7%AE%80%E4%BB%8B">#</a>ä¸€ã€NIO ç®€ä»‹</h2>
<p>NIO æ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„ I/O æ¨¡å‹ï¼Œåœ¨ Java 1.4 ä¸­å¼•å…¥äº† NIO æ¡†æ¶ï¼Œå¯¹åº”  <code>java.nio</code>  åŒ…ï¼Œæä¾›äº†  <code>Channel</code>  ã€ <code>Selector</code> ã€ <code>Buffer</code>  ç­‰æŠ½è±¡ã€‚</p>
<p>NIO ä¸­çš„ N å¯ä»¥ç†è§£ä¸º Non-blockingï¼Œä¸å•çº¯æ˜¯ Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„ I/O æ“ä½œæ–¹æ³•ã€‚ NIO æä¾›äº†ä¸ä¼ ç»Ÿ BIO æ¨¡å‹ä¸­çš„  <code>Socket</code>  å’Œ  <code>ServerSocket</code>  ç›¸å¯¹åº”çš„  <code>SocketChannel</code>  å’Œ  <code>ServerSocketChannel</code>  ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°ï¼Œä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚é˜»å¡æ¨¡å¼ä½¿ç”¨å°±åƒä¼ ç»Ÿä¸­çš„æ”¯æŒä¸€æ ·ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ€§èƒ½å’Œå¯é æ€§éƒ½ä¸å¥½ï¼›éé˜»å¡æ¨¡å¼æ­£å¥½ä¸ä¹‹ç›¸åã€‚å¯¹äºä½è´Ÿè½½ã€ä½å¹¶å‘çš„åº”ç”¨ç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨åŒæ­¥é˜»å¡ I/O æ¥æå‡å¼€å‘é€Ÿç‡å’Œæ›´å¥½çš„ç»´æŠ¤æ€§ï¼›å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘ã€‚</p>
<h3 id="-476"><a class="markdownIt-Anchor" href="#-476">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#nio-%E5%92%8C-bio-%E7%9A%84%E5%8C%BA%E5%88%AB">#</a>NIO å’Œ BIO çš„åŒºåˆ«</h3>
<h4 id="-477"><a class="markdownIt-Anchor" href="#-477">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#non-blocking-io-%E9%9D%9E%E9%98%BB%E5%A1%9E">#</a>Non-blocking IO (éé˜»å¡)</h4>
<p><strong>BIO æ˜¯é˜»å¡çš„ï¼ŒNIO æ˜¯éé˜»å¡çš„</strong>ã€‚</p>
<p>BIO çš„å„ç§æµæ˜¯é˜»å¡çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨  <code>read()</code>  æˆ–  <code>write()</code>  æ—¶ï¼Œè¯¥çº¿ç¨‹è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰ä¸€äº›æ•°æ®è¢«è¯»å–ï¼Œæˆ–æ•°æ®å®Œå…¨å†™å…¥ã€‚åœ¨æ­¤æœŸé—´ï¼Œè¯¥çº¿ç¨‹ä¸èƒ½å†å¹²å…¶ä»–ä»»ä½•äº‹ã€‚</p>
<p>NIO ä½¿æˆ‘ä»¬å¯ä»¥è¿›è¡Œéé˜»å¡ IO æ“ä½œã€‚æ¯”å¦‚è¯´ï¼Œå•çº¿ç¨‹ä¸­ä»é€šé“è¯»å–æ•°æ®åˆ° bufferï¼ŒåŒæ—¶å¯ä»¥ç»§ç»­åšåˆ«çš„äº‹æƒ…ï¼Œå½“æ•°æ®è¯»å–åˆ° buffer ä¸­åï¼Œçº¿ç¨‹å†ç»§ç»­å¤„ç†æ•°æ®ã€‚å†™æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å¦å¤–ï¼Œéé˜»å¡å†™ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚</p>
<h4 id="-478"><a class="markdownIt-Anchor" href="#-478">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#buffer-%E7%BC%93%E5%86%B2%E5%8C%BA">#</a>Buffer (ç¼“å†²åŒº)</h4>
<p><strong>BIO é¢å‘æµ (Stream oriented)ï¼Œè€Œ NIO é¢å‘ç¼“å†²åŒº (Buffer oriented)</strong>ã€‚</p>
<p>Buffer æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¦è¯»å‡ºçš„æ•°æ®ã€‚åœ¨ NIO ç±»åº“ä¸­åŠ å…¥ Buffer å¯¹è±¡ï¼Œä½“ç°äº† NIO ä¸ BIO çš„ä¸€ä¸ªé‡è¦åŒºåˆ«ã€‚åœ¨é¢å‘æµçš„ BIO ä¸­å¯ä»¥å°†æ•°æ®ç›´æ¥å†™å…¥æˆ–è€…å°†æ•°æ®ç›´æ¥è¯»åˆ° Stream å¯¹è±¡ä¸­ã€‚è™½ç„¶ Stream ä¸­ä¹Ÿæœ‰ Buffer å¼€å¤´çš„æ‰©å±•ç±»ï¼Œä½†åªæ˜¯æµçš„åŒ…è£…ç±»ï¼Œè¿˜æ˜¯ä»æµè¯»åˆ°ç¼“å†²åŒºï¼Œè€Œ NIO å´æ˜¯ç›´æ¥è¯»åˆ° Buffer ä¸­è¿›è¡Œæ“ä½œã€‚</p>
<p>åœ¨ NIO åä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼›åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå†™å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚ä»»ä½•æ—¶å€™è®¿é—® NIO ä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯é€šè¿‡ç¼“å†²åŒºè¿›è¡Œæ“ä½œã€‚</p>
<p>æœ€å¸¸ç”¨çš„ç¼“å†²åŒºæ˜¯ ByteBuffer, ä¸€ä¸ª ByteBuffer æä¾›äº†ä¸€ç»„åŠŸèƒ½ç”¨äºæ“ä½œ byte æ•°ç»„ã€‚é™¤äº† ByteBuffer, è¿˜æœ‰å…¶ä»–çš„ä¸€äº›ç¼“å†²åŒºï¼Œäº‹å®ä¸Šï¼Œæ¯ä¸€ç§ Java åŸºæœ¬ç±»å‹ï¼ˆé™¤äº† Boolean ç±»å‹ï¼‰éƒ½å¯¹åº”æœ‰ä¸€ç§ç¼“å†²åŒºã€‚</p>
<h4 id="-479"><a class="markdownIt-Anchor" href="#-479">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#channel-%E9%80%9A%E9%81%93">#</a>Channel (é€šé“)</h4>
<p>NIO é€šè¿‡ Channelï¼ˆé€šé“ï¼‰ è¿›è¡Œè¯»å†™ã€‚</p>
<p>é€šé“æ˜¯åŒå‘çš„ï¼Œå¯è¯»ä¹Ÿå¯å†™ï¼Œè€Œæµçš„è¯»å†™æ˜¯å•å‘çš„ã€‚æ— è®ºè¯»å†™ï¼Œé€šé“åªèƒ½å’Œ Buffer äº¤äº’ã€‚å› ä¸º Bufferï¼Œé€šé“å¯ä»¥å¼‚æ­¥åœ°è¯»å†™ã€‚</p>
<h4 id="-480"><a class="markdownIt-Anchor" href="#-480">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#selector-%E9%80%89%E6%8B%A9%E5%99%A8">#</a>Selector (é€‰æ‹©å™¨)</h4>
<p>NIO æœ‰é€‰æ‹©å™¨ï¼Œè€Œ IO æ²¡æœ‰ã€‚</p>
<p>é€‰æ‹©å™¨ç”¨äºä½¿ç”¨å•ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªé€šé“ã€‚å› æ­¤ï¼Œå®ƒéœ€è¦è¾ƒå°‘çš„çº¿ç¨‹æ¥å¤„ç†è¿™äº›é€šé“ã€‚çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢å¯¹äºæ“ä½œç³»ç»Ÿæ¥è¯´æ˜¯æ˜‚è´µçš„ã€‚ å› æ­¤ï¼Œä¸ºäº†æé«˜ç³»ç»Ÿæ•ˆç‡é€‰æ‹©å™¨æ˜¯æœ‰ç”¨çš„ã€‚</p>
<h3 id="-481"><a class="markdownIt-Anchor" href="#-481">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#nio-%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B">#</a>NIO çš„åŸºæœ¬æµç¨‹</h3>
<p>é€šå¸¸æ¥è¯´ NIO ä¸­çš„æ‰€æœ‰ IO éƒ½æ˜¯ä» Channelï¼ˆé€šé“ï¼‰ å¼€å§‹çš„ã€‚</p>
<ul>
<li>ä»é€šé“è¿›è¡Œæ•°æ®è¯»å– ï¼šåˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œç„¶åè¯·æ±‚é€šé“è¯»å–æ•°æ®ã€‚</li>
<li>ä»é€šé“è¿›è¡Œæ•°æ®å†™å…¥ ï¼šåˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œå¡«å……æ•°æ®ï¼Œå¹¶è¦æ±‚é€šé“å†™å…¥æ•°æ®ã€‚</li>
</ul>
<h3 id="-482"><a class="markdownIt-Anchor" href="#-482">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#nio-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6">#</a>NIO æ ¸å¿ƒç»„ä»¶</h3>
<p>NIO åŒ…å«ä¸‹é¢å‡ ä¸ªæ ¸å¿ƒçš„ç»„ä»¶ï¼š</p>
<ul>
<li><strong>Channel (é€šé“)</strong></li>
<li><strong>Buffer (ç¼“å†²åŒº)</strong></li>
<li><strong>Selector (é€‰æ‹©å™¨)</strong></li>
</ul>
<h2 id="-483"><a class="markdownIt-Anchor" href="#-483">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%BA%8C%E3%80%81channel-%E9%80%9A%E9%81%93">#</a>äºŒã€Channel (é€šé“)</h2>
<p>é€šé“ï¼ˆ <code>Channel</code> ï¼‰æ˜¯å¯¹ BIO ä¸­çš„æµçš„æ¨¡æ‹Ÿï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å†™æ•°æ®ã€‚</p>
<p>Channelï¼Œç±»ä¼¼åœ¨ Linux ä¹‹ç±»æ“ä½œç³»ç»Ÿä¸Šçœ‹åˆ°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ˜¯ NIO ä¸­è¢«ç”¨æ¥æ”¯æŒæ‰¹é‡å¼ IO æ“ä½œçš„ä¸€ç§æŠ½è±¡ã€‚</p>
<p>File æˆ–è€… Socketï¼Œé€šå¸¸è¢«è®¤ä¸ºæ˜¯æ¯”è¾ƒé«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œè€Œ Channel åˆ™æ˜¯æ›´åŠ æ“ä½œç³»ç»Ÿåº•å±‚çš„ä¸€ç§æŠ½è±¡ï¼Œè¿™ä¹Ÿä½¿å¾— NIO å¾—ä»¥å……åˆ†åˆ©ç”¨ç°ä»£æ“ä½œç³»ç»Ÿåº•å±‚æœºåˆ¶ï¼Œè·å¾—ç‰¹å®šåœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¾‹å¦‚ï¼ŒDMAï¼ˆDirect Memory Accessï¼‰ç­‰ã€‚ä¸åŒå±‚æ¬¡çš„æŠ½è±¡æ˜¯ç›¸äº’å…³è”çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Socket è·å– Channelï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<p>é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼š</p>
<ul>
<li><strong>æµæ˜¯å•å‘çš„</strong> - ä¸€ä¸ªæµåªèƒ½å•çº¯çš„è´Ÿè´£è¯»æˆ–å†™ã€‚</li>
<li><strong>é€šé“æ˜¯åŒå‘çš„</strong> - ä¸€ä¸ªé€šé“å¯ä»¥åŒæ—¶ç”¨äºè¯»å†™ã€‚</li>
</ul>
<p>é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li><code>FileChannel</code> ï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼›</li>
<li><code>DatagramChannel</code> ï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</li>
<li><code>SocketChannel</code> ï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›</li>
<li><code>ServerSocketChannel</code> ï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelã€‚</li>
</ul>
<h2 id="-484"><a class="markdownIt-Anchor" href="#-484">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%B8%89%E3%80%81buffer-%E7%BC%93%E5%86%B2%E5%8C%BA">#</a>ä¸‰ã€Buffer (ç¼“å†²åŒº)</h2>
<p>NIO ä¸ä¼ ç»Ÿ I/O ä¸åŒï¼Œå®ƒæ˜¯åŸºäºå—ï¼ˆBlockï¼‰çš„ï¼Œå®ƒä»¥å—ä¸ºåŸºæœ¬å•ä½å¤„ç†æ•°æ®ã€‚ <code>Buffer</code>  æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜å—ï¼Œæ˜¯ NIO è¯»å†™æ•°æ®çš„ç¼“å†²ã€‚ <code>Buffer</code>  å¯ä»¥å°†æ–‡ä»¶ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜å†åšåç»­å¤„ç†ï¼Œè€Œä¼ ç»Ÿçš„æ–¹å¼æ˜¯è¾¹è¯»æ–‡ä»¶è¾¹å¤„ç†æ•°æ®ã€‚</p>
<p><strong>å‘  <code>Channel</code>  è¯»å†™çš„æ•°æ®éƒ½å¿…é¡»å…ˆç½®äºç¼“å†²åŒºä¸­</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯» / å†™è¿›ç¨‹ã€‚</p>
<p>BIO å’Œ NIO å·²ç»å¾ˆå¥½åœ°é›†æˆäº†ï¼Œ <code>java.io.*</code>  å·²ç»ä»¥ NIO ä¸ºåŸºç¡€é‡æ–°å®ç°äº†ï¼Œæ‰€ä»¥ç°åœ¨å®ƒå¯ä»¥åˆ©ç”¨ NIO çš„ä¸€äº›ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œ <code>java.io.*</code>  åŒ…ä¸­çš„ä¸€äº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å³ä½¿åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚</p>
<p>ç¼“å†²åŒºåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š</p>
<ul>
<li><code>ByteBuffer</code></li>
<li><code>CharBuffer</code></li>
<li><code>ShortBuffer</code></li>
<li><code>IntBuffer</code></li>
<li><code>LongBuffer</code></li>
<li><code>FloatBuffer</code></li>
<li><code>DoubleBuffer</code></li>
</ul>
<h3 id="-485"><a class="markdownIt-Anchor" href="#-485">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F">#</a>ç¼“å†²åŒºçŠ¶æ€å˜é‡</h3>
<ul>
<li><code>capacity</code> ï¼šæœ€å¤§å®¹é‡ï¼›</li>
<li><code>position</code> ï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼›</li>
<li><code>limit</code> ï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚</li>
<li><code>mark</code> ï¼šè®°å½•ä¸Šä¸€æ¬¡ postion çš„ä½ç½®ï¼Œé»˜è®¤æ˜¯ 0ï¼Œç®—æ˜¯ä¸€ä¸ªä¾¿åˆ©æ€§çš„è€ƒè™‘ï¼Œå¾€å¾€ä¸æ˜¯å¿…é¡» çš„ã€‚</li>
</ul>
<p>ç¼“å†²åŒºçŠ¶æ€å˜é‡çš„æ”¹å˜è¿‡ç¨‹ä¸¾ä¾‹ï¼š</p>
<ol>
<li>æ–°å»ºä¸€ä¸ªå¤§å°ä¸º 8 ä¸ªå­—èŠ‚çš„ç¼“å†²åŒºï¼Œæ­¤æ—¶ position ä¸º 0ï¼Œè€Œ limit = capacity = 8ã€‚capacity å˜é‡ä¸ä¼šæ”¹å˜ï¼Œä¸‹é¢çš„è®¨è®ºä¼šå¿½ç•¥å®ƒã€‚</li>
<li>ä»è¾“å…¥é€šé“ä¸­è¯»å– 5 ä¸ªå­—èŠ‚æ•°æ®å†™å…¥ç¼“å†²åŒºä¸­ï¼Œæ­¤æ—¶ position ç§»åŠ¨è®¾ç½®ä¸º 5ï¼Œlimit ä¿æŒä¸å˜ã€‚</li>
<li>åœ¨å°†ç¼“å†²åŒºçš„æ•°æ®å†™åˆ°è¾“å‡ºé€šé“ä¹‹å‰ï¼Œéœ€è¦å…ˆè°ƒç”¨ flip () æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°† limit è®¾ç½®ä¸ºå½“å‰ positionï¼Œå¹¶å°† position è®¾ç½®ä¸º 0ã€‚</li>
<li>ä»ç¼“å†²åŒºä¸­å– 4 ä¸ªå­—èŠ‚åˆ°è¾“å‡ºç¼“å†²ä¸­ï¼Œæ­¤æ—¶ position è®¾ä¸º 4ã€‚</li>
<li>æœ€åéœ€è¦è°ƒç”¨ clear () æ–¹æ³•æ¥æ¸…ç©ºç¼“å†²åŒºï¼Œæ­¤æ—¶ position å’Œ limit éƒ½è¢«è®¾ç½®ä¸ºæœ€åˆä½ç½®ã€‚</li>
</ol>
<h3 id="-486"><a class="markdownIt-Anchor" href="#-486">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E6%96%87%E4%BB%B6-nio-%E7%A4%BA%E4%BE%8B">#</a>æ–‡ä»¶ NIO ç¤ºä¾‹</h3>
<p>ä»¥ä¸‹å±•ç¤ºäº†ä½¿ç”¨ NIO å¿«é€Ÿå¤åˆ¶æ–‡ä»¶çš„å®ä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fastCopy</span><span class="token punctuation">(</span><span class="token class-name">String</span> src<span class="token punctuation">,</span> <span class="token class-name">String</span> dist<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">/* è·å¾—æºæ–‡ä»¶çš„è¾“å…¥å­—èŠ‚æµ */</span>
    <span class="token class-name">FileInputStream</span> fin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* è·å–è¾“å…¥å­—èŠ‚æµçš„æ–‡ä»¶é€šé“ */</span>
    <span class="token class-name">FileChannel</span> fcin <span class="token operator">=</span> fin<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* è·å–ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºå­—èŠ‚æµ */</span>
    <span class="token class-name">FileOutputStream</span> fout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* è·å–è¾“å‡ºå­—èŠ‚æµçš„é€šé“ */</span>
    <span class="token class-name">FileChannel</span> fcout <span class="token operator">=</span> fout<span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* ä¸ºç¼“å†²åŒºåˆ†é… 1024 ä¸ªå­—èŠ‚ */</span>
    <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocateDirect</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">/* ä»è¾“å…¥é€šé“ä¸­è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºä¸­ */</span>
        <span class="token keyword">int</span> r <span class="token operator">=</span> fcin<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* read() è¿”å› -1 è¡¨ç¤º EOF */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">/* åˆ‡æ¢è¯»å†™ */</span>
        buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* æŠŠç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¾“å‡ºæ–‡ä»¶ä¸­ */</span>
        fcout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* æ¸…ç©ºç¼“å†²åŒº */</span>
        buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-487"><a class="markdownIt-Anchor" href="#-487">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#directbuffer">#</a>DirectBuffer</h3>
<p>NIO è¿˜æä¾›äº†ä¸€ä¸ªå¯ä»¥ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜çš„ç±»  <code>DirectBuffer</code> ã€‚æ™®é€šçš„  <code>Buffer</code>  åˆ†é…çš„æ˜¯ JVM å †å†…å­˜ï¼Œè€Œ  <code>DirectBuffer</code>  æ˜¯ç›´æ¥åˆ†é…ç‰©ç†å†…å­˜ã€‚</p>
<p>æ•°æ®è¦è¾“å‡ºåˆ°å¤–éƒ¨è®¾å¤‡ï¼Œå¿…é¡»å…ˆä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œå†å¤åˆ¶åˆ°è¾“å‡ºè®¾å¤‡ï¼Œè€Œ  <code>DirectBuffer</code>  åˆ™æ˜¯ç›´æ¥å°†æ­¥éª¤ç®€åŒ–ä¸ºä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°å¤–éƒ¨è®¾å¤‡ï¼Œå‡å°‘äº†æ•°æ®æ‹·è´ã€‚</p>
<p>è¿™é‡Œæ‹“å±•ä¸€ç‚¹ï¼Œç”±äº  <code>DirectBuffer</code>  ç”³è¯·çš„æ˜¯é JVM çš„ç‰©ç†å†…å­˜ï¼Œæ‰€ä»¥åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·å¾ˆé«˜ã€‚ <code>DirectBuffer</code>  ç”³è¯·çš„å†…å­˜å¹¶ä¸æ˜¯ç›´æ¥ç”± JVM è´Ÿè´£åƒåœ¾å›æ”¶ï¼Œä½†åœ¨  <code>DirectBuffer</code>  åŒ…è£…ç±»è¢«å›æ”¶æ—¶ï¼Œä¼šé€šè¿‡ Java å¼•ç”¨æœºåˆ¶æ¥é‡Šæ”¾è¯¥å†…å­˜å—ã€‚</p>
<h2 id="-488"><a class="markdownIt-Anchor" href="#-488">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%9B%9B%E3%80%81selector-%E9%80%89%E6%8B%A9%E5%99%A8">#</a>å››ã€Selector (é€‰æ‹©å™¨)</h2>
<p>NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p>
<p><code>Selector</code>  æ˜¯ Java NIO ç¼–ç¨‹çš„åŸºç¡€ã€‚ç”¨äºæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ª NIO  <code>Channel</code>  çš„çŠ¶æ€æ˜¯å¦å¤„äºå¯è¯»ã€å¯å†™ã€‚</p>
<p><strong>NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹</strong>ï¼š</p>
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹ï¼ˆ <code>Thread</code> ï¼‰ä½¿ç”¨ä¸€ä¸ª<strong>é€‰æ‹©å™¨  <code>Selector</code>  é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“  <code>Channel</code>  ä¸Šçš„äº‹ä»¶ï¼ˆ <code>accpet</code> ã€ <code>read</code> ï¼‰</strong>ï¼Œå¦‚æœæŸä¸ª  <code>Channel</code>  ä¸Šé¢å‘ç”Ÿç›‘å¬äº‹ä»¶ï¼Œè¿™ä¸ª  <code>Channel</code>  å°±å¤„äºå°±ç»ªçŠ¶æ€ï¼Œç„¶åè¿›è¡Œ I/O æ“ä½œã€‚</li>
<li>é€šè¿‡<strong>é…ç½®ç›‘å¬çš„é€šé“  <code>Channel</code>  ä¸ºéé˜»å¡</strong>ï¼Œé‚£ä¹ˆå½“  <code>Channel</code>  ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ  <code>Channel</code> ï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„  <code>Channel</code>  æ‰§è¡Œã€‚</li>
<li>å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨<strong>ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶</strong>è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰  <code>SocketChannel</code>  æ‰èƒ½é…ç½®ä¸ºéé˜»å¡ï¼Œè€Œ  <code>FileChannel</code>  ä¸èƒ½ï¼Œå› ä¸º  <code>FileChannel</code>  é…ç½®éé˜»å¡ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚</p>
<blockquote>
<p>ç›®å‰æ“ä½œç³»ç»Ÿçš„ I/O å¤šè·¯å¤ç”¨æœºåˆ¶éƒ½ä½¿ç”¨äº† epollï¼Œç›¸æ¯”ä¼ ç»Ÿçš„ select æœºåˆ¶ï¼Œepoll æ²¡æœ‰æœ€å¤§è¿æ¥å¥æŸ„ 1024 çš„é™åˆ¶ã€‚æ‰€ä»¥ Selector åœ¨ç†è®ºä¸Šå¯ä»¥è½®è¯¢æˆåƒä¸Šä¸‡çš„å®¢æˆ·ç«¯ã€‚</p>
</blockquote>
<h3 id="-489"><a class="markdownIt-Anchor" href="#-489">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%88%9B%E5%BB%BA%E9%80%89%E6%8B%A9%E5%99%A8">#</a>åˆ›å»ºé€‰æ‹©å™¨</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-490"><a class="markdownIt-Anchor" href="#-490">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%B0%86%E9%80%9A%E9%81%93%E6%B3%A8%E5%86%8C%E5%88%B0%E9%80%89%E6%8B%A9%E5%99%A8%E4%B8%8A">#</a>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ServerSocketChannel</span> ssChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ssChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ssChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚</p>
<p>åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li><code>SelectionKey.OP_CONNECT</code></li>
<li><code>SelectionKey.OP_ACCEPT</code></li>
<li><code>SelectionKey.OP_READ</code></li>
<li><code>SelectionKey.OP_WRITE</code></li>
</ul>
<p>å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_READ <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_WRITE <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_CONNECT <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> OP_ACCEPT <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> interestSet <span class="token operator">=</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ <span class="token operator">|</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_WRITE<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-491"><a class="markdownIt-Anchor" href="#-491">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E7%9B%91%E5%90%AC%E4%BA%8B%E4%BB%B6">#</a>ç›‘å¬äº‹ä»¶</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> num <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä½¿ç”¨  <code>select()</code>  æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚</p>
<h3 id="-492"><a class="markdownIt-Anchor" href="#-492">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E8%8E%B7%E5%8F%96%E5%88%B0%E8%BE%BE%E7%9A%84%E4%BA%8B%E4%BB%B6">#</a>è·å–åˆ°è¾¾çš„äº‹ä»¶</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keyIterator <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">&#125;</span>
    keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-493"><a class="markdownIt-Anchor" href="#-493">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF">#</a>äº‹ä»¶å¾ªç¯</h3>
<p>å› ä¸ºä¸€æ¬¡ select () è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keyIterator <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">&#125;</span>
        keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-494"><a class="markdownIt-Anchor" href="#-494">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%A5%97%E6%8E%A5%E5%AD%97-nio-%E7%A4%BA%E4%BE%8B">#</a>å¥—æ¥å­— NIO ç¤ºä¾‹</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOServer</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">Selector</span> selector <span class="token operator">=</span> <span class="token class-name">Selector</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ServerSocketChannel</span> ssChannel <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ssChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ssChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_ACCEPT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ServerSocket</span> serverSocket <span class="token operator">=</span> ssChannel<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InetSocketAddress</span> address <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverSocket<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            selector<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">selectedKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">></span></span> keyIterator <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span>keyIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

                <span class="token class-name">SelectionKey</span> key <span class="token operator">=</span> keyIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isAcceptable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

                    <span class="token class-name">ServerSocketChannel</span> ssChannel1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// æœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºä¸€ä¸ª SocketChannel</span>
                    <span class="token class-name">SocketChannel</span> sChannel <span class="token operator">=</span> ssChannel1<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    sChannel<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// è¿™ä¸ªæ–°è¿æ¥ä¸»è¦ç”¨äºä»å®¢æˆ·ç«¯è¯»å–æ•°æ®</span>
                    sChannel<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">.</span>OP_READ<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

                    <span class="token class-name">SocketChannel</span> sChannel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SocketChannel</span><span class="token punctuation">)</span> key<span class="token punctuation">.</span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">readDataFromSocketChannel</span><span class="token punctuation">(</span>sChannel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    sChannel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>

                keyIterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">readDataFromSocketChannel</span><span class="token punctuation">(</span><span class="token class-name">SocketChannel</span> sChannel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">ByteBuffer</span> buffer <span class="token operator">=</span> <span class="token class-name">ByteBuffer</span><span class="token punctuation">.</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StringBuilder</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> n <span class="token operator">=</span> sChannel<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            buffer<span class="token punctuation">.</span><span class="token function">flip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> limit <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dst <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>limit<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> limit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                dst<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> buffer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            data<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
            buffer<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NIOClient</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Socket</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-495"><a class="markdownIt-Anchor" href="#-495">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6">#</a>å†…å­˜æ˜ å°„æ–‡ä»¶</h3>
<p>å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€šé“çš„ I/O å¿«å¾—å¤šã€‚</p>
<p>å‘å†…å­˜æ˜ å°„æ–‡ä»¶å†™å…¥å¯èƒ½æ˜¯å±é™©çš„ï¼Œåªæ˜¯æ”¹å˜æ•°ç»„çš„å•ä¸ªå…ƒç´ è¿™æ ·çš„ç®€å•æ“ä½œï¼Œå°±å¯èƒ½ä¼šç›´æ¥ä¿®æ”¹ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ä¿®æ”¹æ•°æ®ä¸å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ˜¯æ²¡æœ‰åˆ†å¼€çš„ã€‚</p>
<p>ä¸‹é¢ä»£ç è¡Œå°†æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œmap () æ–¹æ³•è¿”å›ä¸€ä¸ª MappedByteBufferï¼Œå®ƒæ˜¯ ByteBuffer çš„å­ç±»ã€‚å› æ­¤ï¼Œå¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½• ByteBuffer ä¸€æ ·ä½¿ç”¨æ–°æ˜ å°„çš„ç¼“å†²åŒºï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨éœ€è¦æ—¶è´Ÿè´£æ‰§è¡Œæ˜ å°„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">MappedByteBuffer</span> mbb <span class="token operator">=</span> fc<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">FileChannel<span class="token punctuation">.</span>MapMode</span><span class="token punctuation">.</span>READ_WRITE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="-496"><a class="markdownIt-Anchor" href="#-496">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-nio.html#%E4%BA%94%E3%80%81nio-vs-bio">#</a>äº”ã€NIO vs. BIO</h2>
<p>BIO ä¸ NIO æœ€é‡è¦çš„åŒºåˆ«æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼š<strong>BIO ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®</strong>ã€‚</p>
<ul>
<li><strong>é¢å‘æµçš„ BIO ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®</strong>ï¼šä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚</li>
<li><strong>é¢å‘å—çš„ NIO ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—</strong>ï¼ŒæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ NIO ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ BIO æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚</li>
</ul>
<p>BIO æ¨¡å¼ï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200630212345.png" alt="img"></p>
<p>NIO æ¨¡å¼ï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200630212248.png" alt="img"></p>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-åºåˆ—åŒ–"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-åºåˆ—åŒ–">#</a> æ·±å…¥ç†è§£ Java åºåˆ—åŒ–</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>*<strong> å…³é”®è¯ï¼š <code>Serializable</code> ã€ <code>serialVersionUID</code> ã€ <code>transient</code> ã€ <code>Externalizable</code> ã€ <code>writeObject</code> ã€ <code>readObject</code> *</strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200630204142.png" alt="img"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#1-java-%E5%BA%8F%E5%88%97%E5%8C%96%E7%AE%80%E4%BB%8B">1. Java åºåˆ—åŒ–ç®€ä»‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#2-java-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">2. Java åºåˆ—åŒ–å’Œååºåˆ—åŒ–</a></li>
<li>\3. Serializable æ¥å£
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#31-serialversionuid">3.1. serialVersionUID</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#32-%E9%BB%98%E8%AE%A4%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6">3.2. é»˜è®¤åºåˆ—åŒ–æœºåˆ¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#33-transient">3.3. transient</a></li>
</ul>
</li>
<li>\4. Externalizable æ¥å£
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#41-externalizable-%E6%8E%A5%E5%8F%A3%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%B3%95">4.1. Externalizable æ¥å£çš„æ›¿ä»£æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#42-readresolve-%E6%96%B9%E6%B3%95">4.2. readResolve () æ–¹æ³•</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#5-java-%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98">5. Java åºåˆ—åŒ–é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#6-java-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%BC%BA%E9%99%B7">6. Java åºåˆ—åŒ–çš„ç¼ºé™·</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#7-%E5%BA%8F%E5%88%97%E5%8C%96%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B">7. åºåˆ—åŒ–æŠ€æœ¯é€‰å‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#8-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">8. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-497"><a class="markdownIt-Anchor" href="#-497">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_1-java-%E5%BA%8F%E5%88%97%E5%8C%96%E7%AE%80%E4%BB%8B">#</a>1. Java åºåˆ—åŒ–ç®€ä»‹</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1553224129484.png" alt="img"></p>
<ul>
<li><strong>åºåˆ—åŒ–ï¼ˆserializeï¼‰</strong> - åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµã€‚</li>
<li><strong>ååºåˆ—åŒ–ï¼ˆdeserializeï¼‰</strong> - ååºåˆ—åŒ–æ˜¯å°†å­—èŠ‚æµè½¬æ¢ä¸ºå¯¹è±¡ã€‚</li>
<li>åºåˆ—åŒ–ç”¨é€”
<ul>
<li>åºåˆ—åŒ–å¯ä»¥å°†å¯¹è±¡çš„å­—èŠ‚åºåˆ—æŒä¹…åŒ– â€”â€” ä¿å­˜åœ¨å†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“ä¸­ã€‚</li>
<li>åœ¨ç½‘ç»œä¸Šä¼ é€å¯¹è±¡çš„å­—èŠ‚åºåˆ—ã€‚</li>
<li>RMI (è¿œç¨‹æ–¹æ³•è°ƒç”¨)</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šä½¿ç”¨ Java å¯¹è±¡åºåˆ—åŒ–ï¼Œåœ¨ä¿å­˜å¯¹è±¡æ—¶ï¼Œä¼šæŠŠå…¶çŠ¶æ€ä¿å­˜ä¸ºä¸€ç»„å­—èŠ‚ï¼Œåœ¨æœªæ¥ï¼Œå†å°†è¿™äº›å­—èŠ‚ç»„è£…æˆå¯¹è±¡ã€‚å¿…é¡»æ³¨æ„åœ°æ˜¯ï¼Œå¯¹è±¡åºåˆ—åŒ–ä¿å­˜çš„æ˜¯å¯¹è±¡çš„â€ çŠ¶æ€â€ï¼Œå³å®ƒçš„æˆå‘˜å˜é‡ã€‚ç”±æ­¤å¯çŸ¥ï¼Œ<strong>å¯¹è±¡åºåˆ—åŒ–ä¸ä¼šå…³æ³¨ç±»ä¸­çš„é™æ€å˜é‡</strong>ã€‚</p>
</blockquote>
<h2 id="-498"><a class="markdownIt-Anchor" href="#-498">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_2-java-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">#</a>2. Java åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h2>
<p>Java é€šè¿‡å¯¹è±¡è¾“å…¥è¾“å‡ºæµæ¥å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼š</p>
<ul>
<li><code>java.io.ObjectOutputStream</code>  ç±»çš„  <code>writeObject()</code>  æ–¹æ³•å¯ä»¥å®ç°åºåˆ—åŒ–ï¼›</li>
<li><code>java.io.ObjectInputStream</code>  ç±»çš„  <code>readObject()</code>  æ–¹æ³•ç”¨äºå®ç°ååºåˆ—åŒ–ã€‚</li>
</ul>
<p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SerializeDemo01</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">enum</span> <span class="token class-name">Sex</span> <span class="token punctuation">&#123;</span>
        MALE<span class="token punctuation">,</span>
        FEMALE
    <span class="token punctuation">&#125;</span>


    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Integer</span> age <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Sex</span> sex<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">,</span> <span class="token class-name">Sex</span> sex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"Person&#123;"</span> <span class="token operator">+</span> <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span> <span class="token string">", age="</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">", sex="</span> <span class="token operator">+</span> sex <span class="token operator">+</span> <span class="token string">'&#125;'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * åºåˆ—åŒ–
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¿å­˜è·¯å¾„</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–‡ä»¶è¾“å‡ºæµ</span>
        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹è±¡è¾“å‡ºæµ</span>
        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">Sex</span><span class="token punctuation">.</span>MALE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜å¯¹è±¡</span>
        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * ååºåˆ—åŒ–
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¿å­˜è·¯å¾„</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–‡ä»¶è¾“å…¥æµ</span>
        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹è±¡è¾“å…¥æµ</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–å¯¹è±¡</span>
        ois<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> filename <span class="token operator">=</span> <span class="token string">"d:/text.dat"</span><span class="token punctuation">;</span>
        <span class="token function">serialize</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">deserialize</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// Person&#123;name='Jack', age=30, sex=MALE&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-499"><a class="markdownIt-Anchor" href="#-499">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_3-serializable-%E6%8E%A5%E5%8F%A3">#</a>3. Serializable æ¥å£</h2>
<p><strong>è¢«åºåˆ—åŒ–çš„ç±»å¿…é¡»å±äº Enumã€Array å’Œ Serializable ç±»å‹å…¶ä¸­çš„ä»»ä½•ä¸€ç§ï¼Œå¦åˆ™å°†æŠ›å‡º  <code>NotSerializableException</code>  å¼‚å¸¸</strong>ã€‚è¿™æ˜¯å› ä¸ºï¼šåœ¨åºåˆ—åŒ–æ“ä½œè¿‡ç¨‹ä¸­ä¼šå¯¹ç±»å‹è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚æœä¸æ»¡è¶³åºåˆ—åŒ–ç±»å‹è¦æ±‚ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ <code>NotSerializableException</code>  é”™è¯¯</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnSerializeDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å…¶ä»–å†…å®¹ç•¥ &#125;</span>
    <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼šç»“æœå°±æ˜¯å‡ºç°å¦‚ä¸‹å¼‚å¸¸ä¿¡æ¯ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Exception in thread "main" java.io.NotSerializableException:
...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-500"><a class="markdownIt-Anchor" href="#-500">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_3-1-serialversionuid">#</a>3.1. serialVersionUID</h3>
<p>è¯·æ³¨æ„  <code>serialVersionUID</code>  å­—æ®µï¼Œä½ å¯ä»¥åœ¨ Java ä¸–ç•Œçš„æ— æ•°ç±»ä¸­çœ‹åˆ°è¿™ä¸ªå­—æ®µã€‚</p>
<p><code>serialVersionUID</code>  æœ‰ä»€ä¹ˆä½œç”¨ï¼Œå¦‚ä½•ä½¿ç”¨  <code>serialVersionUID</code> ï¼Ÿ</p>
<p><strong> <code>serialVersionUID</code>  æ˜¯ Java ä¸ºæ¯ä¸ªåºåˆ—åŒ–ç±»äº§ç”Ÿçš„ç‰ˆæœ¬æ ‡è¯†</strong>ã€‚å®ƒå¯ä»¥ç”¨æ¥ä¿è¯åœ¨ååºåˆ—æ—¶ï¼Œå‘é€æ–¹å‘é€çš„å’Œæ¥å—æ–¹æ¥æ”¶çš„æ˜¯å¯å…¼å®¹çš„å¯¹è±¡ã€‚å¦‚æœæ¥æ”¶æ–¹æ¥æ”¶çš„ç±»çš„  <code>serialVersionUID</code>  ä¸å‘é€æ–¹å‘é€çš„  <code>serialVersionUID</code>  ä¸ä¸€è‡´ï¼Œä¼šæŠ›å‡º  <code>InvalidClassException</code> ã€‚</p>
<p>å¦‚æœå¯åºåˆ—åŒ–ç±»æ²¡æœ‰æ˜¾å¼å£°æ˜  <code>serialVersionUID</code> ï¼Œåˆ™åºåˆ—åŒ–è¿è¡Œæ—¶å°†åŸºäºè¯¥ç±»çš„å„ä¸ªæ–¹é¢è®¡ç®—è¯¥ç±»çš„é»˜è®¤  <code>serialVersionUID</code>  å€¼ã€‚å°½ç®¡è¿™æ ·ï¼Œè¿˜æ˜¯<strong>å»ºè®®åœ¨æ¯ä¸€ä¸ªåºåˆ—åŒ–çš„ç±»ä¸­æ˜¾å¼æŒ‡å®š  <code>serialVersionUID</code>  çš„å€¼</strong>ã€‚å› ä¸ºä¸åŒçš„ jdk ç¼–è¯‘å¾ˆå¯èƒ½ä¼šç”Ÿæˆä¸åŒçš„  <code>serialVersionUID</code>  é»˜è®¤å€¼ï¼Œä»è€Œå¯¼è‡´åœ¨ååºåˆ—åŒ–æ—¶æŠ›å‡º  <code>InvalidClassExceptions</code>  å¼‚å¸¸ã€‚</p>
<p><strong> <code>serialVersionUID</code>  å­—æ®µå¿…é¡»æ˜¯  <code>static final long</code>  ç±»å‹</strong>ã€‚</p>
<p>æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ï¼ˆ1ï¼‰æœ‰ä¸€ä¸ªå¯åºåˆ—åŒ–ç±» Person</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
    <span class="token comment">// æ„é€ æ–¹æ³•ã€getã€set æ–¹æ³•ç•¥</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ï¼ˆ2ï¼‰å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹ Person åšäº†ä¿®æ”¹ï¼Œå¢åŠ äº†ä¸€ä¸ªå­—æ®µ emailï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
    <span class="token comment">// æ„é€ æ–¹æ³•ã€getã€set æ–¹æ³•ç•¥</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”±äºè¿™ä¸ªç±»å’Œè€ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç‰ˆæœ¬å·ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">2L</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å†æ¬¡è¿›è¡Œååºåˆ—åŒ–ï¼Œåˆ™ä¼šæŠ›å‡º  <code>InvalidClassException</code>  å¼‚å¸¸ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¤§æ¦‚å¯ä»¥æ¸…æ¥šï¼š<strong> <code>serialVersionUID</code>  ç”¨äºæ§åˆ¶åºåˆ—åŒ–ç‰ˆæœ¬æ˜¯å¦å…¼å®¹</strong>ã€‚è‹¥æˆ‘ä»¬è®¤ä¸ºä¿®æ”¹çš„å¯åºåˆ—åŒ–ç±»æ˜¯å‘åå…¼å®¹çš„ï¼Œåˆ™ä¸ä¿®æ”¹  <code>serialVersionUID</code> ã€‚</p>
<h3 id="-501"><a class="markdownIt-Anchor" href="#-501">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_3-2-%E9%BB%98%E8%AE%A4%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6">#</a>3.2. é»˜è®¤åºåˆ—åŒ–æœºåˆ¶</h3>
<p>å¦‚æœä»…ä»…åªæ˜¯è®©æŸä¸ªç±»å®ç°  <code>Serializable</code>  æ¥å£ï¼Œè€Œæ²¡æœ‰å…¶å®ƒä»»ä½•å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨é»˜è®¤åºåˆ—åŒ–æœºåˆ¶ã€‚</p>
<p>ä½¿ç”¨é»˜è®¤æœºåˆ¶ï¼Œåœ¨åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œä¸ä»…ä¼šåºåˆ—åŒ–å½“å‰å¯¹è±¡æœ¬èº«ï¼Œè¿˜ä¼šå¯¹å…¶çˆ¶ç±»çš„å­—æ®µä»¥åŠè¯¥å¯¹è±¡å¼•ç”¨çš„å…¶å®ƒå¯¹è±¡ä¹Ÿè¿›è¡Œåºåˆ—åŒ–ã€‚åŒæ ·åœ°ï¼Œè¿™äº›å…¶å®ƒå¯¹è±¡å¼•ç”¨çš„å¦å¤–å¯¹è±¡ä¹Ÿå°†è¢«åºåˆ—åŒ–ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡åŒ…å«çš„æˆå‘˜å˜é‡æ˜¯å®¹å™¨ç±»å¯¹è±¡ï¼Œè€Œè¿™äº›å®¹å™¨æ‰€å«æœ‰çš„å…ƒç´ ä¹Ÿæ˜¯å®¹å™¨ç±»å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªåºåˆ—åŒ–çš„è¿‡ç¨‹å°±ä¼šè¾ƒå¤æ‚ï¼Œå¼€é”€ä¹Ÿè¾ƒå¤§ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šè¿™é‡Œçš„çˆ¶ç±»å’Œå¼•ç”¨å¯¹è±¡æ—¢ç„¶è¦è¿›è¡Œåºåˆ—åŒ–ï¼Œé‚£ä¹ˆå®ƒä»¬å½“ç„¶ä¹Ÿè¦æ»¡è¶³åºåˆ—åŒ–è¦æ±‚ï¼š<strong>è¢«åºåˆ—åŒ–çš„ç±»å¿…é¡»å±äº Enumã€Array å’Œ Serializable ç±»å‹å…¶ä¸­çš„ä»»ä½•ä¸€ç§</strong>ã€‚</p>
</blockquote>
<h3 id="-502"><a class="markdownIt-Anchor" href="#-502">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_3-3-transient">#</a>3.3. transient</h3>
<p>åœ¨ç°å®åº”ç”¨ä¸­ï¼Œæœ‰äº›æ—¶å€™ä¸èƒ½ä½¿ç”¨é»˜è®¤åºåˆ—åŒ–æœºåˆ¶ã€‚æ¯”å¦‚ï¼Œå¸Œæœ›åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­å¿½ç•¥æ‰æ•æ„Ÿæ•°æ®ï¼Œæˆ–è€…ç®€åŒ–åºåˆ—åŒ–è¿‡ç¨‹ã€‚ä¸‹é¢å°†ä»‹ç»è‹¥å¹²å½±å“åºåˆ—åŒ–çš„æ–¹æ³•ã€‚</p>
<p><strong>å½“æŸä¸ªå­—æ®µè¢«å£°æ˜ä¸º  <code>transient</code>  åï¼Œé»˜è®¤åºåˆ—åŒ–æœºåˆ¶å°±ä¼šå¿½ç•¥è¯¥å­—æ®µçš„å†…å®¹ï¼Œè¯¥å­—æ®µçš„å†…å®¹åœ¨åºåˆ—åŒ–åæ— æ³•è·å¾—è®¿é—®</strong>ã€‚</p>
<p>æˆ‘ä»¬å°† SerializeDemo01 ç¤ºä¾‹ä¸­çš„å†…éƒ¨ç±» Person çš„ age å­—æ®µå£°æ˜ä¸º  <code>transient</code> ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SerializeDemo02</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">transient</span> <span class="token keyword">private</span> <span class="token class-name">Integer</span> age <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// name: Jack, age: null, sex: MALE</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼Œage å­—æ®µæ²¡æœ‰è¢«åºåˆ—åŒ–ã€‚</p>
<h2 id="-503"><a class="markdownIt-Anchor" href="#-503">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_4-externalizable-%E6%8E%A5%E5%8F%A3">#</a>4. Externalizable æ¥å£</h2>
<p>æ— è®ºæ˜¯ä½¿ç”¨  <code>transient</code>  å…³é”®å­—ï¼Œè¿˜æ˜¯ä½¿ç”¨  <code>writeObject()</code>  å’Œ  <code>readObject()</code>  æ–¹æ³•ï¼Œå…¶å®éƒ½æ˜¯åŸºäº  <code>Serializable</code>  æ¥å£çš„åºåˆ—åŒ–ã€‚</p>
<p>JDK ä¸­æä¾›äº†å¦ä¸€ä¸ªåºåˆ—åŒ–æ¥å£â€“ <code>Externalizable</code> ã€‚</p>
<p><strong>å¯åºåˆ—åŒ–ç±»å®ç°  <code>Externalizable</code>  æ¥å£ä¹‹åï¼ŒåŸºäº  <code>Serializable</code>  æ¥å£çš„é»˜è®¤åºåˆ—åŒ–æœºåˆ¶å°±ä¼šå¤±æ•ˆ</strong>ã€‚</p>
<p>æˆ‘ä»¬æ¥åŸºäº SerializeDemo02 å†æ¬¡åšä¸€äº›æ”¹åŠ¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExternalizeDemo01</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Externalizable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">transient</span> <span class="token keyword">private</span> <span class="token class-name">Integer</span> age <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
            out<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
            in<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            age <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
     <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// call Person()</span>
<span class="token comment">// name: null, age: null, sex: null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»è¯¥ç»“æœï¼Œä¸€æ–¹é¢å¯ä»¥çœ‹å‡º Person å¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªå­—æ®µéƒ½æ²¡æœ‰è¢«åºåˆ—åŒ–ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç»†å¿ƒçš„è¯ï¼Œè¿˜å¯ä»¥å‘ç°è¿™æ­¤æ¬¡åºåˆ—åŒ–è¿‡ç¨‹è°ƒç”¨äº† Person ç±»çš„æ— å‚æ„é€ æ–¹æ³•ã€‚</p>
<ul>
<li><strong> <code>Externalizable</code>  ç»§æ‰¿äº  <code>Serializable</code> ï¼Œå®ƒå¢æ·»äº†ä¸¤ä¸ªæ–¹æ³•ï¼š <code>writeExternal()</code>  ä¸  <code>readExternal()</code> ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œä»¥ä¾¿æ‰§è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œ</strong>ã€‚å½“ä½¿ç”¨è¯¥æ¥å£æ—¶ï¼Œåºåˆ—åŒ–çš„ç»†èŠ‚éœ€è¦ç”±ç¨‹åºå‘˜å»å®Œæˆã€‚å¦‚ä¸Šæ‰€ç¤ºçš„ä»£ç ï¼Œç”±äº  <code>writeExternal()</code>  ä¸  <code>readExternal()</code>  æ–¹æ³•æœªä½œä»»ä½•å¤„ç†ï¼Œé‚£ä¹ˆè¯¥åºåˆ—åŒ–è¡Œä¸ºå°†ä¸ä¼šä¿å­˜ / è¯»å–ä»»ä½•ä¸€ä¸ªå­—æ®µã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¾“å‡ºç»“æœä¸­æ‰€æœ‰å­—æ®µçš„å€¼å‡ä¸ºç©ºã€‚</li>
<li>å¦å¤–ï¼Œ<strong>è‹¥ä½¿ç”¨  <code>Externalizable</code>  è¿›è¡Œåºåˆ—åŒ–ï¼Œå½“è¯»å–å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨è¢«åºåˆ—åŒ–ç±»çš„æ— å‚æ„é€ æ–¹æ³•å»åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›ç„¶åå†å°†è¢«ä¿å­˜å¯¹è±¡çš„å­—æ®µçš„å€¼åˆ†åˆ«å¡«å……åˆ°æ–°å¯¹è±¡ä¸­</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨æ­¤æ¬¡åºåˆ—åŒ–è¿‡ç¨‹ä¸­ Person ç±»çš„æ— å‚æ„é€ æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œå®ç°  <code>Externalizable</code>  æ¥å£çš„ç±»å¿…é¡»è¦æä¾›ä¸€ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ï¼Œä¸”å®ƒçš„è®¿é—®æƒé™ä¸º  <code>public</code> ã€‚</li>
</ul>
<p>å¯¹ä¸Šè¿° Person ç±»ä½œè¿›ä¸€æ­¥çš„ä¿®æ”¹ï¼Œä½¿å…¶èƒ½å¤Ÿå¯¹ name ä¸ age å­—æ®µè¿›è¡Œåºåˆ—åŒ–ï¼Œä½†è¦å¿½ç•¥æ‰ gender å­—æ®µï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExternalizeDemo02</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Externalizable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">transient</span> <span class="token keyword">private</span> <span class="token class-name">Integer</span> age <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
            out<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
            in<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            age <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutput</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
            out<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readExternal</span><span class="token punctuation">(</span><span class="token class-name">ObjectInput</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
            name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            age <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
     <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// call Person()</span>
<span class="token comment">// name: Jack, age: 30, sex: null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-504"><a class="markdownIt-Anchor" href="#-504">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_4-1-externalizable-%E6%8E%A5%E5%8F%A3%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%B3%95">#</a>4.1. Externalizable æ¥å£çš„æ›¿ä»£æ–¹æ³•</h3>
<p>å®ç°  <code>Externalizable</code>  æ¥å£å¯ä»¥æ§åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ç»†èŠ‚ã€‚å®ƒæœ‰ä¸€ä¸ªæ›¿ä»£æ–¹æ³•ï¼šå®ç°  <code>Serializable</code>  æ¥å£ï¼Œå¹¶æ·»åŠ   <code>writeObject(ObjectOutputStream out)</code>  ä¸  <code>readObject(ObjectInputStream in)</code>  æ–¹æ³•ã€‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨å›è°ƒè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SerializeDemo03</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">transient</span> <span class="token keyword">private</span> <span class="token class-name">Integer</span> age <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
            out<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
            in<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            age <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// name: Jack, age: 30, sex: MALE</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨  <code>writeObject()</code>  æ–¹æ³•ä¸­ä¼šå…ˆè°ƒç”¨  <code>ObjectOutputStream</code>  ä¸­çš„  <code>defaultWriteObject()</code>  æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šæ‰§è¡Œé»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œå¦‚ä¸ŠèŠ‚æ‰€è¿°ï¼Œæ­¤æ—¶ä¼šå¿½ç•¥æ‰ age å­—æ®µã€‚ç„¶åå†è°ƒç”¨ writeInt () æ–¹æ³•æ˜¾ç¤ºåœ°å°† age å­—æ®µå†™å…¥åˆ°  <code>ObjectOutputStream</code>  ä¸­ã€‚readObject () çš„ä½œç”¨åˆ™æ˜¯é’ˆå¯¹å¯¹è±¡çš„è¯»å–ï¼Œå…¶åŸç†ä¸ writeObject () æ–¹æ³•ç›¸åŒã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š <code>writeObject()</code>  ä¸  <code>readObject()</code>  éƒ½æ˜¯  <code>private</code>  æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä»¬æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„å‘¢ï¼Ÿæ¯«æ— ç–‘é—®ï¼Œæ˜¯ä½¿ç”¨åå°„ã€‚è¯¦æƒ…å¯è§  <code>ObjectOutputStream</code>  ä¸­çš„  <code>writeSerialData</code>  æ–¹æ³•ï¼Œä»¥åŠ  <code>ObjectInputStream</code>  ä¸­çš„  <code>readSerialData</code>  æ–¹æ³•ã€‚</p>
</blockquote>
<h3 id="-505"><a class="markdownIt-Anchor" href="#-505">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_4-2-readresolve-%E6%96%B9%E6%B3%95">#</a>4.2. readResolve () æ–¹æ³•</h3>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ Singleton æ¨¡å¼æ—¶ï¼Œåº”è¯¥æ˜¯æœŸæœ›æŸä¸ªç±»çš„å®ä¾‹åº”è¯¥æ˜¯å”¯ä¸€çš„ï¼Œä½†å¦‚æœè¯¥ç±»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œé‚£ä¹ˆæƒ…å†µå¯èƒ½ä¼šç•¥æœ‰ä¸åŒã€‚æ­¤æ—¶å¯¹ç¬¬ 2 èŠ‚ä½¿ç”¨çš„ Person ç±»è¿›è¡Œä¿®æ”¹ï¼Œä½¿å…¶å®ç° Singleton æ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SerializeDemo04</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">enum</span> <span class="token class-name">Sex</span> <span class="token punctuation">&#123;</span>
        MALE<span class="token punctuation">,</span> FEMALE
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">transient</span> <span class="token keyword">private</span> <span class="token class-name">Integer</span> age <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">Sex</span> sex<span class="token punctuation">;</span>
        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Person</span> instatnce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Tom"</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token class-name">Sex</span><span class="token punctuation">.</span>MALE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"call Person()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Integer</span> age<span class="token punctuation">,</span> <span class="token class-name">Sex</span> sex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token operator">=</span> sex<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Person</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> instatnce<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectOutputStream</span> out<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
            out<span class="token punctuation">.</span><span class="token function">defaultWriteObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            out<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name">ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
            in<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            age <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"name: "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">", age: "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">+</span> <span class="token string">", sex: "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sex<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * åºåˆ—åŒ–
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¿å­˜è·¯å¾„</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–‡ä»¶è¾“å‡ºæµ</span>
        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹è±¡è¾“å‡ºæµ</span>
        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">Sex</span><span class="token punctuation">.</span>MALE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜å¯¹è±¡</span>
        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * ååºåˆ—åŒ–
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®šä¹‰ä¿å­˜è·¯å¾„</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–‡ä»¶è¾“å…¥æµ</span>
        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹è±¡è¾“å…¥æµ</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¯»å–å¯¹è±¡</span>
        ois<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> filename <span class="token operator">=</span> <span class="token string">"d:/text.dat"</span><span class="token punctuation">;</span>
        <span class="token function">serialize</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">deserialize</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// name: Jack, age: null, sex: MALE</span>
<span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»æ–‡ä»¶ä¸­è·å–çš„ Person å¯¹è±¡ä¸ Person ç±»ä¸­çš„å•ä¾‹å¯¹è±¡å¹¶ä¸ç›¸ç­‰ã€‚<strong>ä¸ºäº†èƒ½åœ¨å•ä¾‹ç±»ä¸­ä»ç„¶ä¿æŒåºåˆ—çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨  <code>readResolve()</code>  æ–¹æ³•</strong>ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ç›´æ¥è¿”å› Person çš„å•ä¾‹å¯¹è±¡ã€‚æˆ‘ä»¬åœ¨ SerializeDemo04 ç¤ºä¾‹çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ª  <code>readResolve</code>  æ–¹æ³•ï¼Œ å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SerializeDemo05</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException &#123;</span>
        <span class="token comment">//     in.defaultReadObject();</span>
        <span class="token comment">//     age = in.readInt();</span>
        <span class="token comment">// &#125;</span>

        <span class="token comment">// æ·»åŠ æ­¤æ–¹æ³•</span>
        <span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> instatnce<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// å…¶ä»–å†…å®¹ç•¥</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// Output:</span>
<span class="token comment">// name: Tom, age: 31, sex: MALE</span>
<span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-506"><a class="markdownIt-Anchor" href="#-506">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_5-java-%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98">#</a>5. Java åºåˆ—åŒ–é—®é¢˜</h2>
<p>Java çš„åºåˆ—åŒ–èƒ½ä¿è¯å¯¹è±¡çŠ¶æ€çš„æŒä¹…ä¿å­˜ï¼Œä½†æ˜¯é‡åˆ°ä¸€äº›å¯¹è±¡ç»“æ„å¤æ‚çš„æƒ…å†µè¿˜æ˜¯éš¾ä»¥å¤„ç†ï¼Œè¿™é‡Œå½’çº³ä¸€ä¸‹ï¼š</p>
<ul>
<li>çˆ¶ç±»æ˜¯  <code>Serializable</code> ï¼Œæ‰€æœ‰å­ç±»éƒ½å¯ä»¥è¢«åºåˆ—åŒ–ã€‚</li>
<li>å­ç±»æ˜¯  <code>Serializable</code>  ï¼Œçˆ¶ç±»ä¸æ˜¯ï¼Œåˆ™å­ç±»å¯ä»¥æ­£ç¡®åºåˆ—åŒ–ï¼Œä½†çˆ¶ç±»çš„å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ï¼ˆä¸æŠ¥é”™ï¼Œæ•°æ®ä¸¢å¤±ï¼‰ã€‚</li>
<li>å¦‚æœåºåˆ—åŒ–çš„å±æ€§æ˜¯å¯¹è±¡ï¼Œåˆ™è¿™ä¸ªå¯¹è±¡ä¹Ÿå¿…é¡»æ˜¯  <code>Serializable</code>  ï¼Œå¦åˆ™æŠ¥é”™ã€‚</li>
<li>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„å±æ€§æœ‰ä¿®æ”¹æˆ–åˆ å‡ï¼Œåˆ™ä¿®æ”¹çš„éƒ¨åˆ†å±æ€§ä¼šä¸¢å¤±ï¼Œä½†ä¸ä¼šæŠ¥é”™ã€‚</li>
<li>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœ  <code>serialVersionUID</code>  è¢«ä¿®æ”¹ï¼Œåˆ™ååºåˆ—åŒ–ä¼šå¤±è´¥ã€‚</li>
</ul>
<h2 id="-507"><a class="markdownIt-Anchor" href="#-507">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_6-java-%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%BC%BA%E9%99%B7">#</a>6. Java åºåˆ—åŒ–çš„ç¼ºé™·</h2>
<ul>
<li><strong>æ— æ³•è·¨è¯­è¨€</strong>ï¼šJava åºåˆ—åŒ–ç›®å‰åªé€‚ç”¨åŸºäº Java è¯­è¨€å®ç°çš„æ¡†æ¶ï¼Œå…¶å®ƒè¯­è¨€å¤§éƒ¨åˆ†éƒ½æ²¡æœ‰ä½¿ç”¨ Java çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œä¹Ÿæ²¡æœ‰å®ç° Java åºåˆ—åŒ–è¿™å¥—åè®®ã€‚å› æ­¤ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªåŸºäºä¸åŒè¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºç›¸äº’é€šä¿¡ï¼Œåˆ™æ— æ³•å®ç°ä¸¤ä¸ªåº”ç”¨æœåŠ¡ä¹‹é—´ä¼ è¾“å¯¹è±¡çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚</li>
<li><strong>å®¹æ˜“è¢«æ”»å‡»</strong>ï¼šå¯¹è±¡æ˜¯é€šè¿‡åœ¨  <code>ObjectInputStream</code>  ä¸Šè°ƒç”¨  <code>readObject()</code>  æ–¹æ³•è¿›è¡Œååºåˆ—åŒ–çš„ï¼Œå®ƒå¯ä»¥å°†ç±»è·¯å¾„ä¸Šå‡ ä¹æ‰€æœ‰å®ç°äº†  <code>Serializable</code>  æ¥å£çš„å¯¹è±¡éƒ½å®ä¾‹åŒ–ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨ååºåˆ—åŒ–å­—èŠ‚æµçš„è¿‡ç¨‹ä¸­ï¼Œè¯¥æ–¹æ³•å¯ä»¥æ‰§è¡Œä»»æ„ç±»å‹çš„ä»£ç ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ã€‚å¯¹äºéœ€è¦é•¿æ—¶é—´è¿›è¡Œååºåˆ—åŒ–çš„å¯¹è±¡ï¼Œä¸éœ€è¦æ‰§è¡Œä»»ä½•ä»£ç ï¼Œä¹Ÿå¯ä»¥å‘èµ·ä¸€æ¬¡æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥åˆ›å»ºå¾ªç¯å¯¹è±¡é“¾ï¼Œç„¶åå°†åºåˆ—åŒ–åçš„å¯¹è±¡ä¼ è¾“åˆ°ç¨‹åºä¸­ååºåˆ—åŒ–ï¼Œè¿™ç§æƒ…å†µä¼šå¯¼è‡´  <code>hashCode</code>  æ–¹æ³•è¢«è°ƒç”¨æ¬¡æ•°å‘ˆæ¬¡æ–¹çˆ†å‘å¼å¢é•¿ï¼Œä»è€Œå¼•å‘æ ˆæº¢å‡ºå¼‚å¸¸ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªæ¡ˆä¾‹å°±å¯ä»¥å¾ˆå¥½åœ°è¯´æ˜ã€‚</li>
<li><strong>åºåˆ—åŒ–åçš„æµå¤ªå¤§</strong>ï¼šJava åºåˆ—åŒ–ä¸­ä½¿ç”¨äº†  <code>ObjectOutputStream</code>  æ¥å®ç°å¯¹è±¡è½¬äºŒè¿›åˆ¶ç¼–ç ï¼Œç¼–ç åçš„æ•°ç»„å¾ˆå¤§ï¼Œéå¸¸å½±å“å­˜å‚¨å’Œä¼ è¾“æ•ˆç‡ã€‚</li>
<li><strong>åºåˆ—åŒ–æ€§èƒ½å¤ªå·®</strong>ï¼šJava çš„åºåˆ—åŒ–è€—æ—¶æ¯”è¾ƒå¤§ã€‚åºåˆ—åŒ–çš„é€Ÿåº¦ä¹Ÿæ˜¯ä½“ç°åºåˆ—åŒ–æ€§èƒ½çš„é‡è¦æŒ‡æ ‡ï¼Œå¦‚æœåºåˆ—åŒ–çš„é€Ÿåº¦æ…¢ï¼Œå°±ä¼šå½±å“ç½‘ç»œé€šä¿¡çš„æ•ˆç‡ï¼Œä»è€Œå¢åŠ ç³»ç»Ÿçš„å“åº”æ—¶é—´ã€‚</li>
<li>åºåˆ—åŒ–ç¼–ç¨‹é™åˆ¶ï¼š
<ul>
<li>Java å®˜æ–¹çš„åºåˆ—åŒ–ä¸€å®š<strong>éœ€è¦å®ç°  <code>Serializable</code>  æ¥å£</strong>ã€‚</li>
<li>Java å®˜æ–¹çš„åºåˆ—åŒ–<strong>éœ€è¦å…³æ³¨  <code>serialVersionUID</code> </strong>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="-508"><a class="markdownIt-Anchor" href="#-508">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-serialization.html#_7-%E5%BA%8F%E5%88%97%E5%8C%96%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B">#</a>7. åºåˆ—åŒ–æŠ€æœ¯é€‰å‹</h2>
<p>é€šè¿‡ä¸Šä¸€ç« èŠ‚ â€”â€”Java åºåˆ—åŒ–çš„ç¼ºé™·ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼ŒJava åºåˆ—åŒ–æ–¹å¼å­˜åœ¨è®¸å¤šç¼ºé™·ã€‚å› æ­¤ï¼Œå»ºè®®ä½¿ç”¨ç¬¬ä¸‰æ–¹åºåˆ—åŒ–å·¥å…·æ¥æ›¿ä»£ã€‚</p>
<p>å½“ç„¶æˆ‘ä»¬è¿˜æœ‰æ›´åŠ ä¼˜ç§€çš„ä¸€äº›åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å·¥å…·ï¼Œæ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯å¯ä»¥è‡ªè¡Œé€‰æ‹©ï¼</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/thrift">thrift (opens new window)</a>ã€<a target="_blank" rel="noopener" href="https://github.com/protocolbuffers/protobuf">protobuf (opens new window)</a>- é€‚ç”¨äº<strong>å¯¹æ€§èƒ½æ•æ„Ÿï¼Œå¯¹å¼€å‘ä½“éªŒè¦æ±‚ä¸é«˜</strong>ã€‚</li>
<li><a target="_blank" rel="noopener" href="http://hessian.caucho.com/doc/hessian-overview.xtp">hessian (opens new window)</a>- é€‚ç”¨äº<strong>å¯¹å¼€å‘ä½“éªŒæ•æ„Ÿï¼Œæ€§èƒ½æœ‰è¦æ±‚</strong>ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/FasterXML/jackson">jackson (opens new window)</a>ã€<a target="_blank" rel="noopener" href="https://github.com/google/gson">gson (opens new window)</a>ã€<a target="_blank" rel="noopener" href="https://github.com/alibaba/fastjson">fastjson (opens new window)</a>- é€‚ç”¨äºå¯¹åºåˆ—åŒ–åçš„æ•°æ®è¦æ±‚æœ‰<strong>è‰¯å¥½çš„å¯è¯»æ€§</strong>ï¼ˆè½¬ä¸º json ã€xml å½¢å¼ï¼‰ã€‚</li>
</ul>
<hr>
<h1 id="java-ç½‘ç»œç¼–ç¨‹"><a class="markdownIt-Anchor" href="#java-ç½‘ç»œç¼–ç¨‹">#</a> Java ç½‘ç»œç¼–ç¨‹</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p><em><strong>å…³é”®è¯ï¼š <code>Socket</code> ã€ <code>ServerSocket</code> ã€ <code>DatagramPacket</code> ã€ <code>DatagramSocket</code> </strong></em></p>
<p>ç½‘ç»œç¼–ç¨‹æ˜¯æŒ‡ç¼–å†™è¿è¡Œåœ¨å¤šä¸ªè®¾å¤‡ï¼ˆè®¡ç®—æœºï¼‰çš„ç¨‹åºï¼Œè¿™äº›è®¾å¤‡éƒ½é€šè¿‡ç½‘ç»œè¿æ¥èµ·æ¥ã€‚</p>
<p><code>java.net</code>  åŒ…ä¸­æä¾›äº†ä½å±‚æ¬¡çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚ã€‚ä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›ç±»å’Œæ¥å£ï¼Œæ¥ä¸“æ³¨äºè§£å†³é—®é¢˜ï¼Œè€Œä¸ç”¨å…³æ³¨é€šä¿¡ç»†èŠ‚ã€‚</p>
<p><a target="_blank" rel="noopener" href="http://java.net">java.net</a> åŒ…ä¸­æä¾›äº†ä¸¤ç§å¸¸è§çš„ç½‘ç»œåè®®çš„æ”¯æŒï¼š</p>
<ul>
<li><strong>TCP</strong> - TCP æ˜¯ä¼ è¾“æ§åˆ¶åè®®çš„ç¼©å†™ï¼Œå®ƒä¿éšœäº†ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„å¯é é€šä¿¡ã€‚é€šå¸¸ç”¨äºäº’è”ç½‘åè®®ï¼Œè¢«ç§° TCP/ IPã€‚</li>
<li><strong>UDP</strong> - UDP æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®çš„ç¼©å†™ï¼Œä¸€ä¸ªæ— è¿æ¥çš„åè®®ã€‚æä¾›äº†åº”ç”¨ç¨‹åºä¹‹é—´è¦å‘é€çš„æ•°æ®çš„æ•°æ®åŒ…ã€‚</li>
</ul>
</blockquote>
<ul>
<li>Socket å’Œ ServerSocket
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#serversocket">ServerSocket</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#socket">Socket</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#socket-%E9%80%9A%E4%BF%A1%E7%A4%BA%E4%BE%8B">Socket é€šä¿¡ç¤ºä¾‹</a></li>
</ul>
</li>
<li>DatagramSocket å’Œ DatagramPacket
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#datagramsocket-%E9%80%9A%E4%BF%A1%E7%A4%BA%E4%BE%8B">DatagramSocket é€šä¿¡ç¤ºä¾‹</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#inetaddress">InetAddress</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#url">URL</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-509"><a class="markdownIt-Anchor" href="#-509">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#%E4%B8%80%E3%80%81socket-%E5%92%8C-serversocket">#</a>ä¸€ã€Socket å’Œ ServerSocket</h2>
<p>å¥—æ¥å­—ï¼ˆSocketï¼‰ä½¿ç”¨ TCP æä¾›äº†ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡æœºåˆ¶ã€‚ å®¢æˆ·ç«¯ç¨‹åºåˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå¹¶å°è¯•è¿æ¥æœåŠ¡å™¨çš„å¥—æ¥å­—ã€‚</p>
<p><strong>Java é€šè¿‡ Socket å’Œ ServerSocket å®ç°å¯¹ TCP çš„æ”¯æŒ</strong>ã€‚Java ä¸­çš„ Socket é€šä¿¡å¯ä»¥ç®€å•ç†è§£ä¸ºï¼š<strong> <code>java.net.Socket</code>  ä»£è¡¨å®¢æˆ·ç«¯ï¼Œ <code>java.net.ServerSocket</code>  ä»£è¡¨æœåŠ¡ç«¯</strong>ï¼ŒäºŒè€…å¯ä»¥å»ºç«‹è¿æ¥ï¼Œç„¶åé€šä¿¡ã€‚</p>
<p>ä»¥ä¸‹ä¸º Socket é€šä¿¡ä¸­å»ºç«‹å»ºç«‹çš„åŸºæœ¬æµç¨‹ï¼š</p>
<ul>
<li>æœåŠ¡å™¨å®ä¾‹åŒ–ä¸€ä¸ª  <code>ServerSocket</code>  å¯¹è±¡ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ç»‘å®šä¸€ä¸ªç«¯å£ã€‚</li>
<li>æœåŠ¡å™¨è°ƒç”¨  <code>ServerSocket</code>  çš„  <code>accept()</code>  æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨çš„ç»‘å®šç«¯å£ï¼ˆå³ç›‘å¬ç«¯å£ï¼‰ã€‚</li>
<li>æœåŠ¡å™¨ç›‘å¬ç«¯å£æ—¶ï¼Œå®¢æˆ·ç«¯å®ä¾‹åŒ–ä¸€ä¸ª  <code>Socket</code>  å¯¹è±¡ï¼ŒæŒ‡å®šæœåŠ¡å™¨åç§°å’Œç«¯å£å·æ¥è¯·æ±‚è¿æ¥ã€‚</li>
<li><code>Socket</code>  ç±»çš„æ„é€ å‡½æ•°è¯•å›¾å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£å·ã€‚å¦‚æœé€šä¿¡è¢«å»ºç«‹ï¼Œåˆ™åœ¨å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª Socket å¯¹è±¡èƒ½å¤Ÿä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚</li>
<li>åœ¨æœåŠ¡å™¨ç«¯ï¼Œ <code>accept()</code>  æ–¹æ³•è¿”å›æœåŠ¡å™¨ä¸Šä¸€ä¸ªæ–°çš„  <code>Socket</code>  å¼•ç”¨ï¼Œè¯¥å¼•ç”¨è¿æ¥åˆ°å®¢æˆ·ç«¯çš„  <code>Socket</code>  ã€‚</li>
</ul>
<p>è¿æ¥å»ºç«‹åï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ IO æµè¿›è¡Œé€šä¿¡ã€‚æ¯ä¸€ä¸ª  <code>Socket</code>  éƒ½æœ‰ä¸€ä¸ªè¾“å‡ºæµå’Œä¸€ä¸ªè¾“å…¥æµã€‚å®¢æˆ·ç«¯çš„è¾“å‡ºæµè¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„è¾“å…¥æµï¼Œè€Œå®¢æˆ·ç«¯çš„è¾“å…¥æµè¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„è¾“å‡ºæµã€‚</p>
<p>TCP æ˜¯ä¸€ä¸ªåŒå‘çš„é€šä¿¡åè®®ï¼Œå› æ­¤æ•°æ®å¯ä»¥é€šè¿‡ä¸¤ä¸ªæ•°æ®æµåœ¨åŒä¸€æ—¶é—´å‘é€ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ç±»æä¾›çš„ä¸€å¥—å®Œæ•´çš„æœ‰ç”¨çš„æ–¹æ³•æ¥å®ç° socketsã€‚</p>
<h3 id="-510"><a class="markdownIt-Anchor" href="#-510">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#serversocket">#</a>ServerSocket</h3>
<p>æœåŠ¡å™¨ç¨‹åºé€šè¿‡ä½¿ç”¨  <code>java.net.ServerSocket</code>  ç±»ä»¥è·å–ä¸€ä¸ªç«¯å£ï¼Œå¹¶ä¸”ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚è¿æ¥æ­¤ç«¯å£çš„è¯·æ±‚ã€‚</p>
<h4 id="-511"><a class="markdownIt-Anchor" href="#-511">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#serversocket-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">#</a>ServerSocket æ„é€ æ–¹æ³•</h4>
<p><code>ServerSocket</code>  æœ‰å¤šä¸ªæ„é€ æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th><strong>æ–¹æ³•</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ServerSocket()</code></td>
<td>åˆ›å»ºéç»‘å®šæœåŠ¡å™¨å¥—æ¥å­—ã€‚</td>
</tr>
<tr>
<td><code>ServerSocket(int port)</code></td>
<td>åˆ›å»ºç»‘å®šåˆ°ç‰¹å®šç«¯å£çš„æœåŠ¡å™¨å¥—æ¥å­—ã€‚</td>
</tr>
<tr>
<td><code>ServerSocket(int port, int backlog)</code></td>
<td>åˆ©ç”¨æŒ‡å®šçš„  <code>backlog</code>  åˆ›å»ºæœåŠ¡å™¨å¥—æ¥å­—å¹¶å°†å…¶ç»‘å®šåˆ°æŒ‡å®šçš„æœ¬åœ°ç«¯å£å·ã€‚</td>
</tr>
<tr>
<td><code>ServerSocket(int port, int backlog, InetAddress address)</code></td>
<td>ä½¿ç”¨æŒ‡å®šçš„ç«¯å£ã€ç›‘å¬  <code>backlog</code>  å’Œè¦ç»‘å®šåˆ°çš„æœ¬åœ° IP åœ°å€åˆ›å»ºæœåŠ¡å™¨ã€‚</td>
</tr>
</tbody>
</table>
<h4 id="-512"><a class="markdownIt-Anchor" href="#-512">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#serversocket-%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95">#</a>ServerSocket å¸¸ç”¨æ–¹æ³•</h4>
<p>åˆ›å»ºéç»‘å®šæœåŠ¡å™¨å¥—æ¥å­—ã€‚ å¦‚æœ  <code>ServerSocket</code>  æ„é€ æ–¹æ³•æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œå°±æ„å‘³ç€ä½ çš„åº”ç”¨ç¨‹åºå·²ç»æˆåŠŸç»‘å®šåˆ°æŒ‡å®šçš„ç«¯å£ï¼Œå¹¶ä¸”ä¾¦å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€äº›  <code>ServerSocket</code>  ç±»çš„å¸¸ç”¨æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th><strong>æ–¹æ³•</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>int getLocalPort()</code></td>
<td>è¿”å›æ­¤å¥—æ¥å­—åœ¨å…¶ä¸Šä¾¦å¬çš„ç«¯å£ã€‚</td>
</tr>
<tr>
<td><code>Socket accept()</code></td>
<td>ç›‘å¬å¹¶æ¥å—åˆ°æ­¤å¥—æ¥å­—çš„è¿æ¥ã€‚</td>
</tr>
<tr>
<td><code>void setSoTimeout(int timeout)</code></td>
<td>é€šè¿‡æŒ‡å®šè¶…æ—¶å€¼å¯ç”¨ / ç¦ç”¨  <code>SO_TIMEOUT</code> ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</td>
</tr>
<tr>
<td><code>void bind(SocketAddress host, int backlog)</code></td>
<td>å°†  <code>ServerSocket</code>  ç»‘å®šåˆ°ç‰¹å®šåœ°å€ï¼ˆIP åœ°å€å’Œç«¯å£å·ï¼‰ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="-513"><a class="markdownIt-Anchor" href="#-513">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#socket">#</a>Socket</h3>
<p><code>java.net.Socket</code>  ç±»ä»£è¡¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ç”¨æ¥äº’ç›¸æ²Ÿé€šçš„å¥—æ¥å­—ã€‚å®¢æˆ·ç«¯è¦è·å–ä¸€ä¸ª  <code>Socket</code>  å¯¹è±¡é€šè¿‡å®ä¾‹åŒ– ï¼Œè€Œ æœåŠ¡å™¨è·å¾—ä¸€ä¸ª  <code>Socket</code>  å¯¹è±¡åˆ™é€šè¿‡  <code>accept()</code>  æ–¹æ³• a çš„è¿”å›å€¼ã€‚</p>
<h4 id="-514"><a class="markdownIt-Anchor" href="#-514">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#socket-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">#</a>Socket æ„é€ æ–¹æ³•</h4>
<p><code>Socket</code>  ç±»æœ‰ 5 ä¸ªæ„é€ æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th><strong>æ–¹æ³•</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Socket()</code></td>
<td>é€šè¿‡ç³»ç»Ÿé»˜è®¤ç±»å‹çš„  <code>SocketImpl</code>  åˆ›å»ºæœªè¿æ¥å¥—æ¥å­—</td>
</tr>
<tr>
<td><code>Socket(String host, int port)</code></td>
<td>åˆ›å»ºä¸€ä¸ªæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šä¸»æœºä¸Šçš„æŒ‡å®šç«¯å£å·ã€‚</td>
</tr>
<tr>
<td><code>Socket(InetAddress host, int port)</code></td>
<td>åˆ›å»ºä¸€ä¸ªæµå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®š IP åœ°å€çš„æŒ‡å®šç«¯å£å·ã€‚</td>
</tr>
<tr>
<td><code>Socket(String host, int port, InetAddress localAddress, int localPort)</code></td>
<td>åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šè¿œç¨‹ä¸»æœºä¸Šçš„æŒ‡å®šè¿œç¨‹ç«¯å£ã€‚</td>
</tr>
<tr>
<td><code>Socket(InetAddress host, int port, InetAddress localAddress, int localPort)</code></td>
<td>åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—å¹¶å°†å…¶è¿æ¥åˆ°æŒ‡å®šè¿œç¨‹åœ°å€ä¸Šçš„æŒ‡å®šè¿œç¨‹ç«¯å£ã€‚</td>
</tr>
</tbody>
</table>
<p>å½“ Socket æ„é€ æ–¹æ³•è¿”å›ï¼Œå¹¶æ²¡æœ‰ç®€å•çš„å®ä¾‹åŒ–äº†ä¸€ä¸ª Socket å¯¹è±¡ï¼Œå®ƒå®é™…ä¸Šä¼šå°è¯•è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨å’Œç«¯å£ã€‚</p>
<h4 id="-515"><a class="markdownIt-Anchor" href="#-515">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#socket-%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95">#</a>Socket å¸¸ç”¨æ–¹æ³•</h4>
<p>ä¸‹é¢åˆ—å‡ºäº†ä¸€äº›æ„Ÿå…´è¶£çš„æ–¹æ³•ï¼Œæ³¨æ„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½æœ‰ä¸€ä¸ª Socket å¯¹è±¡ï¼Œæ‰€ä»¥æ— è®ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯éƒ½èƒ½å¤Ÿè°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th><strong>æ–¹æ³•</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>void connect(SocketAddress host, int timeout)</code></td>
<td>å°†æ­¤å¥—æ¥å­—è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªè¶…æ—¶å€¼ã€‚</td>
</tr>
<tr>
<td><code>InetAddress getInetAddress()</code></td>
<td>è¿”å›å¥—æ¥å­—è¿æ¥çš„åœ°å€ã€‚</td>
</tr>
<tr>
<td><code>int getPort()</code></td>
<td>è¿”å›æ­¤å¥—æ¥å­—è¿æ¥åˆ°çš„è¿œç¨‹ç«¯å£ã€‚</td>
</tr>
<tr>
<td><code>int getLocalPort()</code></td>
<td>è¿”å›æ­¤å¥—æ¥å­—ç»‘å®šåˆ°çš„æœ¬åœ°ç«¯å£ã€‚</td>
</tr>
<tr>
<td><code>SocketAddress getRemoteSocketAddress()</code></td>
<td>è¿”å›æ­¤å¥—æ¥å­—è¿æ¥çš„ç«¯ç‚¹çš„åœ°å€ï¼Œå¦‚æœæœªè¿æ¥åˆ™è¿”å› nullã€‚</td>
</tr>
<tr>
<td><code>InputStream getInputStream()</code></td>
<td>è¿”å›æ­¤å¥—æ¥å­—çš„è¾“å…¥æµã€‚</td>
</tr>
<tr>
<td><code>OutputStream getOutputStream()</code></td>
<td>è¿”å›æ­¤å¥—æ¥å­—çš„è¾“å‡ºæµã€‚</td>
</tr>
<tr>
<td><code>void close()</code></td>
<td>å…³é—­æ­¤å¥—æ¥å­—ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="-516"><a class="markdownIt-Anchor" href="#-516">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#socket-%E9%80%9A%E4%BF%A1%E7%A4%BA%E4%BE%8B">#</a>Socket é€šä¿¡ç¤ºä¾‹</h3>
<p>æœåŠ¡ç«¯ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloServer</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Socket æœåŠ¡ç«¯</span>
        <span class="token comment">// æœåŠ¡å™¨åœ¨8888ç«¯å£ä¸Šç›‘å¬</span>
        <span class="token class-name">ServerSocket</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡å™¨è¿è¡Œä¸­ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¾—åˆ°è¿æ¥ï¼Œç¨‹åºè¿›å…¥åˆ°é˜»å¡çŠ¶æ€</span>
        <span class="token class-name">Socket</span> client <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ‰“å°æµè¾“å‡ºæœ€æ–¹ä¾¿</span>
        <span class="token class-name">PrintStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‘å®¢æˆ·ç«¯è¾“å‡ºä¿¡æ¯</span>
        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœåŠ¡å™¨å·²å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œé€€å‡ºã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloClient</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Socket å®¢æˆ·ç«¯</span>
        <span class="token class-name">Socket</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStreamReader</span> inputStreamReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä¸€æ¬¡æ€§æ¥æ”¶å®Œæˆ</span>
        <span class="token class-name">BufferedReader</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>inputStreamReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡å™¨æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">"ï¼Œé€€å‡º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-517"><a class="markdownIt-Anchor" href="#-517">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#%E4%BA%8C%E3%80%81datagramsocket-%E5%92%8C-datagrampacket">#</a>äºŒã€DatagramSocket å’Œ DatagramPacket</h2>
<p>Java é€šè¿‡  <code>DatagramSocket</code>  å’Œ  <code>DatagramPacket</code>  å®ç°å¯¹ UDP åè®®çš„æ”¯æŒã€‚</p>
<ul>
<li><code>DatagramPacket</code> ï¼šæ•°æ®åŒ…ç±»</li>
<li><code>DatagramSocket</code> ï¼šé€šä¿¡ç±»</li>
</ul>
<p>UDP æœåŠ¡ç«¯ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UDPServer</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ‰€æœ‰å¼‚å¸¸æŠ›å‡º</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"hello World!!!"</span><span class="token punctuation">;</span>
        <span class="token class-name">DatagramSocket</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æœåŠ¡ç«¯åœ¨3000ç«¯å£ä¸Šç­‰å¾…æœåŠ¡å™¨å‘é€ä¿¡æ¯</span>
        <span class="token class-name">DatagramPacket</span> dp <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰€æœ‰çš„ä¿¡æ¯ä½¿ç”¨bufä¿å­˜</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å‘é€ä¿¡æ¯ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ds<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‘é€ä¿¡æ¯å‡ºå»</span>
        ds<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>UDP å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UDPClient</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æ‰€æœ‰å¼‚å¸¸æŠ›å‡º</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å¼€è¾Ÿç©ºé—´ï¼Œä»¥æ¥æ”¶æ•°æ®</span>
        <span class="token class-name">DatagramSocket</span> ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramSocket</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®¢æˆ·ç«¯åœ¨9000ç«¯å£ä¸Šç­‰å¾…æœåŠ¡å™¨å‘é€ä¿¡æ¯</span>
        <span class="token class-name">DatagramPacket</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatagramPacket</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰€æœ‰çš„ä¿¡æ¯ä½¿ç”¨bufä¿å­˜</span>
        ds<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¥æ”¶æ•°æ®</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>dp<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dp<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"from "</span> <span class="token operator">+</span> dp<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ï¼š"</span>
            <span class="token operator">+</span> dp<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡ºå†…å®¹</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-518"><a class="markdownIt-Anchor" href="#-518">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#%E4%B8%89%E3%80%81inetaddress">#</a>ä¸‰ã€InetAddress</h2>
<p><code>InetAddress</code>  ç±»è¡¨ç¤ºäº’è”ç½‘åè®® (IP) åœ°å€ã€‚</p>
<p>æ²¡æœ‰å…¬æœ‰çš„æ„é€ å‡½æ•°ï¼Œåªèƒ½é€šè¿‡é™æ€æ–¹æ³•æ¥åˆ›å»ºå®ä¾‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">InetAddress</span><span class="token punctuation">.</span><span class="token function">getByAddress</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> address<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-519"><a class="markdownIt-Anchor" href="#-519">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-net.html#%E5%9B%9B%E3%80%81url">#</a>å››ã€URL</h2>
<p>å¯ä»¥ç›´æ¥ä» URL ä¸­è¯»å–å­—èŠ‚æµæ•°æ®ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>

    <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* å­—èŠ‚æµ */</span>
    <span class="token class-name">InputStream</span> is <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* å­—ç¬¦æµ */</span>
    <span class="token class-name">InputStreamReader</span> isr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* æä¾›ç¼“å­˜åŠŸèƒ½ */</span>
    <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span>isr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> line<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    br<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="java-io-å·¥å…·ç±»"><a class="markdownIt-Anchor" href="#java-io-å·¥å…·ç±»">#</a> Java IO å·¥å…·ç±»</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>*<strong> å…³é”®è¯ï¼š <code>File</code> ã€ <code>RandomAccessFile</code> ã€ <code>System</code> ã€ <code>Scanner</code> *</strong></p>
<p>æœ¬æ–‡ä»‹ç» Java IO çš„ä¸€äº›å¸¸è§å·¥å…·ç±»çš„ç”¨æ³•å’Œç‰¹æ€§ã€‚</p>
</blockquote>
<ul>
<li>ä¸€ã€File
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#createnewfille">createNewFille</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#mkdir">mkdir</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#delete">delete</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#list-%E5%92%8C-listfiles">list å’Œ listFiles</a></li>
</ul>
</li>
<li>äºŒã€RandomAccessFile
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#randomaccessfile-%E5%86%99%E6%93%8D%E4%BD%9C">RandomAccessFile å†™æ“ä½œ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#randomaccessfile-%E8%AF%BB%E6%93%8D%E4%BD%9C">RandomAccessFile è¯»æ“ä½œ</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#%E4%B8%89system">ä¸‰ã€System</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#%E5%9B%9Bscanner">å››ã€Scanner</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-520"><a class="markdownIt-Anchor" href="#-520">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#%E4%B8%80%E3%80%81file">#</a>ä¸€ã€File</h2>
<p><code>File</code>  ç±»æ˜¯  <code>java.io</code>  åŒ…ä¸­å”¯ä¸€å¯¹æ–‡ä»¶æœ¬èº«è¿›è¡Œæ“ä½œçš„ç±»ã€‚å®ƒå¯ä»¥å¯¹æ–‡ä»¶ã€ç›®å½•è¿›è¡Œå¢åˆ æŸ¥æ“ä½œã€‚</p>
<h3 id="-521"><a class="markdownIt-Anchor" href="#-521">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#createnewfille">#</a>createNewFille</h3>
<p><strong>å¯ä»¥ä½¿ç”¨  <code>createNewFille()</code>  æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</strong>ã€‚</p>
<p>æ³¨ï¼š</p>
<p>Windows ä¸­ä½¿ç”¨åæ–œæ è¡¨ç¤ºç›®å½•çš„åˆ†éš”ç¬¦  <code>\</code> ã€‚</p>
<p>Linux ä¸­ä½¿ç”¨æ­£æ–œæ è¡¨ç¤ºç›®å½•çš„åˆ†éš”ç¬¦  <code>/</code> ã€‚</p>
<p>æœ€å¥½çš„åšæ³•æ˜¯ä½¿ç”¨  <code>File.separator</code>  é™æ€å¸¸é‡ï¼Œå¯ä»¥æ ¹æ®æ‰€åœ¨æ“ä½œç³»ç»Ÿé€‰å–å¯¹åº”çš„åˆ†éš”ç¬¦ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åˆ›å»ºæ–‡ä»¶</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> flag <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">createNewFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-522"><a class="markdownIt-Anchor" href="#-522">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#mkdir">#</a>mkdir</h3>
<p><strong>å¯ä»¥ä½¿ç”¨  <code>mkdir()</code>  æ¥åˆ›å»ºæ–‡ä»¶å¤¹</strong>ï¼Œä½†æ˜¯å¦‚æœè¦åˆ›å»ºçš„ç›®å½•çš„çˆ¶è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™æ— æ³•åˆ›å»ºæˆåŠŸã€‚</p>
<p>å¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨  <code>mkdirs()</code> ï¼Œå½“çˆ¶è·¯å¾„ä¸å­˜åœ¨æ—¶ï¼Œä¼šè¿åŒä¸Šçº§ç›®å½•éƒ½ä¸€å¹¶åˆ›å»ºã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åˆ›å»ºç›®å½•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> flag <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-523"><a class="markdownIt-Anchor" href="#-523">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#delete">#</a>delete</h3>
<p><strong>å¯ä»¥ä½¿ç”¨  <code>delete()</code>  æ¥åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•</strong>ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåˆ é™¤çš„æ˜¯ç›®å½•ï¼Œä¸”ç›®å½•ä¸ä¸ºç©ºï¼Œç›´æ¥ç”¨  <code>delete()</code>  åˆ é™¤ä¼šå¤±è´¥ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> flag <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="-524"><a class="markdownIt-Anchor" href="#-524">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#list-%E5%92%8C-listfiles">#</a>list å’Œ listFiles</h3>
<p><code>File</code>  ä¸­ç»™å‡ºäº†ä¸¤ç§åˆ—å‡ºæ–‡ä»¶å¤¹å†…å®¹çš„æ–¹æ³•ï¼š</p>
<ul>
<li><strong> <code>list()</code> : åˆ—å‡ºå…¨éƒ¨åç§°ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„</strong>ã€‚</li>
<li><strong> <code>listFiles()</code> : åˆ—å‡ºå®Œæ•´çš„è·¯å¾„ï¼Œè¿”å›ä¸€ä¸ª  <code>File</code>  å¯¹è±¡æ•°ç»„</strong>ã€‚</li>
</ul>
<p><code>list()</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>listFiles()</code>  ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">File</span> files<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="-525"><a class="markdownIt-Anchor" href="#-525">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#%E4%BA%8C%E3%80%81randomaccessfile">#</a>äºŒã€RandomAccessFile</h2>
<blockquote>
<p>æ³¨ï¼š <code>RandomAccessFile</code>  ç±»è™½ç„¶å¯ä»¥å®ç°å¯¹æ–‡ä»¶å†…å®¹çš„è¯»å†™æ“ä½œï¼Œä½†æ˜¯æ¯”è¾ƒå¤æ‚ã€‚æ‰€ä»¥ä¸€èˆ¬æ“ä½œæ–‡ä»¶å†…å®¹å¾€å¾€ä¼šä½¿ç”¨å­—èŠ‚æµæˆ–å­—ç¬¦æµæ–¹å¼ã€‚</p>
</blockquote>
<p><code>RandomAccessFile</code>  ç±»æ˜¯éšæœºè¯»å–ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç±»ã€‚</p>
<p>å®ƒé€‚ç”¨äºç”±å¤§å°å·²çŸ¥çš„è®°å½•ç»„æˆçš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨  <code>seek()</code>  å°†è®°å½•ä»ä¸€å¤„è½¬ç§»åˆ°å¦ä¸€å¤„ï¼Œç„¶åè¯»å–æˆ–è€…ä¿®æ”¹è®°å½•ã€‚</p>
<p>æ–‡ä»¶ä¸­è®°å½•çš„å¤§å°ä¸ä¸€å®šéƒ½ç›¸åŒï¼Œåªè¦èƒ½å¤Ÿç¡®å®šå“ªäº›è®°å½•æœ‰å¤šå¤§ä»¥åŠå®ƒä»¬åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®å³å¯ã€‚</p>
<h3 id="-526"><a class="markdownIt-Anchor" href="#-526">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#randomaccessfile-%E5%86%99%E6%93%8D%E4%BD%9C">#</a>RandomAccessFile å†™æ“ä½œ</h3>
<p>å½“ç”¨  <code>rw</code>  æ–¹å¼å£°æ˜  <code>RandomAccessFile</code>  å¯¹è±¡æ—¶ï¼Œå¦‚æœè¦å†™å…¥çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œç³»ç»Ÿå°†è‡ªè¡Œåˆ›å»ºã€‚</p>
<p><code>r</code>  ä¸ºåªè¯»ï¼› <code>w</code>  ä¸ºåªå†™ï¼› <code>rw</code>  ä¸ºè¯»å†™ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ–‡ä»¶éšæœºè¯»å†™</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomAccessFileDemo01</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"d:"</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŒ‡å®šè¦æ“ä½œçš„æ–‡ä»¶</span>
        <span class="token class-name">RandomAccessFile</span> rdf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// å£°æ˜RandomAccessFileç±»çš„å¯¹è±¡</span>
        rdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"rw"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¯»å†™æ¨¡å¼ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        name <span class="token operator">=</span> <span class="token string">"zhangsan"</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸²é•¿åº¦ä¸º8</span>
        age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// æ•°å­—çš„é•¿åº¦ä¸º4</span>
        rdf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å§“åå†™å…¥æ–‡ä»¶ä¹‹ä¸­</span>
        rdf<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å¹´é¾„å†™å…¥æ–‡ä»¶ä¹‹ä¸­</span>
        name <span class="token operator">=</span> <span class="token string">"lisi    "</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸²é•¿åº¦ä¸º8</span>
        age <span class="token operator">=</span> <span class="token number">31</span><span class="token punctuation">;</span> <span class="token comment">// æ•°å­—çš„é•¿åº¦ä¸º4</span>
        rdf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å§“åå†™å…¥æ–‡ä»¶ä¹‹ä¸­</span>
        rdf<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å¹´é¾„å†™å…¥æ–‡ä»¶ä¹‹ä¸­</span>
        name <span class="token operator">=</span> <span class="token string">"wangwu  "</span><span class="token punctuation">;</span> <span class="token comment">// å­—ç¬¦ä¸²é•¿åº¦ä¸º8</span>
        age <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token comment">// æ•°å­—çš„é•¿åº¦ä¸º4</span>
        rdf<span class="token punctuation">.</span><span class="token function">writeBytes</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å§“åå†™å…¥æ–‡ä»¶ä¹‹ä¸­</span>
        rdf<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†å¹´é¾„å†™å…¥æ–‡ä»¶ä¹‹ä¸­</span>
        rdf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…³é—­</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-527"><a class="markdownIt-Anchor" href="#-527">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#randomaccessfile-%E8%AF%BB%E6%93%8D%E4%BD%9C">#</a>RandomAccessFile è¯»æ“ä½œ</h3>
<p>è¯»å–æ˜¯ç›´æ¥ä½¿ç”¨  <code>r</code>  çš„æ¨¡å¼å³å¯ï¼Œä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚</p>
<p>è¯»å–æ—¶æ‰€æœ‰çš„å­—ç¬¦ä¸²åªèƒ½æŒ‰ç…§ byte æ•°ç»„æ–¹å¼è¯»å–å‡ºæ¥ï¼Œè€Œä¸”é•¿åº¦å¿…é¡»å’Œå†™å…¥æ—¶çš„å›ºå®šå¤§å°ç›¸åŒ¹é…ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomAccessFileDemo02</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"d:"</span> <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separator <span class="token operator">+</span> <span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æŒ‡å®šè¦æ“ä½œçš„æ–‡ä»¶</span>
        <span class="token class-name">RandomAccessFile</span> rdf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token comment">// å£°æ˜RandomAccessFileç±»çš„å¯¹è±¡</span>
        rdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä»¥åªè¯»çš„æ–¹å¼æ‰“å¼€æ–‡ä»¶</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// å¼€è¾Ÿbyteæ•°ç»„</span>
        <span class="token comment">// è¯»å–ç¬¬äºŒä¸ªäººçš„ä¿¡æ¯ï¼Œæ„å‘³ç€è¦ç©ºå‡ºç¬¬ä¸€ä¸ªäººçš„ä¿¡æ¯</span>
        rdf<span class="token punctuation">.</span><span class="token function">skipBytes</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·³è¿‡ç¬¬ä¸€ä¸ªäººçš„ä¿¡æ¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rdf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¯»å–ä¸€ä¸ªå­—èŠ‚</span>
        <span class="token punctuation">&#125;</span>
        name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å°†è¯»å–å‡ºæ¥çš„byteæ•°ç»„å˜ä¸ºå­—ç¬¦ä¸²</span>
        age <span class="token operator">=</span> rdf<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¯»å–æ•°å­—</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¬¬äºŒä¸ªäººçš„ä¿¡æ¯ --> å§“åï¼š"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"ï¼›å¹´é¾„ï¼š"</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è¯»å–ç¬¬ä¸€ä¸ªäººçš„ä¿¡æ¯</span>
        rdf<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æŒ‡é’ˆå›åˆ°æ–‡ä»¶çš„å¼€å¤´</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rdf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¯»å–ä¸€ä¸ªå­—èŠ‚</span>
        <span class="token punctuation">&#125;</span>
        name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å°†è¯»å–å‡ºæ¥çš„byteæ•°ç»„å˜ä¸ºå­—ç¬¦ä¸²</span>
        age <span class="token operator">=</span> rdf<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¯»å–æ•°å­—</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¬¬ä¸€ä¸ªäººçš„ä¿¡æ¯ --> å§“åï¼š"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"ï¼›å¹´é¾„ï¼š"</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rdf<span class="token punctuation">.</span><span class="token function">skipBytes</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ç©ºå‡ºç¬¬äºŒä¸ªäººçš„ä¿¡æ¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rdf<span class="token punctuation">.</span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¯»å–ä¸€ä¸ªå­—èŠ‚</span>
        <span class="token punctuation">&#125;</span>
        name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å°†è¯»å–å‡ºæ¥çš„byteæ•°ç»„å˜ä¸ºå­—ç¬¦ä¸²</span>
        age <span class="token operator">=</span> rdf<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¯»å–æ•°å­—</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¬¬ä¸‰ä¸ªäººçš„ä¿¡æ¯ --> å§“åï¼š"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"ï¼›å¹´é¾„ï¼š"</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rdf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å…³é—­</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-528"><a class="markdownIt-Anchor" href="#-528">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#%E4%B8%89%E3%80%81system">#</a>ä¸‰ã€System</h2>
<p><code>System</code>  ç±»ä¸­æä¾›äº†å¤§é‡çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥è·å–ç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯æˆ–ç³»ç»Ÿçº§æ“ä½œï¼Œå…¶ä¸­æä¾›äº†ä¸‰ä¸ªå¸¸ç”¨äº IO çš„é™æ€æˆå‘˜ï¼š</p>
<ul>
<li><code>System.out</code>  - ä¸€ä¸ª PrintStream æµã€‚System.out ä¸€èˆ¬ä¼šæŠŠä½ å†™åˆ°å…¶ä¸­çš„æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Šã€‚System.out é€šå¸¸ä»…ç”¨åœ¨ç±»ä¼¼å‘½ä»¤è¡Œå·¥å…·çš„æ§åˆ¶å°ç¨‹åºä¸Šã€‚System.out ä¹Ÿç»å¸¸ç”¨äºæ‰“å°ç¨‹åºçš„è°ƒè¯•ä¿¡æ¯ (å°½ç®¡å®ƒå¯èƒ½å¹¶ä¸æ˜¯è·å–ç¨‹åºè°ƒè¯•ä¿¡æ¯çš„æœ€ä½³æ–¹å¼)ã€‚</li>
<li><code>System.err</code>  - ä¸€ä¸ª PrintStream æµã€‚System.err ä¸ System.out çš„è¿è¡Œæ–¹å¼ç±»ä¼¼ï¼Œä½†å®ƒæ›´å¤šçš„æ˜¯ç”¨äºæ‰“å°é”™è¯¯æ–‡æœ¬ã€‚ä¸€äº›ç±»ä¼¼ Eclipse çš„ç¨‹åºï¼Œä¸ºäº†è®©é”™è¯¯ä¿¡æ¯æ›´åŠ æ˜¾çœ¼ï¼Œä¼šå°†é”™è¯¯ä¿¡æ¯ä»¥çº¢è‰²æ–‡æœ¬çš„å½¢å¼é€šè¿‡ System.err è¾“å‡ºåˆ°æ§åˆ¶å°ä¸Šã€‚</li>
<li><code>System.in</code>  - ä¸€ä¸ªå…¸å‹çš„è¿æ¥æ§åˆ¶å°ç¨‹åºå’Œé”®ç›˜è¾“å…¥çš„ InputStream æµã€‚é€šå¸¸å½“æ•°æ®é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æˆ–è€…é…ç½®æ–‡ä»¶ä¼ é€’ç»™å‘½ä»¤è¡Œ Java ç¨‹åºçš„æ—¶å€™ï¼Œ<a target="_blank" rel="noopener" href="http://System.in">System.in</a> å¹¶ä¸æ˜¯å¾ˆå¸¸ç”¨ã€‚å›¾å½¢ç•Œé¢ç¨‹åºé€šè¿‡ç•Œé¢ä¼ é€’å‚æ•°ç»™ç¨‹åºï¼Œè¿™æ˜¯ä¸€å—å•ç‹¬çš„ Java IO è¾“å…¥æœºåˆ¶ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘é‡å®šå‘  <code>System.out</code>  è¾“å‡ºæµ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SystemOutDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">OutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"d:\\test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintStream</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setOut</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"äººç”Ÿè‹¥åªå¦‚åˆè§ï¼Œä½•äº‹ç§‹é£æ‚²ç”»æ‰‡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ps<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘é‡å®šå‘  <code>System.err</code>  è¾“å‡ºæµ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SystemErrDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">OutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å®ä¾‹åŒ–</span>
        <span class="token class-name">PrintStream</span> ps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å®ä¾‹åŒ–</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setErr</span><span class="token punctuation">(</span>ps<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºé‡å®šå‘</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"æ­¤å¤„æœ‰è¯¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// è¾“å‡ºå†…å­˜ä¸­çš„æ•°æ®</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘ <code>System.in</code>  æ¥å—æ§åˆ¶å°è¾“å…¥ä¿¡æ¯</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SystemInDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">InputStream</span> input <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">;</span>
        <span class="token class-name">StringBuffer</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥å†…å®¹ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">char</span> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> temp<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥çš„å†…å®¹ä¸ºï¼š"</span> <span class="token operator">+</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        input<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-529"><a class="markdownIt-Anchor" href="#-529">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/io/java-io-tool.html#%E5%9B%9B%E3%80%81scanner">#</a>å››ã€Scanner</h2>
<p><strong> <code>Scanner</code>  å¯ä»¥è·å–ç”¨æˆ·çš„è¾“å…¥ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒ</strong>ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ ¡éªŒè¾“å…¥æ•°æ®æ˜¯å¦æ ¼å¼æ­£ç¡®</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScannerDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Scanner</span> scan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä»é”®ç›˜æ¥æ”¶æ•°æ®</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> f <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥æ•´æ•°ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scan<span class="token punctuation">.</span><span class="token function">hasNextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ¤æ–­è¾“å…¥çš„æ˜¯å¦æ˜¯æ•´æ•°</span>
            i <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ¥æ”¶æ•´æ•°</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ•´æ•°æ•°æ®ï¼š"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥çš„ä¸æ˜¯æ•´æ•°ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥å°æ•°ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scan<span class="token punctuation">.</span><span class="token function">hasNextFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ¤æ–­è¾“å…¥çš„æ˜¯å¦æ˜¯å°æ•°</span>
            f <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">nextFloat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ¥æ”¶å°æ•°</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å°æ•°æ•°æ®ï¼š"</span> <span class="token operator">+</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥çš„ä¸æ˜¯å°æ•°ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥æ—¥æœŸï¼ˆyyyy-MM-ddï¼‰ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scan<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token string">"^\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;$"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ¤æ–­</span>
            str <span class="token operator">=</span> scan<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">"^\\d&#123;4&#125;-\\d&#123;2&#125;-\\d&#123;2&#125;$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ¥æ”¶</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¾“å…¥çš„æ—¥æœŸæ ¼å¼é”™è¯¯ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">è¾“å…¥æ•´æ•°ï¼š20
æ•´æ•°æ•°æ®ï¼š20
è¾“å…¥å°æ•°ï¼š3.2
å°æ•°æ•°æ®ï¼š3.2
è¾“å…¥æ—¥æœŸï¼ˆyyyy-MM-ddï¼‰ï¼š1988-13-1
è¾“å…¥çš„æ—¥æœŸæ ¼å¼é”™è¯¯ï¼
null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="java-å¹¶å‘ç®€ä»‹"><a class="markdownIt-Anchor" href="#java-å¹¶å‘ç®€ä»‹">#</a> Java å¹¶å‘ç®€ä»‹</h1>
<blockquote>
<p><strong>å…³é”®è¯</strong>ï¼š <code>è¿›ç¨‹</code> ã€ <code>çº¿ç¨‹</code> ã€ <code>å®‰å…¨æ€§</code> ã€ <code>æ´»è·ƒæ€§</code> ã€ <code>æ€§èƒ½</code> ã€ <code>æ­»é”</code> ã€ <code>é¥¥é¥¿</code> ã€ <code>ä¸Šä¸‹æ–‡åˆ‡æ¢</code></p>
<p><strong>æ‘˜è¦</strong>ï¼šå¹¶å‘ç¼–ç¨‹å¹¶é Java è¯­è¨€æ‰€ç‹¬æœ‰ï¼Œè€Œæ˜¯ä¸€ç§æˆç†Ÿçš„ç¼–ç¨‹èŒƒå¼ï¼ŒJava åªæ˜¯ç”¨è‡ªå·±çš„æ–¹å¼å®ç°äº†å¹¶å‘å·¥ä½œæ¨¡å‹ã€‚å­¦ä¹  Java å¹¶å‘ç¼–ç¨‹ï¼Œåº”è¯¥å…ˆç†Ÿæ‚‰å¹¶å‘çš„åŸºæœ¬æ¦‚å¿µï¼Œç„¶åè¿›ä¸€æ­¥äº†è§£å¹¶å‘çš„ç‰¹æ€§ä»¥åŠå…¶ç‰¹æ€§æ‰€é¢ä¸´çš„é—®é¢˜ã€‚æŒæ¡äº†è¿™äº›ï¼Œå½“å­¦ä¹  Java å¹¶å‘å·¥å…·æ—¶ï¼Œæ‰ä¼šæ˜ç™½å®ƒä»¬å„è‡ªæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ã€‚é€šè¿‡è¿™æ ·ç”±ç‚¹åˆ°é¢çš„å­¦ä¹ æ–¹å¼ï¼Œæ›´å®¹æ˜“èä¼šè´¯é€šï¼Œå°†å¹¶å‘çŸ¥è¯†å½¢æˆä½“ç³»åŒ–ã€‚</p>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200701113445.png" alt="img"></p>
<ul>
<li>\1. å¹¶å‘æ¦‚å¿µ
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#11-%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C">1.1. å¹¶å‘å’Œå¹¶è¡Œ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#12-%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5">1.2. åŒæ­¥å’Œå¼‚æ­¥</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#13-%E9%98%BB%E5%A1%9E%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E">1.3. é˜»å¡å’Œéé˜»å¡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#14-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B">1.4. è¿›ç¨‹å’Œçº¿ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#15-%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6%E5%92%8C%E4%B8%B4%E7%95%8C%E5%8C%BA">1.5. ç«æ€æ¡ä»¶å’Œä¸´ç•ŒåŒº</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#16-%E7%AE%A1%E7%A8%8B">1.6. ç®¡ç¨‹</a></li>
</ul>
</li>
<li>\2. å¹¶å‘çš„ç‰¹ç‚¹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#21-%E6%8F%90%E5%8D%87%E8%B5%84%E6%BA%90%E5%88%A9%E7%94%A8%E7%8E%87">2.1. æå‡èµ„æºåˆ©ç”¨ç‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#22-%E7%A8%8B%E5%BA%8F%E5%93%8D%E5%BA%94%E6%9B%B4%E5%BF%AB">2.2. ç¨‹åºå“åº”æ›´å¿«</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#23-%E5%B9%B6%E5%8F%91%E7%9A%84%E9%97%AE%E9%A2%98">2.3. å¹¶å‘çš„é—®é¢˜</a></li>
</ul>
</li>
<li>\3. å®‰å…¨æ€§é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#31-%E7%BC%93%E5%AD%98%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7%E9%97%AE%E9%A2%98">3.1. ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#32-%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%E9%97%AE%E9%A2%98">3.2. çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#33-%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E5%B8%A6%E6%9D%A5%E7%9A%84%E6%9C%89%E5%BA%8F%E6%80%A7%E9%97%AE%E9%A2%98">3.3. ç¼–è¯‘ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#34-%E4%BF%9D%E8%AF%81%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E7%9A%84%E6%80%9D%E8%B7%AF">3.4. ä¿è¯å¹¶å‘å®‰å…¨çš„æ€è·¯</a></li>
</ul>
</li>
<li>\4. æ´»è·ƒæ€§é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#41-%E6%AD%BB%E9%94%81deadlock">4.1. æ­»é”ï¼ˆDeadlockï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#42-%E6%B4%BB%E9%94%81livelock">4.2. æ´»é”ï¼ˆLivelockï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#43-%E9%A5%A5%E9%A5%BFstarvation">4.3. é¥¥é¥¿ï¼ˆStarvationï¼‰</a></li>
</ul>
</li>
<li>\5. æ€§èƒ½é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#51-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2">5.1. ä¸Šä¸‹æ–‡åˆ‡æ¢</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#52-%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6">5.2. èµ„æºé™åˆ¶</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#6-%E5%B0%8F%E7%BB%93">6. å°ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-530"><a class="markdownIt-Anchor" href="#-530">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_1-%E5%B9%B6%E5%8F%91%E6%A6%82%E5%BF%B5">#</a>1. å¹¶å‘æ¦‚å¿µ</h2>
<p>å¹¶å‘ç¼–ç¨‹ä¸­æœ‰å¾ˆå¤šæœ¯è¯­æ¦‚å¿µç›¸è¿‘ï¼Œå®¹æ˜“è®©äººæ··æ·†ã€‚æœ¬èŠ‚å†…å®¹é€šè¿‡å¯¹æ¯”åˆ†æï¼ŒåŠ›æ±‚è®©è¯»è€…æ¸…æ™°ç†è§£å…¶æ¦‚å¿µä»¥åŠå·®å¼‚ã€‚</p>
<h3 id="-531"><a class="markdownIt-Anchor" href="#-531">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_1-1-%E5%B9%B6%E5%8F%91%E5%92%8C%E5%B9%B6%E8%A1%8C">#</a>1.1. å¹¶å‘å’Œå¹¶è¡Œ</h3>
<p>å¹¶å‘å’Œå¹¶è¡Œæ˜¯æœ€å®¹æ˜“è®©æ–°æ‰‹è´¹è§£çš„æ¦‚å¿µï¼Œé‚£ä¹ˆå¦‚ä½•ç†è§£äºŒè€…å‘¢ï¼Ÿå…¶æœ€å…³é”®çš„å·®å¼‚åœ¨äºï¼šæ˜¯å¦æ˜¯<strong>åŒæ—¶</strong>å‘ç”Ÿï¼š</p>
<ul>
<li><strong>å¹¶å‘</strong>ï¼šæ˜¯æŒ‡å…·å¤‡å¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ï¼Œä½†ä¸ä¸€å®šè¦åŒæ—¶ã€‚</li>
<li><strong>å¹¶è¡Œ</strong>ï¼šæ˜¯æŒ‡å…·å¤‡åŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯æˆ‘è§è¿‡æœ€ç”ŸåŠ¨çš„è¯´æ˜ï¼Œæ‘˜è‡ª <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/33515481/answer/58849148">å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€”â€” çŸ¥ä¹çš„é«˜ç¥¨ç­”æ¡ˆ (opens new window)</a>ï¼š</p>
<ul>
<li>ä½ åƒé¥­åƒåˆ°ä¸€åŠï¼Œç”µè¯æ¥äº†ï¼Œä½ ä¸€ç›´åˆ°åƒå®Œäº†ä»¥åæ‰å»æ¥ï¼Œè¿™å°±è¯´æ˜ä½ ä¸æ”¯æŒå¹¶å‘ä¹Ÿä¸æ”¯æŒå¹¶è¡Œã€‚</li>
<li>ä½ åƒé¥­åƒåˆ°ä¸€åŠï¼Œç”µè¯æ¥äº†ï¼Œä½ åœäº†ä¸‹æ¥æ¥äº†ç”µè¯ï¼Œæ¥å®Œåç»§ç»­åƒé¥­ï¼Œè¿™è¯´æ˜ä½ æ”¯æŒå¹¶å‘ã€‚</li>
<li>ä½ åƒé¥­åƒåˆ°ä¸€åŠï¼Œç”µè¯æ¥äº†ï¼Œä½ ä¸€è¾¹æ‰“ç”µè¯ä¸€è¾¹åƒé¥­ï¼Œè¿™è¯´æ˜ä½ æ”¯æŒå¹¶è¡Œã€‚</li>
</ul>
<h3 id="-532"><a class="markdownIt-Anchor" href="#-532">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_1-2-%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5">#</a>1.2. åŒæ­¥å’Œå¼‚æ­¥</h3>
<ul>
<li><strong>åŒæ­¥</strong>ï¼šæ˜¯æŒ‡åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚</li>
<li><strong>å¼‚æ­¥</strong>ï¼šåˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåï¼Œè°ƒç”¨è€…ä¸ä¼šç«‹åˆ»å¾—åˆ°ç»“æœã€‚è€Œæ˜¯åœ¨è°ƒç”¨å‘å‡ºåï¼Œè¢«è°ƒç”¨è€…é€šè¿‡çŠ¶æ€ã€é€šçŸ¥æ¥é€šçŸ¥è°ƒç”¨è€…ï¼Œæˆ–é€šè¿‡å›è°ƒå‡½æ•°å¤„ç†è¿™ä¸ªè°ƒç”¨ã€‚</li>
</ul>
<p>ä¸¾ä¾‹æ¥è¯´æ˜ï¼š</p>
<ul>
<li>åŒæ­¥å°±åƒæ˜¯æ‰“ç”µè¯ï¼šä¸æŒ‚ç”µè¯ï¼Œé€šè¯ä¸ä¼šç»“æŸã€‚</li>
<li>å¼‚æ­¥å°±åƒæ˜¯å‘çŸ­ä¿¡ï¼šå‘å®ŒçŸ­ä¿¡åï¼Œå°±å¯ä»¥åšå…¶ä»–äº‹ï¼›å½“æ”¶åˆ°å›å¤çŸ­ä¿¡æ—¶ï¼Œæ‰‹æœºä¼šé€šè¿‡é“ƒå£°æˆ–æŒ¯åŠ¨æ¥æé†’ã€‚</li>
</ul>
<h3 id="-533"><a class="markdownIt-Anchor" href="#-533">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_1-3-%E9%98%BB%E5%A1%9E%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E">#</a>1.3. é˜»å¡å’Œéé˜»å¡</h3>
<p>é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€ï¼š</p>
<ul>
<li><strong>é˜»å¡</strong>ï¼šæ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚</li>
<li><strong>éé˜»å¡</strong>ï¼šæ˜¯æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</li>
</ul>
<p>ä¸¾ä¾‹æ¥è¯´æ˜ï¼š</p>
<ul>
<li>é˜»å¡è°ƒç”¨å°±åƒæ˜¯æ‰“ç”µè¯ï¼Œé€šè¯ä¸ç»“æŸï¼Œä¸èƒ½æ”¾ä¸‹ã€‚</li>
<li>éé˜»å¡è°ƒç”¨å°±åƒæ˜¯å‘çŸ­ä¿¡ï¼Œå‘å®ŒçŸ­ä¿¡åï¼Œå°±å¯ä»¥åšå…¶ä»–äº‹ï¼ŒçŸ­ä¿¡æ¥äº†ï¼Œæ‰‹æœºä¼šæé†’ã€‚</li>
</ul>
<h3 id="-534"><a class="markdownIt-Anchor" href="#-534">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_1-4-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B">#</a>1.4. è¿›ç¨‹å’Œçº¿ç¨‹</h3>
<ul>
<li><strong>è¿›ç¨‹</strong>ï¼šè¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚è¿›ç¨‹å¯è§†ä¸ºä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚</li>
<li><strong>çº¿ç¨‹</strong>ï¼šçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li>
</ul>
<p>è¿›ç¨‹å’Œçº¿ç¨‹çš„å·®å¼‚ï¼š</p>
<ul>
<li>ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</li>
<li>çº¿ç¨‹æ¯”è¿›ç¨‹åˆ’åˆ†æ›´ç»†ï¼Œæ‰€ä»¥æ‰§è¡Œå¼€é”€æ›´å°ï¼Œå¹¶å‘æ€§æ›´é«˜</li>
<li>è¿›ç¨‹æ˜¯ä¸€ä¸ªå®ä½“ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„èµ„æºï¼›è€ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/processes-vs-threads.jpg" alt="img"></p>
<p>JVM åœ¨å•ä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼ŒJVM ä¸­çš„çº¿ç¨‹å…±äº«å±äºè¯¥è¿›ç¨‹çš„å †ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡ ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå¯¹è±¡ã€‚çº¿ç¨‹å…±äº«å †å¹¶æ‹¥æœ‰è‡ªå·±çš„å †æ ˆç©ºé—´ã€‚è¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹å¦‚ä½•è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ä»¥åŠå®ƒçš„å±€éƒ¨å˜é‡æ˜¯å¦‚ä½•ä¿æŒçº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯å †ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„å¹¶ä¸”ä¸ºäº†çº¿ç¨‹å®‰å…¨å¿…é¡»è¿›è¡ŒåŒæ­¥ã€‚</p>
<h3 id="-535"><a class="markdownIt-Anchor" href="#-535">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_1-5-%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6%E5%92%8C%E4%B8%B4%E7%95%8C%E5%8C%BA">#</a>1.5. ç«æ€æ¡ä»¶å’Œä¸´ç•ŒåŒº</h3>
<ul>
<li><strong>ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰</strong>ï¼šå½“ä¸¤ä¸ªçº¿ç¨‹ç«äº‰åŒä¸€èµ„æºæ—¶ï¼Œå¦‚æœå¯¹èµ„æºçš„è®¿é—®é¡ºåºæ•æ„Ÿï¼Œå°±ç§°å­˜åœ¨ç«æ€æ¡ä»¶ã€‚</li>
<li><strong>ä¸´ç•ŒåŒºï¼ˆCritical Sectionsï¼‰</strong>ï¼šå¯¼è‡´ç«æ€æ¡ä»¶å‘ç”Ÿçš„ä»£ç åŒºç§°ä½œä¸´ç•ŒåŒºã€‚</li>
</ul>
<h3 id="-536"><a class="markdownIt-Anchor" href="#-536">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_1-6-%E7%AE%A1%E7%A8%8B">#</a>1.6. ç®¡ç¨‹</h3>
<p>ç®¡ç¨‹ï¼ˆMonitorï¼‰ï¼Œæ˜¯æŒ‡ç®¡ç†å…±äº«å˜é‡ä»¥åŠå¯¹å…±äº«å˜é‡çš„æ“ä½œè¿‡ç¨‹ï¼Œè®©ä»–ä»¬æ”¯æŒå¹¶å‘ã€‚</p>
<p>Java é‡‡ç”¨çš„æ˜¯ç®¡ç¨‹æŠ€æœ¯ï¼Œsynchronized å…³é”®å­—åŠ wait ()ã€notify ()ã€notifyAll () è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯ç®¡ç¨‹çš„ç»„æˆéƒ¨åˆ†ã€‚è€Œ<strong>ç®¡ç¨‹å’Œä¿¡å·é‡æ˜¯ç­‰ä»·çš„ï¼Œæ‰€è°“ç­‰ä»·æŒ‡çš„æ˜¯ç”¨ç®¡ç¨‹èƒ½å¤Ÿå®ç°ä¿¡å·é‡ï¼Œä¹Ÿèƒ½ç”¨ä¿¡å·é‡å®ç°ç®¡ç¨‹</strong>ã€‚</p>
<h2 id="-537"><a class="markdownIt-Anchor" href="#-537">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_2-%E5%B9%B6%E5%8F%91%E7%9A%84%E7%89%B9%E7%82%B9">#</a>2. å¹¶å‘çš„ç‰¹ç‚¹</h2>
<p>æŠ€æœ¯åœ¨è¿›æ­¥ï¼ŒCPUã€å†…å­˜ã€I/O è®¾å¤‡çš„æ€§èƒ½ä¹Ÿåœ¨ä¸æ–­æé«˜ã€‚ä½†æ˜¯ï¼Œå§‹ç»ˆå­˜åœ¨ä¸€ä¸ªæ ¸å¿ƒçŸ›ç›¾ï¼š<strong>CPUã€å†…å­˜ã€I/O è®¾å¤‡å­˜åœ¨é€Ÿåº¦å·®å¼‚</strong>ã€‚CPU è¿œå¿«äºå†…å­˜ï¼Œå†…å­˜è¿œå¿«äº I/O è®¾å¤‡ã€‚</p>
<p>æœ¨æ¡¶çŸ­æ¿ç†è®ºå‘Šè¯‰æˆ‘ä»¬ï¼šä¸€åªæœ¨æ¡¶èƒ½è£…å¤šå°‘æ°´ï¼Œå–å†³äºæœ€çŸ­çš„é‚£å—æœ¨æ¿ã€‚åŒç†ï¼Œç¨‹åºæ•´ä½“æ€§èƒ½å–å†³äºæœ€æ…¢çš„æ“ä½œï¼ˆå³ I/O æ“ä½œï¼‰ï¼Œæ‰€ä»¥å•æ–¹é¢æé«˜ CPUã€å†…å­˜çš„æ€§èƒ½æ˜¯æ— æ•ˆçš„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20201225170052.jpg" alt="img"></p>
<p>ä¸ºäº†åˆç†åˆ©ç”¨ CPU çš„é«˜æ€§èƒ½ï¼Œå¹³è¡¡è¿™ä¸‰è€…çš„é€Ÿåº¦å·®å¼‚ï¼Œè®¡ç®—æœºä½“ç³»æœºæ„ã€æ“ä½œç³»ç»Ÿã€ç¼–è¯‘ç¨‹åºéƒ½åšå‡ºäº†è´¡çŒ®ï¼Œä¸»è¦ä½“ç°ä¸ºï¼š</p>
<ul>
<li><strong>CPU å¢åŠ äº†ç¼“å­˜</strong>ï¼Œä»¥å‡è¡¡ä¸å†…å­˜çš„é€Ÿåº¦å·®å¼‚ï¼›</li>
<li><strong>æ“ä½œç³»ç»Ÿå¢åŠ äº†è¿›ç¨‹ã€çº¿ç¨‹</strong>ï¼Œä»¥åˆ†æ—¶å¤ç”¨ CPUï¼Œè¿›è€Œå‡è¡¡ CPU ä¸ I/O è®¾å¤‡çš„é€Ÿåº¦å·®å¼‚ï¼›</li>
<li><strong>ç¼–è¯‘ç¨‹åºä¼˜åŒ–æŒ‡ä»¤æ‰§è¡Œæ¬¡åº</strong>ï¼Œä½¿å¾—ç¼“å­˜èƒ½å¤Ÿå¾—åˆ°æ›´åŠ åˆç†åœ°åˆ©ç”¨ã€‚</li>
</ul>
<p>å…¶ä¸­ï¼Œè¿›ç¨‹ã€çº¿ç¨‹ä½¿å¾—è®¡ç®—æœºã€ç¨‹åºæœ‰äº†å¹¶å‘å¤„ç†ä»»åŠ¡çš„èƒ½åŠ›ã€‚</p>
<p>å¹¶å‘çš„ä¼˜ç‚¹åœ¨äºï¼š</p>
<ul>
<li>æå‡èµ„æºåˆ©ç”¨ç‡</li>
<li>ç¨‹åºå“åº”æ›´å¿«</li>
</ul>
<h3 id="-538"><a class="markdownIt-Anchor" href="#-538">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_2-1-%E6%8F%90%E5%8D%87%E8%B5%84%E6%BA%90%E5%88%A9%E7%94%A8%E7%8E%87">#</a>2.1. æå‡èµ„æºåˆ©ç”¨ç‡</h3>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºéœ€è¦ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–å’Œå¤„ç†æ–‡ä»¶çš„æƒ…æ™¯ã€‚æ¯”æ–¹è¯´ï¼Œä»ç£ç›˜è¯»å–ä¸€ä¸ªæ–‡ä»¶éœ€è¦ 5 ç§’ï¼Œå¤„ç†ä¸€ä¸ªæ–‡ä»¶éœ€è¦ 2 ç§’ã€‚å¤„ç†ä¸¤ä¸ªæ–‡ä»¶åˆ™éœ€è¦ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">5ç§’è¯»å–æ–‡ä»¶A
2ç§’å¤„ç†æ–‡ä»¶A
5ç§’è¯»å–æ–‡ä»¶B
2ç§’å¤„ç†æ–‡ä»¶B
---------------------
æ€»å…±éœ€è¦14ç§’<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»ç£ç›˜ä¸­è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†çš„ CPU æ—¶é—´ç”¨äºç­‰å¾…ç£ç›˜å»è¯»å–æ•°æ®ã€‚åœ¨è¿™æ®µæ—¶é—´é‡Œï¼ŒCPU éå¸¸çš„ç©ºé—²ã€‚å®ƒå¯ä»¥åšä¸€äº›åˆ«çš„äº‹æƒ…ã€‚é€šè¿‡æ”¹å˜æ“ä½œçš„é¡ºåºï¼Œå°±èƒ½å¤Ÿæ›´å¥½çš„ä½¿ç”¨ CPU èµ„æºã€‚çœ‹ä¸‹é¢çš„é¡ºåºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">5ç§’è¯»å–æ–‡ä»¶A
5ç§’è¯»å–æ–‡ä»¶B + 2ç§’å¤„ç†æ–‡ä»¶A
2ç§’å¤„ç†æ–‡ä»¶B
---------------------
æ€»å…±éœ€è¦12ç§’<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>CPU ç­‰å¾…ç¬¬ä¸€ä¸ªæ–‡ä»¶è¢«è¯»å–å®Œã€‚ç„¶åå¼€å§‹è¯»å–ç¬¬äºŒä¸ªæ–‡ä»¶ã€‚å½“ç¬¬äºŒæ–‡ä»¶åœ¨è¢«è¯»å–çš„æ—¶å€™ï¼ŒCPU ä¼šå»å¤„ç†ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚è®°ä½ï¼Œåœ¨ç­‰å¾…ç£ç›˜è¯»å–æ–‡ä»¶çš„æ—¶å€™ï¼ŒCPU å¤§ éƒ¨åˆ†æ—¶é—´æ˜¯ç©ºé—²çš„ã€‚</p>
<p>æ€»çš„è¯´æ¥ï¼ŒCPU èƒ½å¤Ÿåœ¨ç­‰å¾… IO çš„æ—¶å€™åšä¸€äº›å…¶ä»–çš„äº‹æƒ…ã€‚è¿™ä¸ªä¸ä¸€å®šå°±æ˜¯ç£ç›˜ IOã€‚å®ƒä¹Ÿå¯ä»¥æ˜¯ç½‘ç»œçš„ IOï¼Œæˆ–è€…ç”¨æˆ·è¾“å…¥ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç½‘ç»œå’Œç£ç›˜çš„ IO æ¯” CPU å’Œå†…å­˜çš„ IO æ…¢çš„å¤šã€‚</p>
<h3 id="-539"><a class="markdownIt-Anchor" href="#-539">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_2-2-%E7%A8%8B%E5%BA%8F%E5%93%8D%E5%BA%94%E6%9B%B4%E5%BF%AB">#</a>2.2. ç¨‹åºå“åº”æ›´å¿«</h3>
<p>å°†ä¸€ä¸ªå•çº¿ç¨‹åº”ç”¨ç¨‹åºå˜æˆå¤šçº¿ç¨‹åº”ç”¨ç¨‹åºçš„å¦ä¸€ä¸ªå¸¸è§çš„ç›®çš„æ˜¯å®ç°ä¸€ä¸ªå“åº”æ›´å¿«çš„åº”ç”¨ç¨‹åºã€‚è®¾æƒ³ä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨ï¼Œå®ƒåœ¨æŸä¸€ä¸ªç«¯å£ç›‘å¬è¿›æ¥çš„è¯·æ±‚ã€‚å½“ä¸€ä¸ªè¯·æ±‚åˆ°æ¥æ—¶ï¼Œå®ƒå»å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œç„¶åå†è¿”å›å»ç›‘å¬ã€‚</p>
<p>æœåŠ¡å™¨çš„æµç¨‹å¦‚ä¸‹æ‰€è¿°ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span><span class="token punctuation">(</span>server is active<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    listen <span class="token keyword">for</span> request
    process request
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœä¸€ä¸ªè¯·æ±‚éœ€è¦å ç”¨å¤§é‡çš„æ—¶é—´æ¥å¤„ç†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…æ–°çš„å®¢æˆ·ç«¯å°±æ— æ³•å‘é€è¯·æ±‚ç»™æœåŠ¡ç«¯ã€‚åªæœ‰æœåŠ¡å™¨åœ¨ç›‘å¬çš„æ—¶å€™ï¼Œè¯·æ±‚æ‰èƒ½è¢«æ¥æ”¶ã€‚å¦ä¸€ç§è®¾è®¡æ˜¯ï¼Œç›‘å¬çº¿ç¨‹æŠŠè¯·æ±‚ä¼ é€’ç»™å·¥ä½œè€…çº¿ç¨‹ (worker thread)ï¼Œç„¶åç«‹åˆ»è¿”å›å»ç›‘å¬ã€‚è€Œå·¥ä½œè€…çº¿ç¨‹åˆ™èƒ½å¤Ÿå¤„ç†è¿™ä¸ªè¯·æ±‚å¹¶å‘é€ä¸€ä¸ªå›å¤ç»™å®¢æˆ·ç«¯ã€‚è¿™ç§è®¾è®¡å¦‚ä¸‹æ‰€è¿°ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span><span class="token punctuation">(</span>server is active<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    listen <span class="token keyword">for</span> request
    hand request <span class="token keyword">to</span> <span class="token namespace">worker</span> thread
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™ç§æ–¹å¼ï¼ŒæœåŠ¡ç«¯çº¿ç¨‹è¿…é€Ÿåœ°è¿”å›å»ç›‘å¬ã€‚å› æ­¤ï¼Œæ›´å¤šçš„å®¢æˆ·ç«¯èƒ½å¤Ÿå‘é€è¯·æ±‚ç»™æœåŠ¡ç«¯ã€‚è¿™ä¸ªæœåŠ¡ä¹Ÿå˜å¾—å“åº”æ›´å¿«ã€‚</p>
<p>æ¡Œé¢åº”ç”¨ä¹Ÿæ˜¯åŒæ ·å¦‚æ­¤ã€‚å¦‚æœä½ ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®å¼€å§‹è¿è¡Œä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡ï¼Œè¿™ä¸ªçº¿ç¨‹æ—¢è¦æ‰§è¡Œä»»åŠ¡åˆè¦æ›´æ–°çª—å£å’ŒæŒ‰é’®ï¼Œé‚£ä¹ˆåœ¨ä»»åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºçœ‹èµ·æ¥å¥½åƒæ²¡æœ‰ååº”ä¸€æ ·ã€‚ç›¸åï¼Œä»»åŠ¡å¯ä»¥ä¼ é€’ç»™å·¥ä½œè€…çº¿ç¨‹ï¼ˆworker thread)ã€‚å½“å·¥ä½œè€…çº¿ç¨‹åœ¨ç¹å¿™åœ°å¤„ç†ä»»åŠ¡çš„æ—¶å€™ï¼Œçª—å£çº¿ç¨‹å¯ä»¥è‡ªç”±åœ°å“åº”å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ã€‚å½“å·¥ä½œè€…çº¿ç¨‹å®Œæˆä»»åŠ¡çš„æ—¶å€™ï¼Œå®ƒå‘é€ä¿¡å·ç»™çª—å£çº¿ç¨‹ã€‚çª—å£çº¿ç¨‹ä¾¿å¯ä»¥æ›´æ–°åº”ç”¨ç¨‹åºçª—å£ï¼Œå¹¶æ˜¾ç¤ºä»»åŠ¡çš„ç»“æœã€‚å¯¹ç”¨æˆ·è€Œè¨€ï¼Œè¿™ç§å…·æœ‰å·¥ä½œè€…çº¿ç¨‹è®¾è®¡çš„ç¨‹åºæ˜¾å¾—å“åº”é€Ÿåº¦æ›´å¿«ã€‚</p>
<h3 id="-540"><a class="markdownIt-Anchor" href="#-540">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_2-3-%E5%B9%B6%E5%8F%91%E7%9A%84%E9%97%AE%E9%A2%98">#</a>2.3. å¹¶å‘çš„é—®é¢˜</h3>
<p>ä»»ä½•äº‹ç‰©éƒ½æœ‰åˆ©å¼Šï¼Œå¹¶å‘ä¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“äº†å¹¶å‘å¸¦æ¥çš„å¥½å¤„ï¼šæå‡èµ„æºåˆ©ç”¨ç‡ã€ç¨‹åºå“åº”æ›´å¿«ï¼ŒåŒæ—¶ä¹Ÿè¦è®¤è¯†åˆ°å¹¶å‘å¸¦æ¥çš„é—®é¢˜ï¼Œä¸»è¦æœ‰ï¼š</p>
<ul>
<li>å®‰å…¨æ€§é—®é¢˜</li>
<li>æ´»è·ƒæ€§é—®é¢˜</li>
<li>æ€§èƒ½é—®é¢˜</li>
</ul>
<p>ä¸‹é¢ä¼šä¸€ä¸€è®²è§£ã€‚</p>
<h2 id="-541"><a class="markdownIt-Anchor" href="#-541">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_3-%E5%AE%89%E5%85%A8%E6%80%A7%E9%97%AE%E9%A2%98">#</a>3. å®‰å…¨æ€§é—®é¢˜</h2>
<p>å¹¶å‘æœ€é‡è¦çš„é—®é¢˜æ˜¯å¹¶å‘å®‰å…¨é—®é¢˜ã€‚</p>
<p><strong>å¹¶å‘å®‰å…¨</strong>ï¼šæ˜¯æŒ‡ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œä½¿å¾—å¹¶å‘å¤„ç†ç»“æœç¬¦åˆé¢„æœŸã€‚</p>
<p>å¹¶å‘å®‰å…¨éœ€è¦ä¿è¯å‡ ä¸ªåŸºæœ¬ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>å¯è§æ€§</strong> - æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡ï¼Œå…¶çŠ¶æ€èƒ½å¤Ÿç«‹å³è¢«å…¶ä»–çº¿ç¨‹çŸ¥æ™“ï¼Œé€šå¸¸è¢«è§£é‡Šä¸ºå°†çº¿ç¨‹æœ¬åœ°çŠ¶æ€åæ˜ åˆ°ä¸»å†…å­˜ä¸Šï¼Œ <code>volatile</code>  å°±æ˜¯è´Ÿè´£ä¿è¯å¯è§æ€§çš„ã€‚</li>
<li><strong>åŸå­æ€§</strong> - ç®€å•è¯´å°±æ˜¯ç›¸å…³æ“ä½œä¸ä¼šä¸­é€”è¢«å…¶ä»–çº¿ç¨‹å¹²æ‰°ï¼Œä¸€èˆ¬é€šè¿‡åŒæ­¥æœºåˆ¶ï¼ˆåŠ é”ï¼š <code>sychronized</code> ã€ <code>Lock</code> ï¼‰å®ç°ã€‚</li>
<li><strong>æœ‰åºæ€§</strong> - æ˜¯ä¿è¯çº¿ç¨‹å†…ä¸²è¡Œè¯­ä¹‰ï¼Œé¿å…æŒ‡ä»¤é‡æ’ç­‰ã€‚</li>
</ul>
<h3 id="-542"><a class="markdownIt-Anchor" href="#-542">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_3-1-%E7%BC%93%E5%AD%98%E5%AF%BC%E8%87%B4%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7%E9%97%AE%E9%A2%98">#</a>3.1. ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜</h3>
<blockquote>
<p>ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ï¼Œç§°ä¸º <strong>å¯è§æ€§</strong>ã€‚</p>
</blockquote>
<p>åœ¨å•æ ¸æ—¶ä»£ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯åœ¨ä¸€é¢— CPU ä¸Šæ‰§è¡Œï¼ŒCPU ç¼“å­˜ä¸å†…å­˜çš„æ•°æ®ä¸€è‡´æ€§å®¹æ˜“è§£å†³ã€‚å› ä¸ºæ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯æ“ä½œåŒä¸€ä¸ª CPU çš„ç¼“å­˜ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ç¼“å­˜çš„å†™ï¼Œå¯¹å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ¥è¯´ä¸€å®šæ˜¯å¯è§çš„ã€‚ä¾‹å¦‚åœ¨ä¸‹é¢çš„å›¾ä¸­ï¼Œçº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½æ˜¯æ“ä½œåŒä¸€ä¸ª CPU é‡Œé¢çš„ç¼“å­˜ï¼Œæ‰€ä»¥çº¿ç¨‹ A æ›´æ–°äº†å˜é‡ V çš„å€¼ï¼Œé‚£ä¹ˆçº¿ç¨‹ B ä¹‹åå†è®¿é—®å˜é‡ Vï¼Œå¾—åˆ°çš„ä¸€å®šæ˜¯ V çš„æœ€æ–°å€¼ï¼ˆçº¿ç¨‹ A å†™è¿‡çš„å€¼ï¼‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200701110313.png" alt="img"></p>
<p>å¤šæ ¸æ—¶ä»£ï¼Œæ¯é¢— CPU éƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œè¿™æ—¶ CPU ç¼“å­˜ä¸å†…å­˜çš„æ•°æ®ä¸€è‡´æ€§å°±æ²¡é‚£ä¹ˆå®¹æ˜“è§£å†³äº†ï¼Œå½“å¤šä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„ CPU ä¸Šæ‰§è¡Œæ—¶ï¼Œè¿™äº›çº¿ç¨‹æ“ä½œçš„æ˜¯ä¸åŒçš„ CPU ç¼“å­˜ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­ï¼Œçº¿ç¨‹ A æ“ä½œçš„æ˜¯ CPU-1 ä¸Šçš„ç¼“å­˜ï¼Œè€Œçº¿ç¨‹ B æ“ä½œçš„æ˜¯ CPU-2 ä¸Šçš„ç¼“å­˜ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™ä¸ªæ—¶å€™çº¿ç¨‹ A å¯¹å˜é‡ V çš„æ“ä½œå¯¹äºçº¿ç¨‹ B è€Œè¨€å°±ä¸å…·å¤‡å¯è§æ€§äº†ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200701110431.png" alt="img"></p>
<p>ã€ç¤ºä¾‹ã€‘çº¿ç¨‹ä¸å®‰å…¨çš„ç¤ºä¾‹</p>
<p>ä¸‹é¢æˆ‘ä»¬å†ç”¨ä¸€æ®µä»£ç æ¥éªŒè¯ä¸€ä¸‹å¤šæ ¸åœºæ™¯ä¸‹çš„å¯è§æ€§é—®é¢˜ã€‚ä¸‹é¢çš„ä»£ç ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ add10K () æ–¹æ³•ï¼Œéƒ½ä¼šå¾ªç¯ 10000 æ¬¡ count+=1 æ“ä½œã€‚åœ¨ calc () æ–¹æ³•ä¸­æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€æ¬¡ add10K () æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥æƒ³ä¸€æƒ³æ‰§è¡Œ calc () æ–¹æ³•å¾—åˆ°çš„ç»“æœåº”è¯¥æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">long</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">add10K</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>idx<span class="token operator">++</span> <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œ add() æ“ä½œ</span>
    <span class="token class-name">Thread</span> th1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
      test<span class="token punctuation">.</span><span class="token function">add10K</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span> th2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
      test<span class="token punctuation">.</span><span class="token function">add10K</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹</span>
    th1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    th2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹æ‰§è¡Œç»“æŸ</span>
    th1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    th2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> count<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç›´è§‰å‘Šè¯‰æˆ‘ä»¬åº”è¯¥æ˜¯ 20000ï¼Œå› ä¸ºåœ¨å•çº¿ç¨‹é‡Œè°ƒç”¨ä¸¤æ¬¡ add10K () æ–¹æ³•ï¼Œcount çš„å€¼å°±æ˜¯ 20000ï¼Œä½†å®é™…ä¸Š calc () çš„æ‰§è¡Œç»“æœæ˜¯ä¸ª 10000 åˆ° 20000 ä¹‹é—´çš„éšæœºæ•°ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å‡è®¾çº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶å¼€å§‹æ‰§è¡Œï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡éƒ½ä¼šå°† count=0 è¯»åˆ°å„è‡ªçš„ CPU ç¼“å­˜é‡Œï¼Œæ‰§è¡Œå®Œ count+=1 ä¹‹åï¼Œå„è‡ª CPU ç¼“å­˜é‡Œçš„å€¼éƒ½æ˜¯ 1ï¼ŒåŒæ—¶å†™å…¥å†…å­˜åï¼Œæˆ‘ä»¬ä¼šå‘ç°å†…å­˜ä¸­æ˜¯ 1ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ 2ã€‚ä¹‹åç”±äºå„è‡ªçš„ CPU ç¼“å­˜é‡Œéƒ½æœ‰äº† count çš„å€¼ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯åŸºäº CPU ç¼“å­˜é‡Œçš„ count å€¼æ¥è®¡ç®—ï¼Œæ‰€ä»¥å¯¼è‡´æœ€ç»ˆ count çš„å€¼éƒ½æ˜¯å°äº 20000 çš„ã€‚è¿™å°±æ˜¯ç¼“å­˜çš„å¯è§æ€§é—®é¢˜ã€‚</p>
<p>å¾ªç¯ 10000 æ¬¡ count+=1 æ“ä½œå¦‚æœæ”¹ä¸ºå¾ªç¯ 1 äº¿æ¬¡ï¼Œä½ ä¼šå‘ç°æ•ˆæœæ›´æ˜æ˜¾ï¼Œæœ€ç»ˆ count çš„å€¼æ¥è¿‘ 1 äº¿ï¼Œè€Œä¸æ˜¯ 2 äº¿ã€‚å¦‚æœå¾ªç¯ 10000 æ¬¡ï¼Œcount çš„å€¼æ¥è¿‘ 20000ï¼ŒåŸå› æ˜¯ä¸¤ä¸ªçº¿ç¨‹ä¸æ˜¯åŒæ—¶å¯åŠ¨çš„ï¼Œæœ‰ä¸€ä¸ªæ—¶å·®ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200701110615.png" alt="img"></p>
<h3 id="-543"><a class="markdownIt-Anchor" href="#-543">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_3-2-%E7%BA%BF%E7%A8%8B%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%E9%97%AE%E9%A2%98">#</a>3.2. çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜</h3>
<p>ç”±äº IO å¤ªæ…¢ï¼Œæ—©æœŸçš„æ“ä½œç³»ç»Ÿå°±å‘æ˜äº†å¤šè¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå…è®¸æŸä¸ªè¿›ç¨‹æ‰§è¡Œä¸€å°æ®µæ—¶é—´ï¼ˆç§°ä¸º <strong>æ—¶é—´ç‰‡</strong>ï¼‰ã€‚</p>
<p>åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹è¿›è¡Œä¸€ä¸ª IO æ“ä½œï¼Œä¾‹å¦‚è¯»ä¸ªæ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™è¯¥è¿›ç¨‹å¯ä»¥æŠŠè‡ªå·±æ ‡è®°ä¸º â€œä¼‘çœ çŠ¶æ€â€ å¹¶å‡ºè®© CPU çš„ä½¿ç”¨æƒï¼Œå¾…æ–‡ä»¶è¯»è¿›å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠè¿™ä¸ªä¼‘çœ çš„è¿›ç¨‹å”¤é†’ï¼Œå”¤é†’åçš„è¿›ç¨‹å°±æœ‰æœºä¼šé‡æ–°è·å¾— CPU çš„ä½¿ç”¨æƒäº†ã€‚</p>
<p>è¿™é‡Œçš„è¿›ç¨‹åœ¨ç­‰å¾… IO æ—¶ä¹‹æ‰€ä»¥ä¼šé‡Šæ”¾ CPU ä½¿ç”¨æƒï¼Œæ˜¯ä¸ºäº†è®© CPU åœ¨è¿™æ®µç­‰å¾…æ—¶é—´é‡Œå¯ä»¥åšåˆ«çš„äº‹æƒ…ï¼Œè¿™æ ·ä¸€æ¥ CPU çš„ä½¿ç”¨ç‡å°±ä¸Šæ¥äº†ï¼›æ­¤å¤–ï¼Œå¦‚æœè¿™æ—¶æœ‰å¦å¤–ä¸€ä¸ªè¿›ç¨‹ä¹Ÿè¯»æ–‡ä»¶ï¼Œè¯»æ–‡ä»¶çš„æ“ä½œå°±ä¼šæ’é˜Ÿï¼Œç£ç›˜é©±åŠ¨åœ¨å®Œæˆä¸€ä¸ªè¿›ç¨‹çš„è¯»æ“ä½œåï¼Œå‘ç°æœ‰æ’é˜Ÿçš„ä»»åŠ¡ï¼Œå°±ä¼šç«‹å³å¯åŠ¨ä¸‹ä¸€ä¸ªè¯»æ“ä½œï¼Œè¿™æ · IO çš„ä½¿ç”¨ç‡ä¹Ÿä¸Šæ¥äº†ã€‚</p>
<p>æ—©æœŸçš„æ“ä½œç³»ç»ŸåŸºäºè¿›ç¨‹æ¥è°ƒåº¦ CPUï¼Œä¸åŒè¿›ç¨‹é—´æ˜¯ä¸å…±äº«å†…å­˜ç©ºé—´çš„ï¼Œæ‰€ä»¥è¿›ç¨‹è¦åšä»»åŠ¡åˆ‡æ¢å°±è¦åˆ‡æ¢å†…å­˜æ˜ å°„åœ°å€ï¼Œè€Œä¸€ä¸ªè¿›ç¨‹åˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹ï¼Œéƒ½æ˜¯å…±äº«ä¸€ä¸ªå†…å­˜ç©ºé—´çš„ï¼Œæ‰€ä»¥çº¿ç¨‹åšä»»åŠ¡åˆ‡æ¢æˆæœ¬å°±å¾ˆä½äº†ã€‚ç°ä»£çš„æ“ä½œç³»ç»Ÿéƒ½åŸºäºæ›´è½»é‡çš„çº¿ç¨‹æ¥è°ƒåº¦ï¼Œç°åœ¨æˆ‘ä»¬æåˆ°çš„ â€œä»»åŠ¡åˆ‡æ¢â€ éƒ½æ˜¯æŒ‡ â€œçº¿ç¨‹åˆ‡æ¢â€ã€‚</p>
<p>Java å¹¶å‘ç¨‹åºéƒ½æ˜¯åŸºäºå¤šçº¿ç¨‹çš„ï¼Œè‡ªç„¶ä¹Ÿä¼šæ¶‰åŠåˆ°ä»»åŠ¡åˆ‡æ¢ï¼Œä¹Ÿè®¸ä½ æƒ³ä¸åˆ°ï¼Œä»»åŠ¡åˆ‡æ¢ç«Ÿç„¶ä¹Ÿæ˜¯å¹¶å‘ç¼–ç¨‹é‡Œè¯¡å¼‚ Bug çš„æºå¤´ä¹‹ä¸€ã€‚ä»»åŠ¡åˆ‡æ¢çš„æ—¶æœºå¤§å¤šæ•°æ˜¯åœ¨æ—¶é—´ç‰‡ç»“æŸçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç°åœ¨åŸºæœ¬éƒ½ä½¿ç”¨é«˜çº§è¯­è¨€ç¼–ç¨‹ï¼Œé«˜çº§è¯­è¨€é‡Œä¸€æ¡è¯­å¥å¾€å¾€éœ€è¦å¤šæ¡ CPU æŒ‡ä»¤å®Œæˆï¼Œä¾‹å¦‚ä¸Šé¢ä»£ç ä¸­çš„  <code>count += 1</code> ï¼Œè‡³å°‘éœ€è¦ä¸‰æ¡ CPU æŒ‡ä»¤ã€‚</p>
<ul>
<li>æŒ‡ä»¤ 1ï¼šé¦–å…ˆï¼Œéœ€è¦æŠŠå˜é‡ count ä»å†…å­˜åŠ è½½åˆ° CPU çš„å¯„å­˜å™¨ï¼›</li>
<li>æŒ‡ä»¤ 2ï¼šä¹‹åï¼Œåœ¨å¯„å­˜å™¨ä¸­æ‰§è¡Œ +1 æ“ä½œï¼›</li>
<li>æŒ‡ä»¤ 3ï¼šæœ€åï¼Œå°†ç»“æœå†™å…¥å†…å­˜ï¼ˆç¼“å­˜æœºåˆ¶å¯¼è‡´å¯èƒ½å†™å…¥çš„æ˜¯ CPU ç¼“å­˜è€Œä¸æ˜¯å†…å­˜ï¼‰ã€‚</li>
</ul>
<p>æ“ä½œç³»ç»Ÿåšä»»åŠ¡åˆ‡æ¢ï¼Œå¯ä»¥å‘ç”Ÿåœ¨ä»»ä½•ä¸€æ¡<strong> CPU æŒ‡ä»¤</strong>æ‰§è¡Œå®Œï¼Œæ˜¯çš„ï¼Œæ˜¯ CPU æŒ‡ä»¤ï¼Œè€Œä¸æ˜¯é«˜çº§è¯­è¨€é‡Œçš„ä¸€æ¡è¯­å¥ã€‚å¯¹äºä¸Šé¢çš„ä¸‰æ¡æŒ‡ä»¤æ¥è¯´ï¼Œæˆ‘ä»¬å‡è®¾ count=0ï¼Œå¦‚æœçº¿ç¨‹ A åœ¨æŒ‡ä»¤ 1 æ‰§è¡Œå®Œååšçº¿ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹ A å’Œçº¿ç¨‹ B æŒ‰ç…§ä¸‹å›¾çš„åºåˆ—æ‰§è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå‘ç°ä¸¤ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº† count+=1 çš„æ“ä½œï¼Œä½†æ˜¯å¾—åˆ°çš„ç»“æœä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ 2ï¼Œè€Œæ˜¯ 1ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200701110946.png" alt="img"></p>
<p>æˆ‘ä»¬æ½œæ„è¯†é‡Œé¢è§‰å¾— count+=1 è¿™ä¸ªæ“ä½œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“ï¼Œå°±åƒä¸€ä¸ªåŸå­ä¸€æ ·ï¼Œçº¿ç¨‹çš„åˆ‡æ¢å¯ä»¥å‘ç”Ÿåœ¨ count+=1 ä¹‹å‰ï¼Œä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨ count+=1 ä¹‹åï¼Œä½†å°±æ˜¯ä¸ä¼šå‘ç”Ÿåœ¨ä¸­é—´ã€‚<strong>æˆ‘ä»¬æŠŠä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œåœ¨ CPU æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸è¢«ä¸­æ–­çš„ç‰¹æ€§ç§°ä¸ºåŸå­æ€§</strong>ã€‚CPU èƒ½ä¿è¯çš„åŸå­æ“ä½œæ˜¯ CPU æŒ‡ä»¤çº§åˆ«çš„ï¼Œè€Œä¸æ˜¯é«˜çº§è¯­è¨€çš„æ“ä½œç¬¦ï¼Œè¿™æ˜¯è¿èƒŒæˆ‘ä»¬ç›´è§‰çš„åœ°æ–¹ã€‚å› æ­¤ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨é«˜çº§è¯­è¨€å±‚é¢ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚</p>
<h3 id="-544"><a class="markdownIt-Anchor" href="#-544">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_3-3-%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%E5%B8%A6%E6%9D%A5%E7%9A%84%E6%9C%89%E5%BA%8F%E6%80%A7%E9%97%AE%E9%A2%98">#</a>3.3. ç¼–è¯‘ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜</h3>
<p>é‚£å¹¶å‘ç¼–ç¨‹é‡Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–æœ‰è¿ç›´è§‰å®¹æ˜“å¯¼è‡´è¯¡å¼‚ Bug çš„æŠ€æœ¯å‘¢ï¼Ÿæœ‰çš„ï¼Œå°±æ˜¯æœ‰åºæ€§ã€‚é¡¾åæ€ä¹‰ï¼Œæœ‰åºæ€§æŒ‡çš„æ˜¯ç¨‹åºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œã€‚ç¼–è¯‘å™¨ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œæœ‰æ—¶å€™ä¼šæ”¹å˜ç¨‹åºä¸­è¯­å¥çš„å…ˆåé¡ºåºï¼Œä¾‹å¦‚ç¨‹åºä¸­ï¼šâ€œa=6ï¼›b=7ï¼›â€ ç¼–è¯‘å™¨ä¼˜åŒ–åå¯èƒ½å˜æˆ â€œb=7ï¼›a=6ï¼›â€ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¼–è¯‘å™¨è°ƒæ•´äº†è¯­å¥çš„é¡ºåºï¼Œä½†æ˜¯ä¸å½±å“ç¨‹åºçš„æœ€ç»ˆç»“æœã€‚ä¸è¿‡æœ‰æ—¶å€™ç¼–è¯‘å™¨åŠè§£é‡Šå™¨çš„ä¼˜åŒ–å¯èƒ½å¯¼è‡´æ„æƒ³ä¸åˆ°çš„ Bugã€‚</p>
<p>åœ¨ Java é¢†åŸŸä¸€ä¸ªç»å…¸çš„æ¡ˆä¾‹å°±æ˜¯åˆ©ç”¨åŒé‡æ£€æŸ¥åˆ›å»ºå•ä¾‹å¯¹è±¡ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼šåœ¨è·å–å®ä¾‹ getInstance () çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ¤æ–­ instance æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™é”å®š Singleton.class å¹¶å†æ¬¡æ£€æŸ¥ instance æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœè¿˜ä¸ºç©ºåˆ™åˆ›å»º Singleton çš„ä¸€ä¸ªå®ä¾‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
          instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ Aã€B åŒæ—¶è°ƒç”¨ getInstance () æ–¹æ³•ï¼Œä»–ä»¬ä¼šåŒæ—¶å‘ç°  <code>instance == null</code>  ï¼Œäºæ˜¯åŒæ—¶å¯¹ Singleton.class åŠ é”ï¼Œæ­¤æ—¶ JVM ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸåŠ é”æˆåŠŸï¼ˆå‡è®¾æ˜¯çº¿ç¨‹ Aï¼‰ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹åˆ™ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼ˆå‡è®¾æ˜¯çº¿ç¨‹ Bï¼‰ï¼›çº¿ç¨‹ A ä¼šåˆ›å»ºä¸€ä¸ª Singleton å®ä¾‹ï¼Œä¹‹åé‡Šæ”¾é”ï¼Œé”é‡Šæ”¾åï¼Œçº¿ç¨‹ B è¢«å”¤é†’ï¼Œçº¿ç¨‹ B å†æ¬¡å°è¯•åŠ é”ï¼Œæ­¤æ—¶æ˜¯å¯ä»¥åŠ é”æˆåŠŸçš„ï¼ŒåŠ é”æˆåŠŸåï¼Œçº¿ç¨‹ B æ£€æŸ¥  <code>instance == null</code>  æ—¶ä¼šå‘ç°ï¼Œå·²ç»åˆ›å»ºè¿‡ Singleton å®ä¾‹äº†ï¼Œæ‰€ä»¥çº¿ç¨‹ B ä¸ä¼šå†åˆ›å»ºä¸€ä¸ª Singleton å®ä¾‹ã€‚</p>
<p>è¿™çœ‹ä¸Šå»ä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼Œæ— æ‡ˆå¯å‡»ï¼Œä½†å®é™…ä¸Šè¿™ä¸ª getInstance () æ–¹æ³•å¹¶ä¸å®Œç¾ã€‚é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿå‡ºåœ¨ new æ“ä½œä¸Šï¼Œæˆ‘ä»¬ä»¥ä¸ºçš„ new æ“ä½œåº”è¯¥æ˜¯ï¼š</p>
<ol>
<li>åˆ†é…ä¸€å—å†…å­˜ Mï¼›</li>
<li>åœ¨å†…å­˜ M ä¸Šåˆå§‹åŒ– Singleton å¯¹è±¡ï¼›</li>
<li>ç„¶å M çš„åœ°å€èµ‹å€¼ç»™ instance å˜é‡ã€‚</li>
</ol>
<p>ä½†æ˜¯å®é™…ä¸Šä¼˜åŒ–åçš„æ‰§è¡Œè·¯å¾„å´æ˜¯è¿™æ ·çš„ï¼š</p>
<ol>
<li>åˆ†é…ä¸€å—å†…å­˜ Mï¼›</li>
<li>å°† M çš„åœ°å€èµ‹å€¼ç»™ instance å˜é‡ï¼›</li>
<li>æœ€ååœ¨å†…å­˜ M ä¸Šåˆå§‹åŒ– Singleton å¯¹è±¡ã€‚</li>
</ol>
<p>ä¼˜åŒ–åä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å‡è®¾çº¿ç¨‹ A å…ˆæ‰§è¡Œ getInstance () æ–¹æ³•ï¼Œå½“æ‰§è¡Œå®ŒæŒ‡ä»¤ 2 æ—¶æ°å¥½å‘ç”Ÿäº†çº¿ç¨‹åˆ‡æ¢ï¼Œåˆ‡æ¢åˆ°äº†çº¿ç¨‹ B ä¸Šï¼›å¦‚æœæ­¤æ—¶çº¿ç¨‹ B ä¹Ÿæ‰§è¡Œ getInstance () æ–¹æ³•ï¼Œé‚£ä¹ˆçº¿ç¨‹ B åœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªåˆ¤æ–­æ—¶ä¼šå‘ç°  <code>instance != null</code>  ï¼Œæ‰€ä»¥ç›´æ¥è¿”å› instanceï¼Œè€Œæ­¤æ—¶çš„ instance æ˜¯æ²¡æœ‰åˆå§‹åŒ–è¿‡çš„ï¼Œå¦‚æœæˆ‘ä»¬è¿™ä¸ªæ—¶å€™è®¿é—® instance çš„æˆå‘˜å˜é‡å°±å¯èƒ½è§¦å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200701111050.png" alt="img"></p>
<h3 id="-545"><a class="markdownIt-Anchor" href="#-545">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_3-4-%E4%BF%9D%E8%AF%81%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E7%9A%84%E6%80%9D%E8%B7%AF">#</a>3.4. ä¿è¯å¹¶å‘å®‰å…¨çš„æ€è·¯</h3>
<h4 id="-546"><a class="markdownIt-Anchor" href="#-546">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E4%BA%92%E6%96%A5%E5%90%8C%E6%AD%A5-%E9%98%BB%E5%A1%9E%E5%90%8C%E6%AD%A5">#</a>äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰</h4>
<p>äº’æ–¥åŒæ­¥æ˜¯æœ€å¸¸è§çš„å¹¶å‘æ­£ç¡®æ€§ä¿éšœæ‰‹æ®µã€‚</p>
<p><strong>åŒæ­¥æ˜¯æŒ‡åœ¨å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«æ•°æ®æ—¶ï¼Œä¿è¯å…±äº«æ•°æ®åœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®</strong>ã€‚</p>
<p>äº’æ–¥æ˜¯å®ç°åŒæ­¥çš„ä¸€ç§æ‰‹æ®µã€‚ä¸´ç•ŒåŒºï¼ˆCritical Sectionsï¼‰ã€äº’æ–¥é‡ï¼ˆMutexï¼‰å’Œä¿¡å·é‡ï¼ˆSemaphoreï¼‰éƒ½æ˜¯ä¸»è¦çš„äº’æ–¥å®ç°æ–¹å¼ã€‚</p>
<p>æœ€å…¸å‹çš„æ¡ˆä¾‹æ˜¯ä½¿ç”¨  <code>synchronized</code>  æˆ–  <code>Lock</code>  ã€‚</p>
<p><strong>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜</strong>ï¼Œäº’æ–¥åŒæ­¥å±äºä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œæ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚æ— è®ºå…±äº«æ•°æ®æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦è¿›è¡ŒåŠ é”ï¼ˆè¿™é‡Œè®¨è®ºçš„æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºä¼šä¼˜åŒ–æ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„åŠ é”ï¼‰ã€ç”¨æˆ·æ€æ ¸å¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨å’Œæ£€æŸ¥æ˜¯å¦æœ‰è¢«é˜»å¡çš„çº¿ç¨‹éœ€è¦å”¤é†’ç­‰æ“ä½œã€‚</p>
<h4 id="-547"><a class="markdownIt-Anchor" href="#-547">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%90%8C%E6%AD%A5">#</a>éé˜»å¡åŒæ­¥</h4>
<p>éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼šå…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶å®ƒçº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼Œå¦åˆ™é‡‡å–è¡¥å¿æªæ–½ï¼ˆä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼‰ã€‚è¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥çš„è®¸å¤šå®ç°éƒ½ä¸éœ€è¦å°†çº¿ç¨‹é˜»å¡ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¯´ä¹è§‚é”éœ€è¦ <strong>ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•</strong> æ‰èƒ½è¿›è¡Œï¼Ÿå› ä¸ºéœ€è¦æ“ä½œå’Œå†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸå­æ€§ã€‚è€Œè¿™ç‚¹æ˜¯ç”±ç¡¬ä»¶æ¥å®Œæˆï¼Œå¦‚æœå†ä½¿ç”¨äº’æ–¥åŒæ­¥æ¥ä¿è¯å°±å¤±å»æ„ä¹‰äº†ã€‚</p>
<p>è¿™ç±»ä¹è§‚é”æŒ‡ä»¤å¸¸è§çš„æœ‰ï¼š</p>
<ul>
<li>æµ‹è¯•å¹¶è®¾ç½®ï¼ˆTest-and-Setï¼‰</li>
<li>è·å–å¹¶å¢åŠ ï¼ˆFetch-and-Incrementï¼‰</li>
<li>äº¤æ¢ï¼ˆSwapï¼‰</li>
<li>æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCASï¼‰</li>
<li>åŠ è½½é“¾æ¥ã€æ¡ä»¶å­˜å‚¨ï¼ˆLoad-linked / Store-Conditionalï¼‰</li>
</ul>
<p>Java å…¸å‹åº”ç”¨åœºæ™¯ï¼šJ.U.C åŒ…ä¸­çš„åŸå­ç±»ï¼ˆåŸºäº  <code>Unsafe</code>  ç±»çš„ CAS æ“ä½œï¼‰</p>
<h4 id="-548"><a class="markdownIt-Anchor" href="#-548">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E6%97%A0%E5%90%8C%E6%AD%A5">#</a>æ— åŒæ­¥</h4>
<p>è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ä¸€å®šéè¦è¿›è¡ŒåŒæ­¥ã€‚åŒæ­¥åªæ˜¯ä¿è¯å…±äº«æ•°æ®äº‰ç”¨æ—¶çš„æ­£ç¡®æ€§ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£ä¹ˆè‡ªç„¶æ— é¡»åŒæ­¥ã€‚</p>
<p>Java ä¸­çš„ <strong>æ— åŒæ­¥æ–¹æ¡ˆ</strong> æœ‰ï¼š</p>
<ul>
<li><strong>å¯é‡å…¥ä»£ç </strong> - ä¹Ÿå«çº¯ä»£ç ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ <strong>è¿”å›ç»“æœæ˜¯å¯ä»¥é¢„æµ‹çš„</strong>ï¼Œå³åªè¦è¾“å…¥äº†ç›¸åŒçš„æ•°æ®ï¼Œå°±èƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œé‚£å®ƒå°±æ»¡è¶³å¯é‡å…¥æ€§ï¼Œå½“ç„¶ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
<li><strong>çº¿ç¨‹æœ¬åœ°å­˜å‚¨</strong> - ä½¿ç”¨ <strong> <code>ThreadLocal</code>  ä¸ºå…±äº«å˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†ä¸€ä¸ªæœ¬åœ°å‰¯æœ¬</strong>ï¼Œè¿™ä¸ªå‰¯æœ¬åªèƒ½è¢«å½“å‰çº¿ç¨‹è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®ï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
<h2 id="-549"><a class="markdownIt-Anchor" href="#-549">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_4-%E6%B4%BB%E8%B7%83%E6%80%A7%E9%97%AE%E9%A2%98">#</a>4. æ´»è·ƒæ€§é—®é¢˜</h2>
<h3 id="-550"><a class="markdownIt-Anchor" href="#-550">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_4-1-%E6%AD%BB%E9%94%81-deadlock">#</a>4.1. æ­»é”ï¼ˆDeadlockï¼‰</h3>
<h4 id="-551"><a class="markdownIt-Anchor" href="#-551">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%BB%E9%94%81">#</a>ä»€ä¹ˆæ˜¯æ­»é”</h4>
<p>å¤šä¸ªçº¿ç¨‹äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ã€‚</p>
<p>æ­»é”æ˜¯å½“çº¿ç¨‹è¿›å…¥æ— é™æœŸç­‰å¾…çŠ¶æ€æ—¶å‘ç”Ÿçš„æƒ…å†µï¼Œå› ä¸ºæ‰€è¯·æ±‚çš„é”è¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åˆç­‰å¾…ç¬¬ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„å¦ä¸€ä¸ªé”ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/deadlock.png" alt="img"></p>
<h4 id="-552"><a class="markdownIt-Anchor" href="#-552">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81">#</a>é¿å…æ­»é”</h4>
<p>ï¼ˆ1ï¼‰æŒ‰åºåŠ é”</p>
<p>å½“å¤šä¸ªçº¿ç¨‹éœ€è¦ç›¸åŒçš„ä¸€äº›é”ï¼Œä½†æ˜¯æŒ‰ç…§ä¸åŒçš„é¡ºåºåŠ é”ï¼Œæ­»é”å°±å¾ˆå®¹æ˜“å‘ç”Ÿã€‚</p>
<p>å¦‚æœèƒ½ç¡®ä¿æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯æŒ‰ç…§ç›¸åŒçš„é¡ºåºè·å¾—é”ï¼Œé‚£ä¹ˆæ­»é”å°±ä¸ä¼šå‘ç”Ÿã€‚</p>
<p>æŒ‰ç…§é¡ºåºåŠ é”æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ­»é”é¢„é˜²æœºåˆ¶ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä½ äº‹å…ˆçŸ¥é“æ‰€æœ‰å¯èƒ½ä¼šç”¨åˆ°çš„é” (è¯‘è€…æ³¨ï¼šå¹¶å¯¹è¿™äº›é”åšé€‚å½“çš„æ’åº)ï¼Œä½†æ€»æœ‰äº›æ—¶å€™æ˜¯æ— æ³•é¢„çŸ¥çš„ã€‚</p>
<p>ï¼ˆ2ï¼‰è¶…æ—¶é‡Šæ”¾é”</p>
<p>å¦å¤–ä¸€ä¸ªå¯ä»¥é¿å…æ­»é”çš„æ–¹æ³•æ˜¯åœ¨å°è¯•è·å–é”çš„æ—¶å€™åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€åœ¨å°è¯•è·å–é”çš„è¿‡ç¨‹ä¸­è‹¥è¶…è¿‡äº†è¿™ä¸ªæ—¶é™è¯¥çº¿ç¨‹åˆ™æ”¾å¼ƒå¯¹è¯¥é”è¯·æ±‚ã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰åœ¨ç»™å®šçš„æ—¶é™å†…æˆåŠŸè·å¾—æ‰€æœ‰éœ€è¦çš„é”ï¼Œåˆ™ä¼šè¿›è¡Œå›é€€å¹¶é‡Šæ”¾æ‰€æœ‰å·²ç»è·å¾—çš„é”ï¼Œç„¶åç­‰å¾…ä¸€æ®µéšæœºçš„æ—¶é—´å†é‡è¯•ã€‚è¿™æ®µéšæœºçš„ç­‰å¾…æ—¶é—´è®©å…¶å®ƒçº¿ç¨‹æœ‰æœºä¼šå°è¯•è·å–ç›¸åŒçš„è¿™äº›é”ï¼Œå¹¶ä¸”è®©è¯¥åº”ç”¨åœ¨æ²¡æœ‰è·å¾—é”çš„æ—¶å€™å¯ä»¥ç»§ç»­è¿è¡Œ (è¯‘è€…æ³¨ï¼šåŠ é”è¶…æ—¶åå¯ä»¥å…ˆç»§ç»­è¿è¡Œå¹²ç‚¹å…¶å®ƒäº‹æƒ…ï¼Œå†å›å¤´æ¥é‡å¤ä¹‹å‰åŠ é”çš„é€»è¾‘)ã€‚</p>
<p>ï¼ˆ3ï¼‰æ­»é”æ£€æµ‹</p>
<p>æ­»é”æ£€æµ‹æ˜¯ä¸€ä¸ªæ›´å¥½çš„æ­»é”é¢„é˜²æœºåˆ¶ï¼Œå®ƒä¸»è¦æ˜¯é’ˆå¯¹é‚£äº›ä¸å¯èƒ½å®ç°æŒ‰åºåŠ é”å¹¶ä¸”é”è¶…æ—¶ä¹Ÿä¸å¯è¡Œçš„åœºæ™¯ã€‚</p>
<p>æ¯å½“ä¸€ä¸ªçº¿ç¨‹è·å¾—äº†é”ï¼Œä¼šåœ¨çº¿ç¨‹å’Œé”ç›¸å…³çš„æ•°æ®ç»“æ„ä¸­ï¼ˆmapã€graph ç­‰ç­‰ï¼‰å°†å…¶è®°ä¸‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯å½“æœ‰çº¿ç¨‹è¯·æ±‚é”ï¼Œä¹Ÿéœ€è¦è®°å½•åœ¨è¿™ä¸ªæ•°æ®ç»“æ„ä¸­ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚é”å¤±è´¥æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹å¯ä»¥éå†é”çš„å…³ç³»å›¾çœ‹çœ‹æ˜¯å¦æœ‰æ­»é”å‘ç”Ÿã€‚</p>
<p>å¦‚æœæ£€æµ‹å‡ºæ­»é”ï¼Œæœ‰ä¸¤ç§å¤„ç†æ‰‹æ®µï¼š</p>
<ul>
<li>é‡Šæ”¾æ‰€æœ‰é”ï¼Œå›é€€ï¼Œå¹¶ä¸”ç­‰å¾…ä¸€æ®µéšæœºçš„æ—¶é—´åé‡è¯•ã€‚è¿™ä¸ªå’Œç®€å•çš„åŠ é”è¶…æ—¶ç±»ä¼¼ï¼Œä¸ä¸€æ ·çš„æ˜¯åªæœ‰æ­»é”å·²ç»å‘ç”Ÿäº†æ‰å›é€€ï¼Œè€Œä¸ä¼šæ˜¯å› ä¸ºåŠ é”çš„è¯·æ±‚è¶…æ—¶äº†ã€‚è™½ç„¶æœ‰å›é€€å’Œç­‰å¾…ï¼Œä½†æ˜¯å¦‚æœæœ‰å¤§é‡çš„çº¿ç¨‹ç«äº‰åŒä¸€æ‰¹é”ï¼Œå®ƒä»¬è¿˜æ˜¯ä¼šé‡å¤åœ°æ­»é”ï¼ˆç¼–è€…æ³¨ï¼šåŸå› åŒè¶…æ—¶ç±»ä¼¼ï¼Œä¸èƒ½ä»æ ¹æœ¬ä¸Šå‡è½»ç«äº‰ï¼‰ã€‚</li>
<li>ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆæ˜¯ç»™è¿™äº›çº¿ç¨‹è®¾ç½®ä¼˜å…ˆçº§ï¼Œè®©ä¸€ä¸ªï¼ˆæˆ–å‡ ä¸ªï¼‰çº¿ç¨‹å›é€€ï¼Œå‰©ä¸‹çš„çº¿ç¨‹å°±åƒæ²¡å‘ç”Ÿæ­»é”ä¸€æ ·ç»§ç»­ä¿æŒç€å®ƒä»¬éœ€è¦çš„é”ã€‚å¦‚æœèµ‹äºˆè¿™äº›çº¿ç¨‹çš„ä¼˜å…ˆçº§æ˜¯å›ºå®šä¸å˜çš„ï¼ŒåŒä¸€æ‰¹çº¿ç¨‹æ€»æ˜¯ä¼šæ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ä¸ºé¿å…è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨æ­»é”å‘ç”Ÿçš„æ—¶å€™è®¾ç½®éšæœºçš„ä¼˜å…ˆçº§ã€‚</li>
</ul>
<h3 id="-553"><a class="markdownIt-Anchor" href="#-553">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_4-2-%E6%B4%BB%E9%94%81-livelock">#</a>4.2. æ´»é”ï¼ˆLivelockï¼‰</h3>
<h4 id="-554"><a class="markdownIt-Anchor" href="#-554">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B4%BB%E9%94%81">#</a>ä»€ä¹ˆæ˜¯æ´»é”</h4>
<p>æ´»é”æ˜¯ä¸€ä¸ªé€’å½’çš„æƒ…å†µï¼Œä¸¤ä¸ªæˆ–æ›´å¤šçš„çº¿ç¨‹ä¼šä¸æ–­é‡å¤ä¸€ä¸ªç‰¹å®šçš„ä»£ç é€»è¾‘ã€‚é¢„æœŸçš„é€»è¾‘é€šå¸¸ä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœºä¼šç»§ç»­æ”¯æŒâ€™thisâ€™çº¿ç¨‹ã€‚</p>
<p>æƒ³è±¡è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼šä¸¤ä¸ªäººåœ¨ç‹­çª„çš„èµ°å»Šé‡Œç›¸é‡ï¼ŒäºŒè€…éƒ½å¾ˆç¤¼è²Œï¼Œè¯•å›¾ç§»åˆ°æ—è¾¹è®©å¯¹æ–¹å…ˆé€šè¿‡ã€‚ä½†æ˜¯ä»–ä»¬æœ€ç»ˆåœ¨æ²¡æœ‰å–å¾—ä»»ä½•è¿›å±•çš„æƒ…å†µä¸‹å·¦å³æ‘‡æ‘†ï¼Œå› ä¸ºä»–ä»¬éƒ½åœ¨åŒä¸€æ—¶é—´å‘ç›¸åŒçš„æ–¹å‘ç§»åŠ¨ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/livelock.png" alt="img"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼šä¸¤ä¸ªçº¿ç¨‹æƒ³è¦é€šè¿‡ä¸€ä¸ª Worker å¯¹è±¡è®¿é—®å…±äº«å…¬å…±èµ„æºçš„æƒ…å†µï¼Œä½†æ˜¯å½“ä»–ä»¬çœ‹åˆ°å¦ä¸€ä¸ª Workerï¼ˆåœ¨å¦ä¸€ä¸ªçº¿ç¨‹ä¸Šè°ƒç”¨ï¼‰ä¹Ÿæ˜¯ â€œæ´»åŠ¨çš„â€ æ—¶ï¼Œå®ƒä»¬ä¼šå°è¯•å°†è¯¥èµ„æºäº¤ç»™å…¶ä»–å·¥ä½œè€…å¹¶ç­‰å¾…ä¸ºå®ƒå®Œæˆã€‚å¦‚æœæœ€åˆæˆ‘ä»¬è®©ä¸¤åå·¥ä½œäººå‘˜éƒ½æ´»è·ƒèµ·æ¥ï¼Œä»–ä»¬å°†ä¼šé¢ä¸´æ´»é”é—®é¢˜ã€‚</p>
<h4 id="-555"><a class="markdownIt-Anchor" href="#-555">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E9%81%BF%E5%85%8D%E6%B4%BB%E9%94%81">#</a>é¿å…æ´»é”</h4>
<p>è§£å†³ â€œ<strong>æ´»é”</strong>â€ çš„æ–¹æ¡ˆå¾ˆç®€å•ï¼Œè°¦è®©æ—¶ï¼Œå°è¯•ç­‰å¾…ä¸€ä¸ªéšæœºçš„æ—¶é—´å°±å¯ä»¥äº†ã€‚ç”±äºç­‰å¾…çš„æ—¶é—´æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥åŒæ—¶ç›¸æ’åå†æ¬¡ç›¸æ’çš„æ¦‚ç‡å°±å¾ˆä½äº†ã€‚â€œç­‰å¾…ä¸€ä¸ªéšæœºæ—¶é—´â€ çš„æ–¹æ¡ˆè™½ç„¶å¾ˆç®€å•ï¼Œå´éå¸¸æœ‰æ•ˆï¼ŒRaft è¿™æ ·çŸ¥åçš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ä¸­ä¹Ÿç”¨åˆ°äº†å®ƒã€‚</p>
<h3 id="-556"><a class="markdownIt-Anchor" href="#-556">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_4-3-%E9%A5%A5%E9%A5%BF-starvation">#</a>4.3. é¥¥é¥¿ï¼ˆStarvationï¼‰</h3>
<h4 id="-557"><a class="markdownIt-Anchor" href="#-557">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E4%BB%80%E4%B9%88%E6%98%AF%E9%A5%A5%E9%A5%BF">#</a>ä»€ä¹ˆæ˜¯é¥¥é¥¿</h4>
<ul>
<li>é«˜ä¼˜å…ˆçº§çº¿ç¨‹åå™¬æ‰€æœ‰çš„ä½ä¼˜å…ˆçº§çº¿ç¨‹çš„ CPU æ—¶é—´ã€‚</li>
<li>çº¿ç¨‹è¢«æ°¸ä¹…å µå¡åœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯èƒ½åœ¨å®ƒä¹‹å‰æŒç»­åœ°å¯¹è¯¥åŒæ­¥å—è¿›è¡Œè®¿é—®ã€‚</li>
<li>çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªæœ¬èº« (åœ¨å…¶ä¸Šè°ƒç”¨ wait ()) ä¹Ÿå¤„äºæ°¸ä¹…ç­‰å¾…å®Œæˆçš„å¯¹è±¡ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯è¢«æŒç»­åœ°è·å¾—å”¤é†’ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/starvation-and-fairness.png" alt="img"></p>
<p>é¥¥é¥¿é—®é¢˜æœ€ç»å…¸çš„ä¾‹å­å°±æ˜¯å“²å­¦å®¶é—®é¢˜ã€‚å¦‚å›¾æ‰€ç¤ºï¼šæœ‰äº”ä¸ªå“²å­¦å®¶ç”¨é¤ï¼Œæ¯ä¸ªäººè¦è·å¾—ä¸¤æŠŠå‰å­æ‰å¯ä»¥å°±é¤ã€‚å½“ 2ã€4 å°±é¤æ—¶ï¼Œ1ã€3ã€5 æ°¸è¿œæ— æ³•å°±é¤ï¼Œåªèƒ½çœ‹ç€ç›˜ä¸­çš„ç¾é£Ÿé¥¥é¥¿çš„ç­‰å¾…ç€ã€‚</p>
<h4 id="-558"><a class="markdownIt-Anchor" href="#-558">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E8%A7%A3%E5%86%B3%E9%A5%A5%E9%A5%BF">#</a>è§£å†³é¥¥é¥¿</h4>
<p>Java ä¸å¯èƒ½å®ç° 100% çš„å…¬å¹³æ€§ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡åŒæ­¥ç»“æ„åœ¨çº¿ç¨‹é—´å®ç°å…¬å¹³æ€§çš„æé«˜ã€‚</p>
<p>æœ‰ä¸‰ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>ä¿è¯èµ„æºå……è¶³</li>
<li>å…¬å¹³åœ°åˆ†é…èµ„æº</li>
<li>é¿å…æŒæœ‰é”çš„çº¿ç¨‹é•¿æ—¶é—´æ‰§è¡Œ</li>
</ul>
<p>è¿™ä¸‰ä¸ªæ–¹æ¡ˆä¸­ï¼Œæ–¹æ¡ˆä¸€å’Œæ–¹æ¡ˆä¸‰çš„é€‚ç”¨åœºæ™¯æ¯”è¾ƒæœ‰é™ï¼Œå› ä¸ºå¾ˆå¤šåœºæ™¯ä¸‹ï¼Œèµ„æºçš„ç¨€ç¼ºæ€§æ˜¯æ²¡åŠæ³•è§£å†³çš„ï¼ŒæŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ä¹Ÿå¾ˆéš¾ç¼©çŸ­ã€‚å€’æ˜¯æ–¹æ¡ˆäºŒçš„é€‚ç”¨åœºæ™¯ç›¸å¯¹æ¥è¯´æ›´å¤šä¸€äº›ã€‚</p>
<p>é‚£å¦‚ä½•å…¬å¹³åœ°åˆ†é…èµ„æºå‘¢ï¼Ÿåœ¨å¹¶å‘ç¼–ç¨‹é‡Œï¼Œä¸»è¦æ˜¯ä½¿ç”¨<strong>å…¬å¹³é”</strong>ã€‚æ‰€è°“å…¬å¹³é”ï¼Œæ˜¯ä¸€ç§å…ˆæ¥ååˆ°çš„æ–¹æ¡ˆï¼Œçº¿ç¨‹çš„ç­‰å¾…æ˜¯æœ‰é¡ºåºçš„ï¼Œæ’åœ¨ç­‰å¾…é˜Ÿåˆ—å‰é¢çš„çº¿ç¨‹ä¼šä¼˜å…ˆè·å¾—èµ„æºã€‚</p>
<h2 id="-559"><a class="markdownIt-Anchor" href="#-559">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_5-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98">#</a>5. æ€§èƒ½é—®é¢˜</h2>
<p>å¹¶å‘æ‰§è¡Œä¸€å®šæ¯”ä¸²è¡Œæ‰§è¡Œå¿«å—ï¼Ÿçº¿ç¨‹è¶Šå¤šæ‰§è¡Œè¶Šå¿«å—ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>å¹¶å‘ä¸ä¸€å®šæ¯”ä¸²è¡Œå¿«</strong>ã€‚å› ä¸ºæœ‰åˆ›å»ºçº¿ç¨‹å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚</p>
<h3 id="-560"><a class="markdownIt-Anchor" href="#-560">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_5-1-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2">#</a>5.1. ä¸Šä¸‹æ–‡åˆ‡æ¢</h3>
<h4 id="-561"><a class="markdownIt-Anchor" href="#-561">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2">#</a>ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</h4>
<p>å½“ CPU ä»æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼ŒCPU éœ€è¦ä¿å­˜å½“å‰çº¿ç¨‹çš„æœ¬åœ°æ•°æ®ï¼Œç¨‹åºæŒ‡é’ˆç­‰çŠ¶æ€ï¼Œå¹¶åŠ è½½ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„çº¿ç¨‹çš„æœ¬åœ°æ•°æ®ï¼Œç¨‹åºæŒ‡é’ˆç­‰ã€‚è¿™ä¸ªå¼€å…³è¢«ç§°ä¸º â€œä¸Šä¸‹æ–‡åˆ‡æ¢â€ã€‚</p>
<h4 id="-562"><a class="markdownIt-Anchor" href="#-562">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E5%87%8F%E5%B0%91%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E7%9A%84%E6%96%B9%E6%B3%95">#</a>å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹æ³•</h4>
<ul>
<li>æ— é”å¹¶å‘ç¼–ç¨‹ - å¤šçº¿ç¨‹ç«äº‰é”æ—¶ï¼Œä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹å¤„ç†æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨ä¸€äº›åŠæ³•æ¥é¿å…ä½¿ç”¨é”ï¼Œå¦‚å°†æ•°æ®çš„ ID æŒ‰ç…§ Hash ç®—æ³•å–æ¨¡åˆ†æ®µï¼Œä¸åŒçš„çº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ®ã€‚</li>
<li>CAS ç®—æ³• - Java çš„ Atomic åŒ…ä½¿ç”¨ CAS ç®—æ³•æ¥æ›´æ–°æ•°æ®ï¼Œè€Œä¸éœ€è¦åŠ é”ã€‚</li>
<li>ä½¿ç”¨æœ€å°‘çº¿ç¨‹ - é¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ä»»åŠ¡å¾ˆå°‘ï¼Œä½†æ˜¯åˆ›å»ºäº†å¾ˆå¤šçº¿ç¨‹æ¥å¤„ç†ï¼Œè¿™æ ·ä¼šé€ æˆå¤§é‡çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ã€‚</li>
<li>ä½¿ç”¨åç¨‹ - åœ¨å•çº¿ç¨‹é‡Œå®ç°å¤šä»»åŠ¡çš„è°ƒåº¦ï¼Œå¹¶åœ¨å•çº¿ç¨‹é‡Œç»´æŒå¤šä¸ªä»»åŠ¡é—´çš„åˆ‡æ¢ã€‚</li>
</ul>
<h3 id="-563"><a class="markdownIt-Anchor" href="#-563">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_5-2-%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6">#</a>5.2. èµ„æºé™åˆ¶</h3>
<h4 id="-564"><a class="markdownIt-Anchor" href="#-564">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6">#</a>ä»€ä¹ˆæ˜¯èµ„æºé™åˆ¶</h4>
<p>èµ„æºé™åˆ¶æ˜¯æŒ‡åœ¨è¿›è¡Œå¹¶å‘ç¼–ç¨‹æ—¶ï¼Œç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦å—é™äºè®¡ç®—æœºç¡¬ä»¶èµ„æºæˆ–è½¯ä»¶èµ„æºã€‚</p>
<h4 id="-565"><a class="markdownIt-Anchor" href="#-565">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E5%BC%95%E5%8F%91%E7%9A%84%E9%97%AE%E9%A2%98">#</a>èµ„æºé™åˆ¶å¼•å‘çš„é—®é¢˜</h4>
<p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå°†ä»£ç æ‰§è¡Œé€Ÿåº¦åŠ å¿«çš„åŸåˆ™æ˜¯å°†ä»£ç ä¸­ä¸²è¡Œæ‰§è¡Œçš„éƒ¨åˆ†å˜æˆå¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å¦‚æœå°†æŸæ®µä¸²è¡Œçš„ä»£ç å¹¶å‘æ‰§è¡Œï¼Œå› ä¸ºå—é™äºèµ„æºï¼Œä»ç„¶åœ¨ä¸²è¡Œæ‰§è¡Œï¼Œè¿™æ—¶å€™ç¨‹åºä¸ä»…ä¸ä¼šåŠ å¿«æ‰§è¡Œï¼Œåè€Œä¼šæ›´æ…¢ï¼Œå› ä¸ºå¢åŠ äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œèµ„æºè°ƒåº¦çš„æ—¶é—´ã€‚</p>
<h4 id="-566"><a class="markdownIt-Anchor" href="#-566">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E7%9A%84%E9%97%AE%E9%A2%98">#</a>å¦‚ä½•è§£å†³èµ„æºé™åˆ¶çš„é—®é¢˜</h4>
<p>åœ¨èµ„æºé™åˆ¶æƒ…å†µä¸‹è¿›è¡Œå¹¶å‘ç¼–ç¨‹ï¼Œæ ¹æ®ä¸åŒçš„èµ„æºé™åˆ¶è°ƒæ•´ç¨‹åºçš„å¹¶å‘åº¦ã€‚</p>
<ul>
<li>å¯¹äºç¡¬ä»¶èµ„æºé™åˆ¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨é›†ç¾¤å¹¶è¡Œæ‰§è¡Œç¨‹åºã€‚</li>
<li>å¯¹äºè½¯ä»¶èµ„æºé™åˆ¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨èµ„æºæ± å°†èµ„æºå¤ç”¨ã€‚</li>
</ul>
<h2 id="-567"><a class="markdownIt-Anchor" href="#-567">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.html#_6-%E5%B0%8F%E7%BB%93">#</a>6. å°ç»“</h2>
<p>å¹¶å‘ç¼–ç¨‹å¯ä»¥æ€»ç»“ä¸ºä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåˆ†å·¥ã€åŒæ­¥ã€äº’æ–¥ã€‚</p>
<ul>
<li><strong>åˆ†å·¥</strong>ï¼šæ˜¯æŒ‡å¦‚ä½•é«˜æ•ˆåœ°æ‹†è§£ä»»åŠ¡å¹¶åˆ†é…ç»™çº¿ç¨‹ã€‚</li>
<li><strong>åŒæ­¥</strong>ï¼šæ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´å¦‚ä½•åä½œã€‚</li>
<li><strong>äº’æ–¥</strong>ï¼šæ˜¯æŒ‡ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºã€‚</li>
</ul>
<hr>
<h1 id="java-çº¿ç¨‹åŸºç¡€"><a class="markdownIt-Anchor" href="#java-çº¿ç¨‹åŸºç¡€">#</a> Java çº¿ç¨‹åŸºç¡€</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p><strong>å…³é”®è¯ï¼š <code>Thread</code> ã€ <code>Runnable</code> ã€ <code>Callable</code> ã€ <code>Future</code> ã€ <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code> ã€ <code>join</code> ã€ <code>sleep</code> ã€ <code>yeild</code> ã€ <code>çº¿ç¨‹çŠ¶æ€</code> ã€ <code>çº¿ç¨‹é€šä¿¡</code> </strong></p>
</blockquote>
<ul>
<li>\1. çº¿ç¨‹ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#11-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9B%E7%A8%8B">1.1. ä»€ä¹ˆæ˜¯è¿›ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#12-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B">1.2. ä»€ä¹ˆæ˜¯çº¿ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#13-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB">1.3. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</a></li>
</ul>
</li>
<li>\2. åˆ›å»ºçº¿ç¨‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#21-thread">2.1. Thread</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#22-runnable">2.2. Runnable</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#23-callablefuturefuturetask">2.3. Callableã€Futureã€FutureTask</a></li>
</ul>
</li>
<li>\3. çº¿ç¨‹åŸºæœ¬ç”¨æ³•
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#31-%E7%BA%BF%E7%A8%8B%E4%BC%91%E7%9C%A0">3.1. çº¿ç¨‹ä¼‘çœ </a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#32-%E7%BA%BF%E7%A8%8B%E7%A4%BC%E8%AE%A9">3.2. çº¿ç¨‹ç¤¼è®©</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#33-%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8B">3.3. ç»ˆæ­¢çº¿ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#34-%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B">3.4. å®ˆæŠ¤çº¿ç¨‹</a></li>
</ul>
</li>
<li>\4. çº¿ç¨‹é€šä¿¡
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#41-waitnotifynotifyall">4.1. wait/notify/notifyAll</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#42-join">4.2. join</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#43-%E7%AE%A1%E9%81%93">4.3. ç®¡é“</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#5-%E7%BA%BF%E7%A8%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">5. çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</a></li>
<li>\6. çº¿ç¨‹å¸¸è§é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#61-sleepyieldjoin-%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">6.1. sleepã€yieldã€join æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#62-%E4%B8%BA%E4%BB%80%E4%B9%88-sleep-%E5%92%8C-yield-%E6%96%B9%E6%B3%95%E6%98%AF%E9%9D%99%E6%80%81%E7%9A%84">6.2. ä¸ºä»€ä¹ˆ sleep å’Œ yield æ–¹æ³•æ˜¯é™æ€çš„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#63-java-%E7%BA%BF%E7%A8%8B%E6%98%AF%E5%90%A6%E6%8C%89%E7%85%A7%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7%E4%B8%A5%E6%A0%BC%E6%89%A7%E8%A1%8C">6.3. Java çº¿ç¨‹æ˜¯å¦æŒ‰ç…§çº¿ç¨‹ä¼˜å…ˆçº§ä¸¥æ ¼æ‰§è¡Œ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#64-%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%B8%A4%E6%AC%A1%E8%B0%83%E7%94%A8-start%E6%96%B9%E6%B3%95%E4%BC%9A%E6%80%8E%E6%A0%B7">6.4. ä¸€ä¸ªçº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨ start () æ–¹æ³•ä¼šæ€æ ·</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#65-start-%E5%92%8C-run-%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">6.5.  <code>start</code>  å’Œ  <code>run</code>  æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#66-%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8-thread-%E7%B1%BB%E7%9A%84-run-%E6%96%B9%E6%B3%95%E4%B9%88">6.6. å¯ä»¥ç›´æ¥è°ƒç”¨  <code>Thread</code>  ç±»çš„  <code>run</code>  æ–¹æ³•ä¹ˆ</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-568"><a class="markdownIt-Anchor" href="#-568">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_1-%E7%BA%BF%E7%A8%8B%E7%AE%80%E4%BB%8B">#</a>1. çº¿ç¨‹ç®€ä»‹</h2>
<h3 id="-569"><a class="markdownIt-Anchor" href="#-569">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9B%E7%A8%8B">#</a>1.1. ä»€ä¹ˆæ˜¯è¿›ç¨‹</h3>
<p>ç®€è¨€ä¹‹ï¼Œ<strong>è¿›ç¨‹å¯è§†ä¸ºä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åº</strong>ã€‚å®ƒæ˜¯ç³»ç»Ÿè¿è¡Œç¨‹åºçš„åŸºæœ¬å•ä½ï¼Œå› æ­¤è¿›ç¨‹æ˜¯åŠ¨æ€çš„ã€‚è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚</p>
<h3 id="-570"><a class="markdownIt-Anchor" href="#-570">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_1-2-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B">#</a>1.2. ä»€ä¹ˆæ˜¯çº¿ç¨‹</h3>
<p>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚çº¿ç¨‹ä¹Ÿå«è½»é‡çº§è¿›ç¨‹ï¼ˆLight Weight Processï¼‰ï¼Œåœ¨ä¸€ä¸ªè¿›ç¨‹é‡Œå¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹éƒ½æ‹¥æœ‰å„è‡ªçš„è®¡æ•°å™¨ã€å †æ ˆå’Œå±€éƒ¨å˜é‡ç­‰å±æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿè®¿é—®å…±äº«çš„å†…å­˜å˜é‡ã€‚</p>
<h3 id="-571"><a class="markdownIt-Anchor" href="#-571">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_1-3-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB">#</a>1.3. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h3>
<ul>
<li>ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</li>
<li>çº¿ç¨‹æ¯”è¿›ç¨‹åˆ’åˆ†æ›´ç»†ï¼Œæ‰€ä»¥æ‰§è¡Œå¼€é”€æ›´å°ï¼Œå¹¶å‘æ€§æ›´é«˜ã€‚</li>
<li>è¿›ç¨‹æ˜¯ä¸€ä¸ªå®ä½“ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„èµ„æºï¼›è€ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</li>
</ul>
<h2 id="-572"><a class="markdownIt-Anchor" href="#-572">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_2-%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B">#</a>2. åˆ›å»ºçº¿ç¨‹</h2>
<p>åˆ›å»ºçº¿ç¨‹æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li>ç»§æ‰¿  <code>Thread</code>  ç±»</li>
<li>å®ç°  <code>Runnable</code>  æ¥å£</li>
<li>å®ç°  <code>Callable</code>  æ¥å£</li>
</ul>
<h3 id="-573"><a class="markdownIt-Anchor" href="#-573">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_2-1-thread">#</a>2.1. Thread</h3>
<p>é€šè¿‡ç»§æ‰¿  <code>Thread</code>  ç±»åˆ›å»ºçº¿ç¨‹çš„æ­¥éª¤ï¼š</p>
<ol>
<li>å®šä¹‰  <code>Thread</code>  ç±»çš„å­ç±»ï¼Œå¹¶è¦†å†™è¯¥ç±»çš„  <code>run</code>  æ–¹æ³•ã€‚ <code>run</code>  æ–¹æ³•çš„æ–¹æ³•ä½“å°±ä»£è¡¨äº†çº¿ç¨‹è¦å®Œæˆçš„ä»»åŠ¡ï¼Œå› æ­¤æŠŠ  <code>run</code>  æ–¹æ³•ç§°ä¸ºæ‰§è¡Œä½“ã€‚</li>
<li>åˆ›å»º  <code>Thread</code>  å­ç±»çš„å®ä¾‹ï¼Œå³åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ã€‚</li>
<li>è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„  <code>start</code>  æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å®ä¾‹åŒ–å¯¹è±¡</span>
        <span class="token class-name">MyThread</span> tA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"Thread çº¿ç¨‹-A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyThread</span> tB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"Thread çº¿ç¨‹-B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è°ƒç”¨çº¿ç¨‹ä¸»ä½“</span>
        tA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

        <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å–å‡ºäº†ç¬¬ "</span> <span class="token operator">+</span> ticket <span class="token operator">+</span> <span class="token string">" å¼ ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ticket<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-574"><a class="markdownIt-Anchor" href="#-574">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_2-2-runnable">#</a>2.2. Runnable</h3>
<p><strong>å®ç°  <code>Runnable</code>  æ¥å£ä¼˜äºç»§æ‰¿  <code>Thread</code>  ç±»</strong>ï¼Œå› ä¸ºï¼š</p>
<ul>
<li>Java ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œæ‰€æœ‰çš„ç±»éƒ½åªå…è®¸ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œä½†å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚å¦‚æœç»§æ‰¿äº†  <code>Thread</code>  ç±»å°±æ— æ³•ç»§æ‰¿å…¶å®ƒç±»ï¼Œè¿™ä¸åˆ©äºæ‰©å±•ã€‚</li>
<li>ç±»å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå°±è¡Œï¼Œç»§æ‰¿æ•´ä¸ª  <code>Thread</code>  ç±»å¼€é”€è¿‡å¤§ã€‚</li>
</ul>
<p>é€šè¿‡å®ç°  <code>Runnable</code>  æ¥å£åˆ›å»ºçº¿ç¨‹çš„æ­¥éª¤ï¼š</p>
<ol>
<li>å®šä¹‰  <code>Runnable</code>  æ¥å£çš„å®ç°ç±»ï¼Œå¹¶è¦†å†™è¯¥æ¥å£çš„  <code>run</code>  æ–¹æ³•ã€‚è¯¥  <code>run</code>  æ–¹æ³•çš„æ–¹æ³•ä½“åŒæ ·æ˜¯è¯¥çº¿ç¨‹çš„çº¿ç¨‹æ‰§è¡Œä½“ã€‚</li>
<li>åˆ›å»º  <code>Runnable</code>  å®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶ä»¥æ­¤å®ä¾‹ä½œä¸º  <code>Thread</code>  çš„ target æ¥åˆ›å»º  <code>Thread</code>  å¯¹è±¡ï¼Œè¯¥  <code>Thread</code>  å¯¹è±¡æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ã€‚</li>
<li>è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„  <code>start</code>  æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunnableDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å®ä¾‹åŒ–å¯¹è±¡</span>
        <span class="token class-name">Thread</span> tA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Runnable çº¿ç¨‹-A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> tB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Runnable çº¿ç¨‹-B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è°ƒç”¨çº¿ç¨‹ä¸»ä½“</span>
        tA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å–å‡ºäº†ç¬¬ "</span> <span class="token operator">+</span> ticket <span class="token operator">+</span> <span class="token string">" å¼ ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ticket<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-575"><a class="markdownIt-Anchor" href="#-575">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_2-3-callable%E3%80%81future%E3%80%81futuretask">#</a>2.3. Callableã€Futureã€FutureTask</h3>
<p><strong>ç»§æ‰¿ Thread ç±»å’Œå®ç° Runnable æ¥å£è¿™ä¸¤ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼éƒ½æ²¡æœ‰è¿”å›å€¼</strong>ã€‚æ‰€ä»¥ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œåï¼Œæ— æ³•å¾—åˆ°æ‰§è¡Œç»“æœã€‚ä½†å¦‚æœæœŸæœ›å¾—åˆ°æ‰§è¡Œç»“æœè¯¥æ€ä¹ˆåšï¼Ÿ</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJava 1.5 åï¼Œæä¾›äº†  <code>Callable</code>  æ¥å£å’Œ  <code>Future</code>  æ¥å£ï¼Œé€šè¿‡å®ƒä»¬ï¼Œå¯ä»¥åœ¨çº¿ç¨‹æ‰§è¡Œç»“æŸåï¼Œè¿”å›æ‰§è¡Œç»“æœã€‚</p>
<h4 id="-576"><a class="markdownIt-Anchor" href="#-576">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#callable">#</a>Callable</h4>
<p>Callable æ¥å£åªå£°æ˜äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å«åš call ()ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * Computes a result, or throws an exception if unable to do so.
     *
     * @return computed result
     * @throws Exception if unable to compute a result
     */</span>
    <span class="token class-name">V</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>é‚£ä¹ˆæ€ä¹ˆä½¿ç”¨ Callable å‘¢ï¼Ÿä¸€èˆ¬æƒ…å†µä¸‹æ˜¯é…åˆ ExecutorService æ¥ä½¿ç”¨çš„ï¼Œåœ¨ ExecutorService æ¥å£ä¸­å£°æ˜äº†è‹¥å¹²ä¸ª submit æ–¹æ³•çš„é‡è½½ç‰ˆæœ¬ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">,</span> <span class="token class-name">T</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ç¬¬ä¸€ä¸ª submit æ–¹æ³•é‡Œé¢çš„å‚æ•°ç±»å‹å°±æ˜¯ Callableã€‚</p>
<h4 id="-577"><a class="markdownIt-Anchor" href="#-577">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#future">#</a>Future</h4>
<p>Future å°±æ˜¯å¯¹äºå…·ä½“çš„ Callable ä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœã€‚å¿…è¦æ—¶å¯ä»¥é€šè¿‡ get æ–¹æ³•è·å–æ‰§è¡Œç»“æœï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡è¿”å›ç»“æœã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">boolean</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> mayInterruptIfRunning<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isCancelled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>
    <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-578"><a class="markdownIt-Anchor" href="#-578">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#futuretask">#</a>FutureTask</h4>
<p>FutureTask ç±»å®ç°äº† RunnableFuture æ¥å£ï¼ŒRunnableFuture ç»§æ‰¿äº† Runnable æ¥å£å’Œ Future æ¥å£ã€‚</p>
<p>æ‰€ä»¥ï¼ŒFutureTask æ—¢å¯ä»¥ä½œä¸º Runnable è¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸º Future å¾—åˆ° Callable çš„è¿”å›å€¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">public</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> callable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span> <span class="token class-name">V</span> result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>äº‹å®ä¸Šï¼ŒFutureTask æ˜¯ Future æ¥å£çš„ä¸€ä¸ªå”¯ä¸€å®ç°ç±»ã€‚</p>
<h4 id="-579"><a class="markdownIt-Anchor" href="#-579">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#callable-future-futuretask-%E7%A4%BA%E4%BE%8B">#</a>Callable + Future + FutureTask ç¤ºä¾‹</h4>
<p>é€šè¿‡å®ç°  <code>Callable</code>  æ¥å£åˆ›å»ºçº¿ç¨‹çš„æ­¥éª¤ï¼š</p>
<ol>
<li>åˆ›å»º  <code>Callable</code>  æ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°  <code>call</code>  æ–¹æ³•ã€‚è¯¥  <code>call</code>  æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚</li>
<li>åˆ›å»º  <code>Callable</code>  å®ç°ç±»çš„å®ä¾‹ï¼Œä½¿ç”¨  <code>FutureTask</code>  ç±»æ¥åŒ…è£…  <code>Callable</code>  å¯¹è±¡ï¼Œè¯¥  <code>FutureTask</code>  å¯¹è±¡å°è£…äº†è¯¥  <code>Callable</code>  å¯¹è±¡çš„  <code>call</code>  æ–¹æ³•çš„è¿”å›å€¼ã€‚</li>
<li>ä½¿ç”¨  <code>FutureTask</code>  å¯¹è±¡ä½œä¸º  <code>Thread</code>  å¯¹è±¡çš„ target åˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚</li>
<li>è°ƒç”¨  <code>FutureTask</code>  å¯¹è±¡çš„  <code>get</code>  æ–¹æ³•æ¥è·å¾—çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼ã€‚</li>
</ol>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CallableDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> callable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> future <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>callable<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>future<span class="token punctuation">,</span> <span class="token string">"Callable çº¿ç¨‹"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ä»»åŠ¡è€—æ—¶ï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ¯«ç§’"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å–å‡ºäº†ç¬¬ "</span> <span class="token operator">+</span> ticket <span class="token operator">+</span> <span class="token string">" å¼ ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ticket<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-580"><a class="markdownIt-Anchor" href="#-580">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_3-%E7%BA%BF%E7%A8%8B%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">#</a>3. çº¿ç¨‹åŸºæœ¬ç”¨æ³•</h2>
<p>çº¿ç¨‹ï¼ˆ <code>Thread</code> ï¼‰åŸºæœ¬æ–¹æ³•æ¸…å•ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>run</code></td>
<td>çº¿ç¨‹çš„æ‰§è¡Œå®ä½“ã€‚</td>
</tr>
<tr>
<td><code>start</code></td>
<td>çº¿ç¨‹çš„å¯åŠ¨æ–¹æ³•ã€‚</td>
</tr>
<tr>
<td><code>currentThread</code></td>
<td>è¿”å›å¯¹å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚</td>
</tr>
<tr>
<td><code>setName</code></td>
<td>è®¾ç½®çº¿ç¨‹åç§°ã€‚</td>
</tr>
<tr>
<td><code>getName</code></td>
<td>è·å–çº¿ç¨‹åç§°ã€‚</td>
</tr>
<tr>
<td><code>setPriority</code></td>
<td>è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ã€‚Java ä¸­çš„çº¿ç¨‹ä¼˜å…ˆçº§çš„èŒƒå›´æ˜¯ [1,10]ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹åœ¨è¿è¡Œæ—¶ä¼šå…·æœ‰ä¼˜å…ˆæƒã€‚å¯ä»¥é€šè¿‡  <code>thread.setPriority(Thread.MAX_PRIORITY)</code>  çš„æ–¹å¼è®¾ç½®ï¼Œé»˜è®¤ä¼˜å…ˆçº§ä¸º 5ã€‚</td>
</tr>
<tr>
<td><code>getPriority</code></td>
<td>è·å–çº¿ç¨‹ä¼˜å…ˆçº§ã€‚</td>
</tr>
<tr>
<td><code>setDaemon</code></td>
<td>è®¾ç½®çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>isDaemon</code></td>
<td>åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>isAlive</code></td>
<td>åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¯åŠ¨ã€‚</td>
</tr>
<tr>
<td><code>interrupt</code></td>
<td>ä¸­æ–­å¦ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚</td>
</tr>
<tr>
<td><code>interrupted</code></td>
<td>æµ‹è¯•å½“å‰çº¿ç¨‹æ˜¯å¦å·²è¢«ä¸­æ–­ã€‚é€šè¿‡æ­¤æ–¹æ³•å¯ä»¥æ¸…é™¤çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœè¦è¿ç»­è°ƒç”¨æ­¤æ–¹æ³•ä¸¤æ¬¡ï¼Œåˆ™ç¬¬äºŒæ¬¡è°ƒç”¨å°†è¿”å› falseï¼ˆé™¤éå½“å‰çº¿ç¨‹åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ¸…é™¤å…¶ä¸­æ–­çŠ¶æ€ä¹‹åä¸”åœ¨ç¬¬äºŒæ¬¡è°ƒç”¨æ£€æŸ¥å…¶çŠ¶æ€ä¹‹å‰å†æ¬¡ä¸­æ–­ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>join</code></td>
<td>å¯ä»¥ä½¿ä¸€ä¸ªçº¿ç¨‹å¼ºåˆ¶è¿è¡Œï¼Œçº¿ç¨‹å¼ºåˆ¶è¿è¡ŒæœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è¿è¡Œï¼Œå¿…é¡»ç­‰å¾…æ­¤çº¿ç¨‹å®Œæˆä¹‹åæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</td>
</tr>
<tr>
<td><code>Thread.sleep</code></td>
<td>é™æ€æ–¹æ³•ã€‚å°†å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ ã€‚</td>
</tr>
<tr>
<td><code>Thread.yield</code></td>
<td>é™æ€æ–¹æ³•ã€‚å°†å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼Œè®©å…¶ä»–çº¿ç¨‹æ‰§è¡Œã€‚</td>
</tr>
</tbody>
</table>
<h3 id="-581"><a class="markdownIt-Anchor" href="#-581">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_3-1-%E7%BA%BF%E7%A8%8B%E4%BC%91%E7%9C%A0">#</a>3.1. çº¿ç¨‹ä¼‘çœ </h3>
<p><strong>ä½¿ç”¨  <code>Thread.sleep</code>  æ–¹æ³•å¯ä»¥ä½¿å¾—å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚</strong></p>
<p>ä½¿ç”¨  <code>Thread.sleep</code>  éœ€è¦å‘å…¶ä¼ å…¥ä¸€ä¸ªæ•´æ•°å€¼ï¼Œè¿™ä¸ªå€¼è¡¨ç¤ºçº¿ç¨‹å°†è¦ä¼‘çœ çš„æ¯«ç§’æ•°ã€‚</p>
<p><code>Thread.sleep</code>  æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡º  <code>InterruptedException</code> ï¼Œå› ä¸ºå¼‚å¸¸ä¸èƒ½è·¨çº¿ç¨‹ä¼ æ’­å›  <code>main</code>  ä¸­ï¼Œå› æ­¤å¿…é¡»åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚çº¿ç¨‹ä¸­æŠ›å‡ºçš„å…¶å®ƒå¼‚å¸¸ä¹ŸåŒæ ·éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadSleepDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹A"</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹B"</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹C"</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">/** çº¿ç¨‹åç§° */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token comment">/** ä¼‘çœ æ—¶é—´ */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> time<span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> time<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> time<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// ä¼‘çœ æŒ‡å®šçš„æ—¶é—´</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"ä¼‘çœ "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">+</span> <span class="token string">"æ¯«ç§’ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-582"><a class="markdownIt-Anchor" href="#-582">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_3-2-%E7%BA%BF%E7%A8%8B%E7%A4%BC%E8%AE%A9">#</a>3.2. çº¿ç¨‹ç¤¼è®©</h3>
<p><code>Thread.yield</code>  æ–¹æ³•çš„è°ƒç”¨å£°æ˜äº†å½“å‰çº¿ç¨‹å·²ç»å®Œæˆäº†ç”Ÿå‘½å‘¨æœŸä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå¯ä»¥åˆ‡æ¢ç»™å…¶å®ƒçº¿ç¨‹æ¥æ‰§è¡Œ ã€‚</p>
<p>è¯¥æ–¹æ³•åªæ˜¯å¯¹çº¿ç¨‹è°ƒåº¦å™¨çš„ä¸€ä¸ªå»ºè®®ï¼Œè€Œä¸”ä¹Ÿåªæ˜¯å»ºè®®å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„å…¶å®ƒçº¿ç¨‹å¯ä»¥è¿è¡Œã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadYieldDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MyThread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">"çº¿ç¨‹A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">"çº¿ç¨‹B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"è¿è¡Œï¼Œi = "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹ç¤¼è®©ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-583"><a class="markdownIt-Anchor" href="#-583">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_3-3-%E7%BB%88%E6%AD%A2%E7%BA%BF%E7%A8%8B">#</a>3.3. ç»ˆæ­¢çº¿ç¨‹</h3>
<blockquote>
<p><strong> <code>Thread</code>  ä¸­çš„  <code>stop</code>  æ–¹æ³•æœ‰ç¼ºé™·ï¼Œå·²åºŸå¼ƒ</strong>ã€‚</p>
<p>ä½¿ç”¨  <code>Thread.stop</code>  åœæ­¢çº¿ç¨‹ä¼šå¯¼è‡´å®ƒè§£é”æ‰€æœ‰å·²é”å®šçš„ç›‘è§†å™¨ï¼ˆç”±äºæœªç»æ£€æŸ¥çš„  <code>ThreadDeath</code>  å¼‚å¸¸ä¼šåœ¨å †æ ˆä¸­ä¼ æ’­ï¼Œè¿™æ˜¯è‡ªç„¶çš„ç»“æœï¼‰ã€‚ å¦‚æœå…ˆå‰ç”±è¿™äº›ç›‘è§†å™¨ä¿æŠ¤çš„ä»»ä½•å¯¹è±¡å¤„äºä¸ä¸€è‡´çŠ¶æ€ï¼Œåˆ™æŸåçš„å¯¹è±¡å°†å¯¹å…¶ä»–çº¿ç¨‹å¯è§ï¼Œä»è€Œå¯èƒ½å¯¼è‡´ä»»æ„è¡Œä¸ºã€‚</p>
<p>stop () æ–¹æ³•ä¼šçœŸçš„æ€æ­»çº¿ç¨‹ï¼Œä¸ç»™çº¿ç¨‹å–˜æ¯çš„æœºä¼šï¼Œå¦‚æœçº¿ç¨‹æŒæœ‰ ReentrantLock é”ï¼Œè¢« stop () çš„çº¿ç¨‹å¹¶ä¸ä¼šè‡ªåŠ¨è°ƒç”¨ ReentrantLock çš„ unlock () å»é‡Šæ”¾é”ï¼Œé‚£å…¶ä»–çº¿ç¨‹å°±å†ä¹Ÿæ²¡æœºä¼šè·å¾— ReentrantLock é”ï¼Œè¿™å®åœ¨æ˜¯å¤ªå±é™©äº†ã€‚æ‰€ä»¥è¯¥æ–¹æ³•å°±ä¸å»ºè®®ä½¿ç”¨äº†ï¼Œç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰ suspend () å’Œ resume () æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åŒæ ·ä¹Ÿéƒ½ä¸å»ºè®®ä½¿ç”¨äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå°±ä¸å¤šä»‹ç»äº†ã€‚ <code>Thread.stop</code>  çš„è®¸å¤šç”¨æ³•åº”ç”±ä»…ä¿®æ”¹æŸäº›å˜é‡ä»¥æŒ‡ç¤ºç›®æ ‡çº¿ç¨‹åº”åœæ­¢è¿è¡Œçš„ä»£ç ä»£æ›¿ã€‚ ç›®æ ‡çº¿ç¨‹åº”å®šæœŸæ£€æŸ¥æ­¤å˜é‡ï¼Œå¦‚æœè¯¥å˜é‡æŒ‡ç¤ºè¦åœæ­¢è¿è¡Œï¼Œåˆ™åº”æŒ‰æœ‰åºæ–¹å¼ä»å…¶è¿è¡Œæ–¹æ³•è¿”å›ã€‚å¦‚æœç›®æ ‡çº¿ç¨‹ç­‰å¾…å¾ˆé•¿æ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ¡ä»¶å˜é‡ä¸Šï¼‰ï¼Œåˆ™åº”ä½¿ç”¨ä¸­æ–­æ–¹æ³•æ¥ä¸­æ–­ç­‰å¾…ã€‚</p>
</blockquote>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è¿è¡Œæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›´æ¥é€šè¿‡  <code>interrupt</code>  æ–¹æ³•ä¸­æ–­å…¶è¿è¡ŒçŠ¶æ€ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadInterruptDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MyThread</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®ä¾‹åŒ–Runnableå­ç±»å¯¹è±¡</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>mt<span class="token punctuation">,</span> <span class="token string">"çº¿ç¨‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®ä¾‹åŒ–Threadå¯¹è±¡</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çº¿ç¨‹ä¼‘çœ 2ç§’</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3ã€mainçº¿ç¨‹ä¼‘çœ è¢«ç»ˆæ­¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        t<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸­æ–­çº¿ç¨‹æ‰§è¡Œ</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1ã€è¿›å…¥run()æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çº¿ç¨‹ä¼‘çœ 10ç§’</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2ã€å·²ç»å®Œæˆäº†ä¼‘çœ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"3ã€MyThreadçº¿ç¨‹ä¼‘çœ è¢«ç»ˆæ­¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// è¿”å›è°ƒç”¨å¤„</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"4ã€run()æ–¹æ³•æ­£å¸¸ç»“æŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„  <code>run</code>  æ–¹æ³•æ‰§è¡Œä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡Œ  <code>sleep</code>  ç­‰ä¼šæŠ›å‡º  <code>InterruptedException</code>  çš„æ“ä½œï¼Œé‚£ä¹ˆè°ƒç”¨çº¿ç¨‹çš„  <code>interrupt</code>  æ–¹æ³•å°±æ— æ³•ä½¿çº¿ç¨‹æå‰ç»“æŸã€‚</p>
<p>ä½†æ˜¯è°ƒç”¨  <code>interrupt</code>  æ–¹æ³•ä¼šè®¾ç½®çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ï¼Œæ­¤æ—¶è°ƒç”¨  <code>interrupted</code>  æ–¹æ³•ä¼šè¿”å›  <code>true</code> ã€‚å› æ­¤å¯ä»¥åœ¨å¾ªç¯ä½“ä¸­ä½¿ç”¨  <code>interrupted</code>  æ–¹æ³•æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¤„äºä¸­æ–­çŠ¶æ€ï¼Œä»è€Œæå‰ç»“æŸçº¿ç¨‹ã€‚</p>
<p>å®‰å…¨åœ°ç»ˆæ­¢çº¿ç¨‹æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>å®šä¹‰  <code>volatile</code>  æ ‡å¿—ä½ï¼Œåœ¨  <code>run</code>  æ–¹æ³•ä¸­ä½¿ç”¨æ ‡å¿—ä½æ§åˆ¶çº¿ç¨‹ç»ˆæ­¢</li>
<li>ä½¿ç”¨  <code>interrupt</code>  æ–¹æ³•å’Œ  <code>Thread.interrupted</code>  æ–¹æ³•é…åˆä½¿ç”¨æ¥æ§åˆ¶çº¿ç¨‹ç»ˆæ­¢</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘ä½¿ç”¨  <code>volatile</code>  æ ‡å¿—ä½æ§åˆ¶çº¿ç¨‹ç»ˆæ­¢</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadStopDemo2</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MyTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">"MyTask"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        task<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">long</span> count <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" çº¿ç¨‹å¯åŠ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" çº¿ç¨‹ç»ˆæ­¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">/**
         * é€šè¿‡ volatile æ ‡å¿—ä½æ¥æ§åˆ¶çº¿ç¨‹ç»ˆæ­¢
         */</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘ä½¿ç”¨  <code>interrupt</code>  æ–¹æ³•å’Œ  <code>Thread.interrupted</code>  æ–¹æ³•é…åˆä½¿ç”¨æ¥æ§åˆ¶çº¿ç¨‹ç»ˆæ­¢</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadStopDemo3</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MyTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token string">"MyTask"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">long</span> count <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" çº¿ç¨‹å¯åŠ¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// é€šè¿‡ Thread.interrupted å’Œ interrupt é…åˆæ¥æ§åˆ¶çº¿ç¨‹ç»ˆæ­¢</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" çº¿ç¨‹ç»ˆæ­¢"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-584"><a class="markdownIt-Anchor" href="#-584">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_3-4-%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B">#</a>3.4. å®ˆæŠ¤çº¿ç¨‹</h3>
<p>ä»€ä¹ˆæ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Ÿ</p>
<ul>
<li><strong>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰æ˜¯åœ¨åå°æ‰§è¡Œå¹¶ä¸”ä¸ä¼šé˜»æ­¢ JVM ç»ˆæ­¢çš„çº¿ç¨‹</strong>ã€‚<strong>å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹ç»“æŸæ—¶ï¼Œç¨‹åºä¹Ÿå°±ç»ˆæ­¢ï¼ŒåŒæ—¶ä¼šæ€æ­»æ‰€æœ‰å®ˆæŠ¤çº¿ç¨‹</strong>ã€‚</li>
<li>ä¸å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰ç›¸åçš„ï¼Œå«ç”¨æˆ·çº¿ç¨‹ï¼ˆUser Threadï¼‰ï¼Œä¹Ÿå°±æ˜¯éå®ˆæŠ¤çº¿ç¨‹ã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆéœ€è¦å®ˆæŠ¤çº¿ç¨‹ï¼Ÿ</p>
<ul>
<li>å®ˆæŠ¤çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œç”¨äºä¸ºç³»ç»Ÿä¸­çš„å…¶å®ƒå¯¹è±¡å’Œçº¿ç¨‹æä¾›æœåŠ¡ã€‚å…¸å‹çš„åº”ç”¨å°±æ˜¯åƒåœ¾å›æ”¶å™¨ã€‚</li>
</ul>
<p>å¦‚ä½•ä½¿ç”¨å®ˆæŠ¤çº¿ç¨‹ï¼Ÿ</p>
<ul>
<li>
<p>å¯ä»¥ä½¿ç”¨  <code>isDaemon</code>  æ–¹æ³•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p>
</li>
<li>
<p>å¯ä»¥ä½¿ç”¨</p>
  <pre class="line-numbers language-none"><code class="language-none">setDaemon<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ–¹æ³•è®¾ç½®çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</p>
<ul>
<li>æ­£åœ¨è¿è¡Œçš„ç”¨æˆ·çº¿ç¨‹æ— æ³•è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥  <code>setDaemon</code>  å¿…é¡»åœ¨  <code>thread.start</code>  æ–¹æ³•ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™ä¼šæŠ›å‡º  <code>llegalThreadStateException</code>  å¼‚å¸¸ï¼›</li>
<li>ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹åˆ›å»ºçš„å­çº¿ç¨‹ä¾ç„¶æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</li>
<li>ä¸è¦è®¤ä¸ºæ‰€æœ‰çš„åº”ç”¨éƒ½å¯ä»¥åˆ†é…ç»™å®ˆæŠ¤çº¿ç¨‹æ¥è¿›è¡ŒæœåŠ¡ï¼Œæ¯”å¦‚è¯»å†™æ“ä½œæˆ–è€…è®¡ç®—é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadDaemonDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"çº¿ç¨‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ­¤çº¿ç¨‹åœ¨åå°è¿è¡Œ</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹ t æ˜¯å¦æ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼š"</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"åœ¨è¿è¡Œã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/shimiso/article/details/8964414">Java ä¸­å®ˆæŠ¤çº¿ç¨‹çš„æ€»ç»“ (opens new window)</a></p>
</blockquote>
<h2 id="-585"><a class="markdownIt-Anchor" href="#-585">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_4-%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1">#</a>4. çº¿ç¨‹é€šä¿¡</h2>
<blockquote>
<p>å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒã€‚</p>
</blockquote>
<h3 id="-586"><a class="markdownIt-Anchor" href="#-586">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_4-1-wait-notify-notifyall">#</a>4.1. wait/notify/notifyAll</h3>
<ul>
<li><code>wait</code>  -  <code>wait</code>  ä¼šè‡ªåŠ¨é‡Šæ”¾å½“å‰çº¿ç¨‹å æœ‰çš„å¯¹è±¡é”ï¼Œå¹¶è¯·æ±‚æ“ä½œç³»ç»ŸæŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œ<strong>è®©çº¿ç¨‹ä»  <code>Running</code>  çŠ¶æ€è½¬å…¥  <code>Waiting</code>  çŠ¶æ€</strong>ï¼Œç­‰å¾…  <code>notify</code>  /  <code>notifyAll</code>  æ¥å”¤é†’ã€‚å¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ  <code>notify</code>  æˆ–è€…  <code>notifyAll</code>  æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”ã€‚</li>
<li><code>notify</code>  - å”¤é†’ä¸€ä¸ªæ­£åœ¨  <code>Waiting</code>  çŠ¶æ€çš„çº¿ç¨‹ï¼Œå¹¶è®©å®ƒæ‹¿åˆ°å¯¹è±¡é”ï¼Œå…·ä½“å”¤é†’å“ªä¸€ä¸ªçº¿ç¨‹ç”± JVM æ§åˆ¶ ã€‚</li>
<li><code>notifyAll</code>  - å”¤é†’æ‰€æœ‰æ­£åœ¨  <code>Waiting</code>  çŠ¶æ€çš„çº¿ç¨‹ï¼Œæ¥ä¸‹æ¥å®ƒä»¬éœ€è¦ç«äº‰å¯¹è±¡é”ã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li><strong> <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  éƒ½æ˜¯  <code>Object</code>  ç±»ä¸­çš„æ–¹æ³•</strong>ï¼Œè€Œé  <code>Thread</code> ã€‚</li>
<li><strong> <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  åªèƒ½ç”¨åœ¨  <code>synchronized</code>  æ–¹æ³•æˆ–è€…  <code>synchronized</code>  ä»£ç å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º  <code>IllegalMonitorStateException</code> </strong>ã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆ  <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  ä¸å®šä¹‰åœ¨  <code>Thread</code>  ä¸­ï¼Ÿä¸ºä»€ä¹ˆ  <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  è¦é…åˆ  <code>synchronized</code>  ä½¿ç”¨ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œéœ€è¦äº†è§£å‡ ä¸ªåŸºæœ¬çŸ¥è¯†ç‚¹ï¼š</p>
<ul>
<li>æ¯ä¸€ä¸ª Java å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„ <strong>ç›‘è§†å™¨ï¼ˆmonitorï¼‰</strong></li>
<li>æ¯ä¸€ä¸ªç›‘è§†å™¨é‡Œé¢éƒ½æœ‰ä¸€ä¸ª <strong>å¯¹è±¡é”</strong> ã€ä¸€ä¸ª <strong>ç­‰å¾…é˜Ÿåˆ—</strong>ã€ä¸€ä¸ª <strong>åŒæ­¥é˜Ÿåˆ—</strong></li>
</ul>
<p>äº†è§£äº†ä»¥ä¸Šæ¦‚å¿µï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥ç†è§£å‰é¢ä¸¤ä¸ªé—®é¢˜ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™å‡ ä¸ªæ–¹æ³•ä¸å®šä¹‰åœ¨  <code>Thread</code>  ä¸­ï¼Ÿ</p>
<p>ç”±äºæ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰å¯¹è±¡é”ï¼Œè®©å½“å‰çº¿ç¨‹ç­‰å¾…æŸä¸ªå¯¹è±¡é”ï¼Œè‡ªç„¶åº”è¯¥åŸºäºè¿™ä¸ªå¯¹è±¡ï¼ˆ <code>Object</code> ï¼‰æ¥æ“ä½œï¼Œè€Œéä½¿ç”¨å½“å‰çº¿ç¨‹ï¼ˆ <code>Thread</code> ï¼‰æ¥æ“ä½œã€‚å› ä¸ºå½“å‰çº¿ç¨‹å¯èƒ½ä¼šç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„é”ï¼Œå¦‚æœåŸºäºçº¿ç¨‹ï¼ˆ <code>Thread</code> ï¼‰æ¥æ“ä½œï¼Œå°±éå¸¸å¤æ‚äº†ã€‚</p>
<p>ä¸ºä»€ä¹ˆ  <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  è¦é…åˆ  <code>synchronized</code>  ä½¿ç”¨ï¼Ÿ</p>
<p>å¦‚æœè°ƒç”¨æŸä¸ªå¯¹è±¡çš„  <code>wait</code>  æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å¿…é¡»æ‹¥æœ‰è¿™ä¸ªå¯¹è±¡çš„å¯¹è±¡é”ï¼Œå› æ­¤è°ƒç”¨  <code>wait</code>  æ–¹æ³•å¿…é¡»åœ¨  <code>synchronized</code>  æ–¹æ³•å’Œ  <code>synchronized</code>  ä»£ç å—ä¸­ã€‚</p>
</blockquote>
<p>ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…æ¨¡å¼æ˜¯  <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  çš„ä¸€ä¸ªç»å…¸ä½¿ç”¨æ¡ˆä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadWaitNotifyDemo02</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> QUEUE_SIZE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>QUEUE_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token string">"ç”Ÿäº§è€…A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token string">"ç”Ÿäº§è€…B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…A"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆè´¹è€…B"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">Consumer</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é˜Ÿåˆ—ç©ºï¼Œç­‰å¾…æ•°æ®"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            queue<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            queue<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    queue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¯æ¬¡ç§»èµ°é˜Ÿé¦–å…ƒç´ </span>
                    queue<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" ä»é˜Ÿåˆ—å–èµ°ä¸€ä¸ªå…ƒç´ ï¼Œé˜Ÿåˆ—å½“å‰æœ‰ï¼š"</span> <span class="token operator">+</span> queue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ä¸ªå…ƒç´ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">Producer</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>queue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> QUEUE_SIZE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"é˜Ÿåˆ—æ»¡ï¼Œç­‰å¾…æœ‰ç©ºä½™ç©ºé—´"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            queue<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            queue<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    queue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¯æ¬¡æ’å…¥ä¸€ä¸ªå…ƒç´ </span>
                    queue<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å‘é˜Ÿåˆ—å–ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œé˜Ÿåˆ—å½“å‰æœ‰ï¼š"</span> <span class="token operator">+</span> queue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ä¸ªå…ƒç´ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-587"><a class="markdownIt-Anchor" href="#-587">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_4-2-join">#</a>4.2. join</h3>
<p>åœ¨çº¿ç¨‹æ“ä½œä¸­ï¼Œå¯ä»¥ä½¿ç”¨  <code>join</code>  æ–¹æ³•è®©ä¸€ä¸ªçº¿ç¨‹å¼ºåˆ¶è¿è¡Œï¼Œçº¿ç¨‹å¼ºåˆ¶è¿è¡ŒæœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è¿è¡Œï¼Œå¿…é¡»ç­‰å¾…æ­¤çº¿ç¨‹å®Œæˆä¹‹åæ‰å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadJoinDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MyThread</span> mt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®ä¾‹åŒ–Runnableå­ç±»å¯¹è±¡</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>mt<span class="token punctuation">,</span> <span class="token string">"mythread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å®ä¾‹åŒ–Threadå¯¹è±¡</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯åŠ¨çº¿ç¨‹</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// çº¿ç¨‹å¼ºåˆ¶è¿è¡Œ</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Main çº¿ç¨‹è¿è¡Œ --> "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" è¿è¡Œï¼Œi = "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å–å¾—å½“å‰çº¿ç¨‹çš„åå­—</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-588"><a class="markdownIt-Anchor" href="#-588">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_4-3-%E7%AE%A1%E9%81%93">#</a>4.3. ç®¡é“</h3>
<p>ç®¡é“è¾“å…¥ / è¾“å‡ºæµå’Œæ™®é€šçš„æ–‡ä»¶è¾“å…¥ / è¾“å‡ºæµæˆ–è€…ç½‘ç»œè¾“å…¥ / è¾“å‡ºæµä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¸»è¦ç”¨äºçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œè€Œä¼ è¾“çš„åª’ä»‹ä¸ºå†…å­˜ã€‚ ç®¡é“è¾“å…¥ / è¾“å‡ºæµä¸»è¦åŒ…æ‹¬äº†å¦‚ä¸‹ 4 ç§å…·ä½“å®ç°ï¼š <code>PipedOutputStream</code> ã€ <code>PipedInputStream</code> ã€ <code>PipedReader</code>  å’Œ  <code>PipedWriter</code> ï¼Œå‰ä¸¤ç§é¢å‘å­—èŠ‚ï¼Œè€Œåä¸¤ç§é¢å‘å­—ç¬¦ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Piped</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">PipedWriter</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PipedWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PipedReader</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PipedReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å°†è¾“å‡ºæµå’Œè¾“å…¥æµè¿›è¡Œè¿æ¥ï¼Œå¦åˆ™åœ¨ä½¿ç”¨æ—¶ä¼šæŠ›å‡ºIOException</span>
        out<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> printThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Print</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"PrintThread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        printThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> receive <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>receive <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>receive<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Print</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">PipedReader</span> in<span class="token punctuation">;</span>

        <span class="token class-name">Print</span><span class="token punctuation">(</span><span class="token class-name">PipedReader</span> in<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>in <span class="token operator">=</span> in<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> receive <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>receive <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> receive<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-589"><a class="markdownIt-Anchor" href="#-589">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_5-%E7%BA%BF%E7%A8%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">#</a>5. çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210102103928.png" alt="img"></p>
<p><code>java.lang.Thread.State</code>  ä¸­å®šä¹‰äº† <strong>6</strong> ç§ä¸åŒçš„çº¿ç¨‹çŠ¶æ€ï¼Œåœ¨ç»™å®šçš„ä¸€ä¸ªæ—¶åˆ»ï¼Œçº¿ç¨‹åªèƒ½å¤„äºå…¶ä¸­çš„ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å„çŠ¶æ€çš„è¯´æ˜ï¼Œä»¥åŠçŠ¶æ€é—´çš„è”ç³»ï¼š</p>
<ul>
<li>
<p><strong>æ–°å»ºï¼ˆNewï¼‰</strong> - å°šæœªè°ƒç”¨  <code>start</code>  æ–¹æ³•çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚æ­¤çŠ¶æ€æ„å‘³ç€ï¼š<strong>åˆ›å»ºçš„çº¿ç¨‹å°šæœªå¯åŠ¨</strong>ã€‚</p>
</li>
<li>
<p><strong>å°±ç»ªï¼ˆRunnableï¼‰</strong> - å·²ç»è°ƒç”¨äº†  <code>start</code>  æ–¹æ³•çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚æ­¤çŠ¶æ€æ„å‘³ç€ï¼š<strong>çº¿ç¨‹å·²ç»åœ¨ JVM ä¸­è¿è¡Œ</strong>ã€‚ä½†æ˜¯åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ï¼Œå®ƒå¯èƒ½å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä¹Ÿå¯èƒ½ç­‰å¾…èµ„æºè°ƒåº¦ï¼ˆä¾‹å¦‚å¤„ç†å™¨èµ„æºï¼‰ï¼Œèµ„æºè°ƒåº¦å®Œæˆå°±è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚æ‰€ä»¥è¯¥çŠ¶æ€çš„å¯è¿è¡Œæ˜¯æŒ‡å¯ä»¥è¢«è¿è¡Œï¼Œå…·ä½“æœ‰æ²¡æœ‰è¿è¡Œè¦çœ‹åº•å±‚æ“ä½œç³»ç»Ÿçš„èµ„æºè°ƒåº¦ã€‚</p>
</li>
<li>
<p><strong>é˜»å¡ï¼ˆBlockedï¼‰</strong> - æ­¤çŠ¶æ€æ„å‘³ç€ï¼š<strong>çº¿ç¨‹å¤„äºè¢«é˜»å¡çŠ¶æ€</strong>ã€‚è¡¨ç¤ºçº¿ç¨‹åœ¨ç­‰å¾…  <code>synchronized</code>  çš„éšå¼é”ï¼ˆMonitor lockï¼‰ã€‚ <code>synchronized</code>  ä¿®é¥°çš„æ–¹æ³•ã€ä»£ç å—åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œå³å¤„äºé˜»å¡çŠ¶æ€ã€‚å½“å ç”¨  <code>synchronized</code>  éšå¼é”çš„çº¿ç¨‹é‡Šæ”¾é”ï¼Œå¹¶ä¸”ç­‰å¾…çš„çº¿ç¨‹è·å¾—  <code>synchronized</code>  éšå¼é”æ—¶ï¼Œå°±åˆä¼šä»  <code>BLOCKED</code>  è½¬æ¢åˆ°  <code>RUNNABLE</code>  çŠ¶æ€ã€‚</p>
</li>
<li>
<p><strong>ç­‰å¾…ï¼ˆWaitingï¼‰</strong> - æ­¤çŠ¶æ€æ„å‘³ç€ï¼š<strong>çº¿ç¨‹æ— é™æœŸç­‰å¾…ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹æ˜¾å¼åœ°å”¤é†’</strong>ã€‚ é˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«åœ¨äºï¼Œé˜»å¡æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒæ˜¯åœ¨ç­‰å¾…è·å–  <code>synchronized</code>  çš„éšå¼é”ã€‚è€Œç­‰å¾…æ˜¯ä¸»åŠ¨çš„ï¼Œé€šè¿‡è°ƒç”¨  <code>Object.wait</code>  ç­‰æ–¹æ³•è¿›å…¥ã€‚</p>
<table>
<thead>
<tr>
<th>è¿›å…¥æ–¹æ³•</th>
<th>é€€å‡ºæ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„  <code>Object.wait</code>  æ–¹æ³•</td>
<td><code>Object.notify</code>  /  <code>Object.notifyAll</code></td>
</tr>
<tr>
<td>æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„  <code>Thread.join</code>  æ–¹æ³•</td>
<td>è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td>
</tr>
</tbody>
</table>
<p>|  <code>LockSupport.park</code>  æ–¹æ³•ï¼ˆJava å¹¶å‘åŒ…ä¸­çš„é”ï¼Œéƒ½æ˜¯åŸºäºå®ƒå®ç°çš„ï¼‰ |  <code>LockSupport.unpark</code>                  |</p>
</li>
<li>
<p><strong>å®šæ—¶ç­‰å¾…ï¼ˆTimed waitingï¼‰</strong> - æ­¤çŠ¶æ€æ„å‘³ç€ï¼š<strong>æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’</strong>ã€‚</p>
<table>
<thead>
<tr>
<th>è¿›å…¥æ–¹æ³•</th>
<th>é€€å‡ºæ–¹æ³•</th>
</tr>
</thead>
</table>
<p>|  <code>Thread.sleep</code>  æ–¹æ³•                                          | æ—¶é—´ç»“æŸ                                        |<br>
| è·å¾—  <code>synchronized</code>  éšå¼é”çš„çº¿ç¨‹ï¼Œè°ƒç”¨è®¾ç½®äº† Timeout å‚æ•°çš„  <code>Object.wait</code>  æ–¹æ³• | æ—¶é—´ç»“æŸ /  <code>Object.notify</code>  /  <code>Object.notifyAll</code>  |<br>
| è®¾ç½®äº† Timeout å‚æ•°çš„  <code>Thread.join</code>  æ–¹æ³•                     | æ—¶é—´ç»“æŸ / è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•                 |<br>
|  <code>LockSupport.parkNanos</code>  æ–¹æ³•                                 |  <code>LockSupport.unpark</code>                             |<br>
|  <code>LockSupport.parkUntil</code>  æ–¹æ³•                                 |  <code>LockSupport.unpark</code>                             |</p>
</li>
<li>
<p><strong>ç»ˆæ­¢ (Terminated)</strong> - çº¿ç¨‹æ‰§è¡Œå®Œ  <code>run</code>  æ–¹æ³•ï¼Œæˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†  <code>run</code>  æ–¹æ³•ã€‚æ­¤çŠ¶æ€æ„å‘³ç€ï¼šçº¿ç¨‹ç»“æŸäº†ç”Ÿå‘½å‘¨æœŸã€‚</p>
</li>
</ul>
<h2 id="-590"><a class="markdownIt-Anchor" href="#-590">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_6-%E7%BA%BF%E7%A8%8B%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">#</a>6. çº¿ç¨‹å¸¸è§é—®é¢˜</h2>
<h3 id="-591"><a class="markdownIt-Anchor" href="#-591">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80.html#_6-1-sleep%E3%80%81yield%E3%80%81join-%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">#</a>6.1. sleepã€yieldã€join æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</h3>
<ul>
<li>
<pre><code>  yield
  <pre class="line-numbers language-none"><code class="language-none">
	 

	æ–¹æ³•

	- &#96;yield&#96; æ–¹æ³•ä¼š **è®©çº¿ç¨‹ä» &#96;Running&#96; çŠ¶æ€è½¬å…¥ &#96;Runnable&#96; çŠ¶æ€**ã€‚
	- å½“è°ƒç”¨äº† &#96;yield&#96; æ–¹æ³•åï¼Œåªæœ‰**ä¸å½“å‰çº¿ç¨‹ç›¸åŒæˆ–æ›´é«˜ä¼˜å…ˆçº§çš„&#96;Runnable&#96; çŠ¶æ€çº¿ç¨‹æ‰ä¼šè·å¾—æ‰§è¡Œçš„æœºä¼š**ã€‚

- &#96;&#96;&#96;
	sleep<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  æ–¹æ³•

  - `sleep` æ–¹æ³•ä¼š **è®©çº¿ç¨‹ä» `Running` çŠ¶æ€è½¬å…¥ `Waiting` çŠ¶æ€**ã€‚
  - `sleep` æ–¹æ³•éœ€è¦æŒ‡å®šç­‰å¾…çš„æ—¶é—´ï¼Œ**è¶…è¿‡ç­‰å¾…æ—¶é—´åï¼ŒJVM ä¼šå°†çº¿ç¨‹ä» `Waiting` çŠ¶æ€è½¬å…¥ `Runnable` çŠ¶æ€**ã€‚
  - å½“è°ƒç”¨äº† `sleep` æ–¹æ³•åï¼Œ**æ— è®ºä»€ä¹ˆä¼˜å…ˆçº§çš„çº¿ç¨‹éƒ½å¯ä»¥å¾—åˆ°æ‰§è¡Œæœºä¼š**ã€‚
  - `sleep` æ–¹æ³•ä¸ä¼šé‡Šæ”¾â€œé”æ ‡å¿—â€ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ‰ `synchronized` åŒæ­¥å—ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶ä¸èƒ½è®¿é—®å…±äº«æ•°æ®ã€‚

</code></pre>
</li>
<li>
<pre><code>  join
  <pre class="line-numbers language-none"><code class="language-none">
	- &#96;join&#96; æ–¹æ³•ä¼š **è®©çº¿ç¨‹ä» &#96;Running&#96; çŠ¶æ€è½¬å…¥ &#96;Waiting&#96; çŠ¶æ€**ã€‚
	- å½“è°ƒç”¨äº† &#96;join&#96; æ–¹æ³•åï¼Œ**å½“å‰çº¿ç¨‹å¿…é¡»ç­‰å¾…è°ƒç”¨ &#96;join&#96; æ–¹æ³•çš„çº¿ç¨‹ç»“æŸåæ‰èƒ½ç»§ç»­æ‰§è¡Œ**ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaçº¿ç¨‹åŸºç¡€.html#_6-2-ä¸ºä»€ä¹ˆ-sleep-å’Œ-yield-æ–¹æ³•æ˜¯é™æ€çš„)6.2. ä¸ºä»€ä¹ˆ sleep å’Œ yield æ–¹æ³•æ˜¯é™æ€çš„

&#96;Thread&#96; ç±»çš„ &#96;sleep&#96; å’Œ &#96;yield&#96; æ–¹æ³•å°†å¤„ç† &#96;Running&#96; çŠ¶æ€çš„çº¿ç¨‹ã€‚

æ‰€ä»¥åœ¨å…¶ä»–å¤„äºé &#96;Running&#96; çŠ¶æ€çš„çº¿ç¨‹ä¸Šæ‰§è¡Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›æ–¹æ³•æ˜¯é™æ€çš„ã€‚å®ƒä»¬å¯ä»¥åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¸­å·¥ä½œï¼Œå¹¶é¿å…ç¨‹åºå‘˜é”™è¯¯çš„è®¤ä¸ºå¯ä»¥åœ¨å…¶ä»–éè¿è¡Œçº¿ç¨‹è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaçº¿ç¨‹åŸºç¡€.html#_6-3-java-çº¿ç¨‹æ˜¯å¦æŒ‰ç…§çº¿ç¨‹ä¼˜å…ˆçº§ä¸¥æ ¼æ‰§è¡Œ)6.3. Java çº¿ç¨‹æ˜¯å¦æŒ‰ç…§çº¿ç¨‹ä¼˜å…ˆçº§ä¸¥æ ¼æ‰§è¡Œ

å³ä½¿è®¾ç½®äº†çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¹Ÿ**æ— æ³•ä¿è¯é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¸€å®šå…ˆæ‰§è¡Œ**ã€‚

åŸå› åœ¨äºçº¿ç¨‹ä¼˜å…ˆçº§ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œç„¶è€Œï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿæ”¯æŒçš„çº¿ç¨‹ä¼˜å…ˆçº§å¹¶ä¸ç›¸åŒï¼Œä¸èƒ½å¾ˆå¥½çš„å’Œ Java ä¸­çº¿ç¨‹ä¼˜å…ˆçº§ä¸€ä¸€å¯¹åº”ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaçº¿ç¨‹åŸºç¡€.html#_6-4-ä¸€ä¸ªçº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨-start-æ–¹æ³•ä¼šæ€æ ·)6.4. ä¸€ä¸ªçº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨ start()æ–¹æ³•ä¼šæ€æ ·

Java çš„çº¿ç¨‹æ˜¯ä¸å…è®¸å¯åŠ¨ä¸¤æ¬¡çš„ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨å¿…ç„¶ä¼šæŠ›å‡º IllegalThreadStateExceptionï¼Œè¿™æ˜¯ä¸€ç§è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¤šæ¬¡è°ƒç”¨ start è¢«è®¤ä¸ºæ˜¯ç¼–ç¨‹é”™è¯¯ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaçº¿ç¨‹åŸºç¡€.html#_6-5-start-å’Œ-run-æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«)6.5. &#96;start&#96; å’Œ &#96;run&#96; æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«

- &#96;run&#96; æ–¹æ³•æ˜¯çº¿ç¨‹çš„æ‰§è¡Œä½“ã€‚
- &#96;start&#96; æ–¹æ³•ä¼šå¯åŠ¨çº¿ç¨‹ï¼Œç„¶å JVM ä¼šè®©è¿™ä¸ªçº¿ç¨‹å»æ‰§è¡Œ &#96;run&#96; æ–¹æ³•ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaçº¿ç¨‹åŸºç¡€.html#_6-6-å¯ä»¥ç›´æ¥è°ƒç”¨-thread-ç±»çš„-run-æ–¹æ³•ä¹ˆ)6.6. å¯ä»¥ç›´æ¥è°ƒç”¨ &#96;Thread&#96; ç±»çš„ &#96;run&#96; æ–¹æ³•ä¹ˆ

- å¯ä»¥ã€‚ä½†æ˜¯å¦‚æœç›´æ¥è°ƒç”¨ &#96;Thread&#96; çš„ &#96;run&#96; æ–¹æ³•ï¼Œå®ƒçš„è¡Œä¸ºå°±ä¼šå’Œæ™®é€šçš„æ–¹æ³•ä¸€æ ·ã€‚
- ä¸ºäº†åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œå¿…é¡»ä½¿ç”¨ &#96;Thread&#96; çš„ &#96;start&#96; æ–¹æ³•ã€‚



---

# Java å¹¶å‘æ ¸å¿ƒæœºåˆ¶

&gt; **ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ [javacore(opens new window)](https:&#x2F;&#x2F;github.com&#x2F;dunwu&#x2F;javacore&#x2F;)**
&gt;
&gt; Java å¯¹äºå¹¶å‘çš„æ”¯æŒä¸»è¦æ±‡èšåœ¨ &#96;java.util.concurrent&#96;ï¼Œå³ J.U.Cã€‚è€Œ J.U.C çš„æ ¸å¿ƒæ˜¯ &#96;AQS&#96;ã€‚

- [1. J.U.C ç®€ä»‹](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#1-juc-ç®€ä»‹)
- \2. synchronized
	- [2.1. synchronized çš„åº”ç”¨](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#21-synchronized-çš„åº”ç”¨)
	- [2.2. synchronized çš„åŸç†](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#22-synchronized-çš„åŸç†)
	- [2.3. synchronized çš„ä¼˜åŒ–](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#23-synchronized-çš„ä¼˜åŒ–)
	- [2.4. synchronized çš„è¯¯åŒº](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#24-synchronized-çš„è¯¯åŒº)
- \3. volatile
	- [3.1. volatile çš„è¦ç‚¹](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#31-volatile-çš„è¦ç‚¹)
	- [3.2. volatile çš„åº”ç”¨](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#32-volatile-çš„åº”ç”¨)
	- [3.3. volatile çš„åŸç†](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#33-volatile-çš„åŸç†)
	- [3.4. volatile çš„é—®é¢˜](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#34-volatile-çš„é—®é¢˜)
- \4. CAS
	- [4.1. CAS çš„è¦ç‚¹](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#41-cas-çš„è¦ç‚¹)
	- [4.2. CAS çš„åº”ç”¨](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#42-cas-çš„åº”ç”¨)
	- [4.3. CAS çš„åŸç†](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#43-cas-çš„åŸç†)
	- [4.4. CAS çš„é—®é¢˜](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#44-cas-çš„é—®é¢˜)
- \5. ThreadLocal
	- [5.1. ThreadLocal çš„åº”ç”¨](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#51-threadlocal-çš„åº”ç”¨)
	- [5.2. ThreadLocal çš„åŸç†](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#52-threadlocal-çš„åŸç†)
	- [5.3. ThreadLocal çš„è¯¯åŒº](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#53-threadlocal-çš„è¯¯åŒº)
	- [5.4. InheritableThreadLocal](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#54-inheritablethreadlocal)
- [6. å‚è€ƒèµ„æ–™](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#6-å‚è€ƒèµ„æ–™)

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#_1-j-u-c-ç®€ä»‹)1. J.U.C ç®€ä»‹

Java çš„ &#96;java.util.concurrent&#96; åŒ…ï¼ˆç®€ç§° J.U.Cï¼‰ä¸­æä¾›äº†å¤§é‡å¹¶å‘å·¥å…·ç±»ï¼Œæ˜¯ Java å¹¶å‘èƒ½åŠ›çš„ä¸»è¦ä½“ç°ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯å…¨éƒ¨ï¼Œæœ‰éƒ¨åˆ†å¹¶å‘èƒ½åŠ›çš„æ”¯æŒåœ¨å…¶ä»–åŒ…ä¸­ï¼‰ã€‚ä»åŠŸèƒ½ä¸Šï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºï¼š

- åŸå­ç±» - å¦‚ï¼š&#96;AtomicInteger&#96;ã€&#96;AtomicIntegerArray&#96;ã€&#96;AtomicReference&#96;ã€&#96;AtomicStampedReference&#96; ç­‰ã€‚
- é” - å¦‚ï¼š&#96;ReentrantLock&#96;ã€&#96;ReentrantReadWriteLock&#96; ç­‰ã€‚
- å¹¶å‘å®¹å™¨ - å¦‚ï¼š&#96;ConcurrentHashMap&#96;ã€&#96;CopyOnWriteArrayList&#96;ã€&#96;CopyOnWriteArraySet&#96; ç­‰ã€‚
- é˜»å¡é˜Ÿåˆ— - å¦‚ï¼š&#96;ArrayBlockingQueue&#96;ã€&#96;LinkedBlockingQueue&#96; ç­‰ã€‚
- éé˜»å¡é˜Ÿåˆ— - å¦‚ï¼š &#96;ConcurrentLinkedQueue&#96; ã€&#96;LinkedTransferQueue&#96; ç­‰ã€‚
- &#96;Executor&#96; æ¡†æ¶ï¼ˆçº¿ç¨‹æ± ï¼‰- å¦‚ï¼š&#96;ThreadPoolExecutor&#96;ã€&#96;Executors&#96; ç­‰ã€‚

æˆ‘ä¸ªäººç†è§£ï¼ŒJava å¹¶å‘æ¡†æ¶å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å±‚æ¬¡ã€‚

![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;dunwu&#x2F;images&#x2F;dev&#x2F;cs&#x2F;java&#x2F;javacore&#x2F;concurrent&#x2F;java-concurrent-basic-mechanism.png)

ç”± Java å¹¶å‘æ¡†æ¶å›¾ä¸éš¾çœ‹å‡ºï¼ŒJ.U.C åŒ…ä¸­çš„å·¥å…·ç±»æ˜¯åŸºäº &#96;synchronized&#96;ã€&#96;volatile&#96;ã€&#96;CAS&#96;ã€&#96;ThreadLocal&#96; è¿™æ ·çš„å¹¶å‘æ ¸å¿ƒæœºåˆ¶æ‰“é€ çš„ã€‚æ‰€ä»¥ï¼Œè¦æƒ³æ·±å…¥ç†è§£ J.U.C å·¥å…·ç±»çš„ç‰¹æ€§ã€ä¸ºä»€ä¹ˆå…·æœ‰è¿™æ ·é‚£æ ·çš„ç‰¹æ€§ï¼Œå°±å¿…é¡»å…ˆç†è§£è¿™äº›æ ¸å¿ƒæœºåˆ¶ã€‚

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#_2-synchronized)2. synchronized

&gt; &#96;synchronized&#96; æ˜¯ Java ä¸­çš„å…³é”®å­—ï¼Œæ˜¯ **åˆ©ç”¨é”çš„æœºåˆ¶æ¥å®ç°äº’æ–¥åŒæ­¥çš„**ã€‚
&gt;
&gt; **&#96;synchronized&#96; å¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—**ã€‚
&gt;
&gt; å¦‚æœä¸éœ€è¦ &#96;Lock&#96; ã€&#96;ReadWriteLock&#96; æ‰€æä¾›çš„é«˜çº§åŒæ­¥ç‰¹æ€§ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ &#96;synchronized&#96; ï¼Œç†ç”±å¦‚ä¸‹ï¼š
&gt;
&gt; - Java 1.6 ä»¥åï¼Œ&#96;synchronized&#96; åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå…¶æ€§èƒ½å·²ç»ä¸ &#96;Lock&#96; ã€&#96;ReadWriteLock&#96; åŸºæœ¬ä¸ŠæŒå¹³ã€‚ä»è¶‹åŠ¿æ¥çœ‹ï¼ŒJava æœªæ¥ä»å°†ç»§ç»­ä¼˜åŒ– &#96;synchronized&#96; ï¼Œè€Œä¸æ˜¯ &#96;ReentrantLock&#96; ã€‚
&gt; - &#96;ReentrantLock&#96; æ˜¯ Oracle JDK çš„ APIï¼Œåœ¨å…¶ä»–ç‰ˆæœ¬çš„ JDK ä¸­ä¸ä¸€å®šæ”¯æŒï¼›è€Œ &#96;synchronized&#96; æ˜¯ JVM çš„å†…ç½®ç‰¹æ€§ï¼Œæ‰€æœ‰ JDK ç‰ˆæœ¬éƒ½æä¾›æ”¯æŒã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#_2-1-synchronized-çš„åº”ç”¨)2.1. synchronized çš„åº”ç”¨

&#96;synchronized&#96; æœ‰ 3 ç§åº”ç”¨æ–¹å¼ï¼š

- **åŒæ­¥å®ä¾‹æ–¹æ³•** - å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡
- **åŒæ­¥é™æ€æ–¹æ³•** - å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„ &#96;Class&#96; å¯¹è±¡
- **åŒæ­¥ä»£ç å—** - å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯ &#96;synchonized&#96; æ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡

&gt; è¯´æ˜ï¼š
&gt;
&gt; ç±»ä¼¼ &#96;Vector&#96;ã€&#96;Hashtable&#96; è¿™ç±»åŒæ­¥ç±»ï¼Œå°±æ˜¯ä½¿ç”¨ &#96;synchonized&#96; ä¿®é¥°å…¶é‡è¦æ–¹æ³•ï¼Œæ¥ä¿è¯å…¶çº¿ç¨‹å®‰å…¨ã€‚
&gt;
&gt; äº‹å®ä¸Šï¼Œè¿™ç±»åŒæ­¥å®¹å™¨ä¹Ÿéç»å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œå½“æ‰§è¡Œè¿­ä»£å™¨éå†ï¼Œæ ¹æ®æ¡ä»¶åˆ é™¤å…ƒç´ è¿™ç§åœºæ™¯ä¸‹ï¼Œå°±å¯èƒ½å‡ºç°çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µã€‚æ­¤å¤–ï¼ŒJava 1.6 é’ˆå¯¹ &#96;synchonized&#96; è¿›è¡Œä¼˜åŒ–å‰ï¼Œç”±äºé˜»å¡ï¼Œå…¶æ€§èƒ½ä¸é«˜ã€‚
&gt;
&gt; ç»¼ä¸Šï¼Œè¿™ç±»åŒæ­¥å®¹å™¨ï¼Œåœ¨ç°ä»£ Java ç¨‹åºä¸­ï¼Œå·²ç»æ¸æ¸ä¸ç”¨äº†ã€‚

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.html#åŒæ­¥å®ä¾‹æ–¹æ³•)åŒæ­¥å®ä¾‹æ–¹æ³•

âŒ é”™è¯¯ç¤ºä¾‹ - æœªåŒæ­¥çš„ç¤ºä¾‹

&#96;&#96;&#96;java
public class NoSynchronizedDemo implements Runnable &#123;

    public static final int MAX &#x3D; 100000;

    private static int count &#x3D; 0;

    public static void main(String[] args) throws InterruptedException &#123;
        NoSynchronizedDemo instance &#x3D; new NoSynchronizedDemo();
        Thread t1 &#x3D; new Thread(instance);
        Thread t2 &#x3D; new Thread(instance);
        t1.start();
        t2.start();
        t1.join();
        t2.join();
        System.out.println(count);
    &#125;

    @Override
    public void run() &#123;
        for (int i &#x3D; 0; i &lt; MAX; i++) &#123;
            increase();
        &#125;
    &#125;

    public void increase() &#123;
        count++;
    &#125;

&#125;
&#x2F;&#x2F; è¾“å‡ºç»“æœ: å°äº 200000 çš„éšæœºæ•°å­—<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>Java å®ä¾‹æ–¹æ³•åŒæ­¥æ˜¯åŒæ­¥åœ¨æ‹¥æœ‰è¯¥æ–¹æ³•çš„å¯¹è±¡ä¸Šã€‚è¿™æ ·ï¼Œæ¯ä¸ªå®ä¾‹å…¶æ–¹æ³•åŒæ­¥éƒ½åŒæ­¥åœ¨ä¸åŒçš„å¯¹è±¡ä¸Šï¼Œå³è¯¥æ–¹æ³•æ‰€å±çš„å®ä¾‹ã€‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨å®ä¾‹æ–¹æ³•åŒæ­¥å—ä¸­è¿è¡Œã€‚å¦‚æœæœ‰å¤šä¸ªå®ä¾‹å­˜åœ¨ï¼Œé‚£ä¹ˆä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡å¯ä»¥åœ¨ä¸€ä¸ªå®ä¾‹åŒæ­¥å—ä¸­æ‰§è¡Œæ“ä½œã€‚ä¸€ä¸ªå®ä¾‹ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedDemo</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SynchronizedDemo</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SynchronizedDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * synchronized ä¿®é¥°æ™®é€šæ–¹æ³•
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘é”™è¯¯ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> balance<span class="token punctuation">;</span>
  <span class="token comment">// è½¬è´¦</span>
  <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span>
      <span class="token class-name">Account</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> amt<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">></span> amt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">-=</span> amt<span class="token punctuation">;</span>
      target<span class="token punctuation">.</span>balance <span class="token operator">+=</span> amt<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä¸´ç•ŒåŒºå†…æœ‰ä¸¤ä¸ªèµ„æºï¼Œåˆ†åˆ«æ˜¯è½¬å‡ºè´¦æˆ·çš„ä½™é¢ this.balance å’Œè½¬å…¥è´¦æˆ·çš„ä½™é¢ target.balanceï¼Œå¹¶ä¸”ç”¨çš„æ˜¯ä¸€æŠŠé” thisï¼Œç¬¦åˆæˆ‘ä»¬å‰é¢æåˆ°çš„ï¼Œå¤šä¸ªèµ„æºå¯ä»¥ç”¨ä¸€æŠŠé”æ¥ä¿æŠ¤ï¼Œè¿™çœ‹ä¸Šå»å®Œå…¨æ­£ç¡®å‘€ã€‚çœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿå¯æƒœï¼Œè¿™ä¸ªæ–¹æ¡ˆä»…ä»…æ˜¯çœ‹ä¼¼æ­£ç¡®ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>é—®é¢˜å°±å‡ºåœ¨ this è¿™æŠŠé”ä¸Šï¼Œthis è¿™æŠŠé”å¯ä»¥ä¿æŠ¤è‡ªå·±çš„ä½™é¢ this.balanceï¼Œå´ä¿æŠ¤ä¸äº†åˆ«äººçš„ä½™é¢ target.balanceï¼Œå°±åƒä½ ä¸èƒ½ç”¨è‡ªå®¶çš„é”æ¥ä¿æŠ¤åˆ«äººå®¶çš„èµ„äº§ï¼Œä¹Ÿä¸èƒ½ç”¨è‡ªå·±çš„ç¥¨æ¥ä¿æŠ¤åˆ«äººçš„åº§ä½ä¸€æ ·ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200701135257.png" alt="img"></p>
<p>åº”è¯¥ä¿è¯ä½¿ç”¨çš„<strong>é”èƒ½è¦†ç›–æ‰€æœ‰å—ä¿æŠ¤èµ„æº</strong>ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ­£ç¡®å§¿åŠ¿</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token class-name">Object</span> lockï¼›
  <span class="token keyword">private</span> <span class="token keyword">int</span> balance<span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åˆ›å»º Account æ—¶ä¼ å…¥åŒä¸€ä¸ª lock å¯¹è±¡</span>
  <span class="token keyword">public</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token class-name">Object</span> lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>lock <span class="token operator">=</span> lock<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// è½¬è´¦</span>
  <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Account</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> amt<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// æ­¤å¤„æ£€æŸ¥æ‰€æœ‰å¯¹è±¡å…±äº«çš„é”</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">></span> amt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">-=</span> amt<span class="token punctuation">;</span>
        target<span class="token punctuation">.</span>balance <span class="token operator">+=</span> amt<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™ä¸ªåŠæ³•ç¡®å®èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¯æœ‰ç‚¹å°ç‘•ç–µï¼Œå®ƒè¦æ±‚åœ¨åˆ›å»º Account å¯¹è±¡çš„æ—¶å€™å¿…é¡»ä¼ å…¥åŒä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœåˆ›å»º Account å¯¹è±¡æ—¶ï¼Œä¼ å…¥çš„ lock ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å¯å°±æƒ¨äº†ï¼Œä¼šå‡ºç°é”è‡ªå®¶é—¨æ¥ä¿æŠ¤ä»–å®¶èµ„äº§çš„è’å”äº‹ã€‚åœ¨çœŸå®çš„é¡¹ç›®åœºæ™¯ä¸­ï¼Œåˆ›å»º Account å¯¹è±¡çš„ä»£ç å¾ˆå¯èƒ½åˆ†æ•£åœ¨å¤šä¸ªå·¥ç¨‹ä¸­ï¼Œä¼ å…¥å…±äº«çš„ lock çœŸçš„å¾ˆéš¾ã€‚</p>
<p>ä¸Šé¢çš„æ–¹æ¡ˆç¼ºä¹å®è·µçš„å¯è¡Œæ€§ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¥½çš„æ–¹æ¡ˆã€‚è¿˜çœŸæœ‰ï¼Œå°±æ˜¯<strong>ç”¨ Account.class ä½œä¸ºå…±äº«çš„é”</strong>ã€‚Account.class æ˜¯æ‰€æœ‰ Account å¯¹è±¡å…±äº«çš„ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡æ˜¯ Java è™šæ‹Ÿæœºåœ¨åŠ è½½ Account ç±»çš„æ—¶å€™åˆ›å»ºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ç”¨æ‹…å¿ƒå®ƒçš„å”¯ä¸€æ€§ã€‚ä½¿ç”¨ Account.class ä½œä¸ºå…±äº«çš„é”ï¼Œæˆ‘ä»¬å°±æ— éœ€åœ¨åˆ›å»º Account å¯¹è±¡æ—¶ä¼ å…¥äº†ï¼Œä»£ç æ›´ç®€å•ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ­£ç¡®å§¿åŠ¿</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> balance<span class="token punctuation">;</span>
  <span class="token comment">// è½¬è´¦</span>
  <span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Account</span> target<span class="token punctuation">,</span> <span class="token keyword">int</span> amt<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Account</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">></span> amt<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>balance <span class="token operator">-=</span> amt<span class="token punctuation">;</span>
        target<span class="token punctuation">.</span>balance <span class="token operator">+=</span> amt<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-592"><a class="markdownIt-Anchor" href="#-592">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%90%8C%E6%AD%A5%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95">#</a>åŒæ­¥é™æ€æ–¹æ³•</h4>
<p>é™æ€æ–¹æ³•çš„åŒæ­¥æ˜¯æŒ‡åŒæ­¥åœ¨è¯¥æ–¹æ³•æ‰€åœ¨çš„ç±»å¯¹è±¡ä¸Šã€‚å› ä¸ºåœ¨ JVM ä¸­ä¸€ä¸ªç±»åªèƒ½å¯¹åº”ä¸€ä¸ªç±»å¯¹è±¡ï¼Œæ‰€ä»¥åŒæ—¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒä¸€ä¸ªç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•ã€‚</p>
<p>å¯¹äºä¸åŒç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œæ¯ä¸ªç±»ä¸­çš„é™æ€åŒæ­¥æ–¹æ³•è€Œæ— éœ€ç­‰å¾…ã€‚ä¸ç®¡ç±»ä¸­çš„å“ªä¸ªé™æ€åŒæ­¥æ–¹æ³•è¢«è°ƒç”¨ï¼Œä¸€ä¸ªç±»åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedDemo2</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SynchronizedDemo2</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SynchronizedDemo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * synchronized ä¿®é¥°é™æ€æ–¹æ³•
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-593"><a class="markdownIt-Anchor" href="#-593">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%9D%97">#</a>åŒæ­¥ä»£ç å—</h4>
<p>æœ‰æ—¶ä½ ä¸éœ€è¦åŒæ­¥æ•´ä¸ªæ–¹æ³•ï¼Œè€Œæ˜¯åŒæ­¥æ–¹æ³•ä¸­çš„ä¸€éƒ¨åˆ†ã€‚Java å¯ä»¥å¯¹æ–¹æ³•çš„ä¸€éƒ¨åˆ†è¿›è¡ŒåŒæ­¥ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ThreadSafe</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedDemo05</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SynchronizedDemo05</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SynchronizedDemo05</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * synchronized ä¿®é¥°ä»£ç å—
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ³¨æ„ Java åŒæ­¥å—æ„é€ å™¨ç”¨æ‹¬å·å°†å¯¹è±¡æ‹¬èµ·æ¥ã€‚åœ¨ä¸Šä¾‹ä¸­ï¼Œä½¿ç”¨äº†  <code>this</code> ï¼Œå³ä¸ºè°ƒç”¨  <code>increase</code>  æ–¹æ³•çš„å®ä¾‹æœ¬èº«ã€‚ç”¨æ‹¬å·æ‹¬èµ·æ¥çš„å¯¹è±¡å«åšç›‘è§†å™¨å¯¹è±¡ã€‚ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿåœ¨åŒæ­¥äºåŒä¸€ä¸ªç›‘è§†å™¨å¯¹è±¡çš„ Java æ–¹æ³•å†…æ‰§è¡Œã€‚</p>
<p>å¦‚æœæ˜¯é™æ€æ–¹æ³•ï¼Œå°±ä¸èƒ½ç”¨ this å¯¹è±¡ä½œä¸ºç›‘è§†å™¨å¯¹è±¡äº†ï¼Œè€Œæ˜¯ä½¿ç”¨  <code>Class</code>  å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronizedDemo3</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAX <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SynchronizedDemo3</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SynchronizedDemo3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * synchronized ä¿®é¥°ä»£ç å—
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">SynchronizedDemo3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-594"><a class="markdownIt-Anchor" href="#-594">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_2-2-synchronized-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>2.2. synchronized çš„åŸç†</h3>
<p><strong> <code>synchronized</code>  ä»£ç å—æ˜¯ç”±ä¸€å¯¹  <code>monitorenter</code>  å’Œ  <code>monitorexit</code>  æŒ‡ä»¤å®ç°çš„ï¼Œ <code>Monitor</code>  å¯¹è±¡æ˜¯åŒæ­¥çš„åŸºæœ¬å®ç°å•å…ƒ</strong>ã€‚åœ¨ Java 6 ä¹‹å‰ï¼Œ <code>Monitor</code>  çš„å®ç°å®Œå…¨æ˜¯ä¾é æ“ä½œç³»ç»Ÿå†…éƒ¨çš„äº’æ–¥é”ï¼Œå› ä¸ºéœ€è¦è¿›è¡Œç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œæ‰€ä»¥åŒæ­¥æ“ä½œæ˜¯ä¸€ä¸ªæ— å·®åˆ«çš„é‡é‡çº§æ“ä½œã€‚</p>
<p>å¦‚æœ  <code>synchronized</code>  æ˜ç¡®åˆ¶å®šäº†å¯¹è±¡å‚æ•°ï¼Œé‚£å°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼›å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œé‚£å°±æ ¹æ®  <code>synchronized</code>  ä¿®é¥°çš„æ˜¯å®ä¾‹æ–¹æ³•è¿˜æ˜¯é™æ€æ–¹æ³•ï¼Œå»å¯¹å¯¹åº”çš„å¯¹è±¡å®ä¾‹æˆ–  <code>Class</code>  å¯¹è±¡æ¥ä½œä¸ºé”å¯¹è±¡ã€‚</p>
<p><code>synchronized</code>  åŒæ­¥å—å¯¹åŒä¸€çº¿ç¨‹æ¥è¯´æ˜¯å¯é‡å…¥çš„ï¼Œä¸ä¼šå‡ºç°é”æ­»é—®é¢˜ã€‚</p>
<p><code>synchronized</code>  åŒæ­¥å—æ˜¯äº’æ–¥çš„ï¼Œå³å·²è¿›å…¥çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆå‰ï¼Œä¼šé˜»å¡å…¶ä»–è¯•å›¾è¿›å…¥çš„çº¿ç¨‹ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      lock<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token comment">// ä¸Šé¢çš„ Java ä»£ç å°†ç¼–è¯‘ä¸ºä¸‹é¢çš„å­—èŠ‚ç </span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
       <span class="token number">0</span><span class="token operator">:</span> aload_1
       <span class="token number">1</span><span class="token operator">:</span> dup
       <span class="token number">2</span><span class="token operator">:</span> astore_2
       <span class="token number">3</span><span class="token operator">:</span> monitorenter
       <span class="token number">4</span><span class="token operator">:</span> aload_1
       <span class="token number">5</span><span class="token operator">:</span> invokevirtual java<span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">.</span>hashCode<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">I</span>
       <span class="token number">8</span><span class="token operator">:</span> pop
       <span class="token number">9</span><span class="token operator">:</span> aload_2
      <span class="token number">10</span><span class="token operator">:</span> monitorexit
      <span class="token number">11</span><span class="token operator">:</span> <span class="token keyword">goto</span>          <span class="token number">19</span>
      <span class="token number">14</span><span class="token operator">:</span> astore_3
      <span class="token number">15</span><span class="token operator">:</span> aload_2
      <span class="token number">16</span><span class="token operator">:</span> monitorexit
      <span class="token number">17</span><span class="token operator">:</span> aload_3
      <span class="token number">18</span><span class="token operator">:</span> athrow
      <span class="token number">19</span><span class="token operator">:</span> <span class="token keyword">return</span>
    <span class="token class-name">Exception</span> table<span class="token operator">:</span>
       from    <span class="token keyword">to</span>  <span class="token namespace">target</span> type
           <span class="token number">4</span>    <span class="token number">11</span>    <span class="token number">14</span>   any
          <span class="token number">14</span>    <span class="token number">17</span>    <span class="token number">14</span>   any<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-595"><a class="markdownIt-Anchor" href="#-595">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%9D%97-2">#</a>åŒæ­¥ä»£ç å—</h4>
<p><code>synchronized</code>  åœ¨ä¿®é¥°åŒæ­¥ä»£ç å—æ—¶ï¼Œæ˜¯ç”±  <code>monitorenter</code>  å’Œ  <code>monitorexit</code>  æŒ‡ä»¤æ¥å®ç°åŒæ­¥çš„ã€‚è¿›å…¥  <code>monitorenter</code>  æŒ‡ä»¤åï¼Œçº¿ç¨‹å°†æŒæœ‰  <code>Monitor</code>  å¯¹è±¡ï¼Œé€€å‡º  <code>monitorenter</code>  æŒ‡ä»¤åï¼Œçº¿ç¨‹å°†é‡Šæ”¾è¯¥  <code>Monitor</code>  å¯¹è±¡ã€‚</p>
<h4 id="-596"><a class="markdownIt-Anchor" href="#-596">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95">#</a>åŒæ­¥æ–¹æ³•</h4>
<p><code>synchronized</code>  ä¿®é¥°åŒæ­¥æ–¹æ³•æ—¶ï¼Œä¼šè®¾ç½®ä¸€ä¸ª  <code>ACC_SYNCHRONIZED</code>  æ ‡å¿—ã€‚å½“æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦è¢«è®¾ç½®  <code>ACC_SYNCHRONIZED</code>  è®¿é—®æ ‡å¿—ã€‚å¦‚æœè®¾ç½®äº†è¯¥æ ‡å¿—ï¼Œæ‰§è¡Œçº¿ç¨‹å°†å…ˆæŒæœ‰  <code>Monitor</code>  å¯¹è±¡ï¼Œç„¶åå†æ‰§è¡Œæ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•è¿è¡ŒæœŸé—´ï¼Œå…¶å®ƒçº¿ç¨‹å°†æ— æ³•è·å–åˆ°è¯¥  <code>Mointor</code>  å¯¹è±¡ï¼Œå½“æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå†é‡Šæ”¾è¯¥  <code>Monitor</code>  å¯¹è±¡ã€‚</p>
<h4 id="-597"><a class="markdownIt-Anchor" href="#-597">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#monitor">#</a>Monitor</h4>
<p>æ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ª  <code>Monitor</code> ï¼Œ <code>Monitor</code>  å¯ä»¥å’Œå¯¹è±¡ä¸€èµ·åˆ›å»ºã€é”€æ¯ã€‚ <code>Monitor</code>  æ˜¯ç”±  <code>ObjectMonitor</code>  å®ç°ï¼Œè€Œ  <code>ObjectMonitor</code>  æ˜¯ç”± C++ çš„  <code>ObjectMonitor.hpp</code>  æ–‡ä»¶å®ç°ã€‚</p>
<p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€æ®µåŒæ­¥ä»£ç æ—¶ï¼Œå¤šä¸ªçº¿ç¨‹ä¼šå…ˆè¢«å­˜æ”¾åœ¨ EntryList é›†åˆä¸­ï¼Œå¤„äº block çŠ¶æ€çš„çº¿ç¨‹ï¼Œéƒ½ä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨ã€‚æ¥ä¸‹æ¥å½“çº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„ Monitor æ—¶ï¼ŒMonitor æ˜¯ä¾é åº•å±‚æ“ä½œç³»ç»Ÿçš„ Mutex Lock æ¥å®ç°äº’æ–¥çš„ï¼Œçº¿ç¨‹ç”³è¯· Mutex æˆåŠŸï¼Œåˆ™æŒæœ‰è¯¥ Mutexï¼Œå…¶å®ƒçº¿ç¨‹å°†æ— æ³•è·å–åˆ°è¯¥ Mutexã€‚</p>
<p>å¦‚æœçº¿ç¨‹è°ƒç”¨ wait () æ–¹æ³•ï¼Œå°±ä¼šé‡Šæ”¾å½“å‰æŒæœ‰çš„ Mutexï¼Œå¹¶ä¸”è¯¥çº¿ç¨‹ä¼šè¿›å…¥ WaitSet é›†åˆä¸­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è¢«å”¤é†’ã€‚å¦‚æœå½“å‰çº¿ç¨‹é¡ºåˆ©æ‰§è¡Œå®Œæ–¹æ³•ï¼Œä¹Ÿå°†é‡Šæ”¾ Mutexã€‚</p>
<h3 id="-598"><a class="markdownIt-Anchor" href="#-598">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_2-3-synchronized-%E7%9A%84%E4%BC%98%E5%8C%96">#</a>2.3. synchronized çš„ä¼˜åŒ–</h3>
<blockquote>
<p><strong>Java 1.6 ä»¥åï¼Œ <code>synchronized</code>  åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå…¶æ€§èƒ½å·²ç»ä¸  <code>Lock</code>  ã€ <code>ReadWriteLock</code>  åŸºæœ¬ä¸ŠæŒå¹³</strong>ã€‚</p>
</blockquote>
<h4 id="-599"><a class="markdownIt-Anchor" href="#-599">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#java-%E5%AF%B9%E8%B1%A1%E5%A4%B4">#</a>Java å¯¹è±¡å¤´</h4>
<p>åœ¨ JDK1.6 JVM ä¸­ï¼Œå¯¹è±¡å®ä¾‹åœ¨å †å†…å­˜ä¸­è¢«åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šå¯¹è±¡å¤´ã€å®ä¾‹æ•°æ®å’Œå¯¹é½å¡«å……ã€‚å…¶ä¸­ Java å¯¹è±¡å¤´ç”± Mark Wordã€æŒ‡å‘ç±»çš„æŒ‡é’ˆä»¥åŠæ•°ç»„é•¿åº¦ä¸‰éƒ¨åˆ†ç»„æˆã€‚</p>
<p>Mark Word è®°å½•äº†å¯¹è±¡å’Œé”æœ‰å…³çš„ä¿¡æ¯ã€‚Mark Word åœ¨ 64 ä½ JVM ä¸­çš„é•¿åº¦æ˜¯ 64bitï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·çœ‹ä¸‹ 64 ä½ JVM çš„å­˜å‚¨ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200629191250.png" alt="img"></p>
<p>é”å‡çº§åŠŸèƒ½ä¸»è¦ä¾èµ–äº Mark Word ä¸­çš„é”æ ‡å¿—ä½å’Œæ˜¯å¦åå‘é”æ ‡å¿—ä½ï¼Œ <code>synchronized</code>  åŒæ­¥é”å°±æ˜¯ä»åå‘é”å¼€å§‹çš„ï¼Œéšç€ç«äº‰è¶Šæ¥è¶Šæ¿€çƒˆï¼Œåå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œæœ€ç»ˆå‡çº§åˆ°é‡é‡çº§é”ã€‚</p>
<p>Java 1.6 å¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”ï¼Œä»è€Œè®©  <code>synchronized</code>  æ‹¥æœ‰äº†å››ä¸ªçŠ¶æ€ï¼š</p>
<ul>
<li><strong>æ— é”çŠ¶æ€ï¼ˆunlockedï¼‰</strong></li>
<li><strong>åå‘é”çŠ¶æ€ï¼ˆbiasbleï¼‰</strong></li>
<li><strong>è½»é‡çº§é”çŠ¶æ€ï¼ˆlightweight lockedï¼‰</strong></li>
<li><strong>é‡é‡çº§é”çŠ¶æ€ï¼ˆinflatedï¼‰</strong></li>
</ul>
<p>å½“ JVM æ£€æµ‹åˆ°ä¸åŒçš„ç«äº‰çŠ¶å†µæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°é€‚åˆçš„é”å®ç°ã€‚</p>
<p>å½“æ²¡æœ‰ç«äº‰å‡ºç°æ—¶ï¼Œé»˜è®¤ä¼šä½¿ç”¨åå‘é”ã€‚JVM ä¼šåˆ©ç”¨ CAS æ“ä½œï¼ˆcompare and swapï¼‰ï¼Œåœ¨å¯¹è±¡å¤´ä¸Šçš„ Mark Word éƒ¨åˆ†è®¾ç½®çº¿ç¨‹ IDï¼Œä»¥è¡¨ç¤ºè¿™ä¸ªå¯¹è±¡åå‘äºå½“å‰çº¿ç¨‹ï¼Œæ‰€ä»¥å¹¶ä¸æ¶‰åŠçœŸæ­£çš„äº’æ–¥é”ã€‚è¿™æ ·åšçš„å‡è®¾æ˜¯åŸºäºåœ¨å¾ˆå¤šåº”ç”¨åœºæ™¯ä¸­ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸­æœ€å¤šä¼šè¢«ä¸€ä¸ªçº¿ç¨‹é”å®šï¼Œä½¿ç”¨åæ–œé”å¯ä»¥é™ä½æ— ç«äº‰å¼€é”€ã€‚</p>
<p>å¦‚æœæœ‰å¦å¤–çš„çº¿ç¨‹è¯•å›¾é”å®šæŸä¸ªå·²ç»è¢«åæ–œè¿‡çš„å¯¹è±¡ï¼ŒJVM å°±éœ€è¦æ’¤é”€ï¼ˆrevokeï¼‰åå‘é”ï¼Œå¹¶åˆ‡æ¢åˆ°è½»é‡çº§é”å®ç°ã€‚è½»é‡çº§é”ä¾èµ– CAS æ“ä½œ Mark Word æ¥è¯•å›¾è·å–é”ï¼Œå¦‚æœé‡è¯•æˆåŠŸï¼Œå°±ä½¿ç”¨æ™®é€šçš„è½»é‡çº§é”ï¼›å¦åˆ™ï¼Œè¿›ä¸€æ­¥å‡çº§ä¸ºé‡é‡çº§é”ã€‚</p>
<h4 id="-600"><a class="markdownIt-Anchor" href="#-600">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%81%8F%E5%90%91%E9%94%81">#</a>åå‘é”</h4>
<p>åå‘é”çš„æ€æƒ³æ˜¯åå‘äº<strong>ç¬¬ä¸€ä¸ªè·å–é”å¯¹è±¡çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹åœ¨ä¹‹åè·å–è¯¥é”å°±ä¸å†éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œç”šè‡³è¿ CAS æ“ä½œä¹Ÿä¸å†éœ€è¦</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200604105151.png" alt="img"></p>
<h4 id="-601"><a class="markdownIt-Anchor" href="#-601">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81">#</a>è½»é‡çº§é”</h4>
<p><strong>è½»é‡çº§é”</strong>æ˜¯ç›¸å¯¹äºä¼ ç»Ÿçš„é‡é‡çº§é”è€Œè¨€ï¼Œå®ƒ <strong>ä½¿ç”¨ CAS æ“ä½œæ¥é¿å…é‡é‡çº§é”ä½¿ç”¨äº’æ–¥é‡çš„å¼€é”€</strong>ã€‚å¯¹äºç»å¤§éƒ¨åˆ†çš„é”ï¼Œåœ¨æ•´ä¸ªåŒæ­¥å‘¨æœŸå†…éƒ½æ˜¯ä¸å­˜åœ¨ç«äº‰çš„ï¼Œå› æ­¤ä¹Ÿå°±ä¸éœ€è¦éƒ½ä½¿ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ï¼Œå¯ä»¥å…ˆé‡‡ç”¨ CAS æ“ä½œè¿›è¡ŒåŒæ­¥ï¼Œå¦‚æœ CAS å¤±è´¥äº†å†æ”¹ç”¨äº’æ–¥é‡è¿›è¡ŒåŒæ­¥ã€‚</p>
<p>å½“å°è¯•è·å–ä¸€ä¸ªé”å¯¹è±¡æ—¶ï¼Œå¦‚æœé”å¯¹è±¡æ ‡è®°ä¸º  <code>0|01</code> ï¼Œè¯´æ˜é”å¯¹è±¡çš„é”æœªé”å®šï¼ˆunlockedï¼‰çŠ¶æ€ã€‚æ­¤æ—¶è™šæ‹Ÿæœºåœ¨å½“å‰çº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆä¸­åˆ›å»º Lock Recordï¼Œç„¶åä½¿ç”¨ CAS æ“ä½œå°†å¯¹è±¡çš„ Mark Word æ›´æ–°ä¸º Lock Record æŒ‡é’ˆã€‚å¦‚æœ CAS æ“ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è·å–äº†è¯¥å¯¹è±¡ä¸Šçš„é”ï¼Œå¹¶ä¸”å¯¹è±¡çš„ Mark Word çš„é”æ ‡è®°å˜ä¸º 00ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡å¤„äºè½»é‡çº§é”çŠ¶æ€ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200604105248.png" alt="img"></p>
<h4 id="-602"><a class="markdownIt-Anchor" href="#-602">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E9%94%81%E6%B6%88%E9%99%A4-%E9%94%81%E7%B2%97%E5%8C%96">#</a>é”æ¶ˆé™¤ / é”ç²—åŒ–</h4>
<p>é™¤äº†é”å‡çº§ä¼˜åŒ–ï¼ŒJava è¿˜ä½¿ç”¨äº†ç¼–è¯‘å™¨å¯¹é”è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p><strong>ï¼ˆ1ï¼‰é”æ¶ˆé™¤</strong></p>
<p><strong>é”æ¶ˆé™¤æ˜¯æŒ‡å¯¹äºè¢«æ£€æµ‹å‡ºä¸å¯èƒ½å­˜åœ¨ç«äº‰çš„å…±äº«æ•°æ®çš„é”è¿›è¡Œæ¶ˆé™¤</strong>ã€‚</p>
<p>JIT ç¼–è¯‘å™¨åœ¨åŠ¨æ€ç¼–è¯‘åŒæ­¥å—çš„æ—¶å€™ï¼Œå€ŸåŠ©äº†ä¸€ç§è¢«ç§°ä¸ºé€ƒé€¸åˆ†æçš„æŠ€æœ¯ï¼Œæ¥åˆ¤æ–­åŒæ­¥å—ä½¿ç”¨çš„é”å¯¹è±¡æ˜¯å¦åªèƒ½å¤Ÿè¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œè€Œæ²¡æœ‰è¢«å‘å¸ƒåˆ°å…¶å®ƒçº¿ç¨‹ã€‚</p>
<p>ç¡®è®¤æ˜¯çš„è¯ï¼Œé‚£ä¹ˆ JIT ç¼–è¯‘å™¨åœ¨ç¼–è¯‘è¿™ä¸ªåŒæ­¥å—çš„æ—¶å€™ä¸ä¼šç”Ÿæˆ synchronized æ‰€è¡¨ç¤ºçš„é”çš„ç”³è¯·ä¸é‡Šæ”¾çš„æœºå™¨ç ï¼Œå³æ¶ˆé™¤äº†é”çš„ä½¿ç”¨ã€‚åœ¨ Java7 ä¹‹åçš„ç‰ˆæœ¬å°±ä¸éœ€è¦æ‰‹åŠ¨é…ç½®äº†ï¼Œè¯¥æ“ä½œå¯ä»¥è‡ªåŠ¨å®ç°ã€‚</p>
<p>å¯¹äºä¸€äº›çœ‹èµ·æ¥æ²¡æœ‰åŠ é”çš„ä»£ç ï¼Œå…¶å®éšå¼çš„åŠ äº†å¾ˆå¤šé”ã€‚ä¾‹å¦‚ä¸‹é¢çš„å­—ç¬¦ä¸²æ‹¼æ¥ä»£ç å°±éšå¼åŠ äº†é”ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">concatString</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">,</span> <span class="token class-name">String</span> s3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> s1 <span class="token operator">+</span> s2 <span class="token operator">+</span> s3<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>String</code>  æ˜¯ä¸€ä¸ªä¸å¯å˜çš„ç±»ï¼Œç¼–è¯‘å™¨ä¼šå¯¹ String çš„æ‹¼æ¥è‡ªåŠ¨ä¼˜åŒ–ã€‚åœ¨ Java 1.5 ä¹‹å‰ï¼Œä¼šè½¬åŒ–ä¸º  <code>StringBuffer</code>  å¯¹è±¡çš„è¿ç»­  <code>append()</code>  æ“ä½œï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">concatString</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">,</span> <span class="token class-name">String</span> s3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>s3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¯ä¸ª  <code>append()</code>  æ–¹æ³•ä¸­éƒ½æœ‰ä¸€ä¸ªåŒæ­¥å—ã€‚è™šæ‹Ÿæœºè§‚å¯Ÿå˜é‡ sbï¼Œå¾ˆå¿«å°±ä¼šå‘ç°å®ƒçš„åŠ¨æ€ä½œç”¨åŸŸè¢«é™åˆ¶åœ¨  <code>concatString()</code>  æ–¹æ³•å†…éƒ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œsb çš„æ‰€æœ‰å¼•ç”¨æ°¸è¿œä¸ä¼šé€ƒé€¸åˆ°  <code>concatString()</code>  æ–¹æ³•ä¹‹å¤–ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®åˆ°å®ƒï¼Œå› æ­¤å¯ä»¥è¿›è¡Œæ¶ˆé™¤ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰é”ç²—åŒ–</strong></p>
<p>é”ç²—åŒ–åŒç†ï¼Œå°±æ˜¯åœ¨ JIT ç¼–è¯‘å™¨åŠ¨æ€ç¼–è¯‘æ—¶ï¼Œå¦‚æœå‘ç°å‡ ä¸ªç›¸é‚»çš„åŒæ­¥å—ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªé”å®ä¾‹ï¼Œé‚£ä¹ˆ JIT ç¼–è¯‘å™¨å°†ä¼šæŠŠè¿™å‡ ä¸ªåŒæ­¥å—åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„åŒæ­¥å—ï¼Œä»è€Œé¿å…ä¸€ä¸ªçº¿ç¨‹ â€œåå¤ç”³è¯·ã€é‡Šæ”¾åŒä¸€ä¸ªé” â€œæ‰€å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚</p>
<p>å¦‚æœ<strong>ä¸€ç³»åˆ—çš„è¿ç»­æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”</strong>ï¼Œé¢‘ç¹çš„åŠ é”æ“ä½œå°±ä¼šå¯¼è‡´æ€§èƒ½æŸè€—ã€‚</p>
<p>ä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç ä¸­è¿ç»­çš„  <code>append()</code>  æ–¹æ³•å°±å±äºè¿™ç±»æƒ…å†µã€‚å¦‚æœ<strong>è™šæ‹Ÿæœºæ¢æµ‹åˆ°ç”±è¿™æ ·çš„ä¸€ä¸²é›¶ç¢çš„æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œå°†ä¼šæŠŠåŠ é”çš„èŒƒå›´æ‰©å±•ï¼ˆç²—åŒ–ï¼‰åˆ°æ•´ä¸ªæ“ä½œåºåˆ—çš„å¤–éƒ¨</strong>ã€‚å¯¹äºä¸Šä¸€èŠ‚çš„ç¤ºä¾‹ä»£ç å°±æ˜¯æ‰©å±•åˆ°ç¬¬ä¸€ä¸ª  <code>append()</code>  æ“ä½œä¹‹å‰ç›´è‡³æœ€åä¸€ä¸ª  <code>append()</code>  æ“ä½œä¹‹åï¼Œè¿™æ ·åªéœ€è¦åŠ é”ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚</p>
<h4 id="-603"><a class="markdownIt-Anchor" href="#-603">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E8%87%AA%E6%97%8B%E9%94%81">#</a>è‡ªæ—‹é”</h4>
<p>äº’æ–¥åŒæ­¥è¿›å…¥é˜»å¡çŠ¶æ€çš„å¼€é”€éƒ½å¾ˆå¤§ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚åœ¨è®¸å¤šåº”ç”¨ä¸­ï¼Œå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ã€‚è‡ªæ—‹é”çš„æ€æƒ³æ˜¯è®©ä¸€ä¸ªçº¿ç¨‹åœ¨è¯·æ±‚ä¸€ä¸ªå…±äº«æ•°æ®çš„é”æ—¶æ‰§è¡Œå¿™å¾ªç¯ï¼ˆè‡ªæ—‹ï¼‰ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…èƒ½è·å¾—é”ï¼Œå°±å¯ä»¥é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p>
<p>è‡ªæ—‹é”è™½ç„¶èƒ½é¿å…è¿›å…¥é˜»å¡çŠ¶æ€ä»è€Œå‡å°‘å¼€é”€ï¼Œä½†æ˜¯å®ƒéœ€è¦è¿›è¡Œå¿™å¾ªç¯æ“ä½œå ç”¨ CPU æ—¶é—´ï¼Œå®ƒåªé€‚ç”¨äºå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€å¾ˆçŸ­çš„åœºæ™¯ã€‚</p>
<p>åœ¨ Java 1.6 ä¸­å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ã€‚è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ¬¡æ•°åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚</p>
<h3 id="-604"><a class="markdownIt-Anchor" href="#-604">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_2-4-synchronized-%E7%9A%84%E8%AF%AF%E5%8C%BA">#</a>2.4. synchronized çš„è¯¯åŒº</h3>
<blockquote>
<p>ç¤ºä¾‹æ‘˜è‡ªï¼š<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100047701">ã€ŠJava ä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯ 100 ä¾‹ã€‹(opens new window)</a></p>
</blockquote>
<h4 id="-605"><a class="markdownIt-Anchor" href="#-605">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#synchronized-%E4%BD%BF%E7%94%A8%E8%8C%83%E5%9B%B4%E4%B8%8D%E5%BD%93%E5%AF%BC%E8%87%B4%E7%9A%84%E9%94%99%E8%AF%AF">#</a>synchronized ä½¿ç”¨èŒƒå›´ä¸å½“å¯¼è‡´çš„é”™è¯¯</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Interesting</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">volatile</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Interesting</span> interesting <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Interesting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> interesting<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> interesting<span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"add start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            a<span class="token operator">++</span><span class="token punctuation">;</span>
            b<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"add done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"compare start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//aå§‹ç»ˆç­‰äºbå—ï¼Ÿ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">&lt;</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"a:&#123;&#125;,b:&#123;&#125;,&#123;&#125;"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a <span class="token operator">></span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//æœ€åçš„a>båº”è¯¥å§‹ç»ˆæ˜¯falseå—ï¼Ÿ</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"compare done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è¾“å‡ºã€‘</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">16:05:25.541 [Thread-0] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç”¨èŒƒå›´ä¸å½“ - add start
16:05:25.544 [Thread-0] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç”¨èŒƒå›´ä¸å½“ - add done
16:05:25.544 [Thread-1] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç”¨èŒƒå›´ä¸å½“ - compare start
16:05:25.544 [Thread-1] INFO io.github.dunwu.javacore.concurrent.sync.synchronizedä½¿ç”¨èŒƒå›´ä¸å½“ - compare done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¹‹æ‰€ä»¥å‡ºç°è¿™ç§é”™ä¹±ï¼Œæ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹æ˜¯äº¤é”™æ‰§è¡Œ add å’Œ compare æ–¹æ³•ä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”è¿™äº›ä¸šåŠ¡é€»è¾‘ä¸æ˜¯åŸå­æ€§çš„ï¼ša++ å’Œ b++ æ“ä½œä¸­å¯ä»¥ç©¿æ’åœ¨ compare æ–¹æ³•çš„æ¯”è¾ƒä»£ç ä¸­ï¼›æ›´éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œa&lt;b è¿™ç§æ¯”è¾ƒæ“ä½œåœ¨å­—èŠ‚ç å±‚é¢æ˜¯åŠ è½½ aã€åŠ è½½ b å’Œæ¯”è¾ƒä¸‰æ­¥ï¼Œä»£ç è™½ç„¶æ˜¯ä¸€è¡Œä½†ä¹Ÿä¸æ˜¯åŸå­æ€§çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼Œä¸º add å’Œ compare éƒ½åŠ ä¸Šæ–¹æ³•é”ï¼Œç¡®ä¿ add æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œcompare æ— æ³•è¯»å– a å’Œ bï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">public synchronized void add()
public synchronized void compare()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>æ‰€ä»¥ï¼Œä½¿ç”¨é”è§£å†³é—®é¢˜ä¹‹å‰ä¸€å®šè¦ç†æ¸…æ¥šï¼Œæˆ‘ä»¬è¦ä¿æŠ¤çš„æ˜¯ä»€ä¹ˆé€»è¾‘ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œçš„æƒ…å†µåˆæ˜¯æ€æ ·çš„ã€‚</p>
<h4 id="-606"><a class="markdownIt-Anchor" href="#-606">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#synchronized-%E4%BF%9D%E6%8A%A4%E5%AF%B9%E8%B1%A1%E4%B8%8D%E5%AF%B9%E5%AF%BC%E8%87%B4%E7%9A%84%E9%94%99%E8%AF%AF">#</a>synchronized ä¿æŠ¤å¯¹è±¡ä¸å¯¹å¯¼è‡´çš„é”™è¯¯</h4>
<p>åŠ é”å‰è¦æ¸…æ¥šé”å’Œè¢«ä¿æŠ¤çš„å¯¹è±¡æ˜¯ä¸æ˜¯ä¸€ä¸ªå±‚é¢çš„ã€‚</p>
<p>é™æ€å­—æ®µå±äºç±»ï¼Œç±»çº§åˆ«çš„é”æ‰èƒ½ä¿æŠ¤ï¼›è€Œéé™æ€å­—æ®µå±äºç±»å®ä¾‹ï¼Œå®ä¾‹çº§åˆ«çš„é”å°±å¯ä»¥ä¿æŠ¤ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token keyword">synchronized</span>é”™è¯¯ä½¿ç”¨ç¤ºä¾‹<span class="token number">2</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span>é”™è¯¯ä½¿ç”¨ç¤ºä¾‹<span class="token number">2</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">synchronized</span>é”™è¯¯ä½¿ç”¨ç¤ºä¾‹<span class="token function">2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span><span class="token function">wrong</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">wrong</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Data</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Data</span><span class="token punctuation">.</span><span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Data</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Data</span><span class="token punctuation">.</span><span class="token function">getCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Data</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Getter</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Object</span> locker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> counter<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">wrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            counter<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>locker<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                counter<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>wrong æ–¹æ³•ä¸­è¯•å›¾å¯¹ä¸€ä¸ªé™æ€å¯¹è±¡åŠ å¯¹è±¡çº§åˆ«çš„ synchronized é”ï¼Œå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h4 id="-607"><a class="markdownIt-Anchor" href="#-607">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E9%94%81%E7%B2%92%E5%BA%A6%E5%AF%BC%E8%87%B4%E7%9A%84%E9%97%AE%E9%A2%98">#</a>é”ç²’åº¦å¯¼è‡´çš„é—®é¢˜</h4>
<p>è¦å°½å¯èƒ½çš„ç¼©å°åŠ é”çš„èŒƒå›´ï¼Œè¿™å¯ä»¥æé«˜å¹¶å‘ååã€‚</p>
<p>å¦‚æœç²¾ç»†åŒ–è€ƒè™‘äº†é”åº”ç”¨èŒƒå›´åï¼Œæ€§èƒ½è¿˜æ— æ³•æ»¡è¶³éœ€æ±‚çš„è¯ï¼Œæˆ‘ä»¬å°±è¦è€ƒè™‘å¦ä¸€ä¸ªç»´åº¦çš„ç²’åº¦é—®é¢˜äº†ï¼Œå³ï¼šåŒºåˆ†è¯»å†™åœºæ™¯ä»¥åŠèµ„æºçš„è®¿é—®å†²çªï¼Œè€ƒè™‘ä½¿ç”¨æ‚²è§‚æ–¹å¼çš„é”è¿˜æ˜¯ä¹è§‚æ–¹å¼çš„é”ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token keyword">synchronized</span>é”ç²’åº¦ä¸å½“ <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Demo</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        demo<span class="token punctuation">.</span><span class="token function">wrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        demo<span class="token punctuation">.</span><span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">wrong</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"took:&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
                <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"took:&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-608"><a class="markdownIt-Anchor" href="#-608">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_3-volatile">#</a>3. volatile</h2>
<h3 id="-609"><a class="markdownIt-Anchor" href="#-609">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_3-1-volatile-%E7%9A%84%E8%A6%81%E7%82%B9">#</a>3.1. volatile çš„è¦ç‚¹</h3>
<p><code>volatile</code>  æ˜¯è½»é‡çº§çš„  <code>synchronized</code> ï¼Œå®ƒåœ¨å¤šå¤„ç†å™¨å¼€å‘ä¸­ä¿è¯äº†å…±äº«å˜é‡çš„ â€œå¯è§æ€§â€ã€‚</p>
<p>è¢«  <code>volatile</code>  ä¿®é¥°çš„å˜é‡ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li><strong>çº¿ç¨‹å¯è§æ€§</strong> - ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå…±äº«å˜é‡ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹èƒ½è¯»åˆ°è¿™ä¸ªä¿®æ”¹çš„å€¼ã€‚</li>
<li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</strong></li>
<li><strong>ä¸ä¿è¯åŸå­æ€§</strong></li>
</ul>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œçº¿ç¨‹å®‰å…¨éœ€è¦å…·å¤‡ï¼šå¯è§æ€§ã€åŸå­æ€§ã€é¡ºåºæ€§ã€‚ <code>volatile</code>  ä¸ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥å†³å®šäº†å®ƒä¸èƒ½å½»åº•åœ°ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h3 id="-610"><a class="markdownIt-Anchor" href="#-610">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_3-2-volatile-%E7%9A%84%E5%BA%94%E7%94%A8">#</a>3.2. volatile çš„åº”ç”¨</h3>
<p>å¦‚æœ  <code>volatile</code>  å˜é‡ä¿®é¥°ç¬¦ä½¿ç”¨æ°å½“çš„è¯ï¼Œå®ƒæ¯”  <code>synchronized</code>  çš„ä½¿ç”¨å’Œæ‰§è¡Œæˆæœ¬æ›´ä½ï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œè°ƒåº¦ã€‚ä½†æ˜¯ï¼Œ<strong> <code>volatile</code>  æ— æ³•æ›¿ä»£  <code>synchronized</code>  ï¼Œå› ä¸º  <code>volatile</code>  æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§</strong>ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œ<strong>ä½¿ç”¨  <code>volatile</code>  å¿…é¡»å…·å¤‡ä»¥ä¸‹ 2 ä¸ªæ¡ä»¶</strong>ï¼š</p>
<ul>
<li><strong>å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºå½“å‰å€¼</strong></li>
<li><strong>è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„è¡¨è¾¾å¼ä¸­</strong></li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘çŠ¶æ€æ ‡è®°é‡</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘åŒé‡é”å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-611"><a class="markdownIt-Anchor" href="#-611">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_3-3-volatile-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>3.3. volatile çš„åŸç†</h3>
<p>è§‚å¯ŸåŠ å…¥ volatile å…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥ volatile å…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼Œ<strong>åŠ å…¥  <code>volatile</code>  å…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ª  <code>lock</code>  å‰ç¼€æŒ‡ä»¤</strong>ã€‚<strong> <code>lock</code>  å‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœ</strong>ï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾› 3 ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li>å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼›</li>
<li>å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼›</li>
<li>å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»– CPU ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚</li>
</ul>
<h3 id="-612"><a class="markdownIt-Anchor" href="#-612">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_3-4-volatile-%E7%9A%84%E9%97%AE%E9%A2%98">#</a>3.4. volatile çš„é—®é¢˜</h3>
<p><code>volatile</code>  çš„è¦ç‚¹ä¸­ï¼Œå·²ç»æåˆ°ï¼Œ<strong> <code>volatile</code>  ä¸ä¿è¯åŸå­æ€§ï¼Œæ‰€ä»¥ volatile å¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨</strong>ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•åšåˆ°çº¿ç¨‹å®‰å…¨å‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li><code>volatile</code>  +  <code>synchronized</code>  - å¯ä»¥å‚è€ƒï¼šã€ç¤ºä¾‹ã€‘åŒé‡é”å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</li>
<li>ä½¿ç”¨åŸå­ç±»æ›¿ä»£  <code>volatile</code></li>
</ul>
<h2 id="-613"><a class="markdownIt-Anchor" href="#-613">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_4-cas">#</a>4. CAS</h2>
<h3 id="-614"><a class="markdownIt-Anchor" href="#-614">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_4-1-cas-%E7%9A%84%E8%A6%81%E7%82%B9">#</a>4.1. CAS çš„è¦ç‚¹</h3>
<p>äº’æ–¥åŒæ­¥æ˜¯æœ€å¸¸è§çš„å¹¶å‘æ­£ç¡®æ€§ä¿éšœæ‰‹æ®µã€‚</p>
<p><strong>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜</strong>ï¼Œå› æ­¤äº’æ–¥åŒæ­¥ä¹Ÿè¢«ç§°ä¸ºé˜»å¡åŒæ­¥ã€‚äº’æ–¥åŒæ­¥å±äºä¸€ç§æ‚²è§‚çš„å¹¶å‘ç­–ç•¥ï¼Œæ€»æ˜¯è®¤ä¸ºåªè¦ä¸å»åšæ­£ç¡®çš„åŒæ­¥æªæ–½ï¼Œé‚£å°±è‚¯å®šä¼šå‡ºç°é—®é¢˜ã€‚æ— è®ºå…±äº«æ•°æ®æ˜¯å¦çœŸçš„ä¼šå‡ºç°ç«äº‰ï¼Œå®ƒéƒ½è¦è¿›è¡ŒåŠ é”ï¼ˆè¿™é‡Œè®¨è®ºçš„æ˜¯æ¦‚å¿µæ¨¡å‹ï¼Œå®é™…ä¸Šè™šæ‹Ÿæœºä¼šä¼˜åŒ–æ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„åŠ é”ï¼‰ã€ç”¨æˆ·æ€æ ¸å¿ƒæ€è½¬æ¢ã€ç»´æŠ¤é”è®¡æ•°å™¨å’Œæ£€æŸ¥æ˜¯å¦æœ‰è¢«é˜»å¡çš„çº¿ç¨‹éœ€è¦å”¤é†’ç­‰æ“ä½œã€‚</p>
<p>éšç€ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå†²çªæ£€æµ‹çš„ä¹è§‚å¹¶å‘ç­–ç•¥ï¼šå…ˆè¿›è¡Œæ“ä½œï¼Œå¦‚æœæ²¡æœ‰å…¶å®ƒçº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼Œå¦åˆ™é‡‡å–è¡¥å¿æªæ–½ï¼ˆä¸æ–­åœ°é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼‰ã€‚è¿™ç§ä¹è§‚çš„å¹¶å‘ç­–ç•¥çš„è®¸å¤šå®ç°éƒ½ä¸éœ€è¦å°†çº¿ç¨‹é˜»å¡ï¼Œå› æ­¤è¿™ç§åŒæ­¥æ“ä½œç§°ä¸ºéé˜»å¡åŒæ­¥ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¯´ä¹è§‚é”éœ€è¦ <strong>ç¡¬ä»¶æŒ‡ä»¤é›†çš„å‘å±•</strong> æ‰èƒ½è¿›è¡Œï¼Ÿå› ä¸ºéœ€è¦æ“ä½œå’Œå†²çªæ£€æµ‹è¿™ä¸¤ä¸ªæ­¥éª¤å…·å¤‡åŸå­æ€§ã€‚è€Œè¿™ç‚¹æ˜¯ç”±ç¡¬ä»¶æ¥å®Œæˆï¼Œå¦‚æœå†ä½¿ç”¨äº’æ–¥åŒæ­¥æ¥ä¿è¯å°±å¤±å»æ„ä¹‰äº†ã€‚ç¡¬ä»¶æ”¯æŒçš„åŸå­æ€§æ“ä½œæœ€å…¸å‹çš„æ˜¯ï¼šCASã€‚</p>
<p><strong>CASï¼ˆCompare and Swapï¼‰ï¼Œå­—é¢æ„æ€ä¸ºæ¯”è¾ƒå¹¶äº¤æ¢ã€‚CAS æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šå†…å­˜å€¼ Mï¼ŒæœŸæœ›å€¼ Eï¼Œæ›´æ–°å€¼ Uã€‚å½“ä¸”ä»…å½“å†…å­˜å€¼ M å’ŒæœŸæœ›å€¼ E ç›¸ç­‰æ—¶ï¼Œå°†å†…å­˜å€¼ M ä¿®æ”¹ä¸º Uï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åš</strong>ã€‚</p>
<h3 id="-615"><a class="markdownIt-Anchor" href="#-615">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_4-2-cas-%E7%9A%84%E5%BA%94%E7%94%A8">#</a>4.2. CAS çš„åº”ç”¨</h3>
<p><strong>CAS åªé€‚ç”¨äºçº¿ç¨‹å†²çªè¾ƒå°‘çš„æƒ…å†µ</strong>ã€‚</p>
<p>CAS çš„å…¸å‹åº”ç”¨åœºæ™¯æ˜¯ï¼š</p>
<ul>
<li>åŸå­ç±»</li>
<li>è‡ªæ—‹é”</li>
</ul>
<h4 id="-616"><a class="markdownIt-Anchor" href="#-616">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%8E%9F%E5%AD%90%E7%B1%BB">#</a>åŸå­ç±»</h4>
<blockquote>
<p>åŸå­ç±»æ˜¯ CAS åœ¨ Java ä¸­æœ€å…¸å‹çš„åº”ç”¨ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªå¸¸è§çš„ä»£ç ç‰‡æ®µã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token operator">==</span>b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    a<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœ  <code>a++</code>  æ‰§è¡Œå‰ï¼Œ a çš„å€¼è¢«ä¿®æ”¹äº†æ€ä¹ˆåŠï¼Ÿè¿˜èƒ½å¾—åˆ°é¢„æœŸå€¼å—ï¼Ÿå‡ºç°è¯¥é—®é¢˜çš„åŸå› æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä»¥ä¸Šä»£ç ç‰‡æ®µä¸æ˜¯åŸå­æ“ä½œï¼Œéšæ—¶å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰€ç¯¡æ”¹ã€‚</p>
<p>è§£å†³è¿™ç§é—®é¢˜çš„æœ€ç»å…¸æ–¹å¼æ˜¯åº”ç”¨åŸå­ç±»çš„  <code>incrementAndGet</code>  æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    count<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Final Count is : "</span> <span class="token operator">+</span> count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>J.U.C åŒ…ä¸­æä¾›äº†  <code>AtomicBoolean</code> ã€ <code>AtomicInteger</code> ã€ <code>AtomicLong</code>  åˆ†åˆ«é’ˆå¯¹  <code>Boolean</code> ã€ <code>Integer</code> ã€ <code>Long</code>  æ‰§è¡ŒåŸå­æ“ä½œï¼Œæ“ä½œå’Œä¸Šé¢çš„ç¤ºä¾‹å¤§ä½“ç›¸ä¼¼ï¼Œä¸åšèµ˜è¿°ã€‚</p>
<h4 id="-617"><a class="markdownIt-Anchor" href="#-617">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E8%87%AA%E6%97%8B%E9%94%81-2">#</a>è‡ªæ—‹é”</h4>
<p>åˆ©ç”¨åŸå­ç±»ï¼ˆæœ¬è´¨ä¸Šæ˜¯ CASï¼‰ï¼Œå¯ä»¥å®ç°è‡ªæ—‹é”ã€‚</p>
<p>æ‰€è°“è‡ªæ—‹é”ï¼Œæ˜¯æŒ‡çº¿ç¨‹åå¤æ£€æŸ¥é”å˜é‡æ˜¯å¦å¯ç”¨ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚ç”±äºçº¿ç¨‹åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ä¿æŒæ‰§è¡Œï¼Œå› æ­¤æ˜¯ä¸€ç§å¿™ç­‰å¾…ã€‚ä¸€æ—¦è·å–äº†è‡ªæ—‹é”ï¼Œçº¿ç¨‹ä¼šä¸€ç›´ä¿æŒè¯¥é”ï¼Œç›´è‡³æ˜¾å¼é‡Šæ”¾è‡ªæ—‹é”ã€‚</p>
<p>ç¤ºä¾‹ï¼šéçº¿ç¨‹å®‰å…¨ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å–å‡ºäº†ç¬¬ "</span> <span class="token operator">+</span> ticket <span class="token operator">+</span> <span class="token string">" å¼ ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ticket<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºç»“æœï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">pool-1-thread-2 å–å‡ºäº†ç¬¬ 10 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 10 å¼ ç¥¨
pool-1-thread-3 å–å‡ºäº†ç¬¬ 10 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 8 å¼ ç¥¨
pool-1-thread-2 å–å‡ºäº†ç¬¬ 9 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 6 å¼ ç¥¨
pool-1-thread-3 å–å‡ºäº†ç¬¬ 7 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 4 å¼ ç¥¨
pool-1-thread-2 å–å‡ºäº†ç¬¬ 5 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 2 å¼ ç¥¨
pool-1-thread-3 å–å‡ºäº†ç¬¬ 3 å¼ ç¥¨
pool-1-thread-2 å–å‡ºäº†ç¬¬ 1 å¼ ç¥¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¾ˆæ˜æ˜¾ï¼Œå‡ºç°äº†é‡å¤å”®ç¥¨çš„æƒ…å†µã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ä½¿ç”¨è‡ªæ—‹é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨</p>
<p>å¯ä»¥é€šè¿‡è‡ªæ—‹é”è¿™ç§éé˜»å¡åŒæ­¥æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸‹é¢ä½¿ç”¨  <code>AtomicReference</code>  æ¥å®ç°ä¸€ä¸ªè‡ªæ—‹é”ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceDemo2</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">threadSafeDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">threadSafeDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpinLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpinLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SpinLock</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">></span></span> atomicReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">SpinLock</span> lock<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">SpinLock</span> lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lock <span class="token operator">=</span> lock<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å–å‡ºäº†ç¬¬ "</span> <span class="token operator">+</span> ticket <span class="token operator">+</span> <span class="token string">" å¼ ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ticket<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºç»“æœï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">pool-1-thread-2 å–å‡ºäº†ç¬¬ 10 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 9 å¼ ç¥¨
pool-1-thread-3 å–å‡ºäº†ç¬¬ 8 å¼ ç¥¨
pool-1-thread-2 å–å‡ºäº†ç¬¬ 7 å¼ ç¥¨
pool-1-thread-3 å–å‡ºäº†ç¬¬ 6 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 5 å¼ ç¥¨
pool-1-thread-2 å–å‡ºäº†ç¬¬ 4 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 3 å¼ ç¥¨
pool-1-thread-3 å–å‡ºäº†ç¬¬ 2 å¼ ç¥¨
pool-1-thread-1 å–å‡ºäº†ç¬¬ 1 å¼ ç¥¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-618"><a class="markdownIt-Anchor" href="#-618">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_4-3-cas-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>4.3. CAS çš„åŸç†</h3>
<p>Java ä¸»è¦åˆ©ç”¨  <code>Unsafe</code>  è¿™ä¸ªç±»æä¾›çš„ CAS æ“ä½œã€‚ <code>Unsafe</code>  çš„ CAS ä¾èµ–çš„æ˜¯ JVM é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿå®ç°çš„ç¡¬ä»¶æŒ‡ä»¤ <strong> <code>Atomic::cmpxchg</code> </strong>ã€‚ <code>Atomic::cmpxchg</code>  çš„å®ç°ä½¿ç”¨äº†æ±‡ç¼–çš„ CAS æ“ä½œï¼Œå¹¶ä½¿ç”¨ CPU æä¾›çš„  <code>lock</code>  ä¿¡å·ä¿è¯å…¶åŸå­æ€§ã€‚</p>
<h3 id="-619"><a class="markdownIt-Anchor" href="#-619">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_4-4-cas-%E7%9A%84%E9%97%AE%E9%A2%98">#</a>4.4. CAS çš„é—®é¢˜</h3>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒCAS æ¯”é”æ€§èƒ½æ›´é«˜ã€‚å› ä¸º CAS æ˜¯ä¸€ç§éé˜»å¡ç®—æ³•ï¼Œæ‰€ä»¥å…¶é¿å…äº†çº¿ç¨‹é˜»å¡å’Œå”¤é†’çš„ç­‰å¾…æ—¶é—´ã€‚</p>
<p>ä½†æ˜¯ï¼Œäº‹ç‰©æ€»ä¼šæœ‰åˆ©æœ‰å¼Šï¼ŒCAS ä¹Ÿå­˜åœ¨ä¸‰å¤§é—®é¢˜ï¼š</p>
<ul>
<li>ABA é—®é¢˜</li>
<li>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</li>
<li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§</li>
</ul>
<h4 id="-620"><a class="markdownIt-Anchor" href="#-620">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#aba-%E9%97%AE%E9%A2%98">#</a>ABA é—®é¢˜</h4>
<p><strong>å¦‚æœä¸€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº† Bï¼Œåæ¥åˆè¢«æ”¹å›ä¸º Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡</strong>ã€‚</p>
<p>J.U.C åŒ…æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„<strong>åŸå­å¼•ç”¨ç±»  <code>AtomicStampedReference</code>  æ¥è§£å†³è¿™ä¸ªé—®é¢˜</strong>ï¼Œå®ƒå¯ä»¥é€šè¿‡æ§åˆ¶å˜é‡å€¼çš„ç‰ˆæœ¬æ¥ä¿è¯ CAS çš„æ­£ç¡®æ€§ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ ABA é—®é¢˜ä¸ä¼šå½±å“ç¨‹åºå¹¶å‘çš„æ­£ç¡®æ€§ï¼Œå¦‚æœéœ€è¦è§£å†³ ABA é—®é¢˜ï¼Œæ”¹ç”¨<strong>ä¼ ç»Ÿçš„äº’æ–¥åŒæ­¥å¯èƒ½ä¼šæ¯”åŸå­ç±»æ›´é«˜æ•ˆ</strong>ã€‚</p>
<h4 id="-621"><a class="markdownIt-Anchor" href="#-621">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%BE%AA%E7%8E%AF%E6%97%B6%E9%97%B4%E9%95%BF%E5%BC%80%E9%94%80%E5%A4%A7">#</a>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</h4>
<p><strong>è‡ªæ—‹ CAS ï¼ˆä¸æ–­å°è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ï¼‰å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™ CPU å¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€</strong>ã€‚</p>
<p>å¦‚æœ JVM èƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„  <code>pause</code>  æŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼Œ <code>pause</code>  æŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ul>
<li>å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰, ä½¿ CPU ä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚</li>
<li>å®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆmemory order violationï¼‰è€Œå¼•èµ· CPU æµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU pipeline flushï¼‰ï¼Œä»è€Œæé«˜ CPU çš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
</ul>
<p>æ¯”è¾ƒèŠ±è´¹ CPU èµ„æºï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•ç”¨ä¹Ÿä¼šåšä¸€äº›æ— ç”¨åŠŸã€‚</p>
<h4 id="-622"><a class="markdownIt-Anchor" href="#-622">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%8F%AA%E8%83%BD%E4%BF%9D%E8%AF%81%E4%B8%80%E4%B8%AA%E5%85%B1%E4%BA%AB%E5%8F%98%E9%87%8F%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7">#</a>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§</h4>
<p>å½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯ CAS çš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯ CAS å°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ã€‚</p>
<p>æˆ–è€…æœ‰ä¸€ä¸ªå–å·§çš„åŠæ³•ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªå…±äº«å˜é‡  <code>i ï¼ 2, j = a</code> ï¼Œåˆå¹¶ä¸€ä¸‹  <code>ij=2a</code> ï¼Œç„¶åç”¨ CAS æ¥æ“ä½œ  <code>ij</code> ã€‚ä» Java 1.5 å¼€å§‹ JDK æä¾›äº†  <code>AtomicReference</code>  ç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œã€‚</p>
<h2 id="-623"><a class="markdownIt-Anchor" href="#-623">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_5-threadlocal">#</a>5. ThreadLocal</h2>
<blockquote>
<p><strong> <code>ThreadLocal</code>  æ˜¯ä¸€ä¸ªå­˜å‚¨çº¿ç¨‹æœ¬åœ°å‰¯æœ¬çš„å·¥å…·ç±»</strong>ã€‚</p>
<p>è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ä¸€å®šéè¦è¿›è¡ŒåŒæ­¥ã€‚åŒæ­¥åªæ˜¯ä¿è¯å…±äº«æ•°æ®äº‰ç”¨æ—¶çš„æ­£ç¡®æ€§ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£ä¹ˆè‡ªç„¶æ— é¡»åŒæ­¥ã€‚</p>
<p>Java ä¸­çš„ <strong>æ— åŒæ­¥æ–¹æ¡ˆ</strong> æœ‰ï¼š</p>
<ul>
<li><strong>å¯é‡å…¥ä»£ç </strong> - ä¹Ÿå«çº¯ä»£ç ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„ <strong>è¿”å›ç»“æœæ˜¯å¯ä»¥é¢„æµ‹çš„</strong>ï¼Œå³åªè¦è¾“å…¥äº†ç›¸åŒçš„æ•°æ®ï¼Œå°±èƒ½è¿”å›ç›¸åŒçš„ç»“æœï¼Œé‚£å®ƒå°±æ»¡è¶³å¯é‡å…¥æ€§ï¼Œå½“ç„¶ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
<li><strong>çº¿ç¨‹æœ¬åœ°å­˜å‚¨</strong> - ä½¿ç”¨ <strong> <code>ThreadLocal</code>  ä¸ºå…±äº«å˜é‡åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½åˆ›å»ºäº†ä¸€ä¸ªæœ¬åœ°å‰¯æœ¬</strong>ï¼Œè¿™ä¸ªå‰¯æœ¬åªèƒ½è¢«å½“å‰çº¿ç¨‹è®¿é—®ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®ï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
</blockquote>
<h3 id="-624"><a class="markdownIt-Anchor" href="#-624">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_5-1-threadlocal-%E7%9A%84%E5%BA%94%E7%94%A8">#</a>5.1. ThreadLocal çš„åº”ç”¨</h3>
<p><code>ThreadLocal</code>  çš„æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">></span></span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">></span></span> <span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">S</span><span class="token punctuation">></span></span> supplier<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>get</code>  - ç”¨äºè·å–  <code>ThreadLocal</code>  åœ¨å½“å‰çº¿ç¨‹ä¸­ä¿å­˜çš„å˜é‡å‰¯æœ¬ã€‚</li>
<li><code>set</code>  - ç”¨äºè®¾ç½®å½“å‰çº¿ç¨‹ä¸­å˜é‡çš„å‰¯æœ¬ã€‚</li>
<li><code>remove</code>  - ç”¨äºåˆ é™¤å½“å‰çº¿ç¨‹ä¸­å˜é‡çš„å‰¯æœ¬ã€‚å¦‚æœæ­¤çº¿ç¨‹å±€éƒ¨å˜é‡éšåè¢«å½“å‰çº¿ç¨‹è¯»å–ï¼Œåˆ™å…¶å€¼å°†é€šè¿‡è°ƒç”¨å…¶  <code>initialValue</code>  æ–¹æ³•é‡æ–°åˆå§‹åŒ–ï¼Œé™¤éå…¶å€¼ç”±ä¸­é—´çº¿ç¨‹ä¸­çš„å½“å‰çº¿ç¨‹è®¾ç½®ã€‚ è¿™å¯èƒ½ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹ä¸­å¤šæ¬¡è°ƒç”¨  <code>initialValue</code>  æ–¹æ³•ã€‚</li>
<li><code>initialValue</code>  - ä¸º ThreadLocal è®¾ç½®é»˜è®¤çš„  <code>get</code>  åˆå§‹å€¼ï¼Œéœ€è¦é‡å†™  <code>initialValue</code>  æ–¹æ³• ã€‚</li>
</ul>
</blockquote>
<p><code>ThreadLocal</code>  å¸¸ç”¨äºé˜²æ­¢å¯¹å¯å˜çš„å•ä¾‹ï¼ˆSingletonï¼‰å˜é‡æˆ–å…¨å±€å˜é‡è¿›è¡Œå…±äº«ã€‚å…¸å‹åº”ç”¨åœºæ™¯æœ‰ï¼šç®¡ç†æ•°æ®åº“è¿æ¥ã€Sessionã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ•°æ®åº“è¿æ¥</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Connection</span><span class="token punctuation">></span></span> connectionHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Connection</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Connection</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>DB_URL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Connection</span> <span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> connectionHolder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘Session ç®¡ç†</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Session</span><span class="token punctuation">></span></span> sessionHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Session</span> <span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Session</span> session <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Session</span><span class="token punctuation">)</span> sessionHolder<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            session <span class="token operator">=</span> <span class="token function">createSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sessionHolder<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> session<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘å®Œæ•´ä½¿ç”¨  <code>ThreadLocal</code>  ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token class-name">Integer</span> <span class="token function">initialValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> count <span class="token operator">=</span> threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    count<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" : "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¨éƒ¨è¾“å‡º count = 10</p>
<h3 id="-625"><a class="markdownIt-Anchor" href="#-625">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_5-2-threadlocal-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>5.2. ThreadLocal çš„åŸç†</h3>
<h4 id="-626"><a class="markdownIt-Anchor" href="#-626">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84">#</a>å­˜å‚¨ç»“æ„</h4>
<p><strong> <code>Thread</code>  ç±»ä¸­ç»´æŠ¤ç€ä¸€ä¸ª  <code>ThreadLocal.ThreadLocalMap</code>  ç±»å‹çš„æˆå‘˜</strong>  <code>threadLocals</code> ã€‚è¿™ä¸ªæˆå‘˜å°±æ˜¯ç”¨æ¥å­˜å‚¨å½“å‰çº¿ç¨‹ç‹¬å çš„å˜é‡å‰¯æœ¬ã€‚</p>
<p><code>ThreadLocalMap</code>  æ˜¯  <code>ThreadLocal</code>  çš„å†…éƒ¨ç±»ï¼Œå®ƒç»´æŠ¤ç€ä¸€ä¸ª  <code>Entry</code>  æ•°ç»„ï¼Œ<strong> <code>Entry</code>  ç»§æ‰¿äº†  <code>WeakReference</code> </strong> ï¼Œæ‰€ä»¥æ˜¯å¼±å¼•ç”¨ã€‚  <code>Entry</code>  ç”¨äºä¿å­˜é”®å€¼å¯¹ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li><code>key</code>  æ˜¯  <code>ThreadLocal</code>  å¯¹è±¡ï¼›</li>
<li><code>value</code>  æ˜¯ä¼ é€’è¿›æ¥çš„å¯¹è±¡ï¼ˆå˜é‡å‰¯æœ¬ï¼‰ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Thread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    <span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalMap</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span> <span class="token keyword">extends</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ThreadLocal</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">/** The value associated with this ThreadLocal. */</span>
        <span class="token class-name">Object</span> value<span class="token punctuation">;</span>

        <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> k<span class="token punctuation">,</span> <span class="token class-name">Object</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
            value <span class="token operator">=</span> v<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-627"><a class="markdownIt-Anchor" href="#-627">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3-hash-%E5%86%B2%E7%AA%81">#</a>å¦‚ä½•è§£å†³ Hash å†²çª</h4>
<p><code>ThreadLocalMap</code>  è™½ç„¶æ˜¯ç±»ä¼¼  <code>Map</code>  ç»“æ„çš„æ•°æ®ç»“æ„ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®ç°  <code>Map</code>  æ¥å£ã€‚å®ƒä¸æ”¯æŒ  <code>Map</code>  æ¥å£ä¸­çš„  <code>next</code>  æ–¹æ³•ï¼Œè¿™æ„å‘³ç€  <code>ThreadLocalMap</code>  ä¸­è§£å†³ Hash å†²çªçš„æ–¹å¼å¹¶é <strong>æ‹‰é“¾è¡¨</strong> æ–¹å¼ã€‚</p>
<p>å®é™…ä¸Šï¼Œ<strong> <code>ThreadLocalMap</code>  é‡‡ç”¨çº¿æ€§æ¢æµ‹çš„æ–¹å¼æ¥è§£å†³ Hash å†²çª</strong>ã€‚æ‰€è°“çº¿æ€§æ¢æµ‹ï¼Œå°±æ˜¯æ ¹æ®åˆå§‹ key çš„ hashcode å€¼ç¡®å®šå…ƒç´ åœ¨ table æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¦‚æœå‘ç°è¿™ä¸ªä½ç½®ä¸Šå·²ç»è¢«å…¶ä»–çš„ key å€¼å ç”¨ï¼Œåˆ™åˆ©ç”¨å›ºå®šçš„ç®—æ³•å¯»æ‰¾ä¸€å®šæ­¥é•¿çš„ä¸‹ä¸ªä½ç½®ï¼Œä¾æ¬¡åˆ¤æ–­ï¼Œç›´è‡³æ‰¾åˆ°èƒ½å¤Ÿå­˜æ”¾çš„ä½ç½®ã€‚</p>
<h4 id="-628"><a class="markdownIt-Anchor" href="#-628">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E9%97%AE%E9%A2%98">#</a>å†…å­˜æ³„æ¼é—®é¢˜</h4>
<p><code>ThreadLocalMap</code>  çš„  <code>Entry</code>  ç»§æ‰¿äº†  <code>WeakReference</code> ï¼Œæ‰€ä»¥å®ƒçš„ <strong>key ï¼ˆ <code>ThreadLocal</code>  å¯¹è±¡ï¼‰æ˜¯å¼±å¼•ç”¨ï¼Œè€Œ value ï¼ˆå˜é‡å‰¯æœ¬ï¼‰æ˜¯å¼ºå¼•ç”¨</strong>ã€‚</p>
<ul>
<li>å¦‚æœ  <code>ThreadLocal</code>  å¯¹è±¡æ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨æ¥å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆ  <code>ThreadLocal</code>  å¯¹è±¡ä¼šåœ¨ä¸‹æ¬¡ GC æ—¶è¢«å›æ”¶ã€‚</li>
<li>æ­¤æ—¶ï¼Œ <code>Entry</code>  ä¸­çš„ key å·²ç»è¢«å›æ”¶ï¼Œä½†æ˜¯ value ç”±äºæ˜¯å¼ºå¼•ç”¨ä¸ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚å¦‚æœåˆ›å»º  <code>ThreadLocal</code>  çš„çº¿ç¨‹ä¸€ç›´æŒç»­è¿è¡Œï¼Œé‚£ä¹ˆ value å°±ä¼šä¸€ç›´å¾—ä¸åˆ°å›æ”¶ï¼Œäº§ç”Ÿ<strong>å†…å­˜æ³„éœ²</strong>ã€‚</li>
</ul>
<p>é‚£ä¹ˆå¦‚ä½•é¿å…å†…å­˜æ³„æ¼å‘¢ï¼Ÿæ–¹æ³•å°±æ˜¯ï¼š<strong>ä½¿ç”¨  <code>ThreadLocal</code>  çš„  <code>set</code>  æ–¹æ³•åï¼Œæ˜¾ç¤ºçš„è°ƒç”¨  <code>remove</code>  æ–¹æ³•</strong> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"xxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
    threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-629"><a class="markdownIt-Anchor" href="#-629">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_5-3-threadlocal-%E7%9A%84%E8%AF%AF%E5%8C%BA">#</a>5.3. ThreadLocal çš„è¯¯åŒº</h3>
<blockquote>
<p>ç¤ºä¾‹æ‘˜è‡ªï¼š<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100047701">ã€ŠJava ä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯ 100 ä¾‹ã€‹(opens new window)</a></p>
</blockquote>
<p>ThreadLocal é€‚ç”¨äºå˜é‡åœ¨çº¿ç¨‹é—´éš”ç¦»ï¼Œè€Œåœ¨æ–¹æ³•æˆ–ç±»é—´å…±äº«çš„åœºæ™¯ã€‚</p>
<p>å‰æ–‡æåˆ°ï¼ŒThreadLocal æ˜¯çº¿ç¨‹éš”ç¦»çš„ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä½¿ç”¨ ThreadLocal å°±ä¸€å®šé«˜æ•æ— å¿§å‘¢ï¼Ÿ</p>
<h4 id="-630"><a class="markdownIt-Anchor" href="#-630">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#threadlocal-%E9%94%99%E8%AF%AF%E6%A1%88%E4%BE%8B">#</a>ThreadLocal é”™è¯¯æ¡ˆä¾‹</h4>
<p>ä½¿ç”¨ Spring Boot åˆ›å»ºä¸€ä¸ª Web åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ ThreadLocal å­˜æ”¾ä¸€ä¸ª Integer çš„å€¼ï¼Œæ¥æš‚ä¸”ä»£è¡¨éœ€è¦åœ¨çº¿ç¨‹ä¸­ä¿å­˜çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™ä¸ªå€¼åˆå§‹æ˜¯ nullã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> currentUser <span class="token operator">=</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"wrong"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">wrong</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//è®¾ç½®ç”¨æˆ·ä¿¡æ¯ä¹‹å‰å…ˆæŸ¥è¯¢ä¸€æ¬¡ThreadLocalä¸­çš„ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token class-name">String</span> before <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> currentUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®¾ç½®ç”¨æˆ·ä¿¡æ¯åˆ°ThreadLocal</span>
    currentUser<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//è®¾ç½®ç”¨æˆ·ä¿¡æ¯ä¹‹åå†æŸ¥è¯¢ä¸€æ¬¡ThreadLocalä¸­çš„ç”¨æˆ·ä¿¡æ¯</span>
    <span class="token class-name">String</span> after <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> currentUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æ±‡æ€»è¾“å‡ºä¸¤æ¬¡æŸ¥è¯¢ç»“æœ</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"before"</span><span class="token punctuation">,</span> before<span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"after"</span><span class="token punctuation">,</span> after<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€é¢„æœŸã€‘ä»ä»£ç é€»è¾‘æ¥çœ‹ï¼Œæˆ‘ä»¬é¢„æœŸç¬¬ä¸€æ¬¡è·å–çš„å€¼å§‹ç»ˆåº”è¯¥æ˜¯ nullã€‚</p>
<p>ã€å®é™…ã€‘</p>
<p>ä¸ºäº†æ–¹ä¾¿å¤ç°ï¼Œå°† Tomcat å·¥ä½œçº¿ç¨‹è®¾ä¸º 1ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">server.tomcat.max-threads=1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å½“è®¿é—® id = 1 æ—¶ï¼Œç¬¦åˆé¢„æœŸ</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200731111854.png" alt="img"></p>
<p>å½“è®¿é—® id = 2 æ—¶ï¼Œbefore çš„åº”ç­”ä¸æ˜¯ nullï¼Œè€Œæ˜¯ 1ï¼Œä¸ç¬¦åˆé¢„æœŸã€‚</p>
<p><img src="C:/%5CUsers%5Czp%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200731111921591.png" alt="image-20200731111921591"></p>
<p>ã€åˆ†æã€‘å®é™…æƒ…å†µå’Œé¢„æœŸå­˜åœ¨åå·®ã€‚Spring Boot ç¨‹åºè¿è¡Œåœ¨ Tomcat ä¸­ï¼Œæ‰§è¡Œç¨‹åºçš„çº¿ç¨‹æ˜¯ Tomcat çš„å·¥ä½œçº¿ç¨‹ï¼Œè€Œ Tomcat çš„å·¥ä½œçº¿ç¨‹æ˜¯åŸºäºçº¿ç¨‹æ± çš„ã€‚<strong>çº¿ç¨‹æ± ä¼šé‡ç”¨å›ºå®šçš„å‡ ä¸ªçº¿ç¨‹ï¼Œä¸€æ—¦çº¿ç¨‹é‡ç”¨ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½é¦–æ¬¡ä»</strong> <strong>ThreadLocal è·å–çš„å€¼æ˜¯ä¹‹å‰å…¶ä»–ç”¨æˆ·çš„è¯·æ±‚é—ç•™çš„å€¼ã€‚è¿™æ—¶ï¼ŒThreadLocal ä¸­çš„ç”¨æˆ·ä¿¡æ¯å°±æ˜¯å…¶ä»–ç”¨æˆ·çš„ä¿¡æ¯</strong>ã€‚</p>
<p><strong>å¹¶ä¸èƒ½è®¤ä¸ºæ²¡æœ‰æ˜¾å¼å¼€å¯å¤šçº¿ç¨‹å°±ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ã€‚ä½¿ç”¨ç±»ä¼¼ ThreadLocal å·¥å…·æ¥å­˜æ”¾ä¸€äº›æ•°æ®æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„åœ¨ä»£ç è¿è¡Œå®Œåï¼Œæ˜¾å¼åœ°å»æ¸…ç©ºè®¾ç½®çš„æ•°æ®ã€‚</p>
<h4 id="-631"><a class="markdownIt-Anchor" href="#-631">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#threadlocal-%E9%94%99%E8%AF%AF%E6%A1%88%E4%BE%8B%E4%BF%AE%E6%AD%A3">#</a>ThreadLocal é”™è¯¯æ¡ˆä¾‹ä¿®æ­£</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"right"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> userId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> before <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> currentUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    currentUser<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> after <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> currentUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"before"</span><span class="token punctuation">,</span> before<span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"after"</span><span class="token punctuation">,</span> after<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//åœ¨finallyä»£ç å—ä¸­åˆ é™¤ThreadLocalä¸­çš„æ•°æ®ï¼Œç¡®ä¿æ•°æ®ä¸ä¸²</span>
        currentUser<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-632"><a class="markdownIt-Anchor" href="#-632">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.html#_5-4-inheritablethreadlocal">#</a>5.4. InheritableThreadLocal</h3>
<p><code>InheritableThreadLocal</code>  ç±»æ˜¯  <code>ThreadLocal</code>  ç±»çš„å­ç±»ã€‚</p>
<p><code>ThreadLocal</code>  ä¸­æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰å®ƒè‡ªå·±ç‹¬å çš„æ•°æ®ã€‚ä¸  <code>ThreadLocal</code>  ä¸åŒçš„æ˜¯ï¼Œ <code>InheritableThreadLocal</code>  å…è®¸ä¸€ä¸ªçº¿ç¨‹ä»¥åŠè¯¥çº¿ç¨‹åˆ›å»ºçš„æ‰€æœ‰å­çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å®ƒä¿å­˜çš„æ•°æ®ã€‚</p>
<blockquote>
<p>åŸç†å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/ni357103403/article/details/51970748">Java å¤šçº¿ç¨‹ï¼šInheritableThreadLocal å®ç°åŸç†</a></p>
</blockquote>
<hr>
<h1 id="æ·±å…¥ç†è§£-java-å¹¶å‘é”"><a class="markdownIt-Anchor" href="#æ·±å…¥ç†è§£-java-å¹¶å‘é”">#</a> æ·±å…¥ç†è§£ Java å¹¶å‘é”</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>æœ¬æ–‡å…ˆé˜è¿° Java ä¸­å„ç§é”çš„æ¦‚å¿µã€‚</p>
<p>ç„¶åï¼Œä»‹ç»é”çš„æ ¸å¿ƒå®ç° AQSã€‚</p>
<p>ç„¶åï¼Œé‡ç‚¹ä»‹ç» Lock å’Œ Condition ä¸¤ä¸ªæ¥å£åŠå…¶å®ç°ã€‚å¹¶å‘ç¼–ç¨‹æœ‰ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåŒæ­¥å’Œäº’æ–¥ã€‚</p>
<p><strong>äº’æ–¥</strong>ï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼›</p>
<p><strong>åŒæ­¥</strong>ï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œã€‚</p>
<p>è¿™ä¸¤å¤§é—®é¢˜ï¼Œç®¡ç¨‹ï¼ˆ <code>sychronized</code> ï¼‰éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„ã€‚<strong>J.U.C åŒ…è¿˜æä¾›äº† Lock å’Œ Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹ï¼Œå…¶ä¸­ Lock ç”¨äºè§£å†³äº’æ–¥é—®é¢˜ï¼ŒCondition ç”¨äºè§£å†³åŒæ­¥é—®é¢˜</strong>ã€‚</p>
</blockquote>
<ul>
<li>\1. å¹¶å‘é”ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#11-%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81">1.1. å¯é‡å…¥é”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#12-%E5%85%AC%E5%B9%B3%E9%94%81%E4%B8%8E%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81">1.2. å…¬å¹³é”ä¸éå…¬å¹³é”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#13-%E7%8B%AC%E4%BA%AB%E9%94%81%E4%B8%8E%E5%85%B1%E4%BA%AB%E9%94%81">1.3. ç‹¬äº«é”ä¸å…±äº«é”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#14-%E6%82%B2%E8%A7%82%E9%94%81%E4%B8%8E%E4%B9%90%E8%A7%82%E9%94%81">1.4. æ‚²è§‚é”ä¸ä¹è§‚é”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#15-%E5%81%8F%E5%90%91%E9%94%81%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81">1.5. åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#16-%E5%88%86%E6%AE%B5%E9%94%81">1.6. åˆ†æ®µé”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#17-%E6%98%BE%E7%A4%BA%E9%94%81%E5%92%8C%E5%86%85%E7%BD%AE%E9%94%81">1.7. æ˜¾ç¤ºé”å’Œå†…ç½®é”</a></li>
</ul>
</li>
<li>\2. Lock å’Œ Condition
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#21-%E4%B8%BA%E4%BD%95%E5%BC%95%E5%85%A5-lock-%E5%92%8C-condition">2.1. ä¸ºä½•å¼•å…¥ Lock å’Œ Condition</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#22-lock-%E6%8E%A5%E5%8F%A3">2.2. Lock æ¥å£</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#23-condition">2.3. Condition</a></li>
</ul>
</li>
<li>\3. ReentrantLock
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#31-reentrantlock-%E7%9A%84%E7%89%B9%E6%80%A7">3.1. ReentrantLock çš„ç‰¹æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#32-reentrantlock-%E7%9A%84%E7%94%A8%E6%B3%95">3.2. ReentrantLock çš„ç”¨æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#33-reentrantlock-%E7%9A%84%E5%8E%9F%E7%90%86">3.3. ReentrantLock çš„åŸç†</a></li>
</ul>
</li>
<li>\4. ReentrantReadWriteLock
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#41-reentrantreadwritelock-%E7%9A%84%E7%89%B9%E6%80%A7">4.1. ReentrantReadWriteLock çš„ç‰¹æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#42-reentrantreadwritelock-%E7%9A%84%E7%94%A8%E6%B3%95">4.2. ReentrantReadWriteLock çš„ç”¨æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#43-reentrantreadwritelock-%E7%9A%84%E5%8E%9F%E7%90%86">4.3. ReentrantReadWriteLock çš„åŸç†</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#5-stampedlock">5. StampedLock</a></li>
<li>\6. AQS
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#61-aqs-%E7%9A%84%E8%A6%81%E7%82%B9">6.1. AQS çš„è¦ç‚¹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#62-aqs-%E7%9A%84%E5%BA%94%E7%94%A8">6.2. AQS çš„åº”ç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#63-aqs-%E7%9A%84%E5%8E%9F%E7%90%86">6.3. AQS çš„åŸç†</a></li>
</ul>
</li>
<li>\7. æ­»é”
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#71-%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%BB%E9%94%81">7.1. ä»€ä¹ˆæ˜¯æ­»é”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#72-%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E6%AD%BB%E9%94%81">7.2. å¦‚ä½•å®šä½æ­»é”</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#73-%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81">7.3. å¦‚ä½•é¿å…æ­»é”</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#8-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">8. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-633"><a class="markdownIt-Anchor" href="#-633">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-%E5%B9%B6%E5%8F%91%E9%94%81%E7%AE%80%E4%BB%8B">#</a>1. å¹¶å‘é”ç®€ä»‹</h2>
<p>ç¡®ä¿çº¿ç¨‹å®‰å…¨æœ€å¸¸è§çš„åšæ³•æ˜¯åˆ©ç”¨é”æœºåˆ¶ï¼ˆ <code>Lock</code> ã€ <code>sychronized</code> ï¼‰æ¥å¯¹å…±äº«æ•°æ®åšäº’æ–¥åŒæ­¥ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—ï¼Œé‚£ä¹ˆæ“ä½œå¿…ç„¶æ˜¯åŸå­æ€§çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>åœ¨å·¥ä½œã€é¢è¯•ä¸­ï¼Œç»å¸¸ä¼šå¬åˆ°å„ç§äº”èŠ±å…«é—¨çš„é”ï¼Œå¬çš„äººäº‘é‡Œé›¾é‡Œã€‚é”çš„æ¦‚å¿µæœ¯è¯­å¾ˆå¤šï¼Œå®ƒä»¬æ˜¯é’ˆå¯¹ä¸åŒçš„é—®é¢˜æ‰€æå‡ºçš„ï¼Œé€šè¿‡ç®€å•çš„æ¢³ç†ï¼Œä¹Ÿä¸éš¾ç†è§£ã€‚</p>
<h3 id="-634"><a class="markdownIt-Anchor" href="#-634">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-1-%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81">#</a>1.1. å¯é‡å…¥é”</h3>
<p><strong>å¯é‡å…¥é”ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯çº¿ç¨‹å¯ä»¥é‡å¤è·å–åŒä¸€æŠŠé”</strong>ã€‚å³åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–äº†é”ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚</p>
<p><strong>å¯é‡å…¥é”å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…æ­»é”</strong>ã€‚</p>
<ul>
<li><strong> <code>ReentrantLock</code>  ã€ <code>ReentrantReadWriteLock</code>  æ˜¯å¯é‡å…¥é”</strong>ã€‚è¿™ç‚¹ï¼Œä»å…¶å‘½åä¹Ÿä¸éš¾çœ‹å‡ºã€‚</li>
<li><strong> <code>synchronized</code>  ä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”</strong>ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘ <code>synchronized</code>  çš„å¯é‡å…¥ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªå…¸å‹åœºæ™¯ï¼šå¦‚æœä½¿ç”¨çš„é”ä¸æ˜¯å¯é‡å…¥é”çš„è¯ï¼Œ <code>setB</code>  å¯èƒ½ä¸ä¼šè¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œä»è€Œé€ æˆæ­»é”ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ <code>ReentrantLock</code>  çš„å¯é‡å…¥ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è·å–é”</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ä¿è¯é”èƒ½é‡Šæ”¾</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// è·å–é”</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// æ³¨æ„ï¼šæ­¤å¤„å·²ç»æˆåŠŸè·å–é”ï¼Œè¿›å…¥ get æ–¹æ³•åï¼Œåˆå°è¯•è·å–é”ï¼Œ</span>
            <span class="token comment">// å¦‚æœé”ä¸æ˜¯å¯é‡å…¥çš„ï¼Œä¼šå¯¼è‡´æ­»é”</span>
            value <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// ä¿è¯é”èƒ½é‡Šæ”¾</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-635"><a class="markdownIt-Anchor" href="#-635">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-2-%E5%85%AC%E5%B9%B3%E9%94%81%E4%B8%8E%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81">#</a>1.2. å…¬å¹³é”ä¸éå…¬å¹³é”</h3>
<ul>
<li><strong>å…¬å¹³é”</strong> - å…¬å¹³é”æ˜¯æŒ‡ <strong>å¤šçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”</strong>ã€‚</li>
<li><strong>éå…¬å¹³é”</strong> - éå…¬å¹³é”æ˜¯æŒ‡ <strong>å¤šçº¿ç¨‹ä¸æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”</strong> ã€‚è¿™å°±å¯èƒ½ä¼šå‡ºç°ä¼˜å…ˆçº§åè½¬ï¼ˆåæ¥è€…å±…ä¸Šï¼‰æˆ–è€…é¥¥é¥¿ç°è±¡ï¼ˆæŸçº¿ç¨‹æ€»æ˜¯æŠ¢ä¸è¿‡åˆ«çš„çº¿ç¨‹ï¼Œå¯¼è‡´å§‹ç»ˆæ— æ³•æ‰§è¡Œï¼‰ã€‚</li>
</ul>
<p>å…¬å¹³é”ä¸ºäº†ä¿è¯çº¿ç¨‹ç”³è¯·é¡ºåºï¼ŒåŠ¿å¿…è¦ä»˜å‡ºä¸€å®šçš„æ€§èƒ½ä»£ä»·ï¼Œå› æ­¤å…¶ååé‡ä¸€èˆ¬ä½äºéå…¬å¹³é”ã€‚</p>
<p>å…¬å¹³é”ä¸éå…¬å¹³é” åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š</p>
<ul>
<li><strong> <code>synchronized</code>  åªæ”¯æŒéå…¬å¹³é”</strong>ã€‚</li>
<li><strong> <code>ReentrantLock</code>  ã€ <code>ReentrantReadWriteLock</code> ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œä½†æ”¯æŒå…¬å¹³é”</strong>ã€‚</li>
</ul>
<h3 id="-636"><a class="markdownIt-Anchor" href="#-636">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-3-%E7%8B%AC%E4%BA%AB%E9%94%81%E4%B8%8E%E5%85%B1%E4%BA%AB%E9%94%81">#</a>1.3. ç‹¬äº«é”ä¸å…±äº«é”</h3>
<p>ç‹¬äº«é”ä¸å…±äº«é”æ˜¯ä¸€ç§å¹¿ä¹‰ä¸Šçš„è¯´æ³•ï¼Œä»å®é™…ç”¨é€”ä¸Šæ¥çœ‹ï¼Œä¹Ÿå¸¸è¢«ç§°ä¸ºäº’æ–¥é”ä¸è¯»å†™é”ã€‚</p>
<ul>
<li><strong>ç‹¬äº«é”</strong> - ç‹¬äº«é”æ˜¯æŒ‡ <strong>é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰</strong>ã€‚</li>
<li><strong>å…±äº«é”</strong> - å…±äº«é”æ˜¯æŒ‡ <strong>é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰</strong>ã€‚</li>
</ul>
<p>ç‹¬äº«é”ä¸å…±äº«é”åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š</p>
<ul>
<li><strong> <code>synchronized</code>  ã€ <code>ReentrantLock</code>  åªæ”¯æŒç‹¬äº«é”</strong>ã€‚</li>
<li><strong> <code>ReentrantReadWriteLock</code>  å…¶å†™é”æ˜¯ç‹¬äº«é”ï¼Œå…¶è¯»é”æ˜¯å…±äº«é”</strong>ã€‚è¯»é”æ˜¯å…±äº«é”ä½¿å¾—å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œè¯»å†™ï¼Œå†™è¯» ï¼Œå†™å†™çš„è¿‡ç¨‹æ˜¯äº’æ–¥çš„ã€‚</li>
</ul>
<h3 id="-637"><a class="markdownIt-Anchor" href="#-637">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-4-%E6%82%B2%E8%A7%82%E9%94%81%E4%B8%8E%E4%B9%90%E8%A7%82%E9%94%81">#</a>1.4. æ‚²è§‚é”ä¸ä¹è§‚é”</h3>
<p>ä¹è§‚é”ä¸æ‚²è§‚é”ä¸æ˜¯æŒ‡å…·ä½“çš„ä»€ä¹ˆç±»å‹çš„é”ï¼Œè€Œæ˜¯<strong>å¤„ç†å¹¶å‘åŒæ­¥çš„ç­–ç•¥</strong>ã€‚</p>
<ul>
<li><strong>æ‚²è§‚é”</strong> - æ‚²è§‚é”å¯¹äºå¹¶å‘é‡‡å–æ‚²è§‚çš„æ€åº¦ï¼Œè®¤ä¸ºï¼š<strong>ä¸åŠ é”çš„å¹¶å‘æ“ä½œä¸€å®šä¼šå‡ºé—®é¢˜</strong>ã€‚<strong>æ‚²è§‚é”é€‚åˆå†™æ“ä½œé¢‘ç¹çš„åœºæ™¯</strong>ã€‚</li>
<li><strong>ä¹è§‚é”</strong> - ä¹è§‚é”å¯¹äºå¹¶å‘é‡‡å–ä¹è§‚çš„æ€åº¦ï¼Œè®¤ä¸ºï¼š<strong>ä¸åŠ é”çš„å¹¶å‘æ“ä½œä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ˜¯ä¸ä¼šå‘ç”Ÿä¿®æ”¹çš„</strong>ã€‚åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œä¼šé‡‡ç”¨ä¸æ–­å°è¯•æ›´æ–°çš„æ–¹å¼æ›´æ–°æ•°æ®ã€‚<strong>ä¹è§‚é”é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯</strong>ã€‚</li>
</ul>
<p>æ‚²è§‚é”ä¸ä¹è§‚é”åœ¨ Java ä¸­çš„å…¸å‹å®ç°ï¼š</p>
<ul>
<li>æ‚²è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é€šè¿‡ä½¿ç”¨  <code>synchronized</code>  å’Œ  <code>Lock</code>  æ˜¾ç¤ºåŠ é”æ¥è¿›è¡Œäº’æ–¥åŒæ­¥ï¼Œè¿™æ˜¯ä¸€ç§é˜»å¡åŒæ­¥ã€‚</li>
<li>ä¹è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é‡‡ç”¨  <code>CAS</code>  æœºåˆ¶ï¼ˆ <code>CAS</code>  æ“ä½œé€šè¿‡  <code>Unsafe</code>  ç±»æä¾›ï¼Œä½†è¿™ä¸ªç±»ä¸ç›´æ¥æš´éœ²ä¸º APIï¼Œæ‰€ä»¥éƒ½æ˜¯é—´æ¥ä½¿ç”¨ï¼Œå¦‚å„ç§åŸå­ç±»ï¼‰ã€‚</li>
</ul>
<h3 id="-638"><a class="markdownIt-Anchor" href="#-638">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-5-%E5%81%8F%E5%90%91%E9%94%81%E3%80%81%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81%E3%80%81%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81">#</a>1.5. åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</h3>
<p>æ‰€è°“è½»é‡çº§é”ä¸é‡é‡çº§é”ï¼ŒæŒ‡çš„æ˜¯é”æ§åˆ¶ç²’åº¦çš„ç²—ç»†ã€‚æ˜¾ç„¶ï¼Œæ§åˆ¶ç²’åº¦è¶Šç»†ï¼Œé˜»å¡å¼€é”€è¶Šå°ï¼Œå¹¶å‘æ€§ä¹Ÿå°±è¶Šé«˜ã€‚</p>
<p>Java 1.6 ä»¥å‰ï¼Œé‡é‡çº§é”ä¸€èˆ¬æŒ‡çš„æ˜¯  <code>synchronized</code>  ï¼Œè€Œè½»é‡çº§é”æŒ‡çš„æ˜¯  <code>volatile</code> ã€‚</p>
<p>Java 1.6 ä»¥åï¼Œé’ˆå¯¹  <code>synchronized</code>  åšäº†å¤§é‡ä¼˜åŒ–ï¼Œå¼•å…¥ 4 ç§é”çŠ¶æ€ï¼š æ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”å¯ä»¥å•å‘çš„ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†ä»è½»é‡çº§é”å‡çº§åˆ°é‡é‡çº§é” ã€‚</p>
<ul>
<li><strong>åå‘é”</strong> - åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ã€‚é™ä½è·å–é”çš„ä»£ä»·ã€‚</li>
<li><strong>è½»é‡çº§é”</strong> - æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œæé«˜æ€§èƒ½ã€‚</li>
<li><strong>é‡é‡çº§é”</strong> - æ˜¯æŒ‡å½“é”ä¸ºè½»é‡çº§é”çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è™½ç„¶æ˜¯è‡ªæ—‹ï¼Œä½†è‡ªæ—‹ä¸ä¼šä¸€ç›´æŒç»­ä¸‹å»ï¼Œå½“è‡ªæ—‹ä¸€å®šæ¬¡æ•°çš„æ—¶å€™ï¼Œè¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡ï¼Œè¯¥é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚é‡é‡çº§é”ä¼šè®©å…¶ä»–ç”³è¯·çš„çº¿ç¨‹è¿›å…¥é˜»å¡ï¼Œæ€§èƒ½é™ä½ã€‚</li>
</ul>
<h3 id="-639"><a class="markdownIt-Anchor" href="#-639">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-6-%E5%88%86%E6%AE%B5%E9%94%81">#</a>1.6. åˆ†æ®µé”</h3>
<p>åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ã€‚æ‰€è°“åˆ†æ®µé”ï¼Œå°±æ˜¯æŠŠé”çš„å¯¹è±¡åˆ†æˆå¤šæ®µï¼Œæ¯æ®µç‹¬ç«‹æ§åˆ¶ï¼Œä½¿å¾—é”ç²’åº¦æ›´ç»†ï¼Œå‡å°‘é˜»å¡å¼€é”€ï¼Œä»è€Œæé«˜å¹¶å‘æ€§ã€‚è¿™å…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±åƒé«˜é€Ÿå…¬è·¯ä¸Šçš„æ”¶è´¹ç«™ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªæ”¶è´¹å£ï¼Œé‚£æ‰€æœ‰çš„è½¦åªèƒ½æ’æˆä¸€æ¡é˜Ÿç¼´è´¹ï¼›å¦‚æœæœ‰å¤šä¸ªæ”¶è´¹å£ï¼Œå°±å¯ä»¥åˆ†æµäº†ã€‚</p>
<p><code>Hashtable</code>  ä½¿ç”¨  <code>synchronized</code>  ä¿®é¥°æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œé‚£ä¹ˆé¢å¯¹çº¿ç¨‹çš„è®¿é—®ï¼ŒHashtable å°±ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰çš„å…¶å®ƒçº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œè¿™ç§é˜»å¡æ–¹å¼çš„ååé‡æ˜¾ç„¶å¾ˆä½ã€‚</p>
<p>Java 1.7 ä»¥å‰çš„  <code>ConcurrentHashMap</code>  å°±æ˜¯åˆ†æ®µé”çš„å…¸å‹æ¡ˆä¾‹ã€‚ <code>ConcurrentHashMap</code>  ç»´æŠ¤äº†ä¸€ä¸ª  <code>Segment</code>  æ•°ç»„ï¼Œä¸€èˆ¬ç§°ä¸ºåˆ†æ®µæ¡¶ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> segments<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å½“æœ‰çº¿ç¨‹è®¿é—®  <code>ConcurrentHashMap</code>  çš„æ•°æ®æ—¶ï¼Œ <code>ConcurrentHashMap</code>  ä¼šå…ˆæ ¹æ® hashCode è®¡ç®—å‡ºæ•°æ®åœ¨å“ªä¸ªæ¡¶ï¼ˆå³å“ªä¸ª Segmentï¼‰ï¼Œç„¶åé”ä½è¿™ä¸ª  <code>Segment</code> ã€‚</p>
<h3 id="-640"><a class="markdownIt-Anchor" href="#-640">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_1-7-%E6%98%BE%E7%A4%BA%E9%94%81%E5%92%8C%E5%86%85%E7%BD%AE%E9%94%81">#</a>1.7. æ˜¾ç¤ºé”å’Œå†…ç½®é”</h3>
<p>Java 1.5 ä¹‹å‰ï¼Œåè°ƒå¯¹å…±äº«å¯¹è±¡çš„è®¿é—®æ—¶å¯ä»¥ä½¿ç”¨çš„æœºåˆ¶åªæœ‰  <code>synchronized</code>  å’Œ  <code>volatile</code> ã€‚è¿™ä¸¤ä¸ªéƒ½å±äºå†…ç½®é”ï¼Œå³é”çš„ç”³è¯·å’Œé‡Šæ”¾éƒ½æ˜¯ç”± JVM æ‰€æ§åˆ¶ã€‚</p>
<p>Java 1.5 ä¹‹åï¼Œå¢åŠ äº†æ–°çš„æœºåˆ¶ï¼š <code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code>  ï¼Œè¿™ç±»é”çš„ç”³è¯·å’Œé‡Šæ”¾éƒ½å¯ä»¥ç”±ç¨‹åºæ‰€æ§åˆ¶ï¼Œæ‰€ä»¥å¸¸è¢«ç§°ä¸ºæ˜¾ç¤ºé”ã€‚</p>
<blockquote>
<p>ğŸ’¡  <code>synchronized</code>  çš„ç”¨æ³•å’ŒåŸç†å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.md#%E4%BA%8Csynchronized">Java å¹¶å‘åŸºç¡€æœºåˆ¶ - synchronized (opens new window)</a>ã€‚</p>
<p>ğŸ”” æ³¨æ„ï¼šå¦‚æœä¸éœ€è¦  <code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code>  æ‰€æä¾›çš„é«˜çº§åŒæ­¥ç‰¹æ€§ï¼Œ<strong>åº”è¯¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨  <code>synchronized</code> </strong> ã€‚ç†ç”±å¦‚ä¸‹ï¼š</p>
<ul>
<li>Java 1.6 ä»¥åï¼Œ <code>synchronized</code>  åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå…¶æ€§èƒ½å·²ç»ä¸  <code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code>  åŸºæœ¬ä¸ŠæŒå¹³ã€‚</li>
<li>ä»è¶‹åŠ¿æ¥çœ‹ï¼ŒJava æœªæ¥æ›´å¯èƒ½ä¼šä¼˜åŒ–  <code>synchronized</code>  ï¼Œè€Œä¸æ˜¯  <code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code>  ï¼Œå› ä¸º  <code>synchronized</code>  æ˜¯ JVM å†…ç½®å±æ€§ï¼Œå®ƒèƒ½æ‰§è¡Œä¸€äº›ä¼˜åŒ–ã€‚</li>
<li><code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code>  ç”³è¯·å’Œé‡Šæ”¾é”éƒ½æ˜¯ç”±ç¨‹åºæ§åˆ¶ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½é€ æˆæ­»é”ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚</li>
</ul>
</blockquote>
<p>ä»¥ä¸‹å¯¹æ¯”ä¸€ä¸‹æ˜¾ç¤ºé”å’Œå†…ç½®é”çš„å·®å¼‚ï¼š</p>
<ul>
<li>ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”
<ul>
<li><code>synchronized</code>  ä¸èƒ½ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”ã€‚è·å–é”å’Œé‡Šæ”¾é”éƒ½æ˜¯ JVM æ§åˆ¶çš„ã€‚</li>
<li><code>ReentrantLock</code>  å¯ä»¥ä¸»åŠ¨è·å–é”å’Œé‡Šæ”¾é”ã€‚ï¼ˆå¦‚æœå¿˜è®°é‡Šæ”¾é”ï¼Œå°±å¯èƒ½äº§ç”Ÿæ­»é”ï¼‰ã€‚</li>
</ul>
</li>
<li>å“åº”ä¸­æ–­
<ul>
<li><code>synchronized</code>  ä¸èƒ½å“åº”ä¸­æ–­ã€‚</li>
<li><code>ReentrantLock</code>  å¯ä»¥å“åº”ä¸­æ–­ã€‚</li>
</ul>
</li>
<li>è¶…æ—¶æœºåˆ¶
<ul>
<li><code>synchronized</code>  æ²¡æœ‰è¶…æ—¶æœºåˆ¶ã€‚</li>
<li><code>ReentrantLock</code>  æœ‰è¶…æ—¶æœºåˆ¶ã€‚ <code>ReentrantLock</code>  å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œè¶…æ—¶åè‡ªåŠ¨é‡Šæ”¾é”ï¼Œé¿å…ä¸€ç›´ç­‰å¾…ã€‚</li>
</ul>
</li>
<li>æ”¯æŒå…¬å¹³é”
<ul>
<li><code>synchronized</code>  åªæ”¯æŒéå…¬å¹³é”ã€‚</li>
<li><code>ReentrantLock</code>  æ”¯æŒéå…¬å¹³é”å’Œå…¬å¹³é”ã€‚</li>
</ul>
</li>
<li>æ˜¯å¦æ”¯æŒå…±äº«
<ul>
<li>è¢«  <code>synchronized</code>  ä¿®é¥°çš„æ–¹æ³•æˆ–ä»£ç å—ï¼Œåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼ˆç‹¬äº«ï¼‰ã€‚å¦‚æœè¿™ä¸ªçº¿ç¨‹è¢«é˜»å¡ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿåªèƒ½ç­‰å¾…</li>
<li><code>ReentrantLock</code>  å¯ä»¥åŸºäº  <code>Condition</code>  çµæ´»çš„æ§åˆ¶åŒæ­¥æ¡ä»¶ã€‚</li>
</ul>
</li>
<li>æ˜¯å¦æ”¯æŒè¯»å†™åˆ†ç¦»
<ul>
<li><code>synchronized</code>  ä¸æ”¯æŒè¯»å†™é”åˆ†ç¦»ï¼›</li>
<li><code>ReentrantReadWriteLock</code>  æ”¯æŒè¯»å†™é”ï¼Œä»è€Œä½¿é˜»å¡è¯»å†™çš„æ“ä½œåˆ†å¼€ï¼Œæœ‰æ•ˆæé«˜å¹¶å‘æ€§ã€‚</li>
</ul>
</li>
</ul>
<h2 id="-641"><a class="markdownIt-Anchor" href="#-641">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_2-lock-%E5%92%8C-condition">#</a>2. Lock å’Œ Condition</h2>
<h3 id="-642"><a class="markdownIt-Anchor" href="#-642">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_2-1-%E4%B8%BA%E4%BD%95%E5%BC%95%E5%85%A5-lock-%E5%92%8C-condition">#</a>2.1. ä¸ºä½•å¼•å…¥ Lock å’Œ Condition</h3>
<p>å¹¶å‘ç¼–ç¨‹é¢†åŸŸï¼Œæœ‰ä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼šä¸€ä¸ªæ˜¯<strong>äº’æ–¥</strong>ï¼Œå³åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼›å¦ä¸€ä¸ªæ˜¯<strong>åŒæ­¥</strong>ï¼Œå³çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ã€åä½œã€‚è¿™ä¸¤å¤§é—®é¢˜ï¼Œç®¡ç¨‹éƒ½æ˜¯èƒ½å¤Ÿè§£å†³çš„ã€‚<strong>Java SDK å¹¶å‘åŒ…é€šè¿‡ Lock å’Œ Condition ä¸¤ä¸ªæ¥å£æ¥å®ç°ç®¡ç¨‹ï¼Œå…¶ä¸­ Lock ç”¨äºè§£å†³äº’æ–¥é—®é¢˜ï¼ŒCondition ç”¨äºè§£å†³åŒæ­¥é—®é¢˜</strong>ã€‚</p>
<p>synchronized æ˜¯ç®¡ç¨‹çš„ä¸€ç§å®ç°ï¼Œæ—¢ç„¶å¦‚æ­¤ï¼Œä½•å¿…å†æä¾› Lock å’Œ Conditionã€‚</p>
<p>JDK 1.6 ä»¥å‰ï¼Œsynchronized è¿˜æ²¡æœ‰åšä¼˜åŒ–ï¼Œæ€§èƒ½è¿œä½äº Lockã€‚ä½†æ˜¯ï¼Œæ€§èƒ½ä¸æ˜¯å¼•å…¥ Lock çš„æœ€é‡è¦å› ç´ ã€‚çœŸæ­£å…³é”®åœ¨äºï¼šsynchronized ä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”ã€‚</p>
<p>synchronized æ— æ³•é€šè¿‡<strong>ç ´åä¸å¯æŠ¢å æ¡ä»¶</strong>æ¥é¿å…æ­»é”ã€‚åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå•¥éƒ½å¹²ä¸äº†ï¼Œä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æºã€‚</p>
<p>ä¸å†…ç½®é”  <code>synchronized</code>  ä¸åŒçš„æ˜¯ï¼Œ<strong> <code>Lock</code>  æä¾›äº†ä¸€ç»„æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ã€å®šæ—¶çš„ä»¥åŠå¯ä¸­æ–­çš„é”æ“ä½œ</strong>ï¼Œæ‰€æœ‰è·å–é”ã€é‡Šæ”¾é”çš„æ“ä½œéƒ½æ˜¯æ˜¾å¼çš„æ“ä½œã€‚</p>
<ul>
<li><strong>èƒ½å¤Ÿå“åº”ä¸­æ–­</strong>ã€‚synchronized çš„é—®é¢˜æ˜¯ï¼ŒæŒæœ‰é” A åï¼Œå¦‚æœå°è¯•è·å–é” B å¤±è´¥ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚ä½†å¦‚æœé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå”¤é†’å®ƒï¼Œé‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” Aã€‚è¿™æ ·å°±ç ´åäº†ä¸å¯æŠ¢å æ¡ä»¶äº†ã€‚</li>
<li><strong>æ”¯æŒè¶…æ—¶</strong>ã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚</li>
<li><strong>éé˜»å¡åœ°è·å–é”</strong>ã€‚å¦‚æœå°è¯•è·å–é”å¤±è´¥ï¼Œå¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚è¿™æ ·ä¹Ÿèƒ½ç ´åä¸å¯æŠ¢å æ¡ä»¶ã€‚</li>
</ul>
<h3 id="-643"><a class="markdownIt-Anchor" href="#-643">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_2-2-lock-%E6%8E%A5%E5%8F%A3">#</a>2.2. Lock æ¥å£</h3>
<p><code>Lock</code>  çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Lock</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Condition</span> <span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>lock()</code>  - è·å–é”ã€‚</li>
<li><code>unlock()</code>  - é‡Šæ”¾é”ã€‚</li>
<li><code>tryLock()</code>  - å°è¯•è·å–é”ï¼Œä»…åœ¨è°ƒç”¨æ—¶é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰çš„æƒ…å†µä¸‹ï¼Œæ‰è·å–è¯¥é”ã€‚</li>
<li><code>tryLock(long time, TimeUnit unit)</code>  - å’Œ  <code>tryLock()</code>  ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºé™å®šæ—¶é—´ï¼Œå¦‚æœé™å®šæ—¶é—´å†…æœªè·å–åˆ°é”ï¼Œè§†ä¸ºå¤±è´¥ã€‚</li>
<li><code>lockInterruptibly()</code>  - é”æœªè¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œä¸”çº¿ç¨‹æ²¡æœ‰è¢«ä¸­æ–­çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½è·å–é”ã€‚</li>
<li><code>newCondition()</code>  - è¿”å›ä¸€ä¸ªç»‘å®šåˆ°  <code>Lock</code>  å¯¹è±¡ä¸Šçš„  <code>Condition</code>  å®ä¾‹ã€‚</li>
</ul>
<h3 id="-644"><a class="markdownIt-Anchor" href="#-644">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_2-3-condition">#</a>2.3. Condition</h3>
<p><strong>Condition å®ç°äº†ç®¡ç¨‹æ¨¡å‹é‡Œé¢çš„æ¡ä»¶å˜é‡</strong>ã€‚</p>
<p>å‰æ–‡ä¸­æè¿‡  <code>Lock</code>  æ¥å£ä¸­ æœ‰ä¸€ä¸ª  <code>newCondition()</code>  æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªç»‘å®šåˆ°  <code>Lock</code>  å¯¹è±¡ä¸Šçš„  <code>Condition</code>  å®ä¾‹ã€‚ <code>Condition</code>  æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿæœ¬èŠ‚å°†ä¸€ä¸€è®²è§£ã€‚</p>
<p>åœ¨å•çº¿ç¨‹ä¸­ï¼Œä¸€æ®µä»£ç çš„æ‰§è¡Œå¯èƒ½ä¾èµ–äºæŸä¸ªçŠ¶æ€ï¼Œå¦‚æœä¸æ»¡è¶³çŠ¶æ€æ¡ä»¶ï¼Œä»£ç å°±ä¸ä¼šè¢«æ‰§è¡Œï¼ˆå…¸å‹çš„åœºæ™¯ï¼Œå¦‚ï¼š <code>if ... else ...</code> ï¼‰ã€‚åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­æŸä¸ªçŠ¶æ€æ¡ä»¶æ—¶ï¼Œå…¶çŠ¶æ€å¯èƒ½æ˜¯ç”±äºå…¶ä»–çº¿ç¨‹çš„æ“ä½œè€Œæ”¹å˜ï¼Œè¿™æ—¶å°±éœ€è¦æœ‰ä¸€å®šçš„åè°ƒæœºåˆ¶æ¥ç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»ï¼Œæ•°æ®åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”ä¿®æ”¹ï¼Œä¸”ä¿®æ”¹çš„æ•°æ®çŠ¶æ€è¢«æ‰€æœ‰çº¿ç¨‹æ‰€æ„ŸçŸ¥ã€‚</p>
<p>Java 1.5 ä¹‹å‰ï¼Œä¸»è¦æ˜¯åˆ©ç”¨  <code>Object</code>  ç±»ä¸­çš„  <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  é…åˆ  <code>synchronized</code>  æ¥è¿›è¡Œçº¿ç¨‹é—´é€šä¿¡ï¼ˆå¦‚æœä¸äº†è§£å…¶ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/#/concurrent/java-thread?id=waitnotifynotifyall">Java çº¿ç¨‹åŸºç¡€ - wait/notify/notifyAll (opens new window)</a>ï¼‰ã€‚</p>
<p><code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  éœ€è¦é…åˆ  <code>synchronized</code>  ä½¿ç”¨ï¼Œä¸é€‚ç”¨äº  <code>Lock</code> ã€‚è€Œä½¿ç”¨  <code>Lock</code>  çš„çº¿ç¨‹ï¼Œå½¼æ­¤é—´é€šä¿¡åº”è¯¥ä½¿ç”¨  <code>Condition</code>  ã€‚è¿™å¯ä»¥ç†è§£ä¸ºï¼Œä»€ä¹ˆæ ·çš„é”é…ä»€ä¹ˆæ ·çš„é’¥åŒ™ã€‚<strong>å†…ç½®é”ï¼ˆ <code>synchronized</code> ï¼‰é…åˆå†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  ï¼‰ï¼Œæ˜¾å¼é”ï¼ˆ <code>Lock</code> ï¼‰é…åˆæ˜¾å¼æ¡ä»¶é˜Ÿåˆ—ï¼ˆ <code>Condition</code>  ï¼‰</strong>ã€‚</p>
<h4 id="-645"><a class="markdownIt-Anchor" href="#-645">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#condition-%E7%9A%84%E7%89%B9%E6%80%A7">#</a>Condition çš„ç‰¹æ€§</h4>
<p><code>Condition</code>  æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Condition</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">void</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">awaitUninterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token function">awaitNanos</span><span class="token punctuation">(</span><span class="token keyword">long</span> nanosTimeout<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> <span class="token function">awaitUntil</span><span class="token punctuation">(</span><span class="token class-name">Date</span> deadline<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­ï¼Œ <code>await</code> ã€ <code>signal</code> ã€ <code>signalAll</code>  ä¸  <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  ç›¸å¯¹åº”ï¼ŒåŠŸèƒ½ä¹Ÿç›¸ä¼¼ã€‚é™¤æ­¤ä»¥å¤–ï¼Œ <code>Condition</code>  ç›¸æ¯”å†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ  <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  ï¼‰ï¼Œæä¾›äº†æ›´ä¸ºä¸°å¯Œçš„åŠŸèƒ½ï¼š</p>
<ul>
<li>æ¯ä¸ªé”ï¼ˆ <code>Lock</code> ï¼‰ä¸Šå¯ä»¥å­˜åœ¨å¤šä¸ª  <code>Condition</code> ï¼Œè¿™æ„å‘³ç€é”çš„çŠ¶æ€æ¡ä»¶å¯ä»¥æœ‰å¤šä¸ªã€‚</li>
<li>æ”¯æŒå…¬å¹³çš„æˆ–éå…¬å¹³çš„é˜Ÿåˆ—æ“ä½œã€‚</li>
<li>æ”¯æŒå¯ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š <code>awaitUninterruptibly()</code>  ã€‚</li>
<li>æ”¯æŒå¯å®šæ—¶çš„ç­‰å¾…ï¼Œç›¸å…³æ–¹æ³•ï¼š <code>awaitNanos(long)</code>  ã€ <code>await(long, TimeUnit)</code> ã€ <code>awaitUntil(Date)</code> ã€‚</li>
</ul>
<h4 id="-646"><a class="markdownIt-Anchor" href="#-646">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#condition-%E7%9A%84%E7%94%A8%E6%B3%95">#</a>Condition çš„ç”¨æ³•</h4>
<p>è¿™é‡Œä»¥  <code>Condition</code>  æ¥å®ç°ä¸€ä¸ªæ¶ˆè´¹è€…ã€ç”Ÿäº§è€…æ¨¡å¼ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šäº‹å®ä¸Šï¼Œè§£å†³æ­¤ç±»é—®é¢˜ä½¿ç”¨  <code>CountDownLatch</code> ã€ <code>Semaphore</code>  ç­‰å·¥å…·æ›´ä¸ºä¾¿æ·ã€å®‰å…¨ã€‚æƒ³äº†è§£è¯¦æƒ…ï¼Œå¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/#/concurrent/java-concurrent-tools">Java å¹¶å‘å·¥å…·ç±» (opens new window)</a>ã€‚</p>
</blockquote>
<p>äº§å“ç±»</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Message</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> producedMsg <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> consumedMsg <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> state<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> end<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">consume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//lock</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// no new message wait for new message</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> producedMsg<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"consume message : "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">// message consumed, notify waiting thread</span>
            consumedMsg<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread interrupted - viewMessage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// last message not consumed, wait for it be consumed</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> consumedMsg<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"produce msg: "</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
            state <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment">// new message added, notify waiting thread</span>
            producedMsg<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ie<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Thread interrupted - publishMessage"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEnd</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ¶ˆè´¹è€…</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">MessageConsumer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">Message</span> message<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MessageConsumer</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        message <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>message<span class="token punctuation">.</span><span class="token function">isEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> message<span class="token punctuation">.</span><span class="token function">consume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”Ÿäº§è€…</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">MessageProducer</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">Message</span> message<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MessageProducer</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        message <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">produce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> msgs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msgs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Begin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msgs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Msg1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msgs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Msg2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> msg <span class="token operator">:</span> msgs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            message<span class="token punctuation">.</span><span class="token function">produce</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        message<span class="token punctuation">.</span><span class="token function">produce</span><span class="token punctuation">(</span><span class="token string">"End"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        message<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æµ‹è¯•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockConditionDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageProducer</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MessageConsumer</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        producer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        consumer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-647"><a class="markdownIt-Anchor" href="#-647">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_3-reentrantlock">#</a>3. ReentrantLock</h2>
<p><code>ReentrantLock</code>  ç±»æ˜¯  <code>Lock</code>  æ¥å£çš„å…·ä½“å®ç°ï¼Œä¸å†…ç½®é”  <code>synchronized</code>  ç›¸åŒçš„æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>å¯é‡å…¥é”</strong>ã€‚</p>
<h3 id="-648"><a class="markdownIt-Anchor" href="#-648">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_3-1-reentrantlock-%E7%9A%84%E7%89%B9%E6%80%A7">#</a>3.1. ReentrantLock çš„ç‰¹æ€§</h3>
<p><code>ReentrantLock</code>  çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong> <code>ReentrantLock</code>  æä¾›äº†ä¸  <code>synchronized</code>  ç›¸åŒçš„äº’æ–¥æ€§ã€å†…å­˜å¯è§æ€§å’Œå¯é‡å…¥æ€§</strong>ã€‚</p>
</li>
<li>
<p><code>ReentrantLock</code>  <strong>æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”</strong>ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚</p>
</li>
<li>
<pre><code>  ReentrantLock
  <pre class="line-numbers language-none"><code class="language-none">
 

å®ç°äº†

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  Lock
  <pre class="line-numbers language-none"><code class="language-none">
 

æ¥å£ï¼Œæ”¯æŒäº†

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  synchronized
  <pre class="line-numbers language-none"><code class="language-none">
	 

	æ‰€ä¸å…·å¤‡çš„

	çµæ´»æ€§

	ã€‚

	- &#96;synchronized&#96; æ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹
	- &#96;synchronized&#96; æ— æ³•åœ¨è¯·æ±‚è·å–ä¸€ä¸ªé”æ—¶æ— ä¼‘æ­¢åœ°ç­‰å¾…

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#_3-2-reentrantlock-çš„ç”¨æ³•)3.2. ReentrantLock çš„ç”¨æ³•

å‰æ–‡äº†è§£äº† &#96;ReentrantLock&#96; çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è®²è¿°å…¶å…·ä½“ç”¨æ³•ã€‚

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#reentrantlock-çš„æ„é€ æ–¹æ³•)ReentrantLock çš„æ„é€ æ–¹æ³•

&#96;ReentrantLock&#96; æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼š

&#96;&#96;&#96;java
public ReentrantLock() &#123;&#125;
public ReentrantLock(boolean fair) &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
<li>
<p><code>ReentrantLock()</code>  - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª<strong>éå…¬å¹³é”ï¼ˆNonfairSyncï¼‰</strong>ï¼›</p>
</li>
<li>
<p><code>ReentrantLock(boolean)</code>  -  <code>new ReentrantLock(true)</code>  ä¼šåˆå§‹åŒ–ä¸€ä¸ª<strong>å…¬å¹³é”ï¼ˆFairSyncï¼‰</strong>ã€‚</p>
</li>
</ul>
<h4 id="-649"><a class="markdownIt-Anchor" href="#-649">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#lock-%E5%92%8C-unlock-%E6%96%B9%E6%B3%95">#</a>lock å’Œ unlock æ–¹æ³•</h4>
<ul>
<li><code>lock()</code>  - <strong>æ— æ¡ä»¶è·å–é”</strong>ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ— æ³•è·å–é”ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ çŠ¶æ€ä¸å¯ç”¨ï¼Œç›´è‡³å½“å‰çº¿ç¨‹è·å–åˆ°é”ã€‚å¦‚æœè¯¥é”æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ï¼Œåˆ™è·å–è¯¥é”å¹¶ç«‹å³è¿”å›ï¼Œå°†é”çš„æŒæœ‰è®¡æ•°è®¾ç½®ä¸º 1ã€‚</li>
<li><code>unlock()</code>  - ç”¨äº<strong>é‡Šæ”¾é”</strong>ã€‚</li>
</ul>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šè¯·åŠ¡å¿…ç‰¢è®°ï¼Œè·å–é”æ“ä½œ <strong> <code>lock()</code>  å¿…é¡»åœ¨  <code>try catch</code>  å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”æ“ä½œ  <code>unlock()</code>  æ”¾åœ¨  <code>finally</code>  å—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿ</strong>ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ï¼š <code>ReentrantLock</code>  çš„åŸºæœ¬æ“ä½œ</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantLockDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Task</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyThread</span> tA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"Thread-A"</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyThread</span> tB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"Thread-B"</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MyThread</span> tC <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token string">"Thread-C"</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tA<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tB<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tC<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">Task</span> task<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Task</span> task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>task <span class="token operator">=</span> task<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            task<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// æŸ¥è¯¢å½“å‰çº¿ç¨‹ hold ä½æ­¤é”çš„æ¬¡æ•°</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\t holdCount: "</span> <span class="token operator">+</span> lock<span class="token punctuation">.</span><span class="token function">getHoldCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// æŸ¥è¯¢æ­£ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹æ•°</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\t queuedLength: "</span> <span class="token operator">+</span> lock<span class="token punctuation">.</span><span class="token function">getQueueLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// æ˜¯å¦ä¸ºå…¬å¹³é”</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\t isFair: "</span> <span class="token operator">+</span> lock<span class="token punctuation">.</span><span class="token function">isFair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// æ˜¯å¦è¢«é”ä½</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\t isLocked: "</span> <span class="token operator">+</span> lock<span class="token punctuation">.</span><span class="token function">isLocked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰é”</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\t isHeldByCurrentThread: "</span> <span class="token operator">+</span> lock<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºç»“æœï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>ReentrantLock</span><span class="token annotation punctuation">@64fcd88a</span><span class="token punctuation">[</span><span class="token class-name">Locked</span> by thread <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token class-name">A</span><span class="token punctuation">]</span>
	 holdCount<span class="token operator">:</span> <span class="token number">1</span>
	 queuedLength<span class="token operator">:</span> <span class="token number">2</span>
	 isFair<span class="token operator">:</span> <span class="token boolean">false</span>
	 isLocked<span class="token operator">:</span> <span class="token boolean">true</span>
	 isHeldByCurrentThread<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>ReentrantLock</span><span class="token annotation punctuation">@64fcd88a</span><span class="token punctuation">[</span><span class="token class-name">Locked</span> by thread <span class="token class-name">Thread</span><span class="token operator">-</span><span class="token class-name">C</span><span class="token punctuation">]</span>
	 holdCount<span class="token operator">:</span> <span class="token number">1</span>
	 queuedLength<span class="token operator">:</span> <span class="token number">1</span>
	 isFair<span class="token operator">:</span> <span class="token boolean">false</span>
	 isLocked<span class="token operator">:</span> <span class="token boolean">true</span>
	 isHeldByCurrentThread<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token comment">// ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-650"><a class="markdownIt-Anchor" href="#-650">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#trylock-%E6%96%B9%E6%B3%95">#</a>tryLock æ–¹æ³•</h4>
<p>ä¸æ— æ¡ä»¶è·å–é”ç›¸æ¯”ï¼ŒtryLock æœ‰æ›´å®Œå–„çš„å®¹é”™æœºåˆ¶ã€‚</p>
<ul>
<li><code>tryLock()</code>  - <strong>å¯è½®è¯¢è·å–é”</strong>ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•<strong>æ— è®ºæˆè´¥éƒ½ä¼šç«‹å³è¿”å›</strong>ï¼Œè·å–ä¸åˆ°é”ï¼ˆé”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰æ—¶ä¸ä¼šä¸€ç›´ç­‰å¾…ã€‚</li>
<li><code>tryLock(long, TimeUnit)</code>  - <strong>å¯å®šæ—¶è·å–é”</strong>ã€‚å’Œ  <code>tryLock()</code>  ç±»ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨<strong>è·å–ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´</strong>ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜è·å–ä¸åˆ°é”ï¼Œå°±è¿”å› falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å› trueã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š <code>ReentrantLock</code>  çš„  <code>tryLock()</code>  æ“ä½œ</p>
<p>ä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„  <code>execute()</code>  æ–¹æ³•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
               <span class="token comment">// ç•¥...</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" è·å–é”å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç¤ºä¾‹ï¼š <code>ReentrantLock</code>  çš„  <code>tryLock(long, TimeUnit)</code>  æ“ä½œ</p>
<p>ä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„  <code>execute()</code>  æ–¹æ³•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// ç•¥...</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" è·å–é”å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" è·å–é”è¶…æ—¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-651"><a class="markdownIt-Anchor" href="#-651">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#lockinterruptibly-%E6%96%B9%E6%B3%95">#</a>lockInterruptibly æ–¹æ³•</h4>
<ul>
<li>
<pre><code>  lockInterruptibly()
  <pre class="line-numbers language-none"><code class="language-none">
 

\-

 

å¯ä¸­æ–­è·å–é”

ã€‚å¯ä¸­æ–­è·å–é”å¯ä»¥åœ¨è·å¾—é”çš„åŒæ—¶ä¿æŒå¯¹ä¸­æ–­çš„å“åº”ã€‚å¯ä¸­æ–­è·å–é”æ¯”å…¶å®ƒè·å–é”çš„æ–¹å¼ç¨å¾®å¤æ‚ä¸€äº›ï¼Œéœ€è¦ä¸¤ä¸ª

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  try-catch
  <pre class="line-numbers language-none"><code class="language-none">
 

å—ï¼ˆå¦‚æœåœ¨è·å–é”çš„æ“ä½œä¸­æŠ›å‡ºäº†

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  InterruptedException
  <pre class="line-numbers language-none"><code class="language-none">
 

ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ ‡å‡†çš„

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  try-finally
  <pre class="line-numbers language-none"><code class="language-none">
	 

	åŠ é”æ¨¡å¼ï¼‰ã€‚

	- ä¸¾ä¾‹æ¥è¯´ï¼šå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ &#96;lock.lockInterruptibly()&#96; è·å–æŸä¸ªé”æ—¶ï¼Œè‹¥çº¿ç¨‹ A è·å–åˆ°äº†é”ï¼Œåˆ™çº¿ç¨‹ B åªèƒ½ç­‰å¾…ã€‚è‹¥æ­¤æ—¶å¯¹çº¿ç¨‹ B è°ƒç”¨ &#96;threadB.interrupt()&#96; æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹ B çš„ç­‰å¾…è¿‡ç¨‹ã€‚ç”±äº &#96;lockInterruptibly()&#96; çš„å£°æ˜ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥ &#96;lock.lockInterruptibly()&#96; å¿…é¡»æ”¾åœ¨ &#96;try&#96; å—ä¸­æˆ–è€…åœ¨è°ƒç”¨ &#96;lockInterruptibly()&#96; çš„æ–¹æ³•å¤–å£°æ˜æŠ›å‡º &#96;InterruptedException&#96;ã€‚

&gt; ğŸ”” æ³¨æ„ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢« &#96;interrupt()&#96; æ–¹æ³•ä¸­æ–­çš„ã€‚å•ç‹¬è°ƒç”¨ &#96;interrupt()&#96; æ–¹æ³•ä¸èƒ½ä¸­æ–­æ­£åœ¨è¿è¡ŒçŠ¶æ€ä¸­çš„çº¿ç¨‹ï¼Œåªèƒ½ä¸­æ–­é˜»å¡çŠ¶æ€ä¸­çš„çº¿ç¨‹ã€‚å› æ­¤å½“é€šè¿‡ &#96;lockInterruptibly()&#96; æ–¹æ³•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœæœªè·å–åˆ°é”ï¼Œåªæœ‰åœ¨ç­‰å¾…çš„çŠ¶æ€ä¸‹ï¼Œæ‰å¯ä»¥å“åº”ä¸­æ–­ã€‚

ç¤ºä¾‹ï¼š&#96;ReentrantLock&#96; çš„ &#96;lockInterruptibly()&#96; æ“ä½œ

ä¿®æ”¹ä¸Šä¸ªç¤ºä¾‹ä¸­çš„ &#96;execute()&#96; æ–¹æ³•

&#96;&#96;&#96;java
public void execute() &#123;
    try &#123;
        lock.lockInterruptibly();

        for (int i &#x3D; 0; i &lt; 3; i++) &#123;
            &#x2F;&#x2F; ç•¥...
        &#125;
    &#125; catch (InterruptedException e) &#123;
        System.out.println(Thread.currentThread().getName() + &quot;è¢«ä¸­æ–­&quot;);
        e.printStackTrace();
    &#125; finally &#123;
        lock.unlock();
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<h4 id="-652"><a class="markdownIt-Anchor" href="#-652">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#newcondition-%E6%96%B9%E6%B3%95">#</a>newCondition æ–¹æ³•</h4>
<p><code>newCondition()</code>  - è¿”å›ä¸€ä¸ªç»‘å®šåˆ°  <code>Lock</code>  å¯¹è±¡ä¸Šçš„  <code>Condition</code>  å®ä¾‹ã€‚ <code>Condition</code>  çš„ç‰¹æ€§å’Œå…·ä½“æ–¹æ³•è¯·é˜…è¯»ä¸‹æ–‡ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#%E4%BA%94condition"> <code>Condition</code> </a>ã€‚</p>
<h3 id="-653"><a class="markdownIt-Anchor" href="#-653">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_3-3-reentrantlock-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>3.3. ReentrantLock çš„åŸç†</h3>
<h4 id="-654"><a class="markdownIt-Anchor" href="#-654">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantlock-%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7">#</a>ReentrantLock çš„å¯è§æ€§</h4>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">class X &#123;
  private final Lock rtl =
  new ReentrantLock();
  int value;
  public void addOne() &#123;
    // è·å–é”
    rtl.lock();
    try &#123;
      value+=1;
    &#125; finally &#123;
      // ä¿è¯é”èƒ½é‡Šæ”¾
      rtl.unlock();
    &#125;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ReentrantLockï¼Œå†…éƒ¨æŒæœ‰ä¸€ä¸ª volatile çš„æˆå‘˜å˜é‡ stateï¼Œè·å–é”çš„æ—¶å€™ï¼Œä¼šè¯»å†™ state çš„å€¼ï¼›è§£é”çš„æ—¶å€™ï¼Œä¹Ÿä¼šè¯»å†™ state çš„å€¼ï¼ˆç®€åŒ–åçš„ä»£ç å¦‚ä¸‹é¢æ‰€ç¤ºï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œ value+=1 ä¹‹å‰ï¼Œç¨‹åºå…ˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ stateï¼Œåœ¨æ‰§è¡Œ value+=1 ä¹‹åï¼Œåˆè¯»å†™äº†ä¸€æ¬¡ volatile å˜é‡ stateã€‚æ ¹æ®ç›¸å…³çš„ Happens-Before è§„åˆ™ï¼š</p>
<ol>
<li><strong>é¡ºåºæ€§è§„åˆ™</strong>ï¼šå¯¹äºçº¿ç¨‹ T1ï¼Œvalue+=1 Happens-Before é‡Šæ”¾é”çš„æ“ä½œ unlock ()ï¼›</li>
<li><strong>volatile å˜é‡è§„åˆ™</strong>ï¼šç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock () æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock () æ“ä½œï¼›</li>
<li><strong>ä¼ é€’æ€§è§„åˆ™</strong>ï¼šçº¿ç¨‹ T1 çš„ value+=1 Happens-Before çº¿ç¨‹ T2 çš„ lock () æ“ä½œã€‚</li>
</ol>
<h4 id="-655"><a class="markdownIt-Anchor" href="#-655">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantlock-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">#</a>ReentrantLock çš„æ•°æ®ç»“æ„</h4>
<p>é˜…è¯»  <code>ReentrantLock</code>  çš„æºç ï¼Œå¯ä»¥å‘ç°å®ƒæœ‰ä¸€ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Sync</span> sync<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>sync</code>  - å†…éƒ¨æŠ½è±¡ç±»  <code>ReentrantLock.Sync</code>  å¯¹è±¡ï¼Œ <code>Sync</code>  ç»§æ‰¿è‡ª AQSã€‚å®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š</li>
<li><code>ReentrantLock.FairSync</code>  - å…¬å¹³é”ã€‚</li>
<li><code>ReentrantLock.NonfairSync</code>  - éå…¬å¹³é”ã€‚</li>
</ul>
<p>æŸ¥çœ‹æºç å¯ä»¥å‘ç°ï¼Œ <code>ReentrantLock</code>  å®ç°  <code>Lock</code>  æ¥å£å…¶å®æ˜¯è°ƒç”¨  <code>ReentrantLock.FairSync</code>  æˆ–  <code>ReentrantLock.NonfairSync</code>  ä¸­å„è‡ªçš„å®ç°ï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ã€‚</p>
<h4 id="-656"><a class="markdownIt-Anchor" href="#-656">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantlock-%E7%9A%84%E8%8E%B7%E5%8F%96%E9%94%81%E5%92%8C%E9%87%8A%E6%94%BE%E9%94%81">#</a>ReentrantLock çš„è·å–é”å’Œé‡Šæ”¾é”</h4>
<p>ReentrantLock è·å–é”å’Œé‡Šæ”¾é”çš„æ¥å£ï¼Œä»è¡¨è±¡çœ‹ï¼Œæ˜¯è°ƒç”¨  <code>ReentrantLock.FairSync</code>  æˆ–  <code>ReentrantLock.NonfairSync</code>  ä¸­å„è‡ªçš„å®ç°ï¼›ä»æœ¬è´¨ä¸Šçœ‹ï¼Œæ˜¯åŸºäº AQS çš„å®ç°ã€‚</p>
<p>ä»”ç»†é˜…è¯»æºç å¾ˆå®¹æ˜“å‘ç°ï¼š</p>
<ul>
<li><code>void lock()</code>  è°ƒç”¨ Sync çš„ lock () æ–¹æ³•ã€‚</li>
<li><code>void lockInterruptibly()</code>  ç›´æ¥è°ƒç”¨ AQS çš„ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#%E8%8E%B7%E5%8F%96%E5%8F%AF%E4%B8%AD%E6%96%AD%E7%9A%84%E7%8B%AC%E5%8D%A0%E9%94%81">è·å–å¯ä¸­æ–­çš„ç‹¬å é”</a> æ–¹æ³•  <code>lockInterruptibly()</code> ã€‚</li>
<li><code>boolean tryLock()</code>  è°ƒç”¨ Sync çš„  <code>nonfairTryAcquire()</code>  ã€‚</li>
<li><code>boolean tryLock(long time, TimeUnit unit)</code>  ç›´æ¥è°ƒç”¨ AQS çš„ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#%E8%8E%B7%E5%8F%96%E8%B6%85%E6%97%B6%E7%AD%89%E5%BE%85%E5%BC%8F%E7%9A%84%E7%8B%AC%E5%8D%A0%E9%94%81">è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”</a> æ–¹æ³•  <code>tryAcquireNanos(int arg, long nanosTimeout)</code> ã€‚</li>
<li><code>void unlock()</code>  ç›´æ¥è°ƒç”¨ AQS çš„ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#%E9%87%8A%E6%94%BE%E7%8B%AC%E5%8D%A0%E9%94%81">é‡Šæ”¾ç‹¬å é”</a> æ–¹æ³•  <code>release(int arg)</code>  ã€‚</li>
</ul>
<p>ç›´æ¥è°ƒç”¨ AQS æ¥å£çš„æ–¹æ³•å°±ä¸å†èµ˜è¿°äº†ï¼Œå…¶åŸç†åœ¨ [AQS çš„åŸç†](#AQS çš„åŸç†) ä¸­å·²ç»ç”¨å¾ˆå¤§ç¯‡å¹…è¿›è¡Œè¿‡è®²è§£ã€‚</p>
<p><code>nonfairTryAcquire</code>  æ–¹æ³•æºç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å…¬å¹³é”å’Œéå…¬å¹³é”éƒ½ä¼šç”¨è¿™ä¸ªæ–¹æ³•åŒºå°è¯•è·å–é”</span>
<span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">nonfairTryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> acquires<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> acquires<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token comment">// å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0ï¼Œå°†å…¶è®¾ä¸º acquiresï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹</span>
            <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token function">getExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span> nextc <span class="token operator">=</span> c <span class="token operator">+</span> acquires<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nextc <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// overflow</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Maximum lock count exceeded"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setState</span><span class="token punctuation">(</span>nextc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¤„ç†æµç¨‹å¾ˆç®€å•ï¼š</p>
<ul>
<li>å¦‚æœåŒæ­¥çŠ¶æ€ä¸º 0ï¼Œè®¾ç½®åŒæ­¥çŠ¶æ€è®¾ä¸º acquiresï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹ï¼Œç„¶åè¿”å› trueï¼Œè·å–é”æˆåŠŸã€‚</li>
<li>å¦‚æœåŒæ­¥çŠ¶æ€ä¸ä¸º 0 ä¸”å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹ï¼Œè®¾ç½®åŒæ­¥çŠ¶æ€ä¸ºå½“å‰çŠ¶æ€å€¼ + acquires å€¼ï¼Œç„¶åè¿”å› trueï¼Œè·å–é”æˆåŠŸã€‚</li>
<li>å¦åˆ™ï¼Œè¿”å› falseï¼Œè·å–é”å¤±è´¥ã€‚</li>
</ul>
<h4 id="-657"><a class="markdownIt-Anchor" href="#-657">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#%E5%85%AC%E5%B9%B3%E9%94%81%E5%92%8C%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81">#</a>å…¬å¹³é”å’Œéå…¬å¹³é”</h4>
<p>ReentrantLock è¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯ä¼ å…¥ fair å‚æ•°çš„æ„é€ å‡½æ•°ã€‚fair å‚æ•°ä»£è¡¨çš„æ˜¯é”çš„å…¬å¹³ç­–ç•¥ï¼Œå¦‚æœä¼ å…¥ true å°±è¡¨ç¤ºéœ€è¦æ„é€ ä¸€ä¸ªå…¬å¹³é”ï¼Œåä¹‹åˆ™è¡¨ç¤ºè¦æ„é€ ä¸€ä¸ªéå…¬å¹³é”ã€‚</p>
<p>é”éƒ½å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰è·å¾—é”ï¼Œå°±ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå½“æœ‰çº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå°±éœ€è¦ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹ã€‚å¦‚æœæ˜¯å…¬å¹³é”ï¼Œå”¤é†’çš„ç­–ç•¥å°±æ˜¯è°ç­‰å¾…çš„æ—¶é—´é•¿ï¼Œå°±å”¤é†’è°ï¼Œå¾ˆå…¬å¹³ï¼›å¦‚æœæ˜¯éå…¬å¹³é”ï¼Œåˆ™ä¸æä¾›è¿™ä¸ªå…¬å¹³ä¿è¯ï¼Œæœ‰å¯èƒ½ç­‰å¾…æ—¶é—´çŸ­çš„çº¿ç¨‹åè€Œå…ˆè¢«å”¤é†’ã€‚</p>
<p>lock æ–¹æ³•åœ¨å…¬å¹³é”å’Œéå…¬å¹³é”ä¸­çš„å®ç°ï¼š</p>
<p>äºŒè€…çš„åŒºåˆ«ä»…åœ¨äºç”³è¯·éå…¬å¹³é”æ—¶ï¼Œå¦‚æœåŒæ­¥çŠ¶æ€ä¸º 0ï¼Œå°è¯•å°†å…¶è®¾ä¸º 1ï¼Œå¦‚æœæˆåŠŸï¼Œç›´æ¥å°†å½“å‰çº¿ç¨‹ç½®ä¸ºæ’å®ƒçº¿ç¨‹ï¼›å¦åˆ™å’Œå…¬å¹³é”ä¸€æ ·ï¼Œè°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³•  <code>acquire</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// éå…¬å¹³é”å®ç°</span>
<span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compareAndSetState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0ï¼Œå°†å…¶è®¾ä¸º1ï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºæ’å®ƒçº¿ç¨‹</span>
        <span class="token function">setExclusiveOwnerThread</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
    <span class="token comment">// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• acquire</span>
        <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// å…¬å¹³é”å®ç°</span>
<span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³• acquire</span>
    <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-658"><a class="markdownIt-Anchor" href="#-658">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_4-reentrantreadwritelock">#</a>4. ReentrantReadWriteLock</h2>
<p><code>ReadWriteLock</code>  é€‚ç”¨äº<strong>è¯»å¤šå†™å°‘çš„åœºæ™¯</strong>ã€‚</p>
<p><code>ReentrantReadWriteLock</code>  ç±»æ˜¯  <code>ReadWriteLock</code>  æ¥å£çš„å…·ä½“å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯é‡å…¥çš„è¯»å†™é”ã€‚ <code>ReentrantReadWriteLock</code>  ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼Œå°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚</p>
<p>è¯»å†™é”ï¼Œå¹¶ä¸æ˜¯ Java è¯­è¨€ç‰¹æœ‰çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªå¹¿ä¸ºä½¿ç”¨çš„é€šç”¨æŠ€æœ¯ï¼Œæ‰€æœ‰çš„è¯»å†™é”éƒ½éµå®ˆä»¥ä¸‹ä¸‰æ¡åŸºæœ¬åŸåˆ™ï¼š</p>
<ul>
<li>å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡ï¼›</li>
<li>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…±äº«å˜é‡ï¼›</li>
<li>å¦‚æœä¸€ä¸ªå†™çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå†™æ“ä½œï¼Œæ­¤æ—¶ç¦æ­¢è¯»çº¿ç¨‹è¯»å…±äº«å˜é‡ã€‚</li>
</ul>
<p>è¯»å†™é”ä¸äº’æ–¥é”çš„ä¸€ä¸ªé‡è¦åŒºåˆ«å°±æ˜¯<strong>è¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«å˜é‡</strong>ï¼Œè€Œäº’æ–¥é”æ˜¯ä¸å…è®¸çš„ï¼Œè¿™æ˜¯è¯»å†™é”åœ¨è¯»å¤šå†™å°‘åœºæ™¯ä¸‹æ€§èƒ½ä¼˜äºäº’æ–¥é”çš„å…³é”®ã€‚ä½†<strong>è¯»å†™é”çš„å†™æ“ä½œæ˜¯äº’æ–¥çš„</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹åœ¨å†™å…±äº«å˜é‡çš„æ—¶å€™ï¼Œæ˜¯ä¸å…è®¸å…¶ä»–çº¿ç¨‹æ‰§è¡Œå†™æ“ä½œå’Œè¯»æ“ä½œã€‚</p>
<h3 id="-659"><a class="markdownIt-Anchor" href="#-659">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_4-1-reentrantreadwritelock-%E7%9A%84%E7%89%B9%E6%80%A7">#</a>4.1. ReentrantReadWriteLock çš„ç‰¹æ€§</h3>
<p>ReentrantReadWriteLock çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong> <code>ReentrantReadWriteLock</code>  é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯</strong>ã€‚å¦‚æœæ˜¯å†™å¤šè¯»å°‘çš„åœºæ™¯ï¼Œç”±äº  <code>ReentrantReadWriteLock</code>  å…¶å†…éƒ¨å®ç°æ¯”  <code>ReentrantLock</code>  å¤æ‚ï¼Œæ€§èƒ½å¯èƒ½åè€Œè¦å·®ä¸€äº›ã€‚å¦‚æœå­˜åœ¨è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚ç”±äº  <code>ReentrantReadWriteLock</code>  çš„è¯»å†™é”ï¼ˆ <code>ReadLock</code> ã€ <code>WriteLock</code> ï¼‰éƒ½å®ç°äº†  <code>Lock</code>  æ¥å£ï¼Œæ‰€ä»¥è¦æ›¿æ¢ä¸º  <code>ReentrantLock</code>  ä¹Ÿè¾ƒä¸ºå®¹æ˜“ã€‚</li>
<li><code>ReentrantReadWriteLock</code>  å®ç°äº†  <code>ReadWriteLock</code>  æ¥å£ï¼Œæ”¯æŒäº†  <code>ReentrantLock</code>  æ‰€ä¸å…·å¤‡çš„è¯»å†™é”åˆ†ç¦»ã€‚ <code>ReentrantReadWriteLock</code>  ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼ˆ <code>ReadLock</code> ã€ <code>WriteLock</code> ï¼‰ã€‚å°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡ã€‚ <code>ReentrantReadWriteLock</code>  çš„åŠ é”ç­–ç•¥æ˜¯ï¼š<strong>å…è®¸å¤šä¸ªè¯»æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä½†æ¯æ¬¡åªå…è®¸ä¸€ä¸ªå†™æ“ä½œ</strong>ã€‚</li>
<li><code>ReentrantReadWriteLock</code>  ä¸ºè¯»å†™é”éƒ½æä¾›äº†å¯é‡å…¥çš„åŠ é”è¯­ä¹‰ã€‚</li>
<li><code>ReentrantReadWriteLock</code>  æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚</li>
</ul>
<p><code>ReadWriteLock</code>  æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ReadWriteLock</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Lock</span> <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Lock</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>readLock</code>  - è¿”å›ç”¨äºè¯»æ“ä½œçš„é”ï¼ˆ <code>ReadLock</code> ï¼‰ã€‚</li>
<li><code>writeLock</code>  - è¿”å›ç”¨äºå†™æ“ä½œçš„é”ï¼ˆ <code>WriteLock</code> ï¼‰ã€‚</li>
</ul>
<p>åœ¨è¯»å†™é”å’Œå†™å…¥é”ä¹‹é—´çš„äº¤äº’å¯ä»¥é‡‡ç”¨å¤šç§å®ç°æ–¹å¼ï¼Œ <code>ReadWriteLock</code>  çš„ä¸€äº›å¯é€‰å®ç°åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>é‡Šæ”¾ä¼˜å…ˆ</strong> - å½“ä¸€ä¸ªå†™å…¥æ“ä½œé‡Šæ”¾å†™é”ï¼Œå¹¶ä¸”é˜Ÿåˆ—ä¸­åŒæ—¶å­˜åœ¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹ï¼Œé‚£ä¹ˆåº”è¯¥ä¼˜å…ˆé€‰æ‹©è¯»çº¿ç¨‹ã€å†™çº¿ç¨‹ï¼Œè¿˜æ˜¯æœ€å…ˆå‘å‡ºè¯·æ±‚çš„çº¿ç¨‹ï¼Ÿ</li>
<li><strong>è¯»çº¿ç¨‹æ’é˜Ÿ</strong> - å¦‚æœé”æ˜¯ç”±è¯»çº¿ç¨‹æŒæœ‰ï¼Œä½†æœ‰å†™çº¿ç¨‹æ­£åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆæ–°åˆ°è¾¾çš„è¯»çº¿ç¨‹èƒ½å¦ç«‹å³è·å¾—è®¿é—®æƒï¼Œè¿˜æ˜¯åº”è¯¥åœ¨å†™çº¿ç¨‹åé¢ç­‰å¾…ï¼Ÿå¦‚æœå…è®¸è¯»çº¿ç¨‹æ’é˜Ÿåˆ°å†™çº¿ç¨‹ä¹‹å‰ï¼Œé‚£ä¹ˆå°†æé«˜å¹¶å‘æ€§ï¼Œä½†å¯èƒ½é€ æˆçº¿ç¨‹é¥¥é¥¿é—®é¢˜ã€‚</li>
<li><strong>é‡å…¥æ€§</strong> - è¯»é”å’Œå†™é”æ˜¯å¦æ˜¯å¯é‡å…¥çš„ï¼Ÿ</li>
<li><strong>é™çº§</strong> - å¦‚æœä¸€ä¸ªçº¿ç¨‹æŒæœ‰å†™å…¥é”ï¼Œé‚£ä¹ˆå®ƒèƒ½å¦åœ¨ä¸é‡Šæ”¾è¯¥é”çš„æƒ…å†µä¸‹è·å¾—è¯»é”ï¼Ÿè¿™å¯èƒ½ä¼šä½¿å¾—å†™é”è¢«é™çº§ä¸ºè¯»é”ï¼ŒåŒæ—¶ä¸å…è®¸å…¶ä»–å†™çº¿ç¨‹ä¿®æ”¹è¢«ä¿æŠ¤çš„èµ„æºã€‚</li>
<li><strong>å‡çº§</strong> - è¯»é”èƒ½å¦ä¼˜å…ˆäºå…¶ä»–æ­£åœ¨ç­‰å¾…çš„è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹è€Œå‡çº§ä¸ºä¸€ä¸ªå†™é”ï¼Ÿåœ¨å¤§å¤šæ•°çš„è¯»å†™é”å®ç°ä¸­å¹¶ä¸æ”¯æŒå‡çº§ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æ˜¾å¼çš„å‡çº§æ“ä½œï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“é€ æˆæ­»é”ã€‚</li>
</ul>
<h3 id="-660"><a class="markdownIt-Anchor" href="#-660">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_4-2-reentrantreadwritelock-%E7%9A%84%E7%94%A8%E6%B3%95">#</a>4.2. ReentrantReadWriteLock çš„ç”¨æ³•</h3>
<p>å‰æ–‡äº†è§£äº†  <code>ReentrantReadWriteLock</code>  çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è®²è¿°å…¶å…·ä½“ç”¨æ³•ã€‚</p>
<h4 id="-661"><a class="markdownIt-Anchor" href="#-661">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantreadwritelock-%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">#</a>ReentrantReadWriteLock çš„æ„é€ æ–¹æ³•</h4>
<p><code>ReentrantReadWriteLock</code>  å’Œ  <code>ReentrantLock</code>  ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸”ç”¨æ³•ç›¸ä¼¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><code>ReentrantReadWriteLock()</code>  - é»˜è®¤æ„é€ æ–¹æ³•ä¼šåˆå§‹åŒ–ä¸€ä¸ª<strong>éå…¬å¹³é”ï¼ˆNonfairSyncï¼‰</strong>ã€‚åœ¨éå…¬å¹³çš„é”ä¸­ï¼Œçº¿ç¨‹è·å¾—é”çš„é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚å†™çº¿ç¨‹é™çº§ä¸ºè¯»çº¿ç¨‹æ˜¯å¯ä»¥çš„ï¼Œä½†è¯»çº¿ç¨‹å‡çº§ä¸ºå†™çº¿ç¨‹æ˜¯ä¸å¯ä»¥çš„ï¼ˆè¿™æ ·ä¼šå¯¼è‡´æ­»é”ï¼‰ã€‚</li>
<li><code>ReentrantReadWriteLock(boolean)</code>  -  <code>new ReentrantLock(true)</code>  ä¼šåˆå§‹åŒ–ä¸€ä¸ª<strong>å…¬å¹³é”ï¼ˆFairSyncï¼‰</strong>ã€‚å¯¹äºå…¬å¹³é”ï¼Œç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹å°†ä¼˜å…ˆè·å¾—é”ã€‚å¦‚æœè¿™ä¸ªé”æ˜¯è¯»çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å¦ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™é”ï¼Œé‚£ä¹ˆå…¶ä»–è¯»çº¿ç¨‹éƒ½ä¸èƒ½è·å¾—è¯»é”ï¼Œç›´åˆ°å†™çº¿ç¨‹é‡Šæ”¾å†™é”ã€‚</li>
</ul>
<h4 id="-662"><a class="markdownIt-Anchor" href="#-662">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantreadwritelock-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B">#</a>ReentrantReadWriteLock çš„ä½¿ç”¨å®ä¾‹</h4>
<p>åœ¨ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantreadwritelock-%E7%9A%84%E7%89%B9%E6%80%A7"> <code>ReentrantReadWriteLock</code>  çš„ç‰¹æ€§</a> ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œ <code>ReentrantReadWriteLock</code>  çš„è¯»å†™é”ï¼ˆ <code>ReadLock</code> ã€ <code>WriteLock</code> ï¼‰éƒ½å®ç°äº†  <code>Lock</code>  æ¥å£ï¼Œæ‰€ä»¥å…¶å„è‡ªç‹¬ç«‹çš„ä½¿ç”¨æ–¹å¼ä¸  <code>ReentrantLock</code>  ä¸€æ ·ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<p><code>ReentrantReadWriteLock</code>  ä¸  <code>ReentrantLock</code>  ç”¨æ³•ä¸Šçš„å·®å¼‚ï¼Œä¸»è¦åœ¨äºè¯»å†™é”çš„é…åˆä½¿ç”¨ã€‚æœ¬æ–‡ä»¥ä¸€ä¸ªå…¸å‹ä½¿ç”¨åœºæ™¯æ¥è¿›è¡Œè®²è§£ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘åŸºäº  <code>ReadWriteLock</code>  å®ç°ä¸€ä¸ªç®€å•çš„æ³›å‹æ— ç•Œç¼“å­˜</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * ç®€å•çš„æ— ç•Œç¼“å­˜å®ç°
 * &lt;p>
 * ä½¿ç”¨ WeakHashMap å­˜å‚¨é”®å€¼å¯¹ã€‚WeakHashMap ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼ŒJVM GC æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚
 */</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UnboundedCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> cacheMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReadWriteLock</span> cacheLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        cacheLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">V</span> value<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            value <span class="token operator">=</span> cacheMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s è¯»æ•°æ® %s:%s"</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            cacheLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        cacheLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            cacheMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%s å†™å…¥æ•°æ® %s:%s"</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            cacheLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        cacheLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> cacheMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            cacheLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        cacheLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cacheMap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            cacheLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ä½¿ç”¨  <code>WeakHashMap</code>  è€Œä¸æ˜¯  <code>HashMap</code>  æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚ <code>WeakHashMap</code>  ä¸­å­˜å‚¨çš„å¯¹è±¡æ˜¯å¼±å¼•ç”¨ï¼ŒJVM GC æ—¶ä¼šè‡ªåŠ¨æ¸…é™¤æ²¡æœ‰è¢«å¼•ç”¨çš„å¼±å¼•ç”¨å¯¹è±¡ã€‚</li>
<li>å‘  <code>Map</code>  å†™æ•°æ®å‰åŠ å†™é”ï¼Œå†™å®Œåï¼Œé‡Šæ”¾å†™é”ã€‚</li>
<li>å‘  <code>Map</code>  è¯»æ•°æ®å‰åŠ è¯»é”ï¼Œè¯»å®Œåï¼Œé‡Šæ”¾è¯»é”ã€‚</li>
</ul>
<p>æµ‹è¯•å…¶çº¿ç¨‹å®‰å…¨æ€§ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * @author &lt;a href="mailto:forbreak@163.com">Zhang Peng&lt;/a>
 * @since 2020-01-01
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantReadWriteLockDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token class-name">UnboundedCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnboundedCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/** çº¿ç¨‹ä»»åŠ¡æ¯æ¬¡å‘ç¼“å­˜ä¸­å†™å…¥ 3 ä¸ªéšæœºå€¼ï¼Œkey å›ºå®š */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼šç¤ºä¾‹ä¸­ï¼Œé€šè¿‡çº¿ç¨‹æ± å¯åŠ¨ 20 ä¸ªå¹¶å‘ä»»åŠ¡ã€‚ä»»åŠ¡æ¯æ¬¡å‘ç¼“å­˜ä¸­å†™å…¥ 3 ä¸ªéšæœºå€¼ï¼Œkey å›ºå®šï¼›ç„¶åä¸»çº¿ç¨‹æ¯æ¬¡å›ºå®šè¯»å–ç¼“å­˜ä¸­ç¬¬ä¸€ä¸ª key çš„å€¼ã€‚</p>
<p>è¾“å‡ºç»“æœï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">main è¯»æ•°æ® 0:null
pool-1-thread-1 å†™å…¥æ•°æ® 0:16
pool-1-thread-1 å†™å…¥æ•°æ® 1:58
pool-1-thread-1 å†™å…¥æ•°æ® 2:50
main è¯»æ•°æ® 0:16
pool-1-thread-1 å†™å…¥æ•°æ® 0:85
pool-1-thread-1 å†™å…¥æ•°æ® 1:76
pool-1-thread-1 å†™å…¥æ•°æ® 2:46
pool-1-thread-2 å†™å…¥æ•°æ® 0:21
pool-1-thread-2 å†™å…¥æ•°æ® 1:41
pool-1-thread-2 å†™å…¥æ•°æ® 2:63
main è¯»æ•°æ® 0:21
main è¯»æ•°æ® 0:21
// ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-663"><a class="markdownIt-Anchor" href="#-663">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_4-3-reentrantreadwritelock-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>4.3. ReentrantReadWriteLock çš„åŸç†</h3>
<p>å‰é¢äº†è§£äº†  <code>ReentrantLock</code>  çš„åŸç†ï¼Œç†è§£  <code>ReentrantReadWriteLock</code>  å°±å®¹æ˜“å¤šäº†ã€‚</p>
<h4 id="-664"><a class="markdownIt-Anchor" href="#-664">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantreadwritelock-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">#</a>ReentrantReadWriteLock çš„æ•°æ®ç»“æ„</h4>
<p>é˜…è¯» ReentrantReadWriteLock çš„æºç ï¼Œå¯ä»¥å‘ç°å®ƒæœ‰ä¸‰ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** Inner class providing readlock */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock<span class="token punctuation">.</span>ReadLock</span> readerLock<span class="token punctuation">;</span>
<span class="token comment">/** Inner class providing writelock */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock<span class="token punctuation">.</span>WriteLock</span> writerLock<span class="token punctuation">;</span>
<span class="token comment">/** Performs all synchronization mechanics */</span>
<span class="token keyword">final</span> <span class="token class-name">Sync</span> sync<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token class-name">ReentrantReadWriteLock<span class="token punctuation">.</span>WriteLock</span> <span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> writerLock<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token class-name">ReentrantReadWriteLock<span class="token punctuation">.</span>ReadLock</span>  <span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> readerLock<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>sync</code>  - å†…éƒ¨ç±»  <code>ReentrantReadWriteLock.Sync</code>  å¯¹è±¡ã€‚ä¸  <code>ReentrantLock</code>  ç±»ä¼¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š <code>ReentrantReadWriteLock.FairSync</code>  å’Œ  <code>ReentrantReadWriteLock.NonfairSync</code>  ï¼Œåˆ†åˆ«è¡¨ç¤ºå…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚</li>
<li><code>readerLock</code>  - å†…éƒ¨ç±»  <code>ReentrantReadWriteLock.ReadLock</code>  å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠè¯»é”ã€‚</li>
<li><code>writerLock</code>  - å†…éƒ¨ç±»  <code>ReentrantReadWriteLock.WriteLock</code>  å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠå†™é”ã€‚</li>
</ul>
<h4 id="-665"><a class="markdownIt-Anchor" href="#-665">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#reentrantreadwritelock-%E7%9A%84%E8%8E%B7%E5%8F%96%E9%94%81%E5%92%8C%E9%87%8A%E6%94%BE%E9%94%81">#</a>ReentrantReadWriteLock çš„è·å–é”å’Œé‡Šæ”¾é”</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ReadLock</span> <span class="token keyword">implements</span> <span class="token class-name">Lock</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// è°ƒç”¨ AQS è·å–å…±äº«é”æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        sync<span class="token punctuation">.</span><span class="token function">acquireShared</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// è°ƒç”¨ AQS é‡Šæ”¾å…±äº«é”æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        sync<span class="token punctuation">.</span><span class="token function">releaseShared</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WriteLock</span> <span class="token keyword">implements</span> <span class="token class-name">Lock</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// è°ƒç”¨ AQS è·å–ç‹¬å é”æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        sync<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// è°ƒç”¨ AQS é‡Šæ”¾ç‹¬å é”æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        sync<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-666"><a class="markdownIt-Anchor" href="#-666">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_5-stampedlock">#</a>5. StampedLock</h2>
<p>ReadWriteLock æ”¯æŒä¸¤ç§æ¨¡å¼ï¼šä¸€ç§æ˜¯è¯»é”ï¼Œä¸€ç§æ˜¯å†™é”ã€‚è€Œ StampedLock æ”¯æŒä¸‰ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š<strong>å†™é”</strong>ã€<strong>æ‚²è§‚è¯»é”</strong>å’Œ<strong>ä¹è§‚è¯»</strong>ã€‚å…¶ä¸­ï¼Œå†™é”ã€æ‚²è§‚è¯»é”çš„è¯­ä¹‰å’Œ ReadWriteLock çš„å†™é”ã€è¯»é”çš„è¯­ä¹‰éå¸¸ç±»ä¼¼ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–æ‚²è§‚è¯»é”ï¼Œä½†æ˜¯åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”ï¼Œå†™é”å’Œæ‚²è§‚è¯»é”æ˜¯äº’æ–¥çš„ã€‚ä¸åŒçš„æ˜¯ï¼šStampedLock é‡Œçš„å†™é”å’Œæ‚²è§‚è¯»é”åŠ é”æˆåŠŸä¹‹åï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª stampï¼›ç„¶åè§£é”çš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥è¿™ä¸ª stampã€‚</p>
<blockquote>
<p>æ³¨æ„è¿™é‡Œï¼Œç”¨çš„æ˜¯ â€œä¹è§‚è¯»â€ è¿™ä¸ªè¯ï¼Œè€Œä¸æ˜¯ â€œä¹è§‚è¯»é”â€ï¼Œæ˜¯è¦æé†’ä½ ï¼Œ<strong>ä¹è§‚è¯»è¿™ä¸ªæ“ä½œæ˜¯æ— é”çš„</strong>ï¼Œæ‰€ä»¥ç›¸æ¯”è¾ƒ ReadWriteLock çš„è¯»é”ï¼Œä¹è§‚è¯»çš„æ€§èƒ½æ›´å¥½ä¸€äº›ã€‚</p>
</blockquote>
<p>StampedLock çš„æ€§èƒ½ä¹‹æ‰€ä»¥æ¯” ReadWriteLock è¿˜è¦å¥½ï¼Œå…¶å…³é”®æ˜¯ <strong>StampedLock æ”¯æŒä¹è§‚è¯»</strong>çš„æ–¹å¼ã€‚</p>
<ul>
<li>ReadWriteLock æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ï¼Œä½†æ˜¯å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å†™æ“ä½œä¼šè¢«é˜»å¡ï¼›</li>
<li>è€Œ StampedLock æä¾›çš„ä¹è§‚è¯»ï¼Œæ˜¯å…è®¸ä¸€ä¸ªçº¿ç¨‹è·å–å†™é”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯æ‰€æœ‰çš„å†™æ“ä½œéƒ½è¢«é˜»å¡ã€‚</li>
</ul>
<p>å¯¹äºè¯»å¤šå†™å°‘çš„åœºæ™¯ StampedLock æ€§èƒ½å¾ˆå¥½ï¼Œç®€å•çš„åº”ç”¨åœºæ™¯åŸºæœ¬ä¸Šå¯ä»¥æ›¿ä»£ ReadWriteLockï¼Œä½†æ˜¯<strong> StampedLock çš„åŠŸèƒ½ä»…ä»…æ˜¯ ReadWriteLock çš„å­é›†</strong>ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿˜æ˜¯æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</p>
<ul>
<li><strong>StampedLock ä¸æ”¯æŒé‡å…¥</strong></li>
<li>StampedLock çš„æ‚²è§‚è¯»é”ã€å†™é”éƒ½ä¸æ”¯æŒæ¡ä»¶å˜é‡ã€‚</li>
<li>å¦‚æœçº¿ç¨‹é˜»å¡åœ¨ StampedLock çš„ readLock () æˆ–è€… writeLock () ä¸Šæ—¶ï¼Œæ­¤æ—¶è°ƒç”¨è¯¥é˜»å¡çº¿ç¨‹çš„ interrupt () æ–¹æ³•ï¼Œä¼šå¯¼è‡´ CPU é£™å‡ã€‚<strong>ä½¿ç”¨ StampedLock ä¸€å®šä¸è¦è°ƒç”¨ä¸­æ–­æ“ä½œï¼Œå¦‚æœéœ€è¦æ”¯æŒä¸­æ–­åŠŸèƒ½ï¼Œä¸€å®šä½¿ç”¨å¯ä¸­æ–­çš„æ‚²è§‚è¯»é” readLockInterruptibly () å’Œå†™é” writeLockInterruptibly ()</strong>ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘StampedLock é˜»å¡æ—¶ï¼Œè°ƒç”¨ interrupt () å¯¼è‡´ CPU é£™å‡</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">StampedLock</span> lock
  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StampedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> T1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
  <span class="token comment">// è·å–å†™é”</span>
  lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æ°¸è¿œé˜»å¡åœ¨æ­¤å¤„ï¼Œä¸é‡Šæ”¾å†™é”</span>
  <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
T1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¿è¯ T1 è·å–å†™é”</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> T2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span>
  <span class="token comment">// é˜»å¡åœ¨æ‚²è§‚è¯»é”</span>
  lock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
T2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¿è¯ T2 é˜»å¡åœ¨è¯»é”</span>
<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸­æ–­çº¿ç¨‹ T2</span>
<span class="token comment">// ä¼šå¯¼è‡´çº¿ç¨‹ T2 æ‰€åœ¨ CPU é£™å‡</span>
T2<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
T2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘StampedLock è¯»æ¨¡æ¿ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">StampedLock</span> sl <span class="token operator">=</span>
  <span class="token keyword">new</span> <span class="token class-name">StampedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä¹è§‚è¯»</span>
<span class="token keyword">long</span> stamp <span class="token operator">=</span>
  sl<span class="token punctuation">.</span><span class="token function">tryOptimisticRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">// æ ¡éªŒ stamp</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>sl<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token comment">// å‡çº§ä¸ºæ‚²è§‚è¯»é”</span>
  stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// è¯»å…¥æ–¹æ³•å±€éƒ¨å˜é‡</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// é‡Šæ”¾æ‚²è§‚è¯»é”</span>
    sl<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ä½¿ç”¨æ–¹æ³•å±€éƒ¨å˜é‡æ‰§è¡Œä¸šåŠ¡æ“ä½œ</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘StampedLock å†™æ¨¡æ¿ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> stamp <span class="token operator">=</span> sl<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// å†™å…±äº«å˜é‡</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
  sl<span class="token punctuation">.</span><span class="token function">unlockWrite</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-667"><a class="markdownIt-Anchor" href="#-667">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_6-aqs">#</a>6. AQS</h2>
<blockquote>
<p><code>AbstractQueuedSynchronizer</code> ï¼ˆç®€ç§° <strong>AQS</strong>ï¼‰æ˜¯<strong>é˜Ÿåˆ—åŒæ­¥å™¨</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¤„ç†åŒæ­¥ã€‚å®ƒæ˜¯å¹¶å‘é”å’Œå¾ˆå¤šåŒæ­¥å·¥å…·ç±»çš„å®ç°åŸºçŸ³ï¼ˆå¦‚  <code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code> ã€ <code>CountDownLatch</code> ã€ <code>Semaphore</code> ã€ <code>FutureTask</code>  ç­‰ï¼‰ã€‚</p>
</blockquote>
<h3 id="-668"><a class="markdownIt-Anchor" href="#-668">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_6-1-aqs-%E7%9A%84%E8%A6%81%E7%82%B9">#</a>6.1. AQS çš„è¦ç‚¹</h3>
<p><strong>AQS æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒ</strong>ã€‚</p>
<p>åœ¨  <code>java.util.concurrent.locks</code>  åŒ…ä¸­çš„ç›¸å…³é”ï¼ˆå¸¸ç”¨çš„æœ‰  <code>ReentrantLock</code> ã€  <code>ReadWriteLock</code> ï¼‰éƒ½æ˜¯åŸºäº AQS æ¥å®ç°ã€‚è¿™äº›é”éƒ½æ²¡æœ‰ç›´æ¥ç»§æ‰¿ AQSï¼Œè€Œæ˜¯å®šä¹‰äº†ä¸€ä¸ª  <code>Sync</code>  ç±»å»ç»§æ‰¿ AQSã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·å‘¢ï¼Ÿå› ä¸ºé”é¢å‘çš„æ˜¯ä½¿ç”¨ç”¨æˆ·ï¼Œè€ŒåŒæ­¥å™¨é¢å‘çš„åˆ™æ˜¯çº¿ç¨‹æ§åˆ¶ï¼Œé‚£ä¹ˆåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨è€Œä¸æ˜¯ç›´æ¥ç»§æ‰¿ AQS å°±å¯ä»¥å¾ˆå¥½çš„éš”ç¦»äºŒè€…æ‰€å…³æ³¨çš„äº‹æƒ…ã€‚</p>
<h3 id="-669"><a class="markdownIt-Anchor" href="#-669">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_6-2-aqs-%E7%9A%84%E5%BA%94%E7%94%A8">#</a>6.2. AQS çš„åº”ç”¨</h3>
<p><strong>AQS æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒ</strong>ã€‚</p>
<h4 id="-670"><a class="markdownIt-Anchor" href="#-670">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#%E7%8B%AC%E4%BA%AB%E9%94%81-api">#</a>ç‹¬äº«é” API</h4>
<p>è·å–ã€é‡Šæ”¾ç‹¬äº«é”çš„ä¸»è¦ API å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquireNanos</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">,</span> <span class="token keyword">long</span> nanosTimeout<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p><code>acquire</code>  - è·å–ç‹¬å é”ã€‚</p>
</li>
<li>
<p><code>acquireInterruptibly</code>  - è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚</p>
</li>
<li>
<pre><code>  tryAcquireNanos
  <pre class="line-numbers language-none"><code class="language-none">
	 

	\- å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚åœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸‹å›è¿”å›ï¼š

	- åœ¨è¶…æ—¶æ—¶é—´å†…ï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè·å–äº†é”ï¼›
	- å½“å‰çº¿ç¨‹åœ¨è¶…æ—¶æ—¶é—´å†…è¢«ä¸­æ–­ï¼›
	- è¶…æ—¶æ—¶é—´ç»“æŸï¼Œä»æœªè·å¾—é”è¿”å› falseã€‚

- &#96;release&#96; - é‡Šæ”¾ç‹¬å é”ã€‚

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#å…±äº«é”-api)å…±äº«é” API

è·å–ã€é‡Šæ”¾å…±äº«é”çš„ä¸»è¦ API å¦‚ä¸‹ï¼š

&#96;&#96;&#96;java
public final void acquireShared(int arg)
public final void acquireSharedInterruptibly(int arg)
public final boolean tryAcquireSharedNanos(int arg, long nanosTimeout)
public final boolean releaseShared(int arg)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
<li>
<p><code>acquireShared</code>  - è·å–å…±äº«é”ã€‚</p>
</li>
<li>
<p><code>acquireSharedInterruptibly</code>  - è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚</p>
</li>
<li>
<p><code>tryAcquireSharedNanos</code>  - å°è¯•åœ¨æŒ‡å®šæ—¶é—´å†…è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚</p>
</li>
<li>
<p><code>release</code>  - é‡Šæ”¾å…±äº«é”ã€‚</p>
</li>
</ul>
<h3 id="-671"><a class="markdownIt-Anchor" href="#-671">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#_6-3-aqs-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>6.3. AQS çš„åŸç†</h3>
<blockquote>
<p>ASQ åŸç†è¦ç‚¹ï¼š</p>
<ul>
<li>AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„  <code>volatile</code>  å˜é‡æ¥ <strong>ç»´æŠ¤åŒæ­¥çŠ¶æ€</strong>ã€‚çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»èµ‹äºˆã€‚</li>
<li>AQS ç»´æŠ¤äº†ä¸€ä¸ª FIFO çš„åŒé“¾è¡¨ï¼Œç”¨æ¥å­˜å‚¨è·å–é”å¤±è´¥çš„çº¿ç¨‹ã€‚</li>
</ul>
<p>AQS å›´ç»•åŒæ­¥çŠ¶æ€æä¾›ä¸¤ç§åŸºæœ¬æ“ä½œ â€œè·å–â€ å’Œ â€œé‡Šæ”¾â€ï¼Œå¹¶æä¾›ä¸€ç³»åˆ—åˆ¤æ–­å’Œå¤„ç†æ–¹æ³•ï¼Œç®€å•è¯´å‡ ç‚¹ï¼š</p>
<ul>
<li>state æ˜¯ç‹¬å çš„ï¼Œè¿˜æ˜¯å…±äº«çš„ï¼›</li>
<li>state è¢«è·å–åï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼›</li>
<li>state è¢«é‡Šæ”¾åï¼Œå”¤é†’ç­‰å¾…çº¿ç¨‹ï¼›</li>
<li>çº¿ç¨‹ç­‰ä¸åŠæ—¶ï¼Œå¦‚ä½•é€€å‡ºç­‰å¾…ã€‚</li>
</ul>
<p>è‡³äºçº¿ç¨‹æ˜¯å¦å¯ä»¥è·å¾— stateï¼Œå¦‚ä½•é‡Šæ”¾ stateï¼Œå°±ä¸æ˜¯ AQS å…³å¿ƒçš„äº†ï¼Œè¦ç”±å­ç±»å…·ä½“å®ç°ã€‚</p>
</blockquote>
<h4 id="-672"><a class="markdownIt-Anchor" href="#-672">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E9%94%81.html#aqs-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">#</a>AQS çš„æ•°æ®ç»“æ„</h4>
<p>é˜…è¯» AQS çš„æºç ï¼Œå¯ä»¥å‘ç°ï¼šAQS ç»§æ‰¿è‡ª  <code>AbstractOwnableSynchronize</code> ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractQueuedSynchronizer</span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractOwnableSynchronizer</span>
    <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå¤´ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ setHead æ–¹æ³•ä¿®æ”¹ã€‚ */</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span> head<span class="token punctuation">;</span>
    <span class="token comment">/** ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæ‡’åŠ è½½ã€‚åªèƒ½é€šè¿‡ enq æ–¹æ³•æ·»åŠ æ–°çš„ç­‰å¾…èŠ‚ç‚¹ã€‚*/</span>
    <span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Node</span> tail<span class="token punctuation">;</span>
    <span class="token comment">/** åŒæ­¥çŠ¶æ€ */</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<pre><code>  state
  <pre class="line-numbers language-none"><code class="language-none">
 

\- AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  volatile
  <pre class="line-numbers language-none"><code class="language-none">
	 

	å˜é‡æ¥

	 

	ç»´æŠ¤åŒæ­¥çŠ¶æ€

	ã€‚

	- è¿™ä¸ªæ•´æ•°çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»æ¥èµ‹äºˆï¼Œå¦‚&#96;ReentrantLock&#96; ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºæ‰€æœ‰è€…çº¿ç¨‹å·²ç»é‡å¤è·å–è¯¥é”çš„æ¬¡æ•°ï¼Œ&#96;Semaphore&#96; ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºå‰©ä½™çš„è®¸å¯æ•°é‡ã€‚

- &#96;head&#96; å’Œ &#96;tail&#96; - AQS **ç»´æŠ¤äº†ä¸€ä¸ª &#96;Node&#96; ç±»å‹ï¼ˆAQS çš„å†…éƒ¨ç±»ï¼‰çš„åŒé“¾è¡¨æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†**ã€‚è¿™ä¸ªåŒé“¾è¡¨æ˜¯ä¸€ä¸ªåŒå‘çš„ FIFO é˜Ÿåˆ—ï¼Œé€šè¿‡ &#96;head&#96; å’Œ &#96;tail&#96; æŒ‡é’ˆè¿›è¡Œè®¿é—®ã€‚å½“ **æœ‰çº¿ç¨‹è·å–é”å¤±è´¥åï¼Œå°±è¢«æ·»åŠ åˆ°é˜Ÿåˆ—æœ«å°¾**ã€‚

![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;HarryQu1229&#x2F;image-host&#x2F;main&#x2F;notes-img&#x2F;aqs_1.png)

å†æ¥çœ‹ä¸€ä¸‹ &#96;Node&#96; çš„æºç 

&#96;&#96;&#96;java
static final class Node &#123;
    &#x2F;** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºå…±äº«æ¨¡å¼ *&#x2F;
    static final Node SHARED &#x3D; new Node();
    &#x2F;** è¯¥ç­‰å¾…åŒæ­¥çš„èŠ‚ç‚¹å¤„äºç‹¬å æ¨¡å¼ *&#x2F;
    static final Node EXCLUSIVE &#x3D; null;

    &#x2F;** çº¿ç¨‹ç­‰å¾…çŠ¶æ€ï¼ŒçŠ¶æ€å€¼æœ‰: 0ã€1ã€-1ã€-2ã€-3 *&#x2F;
    volatile int waitStatus;
    static final int CANCELLED &#x3D;  1;
    static final int SIGNAL    &#x3D; -1;
    static final int CONDITION &#x3D; -2;
    static final int PROPAGATE &#x3D; -3;

    &#x2F;** å‰é©±èŠ‚ç‚¹ *&#x2F;
    volatile Node prev;
    &#x2F;** åç»§èŠ‚ç‚¹ *&#x2F;
    volatile Node next;
    &#x2F;** ç­‰å¾…é”çš„çº¿ç¨‹ *&#x2F;
    volatile Thread thread;

  	&#x2F;** å’ŒèŠ‚ç‚¹æ˜¯å¦å…±äº«æœ‰å…³ *&#x2F;
    Node nextWaiter;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>å¾ˆæ˜¾ç„¶ï¼ŒNode æ˜¯ä¸€ä¸ªåŒé“¾è¡¨ç»“æ„ã€‚</p>
<ul>
<li>
<pre><code>  waitStatus
  <pre class="line-numbers language-none"><code class="language-none">
 

\-

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  Node
  <pre class="line-numbers language-none"><code class="language-none">
 

ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  volatile
  <pre class="line-numbers language-none"><code class="language-none">
 

å˜é‡æ¥ ç»´æŠ¤ AQS åŒæ­¥é˜Ÿåˆ—ä¸­çº¿ç¨‹èŠ‚ç‚¹çš„çŠ¶æ€ã€‚
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
  waitStatus
  <pre class="line-numbers language-none"><code class="language-none">
	 

	æœ‰äº”ä¸ªçŠ¶æ€å€¼ï¼š

	- &#96;CANCELLED(1)&#96; - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹å¯èƒ½ç”±äºè¶…æ—¶æˆ–è¢«ä¸­æ–­è€Œ **å¤„äºè¢«å–æ¶ˆ(ä½œåºŸ)çŠ¶æ€**ï¼Œä¸€æ—¦å¤„äºè¿™ä¸ªçŠ¶æ€ï¼Œè¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹åº”è¯¥ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚
	- &#96;SIGNAL(-1)&#96; - æ­¤çŠ¶æ€è¡¨ç¤ºï¼š**åç»§èŠ‚ç‚¹ä¼šè¢«æŒ‚èµ·**ï¼Œå› æ­¤åœ¨å½“å‰èŠ‚ç‚¹é‡Šæ”¾é”æˆ–è¢«å–æ¶ˆä¹‹åï¼Œå¿…é¡»å”¤é†’(&#96;unparking&#96;)å…¶åç»§ç»“ç‚¹ã€‚
	- &#96;CONDITION(-2)&#96; - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šè¯¥èŠ‚ç‚¹çš„çº¿ç¨‹ **å¤„äºç­‰å¾…æ¡ä»¶çŠ¶æ€**ï¼Œä¸ä¼šè¢«å½“ä½œæ˜¯åŒæ­¥é˜Ÿåˆ—ä¸Šçš„èŠ‚ç‚¹ï¼Œç›´åˆ°è¢«å”¤é†’(&#96;signal&#96;)ï¼Œè®¾ç½®å…¶å€¼ä¸º 0ï¼Œå†é‡æ–°è¿›å…¥é˜»å¡çŠ¶æ€ã€‚
	- &#96;PROPAGATE(-3)&#96; - æ­¤çŠ¶æ€è¡¨ç¤ºï¼šä¸‹ä¸€ä¸ª &#96;acquireShared&#96; åº”æ— æ¡ä»¶ä¼ æ’­ã€‚
	- 0 - éä»¥ä¸ŠçŠ¶æ€ã€‚

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾)ç‹¬å é”çš„è·å–å’Œé‡Šæ”¾

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#è·å–ç‹¬å é”)è·å–ç‹¬å é”

AQS ä¸­ä½¿ç”¨ &#96;acquire(int arg)&#96; æ–¹æ³•è·å–ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š

1. å…ˆå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚
2. å¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼ŒAQS ä¼šä¸æ–­å°è¯•åˆ©ç”¨ CAS æ“ä½œå°†å½“å‰çº¿ç¨‹æ’å…¥ç­‰å¾…åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚
3. æ¥ç€ï¼Œä¸æ–­å°è¯•ä¸ºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹èŠ‚ç‚¹è·å–ç‹¬å é”ã€‚

![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;dunwu&#x2F;images&#x2F;dev&#x2F;cs&#x2F;java&#x2F;javacore&#x2F;concurrent&#x2F;aqs_2.png)

![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;HarryQu1229&#x2F;image-host&#x2F;main&#x2F;notes-img&#x2F;aqs_3.png)

è¯¦ç»†æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºï¼Œè¯·ç»“åˆæºç æ¥ç†è§£ï¼ˆä¸€å›¾èƒœåƒè¨€ï¼‰ï¼š

![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;HarryQu1229&#x2F;image-host&#x2F;main&#x2F;notes-img&#x2F;aqs_4.png)

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#é‡Šæ”¾ç‹¬å é”)é‡Šæ”¾ç‹¬å é”

AQS ä¸­ä½¿ç”¨ &#96;release(int arg)&#96; æ–¹æ³•é‡Šæ”¾ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š

1. å…ˆå°è¯•è·å–è§£é”çº¿ç¨‹çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚
2. å¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼ŒAQS ä¼šå°è¯•å”¤é†’å½“å‰çº¿ç¨‹èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#è·å–å¯ä¸­æ–­çš„ç‹¬å é”)è·å–å¯ä¸­æ–­çš„ç‹¬å é”

AQS ä¸­ä½¿ç”¨ &#96;acquireInterruptibly(int arg)&#96; æ–¹æ³•è·å–å¯ä¸­æ–­çš„ç‹¬å é”ã€‚

&#96;acquireInterruptibly(int arg)&#96; å®ç°æ–¹å¼**ç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ &#96;acquire&#96;ï¼‰éå¸¸ç›¸ä¼¼**ï¼ŒåŒºåˆ«ä»…åœ¨äºå®ƒä¼š**é€šè¿‡ &#96;Thread.interrupted&#96; æ£€æµ‹å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­**ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç«‹å³æŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼ˆ&#96;InterruptedException&#96;ï¼‰ã€‚

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”)è·å–è¶…æ—¶ç­‰å¾…å¼çš„ç‹¬å é”

AQS ä¸­ä½¿ç”¨ &#96;tryAcquireNanos(int arg)&#96; æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…çš„ç‹¬å é”ã€‚

doAcquireNanos çš„å®ç°æ–¹å¼ **ç›¸è¾ƒäºè·å–ç‹¬å é”æ–¹æ³•ï¼ˆ &#96;acquire&#96;ï¼‰éå¸¸ç›¸ä¼¼**ï¼ŒåŒºåˆ«åœ¨äºå®ƒä¼šæ ¹æ®è¶…æ—¶æ—¶é—´å’Œå½“å‰æ—¶é—´è®¡ç®—å‡ºæˆªæ­¢æ—¶é—´ã€‚åœ¨è·å–é”çš„æµç¨‹ä¸­ï¼Œä¼šä¸æ–­åˆ¤æ–­æ˜¯å¦è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œç›´æ¥è¿”å› falseï¼›å¦‚æœæ²¡è¶…æ—¶ï¼Œåˆ™ç”¨ &#96;LockSupport.parkNanos&#96; æ¥é˜»å¡å½“å‰çº¿ç¨‹ã€‚

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#å…±äº«é”çš„è·å–å’Œé‡Šæ”¾)å…±äº«é”çš„è·å–å’Œé‡Šæ”¾

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#è·å–å…±äº«é”)è·å–å…±äº«é”

AQS ä¸­ä½¿ç”¨ &#96;acquireShared(int arg)&#96; æ–¹æ³•è·å–å…±äº«é”ã€‚

&#96;acquireShared&#96; æ–¹æ³•å’Œ &#96;acquire&#96; æ–¹æ³•çš„é€»è¾‘å¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè‡ªæ—‹çš„æ¡ä»¶ä»¥åŠèŠ‚ç‚¹å‡ºé˜Ÿçš„æ“ä½œæœ‰æ‰€ä¸åŒã€‚

æˆåŠŸè·å¾—å…±äº«é”çš„æ¡ä»¶å¦‚ä¸‹ï¼š

- &#96;tryAcquireShared(arg)&#96; è¿”å›å€¼å¤§äºç­‰äº 0 ï¼ˆè¿™æ„å‘³ç€å…±äº«é”çš„ permit è¿˜æ²¡æœ‰ç”¨å®Œï¼‰ã€‚
- å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ã€‚

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#é‡Šæ”¾å…±äº«é”)é‡Šæ”¾å…±äº«é”

AQS ä¸­ä½¿ç”¨ &#96;releaseShared(int arg)&#96; æ–¹æ³•é‡Šæ”¾å…±äº«é”ã€‚

&#96;releaseShared&#96; é¦–å…ˆä¼šå°è¯•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è§£é”ä¸€ä¸ªæˆ–å¤šä¸ªåç»§çº¿ç¨‹èŠ‚ç‚¹ã€‚é‡Šæ”¾å…±äº«é”å’Œé‡Šæ”¾ç‹¬äº«é”æµç¨‹å¤§ä½“ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š

å¯¹äºç‹¬äº«æ¨¡å¼ï¼Œå¦‚æœéœ€è¦ SIGNALï¼Œé‡Šæ”¾ä»…ç›¸å½“äºè°ƒç”¨å¤´èŠ‚ç‚¹çš„ &#96;unparkSuccessor&#96;ã€‚

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#è·å–å¯ä¸­æ–­çš„å…±äº«é”)è·å–å¯ä¸­æ–­çš„å…±äº«é”

AQS ä¸­ä½¿ç”¨ &#96;acquireSharedInterruptibly(int arg)&#96; æ–¹æ³•è·å–å¯ä¸­æ–­çš„å…±äº«é”ã€‚

&#96;acquireSharedInterruptibly&#96; æ–¹æ³•ä¸ &#96;acquireInterruptibly&#96; å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚

##### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”)è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”

AQS ä¸­ä½¿ç”¨ &#96;tryAcquireSharedNanos(int arg)&#96; æ–¹æ³•è·å–è¶…æ—¶ç­‰å¾…å¼çš„å…±äº«é”ã€‚

&#96;tryAcquireSharedNanos&#96; æ–¹æ³•ä¸ &#96;tryAcquireNanos&#96; å‡ ä¹ä¸€è‡´ï¼Œä¸å†èµ˜è¿°ã€‚

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#_7-æ­»é”)7. æ­»é”

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#_7-1-ä»€ä¹ˆæ˜¯æ­»é”)7.1. ä»€ä¹ˆæ˜¯æ­»é”

æ­»é”æ˜¯ä¸€ç§ç‰¹å®šçš„ç¨‹åºçŠ¶æ€ï¼Œåœ¨å®ä½“ä¹‹é—´ï¼Œç”±äºå¾ªç¯ä¾èµ–å¯¼è‡´å½¼æ­¤ä¸€ç›´å¤„äºç­‰å¾…ä¹‹ä¸­ï¼Œæ²¡æœ‰ä»»ä½•ä¸ªä½“å¯ä»¥ç»§ç»­å‰è¿›ã€‚æ­»é”ä¸ä»…ä»…æ˜¯åœ¨çº¿ç¨‹ä¹‹é—´ä¼šå‘ç”Ÿï¼Œå­˜åœ¨èµ„æºç‹¬å çš„è¿›ç¨‹ä¹‹é—´åŒæ ·ä¹Ÿ å¯èƒ½å‡ºç°æ­»é”ã€‚é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬å¤§å¤šæ˜¯èšç„¦åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­çš„æ­»é”ï¼ŒæŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”ï¼Œè€Œæ°¸ä¹…å¤„äºé˜»å¡çš„çŠ¶æ€ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#_7-2-å¦‚ä½•å®šä½æ­»é”)7.2. å¦‚ä½•å®šä½æ­»é”

å®šä½æ­»é”æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯åˆ©ç”¨ jstack ç­‰å·¥å…·è·å–çº¿ç¨‹æ ˆï¼Œç„¶åå®šä½äº’ç›¸ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¿›è€Œæ‰¾åˆ°æ­»é”ã€‚å¦‚æœæ˜¯æ¯”è¾ƒæ˜æ˜¾çš„æ­»é”ï¼Œå¾€å¾€ jstack ç­‰å°±èƒ½ç›´æ¥å®šä½ï¼Œç±»ä¼¼ JConsole ç”šè‡³å¯ä»¥åœ¨å›¾å½¢ç•Œé¢è¿›è¡Œæœ‰é™çš„æ­»é”æ£€æµ‹ã€‚

å¦‚æœæˆ‘ä»¬æ˜¯å¼€å‘è‡ªå·±çš„ç®¡ç†å·¥å…·ï¼Œéœ€è¦ç”¨æ›´åŠ ç¨‹åºåŒ–çš„æ–¹å¼æ‰«ææœåŠ¡è¿›ç¨‹ã€å®šä½æ­»é”ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Java æä¾›çš„æ ‡å‡†ç®¡ç† APIï¼Œ&#96;ThreadMXBean&#96;ï¼Œå…¶ç›´æ¥å°±æä¾›äº† &#96;findDeadlockedThreads()&#96; æ–¹æ³•ç”¨äºå®šä½ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaé”.html#_7-3-å¦‚ä½•é¿å…æ­»é”)7.3. å¦‚ä½•é¿å…æ­»é”

åŸºæœ¬ä¸Šæ­»é”çš„å‘ç”Ÿæ˜¯å› ä¸ºï¼š

- äº’æ–¥ï¼Œç±»ä¼¼ Java ä¸­ Monitor éƒ½æ˜¯ç‹¬å çš„ã€‚
- é•¿æœŸä¿æŒäº’æ–¥ï¼Œåœ¨ä½¿ç”¨ç»“æŸä¹‹å‰ï¼Œä¸ä¼šé‡Šæ”¾ï¼Œä¹Ÿä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æŠ¢å ã€‚
- å¾ªç¯ä¾èµ–ï¼Œå¤šä¸ªä¸ªä½“ä¹‹é—´å‡ºç°äº†é”çš„å¾ªç¯ä¾èµ–ï¼Œå½¼æ­¤ä¾èµ–ä¸Šä¸€ç¯é‡Šæ”¾é”ã€‚

ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºé¿å…æ­»é”çš„æ€è·¯å’Œæ–¹æ³•ã€‚

ï¼ˆ1ï¼‰é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”ã€‚

é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æºã€‚

å°è¯•ä½¿ç”¨å®šæ—¶é” &#96;lock.tryLock(timeout)&#96;ï¼Œé¿å…é”ä¸€ç›´ä¸èƒ½é‡Šæ”¾ã€‚

å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸­é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µ



---

# Java åŸå­å˜é‡ç±»

&gt; **ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ [javacore(opens new window)](https:&#x2F;&#x2F;github.com&#x2F;dunwu&#x2F;javacore&#x2F;)**

- \1. åŸå­å˜é‡ç±»ç®€ä»‹
	- [1.1. ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#11-ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»)
	- [1.2. åŸå­å˜é‡ç±»çš„ä½œç”¨](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#12-åŸå­å˜é‡ç±»çš„ä½œç”¨)
- \2. åŸºæœ¬ç±»å‹
	- [2.1. **&#96;AtomicInteger&#96; ç”¨æ³•**](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#21-atomicinteger-ç”¨æ³•)
	- [2.2. **&#96;AtomicInteger&#96; å®ç°**](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#22-atomicinteger-å®ç°)
- [3. å¼•ç”¨ç±»å‹](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#3-å¼•ç”¨ç±»å‹)
- [4. æ•°ç»„ç±»å‹](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#4-æ•°ç»„ç±»å‹)
- [5. å±æ€§æ›´æ–°å™¨ç±»å‹](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#5-å±æ€§æ›´æ–°å™¨ç±»å‹)
- [6. åŸå­åŒ–çš„ç´¯åŠ å™¨](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#6-åŸå­åŒ–çš„ç´¯åŠ å™¨)
- [7. å‚è€ƒèµ„æ–™](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#7-å‚è€ƒèµ„æ–™)

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#_1-åŸå­å˜é‡ç±»ç®€ä»‹)1. åŸå­å˜é‡ç±»ç®€ä»‹

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#_1-1-ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»)1.1. ä¸ºä½•éœ€è¦åŸå­å˜é‡ç±»

ä¿è¯çº¿ç¨‹å®‰å…¨æ˜¯ Java å¹¶å‘ç¼–ç¨‹å¿…é¡»è¦è§£å†³çš„é‡è¦é—®é¢˜ã€‚Java ä»åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§è¿™ä¸‰å¤§ç‰¹æ€§å…¥æ‰‹ï¼Œç¡®ä¿å¤šçº¿ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ã€‚

- ç¡®ä¿çº¿ç¨‹å®‰å…¨æœ€å¸¸è§çš„åšæ³•æ˜¯åˆ©ç”¨é”æœºåˆ¶ï¼ˆ&#96;Lock&#96;ã€&#96;sychronized&#96;ï¼‰æ¥å¯¹å…±äº«æ•°æ®åšäº’æ–¥åŒæ­¥ï¼Œè¿™æ ·åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—ï¼Œé‚£ä¹ˆæ“ä½œå¿…ç„¶æ˜¯åŸå­æ€§çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚
- &#96;volatile&#96; æ˜¯è½»é‡çº§çš„é”ï¼ˆè‡ªç„¶æ¯”æ™®é€šé”æ€§èƒ½è¦å¥½ï¼‰ï¼Œå®ƒä¿è¯äº†å…±äº«å˜é‡åœ¨å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§ï¼Œä½†æ— æ³•ä¿è¯åŸå­æ€§ã€‚æ‰€ä»¥ï¼Œå®ƒåªèƒ½åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨ã€‚
- ä¸ºäº†å…¼é¡¾åŸå­æ€§ä»¥åŠé”å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼ŒJava å¼•å…¥äº† CAS ï¼ˆä¸»è¦ä½“ç°åœ¨ &#96;Unsafe&#96; ç±»ï¼‰æ¥å®ç°éé˜»å¡åŒæ­¥ï¼ˆä¹Ÿå«ä¹è§‚é”ï¼‰ã€‚å¹¶åŸºäº CAS ï¼Œæä¾›äº†ä¸€å¥—åŸå­å·¥å…·ç±»ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#_1-2-åŸå­å˜é‡ç±»çš„ä½œç”¨)1.2. åŸå­å˜é‡ç±»çš„ä½œç”¨

åŸå­å˜é‡ç±» **æ¯”é”çš„ç²’åº¦æ›´ç»†ï¼Œæ›´è½»é‡çº§**ï¼Œå¹¶ä¸”å¯¹äºåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šå®ç°é«˜æ€§èƒ½çš„å¹¶å‘ä»£ç æ¥è¯´æ˜¯éå¸¸å…³é”®çš„ã€‚åŸå­å˜é‡å°†å‘ç”Ÿç«äº‰çš„èŒƒå›´ç¼©å°åˆ°å•ä¸ªå˜é‡ä¸Šã€‚

åŸå­å˜é‡ç±»ç›¸å½“äºä¸€ç§æ³›åŒ–çš„ &#96;volatile&#96; å˜é‡ï¼Œèƒ½å¤Ÿ**æ”¯æŒåŸå­çš„ã€æœ‰æ¡ä»¶çš„è¯»&#x2F;æ”¹&#x2F;å†™æ“**ä½œã€‚

åŸå­ç±»åœ¨å†…éƒ¨ä½¿ç”¨ CAS æŒ‡ä»¤ï¼ˆåŸºäºç¡¬ä»¶çš„æ”¯æŒï¼‰æ¥å®ç°åŒæ­¥ã€‚è¿™äº›æŒ‡ä»¤é€šå¸¸æ¯”é”æ›´å¿«ã€‚

åŸå­å˜é‡ç±»å¯ä»¥åˆ†ä¸º 4 ç»„ï¼š

- åŸºæœ¬ç±»å‹
	- &#96;AtomicBoolean&#96; - å¸ƒå°”ç±»å‹åŸå­ç±»
	- &#96;AtomicInteger&#96; - æ•´å‹åŸå­ç±»
	- &#96;AtomicLong&#96; - é•¿æ•´å‹åŸå­ç±»
- å¼•ç”¨ç±»å‹
	- &#96;AtomicReference&#96; - å¼•ç”¨ç±»å‹åŸå­ç±»
	- &#96;AtomicMarkableReference&#96; - å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹åŸå­ç±»
	- &#96;AtomicStampedReference&#96; - å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹åŸå­ç±»
- æ•°ç»„ç±»å‹
	- &#96;AtomicIntegerArray&#96; - æ•´å½¢æ•°ç»„åŸå­ç±»
	- &#96;AtomicLongArray&#96; - é•¿æ•´å‹æ•°ç»„åŸå­ç±»
	- &#96;AtomicReferenceArray&#96; - å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»
- å±æ€§æ›´æ–°å™¨ç±»å‹
	- &#96;AtomicIntegerFieldUpdater&#96; - æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚
	- &#96;AtomicLongFieldUpdater&#96; - é•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚
	- &#96;AtomicReferenceFieldUpdater&#96; - åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚

&gt; è¿™é‡Œä¸å¯¹ CASã€volatileã€äº’æ–¥åŒæ­¥åšæ·±å…¥æ¢è®¨ã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œä¸å¦¨å‚è€ƒï¼š[Java å¹¶å‘æ ¸å¿ƒæœºåˆ¶(opens new window)](https:&#x2F;&#x2F;github.com&#x2F;dunwu&#x2F;javacore&#x2F;blob&#x2F;master&#x2F;docs&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.md)

## [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#_2-åŸºæœ¬ç±»å‹)2. åŸºæœ¬ç±»å‹

è¿™ä¸€ç±»å‹çš„åŸå­ç±»æ˜¯é’ˆå¯¹ Java åŸºæœ¬ç±»å‹è¿›è¡Œæ“ä½œã€‚

- &#96;AtomicBoolean&#96; - å¸ƒå°”ç±»å‹åŸå­ç±»
- &#96;AtomicInteger&#96; - æ•´å‹åŸå­ç±»
- &#96;AtomicLong&#96; - é•¿æ•´å‹åŸå­ç±»

ä»¥ä¸Šç±»éƒ½æ”¯æŒ CASï¼ˆ[compare-and-swap (opens new window)](https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Compare-and-swap)ï¼‰æŠ€æœ¯ï¼Œæ­¤å¤–ï¼Œ&#96;AtomicInteger&#96;ã€&#96;AtomicLong&#96; è¿˜æ”¯æŒç®—æœ¯è¿ç®—ã€‚

&gt; ğŸ’¡ æç¤ºï¼š
&gt;
&gt; è™½ç„¶ Java åªæä¾›äº† &#96;AtomicBoolean&#96; ã€&#96;AtomicInteger&#96;ã€&#96;AtomicLong&#96;ï¼Œä½†æ˜¯å¯ä»¥æ¨¡æ‹Ÿå…¶ä»–åŸºæœ¬ç±»å‹çš„åŸå­å˜é‡ã€‚è¦æƒ³æ¨¡æ‹Ÿå…¶ä»–åŸºæœ¬ç±»å‹çš„åŸå­å˜é‡ï¼Œå¯ä»¥å°† &#96;short&#96; æˆ– &#96;byte&#96; ç­‰ç±»å‹ä¸ &#96;int&#96; ç±»å‹è¿›è¡Œè½¬æ¢ï¼Œä»¥åŠä½¿ç”¨ &#96;Float.floatToIntBits&#96; ã€&#96;Double.doubleToLongBits&#96; æ¥è½¬æ¢æµ®ç‚¹æ•°ã€‚
&gt;
&gt; ç”±äº &#96;AtomicBoolean&#96;ã€&#96;AtomicInteger&#96;ã€&#96;AtomicLong&#96; å®ç°æ–¹å¼ã€ä½¿ç”¨æ–¹å¼éƒ½ç›¸è¿‘ï¼Œæ‰€ä»¥æœ¬æ–‡ä»…é’ˆå¯¹ &#96;AtomicInteger&#96; è¿›è¡Œä»‹ç»ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;JavaåŸå­ç±».html#_2-1-atomicinteger-ç”¨æ³•)2.1. **&#96;AtomicInteger&#96; ç”¨æ³•**

&#96;&#96;&#96;java
public final int get() &#x2F;&#x2F; è·å–å½“å‰å€¼
public final int getAndSet(int newValue) &#x2F;&#x2F; è·å–å½“å‰å€¼ï¼Œå¹¶è®¾ç½®æ–°å€¼
public final int getAndIncrement()&#x2F;&#x2F; è·å–å½“å‰å€¼ï¼Œå¹¶è‡ªå¢
public final int getAndDecrement() &#x2F;&#x2F; è·å–å½“å‰å€¼ï¼Œå¹¶è‡ªå‡
public final int getAndAdd(int delta) &#x2F;&#x2F; è·å–å½“å‰å€¼ï¼Œå¹¶åŠ ä¸Šé¢„æœŸå€¼
boolean compareAndSet(int expect, int update) &#x2F;&#x2F; å¦‚æœè¾“å…¥å€¼ï¼ˆupdateï¼‰ç­‰äºé¢„æœŸå€¼ï¼Œå°†è¯¥å€¼è®¾ç½®ä¸ºè¾“å…¥å€¼
public final void lazySet(int newValue) &#x2F;&#x2F; æœ€ç»ˆè®¾ç½®ä¸º newValueï¼Œä½¿ç”¨ lazySet è®¾ç½®ä¹‹åå¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨ä¹‹åçš„ä¸€å°æ®µæ—¶é—´å†…è¿˜æ˜¯å¯ä»¥è¯»åˆ°æ—§çš„å€¼ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p><code>AtomicInteger</code>  ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" count="</span> <span class="token operator">+</span> count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                count<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Final Count is : "</span> <span class="token operator">+</span> count<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-673"><a class="markdownIt-Anchor" href="#-673">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%8E%9F%E5%AD%90%E7%B1%BB.html#_2-2-atomicinteger-%E5%AE%9E%E7%8E%B0">#</a>2.2. <strong> <code>AtomicInteger</code>  å®ç°</strong></h3>
<p>é˜…è¯»  <code>AtomicInteger</code>  æºç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹å®šä¹‰ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token class-name">Unsafe</span><span class="token punctuation">.</span><span class="token function">getUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> valueOffset<span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
		valueOffset <span class="token operator">=</span> unsafe<span class="token punctuation">.</span>objectFieldOffset
			<span class="token punctuation">(</span><span class="token class-name">AtomicInteger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>value</code>  - value å±æ€§ä½¿ç”¨  <code>volatile</code>  ä¿®é¥°ï¼Œä½¿å¾—å¯¹ value çš„ä¿®æ”¹åœ¨å¹¶å‘ç¯å¢ƒä¸‹å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚</li>
<li><code>valueOffset</code>  - value å±æ€§çš„åç§»é‡ï¼Œé€šè¿‡è¿™ä¸ªåç§»é‡å¯ä»¥å¿«é€Ÿå®šä½åˆ° value å­—æ®µï¼Œè¿™ä¸ªæ˜¯å®ç° AtomicInteger çš„å…³é”®ã€‚</li>
<li><code>unsafe</code>  - Unsafe ç±»å‹çš„å±æ€§ï¼Œå®ƒä¸º  <code>AtomicInteger</code>  æä¾›äº† CAS æ“ä½œã€‚</li>
</ul>
</blockquote>
<h2 id="-674"><a class="markdownIt-Anchor" href="#-674">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%8E%9F%E5%AD%90%E7%B1%BB.html#_3-%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B">#</a>3. å¼•ç”¨ç±»å‹</h2>
<p>Java æ•°æ®ç±»å‹åˆ†ä¸º <strong>åŸºæœ¬æ•°æ®ç±»å‹</strong> å’Œ <strong>å¼•ç”¨æ•°æ®ç±»å‹</strong> ä¸¤å¤§ç±»ï¼ˆä¸äº†è§£ Java æ•°æ®ç±»å‹åˆ’åˆ†å¯ä»¥å‚è€ƒï¼š <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/basics/java-data-type.md">Java åŸºæœ¬æ•°æ®ç±»å‹ (opens new window)</a>ï¼‰ã€‚</p>
<p>ä¸Šä¸€èŠ‚ä¸­æåˆ°äº†é’ˆå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„åŸå­ç±»ï¼Œé‚£ä¹ˆå¦‚æœæƒ³é’ˆå¯¹å¼•ç”¨ç±»å‹åšåŸå­æ“ä½œæ€ä¹ˆåŠï¼ŸJava ä¹Ÿæä¾›äº†ç›¸å…³çš„åŸå­ç±»ï¼š</p>
<ul>
<li><code>AtomicReference</code>  - å¼•ç”¨ç±»å‹åŸå­ç±»</li>
<li><code>AtomicMarkableReference</code>  - å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li>
<li><code>AtomicStampedReference</code>  - å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li>
</ul>
<blockquote>
<p><code>AtomicStampedReference</code>  ç±»åœ¨å¼•ç”¨ç±»å‹åŸå­ç±»ä¸­ï¼Œå½»åº•åœ°è§£å†³äº† ABA é—®é¢˜ï¼Œå…¶å®ƒçš„ CAS èƒ½åŠ›ä¸å¦å¤–ä¸¤ä¸ªç±»ç›¸è¿‘ï¼Œæ‰€ä»¥æœ€å…·ä»£è¡¨æ€§ã€‚å› æ­¤ï¼Œæœ¬èŠ‚åªé’ˆå¯¹  <code>AtomicStampedReference</code>  è¿›è¡Œè¯´æ˜ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹ï¼šåŸºäº  <code>AtomicReference</code>  å®ç°ä¸€ä¸ªç®€å•çš„è‡ªæ—‹é”</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceDemo2</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ticket <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">threadSafeDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">threadSafeDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpinLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpinLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * åŸºäº &#123;@link AtomicReference&#125; å®ç°çš„ç®€å•è‡ªæ—‹é”
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SpinLock</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">></span></span> atomicReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Thread</span> current <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token comment">/**
     * åˆ©ç”¨è‡ªæ—‹é” &#123;@link SpinLock&#125; å¹¶å‘å¤„ç†æ•°æ®
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">SpinLock</span> lock<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">SpinLock</span> lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lock <span class="token operator">=</span> lock<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ticket <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å–å‡ºäº†ç¬¬ "</span> <span class="token operator">+</span> ticket <span class="token operator">+</span> <span class="token string">" å¼ ç¥¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ticket<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åŸå­ç±»çš„å®ç°åŸºäº CAS æœºåˆ¶ï¼Œè€Œ CAS å­˜åœ¨ ABA é—®é¢˜ï¼ˆä¸äº†è§£ ABA é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.md#cas-%E7%9A%84%E9%97%AE%E9%A2%98">Java å¹¶å‘åŸºç¡€æœºåˆ¶ - CAS çš„é—®é¢˜ (opens new window)</a>ï¼‰ã€‚æ­£æ˜¯ä¸ºäº†è§£å†³ ABA é—®é¢˜ï¼Œæ‰æœ‰äº†  <code>AtomicMarkableReference</code>  å’Œ  <code>AtomicStampedReference</code> ã€‚</p>
<p><code>AtomicMarkableReference</code>  ä½¿ç”¨ä¸€ä¸ªå¸ƒå°”å€¼ä½œä¸ºæ ‡è®°ï¼Œä¿®æ”¹æ—¶åœ¨ true /false ä¹‹é—´åˆ‡æ¢ã€‚è¿™ç§ç­–ç•¥ä¸èƒ½æ ¹æœ¬ä¸Šè§£å†³ ABA é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥é™ä½ ABA å‘ç”Ÿçš„å‡ ç‡ã€‚å¸¸ç”¨äºç¼“å­˜æˆ–è€…çŠ¶æ€æè¿°è¿™æ ·çš„åœºæ™¯ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicMarkableReferenceDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> INIT_TEXT <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">final</span> <span class="token class-name">AtomicMarkableReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> amr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicMarkableReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>INIT_TEXT<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>

                    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>amr<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>INIT_TEXT<span class="token punctuation">,</span> name<span class="token punctuation">,</span> amr<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span>amr<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" ä¿®æ”¹äº†å¯¹è±¡ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–°çš„å¯¹è±¡ä¸ºï¼š"</span> <span class="token operator">+</span> amr<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong> <code>AtomicStampedReference</code>  ä½¿ç”¨ä¸€ä¸ªæ•´å‹å€¼åšä¸ºç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ›´æ–°å‰å…ˆæ¯”è¾ƒç‰ˆæœ¬å·ï¼Œå¦‚æœä¸€è‡´ï¼Œæ‰è¿›è¡Œä¿®æ”¹</strong>ã€‚é€šè¿‡è¿™ç§ç­–ç•¥ï¼Œå¯ä»¥æ ¹æœ¬ä¸Šè§£å†³ ABA é—®é¢˜ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicStampedReferenceDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> INIT_REF <span class="token operator">=</span> <span class="token string">"pool-1-thread-3"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">AtomicStampedReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> asr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicStampedReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>INIT_REF<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åˆå§‹å¯¹è±¡ä¸ºï¼š"</span> <span class="token operator">+</span> asr<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executorService<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token keyword">final</span> <span class="token keyword">int</span> stamp <span class="token operator">=</span> asr<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>asr<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>INIT_REF<span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stamp<span class="token punctuation">,</span> stamp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" ä¿®æ”¹äº†å¯¹è±¡ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–°çš„å¯¹è±¡ä¸ºï¼š"</span> <span class="token operator">+</span> asr<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-675"><a class="markdownIt-Anchor" href="#-675">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%8E%9F%E5%AD%90%E7%B1%BB.html#_4-%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B">#</a>4. æ•°ç»„ç±»å‹</h2>
<p>Java æä¾›äº†ä»¥ä¸‹é’ˆå¯¹æ•°ç»„çš„åŸå­ç±»ï¼š</p>
<ul>
<li><code>AtomicIntegerArray</code>  - æ•´å½¢æ•°ç»„åŸå­ç±»</li>
<li><code>AtomicLongArray</code>  - é•¿æ•´å‹æ•°ç»„åŸå­ç±»</li>
<li><code>AtomicReferenceArray</code>  - å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li>
</ul>
<p>å·²ç»æœ‰äº†é’ˆå¯¹åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„åŸå­ç±»ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æä¾›é’ˆå¯¹æ•°ç»„çš„åŸå­ç±»å‘¢ï¼Ÿ</p>
<p>æ•°ç»„ç±»å‹çš„åŸå­ç±»ä¸º <strong>æ•°ç»„å…ƒç´ </strong> æä¾›äº†  <code>volatile</code>  ç±»å‹çš„è®¿é—®è¯­ä¹‰ï¼Œè¿™æ˜¯æ™®é€šæ•°ç»„æ‰€ä¸å…·å¤‡çš„ç‰¹æ€§ â€”â€”<strong> <code>volatile</code>  ç±»å‹çš„æ•°ç»„ä»…åœ¨æ•°ç»„å¼•ç”¨ä¸Šå…·æœ‰  <code>volatile</code>  è¯­ä¹‰</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼š <code>AtomicIntegerArray</code>  ä½¿ç”¨ç¤ºä¾‹ï¼ˆ <code>AtomicLongArray</code>  ã€ <code>AtomicReferenceArray</code>  ä½¿ç”¨æ–¹å¼ä¹Ÿç±»ä¼¼ï¼‰</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerArrayDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">AtomicIntegerArray</span> atomicIntegerArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicIntegerArray</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Init Values: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            atomicIntegerArray<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Compare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Final Values: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Increment</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">int</span> value <span class="token operator">=</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">", index = "</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">", value = "</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">boolean</span> swapped <span class="token operator">=</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>swapped<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" swapped, index = "</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">", value = 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-676"><a class="markdownIt-Anchor" href="#-676">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%8E%9F%E5%AD%90%E7%B1%BB.html#_5-%E5%B1%9E%E6%80%A7%E6%9B%B4%E6%96%B0%E5%99%A8%E7%B1%BB%E5%9E%8B">#</a>5. å±æ€§æ›´æ–°å™¨ç±»å‹</h2>
<p>æ›´æ–°å™¨ç±»æ”¯æŒåŸºäºåå°„æœºåˆ¶çš„æ›´æ–°å­—æ®µå€¼çš„åŸå­æ“ä½œã€‚</p>
<ul>
<li><code>AtomicIntegerFieldUpdater</code>  - æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li>
<li><code>AtomicLongFieldUpdater</code>  - é•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li>
<li><code>AtomicReferenceFieldUpdater</code>  - åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</li>
</ul>
<p>è¿™äº›ç±»çš„ä½¿ç”¨æœ‰ä¸€å®šé™åˆ¶ï¼š</p>
<ul>
<li>å› ä¸ºå¯¹è±¡çš„å±æ€§ä¿®æ”¹ç±»å‹åŸå­ç±»éƒ½æ˜¯æŠ½è±¡ç±»ï¼Œæ‰€ä»¥æ¯æ¬¡ä½¿ç”¨éƒ½å¿…é¡»ä½¿ç”¨é™æ€æ–¹æ³•  <code>newUpdater()</code>  åˆ›å»ºä¸€ä¸ªæ›´æ–°å™¨ï¼Œå¹¶ä¸”éœ€è¦è®¾ç½®æƒ³è¦æ›´æ–°çš„ç±»å’Œå±æ€§ã€‚</li>
<li>å­—æ®µå¿…é¡»æ˜¯  <code>volatile</code>  ç±»å‹çš„ï¼›</li>
<li>ä¸èƒ½ä½œç”¨äºé™æ€å˜é‡ï¼ˆ <code>static</code> ï¼‰ï¼›</li>
<li>ä¸èƒ½ä½œç”¨äºå¸¸é‡ï¼ˆ <code>final</code> ï¼‰ï¼›</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceFieldUpdaterDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"begin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token class-name">AtomicReferenceFieldUpdater</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> updater <span class="token operator">=</span>
        <span class="token class-name">AtomicReferenceFieldUpdater</span><span class="token punctuation">.</span><span class="token function">newUpdater</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>updater<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">"begin"</span><span class="token punctuation">,</span> <span class="token string">"end"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å·²ä¿®æ”¹ name = "</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" å·²è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">volatile</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-677"><a class="markdownIt-Anchor" href="#-677">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%8E%9F%E5%AD%90%E7%B1%BB.html#_6-%E5%8E%9F%E5%AD%90%E5%8C%96%E7%9A%84%E7%B4%AF%E5%8A%A0%E5%99%A8">#</a>6. åŸå­åŒ–çš„ç´¯åŠ å™¨</h2>
<p><code>DoubleAccumulator</code> ã€ <code>DoubleAdder</code> ã€ <code>LongAccumulator</code>  å’Œ  <code>LongAdder</code> ï¼Œè¿™å››ä¸ªç±»ä»…ä»…ç”¨æ¥æ‰§è¡Œç´¯åŠ æ“ä½œï¼Œç›¸æ¯”åŸå­åŒ–çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯ä¸æ”¯æŒ  <code>compareAndSet()</code>  æ–¹æ³•ã€‚å¦‚æœä½ ä»…ä»…éœ€è¦ç´¯åŠ æ“ä½œï¼Œä½¿ç”¨åŸå­åŒ–çš„ç´¯åŠ å™¨æ€§èƒ½ä¼šæ›´å¥½ï¼Œä»£ä»·å°±æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚</p>
<p><code>LongAdder</code>  å†…éƒ¨ç”±ä¸€ä¸ª  <code>base</code>  å˜é‡å’Œä¸€ä¸ª  <code>cell[]</code>  æ•°ç»„ç»„æˆã€‚</p>
<ul>
<li>å½“åªæœ‰ä¸€ä¸ªå†™çº¿ç¨‹ï¼Œæ²¡æœ‰ç«äº‰çš„æƒ…å†µä¸‹ï¼Œ <code>LongAdder</code>  ä¼šç›´æ¥ä½¿ç”¨  <code>base</code>  å˜é‡ä½œä¸ºåŸå­æ“ä½œå˜é‡ï¼Œé€šè¿‡ CAS æ“ä½œä¿®æ”¹å˜é‡ï¼›</li>
<li>å½“æœ‰å¤šä¸ªå†™çº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹ï¼Œé™¤äº†å ç”¨  <code>base</code>  å˜é‡çš„ä¸€ä¸ªå†™çº¿ç¨‹ä¹‹å¤–ï¼Œå…¶å®ƒå„ä¸ªçº¿ç¨‹ä¼šå°†ä¿®æ”¹çš„å˜é‡å†™å…¥åˆ°è‡ªå·±çš„æ§½  <code>cell[]</code>  æ•°ç»„ä¸­ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ <code>LongAdder</code>  åœ¨æ“ä½œåçš„è¿”å›å€¼åªæ˜¯ä¸€ä¸ªè¿‘ä¼¼å‡†ç¡®çš„æ•°å€¼ï¼Œä½†æ˜¯  <code>LongAdder</code>  æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå‡†ç¡®çš„æ•°å€¼ï¼Œ æ‰€ä»¥åœ¨ä¸€äº›å¯¹å®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ä¸‹ï¼Œ <code>LongAdder</code>  å¹¶ä¸èƒ½å–ä»£  <code>AtomicInteger</code>  æˆ–  <code>AtomicLong</code> ã€‚</p>
<hr>
<h1 id="java-å¹¶å‘å’Œå®¹å™¨"><a class="markdownIt-Anchor" href="#java-å¹¶å‘å’Œå®¹å™¨">#</a> Java å¹¶å‘å’Œå®¹å™¨</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. åŒæ­¥å®¹å™¨
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#11-%E5%90%8C%E6%AD%A5%E5%AE%B9%E5%99%A8%E7%AE%80%E4%BB%8B">1.1. åŒæ­¥å®¹å™¨ç®€ä»‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#12-%E5%90%8C%E6%AD%A5%E5%AE%B9%E5%99%A8%E7%9A%84%E9%97%AE%E9%A2%98">1.2. åŒæ­¥å®¹å™¨çš„é—®é¢˜</a></li>
</ul>
</li>
<li>\2. å¹¶å‘å®¹å™¨ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#21-%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84-map">2.1. å¹¶å‘åœºæ™¯ä¸‹çš„ Map</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#22-%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84-list">2.2. å¹¶å‘åœºæ™¯ä¸‹çš„ List</a></li>
</ul>
</li>
<li>\3. Map
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#31-concurrenthashmap">3.1. ConcurrentHashMap</a></li>
</ul>
</li>
<li>\4. List
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#41-copyonwritearraylist">4.1. CopyOnWriteArrayList</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#5-set">5. Set</a></li>
<li>\6. Queue
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#61-blockingqueue">6.1. BlockingQueue</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#62-priorityblockingqueue-%E7%B1%BB">6.2. PriorityBlockingQueue ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#63-arrayblockingqueue-%E7%B1%BB">6.3. ArrayBlockingQueue ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#64-linkedblockingqueue-%E7%B1%BB">6.4. LinkedBlockingQueue ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#65-synchronousqueue-%E7%B1%BB">6.5. SynchronousQueue ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#66-concurrentlinkeddeque-%E7%B1%BB">6.6. ConcurrentLinkedDeque ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#67-queue-%E7%9A%84%E5%B9%B6%E5%8F%91%E5%BA%94%E7%94%A8">6.7. Queue çš„å¹¶å‘åº”ç”¨</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-678"><a class="markdownIt-Anchor" href="#-678">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_1-%E5%90%8C%E6%AD%A5%E5%AE%B9%E5%99%A8">#</a>1. åŒæ­¥å®¹å™¨</h2>
<h3 id="-679"><a class="markdownIt-Anchor" href="#-679">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_1-1-%E5%90%8C%E6%AD%A5%E5%AE%B9%E5%99%A8%E7%AE%80%E4%BB%8B">#</a>1.1. åŒæ­¥å®¹å™¨ç®€ä»‹</h3>
<p>åœ¨ Java ä¸­ï¼ŒåŒæ­¥å®¹å™¨ä¸»è¦åŒ…æ‹¬ 2 ç±»ï¼š</p>
<ul>
<li>
<pre><code>  Vector
  <pre class="line-numbers language-none"><code class="language-none">
ã€
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
  Stack
  <pre class="line-numbers language-none"><code class="language-none">
ã€
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
  Hashtable
  <pre class="line-numbers language-none"><code class="language-none">
	- &#96;Vector&#96; - &#96;Vector&#96; å®ç°äº† &#96;List&#96; æ¥å£ã€‚&#96;Vector&#96; å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå’Œ &#96;ArrayList&#96; ç±»ä¼¼ã€‚ä½†æ˜¯ &#96;Vector&#96; ä¸­çš„æ–¹æ³•éƒ½æ˜¯ &#96;synchronized&#96; æ–¹æ³•ï¼Œå³è¿›è¡Œäº†åŒæ­¥æªæ–½ã€‚
	- &#96;Stack&#96; - &#96;Stack&#96; ä¹Ÿæ˜¯ä¸€ä¸ªåŒæ­¥å®¹å™¨ï¼Œå®ƒçš„æ–¹æ³•ä¹Ÿç”¨ &#96;synchronized&#96; è¿›è¡Œäº†åŒæ­¥ï¼Œå®ƒå®é™…ä¸Šæ˜¯ç»§æ‰¿äº &#96;Vector&#96; ç±»ã€‚
	- &#96;Hashtable&#96;- &#96;Hashtable&#96; å®ç°äº† &#96;Map&#96; æ¥å£ï¼Œå®ƒå’Œ &#96;HashMap&#96; å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ &#96;Hashtable&#96; è¿›è¡Œäº†åŒæ­¥å¤„ç†ï¼Œè€Œ &#96;HashMap&#96; æ²¡æœ‰ã€‚

- &#96;Collections&#96; ç±»ä¸­æä¾›çš„é™æ€å·¥å‚æ–¹æ³•åˆ›å»ºçš„ç±»ï¼ˆç”± &#96;Collections.synchronizedXXX&#96; ç­‰æ–¹æ³•ï¼‰

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘å’Œå®¹å™¨.html#_1-2-åŒæ­¥å®¹å™¨çš„é—®é¢˜)1.2. åŒæ­¥å®¹å™¨çš„é—®é¢˜

åŒæ­¥å®¹å™¨çš„åŒæ­¥åŸç†å°±æ˜¯åœ¨å…¶ &#96;get&#96;ã€&#96;set&#96;ã€&#96;size&#96; ç­‰ä¸»è¦æ–¹æ³•ä¸Šç”¨ &#96;synchronized&#96; ä¿®é¥°ã€‚ **&#96;synchronized&#96; å¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—**ã€‚

&gt; æƒ³è¯¦ç»†äº†è§£ &#96;synchronized&#96; ç”¨æ³•å’ŒåŸç†å¯ä»¥å‚è€ƒï¼š[Java å¹¶å‘æ ¸å¿ƒæœºåˆ¶(opens new window)](https:&#x2F;&#x2F;github.com&#x2F;dunwu&#x2F;javacore&#x2F;blob&#x2F;master&#x2F;docs&#x2F;concurrent&#x2F;Javaå¹¶å‘æ ¸å¿ƒæœºåˆ¶.md)

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘å’Œå®¹å™¨.html#æ€§èƒ½é—®é¢˜)æ€§èƒ½é—®é¢˜

&#96;synchronized&#96; çš„äº’æ–¥åŒæ­¥ä¼šäº§ç”Ÿé˜»å¡å’Œå”¤é†’çº¿ç¨‹çš„å¼€é”€ã€‚æ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼æ¯”æ²¡æœ‰ä½¿ç”¨ &#96;synchronized&#96; çš„å®¹å™¨æ€§èƒ½è¦å·®å¾ˆå¤šã€‚

&gt; æ³¨ï¼šå°¤å…¶æ˜¯åœ¨ Java 1.6 æ²¡æœ‰å¯¹ &#96;synchronized&#96; è¿›è¡Œä¼˜åŒ–å‰ï¼Œé˜»å¡å¼€é”€å¾ˆé«˜ã€‚

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaå¹¶å‘å’Œå®¹å™¨.html#å®‰å…¨é—®é¢˜)å®‰å…¨é—®é¢˜

åŒæ­¥å®¹å™¨çœŸçš„ç»å¯¹å®‰å…¨å—ï¼Ÿ

å…¶å®ä¹Ÿæœªå¿…ã€‚åœ¨åšå¤åˆæ“ä½œï¼ˆéåŸå­æ“ä½œï¼‰æ—¶ï¼Œä»ç„¶éœ€è¦åŠ é”æ¥ä¿æŠ¤ã€‚å¸¸è§å¤åˆæ“ä½œå¦‚ä¸‹ï¼š

- **è¿­ä»£**ï¼šåå¤è®¿é—®å…ƒç´ ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨å…ƒç´ ï¼›
- **è·³è½¬**ï¼šæ ¹æ®æŒ‡å®šé¡ºåºå¯»æ‰¾å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªï¼ˆä¸‹ n ä¸ªï¼‰å…ƒç´ ï¼›
- **æ¡ä»¶è¿ç®—**ï¼šä¾‹å¦‚è‹¥æ²¡æœ‰åˆ™æ·»åŠ ç­‰ï¼›

âŒ ä¸å®‰å…¨çš„ç¤ºä¾‹

&#96;&#96;&#96;java
public class VectorDemo &#123;

    static Vector&lt;Integer&gt; vector &#x3D; new Vector&lt;&gt;();

    public static void main(String[] args) &#123;
        while (true) &#123;
            vector.clear();

            for (int i &#x3D; 0; i &lt; 10; i++) &#123;
                vector.add(i);
            &#125;

            Thread thread1 &#x3D; new Thread() &#123;
                @Override
                public void run() &#123;
                    for (int i &#x3D; 0; i &lt; vector.size(); i++) &#123;
                        vector.remove(i);
                    &#125;
                &#125;
            &#125;;

            Thread thread2 &#x3D; new Thread() &#123;
                @Override
                public void run() &#123;
                    for (int i &#x3D; 0; i &lt; vector.size(); i++) &#123;
                        vector.get(i);
                    &#125;
                &#125;
            &#125;;

            thread1.start();
            thread2.start();

            while (Thread.activeCount() &gt; 10) &#123;
                System.out.println(&quot;åŒæ—¶å­˜åœ¨ 10 ä¸ªä»¥ä¸Šçº¿ç¨‹ï¼Œé€€å‡º&quot;);
                return;
            &#125;
        &#125;
    &#125;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>ä»¥ä¸Šç¨‹åºæ‰§è¡Œæ—¶å¯èƒ½ä¼šå‡ºç°æ•°ç»„è¶Šç•Œé”™è¯¯ã€‚</p>
<p><code>Vector</code>  æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜ä¼šæŠ¥è¿™ä¸ªé”™ï¼Ÿ</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œå¯¹äº Vectorï¼Œè™½ç„¶èƒ½ä¿è¯æ¯ä¸€ä¸ªæ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®å®ƒï¼Œä½†æ˜¯ä¸æ’é™¤è¿™ç§å¯èƒ½ï¼š</p>
<p>å½“æŸä¸ªçº¿ç¨‹åœ¨æŸä¸ªæ—¶åˆ»æ‰§è¡Œè¿™å¥æ—¶ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>vector<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    vector<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å‡è‹¥æ­¤æ—¶ vector çš„ size æ–¹æ³•è¿”å›çš„æ˜¯ 10ï¼Œi çš„å€¼ä¸º 9</p>
<p>ç„¶åå¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†è¿™å¥ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>vector<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    vector<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å°†ä¸‹æ ‡ä¸º 9 çš„å…ƒç´ åˆ é™¤äº†ã€‚</p>
<p>é‚£ä¹ˆé€šè¿‡ get æ–¹æ³•è®¿é—®ä¸‹æ ‡ä¸º 9 çš„å…ƒç´ è‚¯å®šå°±ä¼šå‡ºé—®é¢˜äº†ã€‚</p>
<p>âœ” å®‰å…¨ç¤ºä¾‹</p>
<p>å› æ­¤ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¿…é¡»åœ¨æ–¹æ³•è°ƒç”¨ç«¯åšé¢å¤–çš„åŒæ­¥æªæ–½ï¼Œå¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VectorDemo2</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> vector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                vector<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>

            <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">VectorDemo2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">//è¿›è¡Œé¢å¤–çš„åŒæ­¥</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vector<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            vector<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

            <span class="token class-name">Thread</span> thread2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">VectorDemo2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> vector<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            vector<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

            thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            thread2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">activeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åŒæ—¶å­˜åœ¨ 10 ä¸ªä»¥ä¸Šçº¿ç¨‹ï¼Œé€€å‡º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ConcurrentModificationException</code>  å¼‚å¸¸</p>
<p>åœ¨å¯¹  <code>Vector</code>  ç­‰å®¹å™¨å¹¶å‘åœ°è¿›è¡Œè¿­ä»£ä¿®æ”¹æ—¶ï¼Œä¼šæŠ¥  <code>ConcurrentModificationException</code>  å¼‚å¸¸ï¼Œå…³äºè¿™ä¸ªå¼‚å¸¸å°†ä¼šåœ¨åç»­æ–‡ç« ä¸­è®²è¿°ã€‚</p>
<p>ä½†æ˜¯åœ¨å¹¶å‘å®¹å™¨ä¸­ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="-680"><a class="markdownIt-Anchor" href="#-680">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_2-%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8%E7%AE%80%E4%BB%8B">#</a>2. å¹¶å‘å®¹å™¨ç®€ä»‹</h2>
<p>åŒæ­¥å®¹å™¨å°†æ‰€æœ‰å¯¹å®¹å™¨çŠ¶æ€çš„è®¿é—®éƒ½ä¸²è¡ŒåŒ–ï¼Œä»¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œè¿™ç§ç­–ç•¥ä¼šä¸¥é‡é™ä½å¹¶å‘æ€§ã€‚</p>
<p>Java 1.5 åæä¾›äº†å¤šç§å¹¶å‘å®¹å™¨ï¼Œ<strong>ä½¿ç”¨å¹¶å‘å®¹å™¨æ¥æ›¿ä»£åŒæ­¥å®¹å™¨ï¼Œå¯ä»¥æå¤§åœ°æé«˜ä¼¸ç¼©æ€§å¹¶é™ä½é£é™©</strong>ã€‚</p>
<p>J.U.C åŒ…ä¸­æä¾›äº†å‡ ä¸ªéå¸¸æœ‰ç”¨çš„å¹¶å‘å®¹å™¨ä½œä¸ºçº¿ç¨‹å®‰å…¨çš„å®¹å™¨ï¼š</p>
<table>
<thead>
<tr>
<th>å¹¶å‘å®¹å™¨</th>
<th>å¯¹åº”çš„æ™®é€šå®¹å™¨</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ConcurrentHashMap</code></td>
<td><code>HashMap</code></td>
<td>Java 1.8 ä¹‹å‰é‡‡ç”¨åˆ†æ®µé”æœºåˆ¶ç»†åŒ–é”ç²’åº¦ï¼Œé™ä½é˜»å¡ï¼Œä»è€Œæé«˜å¹¶å‘æ€§ï¼›Java 1.8 ä¹‹ååŸºäº CAS å®ç°ã€‚</td>
</tr>
<tr>
<td><code>ConcurrentSkipListMap</code></td>
<td><code>SortedMap</code></td>
<td>åŸºäºè·³è¡¨å®ç°çš„</td>
</tr>
<tr>
<td><code>CopyOnWriteArrayList</code></td>
<td><code>ArrayList</code></td>
<td></td>
</tr>
<tr>
<td><code>CopyOnWriteArraySet</code></td>
<td><code>Set</code></td>
<td>åŸºäº  <code>CopyOnWriteArrayList</code>  å®ç°ã€‚</td>
</tr>
<tr>
<td><code>ConcurrentSkipListSet</code></td>
<td><code>SortedSet</code></td>
<td>åŸºäº  <code>ConcurrentSkipListMap</code>  å®ç°ã€‚</td>
</tr>
<tr>
<td><code>ConcurrentLinkedQueue</code></td>
<td><code>Queue</code></td>
<td>çº¿ç¨‹å®‰å…¨çš„æ— ç•Œé˜Ÿåˆ—ã€‚åº•å±‚é‡‡ç”¨å•é“¾è¡¨ã€‚æ”¯æŒ FIFOã€‚</td>
</tr>
<tr>
<td><code>ConcurrentLinkedDeque</code></td>
<td><code>Deque</code></td>
<td>çº¿ç¨‹å®‰å…¨çš„æ— ç•ŒåŒç«¯é˜Ÿåˆ—ã€‚åº•å±‚é‡‡ç”¨åŒå‘é“¾è¡¨ã€‚æ”¯æŒ FIFO å’Œ FILOã€‚</td>
</tr>
<tr>
<td><code>ArrayBlockingQueue</code></td>
<td><code>Queue</code></td>
<td>æ•°ç»„å®ç°çš„é˜»å¡é˜Ÿåˆ—ã€‚</td>
</tr>
<tr>
<td><code>LinkedBlockingQueue</code></td>
<td><code>Queue</code></td>
<td>é“¾è¡¨å®ç°çš„é˜»å¡é˜Ÿåˆ—ã€‚</td>
</tr>
<tr>
<td><code>LinkedBlockingDeque</code></td>
<td><code>Deque</code></td>
<td>åŒå‘é“¾è¡¨å®ç°çš„åŒç«¯é˜»å¡é˜Ÿåˆ—ã€‚</td>
</tr>
</tbody>
</table>
<p>J.U.C åŒ…ä¸­æä¾›çš„å¹¶å‘å®¹å™¨å‘½åä¸€èˆ¬åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>
<pre><code>  Concurrent
  <pre class="line-numbers language-none"><code class="language-none">
	- è¿™ç±»å‹çš„é”ç«äº‰ç›¸å¯¹äº &#96;CopyOnWrite&#96; è¦é«˜ä¸€äº›ï¼Œä½†å†™æ“ä½œä»£ä»·è¦å°ä¸€äº›ã€‚
	- æ­¤å¤–ï¼Œ&#96;Concurrent&#96; å¾€å¾€æä¾›äº†è¾ƒä½çš„éå†ä¸€è‡´æ€§ï¼Œå³ï¼šå½“åˆ©ç”¨è¿­ä»£å™¨éå†æ—¶ï¼Œå¦‚æœå®¹å™¨å‘ç”Ÿä¿®æ”¹ï¼Œè¿­ä»£å™¨ä»ç„¶å¯ä»¥ç»§ç»­è¿›è¡Œéå†ã€‚ä»£ä»·å°±æ˜¯ï¼Œåœ¨è·å–å®¹å™¨å¤§å° &#96;size()&#96; ï¼Œå®¹å™¨æ˜¯å¦ä¸ºç©ºç­‰æ–¹æ³•ï¼Œä¸ä¸€å®šå®Œå…¨ç²¾ç¡®ï¼Œä½†è¿™æ˜¯ä¸ºäº†è·å–å¹¶å‘ååé‡çš„è®¾è®¡å–èˆï¼Œå¯ä»¥ç†è§£ã€‚ä¸ä¹‹ç›¸æ¯”ï¼Œå¦‚æœæ˜¯ä½¿ç”¨åŒæ­¥å®¹å™¨ï¼Œå°±ä¼šå‡ºç° &#96;fail-fast&#96; é—®é¢˜ï¼Œå³ï¼šæ£€æµ‹åˆ°å®¹å™¨åœ¨éå†è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä¿®æ”¹ï¼Œåˆ™æŠ›å‡º &#96;ConcurrentModificationException&#96;ï¼Œä¸å†ç»§ç»­éå†ã€‚

- &#96;CopyOnWrite&#96; - ä¸€ä¸ªçº¿ç¨‹å†™ï¼Œå¤šä¸ªçº¿ç¨‹è¯»ã€‚è¯»æ“ä½œæ—¶ä¸åŠ é”ï¼Œå†™æ“ä½œæ—¶é€šè¿‡åœ¨å‰¯æœ¬ä¸ŠåŠ é”ä¿è¯å¹¶å‘å®‰å…¨ï¼Œç©ºé—´å¼€é”€è¾ƒå¤§ã€‚

- &#96;Blocking&#96; - å†…éƒ¨å®ç°ä¸€èˆ¬æ˜¯åŸºäºé”ï¼Œæä¾›é˜»å¡é˜Ÿåˆ—çš„èƒ½åŠ›ã€‚

âŒ é”™è¯¯ç¤ºä¾‹ï¼Œäº§ç”Ÿ &#96;ConcurrentModificationException&#96; å¼‚å¸¸ï¼š

&#96;&#96;&#96;java
public void removeKeys(Map&lt;String, Object&gt; map, final String... keys) &#123;
    map.keySet().removeIf(key -&gt; ArrayUtil.contains(keys, key));
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>âŒ é”™è¯¯ç¤ºä¾‹ï¼Œäº§ç”Ÿ  <code>ConcurrentModificationException</code>  å¼‚å¸¸ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">removeKeys</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> map<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">K</span> key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> map<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-681"><a class="markdownIt-Anchor" href="#-681">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_2-1-%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84-map">#</a>2.1. å¹¶å‘åœºæ™¯ä¸‹çš„ Map</h3>
<p>å¦‚æœå¯¹æ•°æ®æœ‰å¼ºä¸€è‡´è¦æ±‚ï¼Œåˆ™éœ€ä½¿ç”¨  <code>Hashtable</code> ï¼›åœ¨å¤§éƒ¨åˆ†åœºæ™¯é€šå¸¸éƒ½æ˜¯å¼±ä¸€è‡´æ€§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨  <code>ConcurrentHashMap</code>  å³å¯ï¼›å¦‚æœæ•°æ®é‡åœ¨åƒä¸‡çº§åˆ«ï¼Œä¸”å­˜åœ¨å¤§é‡å¢åˆ æ”¹æ“ä½œï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨  <code>ConcurrentSkipListMap</code> ã€‚</p>
<h3 id="-682"><a class="markdownIt-Anchor" href="#-682">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_2-2-%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E7%9A%84-list">#</a>2.2. å¹¶å‘åœºæ™¯ä¸‹çš„ List</h3>
<p>è¯»å¤šå†™å°‘ç”¨  <code>CopyOnWriteArrayList</code> ã€‚</p>
<p>å†™å¤šè¯»å°‘ç”¨  <code>ConcurrentLinkedQueue</code>  ï¼Œä½†ç”±äºæ˜¯æ— ç•Œçš„ï¼Œè¦æœ‰å®¹é‡é™åˆ¶ï¼Œé¿å…æ— é™è†¨èƒ€ï¼Œå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p>
<h2 id="-683"><a class="markdownIt-Anchor" href="#-683">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_3-map">#</a>3. Map</h2>
<p>Map æ¥å£çš„ä¸¤ä¸ªå®ç°æ˜¯ ConcurrentHashMap å’Œ ConcurrentSkipListMapï¼Œå®ƒä»¬ä»åº”ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œä¸»è¦åŒºåˆ«åœ¨äº<strong> ConcurrentHashMap çš„ key æ˜¯æ— åºçš„ï¼Œè€Œ ConcurrentSkipListMap çš„ key æ˜¯æœ‰åºçš„</strong>ã€‚æ‰€ä»¥å¦‚æœä½ éœ€è¦ä¿è¯ key çš„é¡ºåºï¼Œå°±åªèƒ½ä½¿ç”¨ ConcurrentSkipListMapã€‚</p>
<p>ä½¿ç”¨ ConcurrentHashMap å’Œ ConcurrentSkipListMap éœ€è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œå®ƒä»¬çš„ key å’Œ value éƒ½ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™ä¼šæŠ›å‡º <code>NullPointerException</code>  è¿™ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚</p>
<h3 id="-684"><a class="markdownIt-Anchor" href="#-684">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_3-1-concurrenthashmap">#</a>3.1. ConcurrentHashMap</h3>
<p><code>ConcurrentHashMap</code>  æ˜¯çº¿ç¨‹å®‰å…¨çš„  <code>HashMap</code>  ï¼Œç”¨äºæ›¿ä»£  <code>Hashtable</code> ã€‚</p>
<h4 id="-685"><a class="markdownIt-Anchor" href="#-685">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#concurrenthashmap-%E7%9A%84%E7%89%B9%E6%80%A7">#</a> <code>ConcurrentHashMap</code>  çš„ç‰¹æ€§</h4>
<p><code>ConcurrentHashMap</code>   <code>å®ç°äº†</code>   <code>ConcurrentMap</code>  æ¥å£ï¼Œè€Œ  <code>ConcurrentMap</code>  æ¥å£æ‰©å±•äº†  <code>Map</code>  æ¥å£ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ConcurrentHashMap</code>  çš„å®ç°åŒ…å«äº†  <code>HashMap</code>  æ‰€æœ‰çš„åŸºæœ¬ç‰¹æ€§ï¼Œå¦‚ï¼šæ•°æ®ç»“æ„ã€è¯»å†™ç­–ç•¥ç­‰ã€‚</p>
<p><code>ConcurrentHashMap</code>  æ²¡æœ‰å®ç°å¯¹  <code>Map</code>  åŠ é”ä»¥æä¾›ç‹¬å è®¿é—®ã€‚å› æ­¤æ— æ³•é€šè¿‡åœ¨å®¢æˆ·ç«¯åŠ é”çš„æ–¹å¼æ¥åˆ›å»ºæ–°çš„åŸå­æ“ä½œã€‚ä½†æ˜¯ï¼Œä¸€äº›å¸¸è§çš„å¤åˆæ“ä½œï¼Œå¦‚ï¼šâ€œè‹¥æ²¡æœ‰åˆ™æ·»åŠ â€ã€â€œè‹¥ç›¸ç­‰åˆ™ç§»é™¤â€ã€â€œè‹¥ç›¸ç­‰åˆ™æ›¿æ¢â€ï¼Œéƒ½å·²ç»å®ç°ä¸ºåŸå­æ“ä½œï¼Œå¹¶ä¸”æ˜¯å›´ç»•  <code>ConcurrentMap</code>  çš„æ‰©å±•æ¥å£è€Œå®ç°ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// ä»…å½“ K æ²¡æœ‰ç›¸åº”çš„æ˜ å°„å€¼æ‰æ’å…¥</span>
    <span class="token class-name">V</span> <span class="token function">putIfAbsent</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä»…å½“ K è¢«æ˜ å°„åˆ° V æ—¶æ‰ç§»é™¤</span>
    <span class="token keyword">boolean</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä»…å½“ K è¢«æ˜ å°„åˆ° oldValue æ—¶æ‰æ›¿æ¢ä¸º newValue</span>
    <span class="token keyword">boolean</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> oldValue<span class="token punctuation">,</span> <span class="token class-name">V</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä»…å½“ K è¢«æ˜ å°„åˆ°æŸä¸ªå€¼æ—¶æ‰æ›¿æ¢ä¸º newValue</span>
    <span class="token class-name">V</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸åŒäº  <code>Hashtable</code> ï¼Œ <code>ConcurrentHashMap</code>  æä¾›çš„è¿­ä»£å™¨ä¸ä¼šæŠ›å‡º  <code>ConcurrentModificationException</code> ï¼Œå› æ­¤ä¸éœ€è¦åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å¯¹å®¹å™¨åŠ é”ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šä¸€äº›éœ€è¦å¯¹æ•´ä¸ª  <code>Map</code>  è¿›è¡Œè®¡ç®—çš„æ–¹æ³•ï¼Œå¦‚  <code>size</code>  å’Œ  <code>isEmpty</code>  ï¼Œç”±äºè¿”å›çš„ç»“æœåœ¨è®¡ç®—æ—¶å¯èƒ½å·²ç»è¿‡æœŸï¼Œæ‰€ä»¥<strong>å¹¶éå®æ—¶çš„ç²¾ç¡®å€¼</strong>ã€‚è¿™æ˜¯ä¸€ç§ç­–ç•¥ä¸Šçš„æƒè¡¡ï¼Œåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œè¿™ç±»æ–¹æ³•ç”±äºæ€»åœ¨ä¸æ–­å˜åŒ–ï¼Œæ‰€ä»¥è·å–å…¶å®æ—¶ç²¾ç¡®å€¼çš„æ„ä¹‰ä¸å¤§ã€‚ <code>ConcurrentHashMap</code>  å¼±åŒ–è¿™ç±»æ–¹æ³•ï¼Œä»¥æ¢å–æ›´é‡è¦æ“ä½œï¼ˆå¦‚ï¼š <code>get</code> ã€ <code>put</code> ã€ <code>containesKey</code> ã€ <code>remove</code>  ç­‰ï¼‰çš„æ€§èƒ½ã€‚</p>
</blockquote>
<h4 id="-686"><a class="markdownIt-Anchor" href="#-686">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#concurrenthashmap-%E7%9A%84%E7%94%A8%E6%B3%95">#</a>ConcurrentHashMap çš„ç”¨æ³•</h4>
<p>ç¤ºä¾‹ï¼šä¸ä¼šå‡ºç°  <code>ConcurrentModificationException</code></p>
<p><code>ConcurrentHashMap</code>  çš„åŸºæœ¬æ“ä½œä¸  <code>HashMap</code>  çš„ç”¨æ³•åŸºæœ¬ä¸€æ ·ã€‚ä¸åŒäº  <code>HashMap</code> ã€ <code>Hashtable</code> ï¼Œ <code>ConcurrentHashMap</code>  æä¾›çš„è¿­ä»£å™¨ä¸ä¼šæŠ›å‡º  <code>ConcurrentModificationException</code> ï¼Œå› æ­¤ä¸éœ€è¦åœ¨è¿­ä»£è¿‡ç¨‹ä¸­å¯¹å®¹å™¨åŠ é”ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentHashMapDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// HashMap åœ¨å¹¶å‘è¿­ä»£è®¿é—®æ—¶ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸</span>
        <span class="token comment">// Map&lt;Integer, Character> map = new HashMap&lt;>();</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Character</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> wthread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å†™æ“ä½œçº¿ç¨‹å¼€å§‹æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">26</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token string">'a'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> rthread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¯»æ“ä½œçº¿ç¨‹å¼€å§‹æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> key <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wthread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rthread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-687"><a class="markdownIt-Anchor" href="#-687">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#concurrenthashmap-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>ConcurrentHashMap çš„åŸç†</h4>
<blockquote>
<p><code>ConcurrentHashMap</code>  ä¸€ç›´åœ¨æ¼”è¿›ï¼Œå°¤å…¶åœ¨ Java 1.7 å’Œ Java 1.8ï¼Œå…¶æ•°æ®ç»“æ„å’Œå¹¶å‘æœºåˆ¶æœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚</p>
</blockquote>
<ul>
<li>Java 1.7
<ul>
<li>æ•°æ®ç»“æ„ï¼š<strong>æ•°ç»„ï¼‹å•é“¾è¡¨</strong></li>
<li>å¹¶å‘æœºåˆ¶ï¼šé‡‡ç”¨åˆ†æ®µé”æœºåˆ¶ç»†åŒ–é”ç²’åº¦ï¼Œé™ä½é˜»å¡ï¼Œä»è€Œæé«˜å¹¶å‘æ€§ã€‚</li>
</ul>
</li>
<li>Java 1.8
<ul>
<li>æ•°æ®ç»“æ„ï¼š<strong>æ•°ç»„ï¼‹å•é“¾è¡¨ï¼‹çº¢é»‘æ ‘</strong></li>
<li>å¹¶å‘æœºåˆ¶ï¼šå–æ¶ˆåˆ†æ®µé”ï¼Œä¹‹ååŸºäº CAS + synchronized å®ç°ã€‚</li>
</ul>
</li>
</ul>
<h5 id="-688"><a class="markdownIt-Anchor" href="#-688">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#java-1-7-%E7%9A%84%E5%AE%9E%E7%8E%B0">#</a>Java 1.7 çš„å®ç°</h5>
<p>åˆ†æ®µé”ï¼Œæ˜¯å°†å†…éƒ¨è¿›è¡Œåˆ†æ®µï¼ˆSegmentï¼‰ï¼Œé‡Œé¢æ˜¯  <code>HashEntry</code>  æ•°ç»„ï¼Œå’Œ  <code>HashMap</code>  ç±»ä¼¼ï¼Œå“ˆå¸Œç›¸åŒçš„æ¡ç›®ä¹Ÿæ˜¯ä»¥é“¾è¡¨å½¢å¼å­˜æ”¾ã€‚  <code>HashEntry</code>  å†…éƒ¨ä½¿ç”¨  <code>volatile</code>  çš„  <code>value</code>  å­—æ®µæ¥ä¿è¯å¯è§æ€§ï¼Œä¹Ÿåˆ©ç”¨äº†ä¸å¯å˜å¯¹è±¡çš„æœºåˆ¶ï¼Œä»¥æ”¹è¿›åˆ©ç”¨  <code>Unsafe</code>  æä¾›çš„åº•å±‚èƒ½åŠ›ï¼Œæ¯”å¦‚ volatile accessï¼Œå»ç›´æ¥å®Œæˆéƒ¨åˆ†æ“ä½œï¼Œä»¥æœ€ä¼˜åŒ–æ€§èƒ½ï¼Œæ¯•ç«Ÿ  <code>Unsafe</code>  ä¸­çš„å¾ˆå¤šæ“ä½œéƒ½æ˜¯ JVM intrinsic ä¼˜åŒ–è¿‡çš„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200605214405.png" alt="img"></p>
<p>åœ¨è¿›è¡Œå¹¶å‘å†™æ“ä½œæ—¶ï¼Œ <code>ConcurrentHashMap</code>  ä¼šè·å–å¯é‡å…¥é”ï¼ˆ <code>ReentrantLock</code> ï¼‰ï¼Œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚æ‰€ä»¥ï¼Œåœ¨å¹¶å‘ä¿®æ”¹æœŸé—´ï¼Œç›¸åº”  <code>Segment</code>  æ˜¯è¢«é”å®šçš„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name">ConcurrentMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>

    <span class="token comment">// å°†æ•´ä¸ªhashmapåˆ†æˆå‡ ä¸ªå°çš„mapï¼Œæ¯ä¸ªsegmentéƒ½æ˜¯ä¸€ä¸ªé”ï¼›ä¸hashtableç›¸æ¯”ï¼Œè¿™ä¹ˆè®¾è®¡çš„ç›®çš„æ˜¯å¯¹äºput, removeç­‰æ“ä½œï¼Œå¯ä»¥å‡å°‘å¹¶å‘å†²çªï¼Œå¯¹</span>
    <span class="token comment">// ä¸å±äºåŒä¸€ä¸ªç‰‡æ®µçš„èŠ‚ç‚¹å¯ä»¥å¹¶å‘æ“ä½œï¼Œå¤§å¤§æé«˜äº†æ€§èƒ½</span>
    <span class="token keyword">final</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> segments<span class="token punctuation">;</span>

    <span class="token comment">// æœ¬è´¨ä¸ŠSegmentç±»å°±æ˜¯ä¸€ä¸ªå°çš„hashmapï¼Œé‡Œé¢tableæ•°ç»„å­˜å‚¨äº†å„ä¸ªèŠ‚ç‚¹çš„æ•°æ®ï¼Œç»§æ‰¿äº†ReentrantLock, å¯ä»¥ä½œä¸ºäº’æ‹†é”ä½¿ç”¨</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Segment</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">ReentrantLock</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>
        <span class="token keyword">transient</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// åŸºæœ¬èŠ‚ç‚¹ï¼Œå­˜å‚¨Keyï¼Œ Valueå€¼</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
        <span class="token keyword">volatile</span> <span class="token class-name">V</span> value<span class="token punctuation">;</span>
        <span class="token keyword">volatile</span> <span class="token class-name">HashEntry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="-689"><a class="markdownIt-Anchor" href="#-689">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#java-1-8-%E7%9A%84%E5%AE%9E%E7%8E%B0">#</a>Java 1.8 çš„å®ç°</h5>
<ul>
<li>æ•°æ®ç»“æ„æ”¹è¿›ï¼šä¸ HashMap ä¸€æ ·ï¼Œå°†åŸå…ˆ <strong>æ•°ç»„ï¼‹å•é“¾è¡¨</strong> çš„æ•°æ®ç»“æ„ï¼Œå˜æ›´ä¸º <strong>æ•°ç»„ï¼‹å•é“¾è¡¨ï¼‹çº¢é»‘æ ‘</strong> çš„ç»“æ„ã€‚å½“å‡ºç°å“ˆå¸Œå†²çªæ—¶ï¼Œæ•°æ®ä¼šå­˜å…¥æ•°ç»„æŒ‡å®šæ¡¶çš„å•é“¾è¡¨ï¼Œå½“é“¾è¡¨é•¿åº¦è¾¾åˆ° 8ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºçº¢é»‘æ ‘ç»“æ„ï¼Œè¿™æ ·å…¶æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å¯ä»¥é™ä½åˆ° $$O (logN)$$ï¼Œä»¥æ”¹è¿›æ€§èƒ½ã€‚</li>
<li>å¹¶å‘æœºåˆ¶æ”¹è¿›ï¼š
<ul>
<li>å–æ¶ˆ segments å­—æ®µï¼Œ<strong>ç›´æ¥é‡‡ç”¨  <code>transient volatile HashEntry&lt;K,V&gt;[] table</code>  ä¿å­˜æ•°æ®ï¼Œé‡‡ç”¨ table æ•°ç»„å…ƒç´ ä½œä¸ºé”ï¼Œä»è€Œå®ç°äº†å¯¹æ¯ä¸€è¡Œæ•°æ®è¿›è¡ŒåŠ é”ï¼Œè¿›ä¸€æ­¥å‡å°‘å¹¶å‘å†²çªçš„æ¦‚ç‡</strong>ã€‚</li>
<li>ä½¿ç”¨ CAS +  <code>sychronized</code>  æ“ä½œï¼Œåœ¨ç‰¹å®šåœºæ™¯è¿›è¡Œæ— é”å¹¶å‘æ“ä½œã€‚ä½¿ç”¨ Unsafeã€LongAdder ä¹‹ç±»åº•å±‚æ‰‹æ®µï¼Œè¿›è¡Œæç«¯æƒ…å†µçš„ä¼˜åŒ–ã€‚ç°ä»£ JDK ä¸­ï¼Œsynchronized å·²ç»è¢«ä¸æ–­ä¼˜åŒ–ï¼Œå¯ä»¥ä¸å†è¿‡åˆ†æ‹…å¿ƒæ€§èƒ½å·®å¼‚ï¼Œå¦å¤–ï¼Œç›¸æ¯”äº ReentrantLockï¼Œå®ƒå¯ä»¥å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œè¿™æ˜¯ä¸ªéå¸¸å¤§çš„ä¼˜åŠ¿ã€‚</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">spread</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab <span class="token operator">=</span> table<span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> f<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">,</span> fh<span class="token punctuation">;</span>
        <span class="token comment">// å¦‚æœtableä¸ºç©ºï¼Œåˆå§‹åŒ–ï¼›å¦åˆ™ï¼Œæ ¹æ®hashå€¼è®¡ç®—å¾—åˆ°æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtab[i]ä¸ºç©ºï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹Nodeå³å¯ã€‚æ³¨ï¼štab[i]å®è´¨ä¸ºé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘çš„é¦–èŠ‚ç‚¹ã€‚</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tab <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            tab <span class="token operator">=</span> <span class="token function">initTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">casTabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                         <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>                   <span class="token comment">// no lock when adding to empty bin</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// å¦‚æœtab[i]ä¸ä¸ºç©ºå¹¶ä¸”hashå€¼ä¸ºMOVEDï¼Œè¯´æ˜è¯¥é“¾è¡¨æ­£åœ¨è¿›è¡Œtransferæ“ä½œï¼Œè¿”å›æ‰©å®¹å®Œæˆåçš„tableã€‚</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fh <span class="token operator">=</span> f<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token operator">==</span> MOVED<span class="token punctuation">)</span>
            tab <span class="token operator">=</span> <span class="token function">helpTransfer</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">V</span> oldVal <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token comment">// é’ˆå¯¹é¦–ä¸ªèŠ‚ç‚¹è¿›è¡ŒåŠ é”æ“ä½œï¼Œè€Œä¸æ˜¯segmentï¼Œè¿›ä¸€æ­¥å‡å°‘çº¿ç¨‹å†²çª</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">tabAt</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> f<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>fh <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        binCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> f<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token class-name">K</span> ek<span class="token punctuation">;</span>
                            <span class="token comment">// å¦‚æœåœ¨é“¾è¡¨ä¸­æ‰¾åˆ°å€¼ä¸ºkeyçš„èŠ‚ç‚¹eï¼Œç›´æ¥è®¾ç½®e.val = valueå³å¯ã€‚</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                                <span class="token punctuation">(</span><span class="token punctuation">(</span>ek <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span>
                                 <span class="token punctuation">(</span>ek <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>ek<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                oldVal <span class="token operator">=</span> e<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>
                                    e<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                            <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å€¼ä¸ºkeyçš„èŠ‚ç‚¹ï¼Œç›´æ¥æ–°å»ºNodeå¹¶åŠ å…¥é“¾è¡¨å³å¯ã€‚</span>
                            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> pred <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                                pred<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span>
                                                          value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token comment">// å¦‚æœé¦–èŠ‚ç‚¹ä¸ºTreeBinç±»å‹ï¼Œè¯´æ˜ä¸ºçº¢é»‘æ ‘ç»“æ„ï¼Œæ‰§è¡ŒputTreeValæ“ä½œã€‚</span>
                    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token keyword">instanceof</span> <span class="token class-name">TreeBin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span>
                        binCount <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeBin</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span>
                                                       value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            oldVal <span class="token operator">=</span> p<span class="token punctuation">.</span>val<span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent<span class="token punctuation">)</span>
                                p<span class="token punctuation">.</span>val <span class="token operator">=</span> value<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// å¦‚æœèŠ‚ç‚¹æ•°>ï¼8ï¼Œé‚£ä¹ˆè½¬æ¢é“¾è¡¨ç»“æ„ä¸ºçº¢é»‘æ ‘ç»“æ„ã€‚</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> TREEIFY_THRESHOLD<span class="token punctuation">)</span>
                    <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVal <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> oldVal<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// è®¡æ•°å¢åŠ 1ï¼Œæœ‰å¯èƒ½è§¦å‘transferæ“ä½œ(æ‰©å®¹)ã€‚</span>
    <span class="token function">addCount</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span> binCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-690"><a class="markdownIt-Anchor" href="#-690">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#concurrenthashmap-%E7%9A%84%E5%AE%9E%E6%88%98">#</a>ConcurrentHashMap çš„å®æˆ˜</h4>
<blockquote>
<p>ç¤ºä¾‹æ‘˜è‡ªï¼š<a target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100047701">ã€ŠJava ä¸šåŠ¡å¼€å‘å¸¸è§é”™è¯¯ 100 ä¾‹ã€‹(opens new window)</a></p>
</blockquote>
<h5 id="-691"><a class="markdownIt-Anchor" href="#-691">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#concurrenthashmap-%E9%94%99%E8%AF%AF%E7%A4%BA%E4%BE%8B">#</a>ConcurrentHashMap é”™è¯¯ç¤ºä¾‹</h5>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//çº¿ç¨‹ä¸ªæ•°</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> THREAD_COUNT <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">//æ€»å…ƒç´ æ•°é‡</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ITEM_COUNT <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> concurrentHashMap <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>ITEM_COUNT <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆå§‹900ä¸ªå…ƒç´ </span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"init size:"</span> <span class="token operator">+</span> concurrentHashMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span>THREAD_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä½¿ç”¨çº¿ç¨‹æ± å¹¶å‘å¤„ç†é€»è¾‘</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//æŸ¥è¯¢è¿˜éœ€è¦è¡¥å……å¤šå°‘ä¸ªå…ƒç´ </span>
        <span class="token keyword">int</span> gap <span class="token operator">=</span> ITEM_COUNT <span class="token operator">-</span> concurrentHashMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"gap size:"</span> <span class="token operator">+</span> gap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¡¥å……å…ƒç´ </span>
        concurrentHashMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">getData</span><span class="token punctuation">(</span>gap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æœ€åå…ƒç´ ä¸ªæ•°ä¼šæ˜¯1000å—ï¼Ÿ</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finish size:"</span> <span class="token operator">+</span> concurrentHashMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toConcurrentMap</span><span class="token punctuation">(</span>
                i <span class="token operator">-></span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                i <span class="token operator">-></span> i<span class="token punctuation">,</span>
                <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">-></span> o1<span class="token punctuation">,</span>
                <span class="token class-name">ConcurrentHashMap</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åˆå§‹å¤§å° 900 ç¬¦åˆé¢„æœŸï¼Œè¿˜éœ€è¦å¡«å…… 100 ä¸ªå…ƒç´ ã€‚</p>
<p>é¢„æœŸç»“æœä¸º 1000 ä¸ªå…ƒç´ ï¼Œå®é™…å¤§äº 1000 ä¸ªå…ƒç´ ã€‚</p>
<p>ã€åˆ†æã€‘</p>
<p>ConcurrentHashMap å¯¹å¤–æä¾›çš„æ–¹æ³•æˆ–èƒ½åŠ›çš„é™åˆ¶ï¼š</p>
<ul>
<li>ä½¿ç”¨äº† ConcurrentHashMapï¼Œä¸ä»£è¡¨å¯¹å®ƒçš„å¤šä¸ªæ“ä½œä¹‹é—´çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œæ˜¯æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨æ“ä½œå®ƒçš„ï¼Œå¦‚æœéœ€è¦ç¡®ä¿éœ€è¦æ‰‹åŠ¨åŠ é”ã€‚</li>
<li>è¯¸å¦‚ sizeã€isEmpty å’Œ containsValue ç­‰èšåˆæ–¹æ³•ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹å¯èƒ½ä¼šåæ˜  ConcurrentHashMap çš„ä¸­é—´çŠ¶æ€ã€‚å› æ­¤åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œè¿™äº›æ–¹æ³•çš„è¿”å›å€¼åªèƒ½ç”¨ä½œå‚è€ƒï¼Œè€Œä¸èƒ½ç”¨äºæµç¨‹æ§åˆ¶ã€‚æ˜¾ç„¶ï¼Œåˆ©ç”¨ size æ–¹æ³•è®¡ç®—å·®å¼‚å€¼ï¼Œæ˜¯ä¸€ä¸ªæµç¨‹æ§åˆ¶ã€‚</li>
<li>è¯¸å¦‚ putAll è¿™æ ·çš„èšåˆæ–¹æ³•ä¹Ÿä¸èƒ½ç¡®ä¿åŸå­æ€§ï¼Œåœ¨ putAll çš„è¿‡ç¨‹ä¸­å»è·å–æ•°æ®å¯èƒ½ä¼šè·å–åˆ°éƒ¨åˆ†æ•°æ®ã€‚</li>
</ul>
<h5 id="-692"><a class="markdownIt-Anchor" href="#-692">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#concurrenthashmap-%E9%94%99%E8%AF%AF%E7%A4%BA%E4%BE%8B%E4%BF%AE%E6%AD%A3-1-0-%E7%89%88">#</a>ConcurrentHashMap é”™è¯¯ç¤ºä¾‹ä¿®æ­£ 1.0 ç‰ˆ</h5>
<p>é€šè¿‡ synchronized åŠ é”ï¼Œå½“ç„¶å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä½†æ˜¯ç‰ºç‰²äº† ConcurrentHashMap çš„æ€§èƒ½ï¼Œæ²¡å“ŸçœŸæ­£å‘æŒ¥å‡º ConcurrentHashMap çš„ç‰¹æ€§ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//çº¿ç¨‹ä¸ªæ•°</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> THREAD_COUNT <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">//æ€»å…ƒç´ æ•°é‡</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ITEM_COUNT <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> concurrentHashMap <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>ITEM_COUNT <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//åˆå§‹900ä¸ªå…ƒç´ </span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"init size:"</span> <span class="token operator">+</span> concurrentHashMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span>THREAD_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ä½¿ç”¨çº¿ç¨‹æ± å¹¶å‘å¤„ç†é€»è¾‘</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//æŸ¥è¯¢è¿˜éœ€è¦è¡¥å……å¤šå°‘ä¸ªå…ƒç´ </span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>concurrentHashMap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">int</span> gap <span class="token operator">=</span> ITEM_COUNT <span class="token operator">-</span> concurrentHashMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"gap size:"</span> <span class="token operator">+</span> gap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è¡¥å……å…ƒç´ </span>
            concurrentHashMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">getData</span><span class="token punctuation">(</span>gap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//æœ€åå…ƒç´ ä¸ªæ•°ä¼šæ˜¯1000å—ï¼Ÿ</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"finish size:"</span> <span class="token operator">+</span> concurrentHashMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token class-name">LongStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>
            <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toConcurrentMap</span><span class="token punctuation">(</span>
                i <span class="token operator">-></span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                i <span class="token operator">-></span> i<span class="token punctuation">,</span>
                <span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token operator">-></span> o1<span class="token punctuation">,</span>
                <span class="token class-name">ConcurrentHashMap</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="-693"><a class="markdownIt-Anchor" href="#-693">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#concurrenthashmap-%E9%94%99%E8%AF%AF%E7%A4%BA%E4%BE%8B%E4%BF%AE%E6%AD%A3-2-0-%E7%89%88">#</a>ConcurrentHashMap é”™è¯¯ç¤ºä¾‹ä¿®æ­£ 2.0 ç‰ˆ</h5>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//å¾ªç¯æ¬¡æ•°</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> LOOP_COUNT <span class="token operator">=</span> <span class="token number">10000000</span><span class="token punctuation">;</span>
<span class="token comment">//çº¿ç¨‹ä¸ªæ•°</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> THREAD_COUNT <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token comment">//æ€»å…ƒç´ æ•°é‡</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> ITEM_COUNT <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">"normaluse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> normaluse <span class="token operator">=</span> <span class="token function">normaluse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>normaluse<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ITEM_COUNT<span class="token punctuation">,</span> <span class="token string">"normaluse size error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>normaluse<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToLong</span><span class="token punctuation">(</span>aLong <span class="token operator">-></span> aLong<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span> <span class="token operator">==</span> LOOP_COUNT
        <span class="token punctuation">,</span> <span class="token string">"normaluse count error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">"gooduse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> gooduse <span class="token operator">=</span> <span class="token function">gooduse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>gooduse<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ITEM_COUNT<span class="token punctuation">,</span> <span class="token string">"gooduse size error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">isTrue</span><span class="token punctuation">(</span>gooduse<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">mapToLong</span><span class="token punctuation">(</span>l <span class="token operator">-></span> l<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token operator">::</span><span class="token function">sum</span><span class="token punctuation">)</span> <span class="token operator">==</span> LOOP_COUNT
        <span class="token punctuation">,</span> <span class="token string">"gooduse count error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stopWatch<span class="token punctuation">.</span><span class="token function">prettyPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token function">normaluse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> freqs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>ITEM_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span>THREAD_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> LOOP_COUNT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">"item"</span> <span class="token operator">+</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>ITEM_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>freqs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>freqs<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    freqs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> freqs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    freqs<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> freqs<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">></span></span> <span class="token function">gooduse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">LongAdder</span><span class="token punctuation">></span></span> freqs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>ITEM_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span>THREAD_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> LOOP_COUNT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token string">"item"</span> <span class="token operator">+</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>ITEM_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            freqs<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> k <span class="token operator">-></span> <span class="token keyword">new</span> <span class="token class-name">LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    forkJoinPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> freqs<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>
            e <span class="token operator">-></span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            e <span class="token operator">-></span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-694"><a class="markdownIt-Anchor" href="#-694">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_4-list">#</a>4. List</h2>
<h3 id="-695"><a class="markdownIt-Anchor" href="#-695">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_4-1-copyonwritearraylist">#</a>4.1. CopyOnWriteArrayList</h3>
<p><code>CopyOnWriteArrayList</code>  æ˜¯çº¿ç¨‹å®‰å…¨çš„  <code>ArrayList</code> ã€‚ <code>CopyOnWrite</code>  å­—é¢æ„æ€ä¸º<strong>å†™çš„æ—¶å€™ä¼šå°†å…±äº«å˜é‡æ–°å¤åˆ¶ä¸€ä»½</strong>å‡ºæ¥ã€‚å¤åˆ¶çš„å¥½å¤„åœ¨äº<strong>è¯»æ“ä½œæ˜¯æ— é”çš„</strong>ï¼ˆä¹Ÿå°±æ˜¯æ— é˜»å¡ï¼‰ã€‚</p>
<p>CopyOnWriteArrayList <strong>ä»…é€‚ç”¨äºå†™æ“ä½œéå¸¸å°‘çš„åœºæ™¯</strong>ï¼Œè€Œä¸”èƒ½å¤Ÿå®¹å¿è¯»å†™çš„çŸ­æš‚ä¸ä¸€è‡´ã€‚å¦‚æœè¯»å†™æ¯”ä¾‹å‡è¡¡æˆ–è€…æœ‰å¤§é‡å†™æ“ä½œçš„è¯ï¼Œä½¿ç”¨ CopyOnWriteArrayList çš„æ€§èƒ½ä¼šéå¸¸ç³Ÿç³•ã€‚</p>
<h4 id="-696"><a class="markdownIt-Anchor" href="#-696">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#copyonwritearraylist-%E5%8E%9F%E7%90%86">#</a>CopyOnWriteArrayList åŸç†</h4>
<p>CopyOnWriteArrayList å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜å˜é‡ array å°±æŒ‡å‘è¿™ä¸ªå†…éƒ¨æ•°ç»„ï¼Œæ‰€æœ‰çš„è¯»æ“ä½œéƒ½æ˜¯åŸºäº array è¿›è¡Œçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿­ä»£å™¨ Iterator éå†çš„å°±æ˜¯ array æ•°ç»„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200702204541.png" alt="img"></p>
<ul>
<li>lock - æ‰§è¡Œå†™æ—¶å¤åˆ¶æ“ä½œï¼Œéœ€è¦ä½¿ç”¨å¯é‡å…¥é”åŠ é”</li>
<li>array - å¯¹è±¡æ•°ç»„ï¼Œç”¨äºå­˜æ”¾å…ƒç´ </li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** The lock protecting all mutators */</span>
<span class="token keyword">final</span> <span class="token keyword">transient</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** The array, accessed only via getArray/setArray. */</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/CopyOnWriteArrayList.png" alt="img"></p>
<p>ï¼ˆ1ï¼‰è¯»æ“ä½œ</p>
<p>åœ¨  <code>CopyOnWriteAarrayList</code>  ä¸­ï¼Œè¯»æ“ä½œä¸åŒæ­¥ï¼Œå› ä¸ºå®ƒä»¬åœ¨å†…éƒ¨æ•°ç»„çš„å¿«ç…§ä¸Šå·¥ä½œï¼Œæ‰€ä»¥å¤šä¸ªè¿­ä»£å™¨å¯ä»¥åŒæ—¶éå†è€Œä¸ä¼šç›¸äº’é˜»å¡ï¼ˆå›¾ 1,2,4ï¼‰ã€‚</p>
<p>CopyOnWriteArrayList çš„è¯»æ“ä½œæ˜¯ä¸ç”¨åŠ é”çš„ï¼Œæ€§èƒ½å¾ˆé«˜ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">private</span> <span class="token class-name">E</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ï¼ˆ2ï¼‰å†™æ“ä½œ</p>
<p>æ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯åŒæ­¥çš„ã€‚ä»–ä»¬åœ¨å¤‡ä»½æ•°ç»„ï¼ˆå›¾ 3ï¼‰çš„å‰¯æœ¬ä¸Šå·¥ä½œã€‚å†™æ“ä½œå®Œæˆåï¼Œåå¤‡é˜µåˆ—å°†è¢«æ›¿æ¢ä¸ºå¤åˆ¶çš„é˜µåˆ—ï¼Œå¹¶é‡Šæ”¾é”å®šã€‚æ”¯æŒæ•°ç»„å˜å¾—æ˜“å˜ï¼Œæ‰€ä»¥æ›¿æ¢æ•°ç»„çš„è°ƒç”¨æ˜¯åŸå­ï¼ˆå›¾ 5ï¼‰ã€‚</p>
<p>å†™æ“ä½œååˆ›å»ºçš„è¿­ä»£å™¨å°†èƒ½å¤Ÿçœ‹åˆ°ä¿®æ”¹çš„ç»“æ„ï¼ˆå›¾ 6,7ï¼‰ã€‚</p>
<p>å†™æ—¶å¤åˆ¶é›†åˆè¿”å›çš„è¿­ä»£å™¨ä¸ä¼šæŠ›å‡º  <code>ConcurrentModificationException</code> ï¼Œå› ä¸ºå®ƒä»¬åœ¨æ•°ç»„çš„å¿«ç…§ä¸Šå·¥ä½œï¼Œå¹¶ä¸”æ— è®ºåç»­çš„ä¿®æ”¹ï¼ˆ2,4ï¼‰å¦‚ä½•ï¼Œéƒ½ä¼šåƒè¿­ä»£å™¨åˆ›å»ºæ—¶é‚£æ ·å®Œå…¨è¿”å›å…ƒç´ ã€‚</p>
<p><strong>æ·»åŠ æ“ä½œ</strong> - æ·»åŠ çš„é€»è¾‘å¾ˆç®€å•ï¼Œå…ˆå°†åŸå®¹å™¨ copy ä¸€ä»½ï¼Œç„¶ååœ¨æ–°å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œä¹‹åå†åˆ‡æ¢å¼•ç”¨ã€‚å½“ç„¶æ­¤è¿‡ç¨‹æ˜¯è¦åŠ é”çš„ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//ReentrantLockåŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</span>
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token comment">//æ‹·è´åŸå®¹å™¨ï¼Œé•¿åº¦ä¸ºåŸå®¹å™¨é•¿åº¦åŠ ä¸€</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åœ¨æ–°å‰¯æœ¬ä¸Šæ‰§è¡Œæ·»åŠ æ“ä½œ</span>
        newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        <span class="token comment">//å°†åŸå®¹å™¨å¼•ç”¨æŒ‡å‘æ–°å‰¯æœ¬</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//è§£é”</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>åˆ é™¤æ“ä½œ</strong> - åˆ é™¤æ“ä½œåŒç†ï¼Œå°†é™¤è¦åˆ é™¤å…ƒç´ ä¹‹å¤–çš„å…¶ä»–å…ƒç´ æ‹·è´åˆ°æ–°å‰¯æœ¬ä¸­ï¼Œç„¶ååˆ‡æ¢å¼•ç”¨ï¼Œå°†åŸå®¹å™¨å¼•ç”¨æŒ‡å‘æ–°å‰¯æœ¬ã€‚åŒå±å†™æ“ä½œï¼Œéœ€è¦åŠ é”ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">E</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//åŠ é”</span>
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token class-name">E</span> oldValue <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> numMoved <span class="token operator">=</span> len <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numMoved <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment">//å¦‚æœè¦åˆ é™¤çš„æ˜¯åˆ—è¡¨æœ«ç«¯æ•°æ®ï¼Œæ‹·è´å‰len-1ä¸ªæ•°æ®åˆ°æ–°å‰¯æœ¬ä¸Šï¼Œå†åˆ‡æ¢å¼•ç”¨</span>
            <span class="token function">setArray</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">//å¦åˆ™ï¼Œå°†é™¤è¦åˆ é™¤å…ƒç´ ä¹‹å¤–çš„å…¶ä»–å…ƒç´ æ‹·è´åˆ°æ–°å‰¯æœ¬ä¸­ï¼Œå¹¶åˆ‡æ¢å¼•ç”¨</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> newElements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> newElements<span class="token punctuation">,</span> index<span class="token punctuation">,</span>
                              numMoved<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//è§£é”</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-697"><a class="markdownIt-Anchor" href="#-697">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#copyonwritearraylist-%E7%A4%BA%E4%BE%8B">#</a>CopyOnWriteArrayList ç¤ºä¾‹</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CopyOnWriteArrayListDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ReadTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list<span class="token punctuation">;</span>

        <span class="token class-name">ReadTask</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> str <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WriteTask</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list<span class="token punctuation">;</span>
        <span class="token keyword">int</span> index<span class="token punctuation">;</span>

        <span class="token class-name">WriteTask</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">=</span> index<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token string">"write_"</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> NUM <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token comment">// ArrayList åœ¨å¹¶å‘è¿­ä»£è®¿é—®æ—¶ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸</span>
        <span class="token comment">// List&lt;String> list = new ArrayList&lt;>();</span>
        <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"main_"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>NUM<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NUM<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReadTask</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WriteTask</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayListDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-698"><a class="markdownIt-Anchor" href="#-698">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#copyonwritearraylist-%E5%AE%9E%E6%88%98">#</a>CopyOnWriteArrayList å®æˆ˜</h4>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WrongCopyOnWriteList</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">testRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">testWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span> <span class="token function">testWrite</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> copyOnWriteArrayList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> synchronizedList <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> loopCount <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">"Write:copyOnWriteArrayList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> loopCount<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>__ <span class="token operator">-></span> copyOnWriteArrayList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>loopCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">"Write:synchronizedList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> loopCount<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>__ <span class="token operator">-></span> synchronizedList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>loopCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>stopWatch<span class="token punctuation">.</span><span class="token function">prettyPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"copyOnWriteArrayList"</span><span class="token punctuation">,</span> copyOnWriteArrayList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"synchronizedList"</span><span class="token punctuation">,</span> synchronizedList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> list<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        list<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">boxed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span> <span class="token function">testRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> copyOnWriteArrayList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> synchronizedList <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addAll</span><span class="token punctuation">(</span>copyOnWriteArrayList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addAll</span><span class="token punctuation">(</span>synchronizedList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StopWatch</span> stopWatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StopWatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> loopCount <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> copyOnWriteArrayList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">"Read:copyOnWriteArrayList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> loopCount<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>__ <span class="token operator">-></span> copyOnWriteArrayList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">"Read:synchronizedList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> loopCount<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>__ <span class="token operator">-></span> synchronizedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stopWatch<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>stopWatch<span class="token punctuation">.</span><span class="token function">prettyPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"copyOnWriteArrayList"</span><span class="token punctuation">,</span> copyOnWriteArrayList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"synchronizedList"</span><span class="token punctuation">,</span> synchronizedList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯»æ€§èƒ½å·®ä¸å¤šæ˜¯å†™æ€§èƒ½çš„ä¸€ç™¾å€ã€‚</p>
<h2 id="-699"><a class="markdownIt-Anchor" href="#-699">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_5-set">#</a>5. Set</h2>
<p>Set æ¥å£çš„ä¸¤ä¸ªå®ç°æ˜¯ CopyOnWriteArraySet å’Œ ConcurrentSkipListSetï¼Œä½¿ç”¨åœºæ™¯å¯ä»¥å‚è€ƒå‰é¢è®²è¿°çš„ CopyOnWriteArrayList å’Œ ConcurrentSkipListMapï¼Œå®ƒä»¬çš„åŸç†éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="-700"><a class="markdownIt-Anchor" href="#-700">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-queue">#</a>6. Queue</h2>
<p>Java å¹¶å‘åŒ…é‡Œé¢ Queue è¿™ç±»å¹¶å‘å®¹å™¨æ˜¯æœ€å¤æ‚çš„ï¼Œä½ å¯ä»¥ä»ä»¥ä¸‹ä¸¤ä¸ªç»´åº¦æ¥åˆ†ç±»ã€‚ä¸€ä¸ªç»´åº¦æ˜¯<strong>é˜»å¡ä¸éé˜»å¡</strong>ï¼Œæ‰€è°“é˜»å¡æŒ‡çš„æ˜¯ï¼š<strong>å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œå…¥é˜Ÿæ“ä½œé˜»å¡ï¼›å½“é˜Ÿåˆ—å·²ç©ºæ—¶ï¼Œå‡ºé˜Ÿæ“ä½œé˜»å¡</strong>ã€‚å¦ä¸€ä¸ªç»´åº¦æ˜¯<strong>å•ç«¯ä¸åŒç«¯</strong>ï¼Œå•ç«¯æŒ‡çš„æ˜¯åªèƒ½é˜Ÿå°¾å…¥é˜Ÿï¼Œé˜Ÿé¦–å‡ºé˜Ÿï¼›è€ŒåŒç«¯æŒ‡çš„æ˜¯é˜Ÿé¦–é˜Ÿå°¾çš†å¯å…¥é˜Ÿå‡ºé˜Ÿã€‚Java å¹¶å‘åŒ…é‡Œ<strong>é˜»å¡é˜Ÿåˆ—éƒ½ç”¨ Blocking å…³é”®å­—æ ‡è¯†ï¼Œå•ç«¯é˜Ÿåˆ—ä½¿ç”¨ Queue æ ‡è¯†ï¼ŒåŒç«¯é˜Ÿåˆ—ä½¿ç”¨ Deque æ ‡è¯†</strong>ã€‚</p>
<h3 id="-701"><a class="markdownIt-Anchor" href="#-701">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-1-blockingqueue">#</a>6.1. BlockingQueue</h3>
<p><code>BlockingQueue</code>  é¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ä¸ª<strong>é˜»å¡é˜Ÿåˆ—</strong>ã€‚<strong> <code>BlockingQueue</code>  åŸºæœ¬éƒ½æ˜¯åŸºäºé”å®ç°</strong>ã€‚åœ¨  <code>BlockingQueue</code>  ä¸­ï¼Œ<strong>å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œå…¥é˜Ÿæ“ä½œé˜»å¡ï¼›å½“é˜Ÿåˆ—å·²ç©ºæ—¶ï¼Œå‡ºé˜Ÿæ“ä½œé˜»å¡</strong>ã€‚</p>
<p><code>BlockingQueue</code>  æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ ¸å¿ƒ APIï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è·å–å¹¶ç§»é™¤é˜Ÿåˆ—å¤´ç»“ç‚¹ï¼Œå¦‚æœå¿…è¦ï¼Œå…¶ä¼šç­‰å¾…ç›´åˆ°é˜Ÿåˆ—å‡ºç°å…ƒç´ </span>
<span class="token class-name">E</span> <span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token comment">// æ’å…¥å…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™ç­‰å¾…ç›´åˆ°é˜Ÿåˆ—å‡ºç°ç©ºé—²ç©ºé—´</span>
<span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>BlockingQueue</code>  å¯¹æ’å…¥æ“ä½œã€ç§»é™¤æ“ä½œã€è·å–å…ƒç´ æ“ä½œæä¾›äº†å››ç§ä¸åŒçš„æ–¹æ³•ç”¨äºä¸åŒçš„åœºæ™¯ä¸­ä½¿ç”¨ï¼š</p>
<ul>
<li>æŠ›å‡ºå¼‚å¸¸ï¼›</li>
<li>è¿”å›ç‰¹æ®Šå€¼ï¼ˆ <code>null</code>  æˆ–  <code>true</code> / <code>false</code> ï¼Œå–å†³äºå…·ä½“çš„æ“ä½œï¼‰ï¼›</li>
<li>é˜»å¡ç­‰å¾…æ­¤æ“ä½œï¼Œç›´åˆ°è¿™ä¸ªæ“ä½œæˆåŠŸï¼›</li>
<li>é˜»å¡ç­‰å¾…æ­¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸæˆ–è€…è¶…æ—¶æŒ‡å®šæ—¶é—´ã€‚</li>
</ul>
<p>æ€»ç»“å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th><strong>Throws exception</strong></th>
<th><strong>Special value</strong></th>
<th><strong>Blocks</strong></th>
<th><strong>Times out</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Insert</td>
<td>add(e)</td>
<td>offer(e)</td>
<td>put(e)</td>
<td>offer(e, time, unit)</td>
</tr>
<tr>
<td>Remove</td>
<td>remove()</td>
<td>poll()</td>
<td>take()</td>
<td>poll(time, unit)</td>
</tr>
<tr>
<td>Examine</td>
<td>element()</td>
<td>peek()</td>
<td><strong>not applicable</strong></td>
<td><strong>not applicable</strong></td>
</tr>
</tbody>
</table>
<p><code>BlockingQueue</code>  çš„å„ä¸ªå®ç°ç±»éƒ½éµå¾ªäº†è¿™äº›è§„åˆ™ã€‚</p>
<p><code>BlockingQueue</code>  ä¸æ¥å—  <code>null</code>  å€¼å…ƒç´ ã€‚</p>
<p>JDK æä¾›äº†ä»¥ä¸‹é˜»å¡é˜Ÿåˆ—ï¼š</p>
<ul>
<li><code>ArrayBlockingQueue</code>  - ä¸€ä¸ªç”±<strong>æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</li>
<li><code>LinkedBlockingQueue</code>  - ä¸€ä¸ªç”±<strong>é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</li>
<li><code>PriorityBlockingQueue</code>  - ä¸€ä¸ª<strong>æ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</li>
<li><code>SynchronousQueue</code>  - ä¸€ä¸ª<strong>ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—</strong>ã€‚</li>
<li><code>DelayQueue</code>  - ä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><code>LinkedTransferQueue</code>  - ä¸€ä¸ª<strong>ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</li>
</ul>
<p><code>BlockingQueue</code>  åŸºæœ¬éƒ½æ˜¯åŸºäºé”å®ç°ã€‚</p>
<h3 id="-702"><a class="markdownIt-Anchor" href="#-702">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-2-priorityblockingqueue-%E7%B1%BB">#</a>6.2. PriorityBlockingQueue ç±»</h3>
<p><code>PriorityBlockingQueue</code>  ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="-703"><a class="markdownIt-Anchor" href="#-703">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#priorityblockingqueue-%E8%A6%81%E7%82%B9">#</a>PriorityBlockingQueue è¦ç‚¹</h4>
<ul>
<li><code>PriorityBlockingQueue</code>  å¯ä»¥è§†ä¸º  <code>PriorityQueue</code>  çš„çº¿ç¨‹å®‰å…¨ç‰ˆæœ¬ã€‚</li>
<li><code>PriorityBlockingQueue</code>  å®ç°äº†  <code>BlockingQueue</code> ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><code>PriorityBlockingQueue</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>PriorityBlockingQueue</code>  ä¸æ¥å—  <code>null</code>  å€¼å…ƒç´ ã€‚</li>
<li><code>PriorityBlockingQueue</code>  çš„æ’å…¥æ“ä½œ  <code>put</code>  æ–¹æ³•ä¸ä¼š blockï¼Œå› ä¸ºå®ƒæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼ˆtake æ–¹æ³•åœ¨é˜Ÿåˆ—ä¸ºç©ºçš„æ—¶å€™ä¼šé˜»å¡ï¼‰ã€‚</li>
</ul>
<h4 id="-704"><a class="markdownIt-Anchor" href="#-704">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#priorityblockingqueue-%E5%8E%9F%E7%90%86">#</a>PriorityBlockingQueue åŸç†</h4>
<p><code>PriorityBlockingQueue</code>  æœ‰ä¸¤ä¸ªé‡è¦æˆå‘˜ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> queue<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><code>queue</code>  æ˜¯ä¸€ä¸ª  <code>Object</code>  æ•°ç»„ï¼Œç”¨äºä¿å­˜  <code>PriorityBlockingQueue</code>  çš„å…ƒç´ ã€‚</li>
<li>è€Œå¯é‡å…¥é”  <code>lock</code>  åˆ™ç”¨äºåœ¨æ‰§è¡Œæ’å…¥ã€åˆ é™¤æ“ä½œæ—¶ï¼Œä¿è¯è¿™ä¸ªæ–¹æ³•åœ¨å½“å‰çº¿ç¨‹é‡Šæ”¾é”ä¹‹å‰ï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è®¿é—®ã€‚</li>
</ul>
<p><code>PriorityBlockingQueue</code>  çš„å®¹é‡è™½ç„¶æœ‰åˆå§‹åŒ–å¤§å°ï¼Œä½†æ˜¯ä¸é™åˆ¶å¤§å°ï¼Œå¦‚æœå½“å‰å®¹é‡å·²æ»¡ï¼Œæ’å…¥æ–°å…ƒç´ æ—¶ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚</p>
<h3 id="-705"><a class="markdownIt-Anchor" href="#-705">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-3-arrayblockingqueue-%E7%B1%BB">#</a>6.3. ArrayBlockingQueue ç±»</h3>
<p><code>ArrayBlockingQueue</code>  æ˜¯ç”±æ•°ç»„ç»“æ„ç»„æˆçš„<strong>æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</strong>ã€‚</p>
<h4 id="-706"><a class="markdownIt-Anchor" href="#-706">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#arrayblockingqueue-%E8%A6%81%E7%82%B9">#</a>ArrayBlockingQueue è¦ç‚¹</h4>
<p><code>ArrayBlockingQueue</code>  ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// æ•°ç»„çš„å¤§å°å°±å†³å®šäº†é˜Ÿåˆ—çš„è¾¹ç•Œï¼Œæ‰€ä»¥åˆå§‹åŒ–æ—¶å¿…é¡»æŒ‡å®šå®¹é‡</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//... &#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//... &#125;</span>
    <span class="token keyword">public</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fair<span class="token punctuation">,</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//... &#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>ArrayBlockingQueue</code>  å®ç°äº†  <code>BlockingQueue</code> ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><code>ArrayBlockingQueue</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>ArrayBlockingQueue</code>  æ˜¯åŸºäºæ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æ‰€ä»¥åˆå§‹åŒ–æ—¶å¿…é¡»æŒ‡å®šå®¹é‡ã€‚</li>
</ul>
<h4 id="-707"><a class="markdownIt-Anchor" href="#-707">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#arrayblockingqueue-%E5%8E%9F%E7%90%86">#</a>ArrayBlockingQueue åŸç†</h4>
<p><code>ArrayBlockingQueue</code>  çš„é‡è¦æˆå‘˜å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç”¨äºå­˜æ”¾å…ƒç´ çš„æ•°ç»„</span>
<span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items<span class="token punctuation">;</span>
<span class="token comment">// ä¸‹ä¸€æ¬¡è¯»å–æ“ä½œçš„ä½ç½®</span>
<span class="token keyword">int</span> takeIndex<span class="token punctuation">;</span>
<span class="token comment">// ä¸‹ä¸€æ¬¡å†™å…¥æ“ä½œçš„ä½ç½®</span>
<span class="token keyword">int</span> putIndex<span class="token punctuation">;</span>
<span class="token comment">// é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ•°é‡</span>
<span class="token keyword">int</span> count<span class="token punctuation">;</span>

<span class="token comment">// ä»¥ä¸‹å‡ ä¸ªå°±æ˜¯æ§åˆ¶å¹¶å‘ç”¨çš„åŒæ­¥å™¨</span>
<span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notEmpty<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notFull<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>ArrayBlockingQueue</code>  å†…éƒ¨ä»¥  <code>final</code>  çš„æ•°ç»„ä¿å­˜æ•°æ®ï¼Œæ•°ç»„çš„å¤§å°å°±å†³å®šäº†é˜Ÿåˆ—çš„è¾¹ç•Œã€‚</p>
<p><code>ArrayBlockingQueue</code>  å®ç°å¹¶å‘åŒæ­¥çš„åŸç†å°±æ˜¯ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œéƒ½éœ€è¦è·å–åˆ° AQS ç‹¬å é”æ‰èƒ½è¿›è¡Œæ“ä½œã€‚</p>
<ul>
<li>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿™ä¸ªæ—¶å€™è¯»æ“ä½œçš„çº¿ç¨‹è¿›å…¥åˆ°è¯»çº¿ç¨‹é˜Ÿåˆ—æ’é˜Ÿï¼Œç­‰å¾…å†™çº¿ç¨‹å†™å…¥æ–°çš„å…ƒç´ ï¼Œç„¶åå”¤é†’è¯»çº¿ç¨‹é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚</li>
<li>å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œè¿™ä¸ªæ—¶å€™å†™æ“ä½œçš„çº¿ç¨‹è¿›å…¥åˆ°å†™çº¿ç¨‹é˜Ÿåˆ—æ’é˜Ÿï¼Œç­‰å¾…è¯»çº¿ç¨‹å°†é˜Ÿåˆ—å…ƒç´ ç§»é™¤ï¼Œç„¶åå”¤é†’å†™çº¿ç¨‹é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ã€‚</li>
</ul>
<p>å¯¹äº  <code>ArrayBlockingQueue</code> ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ„é€ çš„æ—¶å€™æŒ‡å®šä»¥ä¸‹ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>é˜Ÿåˆ—å®¹é‡ï¼Œå…¶é™åˆ¶äº†é˜Ÿåˆ—ä¸­æœ€å¤šå…è®¸çš„å…ƒç´ ä¸ªæ•°ï¼›</li>
<li>æŒ‡å®šç‹¬å é”æ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ã€‚éå…¬å¹³é”çš„ååé‡æ¯”è¾ƒé«˜ï¼Œå…¬å¹³é”å¯ä»¥ä¿è¯æ¯æ¬¡éƒ½æ˜¯ç­‰å¾…æœ€ä¹…çš„çº¿ç¨‹è·å–åˆ°é”ï¼›</li>
<li>å¯ä»¥æŒ‡å®šç”¨ä¸€ä¸ªé›†åˆæ¥åˆå§‹åŒ–ï¼Œå°†æ­¤é›†åˆä¸­çš„å…ƒç´ åœ¨æ„é€ æ–¹æ³•æœŸé—´å°±å…ˆæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚</li>
</ul>
<h3 id="-708"><a class="markdownIt-Anchor" href="#-708">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-4-linkedblockingqueue-%E7%B1%BB">#</a>6.4. LinkedBlockingQueue ç±»</h3>
<p><code>LinkedBlockingQueue</code>  æ˜¯ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚å®¹æ˜“è¢«è¯¯è§£ä¸ºæ— è¾¹ç•Œï¼Œä½†å…¶å®å…¶è¡Œä¸ºå’Œå†…éƒ¨ä»£ç éƒ½æ˜¯åŸºäºæœ‰ç•Œçš„é€»è¾‘å®ç°çš„ï¼Œåªä¸è¿‡å¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶å°±æŒ‡å®šå®¹é‡ï¼Œé‚£ä¹ˆå…¶å®¹é‡é™åˆ¶å°±è‡ªåŠ¨è¢«è®¾ç½®ä¸º  <code>Integer.MAX_VALUE</code> ï¼Œæˆä¸ºäº†æ— ç•Œé˜Ÿåˆ—ã€‚</p>
<h4 id="-709"><a class="markdownIt-Anchor" href="#-709">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#linkedblockingqueue-%E8%A6%81%E7%82%B9">#</a>LinkedBlockingQueue è¦ç‚¹</h4>
<p><code>LinkedBlockingQueue</code>  ç±»å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
        <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><code>LinkedBlockingQueue</code>  å®ç°äº†  <code>BlockingQueue</code> ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><code>LinkedBlockingQueue</code>  å®ç°äº†  <code>Serializable</code> ï¼Œæ”¯æŒåºåˆ—åŒ–ã€‚</li>
<li><code>LinkedBlockingQueue</code>  æ˜¯åŸºäºå•é“¾è¡¨å®ç°çš„é˜»å¡é˜Ÿåˆ—ï¼Œå¯ä»¥å½“åšæ— ç•Œé˜Ÿåˆ—ä¹Ÿå¯ä»¥å½“åšæœ‰ç•Œé˜Ÿåˆ—æ¥ä½¿ç”¨ã€‚</li>
<li><code>LinkedBlockingQueue</code>  ä¸­å…ƒç´ æŒ‰ç…§æ’å…¥é¡ºåºä¿å­˜ï¼ˆFIFOï¼‰ã€‚</li>
</ul>
<h4 id="-710"><a class="markdownIt-Anchor" href="#-710">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#linkedblockingqueue-%E5%8E%9F%E7%90%86">#</a>LinkedBlockingQueue åŸç†</h4>
<p><code>LinkedBlockingQueue</code>  ä¸­çš„é‡è¦æ•°æ®ç»“æ„ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// é˜Ÿåˆ—å®¹é‡</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> capacity<span class="token punctuation">;</span>
<span class="token comment">// é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ•°é‡</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// é˜Ÿå¤´</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> head<span class="token punctuation">;</span>
<span class="token comment">// é˜Ÿå°¾</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> last<span class="token punctuation">;</span>

<span class="token comment">// take, poll, peek ç­‰è¯»æ“ä½œçš„æ–¹æ³•éœ€è¦è·å–åˆ°è¿™ä¸ªé”</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> takeLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¦‚æœè¯»æ“ä½œçš„æ—¶å€™é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆç­‰å¾… notEmpty æ¡ä»¶</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notEmpty <span class="token operator">=</span> takeLock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// put, offer ç­‰å†™æ“ä½œçš„æ–¹æ³•éœ€è¦è·å–åˆ°è¿™ä¸ªé”</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> putLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¦‚æœå†™æ“ä½œçš„æ—¶å€™é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œé‚£ä¹ˆç­‰å¾… notFull æ¡ä»¶</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Condition</span> notFull <span class="token operator">=</span> putLock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿™é‡Œç”¨äº†ä¸¤å¯¹  <code>Lock</code>  å’Œ  <code>Condition</code> ï¼Œç®€å•ä»‹ç»å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>takeLock</code>  å’Œ  <code>notEmpty</code>  æ­é…ï¼šå¦‚æœè¦è·å–ï¼ˆtakeï¼‰ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦è·å–  <code>takeLock</code>  é”ï¼Œä½†æ˜¯è·å–äº†é”è¿˜ä¸å¤Ÿï¼Œå¦‚æœé˜Ÿåˆ—æ­¤æ—¶ä¸ºç©ºï¼Œè¿˜éœ€è¦é˜Ÿåˆ—ä¸ä¸ºç©ºï¼ˆ <code>notEmpty</code> ï¼‰è¿™ä¸ªæ¡ä»¶ï¼ˆ <code>Condition</code> ï¼‰ã€‚</li>
<li><code>putLock</code>  éœ€è¦å’Œ  <code>notFull</code>  æ­é…ï¼šå¦‚æœè¦æ’å…¥ï¼ˆputï¼‰ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦è·å–  <code>putLock</code>  é”ï¼Œä½†æ˜¯è·å–äº†é”è¿˜ä¸å¤Ÿï¼Œå¦‚æœé˜Ÿåˆ—æ­¤æ—¶å·²æ»¡ï¼Œè¿˜éœ€è¦é˜Ÿåˆ—ä¸æ˜¯æ»¡çš„ï¼ˆnotFullï¼‰è¿™ä¸ªæ¡ä»¶ï¼ˆ <code>Condition</code> ï¼‰ã€‚</li>
</ul>
<h3 id="-711"><a class="markdownIt-Anchor" href="#-711">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-5-synchronousqueue-%E7%B1%BB">#</a>6.5. SynchronousQueue ç±»</h3>
<p>SynchronousQueue æ˜¯<strong>ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—</strong>ã€‚æ¯ä¸ªåˆ é™¤æ“ä½œéƒ½è¦ç­‰å¾…æ’å…¥æ“ä½œï¼Œåä¹‹æ¯ä¸ªæ’å…¥æ“ä½œä¹Ÿéƒ½è¦ç­‰å¾…åˆ é™¤åŠ¨ä½œã€‚é‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—çš„å®¹é‡æ˜¯å¤šå°‘å‘¢ï¼Ÿæ˜¯ 1 å—ï¼Ÿå…¶å®ä¸æ˜¯çš„ï¼Œå…¶å†…éƒ¨å®¹é‡æ˜¯ 0ã€‚</p>
<p><code>SynchronousQueue</code>  å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>SynchronousQueue</code>  è¿™ä¸ªç±»ï¼Œåœ¨çº¿ç¨‹æ± çš„å®ç°ç±»  <code>ScheduledThreadPoolExecutor</code>  ä¸­å¾—åˆ°äº†åº”ç”¨ã€‚</p>
<p><code>SynchronousQueue</code>  çš„é˜Ÿåˆ—å…¶å®æ˜¯è™šçš„ï¼Œå³é˜Ÿåˆ—å®¹é‡ä¸º 0ã€‚æ•°æ®å¿…é¡»ä»æŸä¸ªå†™çº¿ç¨‹äº¤ç»™æŸä¸ªè¯»çº¿ç¨‹ï¼Œè€Œä¸æ˜¯å†™åˆ°æŸä¸ªé˜Ÿåˆ—ä¸­ç­‰å¾…è¢«æ¶ˆè´¹ã€‚</p>
<p><code>SynchronousQueue</code>  ä¸­ä¸èƒ½ä½¿ç”¨ peek æ–¹æ³•ï¼ˆåœ¨è¿™é‡Œè¿™ä¸ªæ–¹æ³•ç›´æ¥è¿”å› nullï¼‰ï¼Œpeek æ–¹æ³•çš„è¯­ä¹‰æ˜¯åªè¯»å–ä¸ç§»é™¤ï¼Œæ˜¾ç„¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¯­ä¹‰æ˜¯ä¸ç¬¦åˆ SynchronousQueue çš„ç‰¹å¾çš„ã€‚</p>
<p><code>SynchronousQueue</code>  ä¹Ÿä¸èƒ½è¢«è¿­ä»£ï¼Œå› ä¸ºæ ¹æœ¬å°±æ²¡æœ‰å…ƒç´ å¯ä»¥æ‹¿æ¥è¿­ä»£çš„ã€‚</p>
<p>è™½ç„¶  <code>SynchronousQueue</code>  é—´æ¥åœ°å®ç°äº† Collection æ¥å£ï¼Œä½†æ˜¯å¦‚æœä½ å°†å…¶å½“åš Collection æ¥ç”¨çš„è¯ï¼Œé‚£ä¹ˆé›†åˆæ˜¯ç©ºçš„ã€‚</p>
<p>å½“ç„¶ï¼Œ <code>SynchronousQueue</code>  ä¹Ÿä¸å…è®¸ä¼ é€’ null å€¼çš„ï¼ˆå¹¶å‘åŒ…ä¸­çš„å®¹å™¨ç±»å¥½åƒéƒ½ä¸æ”¯æŒæ’å…¥ null å€¼ï¼Œå› ä¸º null å€¼å¾€å¾€ç”¨ä½œå…¶ä»–ç”¨é€”ï¼Œæ¯”å¦‚ç”¨äºæ–¹æ³•çš„è¿”å›å€¼ä»£è¡¨æ“ä½œå¤±è´¥ï¼‰ã€‚</p>
<h3 id="-712"><a class="markdownIt-Anchor" href="#-712">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-6-concurrentlinkeddeque-%E7%B1%BB">#</a>6.6. ConcurrentLinkedDeque ç±»</h3>
<p><code>Deque</code>  çš„ä¾§é‡ç‚¹æ˜¯æ”¯æŒå¯¹é˜Ÿåˆ—å¤´å°¾éƒ½è¿›è¡Œæ’å…¥å’Œåˆ é™¤ï¼Œæ‰€ä»¥æä¾›äº†ç‰¹å®šçš„æ–¹æ³•ï¼Œå¦‚:</p>
<ul>
<li>å°¾éƒ¨æ’å…¥æ—¶éœ€è¦çš„  <code>addLast(e)</code> ã€ <code>offerLast(e)</code> ã€‚</li>
<li>å°¾éƒ¨åˆ é™¤æ‰€éœ€è¦çš„  <code>removeLast()</code> ã€ <code>pollLast()</code> ã€‚</li>
</ul>
<h3 id="-713"><a class="markdownIt-Anchor" href="#-713">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.html#_6-7-queue-%E7%9A%84%E5%B9%B6%E5%8F%91%E5%BA%94%E7%94%A8">#</a>6.7. Queue çš„å¹¶å‘åº”ç”¨</h3>
<p>Queue è¢«å¹¿æ³›ä½¿ç”¨åœ¨ç”Ÿäº§è€… - æ¶ˆè´¹è€…åœºæ™¯ã€‚è€Œåœ¨å¹¶å‘åœºæ™¯ï¼Œåˆ©ç”¨  <code>BlockingQueue</code>  çš„é˜»å¡æœºåˆ¶ï¼Œå¯ä»¥å‡å°‘å¾ˆå¤šå¹¶å‘åè°ƒå·¥ä½œã€‚</p>
<p>è¿™ä¹ˆå¤šå¹¶å‘ Queue çš„å®ç°ï¼Œå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p>
<ul>
<li>è€ƒè™‘åº”ç”¨åœºæ™¯ä¸­å¯¹é˜Ÿåˆ—è¾¹ç•Œçš„è¦æ±‚ã€‚ <code>ArrayBlockingQueue</code>  æ˜¯æœ‰æ˜ç¡®çš„å®¹é‡é™åˆ¶çš„ï¼Œè€Œ  <code>LinkedBlockingQueue</code>  åˆ™å–å†³äºæˆ‘ä»¬æ˜¯å¦åœ¨åˆ›å»ºæ—¶æŒ‡å®šï¼Œ <code>SynchronousQueue</code>  åˆ™å¹²è„†ä¸èƒ½ç¼“å­˜ä»»ä½•å…ƒç´ ã€‚</li>
<li>ä»ç©ºé—´åˆ©ç”¨è§’åº¦ï¼Œæ•°ç»„ç»“æ„çš„  <code>ArrayBlockingQueue</code>  è¦æ¯”  <code>LinkedBlockingQueue</code>  ç´§å‡‘ï¼Œå› ä¸ºå…¶ä¸éœ€è¦åˆ›å»ºæ‰€è°“èŠ‚ç‚¹ï¼Œä½†æ˜¯å…¶åˆå§‹åˆ†é…é˜¶æ®µå°±éœ€è¦ä¸€æ®µè¿ç»­çš„ç©ºé—´ï¼Œæ‰€ä»¥åˆå§‹å†…å­˜éœ€æ±‚æ›´å¤§ã€‚</li>
<li>é€šç”¨åœºæ™¯ä¸­ï¼Œ <code>LinkedBlockingQueue</code>  çš„ååé‡ä¸€èˆ¬ä¼˜äº  <code>ArrayBlockingQueue</code> ï¼Œå› ä¸ºå®ƒå®ç°äº†æ›´åŠ ç»†ç²’åº¦çš„é”æ“ä½œã€‚</li>
<li><code>ArrayBlockingQueue</code>  å®ç°æ¯”è¾ƒç®€å•ï¼Œæ€§èƒ½æ›´å¥½é¢„æµ‹ï¼Œå±äºè¡¨ç°ç¨³å®šçš„ â€œé€‰æ‰‹â€ã€‚</li>
<li>å¯èƒ½ä»¤äººæ„å¤–çš„æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™  <code>SynchronousQueue</code>  çš„æ€§èƒ½è¡¨ç°ï¼Œå¾€å¾€å¤§å¤§è¶…è¿‡å…¶ä»–å®ç°ï¼Œå°¤å…¶æ˜¯åœ¨é˜Ÿåˆ—å…ƒç´ è¾ƒå°çš„åœºæ™¯ã€‚</li>
</ul>
<hr>
<h1 id="java-çº¿ç¨‹æ± "><a class="markdownIt-Anchor" href="#java-çº¿ç¨‹æ± ">#</a> Java çº¿ç¨‹æ± </h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#11-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%B1%A0">1.1. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#12-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0">1.2. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </a></li>
</ul>
</li>
<li>\2. Executor æ¡†æ¶
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#21-%E6%A0%B8%E5%BF%83-api-%E6%A6%82%E8%BF%B0">2.1. æ ¸å¿ƒ API æ¦‚è¿°</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#22-executor">2.2. Executor</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#23-executorservice">2.3. ExecutorService</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#24-scheduledexecutorservice">2.4. ScheduledExecutorService</a></li>
</ul>
</li>
<li>\3. ThreadPoolExecutor
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#31-%E9%87%8D%E8%A6%81%E5%AD%97%E6%AE%B5">3.1. é‡è¦å­—æ®µ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#32-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95">3.2. æ„é€ æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#33-execute-%E6%96%B9%E6%B3%95">3.3. execute æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#34-%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E6%96%B9%E6%B3%95">3.4. å…¶ä»–é‡è¦æ–¹æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#35-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">3.5. ä½¿ç”¨ç¤ºä¾‹</a></li>
</ul>
</li>
<li>\4. Executors
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#41-newsinglethreadexecutor">4.1. newSingleThreadExecutor</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#42-newfixedthreadpool">4.2. newFixedThreadPool</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#43-newcachedthreadpool">4.3. newCachedThreadPool</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#44-newschedulethreadpool">4.4. newScheduleThreadPool</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#45-newworkstealingpool">4.5. newWorkStealingPool</a></li>
</ul>
</li>
<li>\5. çº¿ç¨‹æ± æœ€ä½³å®è·µ
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#51-%E8%AE%A1%E7%AE%97%E7%BA%BF%E7%A8%8B%E6%95%B0%E9%87%8F">5.1. è®¡ç®—çº¿ç¨‹æ•°é‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#52-%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E6%9C%89%E7%95%8C%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97">5.2. å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#53-%E9%87%8D%E8%A6%81%E4%BB%BB%E5%8A%A1%E5%BA%94%E8%AF%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5">5.3. é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#6-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">6. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-714"><a class="markdownIt-Anchor" href="#-714">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_1-%E7%AE%80%E4%BB%8B">#</a>1. ç®€ä»‹</h2>
<h3 id="-715"><a class="markdownIt-Anchor" href="#-715">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E6%B1%A0">#</a>1.1. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </h3>
<p>çº¿ç¨‹æ± æ˜¯ä¸€ç§å¤šçº¿ç¨‹å¤„ç†å½¢å¼ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œç„¶ååœ¨åˆ›å»ºçº¿ç¨‹åè‡ªåŠ¨å¯åŠ¨è¿™äº›ä»»åŠ¡ã€‚</p>
<h3 id="-716"><a class="markdownIt-Anchor" href="#-716">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_1-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0">#</a>1.2. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </h3>
<p>å¦‚æœå¹¶å‘è¯·æ±‚æ•°é‡å¾ˆå¤šï¼Œä½†æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´å¾ˆçŸ­ï¼Œå°±ä¼šå‡ºç°é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå¯èƒ½é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„æ—¶é—´ã€èµ„æºå¼€é”€è¦å¤§äºå®é™…å·¥ä½œçš„æ‰€éœ€ã€‚</p>
<p>æ­£æ˜¯ç”±äºè¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æœ‰å¿…è¦å¼•å…¥çº¿ç¨‹æ± ã€‚ä½¿ç”¨ <strong>çº¿ç¨‹æ± çš„å¥½å¤„</strong> æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>é™ä½èµ„æºæ¶ˆè€—</strong> - é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„æ¶ˆè€—ã€‚</li>
<li><strong>æé«˜å“åº”é€Ÿåº¦</strong> - å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰åˆ°çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚</li>
<li><strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong> - çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚ä½†æ˜¯è¦åšåˆ°åˆç†çš„åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå¿…é¡»å¯¹å…¶åŸç†äº†å¦‚æŒ‡æŒã€‚</li>
</ul>
<h2 id="-717"><a class="markdownIt-Anchor" href="#-717">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-executor-%E6%A1%86%E6%9E%B6">#</a>2. Executor æ¡†æ¶</h2>
<blockquote>
<p>Executor æ¡†æ¶æ˜¯ä¸€ä¸ªæ ¹æ®ä¸€ç»„æ‰§è¡Œç­–ç•¥è°ƒç”¨ï¼Œè°ƒåº¦ï¼Œæ‰§è¡Œå’Œæ§åˆ¶çš„å¼‚æ­¥ä»»åŠ¡çš„æ¡†æ¶ï¼Œç›®çš„æ˜¯æä¾›ä¸€ç§å°†â€ ä»»åŠ¡æäº¤â€ ä¸â€ ä»»åŠ¡å¦‚ä½•è¿è¡Œâ€ åˆ†ç¦»å¼€æ¥çš„æœºåˆ¶ã€‚</p>
</blockquote>
<h3 id="-718"><a class="markdownIt-Anchor" href="#-718">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-1-%E6%A0%B8%E5%BF%83-api-%E6%A6%82%E8%BF%B0">#</a>2.1. æ ¸å¿ƒ API æ¦‚è¿°</h3>
<p>Executor æ¡†æ¶æ ¸å¿ƒ API å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><code>Executor</code>  - è¿è¡Œä»»åŠ¡çš„ç®€å•æ¥å£ã€‚</p>
</li>
<li>
<pre><code>  ExecutorService
  <pre class="line-numbers language-none"><code class="language-none">
 

\- æ‰©å±•äº†

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  Executor
  <pre class="line-numbers language-none"><code class="language-none">
	 

	æ¥å£ã€‚æ‰©å±•èƒ½åŠ›ï¼š

	- æ”¯æŒæœ‰è¿”å›å€¼çš„çº¿ç¨‹ï¼›
	- æ”¯æŒç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚

- &#96;ScheduledExecutorService&#96; - æ‰©å±•äº† &#96;ExecutorService&#96; æ¥å£ã€‚æ‰©å±•èƒ½åŠ›ï¼šæ”¯æŒå®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚

- &#96;AbstractExecutorService&#96; - &#96;ExecutorService&#96; æ¥å£çš„é»˜è®¤å®ç°ã€‚

- &#96;ThreadPoolExecutor&#96; - Executor æ¡†æ¶æœ€æ ¸å¿ƒçš„ç±»ï¼Œå®ƒç»§æ‰¿äº† &#96;AbstractExecutorService&#96; ç±»ã€‚

- &#96;ScheduledThreadPoolExecutor&#96; - &#96;ScheduledExecutorService&#96; æ¥å£çš„å®ç°ï¼Œä¸€ä¸ªå¯å®šæ—¶è°ƒåº¦ä»»åŠ¡çš„çº¿ç¨‹æ± ã€‚

- &#96;Executors&#96; - å¯ä»¥é€šè¿‡è°ƒç”¨ &#96;Executors&#96; çš„é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± å¹¶è¿”å›ä¸€ä¸ª &#96;ExecutorService&#96; å¯¹è±¡ã€‚

![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;HarryQu1229&#x2F;image-host&#x2F;main&#x2F;notes-img&#x2F;exexctor-uml.png)

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaçº¿ç¨‹æ± .html#_2-2-executor)2.2. Executor

&#96;Executor&#96; æ¥å£ä¸­åªå®šä¹‰äº†ä¸€ä¸ª &#96;execute&#96; æ–¹æ³•ï¼Œç”¨äºæ¥æ”¶ä¸€ä¸ª &#96;Runnable&#96; å¯¹è±¡ã€‚

&#96;&#96;&#96;java
public interface Executor &#123;
    void execute(Runnable command);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<h3 id="-719"><a class="markdownIt-Anchor" href="#-719">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-3-executorservice">#</a>2.3. ExecutorService</h3>
<p><code>ExecutorService</code>  æ¥å£ç»§æ‰¿äº†  <code>Executor</code>  æ¥å£ï¼Œå®ƒè¿˜æä¾›äº†  <code>invokeAll</code> ã€ <code>invokeAny</code> ã€ <code>shutdown</code> ã€ <code>submit</code>  ç­‰æ–¹æ³•ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ExecutorService</span> <span class="token keyword">extends</span> <span class="token class-name">Executor</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">void</span> <span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> <span class="token function">shutdownNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">isTerminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">,</span> <span class="token class-name">T</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">invokeAll</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> tasks<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Future</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">invokeAll</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> tasks<span class="token punctuation">,</span>
                                  <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">invokeAny</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> tasks<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token class-name">T</span> <span class="token function">invokeAny</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Callable</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span><span class="token punctuation">></span></span> tasks<span class="token punctuation">,</span>
                    <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä»å…¶æ”¯æŒçš„æ–¹æ³•å®šä¹‰ï¼Œä¸éš¾çœ‹å‡ºï¼šç›¸æ¯”äº  <code>Executor</code>  æ¥å£ï¼Œ <code>ExecutorService</code>  æ¥å£ä¸»è¦çš„æ‰©å±•æ˜¯ï¼š</p>
<ul>
<li>æ”¯æŒæœ‰è¿”å›å€¼çš„çº¿ç¨‹ -  <code>sumbit</code> ã€ <code>invokeAll</code> ã€ <code>invokeAny</code>  æ–¹æ³•ä¸­éƒ½æ”¯æŒä¼ å…¥ <code>Callable</code>  å¯¹è±¡ã€‚</li>
<li>æ”¯æŒç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ -  <code>shutdown</code> ã€ <code>shutdownNow</code> ã€ <code>isShutdown</code>  ç­‰æ–¹æ³•ã€‚</li>
</ul>
<h3 id="-720"><a class="markdownIt-Anchor" href="#-720">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_2-4-scheduledexecutorservice">#</a>2.4. ScheduledExecutorService</h3>
<p><code>ScheduledExecutorService</code>  æ¥å£æ‰©å±•äº†  <code>ExecutorService</code>  æ¥å£ã€‚</p>
<p>å®ƒé™¤äº†æ”¯æŒå‰é¢ä¸¤ä¸ªæ¥å£çš„æ‰€æœ‰èƒ½åŠ›ä»¥å¤–ï¼Œè¿˜æ”¯æŒå®šæ—¶è°ƒåº¦çº¿ç¨‹ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ScheduledExecutorService</span> <span class="token keyword">extends</span> <span class="token class-name">ExecutorService</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                       <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">></span></span> callable<span class="token punctuation">,</span>
                                           <span class="token keyword">long</span> delay<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                                  <span class="token keyword">long</span> initialDelay<span class="token punctuation">,</span>
                                                  <span class="token keyword">long</span> period<span class="token punctuation">,</span>
                                                  <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">,</span>
                                                     <span class="token keyword">long</span> initialDelay<span class="token punctuation">,</span>
                                                     <span class="token keyword">long</span> delay<span class="token punctuation">,</span>
                                                     <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶æ‰©å±•çš„æ¥å£æä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š</p>
<ul>
<li><code>schedule</code>  æ–¹æ³•å¯ä»¥åœ¨æŒ‡å®šçš„å»¶æ—¶åæ‰§è¡Œä¸€ä¸ª  <code>Runnable</code>  æˆ–è€…  <code>Callable</code>  ä»»åŠ¡ã€‚</li>
<li><code>scheduleAtFixedRate</code>  æ–¹æ³•å’Œ  <code>scheduleWithFixedDelay</code>  æ–¹æ³•å¯ä»¥æŒ‰ç…§æŒ‡å®šæ—¶é—´é—´éš”ï¼Œå®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚</li>
</ul>
<h2 id="-721"><a class="markdownIt-Anchor" href="#-721">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-threadpoolexecutor">#</a>3. ThreadPoolExecutor</h2>
<p><code>java.uitl.concurrent.ThreadPoolExecutor</code>  ç±»æ˜¯  <code>Executor</code>  æ¡†æ¶ä¸­æœ€æ ¸å¿ƒçš„ç±»ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡å°†ç€é‡è®²è¿°ä¸€ä¸‹è¿™ä¸ªç±»ã€‚</p>
<h3 id="-722"><a class="markdownIt-Anchor" href="#-722">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-1-%E9%87%8D%E8%A6%81%E5%AD%97%E6%AE%B5">#</a>3.1. é‡è¦å­—æ®µ</h3>
<p><code>ThreadPoolExecutor</code>  æœ‰ä»¥ä¸‹é‡è¦å­—æ®µï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">AtomicInteger</span> ctl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token function">ctlOf</span><span class="token punctuation">(</span>RUNNING<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> COUNT_BITS <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>SIZE <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> CAPACITY   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// runState is stored in the high-order bits</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> RUNNING    <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SHUTDOWN   <span class="token operator">=</span>  <span class="token number">0</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STOP       <span class="token operator">=</span>  <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TIDYING    <span class="token operator">=</span>  <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TERMINATED <span class="token operator">=</span>  <span class="token number">3</span> <span class="token operator">&lt;&lt;</span> COUNT_BITS<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>
<pre><code>  ctl
  <pre class="line-numbers language-none"><code class="language-none">
	 

	\-

	 

	ç”¨äºæ§åˆ¶çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­çš„æœ‰æ•ˆçº¿ç¨‹æ•°é‡

	ã€‚å®ƒåŒ…å«ä¸¤éƒ¨åˆ†çš„ä¿¡æ¯ï¼š

	- çº¿ç¨‹æ± çš„è¿è¡ŒçŠ¶æ€ (&#96;runState&#96;)
	- çº¿ç¨‹æ± å†…æœ‰æ•ˆçº¿ç¨‹çš„æ•°é‡ (&#96;workerCount&#96;)
	- å¯ä»¥çœ‹åˆ°ï¼Œ&#96;ctl&#96; ä½¿ç”¨äº† &#96;Integer&#96; ç±»å‹æ¥ä¿å­˜ï¼Œé«˜ 3 ä½ä¿å­˜ &#96;runState&#96;ï¼Œä½ 29 ä½ä¿å­˜ &#96;workerCount&#96;ã€‚&#96;COUNT_BITS&#96; å°±æ˜¯ 29ï¼Œ&#96;CAPACITY&#96; å°±æ˜¯ 1 å·¦ç§» 29 ä½å‡ 1ï¼ˆ29 ä¸ª 1ï¼‰ï¼Œè¿™ä¸ªå¸¸é‡è¡¨ç¤º &#96;workerCount&#96; çš„ä¸Šé™å€¼ï¼Œå¤§çº¦æ˜¯ 5 äº¿ã€‚

- è¿è¡ŒçŠ¶æ€ - çº¿ç¨‹æ± ä¸€å…±æœ‰äº”ç§è¿è¡ŒçŠ¶æ€ï¼š

	- &#96;RUNNING&#96; - **è¿è¡ŒçŠ¶æ€**ã€‚æ¥å—æ–°ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚

	- &#96;&#96;&#96;
		SHUTDOWN<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

  	 

  	\-

  	 

  	å…³é—­çŠ¶æ€

  	ã€‚ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†å¯ä»¥å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚

  	- åœ¨çº¿ç¨‹æ± å¤„äº `RUNNING` çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ `shutdown` æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚
  	- `finalize` æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šè°ƒç”¨ `shutdown` æ–¹æ³•è¿›å…¥è¯¥çŠ¶æ€ã€‚

  - `STOP` - **åœæ­¢çŠ¶æ€**ã€‚ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚ä¼šä¸­æ–­æ­£åœ¨å¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœ¨çº¿ç¨‹æ± å¤„äº `RUNNING` æˆ– `SHUTDOWN` çŠ¶æ€æ—¶ï¼Œè°ƒç”¨ `shutdownNow` æ–¹æ³•ä¼šä½¿çº¿ç¨‹æ± è¿›å…¥åˆ°è¯¥çŠ¶æ€ã€‚

  - `TIDYING` - **æ•´ç†çŠ¶æ€**ã€‚å¦‚æœæ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»ˆæ­¢äº†ï¼Œ`workerCount` (æœ‰æ•ˆçº¿ç¨‹æ•°) ä¸º 0ï¼Œçº¿ç¨‹æ± è¿›å…¥è¯¥çŠ¶æ€åä¼šè°ƒç”¨ `terminated` æ–¹æ³•è¿›å…¥ `TERMINATED` çŠ¶æ€ã€‚

  - ```
  	TERMINATED
  	<pre class="line-numbers language-none"><code class="language-none">
 

\-

 

å·²ç»ˆæ­¢çŠ¶æ€

ã€‚åœ¨

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  	terminated
  	<pre class="line-numbers language-none"><code class="language-none">
 

æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€ã€‚é»˜è®¤

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  	terminated
  	<pre class="line-numbers language-none"><code class="language-none">
 

æ–¹æ³•ä¸­ä»€ä¹ˆä¹Ÿæ²¡æœ‰åšã€‚è¿›å…¥

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  	TERMINATED
  	<pre class="line-numbers language-none"><code class="language-none">
		 

		çš„æ¡ä»¶å¦‚ä¸‹ï¼š

		- çº¿ç¨‹æ± ä¸æ˜¯ &#96;RUNNING&#96; çŠ¶æ€ï¼›
		- çº¿ç¨‹æ± çŠ¶æ€ä¸æ˜¯ &#96;TIDYING&#96; çŠ¶æ€æˆ– &#96;TERMINATED&#96; çŠ¶æ€ï¼›
		- å¦‚æœçº¿ç¨‹æ± çŠ¶æ€æ˜¯ &#96;SHUTDOWN&#96; å¹¶ä¸” &#96;workerQueue&#96; ä¸ºç©ºï¼›
		- &#96;workerCount&#96; ä¸º 0ï¼›
		- è®¾ç½® &#96;TIDYING&#96; çŠ¶æ€æˆåŠŸã€‚

![img](https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;dunwu&#x2F;images&#x2F;dev&#x2F;cs&#x2F;java&#x2F;javacore&#x2F;concurrent&#x2F;java-thread-pool_2.png)

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;concurrent&#x2F;Javaçº¿ç¨‹æ± .html#_3-2-æ„é€ æ–¹æ³•)3.2. æ„é€ æ–¹æ³•

&#96;ThreadPoolExecutor&#96; æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå‰ä¸‰ä¸ªéƒ½æ˜¯åŸºäºç¬¬å››ä¸ªå®ç°ã€‚ç¬¬å››ä¸ªæ„é€ æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š

&#96;&#96;&#96;java
public ThreadPoolExecutor(int corePoolSize,
                              int maximumPoolSize,
                              long keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue&lt;Runnable&gt; workQueue,
                              ThreadFactory threadFactory,
                              RejectedExecutionHandler handler) &#123;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>
<pre><code>  corePoolSize
  <pre class="line-numbers language-none"><code class="language-none">
 

\-

 

æ ¸å¿ƒçº¿ç¨‹æ•°é‡

ã€‚å½“æœ‰æ–°ä»»åŠ¡é€šè¿‡

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  execute
  <pre class="line-numbers language-none"><code class="language-none">
	 

	æ–¹æ³•æäº¤æ—¶ ï¼Œçº¿ç¨‹æ± ä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š

	- å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°å°‘äº &#96;corePoolSize&#96;ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ˜¯ç©ºé—²çš„ã€‚
	- å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº &#96;corePoolSize&#96; ä¸”å°äº &#96;maximumPoolSize&#96;ï¼Œåˆ™åªæœ‰å½“ &#96;workQueue&#96; æ»¡æ—¶æ‰åˆ›å»ºæ–°çš„çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼›
	- å¦‚æœè®¾ç½®çš„ &#96;corePoolSize&#96; å’Œ &#96;maximumPoolSize&#96; ç›¸åŒï¼Œåˆ™åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚è¿™æ—¶å¦‚æœæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œè‹¥ &#96;workQueue&#96; æœªæ»¡ï¼Œåˆ™å°†è¯·æ±‚æ”¾å…¥ &#96;workQueue&#96; ä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„çº¿ç¨‹å»ä» &#96;workQueue&#96; ä¸­å–ä»»åŠ¡å¹¶å¤„ç†ï¼›
	- å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº &#96;maximumPoolSize&#96;ï¼Œè¿™æ—¶å¦‚æœ &#96;workQueue&#96; å·²ç»æ»¡äº†ï¼Œåˆ™ä½¿ç”¨ &#96;handler&#96; æ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ï¼›
	- æ‰€ä»¥ï¼Œä»»åŠ¡æäº¤æ—¶ï¼Œåˆ¤æ–­çš„é¡ºåºä¸º &#96;corePoolSize&#96; &#x3D;&gt; &#96;workQueue&#96; &#x3D;&gt; &#96;maximumPoolSize&#96;ã€‚

- &#96;&#96;&#96;
	maximumPoolSize<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  \-

   

  æœ€å¤§çº¿ç¨‹æ•°é‡

  ã€‚

  - å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šå†åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚
  - å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½¿ç”¨äº†æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—è¿™ä¸ªå‚æ•°å°±æ²¡ä»€ä¹ˆæ•ˆæœã€‚

</code></pre>
</li>
<li>
<pre><code>  keepAliveTime
  <pre class="line-numbers language-none"><code class="language-none">
	ï¼š

	çº¿ç¨‹ä¿æŒæ´»åŠ¨çš„æ—¶é—´

	ã€‚

	- å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº &#96;corePoolSize&#96; çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† &#96;keepAliveTime&#96;ã€‚
	- æ‰€ä»¥ï¼Œå¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥è°ƒå¤§è¿™ä¸ªæ—¶é—´ï¼Œæé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚

- &#96;unit&#96; - **&#96;keepAliveTime&#96; çš„æ—¶é—´å•ä½**ã€‚æœ‰ 7 ç§å–å€¼ã€‚å¯é€‰çš„å•ä½æœ‰å¤©ï¼ˆDAYSï¼‰ï¼Œå°æ—¶ï¼ˆHOURSï¼‰ï¼Œåˆ†é’Ÿï¼ˆMINUTESï¼‰ï¼Œæ¯«ç§’(MILLISECONDS)ï¼Œå¾®ç§’(MICROSECONDS, åƒåˆ†ä¹‹ä¸€æ¯«ç§’)å’Œæ¯«å¾®ç§’(NANOSECONDS, åƒåˆ†ä¹‹ä¸€å¾®ç§’)ã€‚

- &#96;&#96;&#96;
	workQueue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  \-

   

  ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—

  ã€‚ç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚ å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚

  - ```
  	ArrayBlockingQueue
  	<pre class="line-numbers language-none"><code class="language-none">
	 

	\-

	 

	æœ‰ç•Œé˜»å¡é˜Ÿåˆ—

	ã€‚

	- æ­¤é˜Ÿåˆ—æ˜¯**åŸºäºæ•°ç»„çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰**ã€‚
	- æ­¤é˜Ÿåˆ—åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ã€‚

- &#96;&#96;&#96;
	LinkedBlockingQueue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

  	 

  	\-

  	 

  	æ— ç•Œé˜»å¡é˜Ÿåˆ—

  	ã€‚

  	- æ­¤é˜Ÿåˆ—æ˜¯**åŸºäºé“¾è¡¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰**ã€‚
  	- å¦‚æœåˆ›å»ºæ—¶æ²¡æœ‰æŒ‡å®šæ­¤é˜Ÿåˆ—å¤§å°ï¼Œåˆ™é»˜è®¤ä¸º `Integer.MAX_VALUE`ã€‚
  	- ååé‡é€šå¸¸è¦é«˜äº `ArrayBlockingQueue`ã€‚
  	- ä½¿ç”¨ `LinkedBlockingQueue` æ„å‘³ç€ï¼š `maximumPoolSize` å°†ä¸èµ·ä½œç”¨ï¼Œçº¿ç¨‹æ± èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ä¸º `corePoolSize`ï¼Œå› ä¸ºä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—ã€‚
  	- `Executors.newFixedThreadPool` ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚

  - ```
  	SynchronousQueue
  	<pre class="line-numbers language-none"><code class="language-none">
		 

		\-

		 

		ä¸ä¼šä¿å­˜æäº¤çš„ä»»åŠ¡ï¼Œè€Œæ˜¯å°†ç›´æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡

		ã€‚

		- æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚
		- ååé‡é€šå¸¸è¦é«˜äº &#96;LinkedBlockingQueue&#96;ã€‚
		- &#96;Executors.newCachedThreadPool&#96; ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚

	- &#96;PriorityBlockingQueue&#96; - **å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—**ã€‚

- &#96;threadFactory&#96; - **çº¿ç¨‹å·¥å‚**ã€‚å¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ã€‚

- &#96;&#96;&#96;
	handler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  \-

   

  é¥±å’Œç­–ç•¥

  ã€‚å®ƒæ˜¯

   

  <pre class="line-numbers language-none"><code class="language-none">RejectedExecutionHandler<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

   

  ç±»å‹çš„å˜é‡ã€‚å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚çº¿ç¨‹æ± æ”¯æŒä»¥ä¸‹ç­–ç•¥ï¼š

  - `AbortPolicy` - ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¹Ÿæ˜¯é»˜è®¤ç­–ç•¥ã€‚
  - `DiscardPolicy` - ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†ä¸æŠ›å‡ºå¼‚å¸¸ã€‚
  - `DiscardOldestPolicy` - ä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚
  - `CallerRunsPolicy` - ç›´æ¥è°ƒç”¨ `run` æ–¹æ³•å¹¶ä¸”é˜»å¡æ‰§è¡Œã€‚
  - å¦‚æœä»¥ä¸Šç­–ç•¥éƒ½ä¸èƒ½æ»¡è¶³éœ€è¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ç° `RejectedExecutionHandler` æ¥å£æ¥å®šåˆ¶å¤„ç†ç­–ç•¥ã€‚å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚

</code></pre>
</li>
</ul>
<h3 id="-723"><a class="markdownIt-Anchor" href="#-723">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-3-execute-%E6%96%B9%E6%B3%95">#</a>3.3. execute æ–¹æ³•</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºçº¿ç¨‹æ± ä¹‹åï¼Œçº¿ç¨‹æ± ä¸­æ˜¯æ²¡æœ‰çº¿ç¨‹çš„ï¼Œéœ€è¦æäº¤ä»»åŠ¡ä¹‹åæ‰ä¼šåˆ›å»ºçº¿ç¨‹ã€‚</p>
<p>æäº¤ä»»åŠ¡å¯ä»¥ä½¿ç”¨  <code>execute</code>  æ–¹æ³•ï¼Œå®ƒæ˜¯  <code>ThreadPoolExecutor</code>  çš„æ ¸å¿ƒæ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥<strong>å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œäº¤ç”±çº¿ç¨‹æ± å»æ‰§è¡Œ</strong>ã€‚</p>
<p><code>execute</code>  æ–¹æ³•å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¦‚æœ  <code>workerCount &lt; corePoolSize</code> ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼›</li>
<li>å¦‚æœ  <code>workerCount &gt;= corePoolSize</code> ï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜»å¡é˜Ÿåˆ—ä¸­ï¼›</li>
<li>å¦‚æœ  <code>workerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSize</code> ï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ï¼›</li>
<li>å¦‚æœ <code>workerCount &gt;= maximumPoolSize</code> ï¼Œå¹¶ä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æ ¹æ®æ‹’ç»ç­–ç•¥æ¥å¤„ç†è¯¥ä»»åŠ¡ï¼Œé»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚</li>
</ol>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/java-thread-pool_1.png" alt="img"></p>
<h3 id="-724"><a class="markdownIt-Anchor" href="#-724">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-4-%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E6%96%B9%E6%B3%95">#</a>3.4. å…¶ä»–é‡è¦æ–¹æ³•</h3>
<p>åœ¨  <code>ThreadPoolExecutor</code>  ç±»ä¸­è¿˜æœ‰ä¸€äº›é‡è¦çš„æ–¹æ³•ï¼š</p>
<ul>
<li>
<p><code>submit</code>  - ç±»ä¼¼äº  <code>execute</code> ï¼Œä½†æ˜¯é’ˆå¯¹çš„æ˜¯æœ‰è¿”å›å€¼çš„çº¿ç¨‹ã€‚ <code>submit</code>  æ–¹æ³•æ˜¯åœ¨  <code>ExecutorService</code>  ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œåœ¨  <code>AbstractExecutorService</code>  å°±å·²ç»æœ‰äº†å…·ä½“çš„å®ç°ã€‚ <code>ThreadPoolExecutor</code>  ç›´æ¥å¤ç”¨  <code>AbstractExecutorService</code>  çš„  <code>submit</code>  æ–¹æ³•ã€‚</p>
</li>
<li>
<pre><code>  shutdown
  <pre class="line-numbers language-none"><code class="language-none">
	 

	\- ä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œè€Œæ˜¯è¦ç­‰æ‰€æœ‰ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ç»ˆæ­¢ï¼Œä½†å†ä¹Ÿä¸ä¼šæ¥å—æ–°çš„ä»»åŠ¡ã€‚

	- å°†çº¿ç¨‹æ± åˆ‡æ¢åˆ° &#96;SHUTDOWN&#96; çŠ¶æ€ï¼›
	- å¹¶è°ƒç”¨ &#96;interruptIdleWorkers&#96; æ–¹æ³•è¯·æ±‚ä¸­æ–­æ‰€æœ‰ç©ºé—²çš„ workerï¼›
	- æœ€åè°ƒç”¨ &#96;tryTerminate&#96; å°è¯•ç»“æŸçº¿ç¨‹æ± ã€‚

- &#96;&#96;&#96;
	shutdownNow<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  \- ç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œå¹¶å°è¯•æ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ¸…ç©ºä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œè¿”å›å°šæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚ä¸

   

  <pre class="line-numbers language-none"><code class="language-none">shutdown<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

   

  æ–¹æ³•ç±»ä¼¼ï¼Œä¸åŒçš„åœ°æ–¹åœ¨äºï¼š

  - è®¾ç½®çŠ¶æ€ä¸º `STOP`ï¼›
  - ä¸­æ–­æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼Œæ— è®ºæ˜¯å¦æ˜¯ç©ºé—²çš„ï¼›
  - å–å‡ºé˜»å¡é˜Ÿåˆ—ä¸­æ²¡æœ‰è¢«æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿”å›ã€‚

</code></pre>
</li>
<li>
<p><code>isShutdown</code>  - è°ƒç”¨äº†  <code>shutdown</code>  æˆ–  <code>shutdownNow</code>  æ–¹æ³•åï¼Œ <code>isShutdown</code>  æ–¹æ³•å°±ä¼šè¿”å› trueã€‚</p>
</li>
<li>
<p><code>isTerminaed</code>  - å½“æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²å…³é—­åï¼Œæ‰è¡¨ç¤ºçº¿ç¨‹æ± å…³é—­æˆåŠŸï¼Œè¿™æ—¶è°ƒç”¨  <code>isTerminaed</code>  æ–¹æ³•ä¼šè¿”å› trueã€‚</p>
</li>
<li>
<p><code>setCorePoolSize</code>  - è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•°å¤§å°ã€‚</p>
</li>
<li>
<p><code>setMaximumPoolSize</code>  - è®¾ç½®æœ€å¤§çº¿ç¨‹æ•°å¤§å°ã€‚</p>
</li>
<li>
<p><code>getTaskCount</code>  - çº¿ç¨‹æ± å·²ç»æ‰§è¡Œçš„å’Œæœªæ‰§è¡Œçš„ä»»åŠ¡æ€»æ•°ï¼›</p>
</li>
<li>
<p><code>getCompletedTaskCount</code>  - çº¿ç¨‹æ± å·²å®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼Œè¯¥å€¼å°äºç­‰äº  <code>taskCount</code> ï¼›</p>
</li>
<li>
<p><code>getLargestPoolSize</code>  - çº¿ç¨‹æ± æ›¾ç»åˆ›å»ºè¿‡çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚é€šè¿‡è¿™ä¸ªæ•°æ®å¯ä»¥çŸ¥é“çº¿ç¨‹æ± æ˜¯å¦æ»¡è¿‡ï¼Œä¹Ÿå°±æ˜¯è¾¾åˆ°äº†  <code>maximumPoolSize</code> ï¼›</p>
</li>
<li>
<p><code>getPoolSize</code>  - çº¿ç¨‹æ± å½“å‰çš„çº¿ç¨‹æ•°é‡ï¼›</p>
</li>
<li>
<p><code>getActiveCount</code>  - å½“å‰çº¿ç¨‹æ± ä¸­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°é‡ã€‚</p>
</li>
</ul>
<h3 id="-725"><a class="markdownIt-Anchor" href="#-725">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_3-5-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">#</a>3.5. ä½¿ç”¨ç¤ºä¾‹</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPoolExecutorDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> info <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ç›®ï¼š%sï¼Œé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°ç›®ï¼š%sï¼Œå·²æ‰§è¡Œç©åˆ«çš„ä»»åŠ¡æ•°ç›®ï¼š%s"</span><span class="token punctuation">,</span>
                threadPoolExecutor<span class="token punctuation">.</span><span class="token function">getPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                threadPoolExecutor<span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                threadPoolExecutor<span class="token punctuation">.</span><span class="token function">getCompletedTaskCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-726"><a class="markdownIt-Anchor" href="#-726">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-executors">#</a>4. Executors</h2>
<p>JDK çš„  <code>Executors</code>  ç±»ä¸­æä¾›äº†å‡ ç§å…·æœ‰ä»£è¡¨æ€§çš„çº¿ç¨‹æ± ï¼Œè¿™äº›çº¿ç¨‹æ±  <strong>éƒ½æ˜¯åŸºäº  <code>ThreadPoolExecutor</code>  çš„å®šåˆ¶åŒ–å®ç°</strong>ã€‚</p>
<p>åœ¨å®é™…ä½¿ç”¨çº¿ç¨‹æ± çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¸æ˜¯ç›´æ¥ä½¿ç”¨  <code>ThreadPoolExecutor</code>  ï¼Œè€Œæ˜¯ä½¿ç”¨ JDK ä¸­æä¾›çš„å…·æœ‰ä»£è¡¨æ€§çš„çº¿ç¨‹æ± å®ä¾‹ã€‚</p>
<h3 id="-727"><a class="markdownIt-Anchor" href="#-727">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-1-newsinglethreadexecutor">#</a>4.1. newSingleThreadExecutor</h3>
<p><strong>åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± </strong>ã€‚</p>
<p>åªä¼šåˆ›å»ºå”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº (FIFO, LIFO, ä¼˜å…ˆçº§) æ‰§è¡Œã€‚ <strong>å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒ</strong> ã€‚</p>
<p>å•å·¥ä½œçº¿ç¨‹æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡</strong>ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingleThreadExecutorDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-728"><a class="markdownIt-Anchor" href="#-728">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-2-newfixedthreadpool">#</a>4.2. newFixedThreadPool</h3>
<p><strong>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </strong>ã€‚</p>
<p><strong>æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ•°é‡è¾¾åˆ°çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™å°†æäº¤çš„ä»»åŠ¡å­˜å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­</strong>ã€‚</p>
<p><code>FixedThreadPool</code>  æ˜¯ä¸€ä¸ªå…¸å‹ä¸”ä¼˜ç§€çš„çº¿ç¨‹æ± ï¼Œå®ƒå…·æœ‰çº¿ç¨‹æ± æé«˜ç¨‹åºæ•ˆç‡å’ŒèŠ‚çœåˆ›å»ºçº¿ç¨‹æ—¶æ‰€è€—çš„å¼€é”€çš„ä¼˜ç‚¹ã€‚ä½†æ˜¯ï¼Œåœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œè¿˜ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FixedThreadPoolDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-729"><a class="markdownIt-Anchor" href="#-729">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-3-newcachedthreadpool">#</a>4.3. newCachedThreadPool</h3>
<p><strong>åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± </strong>ã€‚</p>
<ul>
<li>å¦‚æœçº¿ç¨‹æ± å¤§å°è¶…è¿‡å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹æ•°ï¼Œå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²çš„çº¿ç¨‹ï¼›</li>
<li>å¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¾€çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡ï¼Œå³å¦‚æœå·¥ä½œçº¿ç¨‹ç©ºé—²äº†æŒ‡å®šçš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º 1 åˆ†é’Ÿï¼‰ï¼Œåˆ™è¯¥å·¥ä½œçº¿ç¨‹å°†è‡ªåŠ¨ç»ˆæ­¢ã€‚ç»ˆæ­¢åï¼Œå¦‚æœä½ åˆæäº¤äº†æ–°çš„ä»»åŠ¡ï¼Œåˆ™çº¿ç¨‹æ± é‡æ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</li>
<li>æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´ JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚ å› æ­¤ï¼Œä½¿ç”¨  <code>CachedThreadPool</code>  æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶ä»»åŠ¡çš„æ•°é‡ï¼Œå¦åˆ™ï¼Œç”±äºå¤§é‡çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå¾ˆæœ‰ä¼šé€ æˆç³»ç»Ÿç˜«ç—ªã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CachedThreadPoolDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-730"><a class="markdownIt-Anchor" href="#-730">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-4-newschedulethreadpool">#</a>4.4. newScheduleThreadPool</h3>
<p>åˆ›å»ºä¸€ä¸ªå¤§å°æ— é™çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledThreadPoolDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ScheduledExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ScheduledExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            executorService<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-731"><a class="markdownIt-Anchor" href="#-731">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_4-5-newworkstealingpool">#</a>4.5. newWorkStealingPool</h3>
<p>Java 8 æ‰å¼•å…¥ã€‚</p>
<p>å…¶å†…éƒ¨ä¼šæ„å»º  <code>ForkJoinPool</code> ï¼Œåˆ©ç”¨ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Work_stealing">Work-Stealing (opens new window)</a> ç®—æ³•ï¼Œå¹¶è¡Œåœ°å¤„ç†ä»»åŠ¡ï¼Œä¸ä¿è¯å¤„ç†é¡ºåºã€‚</p>
<h2 id="-732"><a class="markdownIt-Anchor" href="#-732">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">#</a>5. çº¿ç¨‹æ± æœ€ä½³å®è·µ</h2>
<h3 id="-733"><a class="markdownIt-Anchor" href="#-733">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-1-%E8%AE%A1%E7%AE%97%E7%BA%BF%E7%A8%8B%E6%95%B0%E9%87%8F">#</a>5.1. è®¡ç®—çº¿ç¨‹æ•°é‡</h3>
<p>ä¸€èˆ¬å¤šçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ç±»å‹å¯ä»¥åˆ†ä¸º CPU å¯†é›†å‹å’Œ I/O å¯†é›†å‹ï¼Œæ ¹æ®ä¸åŒçš„ä»»åŠ¡ç±»å‹ï¼Œæˆ‘ä»¬è®¡ç®—çº¿ç¨‹æ•°çš„æ–¹æ³•ä¹Ÿä¸ä¸€æ ·ã€‚</p>
<p>**CPU å¯†é›†å‹ä»»åŠ¡ï¼š** è¿™ç§ä»»åŠ¡æ¶ˆè€—çš„ä¸»è¦æ˜¯ CPU èµ„æºï¼Œå¯ä»¥å°†çº¿ç¨‹æ•°è®¾ç½®ä¸º Nï¼ˆCPU æ ¸å¿ƒæ•°ï¼‰+1ï¼Œæ¯” CPU æ ¸å¿ƒæ•°å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹å¶å‘çš„ç¼ºé¡µä¸­æ–­ï¼Œæˆ–è€…å…¶å®ƒåŸå› å¯¼è‡´çš„ä»»åŠ¡æš‚åœè€Œå¸¦æ¥çš„å½±å“ã€‚ä¸€æ—¦ä»»åŠ¡æš‚åœï¼ŒCPU å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œåœ¨è¿™ç§æƒ…å†µä¸‹å¤šå‡ºæ¥çš„ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å……åˆ†åˆ©ç”¨ CPU çš„ç©ºé—²æ—¶é—´ã€‚</p>
<p>**I/O å¯†é›†å‹ä»»åŠ¡ï¼š** è¿™ç§ä»»åŠ¡åº”ç”¨èµ·æ¥ï¼Œç³»ç»Ÿä¼šç”¨å¤§éƒ¨åˆ†çš„æ—¶é—´æ¥å¤„ç† I/O äº¤äº’ï¼Œè€Œçº¿ç¨‹åœ¨å¤„ç† I/O çš„æ—¶é—´æ®µå†…ä¸ä¼šå ç”¨ CPU æ¥å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥å°† CPU äº¤å‡ºç»™å…¶å®ƒçº¿ç¨‹ä½¿ç”¨ã€‚å› æ­¤åœ¨ I/O å¯†é›†å‹ä»»åŠ¡çš„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤šé…ç½®ä¸€äº›çº¿ç¨‹ï¼Œå…·ä½“çš„è®¡ç®—æ–¹æ³•æ˜¯ 2Nã€‚</p>
<h3 id="-734"><a class="markdownIt-Anchor" href="#-734">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-2-%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E6%9C%89%E7%95%8C%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97">#</a>5.2. å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</h3>
<p>ä¸å»ºè®®ä½¿ç”¨  <code>Executors</code>  çš„æœ€é‡è¦çš„åŸå› æ˜¯ï¼š <code>Executors</code>  æä¾›çš„å¾ˆå¤šæ–¹æ³•é»˜è®¤ä½¿ç”¨çš„éƒ½æ˜¯æ— ç•Œçš„  <code>LinkedBlockingQueue</code> ï¼Œé«˜è´Ÿè½½æƒ…å¢ƒä¸‹ï¼Œæ— ç•Œé˜Ÿåˆ—å¾ˆå®¹æ˜“å¯¼è‡´ OOMï¼Œè€Œ OOM ä¼šå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½æ— æ³•å¤„ç†ï¼Œè¿™æ˜¯è‡´å‘½é—®é¢˜ã€‚æ‰€ä»¥<strong>å¼ºçƒˆå»ºè®®ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—</strong>ã€‚</p>
<p>ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­æåˆ°ï¼Œç¦æ­¢ä½¿ç”¨è¿™äº›æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œè€Œåº”è¯¥æ‰‹åŠ¨  <code>new ThreadPoolExecutor</code>  æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚åˆ¶è®¢è¿™æ¡è§„åˆ™æ˜¯å› ä¸ºå®¹æ˜“å¯¼è‡´ç”Ÿäº§äº‹æ•…ï¼Œæœ€å…¸å‹çš„å°±æ˜¯  <code>newFixedThreadPool</code>  å’Œ  <code>newCachedThreadPool</code> ï¼Œå¯èƒ½å› ä¸ºèµ„æºè€—å°½å¯¼è‡´ OOM é—®é¢˜ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ <code>newFixedThreadPool</code>  OOM</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ThreadPoolExecutor</span> threadPool <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">)</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printStats</span><span class="token punctuation">(</span>threadPool<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">rangeClosed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span>__ <span class="token operator">-></span> <span class="token string">"a"</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token punctuation">&#125;</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
threadPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>newFixedThreadPool</code>  ä½¿ç”¨çš„å·¥ä½œé˜Ÿåˆ—æ˜¯  <code>LinkedBlockingQueue</code>  ï¼Œè€Œé»˜è®¤æ„é€ æ–¹æ³•çš„  <code>LinkedBlockingQueue</code>  æ˜¯ä¸€ä¸ª  <code>Integer.MAX_VALUE</code>  é•¿åº¦çš„é˜Ÿåˆ—ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯æ— ç•Œçš„ã€‚å¦‚æœä»»åŠ¡è¾ƒå¤šå¹¶ä¸”æ‰§è¡Œè¾ƒæ…¢çš„è¯ï¼Œé˜Ÿåˆ—å¯èƒ½ä¼šå¿«é€Ÿç§¯å‹ï¼Œæ’‘çˆ†å†…å­˜å¯¼è‡´ OOMã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ <code>newCachedThreadPool</code>  OOM</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ThreadPoolExecutor</span> threadPool <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">)</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printStats</span><span class="token punctuation">(</span>threadPool<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">String</span> payload <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
			<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token punctuation">&#125;</span>
		log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
threadPool<span class="token punctuation">.</span><span class="token function">awaitTermination</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>HOURS<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>newCachedThreadPool</code>  çš„æœ€å¤§çº¿ç¨‹æ•°æ˜¯  <code>Integer.MAX_VALUE</code> ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯æ²¡æœ‰ä¸Šé™çš„ï¼Œè€Œå…¶å·¥ä½œé˜Ÿåˆ—  <code>SynchronousQueue</code>  æ˜¯ä¸€ä¸ªæ²¡æœ‰å­˜å‚¨ç©ºé—´çš„é˜»å¡é˜Ÿåˆ—ã€‚è¿™æ„å‘³ç€ï¼Œåªè¦æœ‰è¯·æ±‚åˆ°æ¥ï¼Œå°±å¿…é¡»æ‰¾åˆ°ä¸€æ¡å·¥ä½œçº¿ç¨‹æ¥å¤„ç†ï¼Œå¦‚æœå½“å‰æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹å°±å†åˆ›å»ºä¸€æ¡æ–°çš„ã€‚</p>
<p>å¦‚æœå¤§é‡çš„ä»»åŠ¡è¿›æ¥åä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“çº¿ç¨‹æ˜¯éœ€è¦åˆ†é…ä¸€å®šçš„å†…å­˜ç©ºé—´ä½œä¸ºçº¿ç¨‹æ ˆçš„ï¼Œæ¯”å¦‚ 1MBï¼Œå› æ­¤æ— é™åˆ¶åˆ›å»ºçº¿ç¨‹å¿…ç„¶ä¼šå¯¼è‡´ OOMã€‚</p>
<h3 id="-735"><a class="markdownIt-Anchor" href="#-735">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.html#_5-3-%E9%87%8D%E8%A6%81%E4%BB%BB%E5%8A%A1%E5%BA%94%E8%AF%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5">#</a>5.3. é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</h3>
<p>ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œå½“ä»»åŠ¡è¿‡å¤šæ—¶ï¼Œçº¿ç¨‹æ± ä¼šè§¦å‘æ‰§è¡Œæ‹’ç»ç­–ç•¥ï¼Œçº¿ç¨‹æ± é»˜è®¤çš„æ‹’ç»ç­–ç•¥ä¼š throw  <code>RejectedExecutionException</code>  è¿™æ˜¯ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¯¹äºè¿è¡Œæ—¶å¼‚å¸¸ç¼–è¯‘å™¨å¹¶ä¸å¼ºåˆ¶  <code>catch</code>  å®ƒï¼Œæ‰€ä»¥å¼€å‘äººå‘˜å¾ˆå®¹æ˜“å¿½ç•¥ã€‚å› æ­¤<strong>é»˜è®¤æ‹’ç»ç­–ç•¥è¦æ…é‡ä½¿ç”¨</strong>ã€‚å¦‚æœçº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡éå¸¸é‡è¦ï¼Œå»ºè®®è‡ªå®šä¹‰è‡ªå·±çš„æ‹’ç»ç­–ç•¥ï¼›å¹¶ä¸”åœ¨å®é™…å·¥ä½œä¸­ï¼Œè‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥å¾€å¾€å’Œé™çº§ç­–ç•¥é…åˆä½¿ç”¨ã€‚</p>
<hr>
<h1 id="java-å¹¶å‘å·¥å…·ç±»"><a class="markdownIt-Anchor" href="#java-å¹¶å‘å·¥å…·ç±»">#</a> Java å¹¶å‘å·¥å…·ç±»</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
<p>JDK çš„  <code>java.util.concurrent</code>  åŒ…ï¼ˆå³ J.U.Cï¼‰ä¸­æä¾›äº†å‡ ä¸ªéå¸¸æœ‰ç”¨çš„å¹¶å‘å·¥å…·ç±»ã€‚</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#1-countdownlatch">1. CountDownLatch</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#2-cyclicbarrier">2. CyclicBarrier</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#3-semaphore">3. Semaphore</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#4-%E6%80%BB%E7%BB%93">4. æ€»ç»“</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-736"><a class="markdownIt-Anchor" href="#-736">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#_1-countdownlatch">#</a>1. CountDownLatch</h2>
<blockquote>
<p>å­—é¢æ„æ€ä¸º <strong>é€’å‡è®¡æ•°é”</strong>ã€‚ç”¨äº<strong>æ§åˆ¶ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹</strong>ã€‚</p>
<p><code>CountDownLatch</code>  ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ countï¼Œè¡¨ç¤ºéœ€è¦ç­‰å¾…çš„äº‹ä»¶æ•°é‡ã€‚ <code>countDown</code>  æ–¹æ³•é€’å‡è®¡æ•°å™¨ï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿã€‚è°ƒç”¨  <code>await</code>  æ–¹æ³•çš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ç›´åˆ°è®¡æ•°å™¨ä¸ºé›¶ï¼Œæˆ–è€…ç­‰å¾…ä¸­çš„çº¿ç¨‹ä¸­æ–­ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ã€‚</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/CountDownLatch.png" alt="img"></p>
<p><code>CountDownLatch</code>  æ˜¯åŸºäº AQS ( <code>AbstractQueuedSynchronizer</code> ) å®ç°çš„ã€‚</p>
<p><code>CountDownLatch</code>  å”¯ä¸€çš„æ„é€ æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// åˆå§‹åŒ–è®¡æ•°å™¨</span>
<span class="token keyword">public</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>count ä¸ºç»Ÿè®¡å€¼ã€‚</li>
</ul>
<p><code>CountDownLatch</code>  çš„é‡è¦æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>await()</code>  - è°ƒç”¨  <code>await()</code>  æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œå®ƒä¼šç­‰å¾…ç›´åˆ° count å€¼ä¸º 0 æ‰ç»§ç»­æ‰§è¡Œã€‚</li>
<li><code>await(long timeout, TimeUnit unit)</code>  - å’Œ  <code>await()</code>  ç±»ä¼¼ï¼Œåªä¸è¿‡ç­‰å¾…ä¸€å®šçš„æ—¶é—´å count å€¼è¿˜æ²¡å˜ä¸º 0 çš„è¯å°±ä¼šç»§ç»­æ‰§è¡Œ</li>
<li><code>countDown()</code>  - å°†ç»Ÿè®¡å€¼ count å‡ 1</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> latch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>latch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>latch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç­‰å¾…2ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2ä¸ªå­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">CountDownLatch</span> latch<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">CountDownLatch</span> latch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>latch <span class="token operator">=</span> latch<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å­çº¿ç¨‹"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ­£åœ¨æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å­çº¿ç¨‹"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ‰§è¡Œå®Œæ¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-737"><a class="markdownIt-Anchor" href="#-737">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#_2-cyclicbarrier">#</a>2. CyclicBarrier</h2>
<blockquote>
<p>å­—é¢æ„æ€æ˜¯ <strong>å¾ªç¯æ …æ </strong>ã€‚<strong> <code>CyclicBarrier</code>  å¯ä»¥è®©ä¸€ç»„çº¿ç¨‹ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼ˆéµå¾ªå­—é¢æ„æ€ï¼Œä¸å¦¨ç§°è¿™ä¸ªçŠ¶æ€ä¸ºæ …æ ï¼‰ä¹‹åå†å…¨éƒ¨åŒæ—¶æ‰§è¡Œ</strong>ã€‚ä¹‹æ‰€ä»¥å«å¾ªç¯æ …æ æ˜¯å› ä¸ºï¼š<strong>å½“æ‰€æœ‰ç­‰å¾…çº¿ç¨‹éƒ½è¢«é‡Šæ”¾ä»¥åï¼Œ <code>CyclicBarrier</code>  å¯ä»¥è¢«é‡ç”¨</strong>ã€‚</p>
<p><code>CyclicBarrier</code>  ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ countã€‚æ¯æ¬¡æ‰§è¡Œ  <code>await</code>  æ–¹æ³•ä¹‹åï¼Œcount åŠ  1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å’Œè®¾ç½®çš„å€¼ç›¸ç­‰ï¼Œç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p>
</blockquote>
<p><code>CyclicBarrier</code>  æ˜¯åŸºäº  <code>ReentrantLock</code>  å’Œ  <code>Condition</code>  å®ç°çš„ã€‚</p>
<p><code>CyclicBarrier</code>  åº”ç”¨åœºæ™¯ï¼š <code>CyclicBarrier</code>  åœ¨å¹¶è¡Œè¿­ä»£ç®—æ³•ä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/CyclicBarrier.png" alt="img"></p>
<p><code>CyclicBarrier</code>  æä¾›äº† 2 ä¸ªæ„é€ æ–¹æ³•</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> barrierAction<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>parties</code>  -  <code>parties</code>  æ•°ç›¸å½“äºä¸€ä¸ªé˜ˆå€¼ï¼Œå½“æœ‰  <code>parties</code>  æ•°é‡çš„çº¿ç¨‹åœ¨ç­‰å¾…æ—¶ï¼Œ  <code>CyclicBarrier</code>  å¤„äºæ …æ çŠ¶æ€ã€‚</li>
<li><code>barrierAction</code>  - å½“  <code>CyclicBarrier</code>  å¤„äºæ …æ çŠ¶æ€æ—¶æ‰§è¡Œçš„åŠ¨ä½œã€‚</li>
</ul>
</blockquote>
<p><code>CyclicBarrier</code>  çš„é‡è¦æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">BrokenBarrierException</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span>
               <span class="token class-name">BrokenBarrierException</span><span class="token punctuation">,</span>
               <span class="token class-name">TimeoutException</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// å°†å±éšœé‡ç½®ä¸ºåˆå§‹çŠ¶æ€</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>await()</code>  - ç­‰å¾…è°ƒç”¨  <code>await()</code>  çš„çº¿ç¨‹æ•°è¾¾åˆ°å±éšœæ•°ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ˜¯æœ€åä¸€ä¸ªåˆ°è¾¾çš„çº¿ç¨‹ï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­æä¾›äº†éç©ºå±éšœæ“ä½œï¼Œåˆ™å½“å‰çº¿ç¨‹åœ¨å…è®¸å…¶ä»–çº¿ç¨‹ç»§ç»­ä¹‹å‰è¿è¡Œè¯¥æ“ä½œã€‚å¦‚æœåœ¨å±éšœåŠ¨ä½œæœŸé—´å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆè¯¥å¼‚å¸¸å°†åœ¨å½“å‰çº¿ç¨‹ä¸­ä¼ æ’­å¹¶ä¸”å±éšœè¢«ç½®äºæ–­å¼€çŠ¶æ€ã€‚</li>
<li><code>await(long timeout, TimeUnit unit)</code>  - ç›¸æ¯”äº  <code>await()</code>  æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è®©è¿™äº›çº¿ç¨‹ç­‰å¾…è‡³ä¸€å®šçš„æ—¶é—´ï¼Œå¦‚æœè¿˜æœ‰çº¿ç¨‹æ²¡æœ‰åˆ°è¾¾æ …æ çŠ¶æ€å°±ç›´æ¥è®©åˆ°è¾¾æ …æ çŠ¶æ€çš„çº¿ç¨‹æ‰§è¡Œåç»­ä»»åŠ¡ã€‚</li>
<li><code>reset()</code>  - å°†å±éšœé‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚</li>
</ul>
</blockquote>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrierDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">CyclicBarrier</span> barrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token class-name">N</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å½“å‰çº¿ç¨‹"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token class-name">N</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">MyThread</span> myThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>barrier<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>myThread<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">private</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier<span class="token punctuation">;</span>

        <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span> cyclicBarrier<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cyclicBarrier <span class="token operator">=</span> cyclicBarrier<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ­£åœ¨å†™å…¥æ•°æ®..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»¥ç¡çœ æ¥æ¨¡æ‹Ÿå†™å…¥æ•°æ®æ“ä½œ</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çº¿ç¨‹"</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"å†™å…¥æ•°æ®å®Œæ¯•ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å†™å…¥å®Œæ¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-738"><a class="markdownIt-Anchor" href="#-738">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#_3-semaphore">#</a>3. Semaphore</h2>
<blockquote>
<p>å­—é¢æ„æ€ä¸º <strong>ä¿¡å·é‡</strong>ã€‚ <code>Semaphore</code>  ç”¨æ¥æ§åˆ¶æŸæ®µä»£ç å—çš„å¹¶å‘æ•°ã€‚</p>
<p><code>Semaphore</code>  ç®¡ç†ç€ä¸€ç»„è™šæ‹Ÿçš„è®¸å¯ï¼ˆpermitï¼‰ï¼Œpermit çš„åˆå§‹æ•°é‡å¯é€šè¿‡æ„é€ æ–¹æ³•æ¥æŒ‡å®šã€‚æ¯æ¬¡æ‰§è¡Œ  <code>acquire</code>  æ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ª permitï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼›è€Œ  <code>release</code>  æ–¹æ³•å¯ä»¥é‡Šæ”¾ä¸€ä¸ª permitã€‚</p>
</blockquote>
<p><code>Semaphore</code>  åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li><code>Semaphore</code>  å¯ä»¥ç”¨äºå®ç°èµ„æºæ± ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€‚</li>
<li><code>Semaphore</code>  å¯ä»¥ç”¨äºå°†ä»»ä½•ä¸€ç§å®¹å™¨å˜æˆæœ‰ç•Œé˜»å¡å®¹å™¨ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/Semaphore.png" alt="img"></p>
<p><code>Semaphore</code>  æä¾›äº† 2 ä¸ªæ„é€ æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å‚æ•° permits è¡¨ç¤ºè®¸å¯æ•°ç›®ï¼Œå³åŒæ—¶å¯ä»¥å…è®¸å¤šå°‘çº¿ç¨‹è¿›è¡Œè®¿é—®</span>
<span class="token keyword">public</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// å‚æ•° fair è¡¨ç¤ºæ˜¯å¦æ˜¯å…¬å¹³çš„ï¼Œå³ç­‰å¾…æ—¶é—´è¶Šä¹…çš„è¶Šå…ˆè·å–è®¸å¯</span>
<span class="token keyword">public</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>permits</code>  - åˆå§‹åŒ–å›ºå®šæ•°é‡çš„ permitï¼Œå¹¶ä¸”é»˜è®¤ä¸ºéå…¬å¹³æ¨¡å¼ã€‚</li>
<li><code>fair</code>  - è®¾ç½®æ˜¯å¦ä¸ºå…¬å¹³æ¨¡å¼ã€‚æ‰€è°“å…¬å¹³ï¼Œæ˜¯æŒ‡ç­‰å¾…ä¹…çš„ä¼˜å…ˆè·å– permitã€‚</li>
</ul>
</blockquote>
<p><code>Semaphore</code>  çš„é‡è¦æ–¹æ³•ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è·å– 1 ä¸ªè®¸å¯</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">//è·å– permits ä¸ªè®¸å¯</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">// é‡Šæ”¾ 1 ä¸ªè®¸å¯</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token comment">//é‡Šæ”¾ permits ä¸ªè®¸å¯</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>acquire()</code>  - è·å– 1 ä¸ª permitã€‚</li>
<li><code>acquire(int permits)</code>  - è·å– permits æ•°é‡çš„ permitã€‚</li>
<li><code>release()</code>  - é‡Šæ”¾ 1 ä¸ª permitã€‚</li>
<li><code>release(int permits)</code>  - é‡Šæ”¾ permits æ•°é‡çš„ permitã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THREAD_COUNT <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>THREAD_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"save data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-739"><a class="markdownIt-Anchor" href="#-739">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.html#_4-%E6%80%BB%E7%BB%93">#</a>4. æ€»ç»“</h2>
<ul>
<li><code>CountDownLatch</code>  å’Œ <code>CyclicBarrier</code>  éƒ½èƒ½å¤Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…ï¼Œåªä¸è¿‡å®ƒä»¬ä¾§é‡ç‚¹ä¸åŒï¼š
<ul>
<li><code>CountDownLatch</code>  ä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹ A ç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œï¼›</li>
<li><code>CyclicBarrier</code>  ä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œï¼›</li>
<li>å¦å¤–ï¼Œ <code>CountDownLatch</code>  æ˜¯ä¸å¯ä»¥é‡ç”¨çš„ï¼Œè€Œ  <code>CyclicBarrier</code>  æ˜¯å¯ä»¥é‡ç”¨çš„ã€‚</li>
</ul>
</li>
<li><code>Semaphore</code>  å…¶å®å’Œé”æœ‰ç‚¹ç±»ä¼¼ï¼Œå®ƒä¸€èˆ¬ç”¨äºæ§åˆ¶å¯¹æŸç»„èµ„æºçš„è®¿é—®æƒé™ã€‚</li>
</ul>
<hr>
<h1 id="java-å†…å­˜æ¨¡å‹"><a class="markdownIt-Anchor" href="#java-å†…å­˜æ¨¡å‹">#</a> Java å†…å­˜æ¨¡å‹</h1>
<blockquote>
<p><strong>å…³é”®è¯</strong>ï¼š <code>JMM</code> ã€ <code>volatile</code> ã€ <code>synchronized</code> ã€ <code>final</code> ã€ <code>Happens-Before</code> ã€ <code>å†…å­˜å±éšœ</code></p>
<p><strong>æ‘˜è¦</strong>ï¼šJava å†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼‰ï¼Œç®€ç§° <strong>JMM</strong>ã€‚Java å†…å­˜æ¨¡å‹çš„ç›®æ ‡æ˜¯ä¸ºäº†è§£å†³ç”±å¯è§æ€§å’Œæœ‰åºæ€§å¯¼è‡´çš„å¹¶å‘å®‰å…¨é—®é¢˜ã€‚Java å†…å­˜æ¨¡å‹é€šè¿‡ <strong>å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç°è®© Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœ</strong>ã€‚</p>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. ç‰©ç†å†…å­˜æ¨¡å‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#11-%E7%A1%AC%E4%BB%B6%E5%A4%84%E7%90%86%E6%95%88%E7%8E%87">1.1. ç¡¬ä»¶å¤„ç†æ•ˆç‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#12-%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7">1.2. ç¼“å­˜ä¸€è‡´æ€§</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#13-%E4%BB%A3%E7%A0%81%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96">1.3. ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–</a></li>
</ul>
</li>
<li>\2. Java å†…å­˜æ¨¡å‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#21-%E4%B8%BB%E5%86%85%E5%AD%98%E5%92%8C%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AD%98">2.1. ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#22-jmm-%E5%86%85%E5%AD%98%E6%93%8D%E4%BD%9C%E7%9A%84%E9%97%AE%E9%A2%98">2.2. JMM å†…å­˜æ“ä½œçš„é—®é¢˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#23-%E5%86%85%E5%AD%98%E9%97%B4%E4%BA%A4%E4%BA%92%E6%93%8D%E4%BD%9C">2.3. å†…å­˜é—´äº¤äº’æ“ä½œ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#24-%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7">2.4. å¹¶å‘å®‰å…¨ç‰¹æ€§</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#3-happens-before">3. Happens-Before</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#4-%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C">4. å†…å­˜å±éšœ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#5-volatile">5. volatile</a></li>
<li>\6. synchronized
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#61-long-%E5%92%8C-double-%E5%8F%98%E9%87%8F%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99">6.1. long å’Œ double å˜é‡çš„ç‰¹æ®Šè§„åˆ™</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#62-final-%E5%9E%8B%E9%87%8F%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99">6.2. final å‹é‡çš„ç‰¹æ®Šè§„åˆ™</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-740"><a class="markdownIt-Anchor" href="#-740">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_1-%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">#</a>1. ç‰©ç†å†…å­˜æ¨¡å‹</h2>
<p>ç‰©ç†æœºé‡åˆ°çš„å¹¶å‘é—®é¢˜ä¸è™šæ‹Ÿæœºä¸­çš„æƒ…å†µæœ‰ä¸å°‘ç›¸ä¼¼ä¹‹å¤„ï¼Œç‰©ç†æœºå¯¹å¹¶å‘çš„å¤„ç†æ–¹æ¡ˆå¯¹äºè™šæ‹Ÿæœºçš„å®ç°ä¹Ÿæœ‰ç›¸å½“å¤§çš„å‚è€ƒæ„ä¹‰ã€‚</p>
<h3 id="-741"><a class="markdownIt-Anchor" href="#-741">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_1-1-%E7%A1%AC%E4%BB%B6%E5%A4%84%E7%90%86%E6%95%88%E7%8E%87">#</a>1.1. ç¡¬ä»¶å¤„ç†æ•ˆç‡</h3>
<p>ç‰©ç†å†…å­˜çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šç¡¬ä»¶å¤„ç†æ•ˆç‡ã€‚</p>
<ul>
<li>ç»å¤§å¤šæ•°çš„è¿ç®—ä»»åŠ¡éƒ½ä¸å¯èƒ½åªé å¤„ç†å™¨ â€œè®¡ç®—â€ å°±èƒ½å®Œæˆï¼Œå¤„ç†å™¨è‡³å°‘éœ€è¦ä¸<strong>å†…å­˜äº¤äº’</strong>ï¼Œå¦‚è¯»å–è¿ç®—æ•°æ®ã€å­˜å‚¨è¿ç®—ç»“æœï¼Œè¿™ä¸ª I/O æ“ä½œæ˜¯å¾ˆéš¾æ¶ˆé™¤çš„ï¼ˆæ— æ³•ä»…é å¯„å­˜å™¨å®Œæˆæ‰€æœ‰è¿ç®—ä»»åŠ¡ï¼‰ã€‚</li>
<li><strong>ç”±äºè®¡ç®—æœºçš„å­˜å‚¨è®¾å¤‡ä¸å¤„ç†å™¨çš„è¿ç®—é€Ÿåº¦æœ‰å‡ ä¸ªæ•°é‡çº§çš„å·®è·</strong> ï¼Œè¿™ç§é€Ÿåº¦ä¸Šçš„çŸ›ç›¾ï¼Œä¼šé™ä½ç¡¬ä»¶çš„å¤„ç†æ•ˆç‡ã€‚æ‰€ä»¥ï¼Œç°ä»£è®¡ç®—æœºéƒ½ä¸å¾—ä¸ <strong>åŠ å…¥é«˜é€Ÿç¼“å­˜ï¼ˆCacheï¼‰ æ¥ä½œä¸ºå†…å­˜å’Œå¤„ç†å™¨ä¹‹é—´çš„ç¼“å†²</strong>ã€‚å°†éœ€è¦ç”¨åˆ°çš„æ•°æ®å¤åˆ¶åˆ°ç¼“å­˜ä¸­ï¼Œè®©è¿ç®—èƒ½å¿«é€Ÿè¿›è¡Œï¼Œå½“è¿ç®—ç»“æŸåå†ä»ç¼“å­˜åŒæ­¥ä¼šå†…å­˜ä¸­ï¼Œè¿™æ ·å¤„ç†å™¨å°±æ— éœ€ç­‰å¾…ç¼“æ…¢çš„å†…å­˜è¯»å†™äº†ã€‚</li>
</ul>
<h3 id="-742"><a class="markdownIt-Anchor" href="#-742">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_1-2-%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7">#</a>1.2. ç¼“å­˜ä¸€è‡´æ€§</h3>
<p>é«˜é€Ÿç¼“å­˜è§£å†³äº† <strong>ç¡¬ä»¶æ•ˆç‡é—®é¢˜</strong>ï¼Œä½†æ˜¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼š<strong>ç¼“å­˜ä¸€è‡´æ€§ï¼ˆCache Coherenceï¼‰</strong>ã€‚</p>
<p>åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼Œè€Œå®ƒä»¬åˆå…±äº«åŒä¸€ä¸»å†…å­˜ã€‚å½“å¤šä¸ªå¤„ç†å™¨çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€å—ä¸»å†…å­˜åŒºåŸŸæ—¶ï¼Œå°†å¯èƒ½å¯¼è‡´å„è‡ªçš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p>ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œ<strong>éœ€è¦å„ä¸ªå¤„ç†å™¨è®¿é—®ç¼“å­˜æ—¶éƒ½éµå¾ªä¸€äº›åè®®ï¼Œåœ¨è¯»å†™æ—¶è¦æ ¹æ®åè®®æ¥è¿›è¡Œæ“ä½œ</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102230327.png" alt="img"></p>
<h3 id="-743"><a class="markdownIt-Anchor" href="#-743">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_1-3-%E4%BB%A3%E7%A0%81%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C%E4%BC%98%E5%8C%96">#</a>1.3. ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–</h3>
<p><strong>é™¤äº†é«˜é€Ÿç¼“å­˜ä»¥å¤–ï¼Œä¸ºäº†ä½¿å¾—å¤„ç†å™¨å†…éƒ¨çš„è¿ç®—å•å…ƒå°½é‡è¢«å……åˆ†åˆ©ç”¨</strong>ï¼Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¹±åºæ‰§è¡Œï¼ˆOut-Of-Order Executionï¼‰ä¼˜åŒ–ã€‚å¤„ç†å™¨ä¼šåœ¨è®¡ç®—ä¹‹åå°†ä¹±åºæ‰§è¡Œçš„ç»“æœé‡ç»„ï¼Œ<strong>ä¿è¯è¯¥ç»“æœä¸é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„</strong>ï¼Œä½†ä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥è®¡ç®—çš„å…ˆåé¡ºåºä¸è¾“å…¥ä»£ç ä¸­çš„é¡ºåºä¸€è‡´ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210102223609.png" alt="img"></p>
<p>ä¹±åºæ‰§è¡ŒæŠ€æœ¯æ˜¯å¤„ç†å™¨ä¸ºæé«˜è¿ç®—é€Ÿåº¦è€Œåšå‡ºè¿èƒŒä»£ç åŸæœ‰é¡ºåºçš„ä¼˜åŒ–ã€‚</p>
<ul>
<li><strong>å•æ ¸</strong>ç¯å¢ƒä¸‹ï¼Œå¤„ç†å™¨ä¿è¯åšå‡ºçš„ä¼˜åŒ–ä¸ä¼šå¯¼è‡´æ‰§è¡Œç»“æœè¿œç¦»é¢„æœŸç›®æ ‡ï¼Œä½†åœ¨å¤šæ ¸ç¯å¢ƒä¸‹å´å¹¶éå¦‚æ­¤ã€‚</li>
<li><strong>å¤šæ ¸</strong>ç¯å¢ƒä¸‹ï¼Œ å¦‚æœå­˜åœ¨ä¸€ä¸ªæ ¸çš„è®¡ç®—ä»»åŠ¡ä¾èµ–å¦ä¸€ä¸ªæ ¸çš„è®¡ç®—ä»»åŠ¡çš„ä¸­é—´ç»“æœï¼Œè€Œä¸”å¯¹ç›¸å…³æ•°æ®è¯»å†™æ²¡åšä»»ä½•é˜²æŠ¤æªæ–½ï¼Œé‚£ä¹ˆå…¶é¡ºåºæ€§å¹¶ä¸èƒ½é ä»£ç çš„å…ˆåé¡ºåºæ¥ä¿è¯ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102224144.png" alt="img"></p>
<h2 id="-744"><a class="markdownIt-Anchor" href="#-744">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_2-java-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">#</a>2. Java å†…å­˜æ¨¡å‹</h2>
<p><strong> <code>å†…å­˜æ¨¡å‹</code> </strong> è¿™ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼š<strong>åœ¨ç‰¹å®šçš„æ“ä½œåè®®ä¸‹ï¼Œå¯¹ç‰¹å®šçš„å†…å­˜æˆ–é«˜é€Ÿç¼“å­˜è¿›è¡Œè¯»å†™è®¿é—®çš„è¿‡ç¨‹æŠ½è±¡</strong>ã€‚ä¸åŒæ¶æ„çš„ç‰©ç†è®¡ç®—æœºå¯ä»¥æœ‰ä¸ä¸€æ ·çš„å†…å­˜æ¨¡å‹ï¼ŒJVM ä¹Ÿæœ‰è‡ªå·±çš„å†…å­˜æ¨¡å‹ã€‚</p>
<p>JVM ä¸­è¯•å›¾å®šä¹‰ä¸€ç§ Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Model, JMMï¼‰æ¥<strong>å±è”½å„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚</strong>ï¼Œä»¥å®ç°è®© Java ç¨‹åº <strong>åœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœ</strong>ã€‚</p>
<p>åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B.md">Java å¹¶å‘ç®€ä»‹ (opens new window)</a> ä¸­å·²ç»ä»‹ç»äº†ï¼Œå¹¶å‘å®‰å…¨éœ€è¦æ»¡è¶³å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§ã€‚å…¶ä¸­ï¼Œå¯¼è‡´å¯è§æ€§çš„åŸå› æ˜¯ç¼“å­˜ï¼Œå¯¼è‡´æœ‰åºæ€§çš„åŸå› æ˜¯ç¼–è¯‘ä¼˜åŒ–ã€‚é‚£è§£å†³å¯è§æ€§ã€æœ‰åºæ€§æœ€ç›´æ¥çš„åŠæ³•å°±æ˜¯<strong>ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–</strong> ã€‚ä½†è¿™ä¹ˆåšï¼Œæ€§èƒ½å°±å ªå¿§äº†ã€‚</p>
<p>åˆç†çš„æ–¹æ¡ˆåº”è¯¥æ˜¯<strong>æŒ‰éœ€ç¦ç”¨ç¼“å­˜ä»¥åŠç¼–è¯‘ä¼˜åŒ–</strong>ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åšåˆ°å‘¢ï¼Ÿï¼ŒJava å†…å­˜æ¨¡å‹è§„èŒƒäº† JVM å¦‚ä½•æä¾›æŒ‰éœ€ç¦ç”¨ç¼“å­˜å’Œç¼–è¯‘ä¼˜åŒ–çš„æ–¹æ³•ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™äº›æ–¹æ³•åŒ…æ‹¬ <strong>volatile</strong>ã€<strong>synchronized</strong> å’Œ <strong>final</strong> ä¸‰ä¸ªå…³é”®å­—ï¼Œä»¥åŠ <strong>Happens-Before è§„åˆ™</strong>ã€‚</p>
<h3 id="-745"><a class="markdownIt-Anchor" href="#-745">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_2-1-%E4%B8%BB%E5%86%85%E5%AD%98%E5%92%8C%E5%B7%A5%E4%BD%9C%E5%86%85%E5%AD%98">#</a>2.1. ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜</h3>
<p>JMM çš„ä¸»è¦ç›®æ ‡æ˜¯ <strong>å®šä¹‰ç¨‹åºä¸­å„ä¸ªå˜é‡çš„è®¿é—®è§„åˆ™ï¼Œå³åœ¨è™šæ‹Ÿæœºä¸­å°†å˜é‡å­˜å‚¨åˆ°å†…å­˜å’Œä»å†…å­˜ä¸­å–å‡ºå˜é‡è¿™æ ·çš„åº•å±‚ç»†èŠ‚</strong>ã€‚æ­¤å¤„çš„å˜é‡ï¼ˆVariablesï¼‰ä¸ Java ç¼–ç¨‹ä¸­æ‰€è¯´çš„å˜é‡æœ‰æ‰€åŒºåˆ«ï¼Œå®ƒåŒ…æ‹¬äº†å®ä¾‹å­—æ®µã€é™æ€å­—æ®µå’Œæ„æˆæ•°å€¼å¯¹è±¡çš„å…ƒç´ ï¼Œä½†ä¸åŒ…æ‹¬å±€éƒ¨å˜é‡ä¸æ–¹æ³•å‚æ•°ï¼Œå› ä¸ºåè€…æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¸ä¼šè¢«å…±äº«ï¼Œè‡ªç„¶å°±ä¸ä¼šå­˜åœ¨ç«äº‰é—®é¢˜ã€‚ä¸ºäº†è·å¾—è¾ƒå¥½çš„æ‰§è¡Œæ•ˆèƒ½ï¼ŒJMM å¹¶æ²¡æœ‰é™åˆ¶æ‰§è¡Œå¼•æ“ä½¿ç”¨å¤„ç†å™¨çš„ç‰¹å®šå¯„å­˜å™¨æˆ–ç¼“å­˜æ¥å’Œä¸»å­˜è¿›è¡Œäº¤äº’ï¼Œä¹Ÿæ²¡æœ‰é™åˆ¶å³ä½¿ç¼–è¯‘å™¨è¿›è¡Œè°ƒæ•´ä»£ç æ‰§è¡Œé¡ºåºè¿™ç±»ä¼˜åŒ–æªæ–½ã€‚</p>
<p>JMM è§„å®šäº†<strong>æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ä¸­</strong>ã€‚</p>
<p>æ¯æ¡çº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰ï¼Œ<strong>å·¥ä½œå†…å­˜ä¸­ä¿ç•™äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜çš„å‰¯æœ¬</strong>ã€‚å·¥ä½œå†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ï¼Œå®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102225839.png" alt="img"></p>
<p>çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œéƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚ä¸åŒçš„çº¿ç¨‹é—´ä¹Ÿæ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œ<strong>çº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20210102225657.png" alt="img"></p>
<blockquote>
<p>è¯´æ˜ï¼š</p>
<p>è¿™é‡Œè¯´çš„ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜ä¸ Java å†…å­˜åŒºåŸŸä¸­çš„å †ã€æ ˆã€æ–¹æ³•åŒºç­‰ä¸æ˜¯åŒä¸€ä¸ªå±‚æ¬¡çš„å†…å­˜åˆ’åˆ†ã€‚</p>
</blockquote>
<h3 id="-746"><a class="markdownIt-Anchor" href="#-746">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_2-2-jmm-%E5%86%85%E5%AD%98%E6%93%8D%E4%BD%9C%E7%9A%84%E9%97%AE%E9%A2%98">#</a>2.2. JMM å†…å­˜æ“ä½œçš„é—®é¢˜</h3>
<p>ç±»ä¼¼äºç‰©ç†å†…å­˜æ¨¡å‹é¢ä¸´çš„é—®é¢˜ï¼ŒJMM å­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>
<p><strong>å·¥ä½œå†…å­˜æ•°æ®ä¸€è‡´æ€§</strong> - å„ä¸ªçº¿ç¨‹æ“ä½œæ•°æ®æ—¶ä¼šä¿å­˜ä½¿ç”¨åˆ°çš„ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡å‰¯æœ¬ï¼Œå½“å¤šä¸ªçº¿ç¨‹çš„è¿ç®—ä»»åŠ¡éƒ½æ¶‰åŠåŒä¸€ä¸ªå…±äº«å˜é‡æ—¶ï¼Œå°†å¯¼è‡´å„è‡ªçš„çš„å…±äº«å˜é‡å‰¯æœ¬ä¸ä¸€è‡´ã€‚å¦‚æœçœŸçš„å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæ•°æ®åŒæ­¥å›ä¸»å†…å­˜ä»¥è°çš„å‰¯æœ¬æ•°æ®ä¸ºå‡†ï¼Ÿ Java å†…å­˜æ¨¡å‹ä¸»è¦é€šè¿‡ä¸€ç³»åˆ—çš„æ•°æ®åŒæ­¥åè®®ã€è§„åˆ™æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
</li>
<li>
<p>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</p>
<p>- Java ä¸­é‡æ’åºé€šå¸¸æ˜¯ç¼–è¯‘å™¨æˆ–è¿è¡Œæ—¶ç¯å¢ƒä¸ºäº†ä¼˜åŒ–ç¨‹åºæ€§èƒ½è€Œé‡‡å–çš„å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ–°æ’åºæ‰§è¡Œçš„ä¸€ç§æ‰‹æ®µã€‚é‡æ’åºåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<p>ç¼–è¯‘æœŸé‡æ’åºå’Œè¿è¡ŒæœŸé‡æ’åº</p>
<p>ï¼Œåˆ†åˆ«å¯¹åº”ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ç¯å¢ƒã€‚ åŒæ ·çš„ï¼ŒæŒ‡ä»¤é‡æ’åºä¸æ˜¯éšæ„é‡æ’åºï¼Œå®ƒéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æœã€‚å³æ—¶ç¼–è¯‘å™¨ï¼ˆå’Œå¤„ç†å™¨ï¼‰éœ€è¦ä¿è¯ç¨‹åºèƒ½å¤Ÿéµå®ˆ  <code>as-if-serial</code>  å±æ€§ã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ï¼Œè¦ç»™ç¨‹åºä¸€ä¸ªé¡ºåºæ‰§è¡Œçš„å‡è±¡ã€‚å³ç»è¿‡é‡æ’åºçš„æ‰§è¡Œç»“æœè¦ä¸é¡ºåºæ‰§è¡Œçš„ç»“æœä¿æŒä¸€è‡´ã€‚</li>
<li>å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸å…è®¸é‡æ’åºã€‚</li>
<li>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¦‚æœçº¿ç¨‹å¤„ç†é€»è¾‘ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œæœ‰å¯èƒ½å› ä¸ºæŒ‡ä»¤é‡æ’åºå¯¼è‡´è¿è¡Œç»“æœä¸é¢„æœŸä¸åŒã€‚</li>
</ul>
</li>
</ul>
<h3 id="-747"><a class="markdownIt-Anchor" href="#-747">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_2-3-%E5%86%85%E5%AD%98%E9%97%B4%E4%BA%A4%E4%BA%92%E6%93%8D%E4%BD%9C">#</a>2.3. å†…å­˜é—´äº¤äº’æ“ä½œ</h3>
<p>JMM å®šä¹‰äº† 8 ä¸ªæ“ä½œæ¥å®Œæˆä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜ä¹‹é—´çš„äº¤äº’æ“ä½œã€‚JVM å®ç°æ—¶å¿…é¡»ä¿è¯ä¸‹é¢ä»‹ç»çš„æ¯ç§æ“ä½œéƒ½æ˜¯ <strong>åŸå­çš„</strong>ï¼ˆå¯¹äº double å’Œ long å‹çš„å˜é‡æ¥è¯´ï¼Œloadã€storeã€readã€å’Œ write æ“ä½œåœ¨æŸäº›å¹³å°ä¸Šå…è®¸æœ‰ä¾‹å¤– ï¼‰ã€‚</p>
<ul>
<li><code>lock</code>  (é”å®š) - ä½œç”¨äº<strong>ä¸»å†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚</li>
<li><code>unlock</code>  (è§£é”) - ä½œç”¨äº<strong>ä¸»å†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚</li>
<li><code>read</code>  (è¯»å–) - ä½œç”¨äº<strong>ä¸»å†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜<strong>ä¼ è¾“</strong>åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„  <code>load</code>  åŠ¨ä½œä½¿ç”¨ã€‚</li>
<li><code>write</code>  (å†™å…¥) - ä½œç”¨äº<strong>ä¸»å†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠ store æ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚</li>
<li><code>load</code>  (è½½å…¥) - ä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠ read æ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚</li>
<li><code>use</code>  (ä½¿ç”¨) - ä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼å¾—å­—èŠ‚ç æŒ‡ä»¤æ—¶å°±ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li>
<li><code>assign</code>  (èµ‹å€¼) - ä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li>
<li><code>store</code>  (å­˜å‚¨) - ä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšå  <code>write</code>  æ“ä½œä½¿ç”¨ã€‚</li>
</ul>
<p>å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜ä¸­å¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œå°±<strong>éœ€è¦æŒ‰åºæ‰§è¡Œ  <code>read</code>  å’Œ  <code>load</code>  æ“ä½œ</strong>ï¼›å¦‚æœæŠŠå˜é‡ä»å·¥ä½œå†…å­˜ä¸­åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œå°±<strong>éœ€è¦æŒ‰åºæ‰§è¡Œ  <code>store</code>  å’Œ  <code>write</code>  æ“ä½œ</strong>ã€‚ä½† Java å†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°æ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œæ²¡æœ‰ä¿è¯å¿…é¡»æ˜¯è¿ç»­æ‰§è¡Œã€‚</p>
<p>JMM è¿˜è§„å®šäº†ä¸Šè¿° 8 ç§åŸºæœ¬æ“ä½œï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š</p>
<ul>
<li><strong>read å’Œ load å¿…é¡»æˆå¯¹å‡ºç°</strong>ï¼›<strong>store å’Œ write å¿…é¡»æˆå¯¹å‡ºç°</strong>ã€‚å³ä¸å…è®¸ä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜è¯»å–äº†ä½†å·¥ä½œå†…å­˜ä¸æ¥å—ï¼Œæˆ–ä»å·¥ä½œå†…å­˜å‘èµ·å›å†™äº†ä½†ä¸»å†…å­˜ä¸æ¥å—çš„æƒ…å†µå‡ºç°ã€‚</li>
<li><strong>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘ assign çš„æ“ä½œ</strong>ï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»æŠŠå˜åŒ–åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ã€‚</li>
<li><strong>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› çš„ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½• assign æ“ä½œï¼‰æŠŠæ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­</strong>ã€‚</li>
<li>ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆload æˆ– assign ï¼‰çš„å˜é‡ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½ use å’Œ store æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡äº† load æˆ– assign æ“ä½œã€‚</li>
<li>ä¸€ä¸ªå˜é‡åœ¨åŒä¸€ä¸ªæ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œ lock æ“ä½œï¼Œä½† lock æ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œ lock åï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„ unlock æ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚æ‰€ä»¥ <strong>lock å’Œ unlock å¿…é¡»æˆå¯¹å‡ºç°</strong>ã€‚</li>
<li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ lock æ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œ load æˆ– assign æ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚</li>
<li>å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢« lock æ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œ unlock æ“ä½œï¼Œä¹Ÿä¸å…è®¸å» unlock ä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šçš„å˜é‡ã€‚</li>
<li>å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œ store å’Œ write æ“ä½œï¼‰</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20210102230708.png" alt="img"></p>
<h3 id="-748"><a class="markdownIt-Anchor" href="#-748">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_2-4-%E5%B9%B6%E5%8F%91%E5%AE%89%E5%85%A8%E7%89%B9%E6%80%A7">#</a>2.4. å¹¶å‘å®‰å…¨ç‰¹æ€§</h3>
<p>ä¸Šæ–‡ä»‹ç»äº† Java å†…å­˜äº¤äº’çš„ 8 ç§åŸºæœ¬æ“ä½œï¼Œå®ƒä»¬éµå¾ª Java å†…å­˜ä¸‰å¤§ç‰¹æ€§ï¼šåŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§ã€‚</p>
<p>è€Œè¿™ä¸‰å¤§ç‰¹æ€§ï¼Œå½’æ ¹ç»“åº•ï¼Œæ˜¯ä¸ºäº†å®ç°å¤šçº¿ç¨‹çš„ <strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼Œä½¿å¾—ç¨‹åºåœ¨å¤šçº¿ç¨‹å¹¶å‘ï¼ŒæŒ‡ä»¤é‡æ’åºä¼˜åŒ–çš„ç¯å¢ƒä¸­èƒ½å¦‚é¢„æœŸè¿è¡Œã€‚</p>
<h4 id="-749"><a class="markdownIt-Anchor" href="#-749">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#%E5%8E%9F%E5%AD%90%E6%80%A7">#</a>åŸå­æ€§</h4>
<p><strong>åŸå­æ€§å³ä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼ˆæ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼‰ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œ</strong>ã€‚å³ä½¿åœ¨å¤šä¸ªçº¿ç¨‹ä¸€èµ·æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€å¹²æ‰°ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œä¸ºäº†ä¿è¯åŸå­æ€§ï¼Œæä¾›äº†ä¸¤ä¸ªé«˜çº§çš„å­—èŠ‚ç æŒ‡ä»¤  <code>monitorenter</code>  å’Œ  <code>monitorexit</code> ã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ç ï¼Œåœ¨ Java ä¸­å¯¹åº”çš„å…³é”®å­—å°±æ˜¯  <code>synchronized</code> ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ Java ä¸­å¯ä»¥ä½¿ç”¨  <code>synchronized</code>  æ¥ä¿è¯æ–¹æ³•å’Œä»£ç å—å†…çš„æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚</p>
<h4 id="-750"><a class="markdownIt-Anchor" href="#-750">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#%E5%8F%AF%E8%A7%81%E6%80%A7">#</a>å¯è§æ€§</h4>
<p><strong>å¯è§æ€§æ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå˜é‡æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹å¾—åˆ°ä¿®æ”¹çš„å€¼</strong>ã€‚</p>
<p>JMM æ˜¯é€šè¿‡ <strong>&quot; å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜</strong>ï¼Œ <strong>å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼ &quot;</strong> è¿™ç§ä¾èµ–ä¸»å†…å­˜ä½œä¸ºä¼ é€’åª’ä»‹çš„æ–¹å¼æ¥å®ç°çš„ã€‚</p>
<p>Java å®ç°å¤šçº¿ç¨‹å¯è§æ€§çš„æ–¹å¼æœ‰ï¼š</p>
<ul>
<li><code>volatile</code></li>
<li><code>synchronized</code></li>
<li><code>final</code></li>
</ul>
<h4 id="-751"><a class="markdownIt-Anchor" href="#-751">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#%E6%9C%89%E5%BA%8F%E6%80%A7">#</a>æœ‰åºæ€§</h4>
<p>æœ‰åºæ€§è§„åˆ™è¡¨ç°åœ¨ä»¥ä¸‹ä¸¤ç§åœºæ™¯ï¼šçº¿ç¨‹å†…å’Œçº¿ç¨‹é—´</p>
<ul>
<li>çº¿ç¨‹å†… - ä»æŸä¸ªçº¿ç¨‹çš„è§’åº¦çœ‹æ–¹æ³•çš„æ‰§è¡Œï¼ŒæŒ‡ä»¤ä¼šæŒ‰ç…§ä¸€ç§å« â€œä¸²è¡Œâ€ï¼ˆ <code>as-if-serial</code> ï¼‰çš„æ–¹å¼æ‰§è¡Œï¼Œæ­¤ç§æ–¹å¼å·²ç»åº”ç”¨äºé¡ºåºç¼–ç¨‹è¯­è¨€ã€‚</li>
<li>çº¿ç¨‹é—´ - è¿™ä¸ªçº¿ç¨‹ â€œè§‚å¯Ÿâ€ åˆ°å…¶ä»–çº¿ç¨‹å¹¶å‘åœ°æ‰§è¡ŒéåŒæ­¥çš„ä»£ç æ—¶ï¼Œç”±äºæŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œä»»ä½•ä»£ç éƒ½æœ‰å¯èƒ½äº¤å‰æ‰§è¡Œã€‚å”¯ä¸€èµ·ä½œç”¨çš„çº¦æŸæ˜¯ï¼šå¯¹äºåŒæ­¥æ–¹æ³•ï¼ŒåŒæ­¥å—ï¼ˆ <code>synchronized</code>  å…³é”®å­—ä¿®é¥°ï¼‰ä»¥åŠ  <code>volatile</code>  å­—æ®µçš„æ“ä½œä»ç»´æŒç›¸å¯¹æœ‰åºã€‚</li>
</ul>
<p>åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨  <code>synchronized</code>  å’Œ  <code>volatile</code>  æ¥ä¿è¯å¤šçº¿ç¨‹ä¹‹é—´æ“ä½œçš„æœ‰åºæ€§ã€‚å®ç°æ–¹å¼æœ‰æ‰€åŒºåˆ«ï¼š</p>
<ul>
<li><code>volatile</code>  å…³é”®å­—ä¼šç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</li>
<li><code>synchronized</code>  å…³é”®å­—é€šè¿‡äº’æ–¥ä¿è¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹æ“ä½œã€‚</li>
</ul>
<h2 id="-752"><a class="markdownIt-Anchor" href="#-752">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_3-happens-before">#</a>3. Happens-Before</h2>
<p>JMM ä¸ºç¨‹åºä¸­æ‰€æœ‰çš„æ“ä½œå®šä¹‰äº†ä¸€ä¸ªååºå…³ç³»ï¼Œç§°ä¹‹ä¸º <strong> <code>å…ˆè¡Œå‘ç”ŸåŸåˆ™ï¼ˆHappens-Beforeï¼‰</code> </strong>ã€‚</p>
<p><strong>Happens-Before</strong> æ˜¯æŒ‡ <strong>å‰é¢ä¸€ä¸ªæ“ä½œçš„ç»“æœå¯¹åç»­æ“ä½œæ˜¯å¯è§çš„</strong>ã€‚</p>
<p><strong>Happens-Before</strong> éå¸¸é‡è¦ï¼Œå®ƒæ˜¯åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ç«äº‰ã€çº¿ç¨‹æ˜¯å¦å®‰å…¨çš„ä¸»è¦ä¾æ®ï¼Œä¾é è¿™ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‡ æ¡è§„åˆ™ä¸€æ½å­åœ°è§£å†³å¹¶å‘ç¯å¢ƒä¸‹ä¸¤ä¸ªæ“ä½œé—´æ˜¯å¦å¯èƒ½å­˜åœ¨å†²çªçš„æ‰€æœ‰é—®é¢˜ã€‚</p>
<ul>
<li><strong>ç¨‹åºæ¬¡åºè§„åˆ™</strong> - ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚</li>
<li><strong>é”å®šè§„åˆ™</strong> - ä¸€ä¸ª  <code>unLock</code>  æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹åŒä¸€ä¸ªé”çš„  <code>lock</code>  æ“ä½œã€‚</li>
<li><strong>volatile å˜é‡è§„åˆ™</strong> - å¯¹ä¸€ä¸ª  <code>volatile</code>  å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚</li>
<li><strong>çº¿ç¨‹å¯åŠ¨è§„åˆ™</strong> -  <code>Thread</code>  å¯¹è±¡çš„  <code>start()</code>  æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸ªä¸€ä¸ªåŠ¨ä½œã€‚</li>
<li><strong>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™</strong> - çº¿ç¨‹ä¸­æ‰€æœ‰çš„æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºçº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡  <code>Thread.join()</code>  æ–¹æ³•ç»“æŸã€ <code>Thread.isAlive()</code>  çš„è¿”å›å€¼æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚</li>
<li><strong>çº¿ç¨‹ä¸­æ–­è§„åˆ™</strong> - å¯¹çº¿ç¨‹  <code>interrupt()</code>  æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡  <code>Thread.interrupted()</code>  æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚</li>
<li><strong>å¯¹è±¡ç»ˆç»“è§„åˆ™</strong> - ä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºå®ƒçš„  <code>finalize()</code>  æ–¹æ³•çš„å¼€å§‹ã€‚</li>
<li><strong>ä¼ é€’æ€§</strong> - å¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ Bï¼Œè€Œæ“ä½œ B åˆ å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ Cï¼Œåˆ™å¯ä»¥å¾—å‡ºæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäº æ“ä½œ Cã€‚</li>
</ul>
<h2 id="-753"><a class="markdownIt-Anchor" href="#-753">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_4-%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C">#</a>4. å†…å­˜å±éšœ</h2>
<p>Java ä¸­å¦‚ä½•ä¿è¯åº•å±‚æ“ä½œçš„æœ‰åºæ€§å’Œå¯è§æ€§ï¼Ÿå¯ä»¥é€šè¿‡å†…å­˜å±éšœï¼ˆmemory barrierï¼‰ã€‚</p>
<p>å†…å­˜å±éšœæ˜¯è¢«æ’å…¥ä¸¤ä¸ª CPU æŒ‡ä»¤ä¹‹é—´çš„ä¸€ç§æŒ‡ä»¤ï¼Œç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŒ‡ä»¤å‘ç”Ÿé‡æ’åºï¼ˆåƒå±éšœä¸€æ ·ï¼‰ï¼Œä»è€Œä¿éšœ<strong>æœ‰åºæ€§</strong>çš„ã€‚å¦å¤–ï¼Œä¸ºäº†è¾¾åˆ°å±éšœçš„æ•ˆæœï¼Œå®ƒä¹Ÿä¼šä½¿å¤„ç†å™¨å†™å…¥ã€è¯»å–å€¼ä¹‹å‰ï¼Œå°†ä¸»å†…å­˜çš„å€¼å†™å…¥é«˜é€Ÿç¼“å­˜ï¼Œæ¸…ç©ºæ— æ•ˆé˜Ÿåˆ—ï¼Œä»è€Œä¿éšœ<strong>å¯è§æ€§</strong>ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Store1;
Store2;
Load1;
StoreLoad;  //å†…å­˜å±éšœ
Store3;
Load2;
Load3;
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¯¹äºä¸Šé¢çš„ä¸€ç»„ CPU æŒ‡ä»¤ï¼ˆStore è¡¨ç¤ºå†™å…¥æŒ‡ä»¤ï¼ŒLoad è¡¨ç¤ºè¯»å–æŒ‡ä»¤ï¼‰ï¼ŒStoreLoad å±éšœä¹‹å‰çš„ Store æŒ‡ä»¤æ— æ³•ä¸ StoreLoad å±éšœä¹‹åçš„ Load æŒ‡ä»¤è¿›è¡Œäº¤æ¢ä½ç½®ï¼Œå³<strong>é‡æ’åº</strong>ã€‚ä½†æ˜¯ StoreLoad å±éšœä¹‹å‰å’Œä¹‹åçš„æŒ‡ä»¤æ˜¯å¯ä»¥äº’æ¢ä½ç½®çš„ï¼Œå³ Store1 å¯ä»¥å’Œ Store2 äº’æ¢ï¼ŒLoad2 å¯ä»¥å’Œ Load3 äº’æ¢ã€‚</p>
<p>å¸¸è§æœ‰ 4 ç§å±éšœ</p>
<ul>
<li><code>LoadLoad</code>  å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥  <code>Load1; LoadLoad; Load2</code> ï¼Œåœ¨ Load2 åŠåç»­è¯»å–æ“ä½œè¦è¯»å–çš„æ•°æ®è¢«è®¿é—®å‰ï¼Œä¿è¯ Load1 è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li>
<li><code>StoreStore</code>  å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥  <code>Store1; StoreStore; Store2</code> ï¼Œåœ¨ Store2 åŠåç»­å†™å…¥æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ Store1 çš„å†™å…¥æ“ä½œå¯¹å…¶å®ƒå¤„ç†å™¨å¯è§ã€‚</li>
<li><code>LoadStore</code>  å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥  <code>Load1; LoadStore; Store2</code> ï¼Œåœ¨ Store2 åŠåç»­å†™å…¥æ“ä½œè¢«æ‰§è¡Œå‰ï¼Œä¿è¯ Load1 è¦è¯»å–çš„æ•°æ®è¢«è¯»å–å®Œæ¯•ã€‚</li>
<li><code>StoreLoad</code>  å±éšœ - å¯¹äºè¿™æ ·çš„è¯­å¥  <code>Store1; StoreLoad; Load2</code> ï¼Œåœ¨ Load2 åŠåç»­æ‰€æœ‰è¯»å–æ“ä½œæ‰§è¡Œå‰ï¼Œä¿è¯ Store1 çš„å†™å…¥å¯¹æ‰€æœ‰å¤„ç†å™¨å¯è§ã€‚å®ƒçš„å¼€é”€æ˜¯å››ç§å±éšœä¸­æœ€å¤§çš„ï¼ˆå†²åˆ·å†™ç¼“å†²å™¨ï¼Œæ¸…ç©ºæ— æ•ˆåŒ–é˜Ÿåˆ—ï¼‰ã€‚åœ¨å¤§å¤šæ•°å¤„ç†å™¨çš„å®ç°ä¸­ï¼Œè¿™ä¸ªå±éšœæ˜¯ä¸ªä¸‡èƒ½å±éšœï¼Œå…¼å…·å…¶å®ƒä¸‰ç§å†…å­˜å±éšœçš„åŠŸèƒ½ã€‚</li>
</ul>
<p>Java ä¸­å¯¹å†…å­˜å±éšœçš„ä½¿ç”¨åœ¨ä¸€èˆ¬çš„ä»£ç ä¸­ä¸å¤ªå®¹æ˜“è§åˆ°ï¼Œå¸¸è§çš„æœ‰  <code>volatile</code>  å’Œ  <code>synchronized</code>  å…³é”®å­—ä¿®é¥°çš„ä»£ç å— (åé¢å†å±•å¼€ä»‹ç»)ï¼Œè¿˜å¯ä»¥é€šè¿‡  <code>Unsafe</code>  è¿™ä¸ªç±»æ¥ä½¿ç”¨å†…å­˜å±éšœã€‚</p>
<h2 id="-754"><a class="markdownIt-Anchor" href="#-754">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_5-volatile">#</a>5. volatile</h2>
<p><code>volatile</code>  æ˜¯ JVM æä¾›çš„ <strong>æœ€è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</strong>ã€‚</p>
<p><code>volatile</code>  çš„ä¸­æ–‡æ„æ€æ˜¯ä¸ç¨³å®šçš„ï¼Œæ˜“å˜çš„ï¼Œç”¨  <code>volatile</code>  ä¿®é¥°å˜é‡æ˜¯ä¸ºäº†ä¿è¯å˜é‡åœ¨å¤šçº¿ç¨‹ä¸­çš„å¯è§æ€§ã€‚</p>
<h4 id="-755"><a class="markdownIt-Anchor" href="#-755">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#volatile-%E5%8F%98%E9%87%8F%E7%9A%84%E7%89%B9%E6%80%A7">#</a>volatile å˜é‡çš„ç‰¹æ€§</h4>
<p><code>volatile</code>  å˜é‡å…·æœ‰ä¸¤ç§ç‰¹æ€§ï¼š</p>
<ul>
<li>ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ã€‚</li>
<li>ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</li>
</ul>
<h5 id="-756"><a class="markdownIt-Anchor" href="#-756">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#%E4%BF%9D%E8%AF%81%E5%8F%98%E9%87%8F%E5%AF%B9%E6%89%80%E6%9C%89%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8F%AF%E8%A7%81%E6%80%A7">#</a>ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§</h5>
<p>è¿™é‡Œçš„å¯è§æ€§æ˜¯æŒ‡å½“ä¸€æ¡çº¿ç¨‹ä¿®æ”¹äº† volatile å˜é‡çš„å€¼ï¼Œæ–°å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯å¯ä»¥ç«‹å³å¾—çŸ¥çš„ã€‚è€Œæ™®é€šå˜é‡ä¸èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ™®é€šå˜é‡çš„å€¼åœ¨çº¿ç¨‹é—´ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p>
<p><strong>çº¿ç¨‹å†™ volatile å˜é‡çš„è¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>æ”¹å˜çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­ volatile å˜é‡å‰¯æœ¬çš„å€¼</li>
<li>å°†æ”¹å˜åçš„å‰¯æœ¬çš„å€¼ä»å·¥ä½œå†…å­˜åˆ·æ–°åˆ°ä¸»å†…å­˜</li>
</ol>
<p><strong>çº¿ç¨‹è¯» volatile å˜é‡çš„è¿‡ç¨‹ï¼š</strong></p>
<ol>
<li>ä»ä¸»å†…å­˜ä¸­è¯»å– volatile å˜é‡çš„æœ€æ–°å€¼åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­</li>
<li>ä»å·¥ä½œå†…å­˜ä¸­è¯»å– volatile å˜é‡çš„å‰¯æœ¬</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼š<strong>ä¿è¯å¯è§æ€§ä¸ç­‰åŒäº volatile å˜é‡ä¿è¯å¹¶å‘æ“ä½œçš„å®‰å…¨æ€§</strong></p>
<p>åœ¨ä¸ç¬¦åˆä»¥ä¸‹ä¸¤ç‚¹çš„åœºæ™¯ä¸­ï¼Œä»ç„¶è¦é€šè¿‡æ·é”æ¥ä¿è¯åŸå­æ€§ï¼š</p>
<ul>
<li>è¿ç®—ç»“æœå¹¶ä¸ä¾èµ–å˜é‡çš„å½“å‰å€¼ï¼Œæˆ–è€…èƒ½å¤Ÿç¡®ä¿åªæœ‰å•ä¸€çš„çº¿ç¨‹ä¿®æ”¹å˜é‡çš„å€¼ã€‚</li>
<li>å˜é‡ä¸éœ€è¦ä¸å…¶ä»–çŠ¶æ€å˜é‡å…±åŒå‚ä¸ä¸å˜çº¦æŸã€‚</li>
</ul>
</blockquote>
<p>ä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æŠŠæ›´æ–°åçš„å˜é‡å€¼åŒæ—¶åˆ·æ–°å›ä¸»å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´å¾—åˆ°çš„å€¼ä¸æ˜¯é¢„æœŸç»“æœï¼š</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š å®šä¹‰  <code>volatile int count = 0</code> ï¼Œ2 ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ count++ æ“ä½œï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œ 500 æ¬¡ï¼Œæœ€ç»ˆç»“æœå°äº 1000ï¼ŒåŸå› æ˜¯æ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ count++ éœ€è¦ä»¥ä¸‹ 3 ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>çº¿ç¨‹ä»ä¸»å†…å­˜è¯»å–æœ€æ–°çš„ count çš„å€¼</li>
<li>æ‰§è¡Œå¼•æ“æŠŠ count å€¼åŠ  1ï¼Œå¹¶èµ‹å€¼ç»™çº¿ç¨‹å·¥ä½œå†…å­˜</li>
<li>çº¿ç¨‹å·¥ä½œå†…å­˜æŠŠ count å€¼ä¿å­˜åˆ°ä¸»å†…å­˜ æœ‰å¯èƒ½æŸä¸€æ—¶åˆ» 2 ä¸ªçº¿ç¨‹åœ¨æ­¥éª¤ 1 è¯»å–åˆ°çš„å€¼éƒ½æ˜¯ 100ï¼Œæ‰§è¡Œå®Œæ­¥éª¤ 2 å¾—åˆ°çš„å€¼éƒ½æ˜¯ 101ï¼Œæœ€ååˆ·æ–°äº† 2 æ¬¡ 101 ä¿å­˜åˆ°ä¸»å†…å­˜ã€‚</li>
</ol>
<h5 id="-757"><a class="markdownIt-Anchor" href="#-757">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#%E8%AF%AD%E4%B9%89-2-%E7%A6%81%E6%AD%A2%E8%BF%9B%E8%A1%8C%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F">#</a>è¯­ä¹‰ 2 ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</h5>
<p>å…·ä½“ä¸€ç‚¹è§£é‡Šï¼Œç¦æ­¢é‡æ’åºçš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å½“ç¨‹åºæ‰§è¡Œåˆ°  <code>volatile</code>  å˜é‡çš„è¯»æ“ä½œæˆ–è€…å†™æ“ä½œæ—¶ï¼Œåœ¨å…¶å‰é¢çš„æ“ä½œçš„æ›´æ”¹è‚¯å®šå…¨éƒ¨å·²ç»è¿›è¡Œï¼Œä¸”ç»“æœå·²ç»å¯¹åé¢çš„æ“ä½œå¯è§ï¼›åœ¨å…¶åé¢çš„æ“ä½œè‚¯å®šè¿˜æ²¡æœ‰è¿›è¡Œï¼›</li>
<li>åœ¨è¿›è¡ŒæŒ‡ä»¤ä¼˜åŒ–æ—¶ï¼Œä¸èƒ½å°†åœ¨å¯¹  <code>volatile</code>  å˜é‡è®¿é—®çš„è¯­å¥æ”¾åœ¨å…¶åé¢æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½æŠŠ  <code>volatile</code>  å˜é‡åé¢çš„è¯­å¥æ”¾åˆ°å…¶å‰é¢æ‰§è¡Œã€‚</li>
</ul>
<p>æ™®é€šçš„å˜é‡ä»…ä»…ä¼šä¿è¯è¯¥æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰ä¾èµ–èµ‹å€¼ç»“æœçš„åœ°æ–¹éƒ½èƒ½è·å–åˆ°æ­£ç¡®çš„ç»“æœï¼Œè€Œä¸èƒ½ä¿è¯èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ç¨‹åºä»£ç ä¸­çš„æ‰§è¡Œé¡ºåºä¸€è‡´ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">volatile</span> <span class="token keyword">boolean</span> initialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">// ä¸‹é¢ä»£ç çº¿ç¨‹Aä¸­æ‰§è¡Œ</span>
<span class="token comment">// è¯»å–é…ç½®ä¿¡æ¯ï¼Œå½“è¯»å–å®Œæˆåå°†initializedè®¾ç½®ä¸ºtrueä»¥é€šçŸ¥å…¶ä»–çº¿ç¨‹é…ç½®å¯ç”¨</span>
<span class="token function">doSomethingReadConfg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
initialized <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token comment">// ä¸‹é¢ä»£ç çº¿ç¨‹Bä¸­æ‰§è¡Œ</span>
<span class="token comment">// ç­‰å¾…initialized ä¸ºtrueï¼Œä»£è¡¨çº¿ç¨‹Aå·²ç»æŠŠé…ç½®ä¿¡æ¯åˆå§‹åŒ–å®Œæˆ</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>initialized<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// ä½¿ç”¨çº¿ç¨‹Aåˆå§‹åŒ–å¥½çš„é…ç½®ä¿¡æ¯</span>
<span class="token function">doSomethingWithConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
å¤åˆ¶ä»£ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šé¢ä»£ç ä¸­å¦‚æœå®šä¹‰ initialized å˜é‡æ—¶æ²¡æœ‰ä½¿ç”¨ volatile ä¿®é¥°ï¼Œå°±æœ‰å¯èƒ½ä¼šç”±äºæŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ï¼Œå¯¼è‡´çº¿ç¨‹ A ä¸­æœ€åä¸€å¥ä»£ç  â€œinitialized = trueâ€ åœ¨ â€œdoSomethingReadConfg ()â€ ä¹‹å‰è¢«æ‰§è¡Œï¼Œè¿™æ ·ä¼šå¯¼è‡´çº¿ç¨‹ B ä¸­ä½¿ç”¨é…ç½®ä¿¡æ¯çš„ä»£ç å°±å¯èƒ½å‡ºç°é”™è¯¯ï¼Œè€Œ volatile å…³é”®å­—å°±ç¦æ­¢é‡æ’åºçš„è¯­ä¹‰å¯ä»¥é¿å…æ­¤ç±»æƒ…å†µå‘ç”Ÿã€‚</p>
<h4 id="-758"><a class="markdownIt-Anchor" href="#-758">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#volatile-%E7%9A%84%E5%8E%9F%E7%90%86">#</a>volatile çš„åŸç†</h4>
<p>å…·ä½“å®ç°æ–¹å¼æ˜¯åœ¨ç¼–è¯‘æœŸç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­å¢åŠ å†…å­˜å±éšœæ¥ä¿è¯ï¼Œä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„ JMM å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š</p>
<ul>
<li>åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚ è¯¥å±éšœé™¤äº†ä¿è¯äº†å±éšœä¹‹å‰çš„å†™æ“ä½œå’Œè¯¥å±éšœä¹‹åçš„å†™æ“ä½œä¸èƒ½é‡æ’åºï¼Œè¿˜ä¼šä¿è¯äº† volatile å†™æ“ä½œä¹‹å‰ï¼Œä»»ä½•çš„è¯»å†™æ“ä½œéƒ½ä¼šå…ˆäº volatile è¢«æäº¤ã€‚</li>
<li>åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ è¯¥å±éšœé™¤äº†ä½¿ volatile å†™æ“ä½œä¸ä¼šä¸ä¹‹åçš„è¯»æ“ä½œé‡æ’åºå¤–ï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿ volatile å˜é‡çš„å†™æ›´æ–°å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚</li>
<li>åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ è¯¥å±éšœé™¤äº†ä½¿ volatile è¯»æ“ä½œä¸ä¼šä¸ä¹‹å‰çš„å†™æ“ä½œå‘ç”Ÿé‡æ’åºå¤–ï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿ volatile å˜é‡è¯»å–çš„ä¸ºæœ€æ–°å€¼ã€‚</li>
<li>åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœã€‚ è¯¥å±éšœé™¤äº†ç¦æ­¢äº† volatile è¯»æ“ä½œä¸å…¶ä¹‹åçš„ä»»ä½•å†™æ“ä½œè¿›è¡Œé‡æ’åºï¼Œè¿˜ä¼šåˆ·æ–°å¤„ç†å™¨ç¼“å­˜ï¼Œä½¿å…¶ä»–çº¿ç¨‹ volatile å˜é‡çš„å†™æ›´æ–°å¯¹ volatile è¯»æ“ä½œçš„çº¿ç¨‹å¯è§ã€‚</li>
</ul>
<h4 id="-759"><a class="markdownIt-Anchor" href="#-759">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#volatile-%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">#</a>volatile çš„ä½¿ç”¨åœºæ™¯</h4>
<p>æ€»ç»“èµ·æ¥ï¼Œå°±æ˜¯ â€œä¸€æ¬¡å†™å…¥ï¼Œåˆ°å¤„è¯»å–â€ï¼ŒæŸä¸€çº¿ç¨‹è´Ÿè´£æ›´æ–°å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹åªè¯»å–å˜é‡ (ä¸æ›´æ–°å˜é‡)ï¼Œå¹¶æ ¹æ®å˜é‡çš„æ–°å€¼æ‰§è¡Œç›¸åº”é€»è¾‘ã€‚ä¾‹å¦‚çŠ¶æ€æ ‡å¿—ä½æ›´æ–°ï¼Œè§‚å¯Ÿè€…æ¨¡å‹å˜é‡å€¼å‘å¸ƒã€‚</p>
<h2 id="-760"><a class="markdownIt-Anchor" href="#-760">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_6-synchronized">#</a>6. synchronized</h2>
<h3 id="-761"><a class="markdownIt-Anchor" href="#-761">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_6-1-long-%E5%92%8C-double-%E5%8F%98%E9%87%8F%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99">#</a>6.1. long å’Œ double å˜é‡çš„ç‰¹æ®Šè§„åˆ™</h3>
<p>JMM è¦æ±‚ lockã€unlockã€readã€loadã€assignã€useã€storeã€write è¿™ 8 ç§æ“ä½œéƒ½å…·æœ‰åŸå­æ€§ï¼Œä½†æ˜¯å¯¹äº 64 ä½çš„æ•°æ®ç±»å‹ï¼ˆlong å’Œ doubleï¼‰ï¼Œåœ¨æ¨¡å‹ä¸­ç‰¹åˆ«å®šä¹‰ç›¸å¯¹å®½æ¾çš„è§„å®šï¼šå…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢«  <code>volatile</code>  ä¿®é¥°çš„ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œåˆ†ä¸º 2 æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³å…è®¸è™šæ‹Ÿæœºå¯é€‰æ‹©ä¸ä¿è¯ 64 ä½æ•°æ®ç±»å‹çš„ loadã€storeã€read å’Œ write è¿™ 4 ä¸ªæ“ä½œçš„åŸå­æ€§ã€‚ç”±äºè¿™ç§éåŸå­æ€§ï¼Œæœ‰å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹è¯»åˆ°åŒæ­¥æœªå®Œæˆçš„ â€œ32 ä½çš„åŠä¸ªå˜é‡â€ çš„å€¼ã€‚</p>
<p>ä¸è¿‡å®é™…å¼€å‘ä¸­ï¼ŒJava å†…å­˜æ¨¡å‹å¼ºçƒˆå»ºè®®è™šæ‹ŸæœºæŠŠ 64 ä½æ•°æ®çš„è¯»å†™å®ç°ä¸ºå…·æœ‰åŸå­æ€§ï¼Œç›®å‰å„ç§å¹³å°ä¸‹çš„å•†ç”¨è™šæ‹Ÿæœºéƒ½é€‰æ‹©æŠŠ 64 ä½æ•°æ®çš„è¯»å†™æ“ä½œä½œä¸ºåŸå­æ“ä½œæ¥å¯¹å¾…ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ä¸€èˆ¬ä¸éœ€è¦æŠŠç”¨åˆ°çš„ long å’Œ double å˜é‡ä¸“é—¨å£°æ˜ä¸º volatileã€‚</p>
<h3 id="-762"><a class="markdownIt-Anchor" href="#-762">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/concurrent/Java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.html#_6-2-final-%E5%9E%8B%E9%87%8F%E7%9A%84%E7%89%B9%E6%AE%8A%E8%A7%84%E5%88%99">#</a>6.2. final å‹é‡çš„ç‰¹æ®Šè§„åˆ™</h3>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œfinal æˆå‘˜å˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–æˆ–è€…åœ¨æ„é€ å™¨ä¸­åˆå§‹åŒ–ï¼Œå¦åˆ™å°±ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚ final å…³é”®å­—çš„å¯è§æ€§æ˜¯æŒ‡ï¼šè¢« final ä¿®é¥°çš„å­—æ®µåœ¨å£°æ˜æ—¶æˆ–è€…æ„é€ å™¨ä¸­ï¼Œä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œé‚£ä¹ˆåœ¨å…¶ä»–çº¿ç¨‹æ— é¡»åŒæ­¥å°±èƒ½æ­£ç¡®çœ‹è§ final å­—æ®µçš„å€¼ã€‚è¿™æ˜¯å› ä¸ºä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œfinal å˜é‡çš„å€¼ç«‹åˆ»å›å†™åˆ°ä¸»å†…å­˜ã€‚</p>
<hr>
<h1 id="vm-ä½“ç³»ç»“æ„"><a class="markdownIt-Anchor" href="#vm-ä½“ç³»ç»“æ„">#</a> VM ä½“ç³»ç»“æ„</h1>
<blockquote>
<p>JVM èƒ½è·¨å¹³å°å·¥ä½œï¼Œä¸»è¦æ˜¯ç”±äº JVM å±è”½äº†ä¸å„ä¸ªè®¡ç®—æœºå¹³å°ç›¸å…³çš„è½¯ä»¶ã€ç¡¬ä»¶ä¹‹é—´çš„å·®å¼‚ã€‚</p>
</blockquote>
<ul>
<li>\1. JVM ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#11-%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84">1.1. è®¡ç®—æœºä½“ç³»ç»“æ„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#12-jvm-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E7%AE%80%E4%BB%8B">1.2. JVM ä½“ç³»ç»“æ„ç®€ä»‹</a></li>
</ul>
</li>
<li>\2. Hotspot æ¶æ„
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#21-hotspot-%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6">2.1. Hotspot å…³é”®ç»„ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#22-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87">2.2. æ€§èƒ½æŒ‡æ ‡</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#3-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">3. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-763"><a class="markdownIt-Anchor" href="#-763">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#_1-jvm-%E7%AE%80%E4%BB%8B">#</a>1. JVM ç®€ä»‹</h2>
<h3 id="-764"><a class="markdownIt-Anchor" href="#-764">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#_1-1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84">#</a>1.1. è®¡ç®—æœºä½“ç³»ç»“æ„</h3>
<p>çœŸå®çš„è®¡ç®—æœºä½“ç³»ç»“æ„çš„æ ¸å¿ƒéƒ¨åˆ†åŒ…å«ï¼š</p>
<ul>
<li>æŒ‡ä»¤é›†</li>
<li>è®¡ç®—å•å…ƒï¼ˆCPUï¼‰</li>
<li>å¯»å€æ–¹å¼</li>
<li>å¯„å­˜å™¨</li>
<li>å­˜å‚¨å•å…ƒ</li>
</ul>
<h3 id="-765"><a class="markdownIt-Anchor" href="#-765">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#_1-2-jvm-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E7%AE%80%E4%BB%8B">#</a>1.2. JVM ä½“ç³»ç»“æ„ç®€ä»‹</h3>
<p>JVM ä½“ç³»ç»“æ„ä¸è®¡ç®—æœºä½“ç³»ç»“æ„ç›¸ä¼¼ï¼Œå®ƒçš„æ ¸å¿ƒéƒ¨åˆ†åŒ…å«ï¼š</p>
<ul>
<li>JVM æŒ‡ä»¤é›†</li>
<li>ç±»åŠ è½½å™¨</li>
<li>æ‰§è¡Œå¼•æ“ - ç›¸å½“äº JVM çš„ CPU</li>
<li>å†…å­˜åŒº - JVM çš„å­˜å‚¨</li>
<li>æœ¬åœ°æ–¹æ³•è°ƒç”¨ - è°ƒç”¨ C/C++ å®ç°çš„æœ¬åœ°æ–¹æ³•</li>
</ul>
<h2 id="-766"><a class="markdownIt-Anchor" href="#-766">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#_2-hotspot-%E6%9E%B6%E6%9E%84">#</a>2. Hotspot æ¶æ„</h2>
<p>Hotspot æ˜¯æœ€æµè¡Œçš„ JVMã€‚</p>
<p>Java è™šæ‹Ÿæœºçš„ä¸»è¦ç»„ä»¶ï¼ŒåŒ…æ‹¬<strong>ç±»åŠ è½½å™¨</strong>ã€<strong>è¿è¡Œæ—¶æ•°æ®åŒº</strong>å’Œ<strong>æ‰§è¡Œå¼•æ“</strong>ã€‚</p>
<p>Hotspot è™šæ‹Ÿæœºæ‹¥æœ‰ä¸€ä¸ªæ¶æ„ï¼Œå®ƒæ”¯æŒå¼ºå¤§ç‰¹æ€§å’Œèƒ½åŠ›çš„åŸºç¡€å¹³å°ï¼Œæ”¯æŒå®ç°é«˜æ€§èƒ½å’Œå¼ºå¤§çš„å¯ä¼¸ç¼©æ€§çš„èƒ½åŠ›ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒHotspot è™šæ‹Ÿæœº JIT ç¼–è¯‘å™¨ç”ŸæˆåŠ¨æ€çš„ä¼˜åŒ–ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒä»¬åœ¨ Java åº”ç”¨æ‰§è¡ŒæœŸåšå‡ºä¼˜åŒ–ï¼Œä¸ºåº•å±‚ç³»ç»Ÿæ¶æ„ç”Ÿæˆé«˜æ€§èƒ½çš„æœ¬åœ°æœºå™¨æŒ‡ä»¤ã€‚å¦å¤–ï¼Œç»è¿‡å®ƒçš„è¿è¡Œæ—¶ç¯å¢ƒå’Œå¤šçº¿ç¨‹åƒåœ¾å›æ”¶æˆç†Ÿçš„è¿›åŒ–å’Œè¿ç»­çš„è®¾è®¡ï¼Œ Hotspot è™šæ‹Ÿæœºåœ¨é«˜å¯ç”¨è®¡ç®—ç³»ç»Ÿä¸Šäº§å‡ºäº†é«˜ä¼¸ç¼©æ€§ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-hotspot-architecture.png" alt="img"></p>
<h3 id="-767"><a class="markdownIt-Anchor" href="#-767">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#_2-1-hotspot-%E5%85%B3%E9%94%AE%E7%BB%84%E4%BB%B6">#</a>2.1. Hotspot å…³é”®ç»„ä»¶</h3>
<p>Java è™šæ‹Ÿæœºæœ‰ä¸‰ä¸ªç»„ä»¶å…³æ³¨ç€ä»€ä¹ˆæ—¶å€™è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œå †ç©ºé—´æ˜¯å¯¹è±¡æ‰€å­˜å‚¨çš„åœ°æ–¹ï¼Œè¿™ä¸ªåŒºåŸŸè¢«å¯åŠ¨æ—¶é€‰æ‹©çš„åƒåœ¾å›æ”¶å™¨ç®¡ç†ï¼Œå¤§éƒ¨åˆ†è°ƒä¼˜é€‰é¡¹ä¸è°ƒæ•´å †å¤§å°å’Œæ ¹æ®ä½ çš„æƒ…å†µé€‰æ‹©æœ€é€‚å½“çš„åƒåœ¾æ”¶é›†å™¨ç›¸å…³ã€‚å³æ—¶ç¼–è¯‘å™¨å¯¹æ€§èƒ½ä¹Ÿæœ‰å¾ˆå¤§çš„å½±å“ï¼Œä½†æ˜¯ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ Java è™šæ‹Ÿæœºæ—¶å¾ˆå°‘éœ€è¦è°ƒæ•´ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-hotspot-key-components.png" alt="img"></p>
<h3 id="-768"><a class="markdownIt-Anchor" href="#-768">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-architecture.html#_2-2-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87">#</a>2.2. æ€§èƒ½æŒ‡æ ‡</h3>
<p>Java è™šæ‹Ÿæœºçš„æ€§èƒ½æŒ‡æ ‡ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p>
<ul>
<li>
<p>åœé¡¿æ—¶é—´</p>
<p>- å“åº”å»¶è¿Ÿæ˜¯æŒ‡ä¸€ä¸ªåº”ç”¨å›åº”ä¸€ä¸ªè¯·æ±‚çš„é€Ÿåº¦æœ‰å¤šå¿«ã€‚å¯¹å…³æ³¨å“åº”èƒ½åŠ›çš„åº”ç”¨æ¥è¯´ï¼Œé•¿æš‚åœæ—¶é—´æ˜¯ä¸å¯æ¥å—çš„ï¼Œé‡ç‚¹æ˜¯åœ¨çŸ­çš„æ—¶é—´å‘¨æœŸå†…èƒ½åšå‡ºå“åº”ã€‚</p>
<ul>
<li>æ¡Œé¢ UI å“åº”äº‹ä»¶çš„é€Ÿåº¦</li>
<li>ç½‘ç«™è¿”å›ç½‘é¡µçš„é€Ÿåº¦</li>
<li>æ•°æ®æŸ¥è¯¢è¿”å›çš„é€Ÿåº¦</li>
</ul>
</li>
<li>
<p>ååé‡</p>
<p>- ååé‡å…³æ³¨åœ¨ç‰¹å®šçš„æ—¶é—´å‘¨æœŸå†…ä¸€ä¸ªåº”ç”¨çš„å·¥ä½œé‡çš„æœ€å¤§å€¼ã€‚å¯¹å…³æ³¨ååé‡çš„åº”ç”¨æ¥è¯´é•¿æš‚åœæ—¶é—´æ˜¯å¯ä»¥æ¥å—çš„ã€‚ç”±äºé«˜ååé‡çš„åº”ç”¨å…³æ³¨çš„åŸºå‡†åœ¨æ›´é•¿å‘¨æœŸæ—¶é—´ä¸Šï¼Œæ‰€ä»¥å¿«é€Ÿå“åº”æ—¶é—´ä¸åœ¨è€ƒè™‘ä¹‹å†…ã€‚</p>
<ul>
<li>ç»™å®šæ—¶é—´å†…å®Œæˆäº‹åŠ¡çš„æ•°é‡</li>
<li>ä¸€å°æ—¶å†…æ‰¹å¤„ç†ç¨‹åºå®Œæˆçš„å·¥ä½œæ•°é‡</li>
<li>ä¸€å°æ—¶å†…æ•°æ®æŸ¥è¯¢å®Œæˆçš„æ•°é‡</li>
</ul>
</li>
</ul>
<hr>
<h1 id="java-å†…å­˜ç®¡ç†"><a class="markdownIt-Anchor" href="#java-å†…å­˜ç®¡ç†">#</a> Java å†…å­˜ç®¡ç†</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. å†…å­˜ç®€ä»‹
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#11-%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E5%92%8C%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98">1.1. ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#12-%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4%E5%92%8C%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4">1.2. å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#13-%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E7%9A%84-java-%E7%BB%84%E4%BB%B6">1.3. ä½¿ç”¨å†…å­˜çš„ Java ç»„ä»¶</a></li>
</ul>
</li>
<li>\2. è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#21-%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8">2.1. ç¨‹åºè®¡æ•°å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#22-java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88">2.2. Java è™šæ‹Ÿæœºæ ˆ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#23-%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88">2.3. æœ¬åœ°æ–¹æ³•æ ˆ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#24-java-%E5%A0%86">2.4. Java å †</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#25-%E6%96%B9%E6%B3%95%E5%8C%BA">2.5. æ–¹æ³•åŒº</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#26-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0">2.6. è¿è¡Œæ—¶å¸¸é‡æ± </a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#27-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98">2.7. ç›´æ¥å†…å­˜</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#28-java-%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%AF%B9%E6%AF%94">2.8. Java å†…å­˜åŒºåŸŸå¯¹æ¯”</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#3-jvm-%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86">3. JVM è¿è¡ŒåŸç†</a></li>
<li>\4. OutOfMemoryError
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#41-%E4%BB%80%E4%B9%88%E6%98%AF-outofmemoryerror">4.1. ä»€ä¹ˆæ˜¯ OutOfMemoryError</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#42-%E5%A0%86%E7%A9%BA%E9%97%B4%E6%BA%A2%E5%87%BA">4.2. å †ç©ºé—´æº¢å‡º</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#43-gc-%E5%BC%80%E9%94%80%E8%B6%85%E8%BF%87%E9%99%90%E5%88%B6">4.3. GC å¼€é”€è¶…è¿‡é™åˆ¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#44-%E6%B0%B8%E4%B9%85%E4%BB%A3%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3">4.4. æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#45-%E5%85%83%E6%95%B0%E6%8D%AE%E5%8C%BA%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3">4.5. å…ƒæ•°æ®åŒºç©ºé—´ä¸è¶³</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#46-%E6%97%A0%E6%B3%95%E6%96%B0%E5%BB%BA%E6%9C%AC%E5%9C%B0%E7%BA%BF%E7%A8%8B">4.6. æ— æ³•æ–°å»ºæœ¬åœ°çº¿ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#47-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA">4.7. ç›´æ¥å†…å­˜æº¢å‡º</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#5-stackoverflowerror">5. StackOverflowError</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#6-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">6. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-769"><a class="markdownIt-Anchor" href="#-769">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_1-%E5%86%85%E5%AD%98%E7%AE%80%E4%BB%8B">#</a>1. å†…å­˜ç®€ä»‹</h2>
<h3 id="-770"><a class="markdownIt-Anchor" href="#-770">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_1-1-%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98%E5%92%8C%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98">#</a>1.1. ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜</h3>
<p>æ‰€è°“ç‰©ç†å†…å­˜å°±æ˜¯é€šå¸¸æ‰€è¯´çš„ RAMï¼ˆéšæœºå­˜å‚¨å™¨ï¼‰ã€‚</p>
<p>è™šæ‹Ÿå†…å­˜ä½¿å¾—å¤šä¸ªè¿›ç¨‹åœ¨åŒæ—¶è¿è¡Œæ—¶å¯ä»¥å…±äº«ç‰©ç†å†…å­˜ï¼Œè¿™é‡Œçš„å…±äº«åªæ˜¯ç©ºé—´ä¸Šå…±äº«ï¼Œåœ¨é€»è¾‘ä¸Šå½¼æ­¤ä»ç„¶æ˜¯éš”ç¦»çš„ã€‚</p>
<h3 id="-771"><a class="markdownIt-Anchor" href="#-771">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_1-2-%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4%E5%92%8C%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4">#</a>1.2. å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´</h3>
<p>ä¸€ä¸ªè®¡ç®—é€šå¸¸æœ‰å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯ç¨‹åºå¹¶ä¸èƒ½ä½¿ç”¨å…¨éƒ¨çš„ç©ºé—´ã€‚å› ä¸ºè¿™äº›ç©ºé—´è¢«åˆ’åˆ†ä¸ºå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ï¼Œè€Œç¨‹åºåªèƒ½ä½¿ç”¨ç”¨æˆ·ç©ºé—´çš„å†…å­˜ã€‚</p>
<h3 id="-772"><a class="markdownIt-Anchor" href="#-772">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_1-3-%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E7%9A%84-java-%E7%BB%84%E4%BB%B6">#</a>1.3. ä½¿ç”¨å†…å­˜çš„ Java ç»„ä»¶</h3>
<p>Java å¯åŠ¨åï¼Œä½œä¸ºä¸€ä¸ªè¿›ç¨‹è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¸­ã€‚</p>
<p>æœ‰å“ªäº› Java ç»„ä»¶éœ€è¦å ç”¨å†…å­˜å‘¢ï¼Ÿ</p>
<ul>
<li>å †å†…å­˜ï¼šJava å †ã€ç±»å’Œç±»åŠ è½½å™¨</li>
<li>æ ˆå†…å­˜ï¼šçº¿ç¨‹</li>
<li>æœ¬åœ°å†…å­˜ï¼šNIOã€JNI</li>
</ul>
<h2 id="-773"><a class="markdownIt-Anchor" href="#-773">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F">#</a>2. è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h2>
<p>JVM åœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚è¿™äº›åŒºåŸŸéƒ½æœ‰å„è‡ªçš„ç”¨é€”ï¼Œä»¥åŠåˆ›å»ºå’Œé”€æ¯çš„æ—¶é—´ï¼Œæœ‰çš„åŒºåŸŸéšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œæœ‰äº›åŒºåŸŸåˆ™ä¾èµ–ç”¨æˆ·çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-memory-runtime-data-area.png" alt="img"></p>
<h3 id="-774"><a class="markdownIt-Anchor" href="#-774">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-1-%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8">#</a>2.1. ç¨‹åºè®¡æ•°å™¨</h3>
<p><strong> <code>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</code> </strong> æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹åšæ˜¯<strong>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</strong>ã€‚ä¾‹å¦‚ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸ã€çº¿ç¨‹æ¢å¤ç­‰éƒ½ä¾èµ–äºè®¡æ•°å™¨ã€‚</p>
<p>å½“æ‰§è¡Œçš„çº¿ç¨‹æ•°é‡è¶…è¿‡ CPU æ•°é‡æ—¶ï¼Œçº¿ç¨‹ä¹‹é—´ä¼šæ ¹æ®æ—¶é—´ç‰‡è½®è¯¢äº‰å¤º CPU èµ„æºã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œæˆ–è€…æ˜¯å…¶å®ƒåŸå› å¯¼è‡´è¿™ä¸ªçº¿ç¨‹çš„ CPU èµ„æºè¢«æå‰æŠ¢å¤ºï¼Œé‚£ä¹ˆè¿™ä¸ªé€€å‡ºçš„çº¿ç¨‹å°±éœ€è¦å•ç‹¬çš„ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ï¼Œæ¥è®°å½•ä¸‹ä¸€æ¡è¿è¡Œçš„æŒ‡ä»¤ï¼Œä»è€Œåœ¨çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ã€‚å„æ¡çº¿ç¨‹é—´çš„è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæˆ‘ä»¬ç§°è¿™ç±»å†…å­˜åŒºåŸŸä¸º â€œçº¿ç¨‹ç§æœ‰â€ çš„å†…å­˜ã€‚</p>
<ul>
<li>å¦‚æœçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ª Java æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼›</li>
<li>å¦‚æœæ­£åœ¨æ‰§è¡Œçš„æ˜¯ Native æ–¹æ³•ï¼Œè¿™ä¸ªè®¡æ•°å™¨å€¼åˆ™ä¸ºç©ºï¼ˆUndefinedï¼‰ã€‚</li>
</ul>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šæ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ JVM ä¸­æ²¡æœ‰è§„å®šä»»ä½•  <code>OutOfMemoryError</code>  æƒ…å†µçš„åŒºåŸŸã€‚</p>
</blockquote>
<h3 id="-775"><a class="markdownIt-Anchor" href="#-775">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-2-java-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88">#</a>2.2. Java è™šæ‹Ÿæœºæ ˆ</h3>
<p><strong> <code>Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰</code> </strong> ä¹Ÿ<strong>æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ</strong>ã€‚</p>
<p>æ¯ä¸ª Java æ–¹æ³•åœ¨æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨ <strong>å±€éƒ¨å˜é‡è¡¨</strong>ã€<strong>æ“ä½œæ•°æ ˆ</strong>ã€<strong>å¸¸é‡æ± å¼•ç”¨</strong> ç­‰ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨ç›´è‡³æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨ Java è™šæ‹Ÿæœºæ ˆä¸­å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-stack.png!w640" alt="img"></p>
<ul>
<li><strong>å±€éƒ¨å˜é‡è¡¨</strong> - 32 ä½å˜é‡æ§½ï¼Œå­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ã€ <code>ReturnAddress</code>  ç±»å‹ã€‚</li>
<li><strong>æ“ä½œæ•°æ ˆ</strong> - åŸºäºæ ˆçš„æ‰§è¡Œå¼•æ“ï¼Œè™šæ‹ŸæœºæŠŠæ“ä½œæ•°æ ˆä½œä¸ºå®ƒçš„å·¥ä½œåŒºï¼Œå¤§å¤šæ•°æŒ‡ä»¤éƒ½è¦ä»è¿™é‡Œå¼¹å‡ºæ•°æ®ã€æ‰§è¡Œè¿ç®—ï¼Œç„¶åæŠŠç»“æœå‹å›æ“ä½œæ•°æ ˆã€‚</li>
<li><strong>åŠ¨æ€é“¾æ¥</strong> - æ¯ä¸ªæ ˆå¸§éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆæ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼‰ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ã€‚æŒæœ‰è¿™ä¸ªå¼•ç”¨æ˜¯ä¸ºäº†æ”¯æŒæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„åŠ¨æ€è¿æ¥ã€‚Class æ–‡ä»¶çš„å¸¸é‡æ± ä¸­æœ‰å¤§é‡çš„ç¬¦å·å¼•ç”¨ï¼Œå­—èŠ‚ç ä¸­çš„æ–¹æ³•è°ƒç”¨æŒ‡ä»¤å°±ä»¥å¸¸é‡æ± ä¸­æŒ‡å‘æ–¹æ³•çš„ç¬¦å·å¼•ç”¨ä¸ºå‚æ•°ã€‚è¿™äº›ç¬¦å·å¼•ç”¨ä¸€éƒ¨åˆ†ä¼šåœ¨ç±»åŠ è½½é˜¶æ®µæˆ–ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™è½¬åŒ–ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ç§è½¬åŒ–ç§°ä¸ºé™æ€è§£æã€‚å¦ä¸€éƒ¨åˆ†å°†åœ¨æ¯ä¸€æ¬¡çš„è¿è¡ŒæœŸé—´è½¬åŒ–ä¸ºç›´æ¥åº”ç”¨ï¼Œè¿™éƒ¨åˆ†ç§°ä¸ºåŠ¨æ€é“¾æ¥ã€‚</li>
<li><strong>æ–¹æ³•å‡ºå£</strong> - è¿”å›æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®ï¼Œæ¢å¤ä¸Šå±‚æ–¹æ³•çš„å±€éƒ¨å˜é‡å’Œæ“ä½œæ•°æ ˆï¼Œå¦‚æœæ— è¿”å›å€¼ï¼Œåˆ™æŠŠå®ƒå‹å…¥è°ƒç”¨è€…çš„æ“ä½œæ•°æ ˆã€‚</li>
</ul>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š</p>
<p>è¯¥åŒºåŸŸå¯èƒ½æŠ›å‡ºä»¥ä¸‹å¼‚å¸¸ï¼š</p>
<ul>
<li>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±ä¼šæŠ›å‡º  <code>StackOverflowError</code>  å¼‚å¸¸ï¼›</li>
<li>å¦‚æœè™šæ‹Ÿæœºæ ˆè¿›è¡ŒåŠ¨æ€æ‰©å±•æ—¶ï¼Œæ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜ï¼Œå°±ä¼šæŠ›å‡º  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</li>
</ul>
<p>ğŸ’¡ æç¤ºï¼š</p>
<p>å¯ä»¥é€šè¿‡  <code>-Xss</code>  è¿™ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªç¨‹åºçš„ Java è™šæ‹Ÿæœºæ ˆå†…å­˜å¤§å°ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">java <span class="token operator">-</span><span class="token class-name">Xss</span><span class="token operator">=</span><span class="token number">512</span>M <span class="token class-name">HackTheJava</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<h3 id="-776"><a class="markdownIt-Anchor" href="#-776">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-3-%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88">#</a>2.3. æœ¬åœ°æ–¹æ³•æ ˆ</h3>
<p><strong> <code>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</code> </strong> ä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨ç›¸ä¼¼ã€‚</p>
<p>äºŒè€…çš„åŒºåˆ«åœ¨äºï¼š<strong>è™šæ‹Ÿæœºæ ˆä¸º Java æ–¹æ³•æœåŠ¡ï¼›æœ¬åœ°æ–¹æ³•æ ˆä¸º Native æ–¹æ³•æœåŠ¡</strong>ã€‚æœ¬åœ°æ–¹æ³•å¹¶ä¸æ˜¯ç”¨ Java å®ç°çš„ï¼Œè€Œæ˜¯ç”± C è¯­è¨€å®ç°çš„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-native-method-stack.gif!w640" alt="img"></p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šæŠ›å‡º  <code>StackOverflowError</code>  å¼‚å¸¸å’Œ  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</p>
</blockquote>
<h3 id="-777"><a class="markdownIt-Anchor" href="#-777">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-4-java-%E5%A0%86">#</a>2.4. Java å †</h3>
<p><strong> <code>Java å †ï¼ˆJava Heapï¼‰</code>  çš„ä½œç”¨å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½æ˜¯åœ¨è¿™é‡Œåˆ†é…å†…å­˜</strong>ã€‚</p>
<p>Java å †æ˜¯åƒåœ¾æ”¶é›†çš„ä¸»è¦åŒºåŸŸï¼ˆå› æ­¤ä¹Ÿè¢«å«åš &quot;GC å †&quot;ï¼‰ã€‚ç°ä»£çš„åƒåœ¾æ”¶é›†å™¨åŸºæœ¬éƒ½æ˜¯é‡‡ç”¨<strong>åˆ†ä»£æ”¶é›†ç®—æ³•</strong>ï¼Œè¯¥ç®—æ³•çš„æ€æƒ³æ˜¯é’ˆå¯¹ä¸åŒçš„å¯¹è±¡é‡‡å–ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ã€‚</p>
<p>å› æ­¤è™šæ‹ŸæœºæŠŠ Java å †åˆ†æˆä»¥ä¸‹ä¸‰å—ï¼š</p>
<ul>
<li><code>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</code>
<ul>
<li><code>Eden</code>  - Eden å’Œ Survivor çš„æ¯”ä¾‹ä¸º 8:1</li>
<li><code>From Survivor</code></li>
<li><code>To Survivor</code></li>
</ul>
</li>
<li><strong> <code>è€å¹´ä»£ï¼ˆOld Generationï¼‰</code> </strong></li>
<li><strong> <code>æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰</code> </strong></li>
</ul>
<p>å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œå®ƒé¦–å…ˆè¿›å…¥æ–°ç”Ÿä»£ï¼Œä¹‹åæœ‰å¯èƒ½è¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­ã€‚æ–°ç”Ÿä»£å­˜æ”¾ç€å¤§é‡çš„ç”Ÿå‘½å¾ˆçŸ­çš„å¯¹è±¡ï¼Œå› æ­¤æ–°ç”Ÿä»£åœ¨ä¸‰ä¸ªåŒºåŸŸä¸­åƒåœ¾å›æ”¶çš„é¢‘ç‡æœ€é«˜ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-heap.gif!w640" alt="img"></p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šJava å †ä¸éœ€è¦è¿ç»­å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•å…¶å†…å­˜ï¼Œæ‰©å±•å¤±è´¥ä¼šæŠ›å‡º  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</p>
<p>ğŸ’¡ æç¤ºï¼šå¯ä»¥é€šè¿‡  <code>-Xms</code>  å’Œ  <code>-Xmx</code>  ä¸¤ä¸ªè™šæ‹Ÿæœºå‚æ•°æ¥æŒ‡å®šä¸€ä¸ªç¨‹åºçš„ Java å †å†…å­˜å¤§å°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æœ€å¤§å€¼ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">java <span class="token operator">-</span><span class="token class-name">Xms</span><span class="token operator">=</span><span class="token number">1</span>M <span class="token operator">-</span><span class="token class-name">Xmx</span><span class="token operator">=</span><span class="token number">2</span>M <span class="token class-name">HackTheJava</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<h3 id="-778"><a class="markdownIt-Anchor" href="#-778">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-5-%E6%96%B9%E6%B3%95%E5%8C%BA">#</a>2.5. æ–¹æ³•åŒº</h3>
<p>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…ä»£ã€‚<strong>æ–¹æ³•åŒºç”¨äºå­˜æ”¾å·²è¢«åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®</strong>ã€‚</p>
<p>å¯¹è¿™å—åŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ï¼Œä½†æ˜¯ä¸€èˆ¬æ¯”è¾ƒéš¾å®ç°ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šå’Œ Java å †ä¸€æ ·ä¸éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€æ‰©å±•ï¼ŒåŠ¨æ€æ‰©å±•å¤±è´¥ä¸€æ ·ä¼šæŠ›å‡º  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</p>
<p>ğŸ’¡ æç¤ºï¼š</p>
<ul>
<li>JDK 1.7 ä¹‹å‰ï¼ŒHotSpot è™šæ‹ŸæœºæŠŠå®ƒå½“æˆæ°¸ä¹…ä»£æ¥è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å¯é€šè¿‡å‚æ•°  <code>-XX:PermSize</code>  å’Œ  <code>-XX:MaxPermSize</code>  è®¾ç½®ã€‚</li>
<li>JDK 1.8 ä¹‹åï¼Œå–æ¶ˆäº†æ°¸ä¹…ä»£ï¼Œç”¨ ** <code>metaspaceï¼ˆå…ƒæ•°æ®ï¼‰</code> ** åŒºæ›¿ä»£ã€‚å¯é€šè¿‡å‚æ•°  <code>-XX:MaxMetaspaceSize</code>  è®¾ç½®ã€‚</li>
</ul>
</blockquote>
<h3 id="-779"><a class="markdownIt-Anchor" href="#-779">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-6-%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0">#</a>2.6. è¿è¡Œæ—¶å¸¸é‡æ± </h3>
<p><strong> <code>è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</code>  æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†</strong>ï¼ŒClass æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼ˆConstant Pool Tableï¼‰ï¼Œ<strong>ç”¨äºå­˜æ”¾ç¼–è¯‘å™¨ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</strong>ï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¼šåœ¨ç±»åŠ è½½åè¢«æ”¾å…¥è¿™ä¸ªåŒºåŸŸã€‚</p>
<ul>
<li><strong>å­—é¢é‡</strong> - æ–‡æœ¬å­—ç¬¦ä¸²ã€å£°æ˜ä¸º  <code>final</code>  çš„å¸¸é‡å€¼ç­‰ã€‚</li>
<li><strong>ç¬¦å·å¼•ç”¨</strong> - ç±»å’Œæ¥å£çš„å®Œå…¨é™å®šåï¼ˆFully Qualified Nameï¼‰ã€å­—æ®µçš„åç§°å’Œæè¿°ç¬¦ï¼ˆDescriptorï¼‰ã€æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦ã€‚</li>
</ul>
<p>é™¤äº†åœ¨ç¼–è¯‘æœŸç”Ÿæˆçš„å¸¸é‡ï¼Œè¿˜å…è®¸åŠ¨æ€ç”Ÿæˆï¼Œä¾‹å¦‚  <code>String</code>  ç±»çš„  <code>intern()</code> ã€‚è¿™éƒ¨åˆ†å¸¸é‡ä¹Ÿä¼šè¢«æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šå½“å¸¸é‡æ± æ— æ³•å†ç”³è¯·åˆ°å†…å­˜æ—¶ä¼šæŠ›å‡º  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</p>
</blockquote>
<h3 id="-780"><a class="markdownIt-Anchor" href="#-780">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-7-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98">#</a>2.7. ç›´æ¥å†…å­˜</h3>
<p>ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ JVM è§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚</p>
<p>åœ¨ JDK 1.4 ä¸­æ–°åŠ å…¥äº† NIO ç±»ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ Native å‡½æ•°åº“ç›´æ¥åˆ†é…å †å¤–å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨ Java å †é‡Œçš„  <code>DirectByteBuffer</code>  å¯¹è±¡ä½œä¸ºè¿™å—å†…å­˜çš„å¼•ç”¨è¿›è¡Œæ“ä½œã€‚è¿™æ ·èƒ½åœ¨ä¸€äº›åœºæ™¯ä¸­æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œå› ä¸ºé¿å…äº†åœ¨ Java å †å’Œ Native å †ä¸­æ¥å›å¤åˆ¶æ•°æ®ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼šç›´æ¥å†…å­˜è¿™éƒ¨åˆ†ä¹Ÿè¢«é¢‘ç¹çš„ä½¿ç”¨ï¼Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´  <code>OutOfMemoryError</code>  å¼‚å¸¸ã€‚</p>
<p>ğŸ’¡ æç¤ºï¼šç›´æ¥å†…å­˜å®¹é‡å¯é€šè¿‡  <code>-XX:MaxDirectMemorySize</code>  æŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸ Java å †æœ€å¤§å€¼ï¼ˆ <code>-Xmx</code>  æŒ‡å®šï¼‰ä¸€æ ·ã€‚</p>
</blockquote>
<h3 id="-781"><a class="markdownIt-Anchor" href="#-781">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_2-8-java-%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%AF%B9%E6%AF%94">#</a>2.8. Java å†…å­˜åŒºåŸŸå¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>å†…å­˜åŒºåŸŸ</th>
<th>å†…å­˜ä½œç”¨èŒƒå›´</th>
<th>å¼‚å¸¸</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç¨‹åºè®¡æ•°å™¨</td>
<td>çº¿ç¨‹ç§æœ‰</td>
<td>æ— </td>
</tr>
<tr>
<td>Java è™šæ‹Ÿæœºæ ˆ</td>
<td>çº¿ç¨‹ç§æœ‰</td>
<td><code>StackOverflowError</code>  å’Œ  <code>OutOfMemoryError</code></td>
</tr>
<tr>
<td>æœ¬åœ°æ–¹æ³•æ ˆ</td>
<td>çº¿ç¨‹ç§æœ‰</td>
<td><code>StackOverflowError</code>  å’Œ  <code>OutOfMemoryError</code></td>
</tr>
<tr>
<td>Java å †</td>
<td>çº¿ç¨‹å…±äº«</td>
<td><code>OutOfMemoryError</code></td>
</tr>
<tr>
<td>æ–¹æ³•åŒº</td>
<td>çº¿ç¨‹å…±äº«</td>
<td><code>OutOfMemoryError</code></td>
</tr>
<tr>
<td>è¿è¡Œæ—¶å¸¸é‡æ± </td>
<td>çº¿ç¨‹å…±äº«</td>
<td><code>OutOfMemoryError</code></td>
</tr>
<tr>
<td>ç›´æ¥å†…å­˜</td>
<td>éè¿è¡Œæ—¶æ•°æ®åŒº</td>
<td><code>OutOfMemoryError</code></td>
</tr>
</tbody>
</table>
<h2 id="-782"><a class="markdownIt-Anchor" href="#-782">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_3-jvm-%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86">#</a>3. JVM è¿è¡ŒåŸç†</h2>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JVMCase</span> <span class="token punctuation">&#123;</span>

	<span class="token comment">// å¸¸é‡</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> MAN_SEX_TYPE <span class="token operator">=</span> <span class="token string">"man"</span><span class="token punctuation">;</span>

	<span class="token comment">// é™æ€å˜é‡</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> WOMAN_SEX_TYPE <span class="token operator">=</span> <span class="token string">"woman"</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

		<span class="token class-name">Student</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		stu<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"nick"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		stu<span class="token punctuation">.</span><span class="token function">setSexType</span><span class="token punctuation">(</span>MAN_SEX_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		stu<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">JVMCase</span> jvmcase <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JVMCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// è°ƒç”¨é™æ€æ–¹æ³•</span>
		<span class="token function">print</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// è°ƒç”¨éé™æ€æ–¹æ³•</span>
		jvmcase<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>


	<span class="token comment">// å¸¸è§„é™æ€æ–¹æ³•</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name: "</span> <span class="token operator">+</span> stu<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"; sex:"</span> <span class="token operator">+</span> stu<span class="token punctuation">.</span><span class="token function">getSexType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"; age:"</span> <span class="token operator">+</span> stu<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>


	<span class="token comment">// éé™æ€æ–¹æ³•</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">Student</span> stu<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stu<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"say: hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">&#123;</span>
	<span class="token class-name">String</span> name<span class="token punctuation">;</span>
	<span class="token class-name">String</span> sexType<span class="token punctuation">;</span>
	<span class="token keyword">int</span> age<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getSexType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> sexType<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSexType</span><span class="token punctuation">(</span><span class="token class-name">String</span> sexType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>sexType <span class="token operator">=</span> sexType<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> age<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¿è¡Œä»¥ä¸Šä»£ç æ—¶ï¼ŒJVM å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰JVM å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼ŒJVM ç¬¬ä¸€æ­¥å°±æ˜¯é€šè¿‡é…ç½®å‚æ•°æˆ–è€…é»˜è®¤é…ç½®å‚æ•°å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ç©ºé—´ï¼Œæ ¹æ®å†…å­˜å¤§å°æ‰¾åˆ°å…·ä½“çš„å†…å­˜åˆ†é…è¡¨ï¼Œç„¶åæŠŠå†…å­˜æ®µçš„èµ·å§‹åœ°å€å’Œç»ˆæ­¢åœ°å€åˆ†é…ç»™ JVMï¼Œæ¥ä¸‹æ¥ JVM å°±è¿›è¡Œå†…éƒ¨åˆ†é…ã€‚</p>
<p>ï¼ˆ2ï¼‰JVM è·å¾—å†…å­˜ç©ºé—´åï¼Œä¼šæ ¹æ®é…ç½®å‚æ•°åˆ†é…å †ã€æ ˆä»¥åŠæ–¹æ³•åŒºçš„å†…å­˜å¤§å°ã€‚</p>
<p>ï¼ˆ3ï¼‰class æ–‡ä»¶åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ä»¥åŠè§£æï¼Œå…¶ä¸­å‡†å¤‡é˜¶æ®µä¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œåˆå§‹åŒ–ä¸ºç³»ç»Ÿçš„åˆå§‹å€¼ï¼ˆè¿™éƒ¨åˆ†æˆ‘åœ¨ç¬¬ 21 è®²è¿˜ä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200630094250.png" alt="img"></p>
<p>ï¼ˆ4ï¼‰å®Œæˆä¸Šä¸€ä¸ªæ­¥éª¤åï¼Œå°†ä¼šè¿›è¡Œæœ€åä¸€ä¸ªåˆå§‹åŒ–é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µä¸­ï¼ŒJVM é¦–å…ˆä¼šæ‰§è¡Œæ„é€ å™¨  <code>&lt;clinit&gt;</code>  æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šåœ¨  <code>.java</code>  æ–‡ä»¶è¢«ç¼–è¯‘æˆ  <code>.class</code>  æ–‡ä»¶æ—¶ï¼Œæ”¶é›†æ‰€æœ‰ç±»çš„åˆå§‹åŒ–ä»£ç ï¼ŒåŒ…æ‹¬é™æ€å˜é‡èµ‹å€¼è¯­å¥ã€é™æ€ä»£ç å—ã€é™æ€æ–¹æ³•ï¼Œæ”¶é›†åœ¨ä¸€èµ·æˆä¸º  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200630094329.png" alt="img"></p>
<p>ï¼ˆ5ï¼‰æ‰§è¡Œæ–¹æ³•ã€‚å¯åŠ¨ main çº¿ç¨‹ï¼Œæ‰§è¡Œ main æ–¹æ³•ï¼Œå¼€å§‹æ‰§è¡Œç¬¬ä¸€è¡Œä»£ç ã€‚æ­¤æ—¶å †å†…å­˜ä¸­ä¼šåˆ›å»ºä¸€ä¸ª student å¯¹è±¡ï¼Œå¯¹è±¡å¼•ç”¨ student å°±å­˜æ”¾åœ¨æ ˆä¸­ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200630094651.png" alt="img"></p>
<p>ï¼ˆ6ï¼‰æ­¤æ—¶å†æ¬¡åˆ›å»ºä¸€ä¸ª JVMCase å¯¹è±¡ï¼Œè°ƒç”¨ sayHello éé™æ€æ–¹æ³•ï¼ŒsayHello æ–¹æ³•å±äºå¯¹è±¡ JVMCaseï¼Œæ­¤æ—¶ sayHello æ–¹æ³•å…¥æ ˆï¼Œå¹¶é€šè¿‡æ ˆä¸­çš„ student å¼•ç”¨è°ƒç”¨å †ä¸­çš„ Student å¯¹è±¡ï¼›ä¹‹åï¼Œè°ƒç”¨é™æ€æ–¹æ³• printï¼Œprint é™æ€æ–¹æ³•å±äº JVMCase ç±»ï¼Œæ˜¯ä»é™æ€æ–¹æ³•ä¸­è·å–ï¼Œä¹‹åæ”¾å…¥åˆ°æ ˆä¸­ï¼Œä¹Ÿæ˜¯é€šè¿‡ student å¼•ç”¨è°ƒç”¨å †ä¸­çš„ student å¯¹è±¡ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200630094714.png" alt="img"></p>
<h2 id="-783"><a class="markdownIt-Anchor" href="#-783">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-outofmemoryerror">#</a>4. OutOfMemoryError</h2>
<h3 id="-784"><a class="markdownIt-Anchor" href="#-784">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-1-%E4%BB%80%E4%B9%88%E6%98%AF-outofmemoryerror">#</a>4.1. ä»€ä¹ˆæ˜¯ OutOfMemoryError</h3>
<p><code>OutOfMemoryError</code>  ç®€ç§°ä¸º OOMã€‚Java ä¸­å¯¹ OOM çš„è§£é‡Šæ˜¯ï¼Œæ²¡æœ‰ç©ºé—²å†…å­˜ï¼Œå¹¶ä¸”åƒåœ¾æ”¶é›†å™¨ä¹Ÿæ— æ³•æä¾›æ›´å¤šå†…å­˜ã€‚é€šä¿—çš„è§£é‡Šæ˜¯ï¼šJVM å†…å­˜ä¸è¶³äº†ã€‚</p>
<p>åœ¨ JVM è§„èŒƒä¸­ï¼Œ<strong>é™¤äº†ç¨‹åºè®¡æ•°å™¨åŒºåŸŸå¤–ï¼Œå…¶ä»–è¿è¡Œæ—¶åŒºåŸŸéƒ½å¯èƒ½å‘ç”Ÿ  <code>OutOfMemoryError</code>  å¼‚å¸¸ï¼ˆç®€ç§° OOMï¼‰</strong>ã€‚</p>
<p>ä¸‹é¢é€ä¸€ä»‹ç» OOM å‘ç”Ÿåœºæ™¯ã€‚</p>
<h3 id="-785"><a class="markdownIt-Anchor" href="#-785">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-2-%E5%A0%86%E7%A9%BA%E9%97%B4%E6%BA%A2%E5%87%BA">#</a>4.2. å †ç©ºé—´æº¢å‡º</h3>
<p><code>java.lang.OutOfMemoryError: Java heap space</code>  è¿™ä¸ªé”™è¯¯æ„å‘³ç€ï¼š<strong>å †ç©ºé—´æº¢å‡º</strong>ã€‚</p>
<p>æ›´ç»†è‡´çš„è¯´æ³•æ˜¯ï¼šJava å †å†…å­˜å·²ç»è¾¾åˆ°  <code>-Xmx</code>  è®¾ç½®çš„æœ€å¤§å€¼ã€‚Java å †ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹ï¼Œåªè¦ä¸æ–­åœ°åˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”ä¿è¯ GC Roots åˆ°å¯¹è±¡ä¹‹é—´æœ‰å¯è¾¾è·¯å¾„æ¥é¿å…åƒåœ¾æ”¶é›†å™¨å›æ”¶è¿™äº›å¯¹è±¡ï¼Œé‚£ä¹ˆå½“å †ç©ºé—´åˆ°è¾¾æœ€å¤§å®¹é‡é™åˆ¶åå°±ä¼šäº§ç”Ÿ OOMã€‚</p>
<p>å †ç©ºé—´æº¢å‡ºæœ‰å¯èƒ½æ˜¯ ** <code>å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰</code> ** æˆ– <strong> <code>å†…å­˜æº¢å‡ºï¼ˆMemory Overflowï¼‰</code> </strong> ã€‚éœ€è¦ä½¿ç”¨ jstack å’Œ jmap ç”Ÿæˆ threaddump å’Œ heapdumpï¼Œç„¶åç”¨å†…å­˜åˆ†æå·¥å…·ï¼ˆå¦‚ï¼šMATï¼‰è¿›è¡Œåˆ†æã€‚</p>
<h4 id="-786"><a class="markdownIt-Anchor" href="#-786">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#java-heap-space-%E5%88%86%E6%9E%90%E6%AD%A5%E9%AA%A4">#</a>Java heap space åˆ†ææ­¥éª¤</h4>
<ol>
<li>ä½¿ç”¨  <code>jmap</code>  æˆ–  <code>-XX:+HeapDumpOnOutOfMemoryError</code>  è·å–å †å¿«ç…§ã€‚</li>
<li>ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·ï¼ˆvisualvmã€matã€jProfile ç­‰ï¼‰å¯¹å †å¿«ç…§æ–‡ä»¶è¿›è¡Œåˆ†æã€‚</li>
<li>æ ¹æ®åˆ†æå›¾ï¼Œé‡ç‚¹æ˜¯ç¡®è®¤å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦æ˜¯å¿…è¦çš„ï¼Œåˆ†æ¸…ç©¶ç«Ÿæ˜¯æ˜¯å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰è¿˜æ˜¯å†…å­˜æº¢å‡ºï¼ˆMemory Overflowï¼‰ã€‚</li>
</ol>
<h4 id="-787"><a class="markdownIt-Anchor" href="#-787">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F">#</a>å†…å­˜æ³„æ¼</h4>
<p><strong>å†…å­˜æ³„æ¼æ˜¯æŒ‡ç”±äºç–å¿½æˆ–é”™è¯¯é€ æˆç¨‹åºæœªèƒ½é‡Šæ”¾å·²ç»ä¸å†ä½¿ç”¨çš„å†…å­˜çš„æƒ…å†µ</strong>ã€‚</p>
<p>å†…å­˜æ³„æ¼å¹¶éæŒ‡å†…å­˜åœ¨ç‰©ç†ä¸Šçš„æ¶ˆå¤±ï¼Œè€Œæ˜¯åº”ç”¨ç¨‹åºåˆ†é…æŸæ®µå†…å­˜åï¼Œç”±äºè®¾è®¡é”™è¯¯ï¼Œå¤±å»äº†å¯¹è¯¥æ®µå†…å­˜çš„æ§åˆ¶ï¼Œå› è€Œé€ æˆäº†å†…å­˜çš„æµªè´¹ã€‚å†…å­˜æ³„æ¼éšç€è¢«æ‰§è¡Œçš„æ¬¡æ•°ä¸æ–­å¢åŠ ï¼Œæœ€ç»ˆä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚</p>
<p>å†…å­˜æ³„æ¼å¸¸è§åœºæ™¯ï¼š</p>
<ul>
<li>é™æ€å®¹å™¨
<ul>
<li>å£°æ˜ä¸ºé™æ€ï¼ˆ <code>static</code> ï¼‰çš„  <code>HashMap</code> ã€ <code>Vector</code>  ç­‰é›†åˆ</li>
<li>é€šä¿—æ¥è®² A ä¸­æœ‰ Bï¼Œå½“å‰åªæŠŠ B è®¾ç½®ä¸ºç©ºï¼ŒA æ²¡æœ‰è®¾ç½®ä¸ºç©ºï¼Œå›æ”¶æ—¶ B æ— æ³•å›æ”¶ã€‚å› ä¸ºè¢« A å¼•ç”¨ã€‚</li>
</ul>
</li>
<li>ç›‘å¬å™¨
<ul>
<li>ç›‘å¬å™¨è¢«æ³¨å†Œåé‡Šæ”¾å¯¹è±¡æ—¶æ²¡æœ‰åˆ é™¤ç›‘å¬å™¨</li>
</ul>
</li>
<li>ç‰©ç†è¿æ¥
<ul>
<li>å„ç§è¿æ¥æ± å»ºç«‹äº†è¿æ¥ï¼Œå¿…é¡»é€šè¿‡  <code>close()</code>  å…³é—­é“¾æ¥</li>
</ul>
</li>
<li>å†…éƒ¨ç±»å’Œå¤–éƒ¨æ¨¡å—ç­‰çš„å¼•ç”¨
<ul>
<li>å‘ç°å®ƒçš„æ–¹å¼åŒå†…å­˜æº¢å‡ºï¼Œå¯å†åŠ ä¸ªå®æ—¶è§‚å¯Ÿ</li>
<li><code>jstat -gcutil 7362 2500 70</code></li>
</ul>
</li>
</ul>
<p>é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li><code>FGC</code>  â€” ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å‘ç”Ÿ Full GC çš„æ¬¡æ•°ã€‚</li>
<li><code>FGCT</code>  â€” ä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ Full GC æ‰€ç”¨çš„æ—¶é—´ï¼ˆå•ä½ç§’ï¼‰ã€‚</li>
<li><code>FGC</code>  æ¬¡æ•°è¶Šå¤šï¼Œ <code>FGCT</code>  æ‰€éœ€æ—¶é—´è¶Šå¤šï¼Œè¶Šæœ‰å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ã€‚</li>
</ul>
<p>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œå¯ä»¥è¿›ä¸€æ­¥æŸ¥çœ‹æ³„æ¼å¯¹è±¡åˆ° GC Roots çš„å¯¹è±¡å¼•ç”¨é“¾ã€‚è¿™æ ·å°±èƒ½æ‰¾åˆ°æ³„æ¼å¯¹è±¡æ˜¯æ€æ ·ä¸ GC Roots å…³è”å¹¶å¯¼è‡´ GC æ— æ³•å›æ”¶å®ƒä»¬çš„ã€‚æŒæ¡äº†è¿™äº›åŸå› ï¼Œå°±å¯ä»¥è¾ƒå‡†ç¡®çš„å®šä½å‡ºå¼•èµ·å†…å­˜æ³„æ¼çš„ä»£ç ã€‚</p>
<p>å¯¼è‡´å†…å­˜æ³„æ¼çš„å¸¸è§åŸå› æ˜¯ä½¿ç”¨å®¹å™¨ï¼Œä¸”ä¸æ–­å‘å®¹å™¨ä¸­æ·»åŠ å…ƒç´ ï¼Œä½†æ²¡æœ‰æ¸…ç†ï¼Œå¯¼è‡´å®¹å™¨å†…å­˜ä¸æ–­è†¨èƒ€ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * å†…å­˜æ³„æ¼ç¤ºä¾‹
 * é”™è¯¯ç°è±¡ï¼šjava.lang.OutOfMemoryError: Java heap space
 * VM Argsï¼š-verbose:gc -Xms10M -Xmx10M -XX:+HeapDumpOnOutOfMemoryError
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOutOfMemoryDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OomObject</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OomObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OomObject</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-788"><a class="markdownIt-Anchor" href="#-788">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA">#</a>å†…å­˜æº¢å‡º</h4>
<p>å¦‚æœä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œå³å†…å­˜ä¸­çš„å¯¹è±¡ç¡®å®éƒ½å¿…é¡»å­˜æ´»ç€ï¼Œåˆ™åº”å½“æ£€æŸ¥è™šæ‹Ÿæœºçš„å †å‚æ•°ï¼ˆ <code>-Xmx</code>  å’Œ  <code>-Xms</code> ï¼‰ï¼Œä¸æœºå™¨ç‰©ç†å†…å­˜è¿›è¡Œå¯¹æ¯”ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥è°ƒå¤§ã€‚å¹¶ä»ä»£ç ä¸Šæ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸäº›å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¿‡é•¿ã€æŒæœ‰æ—¶é—´è¿‡é•¿çš„æƒ…å†µï¼Œå°è¯•å‡å°‘ç¨‹åºè¿è¡ŒæœŸçš„å†…å­˜æ¶ˆè€—ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * å †æº¢å‡ºç¤ºä¾‹
 * &lt;p>
 * é”™è¯¯ç°è±¡ï¼šjava.lang.OutOfMemoryError: Java heap space
 * &lt;p>
 * VM Argsï¼š-verbose:gc -Xms10M -Xmx10M
 *
 * @author &lt;a href="mailto:forbreak@163.com">Zhang Peng&lt;/a>
 * @since 2019-06-25
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOutOfMemoryDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Double</span><span class="token punctuation">[</span><span class="token number">999999999</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"array length = ["</span> <span class="token operator">+</span> array<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>æ‰§è¡Œ  <code>java -verbose:gc -Xms10M -Xmx10M -XX:+HeapDumpOnOutOfMemoryError io.github.dunwu.javacore.jvm.memory.HeapMemoryLeakMemoryErrorDemo</code></p>
<p>ä¸Šé¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œè¯•å›¾åˆ›å»ºä¸€ä¸ªç»´åº¦å¾ˆå¤§çš„æ•°ç»„ï¼Œå †å†…å­˜æ— æ³•åˆ†é…è¿™ä¹ˆå¤§çš„å†…å­˜ï¼Œä»è€ŒæŠ¥é”™ï¼š <code>Java heap space</code> ã€‚</p>
<p>ä½†å¦‚æœåœ¨ç°å®ä¸­ï¼Œä»£ç å¹¶æ²¡æœ‰é—®é¢˜ï¼Œä»…ä»…æ˜¯å› ä¸ºå †å†…å­˜ä¸è¶³ï¼Œå¯ä»¥é€šè¿‡  <code>-Xms</code>  å’Œ  <code>-Xmx</code>  é€‚å½“è°ƒæ•´å †å†…å­˜å¤§å°ã€‚</p>
<h3 id="-789"><a class="markdownIt-Anchor" href="#-789">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-3-gc-%E5%BC%80%E9%94%80%E8%B6%85%E8%BF%87%E9%99%90%E5%88%B6">#</a>4.3. GC å¼€é”€è¶…è¿‡é™åˆ¶</h3>
<p><code>java.lang.OutOfMemoryError: GC overhead limit exceeded</code>  è¿™ä¸ªé”™è¯¯ï¼Œå®˜æ–¹ç»™å‡ºçš„å®šä¹‰æ˜¯ï¼š<strong>è¶…è¿‡  <code>98%</code>  çš„æ—¶é—´ç”¨æ¥åš GC å¹¶ä¸”å›æ”¶äº†ä¸åˆ°  <code>2%</code>  çš„å †å†…å­˜æ—¶ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå‘ç”Ÿåœ¨ GC å ç”¨å¤§é‡æ—¶é—´ä¸ºé‡Šæ”¾å¾ˆå°ç©ºé—´çš„æ—¶å€™å‘ç”Ÿçš„ï¼Œæ˜¯ä¸€ç§ä¿æŠ¤æœºåˆ¶ã€‚å¯¼è‡´å¼‚å¸¸çš„åŸå› ï¼šä¸€èˆ¬æ˜¯å› ä¸ºå †å¤ªå°ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * GC overhead limit exceeded ç¤ºä¾‹
 * é”™è¯¯ç°è±¡ï¼šjava.lang.OutOfMemoryError: GC overhead limit exceeded
 * å‘ç”Ÿåœ¨GCå ç”¨å¤§é‡æ—¶é—´ä¸ºé‡Šæ”¾å¾ˆå°ç©ºé—´çš„æ—¶å€™å‘ç”Ÿçš„ï¼Œæ˜¯ä¸€ç§ä¿æŠ¤æœºåˆ¶ã€‚å¯¼è‡´å¼‚å¸¸çš„åŸå› ï¼šä¸€èˆ¬æ˜¯å› ä¸ºå †å¤ªå°ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ã€‚
 * å®˜æ–¹å¯¹æ­¤çš„å®šä¹‰ï¼šè¶…è¿‡98%çš„æ—¶é—´ç”¨æ¥åšGCå¹¶ä¸”å›æ”¶äº†ä¸åˆ°2%çš„å †å†…å­˜æ—¶ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚
 * VM Args: -Xms10M -Xmx10M
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GcOverheadLimitExceededDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Double</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> d <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>d<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€å¤„ç†ã€‘</p>
<p>ä¸ <strong>Java heap space</strong> é”™è¯¯å¤„ç†æ–¹æ³•ç±»ä¼¼ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ã€‚å¦‚æœæœ‰ï¼Œåˆ™ä¿®æ­£ä»£ç ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™é€šè¿‡  <code>-Xms</code>  å’Œ  <code>-Xmx</code>  é€‚å½“è°ƒæ•´å †å†…å­˜å¤§å°ã€‚</p>
<h3 id="-790"><a class="markdownIt-Anchor" href="#-790">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-4-%E6%B0%B8%E4%B9%85%E4%BB%A3%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3">#</a>4.4. æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</h3>
<p>ã€é”™è¯¯ã€‘</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">java.lang.OutOfMemoryError: PermGen space<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ã€åŸå› ã€‘</p>
<p>Perm ï¼ˆæ°¸ä¹…ä»£ï¼‰ç©ºé—´ä¸»è¦ç”¨äºå­˜æ”¾  <code>Class</code>  å’Œ Meta ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»çš„åç§°å’Œå­—æ®µï¼Œå¸¦æœ‰æ–¹æ³•å­—èŠ‚ç çš„æ–¹æ³•ï¼Œå¸¸é‡æ± ä¿¡æ¯ï¼Œä¸ç±»å…³è”çš„å¯¹è±¡æ•°ç»„å’Œç±»å‹æ•°ç»„ä»¥åŠå³æ—¶ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚GC åœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸé—´ä¸ä¼šå¯¹æ°¸ä¹…ä»£ç©ºé—´è¿›è¡Œæ¸…ç†ï¼Œé»˜è®¤æ˜¯ 64M å¤§å°ã€‚</p>
<p>æ ¹æ®ä¸Šé¢çš„å®šä¹‰ï¼Œå¯ä»¥å¾—å‡º <strong>PermGen å¤§å°è¦æ±‚å–å†³äºåŠ è½½çš„ç±»çš„æ•°é‡ä»¥åŠæ­¤ç±»å£°æ˜çš„å¤§å°</strong>ã€‚å› æ­¤ï¼Œå¯ä»¥è¯´é€ æˆè¯¥é”™è¯¯çš„ä¸»è¦åŸå› æ˜¯æ°¸ä¹…ä»£ä¸­è£…å…¥äº†å¤ªå¤šçš„ç±»æˆ–å¤ªå¤§çš„ç±»ã€‚</p>
<p>åœ¨ JDK8 ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥é€šè¿‡  <code>-XX:PermSize</code>  å’Œ  <code>-XX:MaxPermSize</code>  è®¾ç½®æ°¸ä¹…ä»£ç©ºé—´å¤§å°ï¼Œä»è€Œé™åˆ¶æ–¹æ³•åŒºå¤§å°ï¼Œå¹¶é—´æ¥é™åˆ¶å…¶ä¸­å¸¸é‡æ± çš„å®¹é‡ã€‚</p>
<h4 id="-791"><a class="markdownIt-Anchor" href="#-791">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E6%B0%B8%E4%B9%85%E4%BB%A3%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3">#</a>åˆå§‹åŒ–æ—¶æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</h4>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * æ°¸ä¹…ä»£å†…å­˜ç©ºé—´ä¸è¶³ç¤ºä¾‹
 * &lt;p>
 * é”™è¯¯ç°è±¡ï¼š
 * &lt;ul>
 * &lt;li>java.lang.OutOfMemoryError: PermGen space (JDK8 ä»¥å‰ç‰ˆæœ¬)&lt;/li>
 * &lt;li>java.lang.OutOfMemoryError: Metaspace (JDK8 åŠä»¥åç‰ˆæœ¬)&lt;/li>
 * &lt;/ul>
 * VM Args:
 * &lt;ul>
 * &lt;li>-Xmx100M -XX:MaxPermSize=16M (JDK8 ä»¥å‰ç‰ˆæœ¬)&lt;/li>
 * &lt;li>-Xmx100M -XX:MaxMetaspaceSize=16M (JDK8 åŠä»¥åç‰ˆæœ¬)&lt;/li>
 * &lt;/ul>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermOutOfMemoryErrorDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100_000_000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">generate</span><span class="token punctuation">(</span><span class="token string">"eu.plumbr.demo.Generated"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Class</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ClassPool</span> pool <span class="token operator">=</span> <span class="token class-name">ClassPool</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pool<span class="token punctuation">.</span><span class="token function">makeClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæºä»£ç éå†å¾ªç¯å¹¶åœ¨è¿è¡Œæ—¶ç”Ÿæˆç±»ã€‚javassist åº“æ­£åœ¨å¤„ç†ç±»ç”Ÿæˆçš„å¤æ‚æ€§ã€‚</p>
<h4 id="-792"><a class="markdownIt-Anchor" href="#-792">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#%E9%87%8D%E9%83%A8%E7%BD%B2%E6%97%B6%E6%B0%B8%E4%B9%85%E4%BB%A3%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3">#</a>é‡éƒ¨ç½²æ—¶æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</h4>
<p>å¯¹äºæ›´å¤æ‚ï¼Œæ›´å®é™…çš„ç¤ºä¾‹ï¼Œè®©æˆ‘ä»¬é€æ­¥ä»‹ç»ä¸€ä¸‹åœ¨åº”ç”¨ç¨‹åºé‡æ–°éƒ¨ç½²æœŸé—´å‘ç”Ÿçš„ Permgen ç©ºé—´é”™è¯¯ã€‚é‡æ–°éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ å¸Œæœ›åƒåœ¾å›æ”¶ä¼šæ‘†è„±å¼•ç”¨æ‰€æœ‰å…ˆå‰åŠ è½½çš„ç±»çš„åŠ è½½å™¨ï¼Œå¹¶è¢«åŠ è½½æ–°ç±»çš„ç±»åŠ è½½å™¨å–ä»£ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè®¸å¤šç¬¬ä¸‰æ–¹åº“ä»¥åŠå¯¹çº¿ç¨‹ï¼ŒJDBC é©±åŠ¨ç¨‹åºæˆ–æ–‡ä»¶ç³»ç»Ÿå¥æŸ„ç­‰èµ„æºçš„ä¸è‰¯å¤„ç†ä½¿å¾—æ— æ³•å¸è½½ä»¥å‰ä½¿ç”¨çš„ç±»åŠ è½½å™¨ã€‚åè¿‡æ¥ï¼Œè¿™æ„å‘³ç€åœ¨æ¯æ¬¡é‡æ–°éƒ¨ç½²æœŸé—´ï¼Œæ‰€æœ‰å…ˆå‰ç‰ˆæœ¬çš„ç±»ä»å°†é©»ç•™åœ¨ PermGen ä¸­ï¼Œä»è€Œåœ¨æ¯æ¬¡é‡æ–°éƒ¨ç½²æœŸé—´ç”Ÿæˆæ•°åå…†çš„åƒåœ¾ã€‚</p>
<p>è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªä½¿ç”¨ JDBC é©±åŠ¨ç¨‹åºè¿æ¥åˆ°å…³ç³»æ•°æ®åº“çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œåˆå§‹åŒ–ä»£ç å°†åŠ è½½ JDBC é©±åŠ¨ç¨‹åºä»¥è¿æ¥åˆ°æ•°æ®åº“ã€‚å¯¹åº”äºè§„èŒƒï¼ŒJDBC é©±åŠ¨ç¨‹åºå‘ java.sql.DriverManager è¿›è¡Œæ³¨å†Œã€‚è¯¥æ³¨å†ŒåŒ…æ‹¬å°†å¯¹é©±åŠ¨ç¨‹åºå®ä¾‹çš„å¼•ç”¨å­˜å‚¨åœ¨ DriverManager çš„é™æ€å­—æ®µä¸­ã€‚</p>
<p>ç°åœ¨ï¼Œå½“ä»åº”ç”¨ç¨‹åºæœåŠ¡å™¨å–æ¶ˆéƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œjava.sql.DriverManager ä»å°†ä¿ç•™è¯¥å¼•ç”¨ã€‚æˆ‘ä»¬æœ€ç»ˆè·å¾—äº†å¯¹é©±åŠ¨ç¨‹åºç±»çš„å®æ—¶å¼•ç”¨ï¼Œè€Œé©±åŠ¨ç¨‹åºç±»åˆä¿ç•™äº†ç”¨äºåŠ è½½åº”ç”¨ç¨‹åºçš„ java.lang.Classloader å®ä¾‹çš„å¼•ç”¨ã€‚åè¿‡æ¥ï¼Œè¿™æ„å‘³ç€åƒåœ¾å›æ”¶ç®—æ³•æ— æ³•å›æ”¶ç©ºé—´ã€‚</p>
<p>è€Œä¸”è¯¥ java.lang.ClassLoader å®ä¾‹ä»å¼•ç”¨åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ç±»ï¼Œé€šå¸¸åœ¨ PermGen ä¸­å æ®æ•°åå…†å­—èŠ‚ã€‚è¿™æ„å‘³ç€åªéœ€å°‘é‡é‡æ–°éƒ¨ç½²å³å¯å¡«å……é€šå¸¸å¤§å°çš„ PermGenã€‚</p>
<h4 id="-793"><a class="markdownIt-Anchor" href="#-793">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#permgen-space-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">#</a>PermGen space è§£å†³æ–¹æ¡ˆ</h4>
<p>ï¼ˆ1ï¼‰è§£å†³åˆå§‹åŒ–æ—¶çš„  <code>OutOfMemoryError</code></p>
<p>åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æœŸé—´è§¦å‘ç”±äº PermGen è€—å°½å¯¼è‡´çš„  <code>OutOfMemoryError</code>  æ—¶ï¼Œè§£å†³æ–¹æ¡ˆå¾ˆç®€å•ã€‚è¯¥åº”ç”¨ç¨‹åºä»…éœ€è¦æ›´å¤šç©ºé—´æ‰èƒ½å°†æ‰€æœ‰ç±»åŠ è½½åˆ° PermGen åŒºåŸŸï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å¢åŠ å…¶å¤§å°å³å¯ã€‚ä¸ºæ­¤ï¼Œæ›´æ”¹ä½ çš„åº”ç”¨ç¨‹åºå¯åŠ¨é…ç½®å¹¶æ·»åŠ ï¼ˆæˆ–å¢åŠ ï¼Œå¦‚æœå­˜åœ¨ï¼‰ <code>-XX:MaxPermSize</code>  å‚æ•°ï¼Œç±»ä¼¼äºä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">java -XX:MaxPermSize=512m com.yourcompany.YourClass<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸Šé¢çš„é…ç½®å°†å‘Šè¯‰ JVMï¼ŒPermGen å¯ä»¥å¢é•¿åˆ° 512MBã€‚</p>
<p>æ¸…ç†åº”ç”¨ç¨‹åºä¸­  <code>WEB-INF/lib</code>  ä¸‹çš„ jarï¼Œç”¨ä¸ä¸Šçš„ jar åˆ é™¤æ‰ï¼Œå¤šä¸ªåº”ç”¨å…¬å…±çš„ jar ç§»åŠ¨åˆ° Tomcat çš„ lib ç›®å½•ï¼Œå‡å°‘é‡å¤åŠ è½½ã€‚</p>
<p>ğŸ”” æ³¨æ„ï¼š <code>-XX:PermSize</code>  ä¸€èˆ¬è®¾ä¸º 64M</p>
<p>ï¼ˆ2ï¼‰è§£å†³é‡æ–°éƒ¨ç½²æ—¶çš„  <code>OutOfMemoryError</code></p>
<p>é‡æ–°éƒ¨ç½²åº”ç”¨ç¨‹åºåç«‹å³å‘ç”Ÿ OutOfMemoryError æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šé­å—ç±»åŠ è½½å™¨æ³„æ¼çš„å›°æ‰°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè§£å†³é—®é¢˜çš„æœ€ç®€å•ï¼Œç»§ç»­è¿›è¡Œå †è½¬å‚¨åˆ†æâ€“ä½¿ç”¨ç±»ä¼¼äºä»¥ä¸‹å‘½ä»¤çš„é‡æ–°éƒ¨ç½²åè¿›è¡Œå †è½¬å‚¨ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">jmap -dump:format=b,file=dump.hprof &lt;process-id><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç„¶åä½¿ç”¨ä½ æœ€å–œæ¬¢çš„å †è½¬å‚¨åˆ†æå™¨æ‰“å¼€è½¬å‚¨ï¼ˆEclipse MAT æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼‰ã€‚åœ¨åˆ†æå™¨ä¸­å¯ä»¥æŸ¥æ‰¾é‡å¤çš„ç±»ï¼Œå°¤å…¶æ˜¯é‚£äº›æ­£åœ¨åŠ è½½åº”ç”¨ç¨‹åºç±»çš„ç±»ã€‚ä»é‚£é‡Œï¼Œä½ éœ€è¦è¿›è¡Œæ‰€æœ‰ç±»åŠ è½½å™¨çš„æŸ¥æ‰¾ï¼Œä»¥æ‰¾åˆ°å½“å‰æ´»åŠ¨çš„ç±»åŠ è½½å™¨ã€‚</p>
<p>å¯¹äºéæ´»åŠ¨ç±»åŠ è½½å™¨ï¼Œä½ éœ€è¦é€šè¿‡ä»éæ´»åŠ¨ç±»åŠ è½½å™¨æ”¶é›†åˆ° GC æ ¹çš„æœ€çŸ­è·¯å¾„æ¥ç¡®å®šé˜»æ­¢å®ƒä»¬è¢«åƒåœ¾æ”¶é›†çš„å¼•ç”¨ã€‚æœ‰äº†æ­¤ä¿¡æ¯ï¼Œä½ å°†æ‰¾åˆ°æ ¹æœ¬åŸå› ã€‚å¦‚æœæ ¹æœ¬åŸå› æ˜¯åœ¨ç¬¬ä¸‰æ–¹åº“ä¸­ï¼Œåˆ™å¯ä»¥è¿›å…¥ Google/StackOverflow æŸ¥çœ‹æ˜¯å¦æ˜¯å·²çŸ¥é—®é¢˜ä»¥è·å–è¡¥ä¸ / è§£å†³æ–¹æ³•ã€‚</p>
<p>ï¼ˆ3ï¼‰è§£å†³è¿è¡Œæ—¶  <code>OutOfMemoryError</code></p>
<p>ç¬¬ä¸€æ­¥æ˜¯æ£€æŸ¥æ˜¯å¦å…è®¸ GC ä» PermGen å¸è½½ç±»ã€‚åœ¨è¿™æ–¹é¢ï¼Œæ ‡å‡†çš„ JVM ç›¸å½“ä¿å®ˆ - ç±»æ˜¯å¤©ç”Ÿçš„ã€‚å› æ­¤ï¼Œä¸€æ—¦åŠ è½½ï¼Œå³ä½¿æ²¡æœ‰ä»£ç åœ¨ä½¿ç”¨å®ƒä»¬ï¼Œç±»ä¹Ÿä¼šä¿ç•™åœ¨å†…å­˜ä¸­ã€‚å½“åº”ç”¨ç¨‹åºåŠ¨æ€åˆ›å»ºè®¸å¤šç±»å¹¶ä¸”é•¿æ—¶é—´ä¸éœ€è¦ç”Ÿæˆçš„ç±»æ—¶ï¼Œè¿™å¯èƒ½ä¼šæˆä¸ºé—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…è®¸ JVM å¸è½½ç±»å®šä¹‰å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨å¯åŠ¨è„šæœ¬ä¸­ä»…æ·»åŠ ä¸€ä¸ªé…ç½®å‚æ•°æ¥å®ç°ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-XX:+CMSClassUnloadingEnabled<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤é€‰é¡¹è®¾ç½®ä¸º falseï¼Œå› æ­¤è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œä½ éœ€è¦åœ¨ Java é€‰é¡¹ä¸­æ˜¾å¼è®¾ç½®ã€‚å¦‚æœå¯ç”¨ CMSClassUnloadingEnabledï¼ŒGC ä¹Ÿä¼šæ‰«æ PermGen å¹¶åˆ é™¤ä¸å†ä½¿ç”¨çš„ç±»ã€‚è¯·è®°ä½ï¼Œåªæœ‰åŒæ—¶ä½¿ç”¨ UseConcMarkSweepGC æ—¶æ­¤é€‰é¡¹æ‰èµ·ä½œç”¨ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-XX:+UseConcMarkSweepGC<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>åœ¨ç¡®ä¿å¯ä»¥å¸è½½ç±»å¹¶ä¸”é—®é¢˜ä»ç„¶å­˜åœ¨ä¹‹åï¼Œä½ åº”è¯¥ç»§ç»­è¿›è¡Œå †è½¬å‚¨åˆ†æâ€“ä½¿ç”¨ç±»ä¼¼äºä»¥ä¸‹å‘½ä»¤çš„æ–¹æ³•è¿›è¡Œå †è½¬å‚¨ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">jmap -dump:file=dump.hprof,format=b &lt;process-id><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ç„¶åï¼Œä½¿ç”¨ä½ æœ€å–œæ¬¢çš„å †è½¬å‚¨åˆ†æå™¨ï¼ˆä¾‹å¦‚ Eclipse MATï¼‰æ‰“å¼€è½¬å‚¨ï¼Œç„¶åæ ¹æ®å·²åŠ è½½çš„ç±»æ•°æŸ¥æ‰¾æœ€æ˜‚è´µçš„ç±»åŠ è½½å™¨ã€‚ä»æ­¤ç±»åŠ è½½å™¨ä¸­ï¼Œä½ å¯ä»¥ç»§ç»­æå–å·²åŠ è½½çš„ç±»ï¼Œå¹¶æŒ‰å®ä¾‹å¯¹æ­¤ç±»è¿›è¡Œæ’åºï¼Œä»¥ä½¿å¯ç–‘å¯¹è±¡æ’åœ¨é¦–ä½ã€‚</p>
<p>ç„¶åï¼Œå¯¹äºæ¯ä¸ªå¯ç–‘è€…ï¼Œå°±éœ€è¦ä½ æ‰‹åŠ¨å°†æ ¹æœ¬åŸå› è¿½æº¯åˆ°ç”Ÿæˆæ­¤ç±»çš„åº”ç”¨ç¨‹åºä»£ç ã€‚</p>
<h3 id="-794"><a class="markdownIt-Anchor" href="#-794">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-5-%E5%85%83%E6%95%B0%E6%8D%AE%E5%8C%BA%E7%A9%BA%E9%97%B4%E4%B8%8D%E8%B6%B3">#</a>4.5. å…ƒæ•°æ®åŒºç©ºé—´ä¸è¶³</h3>
<p>ã€é”™è¯¯ã€‘</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Exception in thread "main" java.lang.OutOfMemoryError: Metaspace<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ã€åŸå› ã€‘</p>
<p>Java8 ä»¥åï¼ŒJVM å†…å­˜ç©ºé—´å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ã€‚å–æ¶ˆäº†æ°¸ä¹…ä»£ï¼Œè½¬è€Œå˜ä¸ºå…ƒæ•°æ®åŒºã€‚</p>
<p><strong>å…ƒæ•°æ®åŒºçš„å†…å­˜ä¸è¶³ï¼Œå³æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± çš„ç©ºé—´ä¸è¶³</strong>ã€‚</p>
<p>æ–¹æ³•åŒºç”¨äºå­˜æ”¾ Class çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç±»åã€è®¿é—®ä¿®é¥°ç¬¦ã€å¸¸é‡æ± ã€å­—æ®µæè¿°ã€æ–¹æ³•æè¿°ç­‰ã€‚</p>
<p>ä¸€ä¸ªç±»è¦è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼Œåˆ¤å®šæ¡ä»¶æ˜¯æ¯”è¾ƒè‹›åˆ»çš„ã€‚åœ¨ç»å¸¸åŠ¨æ€ç”Ÿæˆå¤§é‡ Class çš„åº”ç”¨ä¸­ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ç±»çš„å›æ”¶çŠ¶å†µã€‚è¿™ç±»å¸¸è§é™¤äº† CGLib å­—èŠ‚ç å¢å¼ºå’ŒåŠ¨æ€è¯­è¨€ä»¥å¤–ï¼Œå¸¸è§çš„è¿˜æœ‰ï¼šå¤§é‡ JSP æˆ–åŠ¨æ€äº§ç”Ÿ JSP æ–‡ä»¶çš„åº”ç”¨ï¼ˆJSP ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶éœ€è¦ç¼–è¯‘ä¸º Java ç±»ï¼‰ã€åŸºäº OSGi çš„åº”ç”¨ï¼ˆå³ä½¿æ˜¯åŒä¸€ä¸ªç±»æ–‡ä»¶ï¼Œè¢«ä¸åŒçš„åŠ è½½å™¨åŠ è½½ä¹Ÿä¼šè§†ä¸ºä¸åŒçš„ç±»ï¼‰ç­‰ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ–¹æ³•åŒºå‡ºç°  <code>OutOfMemoryError</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodAreaOutOfMemoryDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">Bean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">setUseCache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> proxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Bean</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è§£å†³ã€‘</p>
<p>å½“ç”±äºå…ƒç©ºé—´è€Œé¢ä¸´  <code>OutOfMemoryError</code>  æ—¶ï¼Œç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚å¦‚æœåº”ç”¨ç¨‹åºè€—å°½äº†å†…å­˜ä¸­çš„ Metaspace åŒºåŸŸï¼Œåˆ™åº”å¢åŠ  Metaspace çš„å¤§å°ã€‚æ›´æ”¹åº”ç”¨ç¨‹åºå¯åŠ¨é…ç½®å¹¶å¢åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-XX:MaxMetaspaceSize=512m<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸Šé¢çš„é…ç½®ç¤ºä¾‹å‘Šè¯‰ JVMï¼Œå…è®¸ Metaspace å¢é•¿åˆ° 512 MBã€‚</p>
<p>å¦ä¸€ç§è§£å†³æ–¹æ¡ˆç”šè‡³æ›´ç®€å•ã€‚ä½ å¯ä»¥é€šè¿‡åˆ é™¤æ­¤å‚æ•°æ¥å®Œå…¨è§£é™¤å¯¹ Metaspace å¤§å°çš„é™åˆ¶ï¼ŒJVM é»˜è®¤å¯¹ Metaspace çš„å¤§å°æ²¡æœ‰é™åˆ¶ã€‚ä½†æ˜¯è¯·æ³¨æ„ä»¥ä¸‹äº‹å®ï¼šè¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´å¤§é‡äº¤æ¢æˆ–è¾¾åˆ°æœ¬æœºç‰©ç†å†…å­˜è€Œåˆ†é…å¤±è´¥ã€‚</p>
<h3 id="-795"><a class="markdownIt-Anchor" href="#-795">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-6-%E6%97%A0%E6%B3%95%E6%96%B0%E5%BB%BA%E6%9C%AC%E5%9C%B0%E7%BA%BF%E7%A8%8B">#</a>4.6. æ— æ³•æ–°å»ºæœ¬åœ°çº¿ç¨‹</h3>
<p><code>java.lang.OutOfMemoryError: Unable to create new native thread</code>  è¿™ä¸ªé”™è¯¯æ„å‘³ç€ï¼š<strong>Java åº”ç”¨ç¨‹åºå·²è¾¾åˆ°å…¶å¯ä»¥å¯åŠ¨çº¿ç¨‹æ•°çš„é™åˆ¶</strong>ã€‚</p>
<p>ã€åŸå› ã€‘</p>
<p>å½“å‘èµ·ä¸€ä¸ªçº¿ç¨‹çš„åˆ›å»ºæ—¶ï¼Œè™šæ‹Ÿæœºä¼šåœ¨ JVM å†…å­˜åˆ›å»ºä¸€ä¸ª  <code>Thread</code>  å¯¹è±¡åŒæ—¶åˆ›å»ºä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œè€Œè¿™ä¸ªç³»ç»Ÿçº¿ç¨‹çš„å†…å­˜ç”¨çš„ä¸æ˜¯ JVM å†…å­˜ï¼Œè€Œæ˜¯ç³»ç»Ÿä¸­å‰©ä¸‹çš„å†…å­˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œç©¶ç«Ÿèƒ½åˆ›å»ºå¤šå°‘çº¿ç¨‹å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªå…¬å¼ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">çº¿ç¨‹æ•° = (MaxProcessMemory - JVMMemory - ReservedOsMemory) / (ThreadStackSize)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ã€å‚æ•°ã€‘</p>
<ul>
<li><code>MaxProcessMemory</code>  - ä¸€ä¸ªè¿›ç¨‹çš„æœ€å¤§å†…å­˜</li>
<li><code>JVMMemory</code>  - JVM å†…å­˜</li>
<li><code>ReservedOsMemory</code>  - ä¿ç•™çš„æ“ä½œç³»ç»Ÿå†…å­˜</li>
<li><code>ThreadStackSize</code>  - çº¿ç¨‹æ ˆçš„å¤§å°</li>
</ul>
<p><strong>ç»™ JVM åˆ†é…çš„å†…å­˜è¶Šå¤šï¼Œé‚£ä¹ˆèƒ½ç”¨æ¥åˆ›å»ºç³»ç»Ÿçº¿ç¨‹çš„å†…å­˜å°±ä¼šè¶Šå°‘ï¼Œè¶Šå®¹æ˜“å‘ç”Ÿ  <code>unable to create new native thread</code> </strong>ã€‚æ‰€ä»¥ï¼ŒJVM å†…å­˜ä¸æ˜¯åˆ†é…çš„è¶Šå¤§è¶Šå¥½ã€‚</p>
<p>ä½†æ˜¯ï¼Œé€šå¸¸å¯¼è‡´  <code>java.lang.OutOfMemoryError</code>  çš„æƒ…å†µï¼šæ— æ³•åˆ›å»ºæ–°çš„æœ¬æœºçº¿ç¨‹éœ€è¦ç»å†ä»¥ä¸‹é˜¶æ®µï¼š</p>
<ol>
<li>JVM å†…éƒ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºè¯·æ±‚æ–°çš„ Java çº¿ç¨‹</li>
<li>JVM æœ¬æœºä»£ç ä»£ç†ä¸ºæ“ä½œç³»ç»Ÿåˆ›å»ºæ–°æœ¬æœºçº¿ç¨‹çš„è¯·æ±‚</li>
<li>æ“ä½œç³»ç»Ÿå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„æœ¬æœºçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹éœ€è¦å°†å†…å­˜åˆ†é…ç»™è¯¥çº¿ç¨‹</li>
<li>æ“ä½œç³»ç»Ÿå°†æ‹’ç»æœ¬æœºå†…å­˜åˆ†é…ï¼ŒåŸå› æ˜¯ 32 ä½ Java è¿›ç¨‹å¤§å°å·²è€—å°½å…¶å†…å­˜åœ°å€ç©ºé—´ï¼ˆä¾‹å¦‚ï¼Œå·²è¾¾åˆ°ï¼ˆ2-4ï¼‰GB è¿›ç¨‹å¤§å°é™åˆ¶ï¼‰æˆ–æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜å·²å®Œå…¨è€—å°½</li>
<li>å¼•å‘  <code>java.lang.OutOfMemoryError: Unable to create new native thread</code>  é”™è¯¯ã€‚</li>
</ol>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnableCreateNativeThreadErrorDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MINUTES<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€å¤„ç†ã€‘</p>
<p>å¯ä»¥é€šè¿‡å¢åŠ æ“ä½œç³»ç»Ÿçº§åˆ«çš„é™åˆ¶æ¥ç»•è¿‡æ— æ³•åˆ›å»ºæ–°çš„æœ¬æœºçº¿ç¨‹é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé™åˆ¶äº† JVM å¯åœ¨ç”¨æˆ·ç©ºé—´ä¸­äº§ç”Ÿçš„è¿›ç¨‹æ•°ï¼Œåˆ™åº”æ£€æŸ¥å‡ºå¹¶å¯èƒ½å¢åŠ è¯¥é™åˆ¶ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@dev ~<span class="token punctuation">]</span><span class="token comment"># ulimit -a</span>
core <span class="token function">file</span> size          <span class="token punctuation">(</span>blocks, -c<span class="token punctuation">)</span> <span class="token number">0</span>
--- <span class="token function">cut</span> <span class="token keyword">for</span> brevity ---
max user processes              <span class="token punctuation">(</span>-u<span class="token punctuation">)</span> <span class="token number">1800</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>é€šå¸¸ï¼Œ <code>OutOfMemoryError</code>  å¯¹æ–°çš„æœ¬æœºçº¿ç¨‹çš„é™åˆ¶è¡¨ç¤ºç¼–ç¨‹é”™è¯¯ã€‚å½“åº”ç”¨ç¨‹åºäº§ç”Ÿæ•°åƒä¸ªçº¿ç¨‹æ—¶ï¼Œå¾ˆå¯èƒ½å‡ºäº†ä¸€äº›é—®é¢˜ â€” å¾ˆå°‘æœ‰åº”ç”¨ç¨‹åºå¯ä»¥ä»å¦‚æ­¤å¤§é‡çš„çº¿ç¨‹ä¸­å—ç›Šã€‚</p>
<p>è§£å†³é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯å¼€å§‹è¿›è¡Œçº¿ç¨‹è½¬å‚¨ä»¥äº†è§£æƒ…å†µã€‚</p>
<h3 id="-796"><a class="markdownIt-Anchor" href="#-796">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_4-7-%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98%E6%BA%A2%E5%87%BA">#</a>4.7. ç›´æ¥å†…å­˜æº¢å‡º</h3>
<p>ç”±ç›´æ¥å†…å­˜å¯¼è‡´çš„å†…å­˜æº¢å‡ºï¼Œä¸€ä¸ªæ˜æ˜¾çš„ç‰¹å¾æ˜¯åœ¨ Head Dump æ–‡ä»¶ä¸­ä¸ä¼šçœ‹è§æ˜æ˜¾çš„å¼‚å¸¸ï¼Œå¦‚æœå‘ç° OOM ä¹‹å Dump æ–‡ä»¶å¾ˆå°ï¼Œè€Œç¨‹åºä¸­åˆç›´æ¥æˆ–é—´æ¥ä½¿ç”¨äº† NIOï¼Œå°±å¯ä»¥è€ƒè™‘æ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯è¿™æ–¹é¢çš„åŸå› ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ç›´æ¥å†…å­˜  <code>OutOfMemoryError</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * æœ¬æœºç›´æ¥å†…å­˜æº¢å‡ºç¤ºä¾‹
 * é”™è¯¯ç°è±¡ï¼šjava.lang.OutOfMemoryError
 * VM Argsï¼š-Xmx20M -XX:MaxDirectMemorySize=10M
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DirectOutOfMemoryDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Field</span> unsafeField <span class="token operator">=</span> <span class="token class-name">Unsafe</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        unsafeField<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Unsafe</span> unsafe <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Unsafe</span><span class="token punctuation">)</span> unsafeField<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            unsafe<span class="token punctuation">.</span><span class="token function">allocateMemory</span><span class="token punctuation">(</span>_1MB<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-797"><a class="markdownIt-Anchor" href="#-797">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#_5-stackoverflowerror">#</a>5. StackOverflowError</h2>
<p>å¯¹äº HotSpot è™šæ‹Ÿæœºæ¥è¯´ï¼Œæ ˆå®¹é‡åªç”±  <code>-Xss</code>  å‚æ•°æ¥å†³å®šå¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œå°†æŠ›å‡º  <code>StackOverflowError</code>  å¼‚å¸¸ã€‚</p>
<p>ä»å®æˆ˜æ¥è¯´ï¼Œæ ˆæº¢å‡ºçš„å¸¸è§åŸå› ï¼š</p>
<ul>
<li><strong>é€’å½’å‡½æ•°è°ƒç”¨å±‚æ•°å¤ªæ·±</strong></li>
<li><strong>å¤§é‡å¾ªç¯æˆ–æ­»å¾ªç¯</strong></li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘é€’å½’å‡½æ•°è°ƒç”¨å±‚æ•°å¤ªæ·±å¯¼è‡´  <code>StackOverflowError</code></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackOverflowDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> stackLength <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">recursion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        stackLength<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">recursion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">StackOverflowDemo</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StackOverflowDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            obj<span class="token punctuation">.</span><span class="token function">recursion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ ˆæ·±åº¦ï¼š"</span> <span class="token operator">+</span> obj<span class="token punctuation">.</span>stackLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="jvm-åƒåœ¾æ”¶é›†"><a class="markdownIt-Anchor" href="#jvm-åƒåœ¾æ”¶é›†">#</a> JVM åƒåœ¾æ”¶é›†</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<blockquote>
<p>ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆè¿™ä¸‰ä¸ªåŒºåŸŸå±äºçº¿ç¨‹ç§æœ‰çš„ï¼Œåªå­˜åœ¨äºçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œçº¿ç¨‹ç»“æŸä¹‹åä¹Ÿä¼šæ¶ˆå¤±ï¼Œå› æ­¤ä¸éœ€è¦å¯¹è¿™ä¸‰ä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ã€‚<strong>åƒåœ¾å›æ”¶ä¸»è¦æ˜¯é’ˆå¯¹ Java å †å’Œæ–¹æ³•åŒºè¿›è¡Œ</strong>ã€‚</p>
</blockquote>
<ul>
<li>\1. å¯¹è±¡æ´»ç€å—
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#11-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%AE%97%E6%B3%95">1.1. å¼•ç”¨è®¡æ•°ç®—æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#12-%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95">1.2. å¯è¾¾æ€§åˆ†æç®—æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#13-%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B">1.3. å¼•ç”¨ç±»å‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#14-%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9B%9E%E6%94%B6">1.4. æ–¹æ³•åŒºçš„å›æ”¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#15-finalize">1.5. finalize()</a></li>
</ul>
</li>
<li>\2. åƒåœ¾æ”¶é›†ç®—æ³•
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#21-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E6%80%A7%E8%83%BD">2.1. åƒåœ¾æ”¶é›†æ€§èƒ½</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#22-%E6%A0%87%E8%AE%B0---%E6%B8%85%E9%99%A4mark-sweep">2.2. æ ‡è®° - æ¸…é™¤ï¼ˆMark-Sweepï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#23-%E6%A0%87%E8%AE%B0---%E6%95%B4%E7%90%86mark-compact">2.3. æ ‡è®° - æ•´ç†ï¼ˆMark-Compactï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#24-%E5%A4%8D%E5%88%B6copying">2.4. å¤åˆ¶ï¼ˆCopyingï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#25-%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86">2.5. åˆ†ä»£æ”¶é›†</a></li>
</ul>
</li>
<li>\3. åƒåœ¾æ”¶é›†å™¨
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#31-%E4%B8%B2%E8%A1%8C%E6%94%B6%E9%9B%86%E5%99%A8">3.1. ä¸²è¡Œæ”¶é›†å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#32-%E5%B9%B6%E8%A1%8C%E6%94%B6%E9%9B%86%E5%99%A8">3.2. å¹¶è¡Œæ”¶é›†å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#33-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E6%94%B6%E9%9B%86%E5%99%A8">3.3. å¹¶å‘æ ‡è®°æ¸…é™¤æ”¶é›†å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#34-g1-%E6%94%B6%E9%9B%86%E5%99%A8">3.4. G1 æ”¶é›†å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#35-%E6%80%BB%E7%BB%93">3.5. æ€»ç»“</a></li>
</ul>
</li>
<li>\4. å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#41-minor-gc">4.1. Minor GC</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#42-full-gc">4.2. Full GC</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-798"><a class="markdownIt-Anchor" href="#-798">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_1-%E5%AF%B9%E8%B1%A1%E6%B4%BB%E7%9D%80%E5%90%97">#</a>1. å¯¹è±¡æ´»ç€å—</h2>
<h3 id="-799"><a class="markdownIt-Anchor" href="#-799">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_1-1-%E5%BC%95%E7%94%A8%E8%AE%A1%E6%95%B0%E7%AE%97%E6%B3%95">#</a>1.1. å¼•ç”¨è®¡æ•°ç®—æ³•</h3>
<p>ç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡å¢åŠ ä¸€ä¸ªå¼•ç”¨æ—¶è®¡æ•°å™¨åŠ  1ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶è®¡æ•°å™¨å‡ 1ã€‚å¼•ç”¨è®¡æ•°ä¸º 0 çš„å¯¹è±¡å¯è¢«å›æ”¶ã€‚</p>
<p>ä¸¤ä¸ªå¯¹è±¡å‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µä¸‹ï¼Œæ­¤æ—¶å¼•ç”¨è®¡æ•°å™¨æ°¸è¿œä¸ä¸º 0ï¼Œå¯¼è‡´æ— æ³•å¯¹å®ƒä»¬è¿›è¡Œå›æ”¶ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceCountingGC</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ReferenceCountingGC</span> objectA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ReferenceCountingGC</span> objectB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectA<span class="token punctuation">.</span>instance <span class="token operator">=</span> objectB<span class="token punctuation">;</span>
        objectB<span class="token punctuation">.</span>instance <span class="token operator">=</span> objectA<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å› ä¸ºå¾ªç¯å¼•ç”¨çš„å­˜åœ¨ï¼Œæ‰€ä»¥ <strong>Java è™šæ‹Ÿæœºä¸é€‚ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•</strong>ã€‚</p>
<h3 id="-800"><a class="markdownIt-Anchor" href="#-800">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_1-2-%E5%8F%AF%E8%BE%BE%E6%80%A7%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95">#</a>1.2. å¯è¾¾æ€§åˆ†æç®—æ³•</h3>
<p>é€šè¿‡ <strong>GC Roots</strong> ä½œä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼ŒJVM å°†èƒ½å¤Ÿåˆ°è¾¾åˆ°çš„å¯¹è±¡è§†ä¸º<strong>å­˜æ´»</strong>ï¼Œä¸å¯è¾¾çš„å¯¹è±¡è§†ä¸º<strong>æ­»äº¡</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-gc-root.png" alt="img"></p>
<p>å¯è¾¾æ€§åˆ†æç®—æ³•</p>
<p><strong>å¯ä½œä¸º GC Roots çš„å¯¹è±¡</strong>åŒ…æ‹¬ä¸‹é¢å‡ ç§ï¼š</p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆNative æ–¹æ³•ï¼‰</li>
<li>æ–¹æ³•åŒºä¸­ï¼Œç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­ï¼Œå¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
<h3 id="-801"><a class="markdownIt-Anchor" href="#-801">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_1-3-%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B">#</a>1.3. å¼•ç”¨ç±»å‹</h3>
<p>æ— è®ºæ˜¯é€šè¿‡å¼•ç”¨è®¡ç®—ç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨æ•°é‡ï¼Œè¿˜æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•åˆ¤æ–­å¯¹è±¡çš„å¼•ç”¨é“¾æ˜¯å¦å¯è¾¾ï¼Œåˆ¤å®šå¯¹è±¡æ˜¯å¦å¯è¢«å›æ”¶éƒ½ä¸å¼•ç”¨æœ‰å…³ã€‚</p>
<p>Java å…·æœ‰å››ç§å¼ºåº¦ä¸åŒçš„å¼•ç”¨ç±»å‹ã€‚</p>
<h4 id="-802"><a class="markdownIt-Anchor" href="#-802">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E5%BC%BA%E5%BC%95%E7%94%A8">#</a>å¼ºå¼•ç”¨</h4>
<p><strong>è¢«å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚</strong></p>
<p>å¼ºå¼•ç”¨ï¼šä½¿ç”¨  <code>new</code>  ä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹å¼æ¥åˆ›å»ºå¼ºå¼•ç”¨ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="-803"><a class="markdownIt-Anchor" href="#-803">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E8%BD%AF%E5%BC%95%E7%94%A8">#</a>è½¯å¼•ç”¨</h4>
<p><strong>è¢«è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰å…³è”çš„å¯¹è±¡ï¼Œåªæœ‰åœ¨å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹æ‰ä¼šè¢«å›æ”¶ã€‚</strong></p>
<p>è½¯å¼•ç”¨ï¼šä½¿ç”¨  <code>SoftReference</code>  ç±»æ¥åˆ›å»ºè½¯å¼•ç”¨ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> sf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// ä½¿å¯¹è±¡åªè¢«è½¯å¼•ç”¨å…³è”</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="-804"><a class="markdownIt-Anchor" href="#-804">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E5%BC%B1%E5%BC%95%E7%94%A8">#</a>å¼±å¼•ç”¨</h4>
<p><strong>è¢«å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰å…³è”çš„å¯¹è±¡ä¸€å®šä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†å‘ç”Ÿä¹‹å‰ã€‚</strong></p>
<p>ä½¿ç”¨  <code>WeakReference</code>  ç±»æ¥å®ç°å¼±å¼•ç”¨ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> wf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>WeakHashMap</code>  çš„  <code>Entry</code>  ç»§æ‰¿è‡ª  <code>WeakReference</code> ï¼Œä¸»è¦ç”¨æ¥å®ç°ç¼“å­˜ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Tomcat ä¸­çš„  <code>ConcurrentCache</code>  å°±ä½¿ç”¨äº†  <code>WeakHashMap</code>  æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚ <code>ConcurrentCache</code>  é‡‡å–çš„æ˜¯åˆ†ä»£ç¼“å­˜ï¼Œç»å¸¸ä½¿ç”¨çš„å¯¹è±¡æ”¾å…¥ eden ä¸­ï¼Œè€Œä¸å¸¸ç”¨çš„å¯¹è±¡æ”¾å…¥ longtermã€‚eden ä½¿ç”¨  <code>ConcurrentHashMap</code>  å®ç°ï¼Œlongterm ä½¿ç”¨  <code>WeakHashMap</code> ï¼Œä¿è¯äº†ä¸å¸¸ä½¿ç”¨çš„å¯¹è±¡å®¹æ˜“è¢«å›æ”¶ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ConcurrentCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> eden<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> longterm<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ConcurrentCache</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eden <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>longterm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">V</span> v <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eden<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            v <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>longterm<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>eden<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> v<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> k<span class="token punctuation">,</span> <span class="token class-name">V</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eden<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>longterm<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>eden<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>eden<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eden<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-805"><a class="markdownIt-Anchor" href="#-805">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E8%99%9A%E5%BC%95%E7%94%A8">#</a>è™šå¼•ç”¨</h4>
<p>åˆç§°ä¸ºå¹½çµå¼•ç”¨æˆ–è€…å¹»å½±å¼•ç”¨ã€‚ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è™šå¼•ç”¨çš„å­˜åœ¨ï¼Œå®Œå…¨ä¸ä¼šå¯¹å…¶ç”Ÿå­˜æ—¶é—´æ„æˆå½±å“ï¼Œä¹Ÿæ— æ³•é€šè¿‡è™šå¼•ç”¨å–å¾—ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚</p>
<p><strong>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ã€‚</strong></p>
<p>ä½¿ç”¨  <code>PhantomReference</code>  æ¥å®ç°è™šå¼•ç”¨ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> pf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="-806"><a class="markdownIt-Anchor" href="#-806">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_1-4-%E6%96%B9%E6%B3%95%E5%8C%BA%E7%9A%84%E5%9B%9E%E6%94%B6">#</a>1.4. æ–¹æ³•åŒºçš„å›æ”¶</h3>
<p>å› ä¸ºæ–¹æ³•åŒºä¸»è¦å­˜æ”¾æ°¸ä¹…ä»£å¯¹è±¡ï¼Œè€Œæ°¸ä¹…ä»£å¯¹è±¡çš„å›æ”¶ç‡æ¯”å¹´è½»ä»£å·®å¾ˆå¤šï¼Œå› æ­¤åœ¨æ–¹æ³•åŒºä¸Šè¿›è¡Œå›æ”¶æ€§ä»·æ¯”ä¸é«˜ã€‚</p>
<p>ä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ã€‚</p>
<p>ç±»çš„å¸è½½æ¡ä»¶å¾ˆå¤šï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼Œå¹¶ä¸”æ»¡è¶³äº†ä¹Ÿä¸ä¸€å®šä¼šè¢«å¸è½½ï¼š</p>
<ul>
<li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li>
<li>åŠ è½½è¯¥ç±»çš„  <code>ClassLoader</code>  å·²ç»è¢«å›æ”¶ã€‚</li>
<li>è¯¥ç±»å¯¹åº”çš„  <code>java.lang.Class</code>  å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•ã€‚</li>
</ul>
<p>å¯ä»¥é€šè¿‡  <code>-Xnoclassgc</code>  å‚æ•°æ¥æ§åˆ¶æ˜¯å¦å¯¹ç±»è¿›è¡Œå¸è½½ã€‚</p>
<p>åœ¨å¤§é‡ä½¿ç”¨åå°„ã€åŠ¨æ€ä»£ç†ã€CGLib ç­‰å­—èŠ‚ç æ¡†æ¶ã€åŠ¨æ€ç”Ÿæˆ JSP ä»¥åŠ OSGi è¿™ç±»é¢‘ç¹è‡ªå®šä¹‰  <code>ClassLoader</code>  çš„åœºæ™¯éƒ½éœ€è¦è™šæ‹Ÿæœºå…·å¤‡ç±»å¸è½½åŠŸèƒ½ï¼Œä»¥ä¿è¯ä¸ä¼šå‡ºç°å†…å­˜æº¢å‡ºã€‚</p>
<h3 id="-807"><a class="markdownIt-Anchor" href="#-807">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_1-5-finalize">#</a>1.5. finalize()</h3>
<p><code>finalize()</code>  ç±»ä¼¼ C++ çš„ææ„å‡½æ•°ï¼Œç”¨æ¥åšå…³é—­å¤–éƒ¨èµ„æºç­‰å·¥ä½œã€‚ä½†æ˜¯ try-finally ç­‰æ–¹å¼å¯ä»¥åšçš„æ›´å¥½ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œå› æ­¤<strong>æœ€å¥½ä¸è¦ä½¿ç”¨  <code>finalize()</code> </strong>ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œè¯¥å¯¹è±¡çš„  <code>finalize()</code>  æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½é€šè¿‡åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚</p>
<h2 id="-808"><a class="markdownIt-Anchor" href="#-808">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_2-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E7%AE%97%E6%B3%95">#</a>2. åƒåœ¾æ”¶é›†ç®—æ³•</h2>
<h3 id="-809"><a class="markdownIt-Anchor" href="#-809">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_2-1-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E6%80%A7%E8%83%BD">#</a>2.1. åƒåœ¾æ”¶é›†æ€§èƒ½</h3>
<p>åƒåœ¾æ”¶é›†å™¨çš„æ€§èƒ½æŒ‡æ ‡ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p>
<ul>
<li><strong>åœé¡¿æ—¶é—´</strong> - åœé¡¿æ—¶é—´æ˜¯å› ä¸º GC è€Œå¯¼è‡´ç¨‹åºä¸èƒ½å·¥ä½œçš„æ—¶é—´é•¿åº¦ã€‚</li>
<li><strong>ååé‡</strong> - ååé‡å…³æ³¨åœ¨ç‰¹å®šçš„æ—¶é—´å‘¨æœŸå†…ä¸€ä¸ªåº”ç”¨çš„å·¥ä½œé‡çš„æœ€å¤§å€¼ã€‚å¯¹å…³æ³¨ååé‡çš„åº”ç”¨æ¥è¯´é•¿æš‚åœæ—¶é—´æ˜¯å¯ä»¥æ¥å—çš„ã€‚ç”±äºé«˜ååé‡çš„åº”ç”¨å…³æ³¨çš„åŸºå‡†åœ¨æ›´é•¿å‘¨æœŸæ—¶é—´ä¸Šï¼Œæ‰€ä»¥å¿«é€Ÿå“åº”æ—¶é—´ä¸åœ¨è€ƒè™‘ä¹‹å†…ã€‚</li>
</ul>
<h3 id="-810"><a class="markdownIt-Anchor" href="#-810">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_2-2-%E6%A0%87%E8%AE%B0-%E6%B8%85%E9%99%A4-mark-sweep">#</a>2.2. æ ‡è®° - æ¸…é™¤ï¼ˆMark-Sweepï¼‰</h3>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-gc-mark-sweep.jpg" alt="img"></p>
<p>å°†éœ€è¦å›æ”¶çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ï¼Œç„¶åæ¸…ç†æ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚</p>
<p>ä¸è¶³ï¼š</p>
<ul>
<li>æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ï¼›</li>
<li>ä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´æ— æ³•ç»™å¤§å¯¹è±¡åˆ†é…å†…å­˜ã€‚</li>
</ul>
<h3 id="-811"><a class="markdownIt-Anchor" href="#-811">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_2-3-%E6%A0%87%E8%AE%B0-%E6%95%B4%E7%90%86-mark-compact">#</a>2.3. æ ‡è®° - æ•´ç†ï¼ˆMark-Compactï¼‰</h3>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-gc-mark-compact.jpg" alt="img"></p>
<p>è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</p>
<p>è¿™ç§åšæ³•èƒ½å¤Ÿè§£å†³å†…å­˜ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œä½†ä»£ä»·æ˜¯å‹ç¼©ç®—æ³•çš„æ€§èƒ½å¼€é”€ã€‚</p>
<h3 id="-812"><a class="markdownIt-Anchor" href="#-812">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_2-4-%E5%A4%8D%E5%88%B6-copying">#</a>2.4. å¤åˆ¶ï¼ˆCopyingï¼‰</h3>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-gc-copying.jpg" alt="img"></p>
<p>å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´è¿›è¡Œä¸€æ¬¡æ¸…ç†ã€‚</p>
<p>ä¸»è¦ä¸è¶³æ˜¯åªä½¿ç”¨äº†å†…å­˜çš„ä¸€åŠã€‚</p>
<p>ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½<strong>é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•æ¥å›æ”¶å¹´è½»ä»£</strong>ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å°†å†…å­˜åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œè€Œæ˜¯åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survior ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden ç©ºé—´å’Œå…¶ä¸­ä¸€å— Survivorã€‚åœ¨å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§å¤åˆ¶åˆ°å¦ä¸€å— Survivor ç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç† Eden å’Œä½¿ç”¨è¿‡çš„é‚£ä¸€å— Survivorã€‚HotSpot è™šæ‹Ÿæœºçš„ Eden å’Œ Survivor çš„å¤§å°æ¯”ä¾‹é»˜è®¤ä¸º 8:1ï¼ˆå¯ä»¥é€šè¿‡å‚æ•°  <code>-XX:SurvivorRatio</code>  æ¥è°ƒæ•´æ¯”ä¾‹ï¼‰ï¼Œä¿è¯äº†å†…å­˜çš„åˆ©ç”¨ç‡è¾¾åˆ° 90 %ã€‚å¦‚æœæ¯æ¬¡å›æ”¶æœ‰å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œé‚£ä¹ˆä¸€å— Survivor ç©ºé—´å°±ä¸å¤Ÿç”¨äº†ï¼Œæ­¤æ—¶éœ€è¦ä¾èµ–äºè€å¹´ä»£è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä¹Ÿå°±æ˜¯å€Ÿç”¨è€å¹´ä»£çš„ç©ºé—´å­˜å‚¨æ”¾ä¸ä¸‹çš„å¯¹è±¡ã€‚</p>
<h3 id="-813"><a class="markdownIt-Anchor" href="#-813">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_2-5-%E5%88%86%E4%BB%A3%E6%94%B6%E9%9B%86">#</a>2.5. åˆ†ä»£æ”¶é›†</h3>
<p>ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºé‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸åŒå—é‡‡ç”¨é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚</p>
<p>ä¸€èˆ¬å°† Java å †åˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ã€‚</p>
<ul>
<li>å¹´è½»ä»£ä½¿ç”¨ï¼š<strong>å¤åˆ¶</strong> ç®—æ³•</li>
<li>è€å¹´ä»£ä½¿ç”¨ï¼š<strong>æ ‡è®° - æ¸…ç†</strong> æˆ–è€… <strong>æ ‡è®° - æ•´ç†</strong> ç®—æ³•</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-hotspot-heap-structure.png" alt="img"></p>
<h4 id="-814"><a class="markdownIt-Anchor" href="#-814">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E6%96%B0%E7%94%9F%E4%BB%A3">#</a>æ–°ç”Ÿä»£</h4>
<p>æ–°ç”Ÿä»£æ˜¯å¤§éƒ¨åˆ†å¯¹è±¡åˆ›å»ºå’Œé”€æ¯çš„åŒºåŸŸï¼Œåœ¨é€šå¸¸çš„ Java åº”ç”¨ä¸­ï¼Œç»å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯å¾ˆçŸ­æš‚çš„ã€‚å…¶å†…éƒ¨åˆåˆ†ä¸º  <code>Eden</code>  åŒºåŸŸï¼Œä½œä¸ºå¯¹è±¡åˆå§‹åˆ†é…çš„åŒºåŸŸï¼›ä¸¤ä¸ª  <code>Survivor</code> ï¼Œæœ‰æ—¶å€™ä¹Ÿå«  <code>from</code> ã€ <code>to</code>  åŒºåŸŸï¼Œè¢«ç”¨æ¥æ”¾ç½®ä» Minor GC ä¸­ä¿ç•™ä¸‹æ¥çš„å¯¹è±¡ã€‚</p>
<p>JVM ä¼šéšæ„é€‰å–ä¸€ä¸ª  <code>Survivor</code>  åŒºåŸŸä½œä¸º  <code>to</code> ï¼Œç„¶åä¼šåœ¨ GC è¿‡ç¨‹ä¸­è¿›è¡ŒåŒºåŸŸé—´æ‹·è´ï¼Œä¹Ÿå°±æ˜¯å°† Eden ä¸­å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å’Œ  <code>from</code>  åŒºåŸŸçš„å¯¹è±¡ï¼Œæ‹·è´åˆ°è¿™ä¸ª <code>to</code>  åŒºåŸŸã€‚è¿™ç§è®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢å†…å­˜çš„ç¢ç‰‡åŒ–ï¼Œå¹¶è¿›ä¸€æ­¥æ¸…ç†æ— ç”¨å¯¹è±¡ã€‚</p>
<p>Java è™šæ‹Ÿæœºä¼šè®°å½•  <code>Survivor</code>  åŒºä¸­çš„å¯¹è±¡ä¸€å…±è¢«æ¥å›å¤åˆ¶äº†å‡ æ¬¡ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«å¤åˆ¶çš„æ¬¡æ•°ä¸º 15ï¼ˆå¯¹åº”è™šæ‹Ÿæœºå‚æ•°  <code>-XX:+MaxTenuringThreshold</code> ï¼‰ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°†è¢«æ™‹å‡ï¼ˆpromoteï¼‰è‡³è€å¹´ä»£ã€‚å¦å¤–ï¼Œå¦‚æœå•ä¸ª  <code>Survivor</code>  åŒºå·²ç»è¢«å ç”¨äº† 50%ï¼ˆå¯¹åº”è™šæ‹Ÿæœºå‚æ•°  <code>-XX:TargetSurvivorRatio</code> ï¼‰ï¼Œé‚£ä¹ˆè¾ƒé«˜å¤åˆ¶æ¬¡æ•°çš„å¯¹è±¡ä¹Ÿä¼šè¢«æ™‹å‡è‡³è€å¹´ä»£ã€‚</p>
<h4 id="-815"><a class="markdownIt-Anchor" href="#-815">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E8%80%81%E5%B9%B4%E4%BB%A3">#</a>è€å¹´ä»£</h4>
<p>æ”¾ç½®é•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œé€šå¸¸éƒ½æ˜¯ä»  <code>Survivor</code>  åŒºåŸŸæ‹·è´è¿‡æ¥çš„å¯¹è±¡ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœå¯¹è±¡è¾ƒå¤§ï¼ŒJVM ä¼šè¯•å›¾ç›´æ¥åˆ†é…åœ¨  <code>Eden</code>  å…¶ä»–ä½ç½®ä¸Šï¼›å¦‚æœå¯¹è±¡å¤ªå¤§ï¼Œå®Œå…¨æ— æ³•åœ¨æ–°ç”Ÿä»£æ‰¾åˆ°è¶³å¤Ÿé•¿çš„è¿ç»­ç©ºé—²ç©ºé—´ï¼ŒJVM å°±ä¼šç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚</p>
<h4 id="-816"><a class="markdownIt-Anchor" href="#-816">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E6%B0%B8%E4%B9%85%E4%BB%A3">#</a>æ°¸ä¹…ä»£</h4>
<p>è¿™éƒ¨åˆ†å°±æ˜¯æ—©æœŸ Hotspot JVM çš„æ–¹æ³•åŒºå®ç°æ–¹å¼äº†ï¼Œå‚¨å­˜ Java ç±»å…ƒæ•°æ®ã€å¸¸é‡æ± ã€Intern å­—ç¬¦ä¸²ç¼“å­˜ã€‚åœ¨ JDK 8 ä¹‹åå°±ä¸å­˜åœ¨æ°¸ä¹…ä»£è¿™å—å„¿äº†ã€‚</p>
<h4 id="-817"><a class="markdownIt-Anchor" href="#-817">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#jvm-%E5%8F%82%E6%95%B0">#</a>JVM å‚æ•°</h4>
<p>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹ï¼ŒJVM å…è®¸å¯¹å †ç©ºé—´å¤§å°ã€å„ä»£ç©ºé—´å¤§å°è¿›è¡Œè®¾ç½®ï¼Œä»¥è°ƒæ•´ JVM GCã€‚</p>
<table>
<thead>
<tr>
<th>é…ç½®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-Xss</code></td>
<td>è™šæ‹Ÿæœºæ ˆå¤§å°ã€‚</td>
</tr>
<tr>
<td><code>-Xms</code></td>
<td>å †ç©ºé—´åˆå§‹å€¼ã€‚</td>
</tr>
<tr>
<td><code>-Xmx</code></td>
<td>å †ç©ºé—´æœ€å¤§å€¼ã€‚</td>
</tr>
<tr>
<td><code>-Xmn</code></td>
<td>æ–°ç”Ÿä»£ç©ºé—´å¤§å°ã€‚</td>
</tr>
<tr>
<td><code>-XX:NewSize</code></td>
<td>æ–°ç”Ÿä»£ç©ºé—´åˆå§‹å€¼ã€‚</td>
</tr>
<tr>
<td><code>-XX:MaxNewSize</code></td>
<td>æ–°ç”Ÿä»£ç©ºé—´æœ€å¤§å€¼ã€‚</td>
</tr>
<tr>
<td><code>-XX:NewRatio</code></td>
<td>æ–°ç”Ÿä»£ä¸å¹´è€ä»£çš„æ¯”ä¾‹ã€‚é»˜è®¤ä¸º 2ï¼Œæ„å‘³ç€è€å¹´ä»£æ˜¯æ–°ç”Ÿä»£çš„ 2 å€ã€‚</td>
</tr>
<tr>
<td><code>-XX:SurvivorRatio</code></td>
<td>æ–°ç”Ÿä»£ä¸­è°ƒæ•´ eden åŒºä¸ survivor åŒºçš„æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º 8ã€‚å³  <code>eden</code>  åŒºä¸º 80% çš„å¤§å°ï¼Œä¸¤ä¸ª  <code>survivor</code>  åˆ†åˆ«ä¸º 10% çš„å¤§å°ã€‚</td>
</tr>
<tr>
<td><code>-XX:PermSize</code></td>
<td>æ°¸ä¹…ä»£ç©ºé—´çš„åˆå§‹å€¼ã€‚</td>
</tr>
<tr>
<td><code>-XX:MaxPermSize</code></td>
<td>æ°¸ä¹…ä»£ç©ºé—´çš„æœ€å¤§å€¼ã€‚</td>
</tr>
</tbody>
</table>
<h2 id="-818"><a class="markdownIt-Anchor" href="#-818">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_3-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8">#</a>3. åƒåœ¾æ”¶é›†å™¨</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-gc-overview.jpg" alt="img"></p>
<p>ä»¥ä¸Šæ˜¯ HotSpot è™šæ‹Ÿæœºä¸­çš„ 7 ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¿çº¿è¡¨ç¤ºåƒåœ¾æ”¶é›†å™¨å¯ä»¥é…åˆä½¿ç”¨ã€‚</p>
<p>æ³¨ï¼šG1 åƒåœ¾æ”¶é›†å™¨æ—¢å¯ä»¥å›æ”¶å¹´è½»ä»£å†…å­˜ï¼Œä¹Ÿå¯ä»¥å›æ”¶è€å¹´ä»£å†…å­˜ã€‚è€Œå…¶ä»–åƒåœ¾æ”¶é›†å™¨åªèƒ½é’ˆå¯¹ç‰¹å®šä»£çš„å†…å­˜è¿›è¡Œå›æ”¶ã€‚</p>
<h3 id="-819"><a class="markdownIt-Anchor" href="#-819">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_3-1-%E4%B8%B2%E8%A1%8C%E6%94%B6%E9%9B%86%E5%99%A8">#</a>3.1. ä¸²è¡Œæ”¶é›†å™¨</h3>
<p>ä¸²è¡Œæ”¶é›†å™¨ï¼ˆSerialï¼‰æ˜¯æœ€åŸºæœ¬ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ã€‚</p>
<p>ä¸²è¡Œæ”¶é›†å™¨æ˜¯ <strong> <code>client</code>  æ¨¡å¼ä¸‹çš„é»˜è®¤æ”¶é›†å™¨é…ç½®</strong>ã€‚å› ä¸ºåœ¨å®¢æˆ·ç«¯æ¨¡å¼ä¸‹ï¼Œåˆ†é…ç»™è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸€èˆ¬æ¥è¯´ä¸ä¼šå¾ˆå¤§ã€‚Serial æ”¶é›†å™¨æ”¶é›†å‡ åå…†ç”šè‡³ä¸€ä¸¤ç™¾å…†çš„å¹´è½»ä»£åœé¡¿æ—¶é—´å¯ä»¥æ§åˆ¶åœ¨ä¸€ç™¾å¤šæ¯«ç§’ä»¥å†…ï¼Œåªè¦ä¸æ˜¯å¤ªé¢‘ç¹ï¼Œè¿™ç‚¹åœé¡¿æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p><strong>ä¸²è¡Œæ”¶é›†å™¨é‡‡ç”¨å•çº¿ç¨‹ stop-the-world çš„æ–¹å¼è¿›è¡Œæ”¶é›†</strong>ã€‚å½“å†…å­˜ä¸è¶³æ—¶ï¼Œä¸²è¡Œ GC è®¾ç½®åœé¡¿æ ‡è¯†ï¼Œå¾…æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥å®‰å…¨ç‚¹ï¼ˆSafepointï¼‰æ—¶ï¼Œåº”ç”¨çº¿ç¨‹æš‚åœï¼Œä¸²è¡Œ GC å¼€å§‹å·¥ä½œï¼Œ<strong>é‡‡ç”¨å•çº¿ç¨‹æ–¹å¼å›æ”¶ç©ºé—´å¹¶æ•´ç†å†…å­˜</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-gc-serial.jpg" alt="img"></p>
<p>Serial / Serial Old æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<p>å•çº¿ç¨‹æ„å‘³ç€å¤æ‚åº¦æ›´ä½ã€å ç”¨å†…å­˜æ›´å°‘ï¼Œåƒåœ¾å›æ”¶æ•ˆç‡é«˜ï¼›ä½†åŒæ—¶ä¹Ÿæ„å‘³ç€ä¸èƒ½æœ‰æ•ˆåˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿ã€‚äº‹å®ä¸Šï¼Œä¸²è¡Œæ”¶é›†å™¨ç‰¹åˆ«é€‚åˆå †å†…å­˜ä¸é«˜ã€å•æ ¸ç”šè‡³åŒæ ¸ CPU çš„åœºåˆã€‚</p>
<h4 id="-820"><a class="markdownIt-Anchor" href="#-820">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#serial-%E6%94%B6%E9%9B%86%E5%99%A8">#</a>Serial æ”¶é›†å™¨</h4>
<blockquote>
<p>å¼€å¯é€‰é¡¹ï¼š <code>-XX:+UseSerialGC</code></p>
<p>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨ <strong>Serial</strong> + <strong>Serial Old</strong> æ”¶é›†å™¨ç»„åˆæ¥è¿›è¡Œå†…å­˜å›æ”¶ã€‚</p>
</blockquote>
<h4 id="-821"><a class="markdownIt-Anchor" href="#-821">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#serial-old-%E6%94%B6%E9%9B%86%E5%99%A8">#</a>Serial Old æ”¶é›†å™¨</h4>
<p>Serial Old æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ç»™ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚å¦‚æœç”¨åœ¨ Server æ¨¡å¼ä¸‹ï¼Œå®ƒæœ‰ä¸¤å¤§ç”¨é€”ï¼š</p>
<ul>
<li>åœ¨ JDK 1.5 ä»¥åŠä¹‹å‰ç‰ˆæœ¬ï¼ˆParallel Old è¯ç”Ÿä»¥å‰ï¼‰ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ã€‚</li>
<li>ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”Ÿ Concurrent Mode Failure æ—¶ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="-822"><a class="markdownIt-Anchor" href="#-822">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_3-2-%E5%B9%B6%E8%A1%8C%E6%94%B6%E9%9B%86%E5%99%A8">#</a>3.2. å¹¶è¡Œæ”¶é›†å™¨</h3>
<blockquote>
<p>å¼€å¯é€‰é¡¹ï¼š <code>-XX:+UseParallelGC</code></p>
<p>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨ <strong>Parallel Scavenge</strong> + <strong>Serial Old</strong> æ”¶é›†å™¨ç»„åˆæ¥è¿›è¡Œå†…å­˜å›æ”¶ã€‚</p>
<p>å¼€å¯é€‰é¡¹ï¼š <code>-XX:+UseParallelOldGC</code></p>
<p>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨ <strong>Parallel Scavenge</strong> + <strong>Parallel Old</strong> æ”¶é›†å™¨ç»„åˆæ¥è¿›è¡Œå†…å­˜å›æ”¶ã€‚</p>
</blockquote>
<p>å…¶ä»–æ”¶é›†å™¨éƒ½æ˜¯ä»¥å…³æ³¨åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œè€Œ<strong>å¹¶è¡Œæ”¶é›†å™¨æ˜¯ä»¥å…³æ³¨ååé‡ï¼ˆThroughputï¼‰ä¸ºç›®æ ‡çš„åƒåœ¾æ”¶é›†å™¨</strong>ã€‚</p>
<ul>
<li>åœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼›</li>
<li>è€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨ CPU æ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚</li>
</ul>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / (è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>å¹¶è¡Œæ”¶é›†å™¨æ˜¯ server æ¨¡å¼ä¸‹çš„é»˜è®¤æ”¶é›†å™¨ã€‚</strong></p>
<p>å¹¶è¡Œæ”¶é›†å™¨ä¸ä¸²è¡Œæ”¶é›†å™¨å·¥ä½œæ¨¡å¼ç›¸ä¼¼ï¼Œéƒ½æ˜¯ stop-the-world æ–¹å¼ï¼Œåªæ˜¯æš‚åœæ—¶å¹¶è¡Œåœ°è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚<strong>å¹¶è¡Œæ”¶é›†å™¨å¹´è½»ä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®° - æ•´ç†</strong>ï¼Œåœ¨å›æ”¶çš„åŒæ—¶è¿˜ä¼šå¯¹å†…å­˜è¿›è¡Œå‹ç¼©ã€‚å¹¶è¡Œæ”¶é›†å™¨é€‚åˆå¯¹ååé‡è¦æ±‚è¿œè¿œé«˜äºå»¶è¿Ÿè¦æ±‚çš„åœºæ™¯ï¼Œå¹¶ä¸”åœ¨æ»¡è¶³æœ€å·®å»¶æ—¶çš„æƒ…å†µä¸‹ï¼Œå¹¶è¡Œæ”¶é›†å™¨å°†æä¾›æœ€ä½³çš„ååé‡ã€‚</p>
<p><strong>åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge æ”¶é›†å™¨ + Parallel Old æ”¶é›†å™¨ã€‚</strong></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-gc-parallel.jpg" alt="img"></p>
<p>Parallel / Parallel Old æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<h4 id="-823"><a class="markdownIt-Anchor" href="#-823">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#parallel-scavenge-%E6%94%B6%E9%9B%86%E5%99%A8">#</a>Parallel Scavenge æ”¶é›†å™¨</h4>
<p>Parallel Scavenge æ”¶é›†å™¨æä¾›äº†ä¸¤ä¸ªå‚æ•°ç”¨äºç²¾ç¡®æ§åˆ¶ååé‡ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>-XX:MaxGCPauseMillis</code>  - æ§åˆ¶æœ€å¤§åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´ï¼Œæ”¶é›†å™¨å°†å°½å¯èƒ½ä¿è¯å†…å­˜å›æ”¶æ—¶é—´ä¸è¶…è¿‡è®¾å®šå€¼ã€‚</li>
<li><code>-XX:GCTimeRatio</code>  - ç›´æ¥è®¾ç½®ååé‡å¤§å°çš„ï¼ˆå€¼ä¸ºå¤§äº 0 ä¸”å°äº 100 çš„æ•´æ•°ï¼‰ã€‚</li>
</ul>
<p>ç¼©çŸ­åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡å’Œå¹´è½»ä»£ç©ºé—´æ¥æ¢å–çš„ï¼šå¹´è½»ä»£ç©ºé—´å˜å°ï¼Œåƒåœ¾å›æ”¶å˜å¾—é¢‘ç¹ï¼Œå¯¼è‡´ååé‡ä¸‹é™ã€‚</p>
<p>Parallel Scavenge æ”¶é›†å™¨è¿˜æä¾›äº†ä¸€ä¸ªå‚æ•°  <code>-XX:+UseAdaptiveSizePolicy</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€å…³å‚æ•°ï¼Œæ‰“å¼€å‚æ•°åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šå¹´è½»ä»£çš„å¤§å°ï¼ˆ <code>-Xmn</code> ï¼‰ã€Eden å’Œ Survivor åŒºçš„æ¯”ä¾‹ï¼ˆ <code>-XX:SurvivorRatio</code> ï¼‰ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ï¼ˆ <code>-XX:PretenureSizeThreshold</code> ï¼‰ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º GC è‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰ã€‚</p>
<h4 id="-824"><a class="markdownIt-Anchor" href="#-824">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#parallel-old-%E6%94%B6%E9%9B%86%E5%99%A8">#</a>Parallel Old æ”¶é›†å™¨</h4>
<p>æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨<strong>å¤šçº¿ç¨‹å’Œ â€œæ ‡è®° - æ•´ç†â€ ç®—æ³•</strong>ã€‚</p>
<h3 id="-825"><a class="markdownIt-Anchor" href="#-825">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_3-3-%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E6%94%B6%E9%9B%86%E5%99%A8">#</a>3.3. å¹¶å‘æ ‡è®°æ¸…é™¤æ”¶é›†å™¨</h3>
<blockquote>
<p>å¼€å¯é€‰é¡¹ï¼š <code>-XX:+UseConcMarkSweepGC</code></p>
<p>æ‰“å¼€æ­¤å¼€å…³åï¼Œä½¿ç”¨ <strong>CMS</strong> + <strong>ParNew</strong> + <strong>Serial Old</strong> æ”¶é›†å™¨ç»„åˆæ¥è¿›è¡Œå†…å­˜å›æ”¶ã€‚</p>
</blockquote>
<p>å¹¶å‘æ ‡è®°æ¸…é™¤æ”¶é›†å™¨æ˜¯ä»¥è·å–æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ã€‚</p>
<p>å¼€å¯åï¼Œå¹´è½»ä»£ä½¿ç”¨ ParNew æ”¶é›†å™¨ï¼›è€å¹´ä»£ä½¿ç”¨ CMS æ”¶é›†å™¨ï¼Œå¦‚æœ CMS äº§ç”Ÿçš„ç¢ç‰‡è¿‡å¤šï¼Œå¯¼è‡´æ— æ³•å­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼ŒJVM ä¼šå‡ºç°  <code>Concurrent Mode Failure</code>  ï¼Œæ­¤æ—¶ä½¿ç”¨ Serial Old æ”¶é›†å™¨æ¥æ›¿ä»£ CMS æ”¶é›†å™¨æ¸…ç†ç¢ç‰‡ã€‚</p>
<h4 id="-826"><a class="markdownIt-Anchor" href="#-826">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#cms-%E6%94%B6%E9%9B%86%E5%99%A8">#</a>CMS æ”¶é›†å™¨</h4>
<p><strong>CMS æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚</strong></p>
<p>CMSï¼ˆConcurrent Mark Sweepï¼‰ï¼ŒMark Sweep æŒ‡çš„æ˜¯æ ‡è®° - æ¸…é™¤ç®—æ³•ã€‚</p>
<h5 id="-827"><a class="markdownIt-Anchor" href="#-827">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#cms-%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6">#</a>CMS å›æ”¶æœºåˆ¶</h5>
<p>CMS æ”¶é›†å™¨è¿è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>åˆå§‹æ ‡è®°</strong>ï¼šä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹ GC Roots èƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦åœé¡¿ã€‚</li>
<li><strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿›è¡Œ GC Roots Tracing çš„è¿‡ç¨‹ï¼Œå®ƒåœ¨æ•´ä¸ªå›æ”¶è¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿ï¼Œä¸éœ€è¦åœé¡¿ã€‚</li>
<li><strong>é‡æ–°æ ‡è®°</strong>ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œéœ€è¦åœé¡¿ã€‚</li>
<li><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šå›æ”¶åœ¨æ ‡è®°é˜¶æ®µè¢«é‰´å®šä¸ºä¸å¯è¾¾çš„å¯¹è±¡ã€‚ä¸éœ€è¦åœé¡¿ã€‚</li>
</ol>
<p>åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œä¸éœ€è¦è¿›è¡Œåœé¡¿ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-gc-cms.jpg" alt="img"></p>
<p>CMS æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<h5 id="-828"><a class="markdownIt-Anchor" href="#-828">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#cms-%E5%9B%9E%E6%94%B6%E5%B9%B4%E8%BD%BB%E4%BB%A3%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4">#</a>CMS å›æ”¶å¹´è½»ä»£è¯¦ç»†æ­¥éª¤</h5>
<p><strong>ï¼ˆ1ï¼‰å †ç©ºé—´è¢«åˆ†å‰²ä¸ºä¸‰å—ç©ºé—´</strong></p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide1.png" alt="img"> å¹´è½»ä»£åˆ†å‰²æˆä¸€ä¸ª Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºã€‚å¹´è€ä»£ä¸€ä¸ªè¿ç»­çš„ç©ºé—´ã€‚å°±åœ°å®Œæˆå¯¹è±¡æ”¶é›†ã€‚é™¤éæœ‰ FullGC å¦åˆ™ä¸ä¼šå‹ç¼©ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰CMS å¹´è½»ä»£åƒåœ¾æ”¶é›†å¦‚ä½•å·¥ä½œ</strong></p>
<p>å¹´è½»ä»£è¢«æ ‡ä¸ºæµ…ç»¿è‰²ï¼Œå¹´è€ä»£è¢«æ ‡è®°ä¸ºè“è‰²ã€‚å¦‚æœä½ çš„åº”ç”¨å·²ç»è¿è¡Œäº†ä¸€æ®µæ—¶é—´ï¼ŒCMS çš„å †çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™ä¸ªæ ·å­ã€‚å¯¹è±¡åˆ†æ•£åœ¨å¹´è€ä»£åŒºåŸŸé‡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide2.png" alt="img"></p>
<p>ä½¿ç”¨ CMSï¼Œå¹´è€ä»£å¯¹è±¡å°±åœ°é‡Šæ”¾ã€‚å®ƒä»¬ä¸ä¼šè¢«æ¥å›ç§»åŠ¨ã€‚è¿™ä¸ªç©ºé—´ä¸ä¼šè¢«å‹ç¼©é™¤éå‘ç”Ÿ FullGCã€‚</p>
<p><strong>ï¼ˆ3ï¼‰å¹´è½»ä»£æ”¶é›†</strong></p>
<p>ä» Eden å’Œ Survivor åŒºå¤åˆ¶æ´»è·ƒå¯¹è±¡åˆ°å¦ä¸€ä¸ª Survivor åŒºã€‚æ‰€æœ‰è¾¾åˆ°ä»–ä»¬çš„å¹´é¾„é˜ˆå€¼çš„å¯¹è±¡ä¼šæ™‹å‡åˆ°å¹´è€ä»£ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide3.png" alt="img"> <strong>ï¼ˆ4) å¹´è½»ä»£å›æ”¶ä¹‹å</strong></p>
<p>ä¸€æ¬¡å¹´è½»ä»£åƒåœ¾æ”¶é›†ä¹‹åï¼ŒEden åŒºå’Œå…¶ä¸­ä¸€ä¸ª Survivor åŒºè¢«æ¸…ç©ºã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide4.png" alt="img"> æœ€è¿‘æ™‹å‡çš„å¯¹è±¡ä»¥æ·±è“è‰²æ˜¾ç¤ºåœ¨ä¸Šå›¾ä¸­ï¼Œç»¿è‰²çš„å¯¹è±¡æ˜¯å¹´è½»ä»£å¹¸å…çš„è¿˜æ²¡æœ‰æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡ã€‚</p>
<h5 id="-829"><a class="markdownIt-Anchor" href="#-829">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#cms-%E5%9B%9E%E6%94%B6%E5%B9%B4%E8%80%81%E4%BB%A3%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4">#</a>CMS å›æ”¶å¹´è€ä»£è¯¦ç»†æ­¥éª¤</h5>
<p><strong>ï¼ˆ1ï¼‰CMS çš„å¹´è€ä»£æ”¶é›†</strong></p>
<p>å‘ç”Ÿä¸¤æ¬¡ stop the world äº‹ä»¶ï¼šåˆå§‹æ ‡è®°å’Œé‡æ–°æ ‡è®°ã€‚å½“å¹´è€ä»£è¾¾åˆ°ç‰¹å®šçš„å ç”¨æ¯”ä¾‹æ—¶ï¼ŒCMS å¼€å§‹æ‰§è¡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide5.png" alt="img"></p>
<ul>
<li>åˆå§‹æ ‡è®°æ˜¯ä¸€ä¸ªçŸ­æš‚æš‚åœçš„ã€å¯è¾¾å¯¹è±¡è¢«æ ‡è®°çš„é˜¶æ®µã€‚</li>
<li>å¹¶å‘æ ‡è®°å¯»æ‰¾æ´»è·ƒå¯¹è±¡åœ¨åº”ç”¨è¿ç»­æ‰§è¡Œæ—¶ã€‚</li>
<li>æœ€åï¼Œåœ¨é‡æ–°æ ‡è®°é˜¶æ®µï¼Œå¯»æ‰¾åœ¨ä¹‹å‰å¹¶å‘æ ‡è®°é˜¶æ®µä¸­ä¸¢å¤±çš„å¯¹è±¡ã€‚</li>
</ul>
<p><strong>ï¼ˆ2ï¼‰å¹´è€ä»£æ”¶é›† - å¹¶å‘æ¸…é™¤</strong></p>
<p>åœ¨ä¹‹å‰é˜¶æ®µæ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ä¼šè¢«å°±åœ°é‡Šæ”¾ã€‚ä¸è¿›è¡Œå‹ç¼©æ“ä½œã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide6.png" alt="img"> ** æ³¨æ„ï¼š** æœªè¢«æ ‡è®°çš„å¯¹è±¡ç­‰äºæ­»äº¡å¯¹è±¡</p>
<p><strong>ï¼ˆ3ï¼‰å¹´è€ä»£æ”¶é›† - æ¸…é™¤ä¹‹å</strong></p>
<p>æ¸…é™¤é˜¶æ®µä¹‹åï¼Œä½ å¯ä»¥çœ‹åˆ°å¤§é‡å†…å­˜è¢«é‡Šæ”¾ã€‚ä½ è¿˜å¯ä»¥æ³¨æ„åˆ°æ²¡æœ‰è¿›è¡Œå‹ç¼©æ“ä½œã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide7.png" alt="img"> æœ€åï¼ŒCMS æ”¶é›†å™¨ä¼šå†æ¬¡è¿›å…¥é‡æ–°è®¾ç½®é˜¶æ®µï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡åƒåœ¾æ”¶é›†æ—¶æœºçš„åˆ°æ¥ã€‚</p>
<h5 id="-830"><a class="markdownIt-Anchor" href="#-830">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#cms-%E7%89%B9%E7%82%B9">#</a>CMS ç‰¹ç‚¹</h5>
<p>CMS æ”¶é›†å™¨å…·æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p>
<ul>
<li>
<p>å¹¶å‘æ”¶é›† - å¹¶å‘æŒ‡çš„æ˜¯ç”¨æˆ·çº¿ç¨‹å’Œ GC çº¿ç¨‹åŒæ—¶è¿è¡Œã€‚</p>
</li>
<li>
<p>ååé‡ä½ - ä½åœé¡¿æ—¶é—´æ˜¯ä»¥ç‰ºç‰²ååé‡ä¸ºä»£ä»·çš„ï¼Œå¯¼è‡´ CPU åˆ©ç”¨ç‡ä¸å¤Ÿé«˜ã€‚</p>
</li>
<li>
<p>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ - å¯èƒ½å‡ºç°</p>
  <pre class="line-numbers language-none"><code class="language-none">Concurrent Mode Failure<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ã€‚æµ®åŠ¨åƒåœ¾æ˜¯æŒ‡å¹¶å‘æ¸…é™¤é˜¶æ®µç”±äºç”¨æˆ·çº¿ç¨‹ç»§ç»­è¿è¡Œè€Œäº§ç”Ÿçš„åƒåœ¾ï¼Œè¿™éƒ¨åˆ†åƒåœ¾åªèƒ½åˆ°ä¸‹ä¸€æ¬¡ GC æ—¶æ‰èƒ½è¿›è¡Œå›æ”¶ã€‚ç”±äºæµ®åŠ¨åƒåœ¾çš„å­˜åœ¨ï¼Œå› æ­¤éœ€è¦é¢„ç•™å‡ºä¸€éƒ¨åˆ†å†…å­˜ï¼Œæ„å‘³ç€ CMS æ”¶é›†ä¸èƒ½åƒå…¶å®ƒæ”¶é›†å™¨é‚£æ ·ç­‰å¾…è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™å†å›æ”¶ã€‚</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨  <code>-XX:CMSInitiatingOccupancyFraction</code>  æ¥æ”¹å˜è§¦å‘ CMS æ”¶é›†å™¨å·¥ä½œçš„å†…å­˜å ç”¨ç™¾åˆ†ï¼Œå¦‚æœè¿™ä¸ªå€¼è®¾ç½®çš„å¤ªå¤§ï¼Œå¯¼è‡´é¢„ç•™çš„å†…å­˜ä¸å¤Ÿå­˜æ”¾æµ®åŠ¨åƒåœ¾ï¼Œå°±ä¼šå‡ºç°  <code>Concurrent Mode Failure</code> ï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†ä¸´æ—¶å¯ç”¨ Serial Old æ”¶é›†å™¨æ¥æ›¿ä»£ CMS æ”¶é›†å™¨ã€‚</li>
</ul>
</li>
<li>
<p>æ ‡è®° - æ¸…é™¤ç®—æ³•å¯¼è‡´çš„ç©ºé—´ç¢ç‰‡ï¼Œå¾€å¾€å‡ºç°è€å¹´ä»£ç©ºé—´å‰©ä½™ï¼Œä½†æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡ Full GCã€‚</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨  <code>-XX:+UseCMSCompactAtFullCollection</code>  ï¼Œç”¨äºåœ¨ CMS æ”¶é›†å™¨è¦è¿›è¡Œ Full GC æ—¶å¼€å¯å†…å­˜ç¢ç‰‡çš„åˆå¹¶æ•´ç†ï¼Œå†…å­˜æ•´ç†çš„è¿‡ç¨‹æ˜¯æ— æ³•å¹¶å‘çš„ï¼Œç©ºé—´ç¢ç‰‡é—®é¢˜æ²¡æœ‰äº†ï¼Œä½†æ˜¯åœé¡¿æ—¶é—´ä¸å¾—ä¸å˜é•¿äº†ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨  <code>-XX:CMSFullGCsBeforeCompaction</code>  ï¼Œç”¨äºè®¾ç½®æ‰§è¡Œå¤šå°‘æ¬¡ä¸å‹ç¼©çš„ Full GC åï¼Œæ¥ä¸€æ¬¡å¸¦å‹ç¼©çš„ï¼ˆé»˜è®¤ä¸º 0ï¼Œè¡¨ç¤ºæ¯æ¬¡è¿›å…¥ Full GC æ—¶éƒ½è¦è¿›è¡Œç¢ç‰‡æ•´ç†ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h4 id="-831"><a class="markdownIt-Anchor" href="#-831">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#parnew-%E6%94%B6%E9%9B%86%E5%99%A8">#</a>ParNew æ”¶é›†å™¨</h4>
<blockquote>
<p>å¼€å¯é€‰é¡¹ï¼š <code>-XX:+UseParNewGC</code></p>
</blockquote>
<p>ParNew æ”¶é›†å™¨å…¶å®æ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-gc-par-new.jpg" alt="img"></p>
<p>ParNew æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<p>æ˜¯ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºé¦–é€‰å¹´è½»ä»£æ”¶é›†å™¨ï¼Œé™¤äº†æ€§èƒ½åŸå› å¤–ï¼Œä¸»è¦æ˜¯å› ä¸ºé™¤äº† Serial æ”¶é›†å™¨ï¼Œåªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨é…åˆå·¥ä½œã€‚</p>
<p>ParNew æ”¶é›†å™¨ä¹Ÿæ˜¯ä½¿ç”¨  <code>-XX:+UseConcMarkSweepGC</code>  åçš„é»˜è®¤å¹´è½»ä»£æ”¶é›†å™¨ã€‚</p>
<p>ParNew æ”¶é›†å™¨é»˜è®¤å¼€å¯çš„çº¿ç¨‹æ•°é‡ä¸ CPU æ•°é‡ç›¸åŒï¼Œå¯ä»¥ä½¿ç”¨ - <code>XX:ParallelGCThreads</code>  å‚æ•°æ¥è®¾ç½®çº¿ç¨‹æ•°ã€‚</p>
<h3 id="-832"><a class="markdownIt-Anchor" href="#-832">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_3-4-g1-%E6%94%B6%E9%9B%86%E5%99%A8">#</a>3.4. G1 æ”¶é›†å™¨</h3>
<blockquote>
<p>å¼€å¯é€‰é¡¹ï¼š <code>-XX:+UseG1GC</code></p>
</blockquote>
<p>å‰é¢æåˆ°çš„åƒåœ¾æ”¶é›†å™¨ä¸€èˆ¬ç­–ç•¥æ˜¯å…³æ³¨ååé‡æˆ–åœé¡¿æ—¶é—´ã€‚è€Œ <strong>G1 æ˜¯ä¸€ç§å…¼é¡¾ååé‡å’Œåœé¡¿æ—¶é—´çš„ GC æ”¶é›†å™¨</strong>ã€‚G1 æ˜¯ Oracle JDK9 ä»¥åçš„é»˜è®¤ GC æ”¶é›†å™¨ã€‚G1 å¯ä»¥ç›´è§‚çš„è®¾å®šåœé¡¿æ—¶é—´çš„ç›®æ ‡ï¼Œç›¸æ¯”äº CMS GCï¼ŒG1 æœªå¿…èƒ½åšåˆ° CMS åœ¨æœ€å¥½æƒ…å†µä¸‹çš„å»¶æ—¶åœé¡¿ï¼Œä½†æ˜¯æœ€å·®æƒ…å†µè¦å¥½å¾ˆå¤šã€‚</p>
<p>G1 æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¼•å…¥åˆ†åŒºçš„æ€è·¯ï¼Œå¼±åŒ–äº†åˆ†ä»£çš„æ¦‚å¿µï¼Œåˆç†åˆ©ç”¨åƒåœ¾æ”¶é›†å„ä¸ªå‘¨æœŸçš„èµ„æºï¼Œè§£å†³äº†å…¶ä»–æ”¶é›†å™¨ç”šè‡³ CMS çš„ä¼—å¤šç¼ºé™·ã€‚</p>
<h4 id="-833"><a class="markdownIt-Anchor" href="#-833">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E5%88%86%E4%BB%A3%E5%92%8C%E5%88%86%E5%8C%BA">#</a>åˆ†ä»£å’Œåˆ†åŒº</h4>
<p>æ—§çš„åƒåœ¾æ”¶é›†å™¨ä¸€èˆ¬é‡‡å–åˆ†ä»£æ”¶é›†ï¼ŒJava å †è¢«åˆ†ä¸ºå¹´è½»ä»£ã€è€å¹´ä»£å’Œæ°¸ä¹…ä»£ã€‚æ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªå¹´è½»ä»£æˆ–è€…æ•´ä¸ªè€å¹´ä»£ã€‚</p>
<p>G1 å–æ¶ˆäº†æ°¸ä¹…ä»£ï¼Œå¹¶æŠŠå¹´è½»ä»£å’Œè€å¹´ä»£åˆ’åˆ†æˆå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œå¹´è½»ä»£å’Œè€å¹´ä»£ä¸å†ç‰©ç†éš”ç¦»ã€‚G1 å¯ä»¥ç›´æ¥å¯¹å¹´è½»ä»£å’Œè€å¹´ä»£ä¸€èµ·å›æ”¶ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/jvm/jvm-gc-g1-heap-allocation.png" alt="img"></p>
<p>é€šè¿‡å¼•å…¥ Region çš„æ¦‚å¿µï¼Œä»è€Œå°†åŸæ¥çš„ä¸€æ•´å—å†…å­˜ç©ºé—´åˆ’åˆ†æˆå¤šä¸ªçš„å°ç©ºé—´ï¼Œä½¿å¾—æ¯ä¸ªå°ç©ºé—´å¯ä»¥å•ç‹¬è¿›è¡Œåƒåœ¾å›æ”¶ã€‚è¿™ç§åˆ’åˆ†æ–¹æ³•å¸¦æ¥äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½¿å¾—å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹æˆä¸ºå¯èƒ½ã€‚é€šè¿‡è®°å½•æ¯ä¸ª Region åƒåœ¾å›æ”¶æ—¶é—´ä»¥åŠå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ï¼ˆè¿™ä¸¤ä¸ªå€¼æ˜¯é€šè¿‡è¿‡å»å›æ”¶çš„ç»éªŒè·å¾—ï¼‰ï¼Œå¹¶ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„ Regionã€‚</p>
<p>æ¯ä¸ª Region éƒ½æœ‰ä¸€ä¸ª Remembered Setï¼Œç”¨æ¥è®°å½•è¯¥ Region å¯¹è±¡çš„å¼•ç”¨å¯¹è±¡æ‰€åœ¨çš„ Regionã€‚é€šè¿‡ä½¿ç”¨ Remembered Setï¼Œåœ¨åšå¯è¾¾æ€§åˆ†æçš„æ—¶å€™å°±å¯ä»¥é¿å…å…¨å †æ‰«æã€‚</p>
<h4 id="-834"><a class="markdownIt-Anchor" href="#-834">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#g1-%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6">#</a>G1 å›æ”¶æœºåˆ¶</h4>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jvm-gc-g1.jpg" alt="img"></p>
<p>G1 æ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾</p>
<p>å¦‚æœä¸è®¡ç®—ç»´æŠ¤ Remembered Set çš„æ“ä½œï¼ŒG1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>åˆå§‹æ ‡è®°</strong></li>
<li><strong>å¹¶å‘æ ‡è®°</strong></li>
<li><strong>æœ€ç»ˆæ ‡è®°</strong> - ä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹çš„ Remembered Set Logs é‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠ Remembered Set Logs çš„æ•°æ®åˆå¹¶åˆ° Remembered Set ä¸­ã€‚è¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚</li>
<li><strong>ç­›é€‰å›æ”¶</strong> - é¦–å…ˆå¯¹å„ä¸ª Region ä¸­çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„ GC åœé¡¿æ˜¯æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ã€‚æ­¤é˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ† Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…åº¦æé«˜æ”¶é›†æ•ˆç‡ã€‚</li>
</ol>
<p>å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ç©ºé—´æ•´åˆï¼šæ•´ä½“æ¥çœ‹æ˜¯åŸºäº â€œæ ‡è®° - æ•´ç†â€ ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ª Region ä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäº â€œå¤åˆ¶â€ ç®—æ³•å®ç°çš„ï¼Œè¿™æ„å‘³ç€è¿è¡ŒæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ã€‚</li>
<li>å¯é¢„æµ‹çš„åœé¡¿ï¼šèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨ GC ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’ã€‚</li>
</ul>
<h4 id="-835"><a class="markdownIt-Anchor" href="#-835">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#g1-%E5%9B%9E%E6%94%B6%E5%B9%B4%E8%BD%BB%E4%BB%A3%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4">#</a>G1 å›æ”¶å¹´è½»ä»£è¯¦ç»†æ­¥éª¤</h4>
<p><strong>ï¼ˆ1ï¼‰G1 åˆå§‹å †ç©ºé—´</strong></p>
<p>å †ç©ºé—´æ˜¯ä¸€ä¸ªè¢«åˆ†æˆè®¸å¤šå›ºå®šå¤§å°åŒºåŸŸçš„å†…å­˜å—ã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide8.png" alt="img"> Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶é€‰å®šåŒºåŸŸå¤§å°ã€‚Java è™šæ‹Ÿæœºé€šå¸¸ä¼šæŒ‡å®š 2000 ä¸ªå·¦å³çš„å¤§å°ç›¸ç­‰ã€æ¯ä¸ªå¤§å°èŒƒå›´åœ¨ 1 åˆ° 32M çš„åŒºåŸŸã€‚</p>
<p><strong>ï¼ˆ2ï¼‰G1 å †ç©ºé—´åˆ†é…</strong></p>
<p>å®é™…ä¸Šï¼Œè¿™äº›åŒºåŸŸè¢«æ˜ å°„æˆ Edenã€Survivorã€å¹´è€ä»£ç©ºé—´çš„é€»è¾‘è¡¨è¿°å½¢å¼ã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide9.png" alt="img"> å›¾ç‰‡ä¸­çš„é¢œè‰²è¡¨æ˜äº†å“ªä¸ªåŒºåŸŸè¢«å…³è”ä¸Šä»€ä¹ˆè§’è‰²ã€‚æ´»è·ƒå¯¹è±¡ä»ä¸€ä¸ªåŒºåŸŸç–æ•£ï¼ˆå¤åˆ¶ã€ç§»åŠ¨) åˆ°å¦ä¸€ä¸ªåŒºåŸŸã€‚åŒºåŸŸè¢«è®¾è®¡ä¸ºå¹¶è¡Œçš„æ–¹å¼æ”¶é›†ï¼Œå¯ä»¥æš‚åœæˆ–è€…ä¸æš‚åœæ‰€æœ‰çš„å…¶å®ƒç”¨æˆ·çº¿ç¨‹ã€‚</p>
<p>æ˜æ˜¾çš„åŒºåŸŸå¯ä»¥è¢«åˆ†é…æˆ Edenã€Survivorã€Old åŒºåŸŸã€‚å¦å¤–ï¼Œæœ‰ç¬¬å››ç§ç±»å‹çš„åŒºåŸŸå«åš<em>æå¤§åŒºåŸŸ (Humongous regions)</em>ã€‚è¿™äº›åŒºåŸŸè¢«è®¾è®¡æˆä¿æŒæ ‡å‡†åŒºåŸŸå¤§å°çš„ 50% æˆ–è€…æ›´å¤§çš„å¯¹è±¡ã€‚å®ƒä»¬è¢«ä¿å­˜åœ¨ä¸€ä¸ªè¿ç»­çš„åŒºåŸŸé›†åˆé‡Œã€‚æœ€åï¼Œæœ€åä¸€ä¸ªç±»å‹çš„åŒºåŸŸå°±æ˜¯å †ç©ºé—´é‡Œæ²¡æœ‰ä½¿ç”¨çš„åŒºåŸŸã€‚</p>
<p>** æ³¨æ„ï¼š** å†™ä½œæ­¤æ–‡ç« æ—¶ï¼Œæ”¶é›†æå¤§å¯¹è±¡æ—¶è¿˜æ²¡æœ‰è¢«ä¼˜åŒ–ã€‚å› æ­¤ï¼Œä½ åº”è¯¥é¿å…åˆ›å»ºè¿™ä¸ªå¤§å°çš„å¯¹è±¡ã€‚</p>
<p><strong>ï¼ˆ3ï¼‰G1 çš„å¹´è½»ä»£</strong></p>
<p>å †ç©ºé—´è¢«åˆ†å‰²æˆå¤§çº¦ 2000 ä¸ªåŒºåŸŸã€‚æœ€å° 1Mï¼Œæœ€å¤§ 32Mï¼Œè“è‰²åŒºåŸŸä¿æŒå¹´è€ä»£å¯¹è±¡ï¼Œç»¿è‰²åŒºåŸŸä¿æŒå¹´è½»ä»£å¯¹è±¡ã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide10.png" alt="img"> ** æ³¨æ„ï¼š** åŒºåŸŸæ²¡æœ‰å¿…è¦åƒæ—§çš„æ”¶é›†å™¨ä¸€æ ·æ˜¯ä¿æŒè¿ç»­çš„ã€‚</p>
<p><strong>ï¼ˆ4ï¼‰G1 çš„å¹´è½»ä»£æ”¶é›†</strong></p>
<p>æ´»è·ƒå¯¹è±¡ä¼šè¢«ç–æ•£ï¼ˆå¤åˆ¶ã€ç§»åŠ¨ï¼‰åˆ°ä¸€ä¸ªæˆ–å¤šä¸ª survivor åŒºåŸŸã€‚å¦‚æœè¾¾åˆ°æ™‹å‡æ€»é˜ˆå€¼ï¼Œå¯¹è±¡ä¼šæ™‹å‡åˆ°å¹´è€ä»£åŒºåŸŸã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide11.png" alt="img"> è¿™æ˜¯ä¸€ä¸ª stop the world æš‚åœã€‚ä¸ºä¸‹ä¸€æ¬¡å¹´è½»ä»£åƒåœ¾å›æ”¶è®¡ç®— Eden å’Œ Survivor çš„å¤§å°ã€‚ä¿ç•™å®¡è®¡ä¿¡æ¯æœ‰åŠ©äºè®¡ç®—å¤§å°ã€‚ç±»ä¼¼ç›®æ ‡æš‚åœæ—¶é—´çš„äº‹æƒ…ä¼šè¢«è€ƒè™‘åœ¨å†…ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•ä½¿é‡è°ƒåŒºåŸŸå¤§å°å˜å¾—å¾ˆå®¹æ˜“ï¼ŒæŒ‰éœ€æŠŠå®ƒä»¬è°ƒå¤§æˆ–è°ƒå°ã€‚</p>
<p><strong>ï¼ˆ5ï¼‰G1 å¹´è½»ä»£å›æ”¶çš„å°¾å£°</strong></p>
<p>æ´»è·ƒå¯¹è±¡è¢«ç–æ•£åˆ° Survivor æˆ–è€…å¹´è€ä»£åŒºåŸŸã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide12.png" alt="img"> æœ€è¿‘æ™‹å‡çš„å¯¹è±¡æ˜¾ç¤ºä¸ºæ·±è“è‰²ã€‚Survivor åŒºåŸŸæ˜¾ç¤ºä¸ºç»¿è‰²ã€‚</p>
<p>å…³äº G1 çš„å¹´è½»ä»£å›æ”¶åšä»¥ä¸‹æ€»ç»“ï¼š</p>
<ul>
<li>å †ç©ºé—´æ˜¯ä¸€å—å•ç‹¬çš„å†…å­˜ç©ºé—´è¢«åˆ†å‰²æˆå¤šä¸ªåŒºåŸŸã€‚</li>
<li>å¹´è½»ä»£å†…å­˜æ˜¯ç”±ä¸€ç»„éè¿ç»­çš„åŒºåŸŸç»„æˆã€‚è¿™ä½¿å¾—éœ€è¦é‡è°ƒå¤§å°å˜å¾—å®¹æ˜“ã€‚</li>
<li>å¹´è½»ä»£åƒåœ¾å›æ”¶æ˜¯ stop the world äº‹ä»¶ï¼Œæ‰€æœ‰åº”ç”¨çº¿ç¨‹éƒ½ä¼šå› æ­¤æ“ä½œæš‚åœã€‚</li>
<li>å¹´è½»ä»£åƒåœ¾æ”¶é›†ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡Œå›æ”¶ã€‚</li>
<li>æ´»è·ƒå¯¹è±¡è¢«å¤åˆ¶åˆ°æ–°çš„ Survivor åŒºæˆ–è€…å¹´è€ä»£åŒºåŸŸã€‚</li>
</ul>
<h4 id="-836"><a class="markdownIt-Anchor" href="#-836">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#g1-%E5%9B%9E%E6%94%B6%E5%B9%B4%E8%80%81%E4%BB%A3%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4">#</a>G1 å›æ”¶å¹´è€ä»£è¯¦ç»†æ­¥éª¤</h4>
<p><strong>ï¼ˆ1ï¼‰åˆå§‹æ ‡è®°é˜¶æ®µ</strong></p>
<p>å¹´è½»ä»£åƒåœ¾æ”¶é›†è‚©è´Ÿç€æ´»è·ƒå¯¹è±¡åˆå§‹æ ‡è®°çš„ä»»åŠ¡ã€‚åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è¢«æ ‡ä¸º<em> GC pause (young)(inital-mark)</em></p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide13.png" alt="img"> <strong>ï¼ˆ2) å¹¶å‘æ ‡è®°é˜¶æ®µ</strong></p>
<p>å¦‚æœå‘ç°ç©ºåŒºåŸŸ (â€œXâ€ æ ‡ç¤ºçš„)ï¼Œåœ¨é‡æ–°æ ‡è®°é˜¶æ®µå®ƒä»¬ä¼šè¢«é©¬ä¸Šæ¸…é™¤æ‰ã€‚å½“ç„¶ï¼Œå†³å®šæ´»æ€§çš„å®¡è®¡ä¿¡æ¯ä¹Ÿåœ¨æ­¤æ—¶è¢«è®¡ç®—ã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide14.png" alt="img"> <strong>ï¼ˆ3) é‡æ–°æ ‡è®°é˜¶æ®µ</strong></p>
<p>ç©ºçš„åŒºåŸŸè¢«æ¸…é™¤å’Œå›æ”¶æ‰ã€‚æ‰€æœ‰åŒºåŸŸçš„æ´»æ€§åœ¨æ­¤æ—¶è®¡ç®—ã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide15.png" alt="img"> <strong>ï¼ˆ4) å¤åˆ¶ / æ¸…ç†é˜¶æ®µ</strong></p>
<p>G1 é€‰æ‹©æ´»æ€§æœ€ä½çš„åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸèƒ½å¤Ÿä»¥æœ€å¿«çš„é€Ÿåº¦å›æ”¶ã€‚ç„¶åè¿™äº›åŒºåŸŸä¼šåœ¨å¹´è½»ä»£åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­è¢«å›æ”¶ã€‚åœ¨æ—¥å¿—ä¸­è¢«æŒ‡ç¤ºä¸º *[GC pause (mixed)]*ã€‚æ‰€ä»¥å¹´è½»ä»£å’Œå¹´è€ä»£åœ¨åŒä¸€æ—¶é—´è¢«å›æ”¶ã€‚</p>
<p><img src="http://www.oracle.com/webfolder/technetwork/tutorials/obe/java/G1GettingStarted/images/slide16.png" alt="img"> <strong>ï¼ˆ5) å¤åˆ¶ / æ¸…ç†é˜¶æ®µä¹‹å</strong></p>
<p>è¢«é€‰æ‹©çš„åŒºåŸŸå·²ç»è¢«å›æ”¶å’Œå‹ç¼©åˆ°å›¾ä¸­æ˜¾ç¤ºçš„æ·±è“è‰²åŒºå’Œæ·±ç»¿è‰²åŒºä¸­ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/slide17.png" alt="img"></p>
<h3 id="-837"><a class="markdownIt-Anchor" href="#-837">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_3-5-%E6%80%BB%E7%BB%93">#</a>3.5. æ€»ç»“</h3>
<table>
<thead>
<tr>
<th style="text-align:center">æ”¶é›†å™¨</th>
<th style="text-align:center">ä¸²è¡Œ / å¹¶è¡Œ / å¹¶å‘</th>
<th style="text-align:center">å¹´è½»ä»£ / è€å¹´ä»£</th>
<th style="text-align:center">æ”¶é›†ç®—æ³•</th>
<th style="text-align:center">ç›®æ ‡</th>
<th style="text-align:center">é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><strong>Serial</strong></td>
<td style="text-align:center">ä¸²è¡Œ</td>
<td style="text-align:center">å¹´è½»ä»£</td>
<td style="text-align:center">å¤åˆ¶</td>
<td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td style="text-align:center">å• CPU ç¯å¢ƒä¸‹çš„ Client æ¨¡å¼</td>
</tr>
<tr>
<td style="text-align:center"><strong>Serial Old</strong></td>
<td style="text-align:center">ä¸²è¡Œ</td>
<td style="text-align:center">è€å¹´ä»£</td>
<td style="text-align:center">æ ‡è®° - æ•´ç†</td>
<td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td style="text-align:center">å• CPU ç¯å¢ƒä¸‹çš„ Client æ¨¡å¼ã€CMS çš„åå¤‡é¢„æ¡ˆ</td>
</tr>
<tr>
<td style="text-align:center"><strong>ParNew</strong></td>
<td style="text-align:center">ä¸²è¡Œ + å¹¶è¡Œ</td>
<td style="text-align:center">å¹´è½»ä»£</td>
<td style="text-align:center">å¤åˆ¶ç®—æ³•</td>
<td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td style="text-align:center">å¤š CPU ç¯å¢ƒæ—¶åœ¨ Server æ¨¡å¼ä¸‹ä¸ CMS é…åˆ</td>
</tr>
<tr>
<td style="text-align:center"><strong>Parallel Scavenge</strong></td>
<td style="text-align:center">ä¸²è¡Œ + å¹¶è¡Œ</td>
<td style="text-align:center">å¹´è½»ä»£</td>
<td style="text-align:center">å¤åˆ¶ç®—æ³•</td>
<td style="text-align:center">ååé‡ä¼˜å…ˆ</td>
<td style="text-align:center">åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</td>
</tr>
<tr>
<td style="text-align:center"><strong>Parallel Old</strong></td>
<td style="text-align:center">ä¸²è¡Œ + å¹¶è¡Œ</td>
<td style="text-align:center">è€å¹´ä»£</td>
<td style="text-align:center">æ ‡è®° - æ•´ç†</td>
<td style="text-align:center">ååé‡ä¼˜å…ˆ</td>
<td style="text-align:center">åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡</td>
</tr>
<tr>
<td style="text-align:center"><strong>CMS</strong></td>
<td style="text-align:center">å¹¶è¡Œ + å¹¶å‘</td>
<td style="text-align:center">è€å¹´ä»£</td>
<td style="text-align:center">æ ‡è®° - æ¸…é™¤</td>
<td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td style="text-align:center">é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ– B/S ç³»ç»ŸæœåŠ¡ç«¯ä¸Šçš„ Java åº”ç”¨</td>
</tr>
<tr>
<td style="text-align:center"><strong>G1</strong></td>
<td style="text-align:center">å¹¶è¡Œ + å¹¶å‘</td>
<td style="text-align:center">å¹´è½»ä»£ + è€å¹´ä»£</td>
<td style="text-align:center">æ ‡è®° - æ•´ç† + å¤åˆ¶ç®—æ³•</td>
<td style="text-align:center">å“åº”é€Ÿåº¦ä¼˜å…ˆ</td>
<td style="text-align:center">é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†æ¥æ›¿æ¢ CMS</td>
</tr>
</tbody>
</table>
<h2 id="-838"><a class="markdownIt-Anchor" href="#-838">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_4-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5">#</a>4. å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</h2>
<p>å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œä¹Ÿå°±æ˜¯åœ¨å †ä¸Šåˆ†é…ã€‚ä¸»è¦åˆ†é…åœ¨å¹´è½»ä»£çš„ Eden åŒºä¸Šï¼Œå°‘æ•°æƒ…å†µä¸‹ä¹Ÿå¯èƒ½ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ä¸­ã€‚</p>
<h3 id="-839"><a class="markdownIt-Anchor" href="#-839">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_4-1-minor-gc">#</a>4.1. Minor GC</h3>
<p><strong>å½“  <code>Eden</code>  åŒºç©ºé—´ä¸è¶³æ—¶ï¼Œè§¦å‘ Minor GC</strong>ã€‚</p>
<p><strong>Minor GC å‘ç”Ÿåœ¨å¹´è½»ä»£ä¸Š</strong>ï¼Œå› ä¸ºå¹´è½»ä»£å¯¹è±¡å­˜æ´»æ—¶é—´å¾ˆçŸ­ï¼Œå› æ­¤ Minor GC ä¼šé¢‘ç¹æ‰§è¡Œï¼Œæ‰§è¡Œçš„é€Ÿåº¦ä¸€èˆ¬ä¹Ÿä¼šæ¯”è¾ƒå¿«ã€‚</p>
<p>Minor GC å·¥ä½œæµç¨‹ï¼š</p>
<ol>
<li>Java åº”ç”¨ä¸æ–­åˆ›å»ºå¯¹è±¡ï¼Œé€šå¸¸éƒ½æ˜¯åˆ†é…åœ¨  <code>Eden</code>  åŒºåŸŸï¼Œå½“å…¶ç©ºé—´ä¸è¶³æ—¶ï¼ˆè¾¾åˆ°è®¾å®šçš„é˜ˆå€¼ï¼‰ï¼Œè§¦å‘ minor GCã€‚ä»ç„¶è¢«å¼•ç”¨çš„å¯¹è±¡ï¼ˆç»¿è‰²æ–¹å—ï¼‰å­˜æ´»ä¸‹æ¥ï¼Œè¢«å¤åˆ¶åˆ° JVM é€‰æ‹©çš„ Survivor åŒºåŸŸï¼Œè€Œæ²¡æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ï¼ˆé»„è‰²æ–¹å—ï¼‰åˆ™è¢«å›æ”¶ã€‚</li>
<li>ç»è¿‡ä¸€æ¬¡ Minor GCï¼ŒEden å°±ä¼šç©ºé—²ä¸‹æ¥ï¼Œç›´åˆ°å†æ¬¡è¾¾åˆ° Minor GC è§¦å‘æ¡ä»¶ã€‚è¿™æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ª Survivor åŒºåŸŸåˆ™ä¼šæˆä¸º  <code>To</code>  åŒºåŸŸï¼ŒEden åŒºåŸŸçš„å­˜æ´»å¯¹è±¡å’Œ  <code>From</code>  åŒºåŸŸå¯¹è±¡ï¼Œéƒ½ä¼šè¢«å¤åˆ¶åˆ°  <code>To</code>  åŒºåŸŸï¼Œå¹¶ä¸”å­˜æ´»çš„å¹´é¾„è®¡æ•°ä¼šè¢«åŠ  1ã€‚</li>
<li>ç±»ä¼¼ç¬¬äºŒæ­¥çš„è¿‡ç¨‹ä¼šå‘ç”Ÿå¾ˆå¤šæ¬¡ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¹´é¾„è®¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼Œè¿™æ—¶å€™å°±ä¼šå‘ç”Ÿæ‰€è°“çš„æ™‹å‡ï¼ˆPromotionï¼‰è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¶…è¿‡é˜ˆå€¼çš„å¯¹è±¡ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ã€‚è¿™ä¸ªé˜ˆå€¼æ˜¯å¯ä»¥é€šè¿‡  <code>-XX:MaxTenuringThreshold</code>  å‚æ•°æŒ‡å®šã€‚</li>
</ol>
<h3 id="-840"><a class="markdownIt-Anchor" href="#-840">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#_4-2-full-gc">#</a>4.2. Full GC</h3>
<p><strong>Full GC å‘ç”Ÿåœ¨è€å¹´ä»£ä¸Š</strong>ï¼Œè€å¹´ä»£å¯¹è±¡å’Œå¹´è½»ä»£çš„ç›¸åï¼Œå…¶å­˜æ´»æ—¶é—´é•¿ï¼Œå› æ­¤ Full GC å¾ˆå°‘æ‰§è¡Œï¼Œè€Œä¸”æ‰§è¡Œé€Ÿåº¦ä¼šæ¯” Minor GC æ…¢å¾ˆå¤šã€‚</p>
<h4 id="-841"><a class="markdownIt-Anchor" href="#-841">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5">#</a>å†…å­˜åˆ†é…ç­–ç•¥</h4>
<p><strong>ï¼ˆä¸€ï¼‰å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åˆ†é…</strong></p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹è±¡åœ¨å¹´è½»ä»£ Eden åŒºåˆ†é…ï¼Œå½“ Eden åŒºç©ºé—´ä¸å¤Ÿæ—¶ï¼Œå‘èµ· Minor GCã€‚</p>
<p><strong>ï¼ˆäºŒï¼‰å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong></p>
<p>å¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œæœ€å…¸å‹çš„å¤§å¯¹è±¡æ˜¯é‚£ç§å¾ˆé•¿çš„å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„ã€‚</p>
<p>ç»å¸¸å‡ºç°å¤§å¯¹è±¡ä¼šæå‰è§¦å‘åƒåœ¾æ”¶é›†ä»¥è·å–è¶³å¤Ÿçš„è¿ç»­ç©ºé—´åˆ†é…ç»™å¤§å¯¹è±¡ã€‚</p>
<p><code>-XX:PretenureSizeThreshold</code> ï¼Œå¤§äºæ­¤å€¼çš„å¯¹è±¡ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ï¼Œé¿å…åœ¨ Eden åŒºå’Œ Survivor åŒºä¹‹é—´çš„å¤§é‡å†…å­˜å¤åˆ¶ã€‚</p>
<p><strong>ï¼ˆä¸‰ï¼‰é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</strong></p>
<p>ä¸ºå¯¹è±¡å®šä¹‰å¹´é¾„è®¡æ•°å™¨ï¼Œå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ Minor GC ä¾ç„¶å­˜æ´»ï¼Œå°†ç§»åŠ¨åˆ° Survivor ä¸­ï¼Œå¹´é¾„å°±å¢åŠ  1 å²ï¼Œå¢åŠ åˆ°ä¸€å®šå¹´é¾„åˆ™ç§»åŠ¨åˆ°è€å¹´ä»£ä¸­ã€‚</p>
<p><code>-XX:MaxTenuringThreshold</code>  ç”¨æ¥å®šä¹‰å¹´é¾„çš„é˜ˆå€¼ã€‚</p>
<p><strong>ï¼ˆå››ï¼‰åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š</strong></p>
<p>è™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œåœ°è¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ°  <code>MaxTenuringThreshold</code>  æ‰èƒ½æ™‹å‡è€å¹´ä»£ï¼Œå¦‚æœåœ¨ Survivor åŒºä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œæ— éœ€ç­‰åˆ°  <code>MaxTenuringThreshold</code>  ä¸­è¦æ±‚çš„å¹´é¾„ã€‚</p>
<p><strong>ï¼ˆäº”ï¼‰ç©ºé—´åˆ†é…æ‹…ä¿</strong></p>
<p>åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå¹´è½»ä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´ï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œé‚£ä¹ˆ Minor GC å¯ä»¥ç¡®è®¤æ˜¯å®‰å…¨çš„ï¼›å¦‚æœä¸æˆç«‹çš„è¯è™šæ‹Ÿæœºä¼šæŸ¥çœ‹  <code>HandlePromotionFailure</code>  è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥ï¼Œå¦‚æœå…è®¸é‚£ä¹ˆå°±ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•ç€è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œå°½ç®¡è¿™æ¬¡ Minor GC æ˜¯æœ‰é£é™©çš„ï¼›å¦‚æœå°äºï¼Œæˆ–è€…  <code>HandlePromotionFailure</code>  è®¾ç½®ä¸å…è®¸å†’é™©ï¼Œé‚£è¿™æ—¶ä¹Ÿè¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡ Full GCã€‚</p>
<h4 id="-842"><a class="markdownIt-Anchor" href="#-842">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gc.html#full-gc-%E7%9A%84%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6">#</a>Full GC çš„è§¦å‘æ¡ä»¶</h4>
<p>å¯¹äº Minor GCï¼Œå…¶è§¦å‘æ¡ä»¶éå¸¸ç®€å•ï¼Œå½“ Eden åŒºç©ºé—´æ»¡æ—¶ï¼Œå°±å°†è§¦å‘ä¸€æ¬¡ Minor GCã€‚è€Œ Full GC åˆ™ç›¸å¯¹å¤æ‚ï¼Œæœ‰ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<p><strong>ï¼ˆ1ï¼‰è°ƒç”¨  <code>System.gc()</code> </strong></p>
<p>æ­¤æ–¹æ³•çš„è°ƒç”¨æ˜¯å»ºè®®è™šæ‹Ÿæœºè¿›è¡Œ Full GCï¼Œè™½ç„¶åªæ˜¯å»ºè®®è€Œéä¸€å®šï¼Œä½†å¾ˆå¤šæƒ…å†µä¸‹å®ƒä¼šè§¦å‘ Full GCï¼Œä»è€Œå¢åŠ  Full GC çš„é¢‘ç‡ï¼Œä¹Ÿå³å¢åŠ äº†é—´æ­‡æ€§åœé¡¿çš„æ¬¡æ•°ã€‚å› æ­¤å¼ºçƒˆå»ºè®®èƒ½ä¸ä½¿ç”¨æ­¤æ–¹æ³•å°±ä¸è¦ä½¿ç”¨ï¼Œè®©è™šæ‹Ÿæœºè‡ªå·±å»ç®¡ç†å®ƒçš„å†…å­˜ã€‚å¯é€šè¿‡  <code>-XX:DisableExplicitGC</code>  æ¥ç¦æ­¢ RMI è°ƒç”¨  <code>System.gc()</code> ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰è€å¹´ä»£ç©ºé—´ä¸è¶³</strong></p>
<p>è€å¹´ä»£ç©ºé—´ä¸è¶³çš„å¸¸è§åœºæ™¯ä¸ºå‰æ–‡æ‰€è®²çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ã€é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ç­‰ï¼Œå½“æ‰§è¡Œ Full GC åç©ºé—´ä»ç„¶ä¸è¶³ï¼Œåˆ™æŠ›å‡º  <code>java.lang.OutOfMemoryError: Java heap space</code> ã€‚ä¸ºé¿å…ä»¥ä¸ŠåŸå› å¼•èµ·çš„ Full GCï¼Œè°ƒä¼˜æ—¶åº”å°½é‡åšåˆ°è®©å¯¹è±¡åœ¨ Minor GC é˜¶æ®µè¢«å›æ”¶ã€è®©å¯¹è±¡åœ¨å¹´è½»ä»£å¤šå­˜æ´»ä¸€æ®µæ—¶é—´ä»¥åŠä¸è¦åˆ›å»ºè¿‡å¤§çš„å¯¹è±¡åŠæ•°ç»„ã€‚</p>
<p><strong>ï¼ˆ3ï¼‰æ–¹æ³•åŒºç©ºé—´ä¸è¶³</strong></p>
<p>JVM è§„èŒƒä¸­è¿è¡Œæ—¶æ•°æ®åŒºåŸŸä¸­çš„<strong>æ–¹æ³•åŒº</strong>ï¼Œåœ¨ HotSpot è™šæ‹Ÿæœºä¸­åˆè¢«ä¹ æƒ¯ç§°ä¸º<strong>æ°¸ä¹…ä»£</strong>ï¼Œæ°¸ä¹…ä»£ä¸­å­˜æ”¾çš„æ˜¯ç±»çš„æè¿°ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ï¼Œå½“ç³»ç»Ÿä¸­è¦åŠ è½½çš„ç±»ã€åå°„çš„ç±»å’Œè°ƒç”¨çš„æ–¹æ³•è¾ƒå¤šæ—¶ï¼Œæ°¸ä¹…ä»£å¯èƒ½ä¼šè¢«å æ»¡ï¼Œåœ¨æœªé…ç½®ä¸ºé‡‡ç”¨ CMS GC çš„æƒ…å†µä¸‹ä¹Ÿä¼šæ‰§è¡Œ Full GCã€‚å¦‚æœç»è¿‡ Full GC ä»ç„¶å›æ”¶ä¸äº†ï¼Œé‚£ä¹ˆ JVM ä¼šæŠ›å‡º  <code>java.lang.OutOfMemoryError: PermGen space</code>  é”™è¯¯ã€‚ä¸ºé¿å…æ°¸ä¹…ä»£å æ»¡é€ æˆ Full GC ç°è±¡ï¼Œå¯é‡‡ç”¨çš„æ–¹æ³•ä¸ºå¢å¤§ Perm Gen ç©ºé—´æˆ–è½¬ä¸ºä½¿ç”¨ CMS GCã€‚</p>
<p><strong>ï¼ˆ4ï¼‰Minor GC çš„å¹³å‡æ™‹å‡ç©ºé—´å¤§å°å¤§äºè€å¹´ä»£å¯ç”¨ç©ºé—´</strong></p>
<p>å¦‚æœå‘ç°ç»Ÿè®¡æ•°æ®è¯´ä¹‹å‰ Minor GC çš„å¹³å‡æ™‹å‡å¤§å°æ¯”ç›®å‰è€å¹´ä»£å‰©ä½™çš„ç©ºé—´å¤§ï¼Œåˆ™ä¸ä¼šè§¦å‘ Minor GC è€Œæ˜¯è½¬ä¸ºè§¦å‘ Full GCã€‚</p>
<p><strong>ï¼ˆ5ï¼‰å¯¹è±¡å¤§å°å¤§äº To åŒºå’Œè€å¹´ä»£çš„å¯ç”¨å†…å­˜</strong></p>
<p>ç”±  <code>Eden</code>  åŒºã€ <code>From</code>  åŒºå‘  <code>To</code>  åŒºå¤åˆ¶æ—¶ï¼Œå¯¹è±¡å¤§å°å¤§äº To åŒºå¯ç”¨å†…å­˜ï¼Œåˆ™æŠŠè¯¥å¯¹è±¡è½¬å­˜åˆ°è€å¹´ä»£ï¼Œä¸”è€å¹´ä»£çš„å¯ç”¨å†…å­˜å°äºè¯¥å¯¹è±¡å¤§å°</p>
<hr>
<h1 id="jvm-å­—èŠ‚ç "><a class="markdownIt-Anchor" href="#jvm-å­—èŠ‚ç ">#</a> JVM å­—èŠ‚ç </h1>
<p>Java ä¹‹æ‰€ä»¥å¯ä»¥ â€œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œâ€ï¼Œä¸€æ˜¯å› ä¸º JVM é’ˆå¯¹å„ç§æ“ä½œç³»ç»Ÿã€å¹³å°éƒ½è¿›è¡Œäº†å®šåˆ¶ï¼ŒäºŒæ˜¯å› ä¸ºæ— è®ºåœ¨ä»€ä¹ˆå¹³å°ï¼Œéƒ½å¯ä»¥ç¼–è¯‘ç”Ÿæˆå›ºå®šæ ¼å¼çš„å­—èŠ‚ç ï¼ˆ.class æ–‡ä»¶ï¼‰ä¾› JVM ä½¿ç”¨ã€‚</p>
<p><strong>.class æ–‡ä»¶æ˜¯ä¸€ç»„ä»¥ 8 ä½å­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµ</strong>ï¼Œå„ä¸ªæ•°æ®é¡¹ä¸¥æ ¼æŒ‰ç…§é¡ºåºç´§å‡‘åœ°æ’åˆ—åœ¨ .class æ–‡ä»¶ä¸­ï¼Œä¸­é—´æ²¡æœ‰æ·»åŠ ä»»ä½•åˆ†éš”ç¬¦ã€‚<strong>æ•´ä¸ª .class æ–‡ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ è¡¨</strong>ã€‚</p>
<ul>
<li>\1. å­—èŠ‚ç 
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#11-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%97%E8%8A%82%E7%A0%81">1.1. ä»€ä¹ˆæ˜¯å­—èŠ‚ç </a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#12-%E5%AD%97%E8%8A%82%E7%A0%81%E7%BB%93%E6%9E%84">1.2. å­—èŠ‚ç ç»“æ„</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#13-%E5%AD%97%E8%8A%82%E7%A0%81%E6%93%8D%E4%BD%9C%E9%9B%86%E5%90%88">1.3. å­—èŠ‚ç æ“ä½œé›†åˆ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#14-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E5%92%8C%E5%AD%97%E8%8A%82%E7%A0%81">1.4. æ“ä½œæ•°æ ˆå’Œå­—èŠ‚ç </a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#15-%E5%AD%97%E8%8A%82%E7%A0%81%E5%B7%A5%E5%85%B7">1.5. å­—èŠ‚ç å·¥å…·</a></li>
</ul>
</li>
<li>\2. å­—èŠ‚ç å¢å¼º
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#21-asm">2.1. Asm</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#22-javassist">2.2. Javassist</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#3-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">3. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-843"><a class="markdownIt-Anchor" href="#-843">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_1-%E5%AD%97%E8%8A%82%E7%A0%81">#</a>1. å­—èŠ‚ç </h2>
<h3 id="-844"><a class="markdownIt-Anchor" href="#-844">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%97%E8%8A%82%E7%A0%81">#</a>1.1. ä»€ä¹ˆæ˜¯å­—èŠ‚ç </h3>
<p>ä¹‹æ‰€ä»¥è¢«ç§°ä¹‹ä¸ºå­—èŠ‚ç ï¼Œæ˜¯å› ä¸ºå­—èŠ‚ç æ–‡ä»¶ç”±åå…­è¿›åˆ¶å€¼ç»„æˆï¼Œè€Œ JVM ä»¥ä¸¤ä¸ªåå…­è¿›åˆ¶å€¼ä¸ºä¸€ç»„ï¼Œå³ä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œè¯»å–ã€‚åœ¨ Java ä¸­ä¸€èˆ¬æ˜¯ç”¨  <code>javac</code>  å‘½ä»¤ç¼–è¯‘æºä»£ç ä¸ºå­—èŠ‚ç æ–‡ä»¶ï¼Œä¸€ä¸ª.java æ–‡ä»¶ä»ç¼–è¯‘åˆ°è¿è¡Œçš„ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf4493c822?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾1 Javaè¿è¡Œç¤ºæ„å›¾"></p>
<p>å¯¹äºå¼€å‘äººå‘˜ï¼Œäº†è§£å­—èŠ‚ç å¯ä»¥æ›´å‡†ç¡®ã€ç›´è§‚åœ°ç†è§£ Java è¯­è¨€ä¸­æ›´æ·±å±‚æ¬¡çš„ä¸œè¥¿ï¼Œæ¯”å¦‚é€šè¿‡å­—èŠ‚ç ï¼Œå¯ä»¥å¾ˆç›´è§‚åœ°çœ‹åˆ° Volatile å…³é”®å­—å¦‚ä½•åœ¨å­—èŠ‚ç ä¸Šç”Ÿæ•ˆã€‚å¦å¤–ï¼Œå­—èŠ‚ç å¢å¼ºæŠ€æœ¯åœ¨ Spring AOPã€å„ç§ ORM æ¡†æ¶ã€çƒ­éƒ¨ç½²ä¸­çš„åº”ç”¨å±¡è§ä¸é²œï¼Œæ·±å…¥ç†è§£å…¶åŸç†å¯¹äºæˆ‘ä»¬æ¥è¯´å¤§æœ‰è£¨ç›Šã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”±äº JVM è§„èŒƒçš„å­˜åœ¨ï¼Œåªè¦æœ€ç»ˆå¯ä»¥ç”Ÿæˆç¬¦åˆè§„èŒƒçš„å­—èŠ‚ç å°±å¯ä»¥åœ¨ JVM ä¸Šè¿è¡Œï¼Œå› æ­¤è¿™å°±ç»™äº†å„ç§è¿è¡Œåœ¨ JVM ä¸Šçš„è¯­è¨€ï¼ˆå¦‚ Scalaã€Groovyã€Kotlinï¼‰ä¸€ç§å¥‘æœºï¼Œå¯ä»¥æ‰©å±• Java æ‰€æ²¡æœ‰çš„ç‰¹æ€§æˆ–è€…å®ç°å„ç§è¯­æ³•ç³–ã€‚ç†è§£å­—èŠ‚ç åå†å­¦ä¹ è¿™äº›è¯­è¨€ï¼Œå¯ä»¥ â€œé€†æµè€Œä¸Šâ€ï¼Œä»å­—èŠ‚ç è§†è§’çœ‹å®ƒçš„è®¾è®¡æ€è·¯ï¼Œå­¦ä¹ èµ·æ¥ä¹Ÿ â€œæ˜“å¦‚åæŒâ€ã€‚</p>
<h3 id="-845"><a class="markdownIt-Anchor" href="#-845">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_1-2-%E5%AD%97%E8%8A%82%E7%A0%81%E7%BB%93%E6%9E%84">#</a>1.2. å­—èŠ‚ç ç»“æ„</h3>
<p>.java æ–‡ä»¶é€šè¿‡ javac ç¼–è¯‘åå°†å¾—åˆ°ä¸€ä¸ª.class æ–‡ä»¶ï¼Œæ¯”å¦‚ç¼–å†™ä¸€ä¸ªç®€å•çš„ ByteCodeDemo ç±»ï¼Œå¦‚ä¸‹å›¾ 2 çš„å·¦ä¾§éƒ¨åˆ†ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf44c9f803?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾2 ç¤ºä¾‹ä»£ç ï¼ˆå·¦ä¾§ï¼‰åŠå¯¹åº”çš„å­—èŠ‚ç ï¼ˆå³ä¾§ï¼‰"></p>
<p>ç¼–è¯‘åç”Ÿæˆ ByteCodeDemo.class æ–‡ä»¶ï¼Œæ‰“å¼€åæ˜¯ä¸€å †åå…­è¿›åˆ¶æ•°ï¼ŒæŒ‰å­—èŠ‚ä¸ºå•ä½è¿›è¡Œåˆ†å‰²åå±•ç¤ºå¦‚å›¾ 2 å³ä¾§éƒ¨åˆ†æ‰€ç¤ºã€‚ä¸Šæ–‡æåŠè¿‡ï¼ŒJVM å¯¹äºå­—èŠ‚ç æ˜¯æœ‰è§„èŒƒè¦æ±‚çš„ï¼Œé‚£ä¹ˆçœ‹ä¼¼æ‚ä¹±çš„åå…­è¿›åˆ¶ç¬¦åˆä»€ä¹ˆç»“æ„å‘¢ï¼ŸJVM è§„èŒƒè¦æ±‚æ¯ä¸€ä¸ªå­—èŠ‚ç æ–‡ä»¶éƒ½è¦ç”±åéƒ¨åˆ†æŒ‰ç…§å›ºå®šçš„é¡ºåºç»„æˆï¼Œæ•´ä½“ç»“æ„å¦‚å›¾ 3 æ‰€ç¤ºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä¸€ä¸€ä»‹ç»è¿™åéƒ¨åˆ†ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf4505c321?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾3 JVMè§„å®šçš„å­—èŠ‚ç ç»“æ„"></p>
<p><strong>ï¼ˆ1ï¼‰é­”æ•°ï¼ˆMagic Numberï¼‰</strong></p>
<p>æ¯ä¸ª  <code>.class</code>  æ–‡ä»¶çš„å¤´ 4 ä¸ªå­—èŠ‚ç§°ä¸º <strong> <code>é­”æ•°ï¼ˆmagic numberï¼‰</code> </strong>ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®å®šè¿™ä¸ªæ–‡ä»¶æ˜¯å¦ä¸ºä¸€ä¸ªèƒ½è¢«è™šæ‹Ÿæœºæ¥æ”¶çš„  <code>.class</code>  æ–‡ä»¶ã€‚é­”æ•°çš„å›ºå®šå€¼ä¸ºï¼š <code>0xCAFEBABE</code> ã€‚</p>
<blockquote>
<p>æœ‰è¶£çš„æ˜¯ï¼Œé­”æ•°çš„å›ºå®šå€¼æ˜¯ Java ä¹‹çˆ¶ James Gosling åˆ¶å®šçš„ï¼Œä¸º CafeBabeï¼ˆå’–å•¡å®è´ï¼‰ï¼Œè€Œ Java çš„å›¾æ ‡ä¸ºä¸€æ¯å’–å•¡ã€‚</p>
</blockquote>
<p><strong>ï¼ˆ2ï¼‰ç‰ˆæœ¬å·ï¼ˆVersionï¼‰</strong></p>
<p>ç‰ˆæœ¬å·ä¸ºé­”æ•°ä¹‹åçš„ 4 ä¸ªå­—èŠ‚ï¼Œ<strong>å‰ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºæ¬¡ç‰ˆæœ¬å·ï¼ˆMinor Versionï¼‰ï¼Œåä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸»ç‰ˆæœ¬å·ï¼ˆMajor Versionï¼‰</strong>ã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ºï¼šâ€œ00 00 00 34â€ã€‚é‚£ä¹ˆï¼Œæ¬¡ç‰ˆæœ¬å·è½¬åŒ–ä¸ºåè¿›åˆ¶ä¸º 0ï¼Œä¸»ç‰ˆæœ¬å·è½¬åŒ–ä¸ºåè¿›åˆ¶ä¸º 52ï¼Œåœ¨ Oracle å®˜ç½‘ä¸­æŸ¥è¯¢åºå· 52 å¯¹åº”çš„ä¸»ç‰ˆæœ¬å·ä¸º 1.8ï¼Œæ‰€ä»¥ç¼–è¯‘è¯¥æ–‡ä»¶çš„ Java ç‰ˆæœ¬å·ä¸º 1.8.0ã€‚</p>
<p><strong>ï¼ˆ3ï¼‰å¸¸é‡æ± ï¼ˆConstant Poolï¼‰</strong></p>
<p>ç´§æ¥ç€ä¸»ç‰ˆæœ¬å·ä¹‹åçš„å­—èŠ‚ä¸ºå¸¸é‡æ± å…¥å£ã€‚</p>
<p>å¸¸é‡æ± ä¸»è¦å­˜æ”¾ä¸¤ç±»å¸¸é‡ï¼š</p>
<ul>
<li><strong>å­—é¢é‡</strong> - å¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€å£°æ˜ä¸º  <code>final</code>  çš„å¸¸é‡å€¼ã€‚</li>
<li>ç¬¦å·å¼•ç”¨
<ul>
<li>ç±»å’Œæ¥å£çš„å…¨é™å®šå</li>
<li>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</li>
<li>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</li>
</ul>
</li>
</ul>
<p>å¸¸é‡æ± æ•´ä½“ä¸Šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šå¸¸é‡æ± è®¡æ•°å™¨ä»¥åŠå¸¸é‡æ± æ•°æ®åŒºï¼Œå¦‚ä¸‹å›¾ 4 æ‰€ç¤ºã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf460b4b9d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾4 å¸¸é‡æ± çš„ç»“æ„"></p>
<ul>
<li><strong>å¸¸é‡æ± è®¡æ•°å™¨ï¼ˆconstant_pool_countï¼‰</strong> - ç”±äºå¸¸é‡çš„æ•°é‡ä¸å›ºå®šï¼Œæ‰€ä»¥éœ€è¦å…ˆæ”¾ç½®ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºå¸¸é‡æ± å®¹é‡è®¡æ•°å€¼ã€‚å›¾ 2 ä¸­ç¤ºä¾‹ä»£ç çš„å­—èŠ‚ç å‰ 10 ä¸ªå­—èŠ‚å¦‚ä¸‹å›¾ 5 æ‰€ç¤ºï¼Œå°†åå…­è¿›åˆ¶çš„ 24 è½¬åŒ–ä¸ºåè¿›åˆ¶å€¼ä¸º 36ï¼Œæ’é™¤æ‰ä¸‹æ ‡ â€œ0â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªç±»æ–‡ä»¶ä¸­å…±æœ‰ 35 ä¸ªå¸¸é‡ã€‚</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf44f56bb2?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾5 å‰åä¸ªå­—èŠ‚åŠå«ä¹‰"></p>
<ul>
<li><strong>å¸¸é‡æ± æ•°æ®åŒº</strong> - æ•°æ®åŒºæ˜¯ç”±ï¼ˆ <code>constant_pool_count-1</code> ï¼‰ä¸ª cp_info ç»“æ„ç»„æˆï¼Œä¸€ä¸ª cp_info ç»“æ„å¯¹åº”ä¸€ä¸ªå¸¸é‡ã€‚åœ¨å­—èŠ‚ç ä¸­å…±æœ‰ 14 ç§ç±»å‹çš„ cp_infoï¼ˆå¦‚ä¸‹å›¾ 6 æ‰€ç¤ºï¼‰ï¼Œæ¯ç§ç±»å‹çš„ç»“æ„éƒ½æ˜¯å›ºå®šçš„ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1986868-831993b2dc19dd90.png" alt="img"></p>
<p>å…·ä½“ä»¥ CONSTANT_utf8_info ä¸ºä¾‹ï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹å›¾ 7 å·¦ä¾§æ‰€ç¤ºã€‚é¦–å…ˆä¸€ä¸ªå­—èŠ‚ â€œtagâ€ï¼Œå®ƒçš„å€¼å–è‡ªä¸Šå›¾ 6 ä¸­å¯¹åº”é¡¹çš„ Tagï¼Œç”±äºå®ƒçš„ç±»å‹æ˜¯ utf8_infoï¼Œæ‰€ä»¥å€¼ä¸º â€œ01â€ã€‚æ¥ä¸‹æ¥ä¸¤ä¸ªå­—èŠ‚æ ‡è¯†è¯¥å­—ç¬¦ä¸²çš„é•¿åº¦ Lengthï¼Œç„¶å Length ä¸ªå­—èŠ‚ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²å…·ä½“çš„å€¼ã€‚ä»å›¾ 2 ä¸­çš„å­—èŠ‚ç æ‘˜å–ä¸€ä¸ª cp_info ç»“æ„ï¼Œå¦‚ä¸‹å›¾ 7 å³ä¾§æ‰€ç¤ºã€‚å°†å®ƒç¿»è¯‘è¿‡æ¥åï¼Œå…¶å«ä¹‰ä¸ºï¼šè¯¥å¸¸é‡ç±»å‹ä¸º utf8 å­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¸ºä¸€å­—èŠ‚ï¼Œæ•°æ®ä¸º â€œaâ€ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf731b4fee?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾7 CONSTANT_utf8_infoçš„ç»“æ„ï¼ˆå·¦ï¼‰åŠç¤ºä¾‹ï¼ˆå³ï¼‰"></p>
<p>å…¶ä»–ç±»å‹çš„ cp_info ç»“æ„åœ¨æœ¬æ–‡ä¸å†èµ˜è¿°ï¼Œæ•´ä½“ç»“æ„å¤§åŒå°å¼‚ï¼Œéƒ½æ˜¯å…ˆé€šè¿‡ Tag æ¥æ ‡è¯†ç±»å‹ï¼Œç„¶ååç»­ n ä¸ªå­—èŠ‚æ¥æè¿°é•¿åº¦å’Œï¼ˆæˆ–ï¼‰æ•°æ®ã€‚å…ˆçŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œä»¥åå¯ä»¥é€šè¿‡ javap -verbose ByteCodeDemo å‘½ä»¤ï¼ŒæŸ¥çœ‹ JVM åç¼–è¯‘åçš„å®Œæ•´å¸¸é‡æ± ï¼Œå¦‚ä¸‹å›¾ 8 æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°åç¼–è¯‘ç»“æœå°†æ¯ä¸€ä¸ª cp_info ç»“æ„çš„ç±»å‹å’Œå€¼éƒ½å¾ˆæ˜ç¡®åœ°å‘ˆç°äº†å‡ºæ¥ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf732cbb78?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾8 å¸¸é‡æ± åç¼–è¯‘ç»“æœ"></p>
<p><strong>ï¼ˆ4ï¼‰è®¿é—®æ ‡å¿—</strong></p>
<p>ç´§æ¥ç€çš„ 2 ä¸ªå­—èŠ‚ä»£è¡¨è®¿é—®æ ‡å¿—ï¼Œè¿™ä¸ªæ ‡å¿—<strong>ç”¨äºè¯†åˆ«ä¸€äº›ç±»æˆ–è€…æ¥å£çš„è®¿é—®ä¿¡æ¯</strong>ï¼Œæè¿°è¯¥ Class æ˜¯ç±»è¿˜æ˜¯æ¥å£ï¼Œä»¥åŠæ˜¯å¦è¢«  <code>public</code> ã€ <code>abstract</code> ã€ <code>final</code>  ç­‰ä¿®é¥°ç¬¦ä¿®é¥°ã€‚</p>
<p>JVM è§„èŒƒè§„å®šäº†å¦‚ä¸‹å›¾ 9 çš„è®¿é—®æ ‡å¿—ï¼ˆAccess_Flagï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJVM å¹¶æ²¡æœ‰ç©·ä¸¾æ‰€æœ‰çš„è®¿é—®æ ‡å¿—ï¼Œè€Œæ˜¯ä½¿ç”¨æŒ‰ä½æˆ–æ“ä½œæ¥è¿›è¡Œæè¿°çš„ï¼Œæ¯”å¦‚æŸä¸ªç±»çš„ä¿®é¥°ç¬¦ä¸º Public Finalï¼Œåˆ™å¯¹åº”çš„è®¿é—®ä¿®é¥°ç¬¦çš„å€¼ä¸º ACC_PUBLIC | ACC_FINALï¼Œå³ 0x0001 | 0x0010=0x0011ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1561473228816.png" alt="img"> <strong>ï¼ˆ5) å½“å‰ç±»å</strong></p>
<p>è®¿é—®æ ‡å¿—åçš„ 2 ä¸ªå­—èŠ‚ï¼Œæè¿°çš„æ˜¯å½“å‰ç±»çš„å…¨é™å®šåã€‚è¿™ä¸¤ä¸ªå­—èŠ‚ä¿å­˜çš„å€¼ä¸ºå¸¸é‡æ± ä¸­çš„ç´¢å¼•å€¼ï¼Œæ ¹æ®ç´¢å¼•å€¼å°±èƒ½åœ¨å¸¸é‡æ± ä¸­æ‰¾åˆ°è¿™ä¸ªç±»çš„å…¨é™å®šåã€‚</p>
<p><strong>ï¼ˆ6ï¼‰çˆ¶ç±»åç§°</strong></p>
<p>å½“å‰ç±»ååçš„ 2 ä¸ªå­—èŠ‚ï¼Œæè¿°çˆ¶ç±»çš„å…¨é™å®šåï¼ŒåŒä¸Šï¼Œä¿å­˜çš„ä¹Ÿæ˜¯å¸¸é‡æ± ä¸­çš„ç´¢å¼•å€¼ã€‚</p>
<p><strong>ï¼ˆ7ï¼‰æ¥å£ä¿¡æ¯</strong></p>
<p>çˆ¶ç±»åç§°åä¸º 2 å­—èŠ‚çš„æ¥å£è®¡æ•°å™¨ï¼Œæè¿°äº†è¯¥ç±»æˆ–çˆ¶ç±»å®ç°çš„æ¥å£æ•°é‡ã€‚ç´§æ¥ç€çš„ n ä¸ªå­—èŠ‚æ˜¯æ‰€æœ‰æ¥å£åç§°çš„å­—ç¬¦ä¸²å¸¸é‡çš„ç´¢å¼•å€¼ã€‚</p>
<p><strong>ï¼ˆ8ï¼‰å­—æ®µè¡¨</strong></p>
<p>å­—æ®µè¡¨ç”¨äºæè¿°ç±»å’Œæ¥å£ä¸­å£°æ˜çš„å˜é‡ï¼ŒåŒ…å«ç±»çº§åˆ«çš„å˜é‡ä»¥åŠå®ä¾‹å˜é‡ï¼Œä½†æ˜¯ä¸åŒ…å«æ–¹æ³•å†…éƒ¨å£°æ˜çš„å±€éƒ¨å˜é‡ã€‚å­—æ®µè¡¨ä¹Ÿåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºä¸¤ä¸ªå­—èŠ‚ï¼Œæè¿°å­—æ®µä¸ªæ•°ï¼›ç¬¬äºŒéƒ¨åˆ†æ˜¯æ¯ä¸ªå­—æ®µçš„è¯¦ç»†ä¿¡æ¯ fields_infoã€‚å­—æ®µè¡¨ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf73378788?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾10 å­—æ®µè¡¨ç»“æ„"></p>
<p>ä»¥å›¾ 2 ä¸­å­—èŠ‚ç çš„å­—æ®µè¡¨ä¸ºä¾‹ï¼Œå¦‚ä¸‹å›¾ 11 æ‰€ç¤ºã€‚å…¶ä¸­å­—æ®µçš„è®¿é—®æ ‡å¿—æŸ¥å›¾ 9ï¼Œ0002 å¯¹åº”ä¸º Privateã€‚é€šè¿‡ç´¢å¼•ä¸‹æ ‡åœ¨å›¾ 8 ä¸­å¸¸é‡æ± åˆ†åˆ«å¾—åˆ°å­—æ®µåä¸º â€œaâ€ï¼Œæè¿°ç¬¦ä¸º â€œIâ€ï¼ˆä»£è¡¨ intï¼‰ã€‚ç»¼ä¸Šï¼Œå°±å¯ä»¥å”¯ä¸€ç¡®å®šå‡ºä¸€ä¸ªç±»ä¸­å£°æ˜çš„å˜é‡ private int aã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf734cb782?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾11 å­—æ®µè¡¨ç¤ºä¾‹"></p>
<p><strong>ï¼ˆ9ï¼‰æ–¹æ³•è¡¨</strong></p>
<p>å­—æ®µè¡¨ç»“æŸåä¸ºæ–¹æ³•è¡¨ï¼Œæ–¹æ³•è¡¨ä¹Ÿæ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºä¸¤ä¸ªå­—èŠ‚æè¿°æ–¹æ³•çš„ä¸ªæ•°ï¼›ç¬¬äºŒéƒ¨åˆ†ä¸ºæ¯ä¸ªæ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯ã€‚æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯è¾ƒä¸ºå¤æ‚ï¼ŒåŒ…æ‹¬æ–¹æ³•çš„è®¿é—®æ ‡å¿—ã€æ–¹æ³•åã€æ–¹æ³•çš„æè¿°ç¬¦ä»¥åŠæ–¹æ³•çš„å±æ€§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf7333358e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾12 æ–¹æ³•è¡¨ç»“æ„"></p>
<p>æ–¹æ³•çš„æƒé™ä¿®é¥°ç¬¦ä¾ç„¶å¯ä»¥é€šè¿‡å›¾ 9 çš„å€¼æŸ¥è¯¢å¾—åˆ°ï¼Œæ–¹æ³•åå’Œæ–¹æ³•çš„æè¿°ç¬¦éƒ½æ˜¯å¸¸é‡æ± ä¸­çš„ç´¢å¼•å€¼ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å€¼åœ¨å¸¸é‡æ± ä¸­æ‰¾åˆ°ã€‚è€Œ â€œæ–¹æ³•çš„å±æ€§â€ è¿™ä¸€éƒ¨åˆ†è¾ƒä¸ºå¤æ‚ï¼Œç›´æ¥å€ŸåŠ© javap -verbose å°†å…¶åç¼–è¯‘ä¸ºäººå¯ä»¥è¯»æ‡‚çš„ä¿¡æ¯è¿›è¡Œè§£è¯»ï¼Œå¦‚å›¾ 13 æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°å±æ€§ä¸­åŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>â€œCode åŒºâ€ï¼šæºä»£ç å¯¹åº”çš„ JVM æŒ‡ä»¤æ“ä½œç ï¼Œåœ¨è¿›è¡Œå­—èŠ‚ç å¢å¼ºæ—¶é‡ç‚¹æ“ä½œçš„å°±æ˜¯ â€œCode åŒºâ€ è¿™ä¸€éƒ¨åˆ†ã€‚</li>
<li>â€œLineNumberTableâ€ï¼šè¡Œå·è¡¨ï¼Œå°† Code åŒºçš„æ“ä½œç å’Œæºä»£ç ä¸­çš„è¡Œå·å¯¹åº”ï¼ŒDebug æ—¶ä¼šèµ·åˆ°ä½œç”¨ï¼ˆæºä»£ç èµ°ä¸€è¡Œï¼Œéœ€è¦èµ°å¤šå°‘ä¸ª JVM æŒ‡ä»¤æ“ä½œç ï¼‰ã€‚</li>
<li>â€œLocalVariableTableâ€ï¼šæœ¬åœ°å˜é‡è¡¨ï¼ŒåŒ…å« This å’Œå±€éƒ¨å˜é‡ï¼Œä¹‹æ‰€ä»¥å¯ä»¥åœ¨æ¯ä¸€ä¸ªæ–¹æ³•å†…éƒ¨éƒ½å¯ä»¥è°ƒç”¨ Thisï¼Œæ˜¯å› ä¸º JVM å°† This ä½œä¸ºæ¯ä¸€ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°éšå¼è¿›è¡Œä¼ å…¥ã€‚å½“ç„¶ï¼Œè¿™æ˜¯é’ˆå¯¹é Static æ–¹æ³•è€Œè¨€ã€‚</li>
</ul>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf9d3f442f?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾13 åç¼–è¯‘åçš„æ–¹æ³•è¡¨"></p>
<p><strong>ï¼ˆ10ï¼‰é™„åŠ å±æ€§è¡¨</strong></p>
<p>å­—èŠ‚ç çš„æœ€åä¸€éƒ¨åˆ†ï¼Œè¯¥é¡¹å­˜æ”¾äº†åœ¨è¯¥æ–‡ä»¶ä¸­ç±»æˆ–æ¥å£æ‰€å®šä¹‰å±æ€§çš„åŸºæœ¬ä¿¡æ¯ã€‚</p>
<h3 id="-846"><a class="markdownIt-Anchor" href="#-846">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_1-3-%E5%AD%97%E8%8A%82%E7%A0%81%E6%93%8D%E4%BD%9C%E9%9B%86%E5%90%88">#</a>1.3. å­—èŠ‚ç æ“ä½œé›†åˆ</h3>
<p>åœ¨ä¸Šå›¾ 13 ä¸­ï¼ŒCode åŒºçš„çº¢è‰²ç¼–å· 0 ï½ 17ï¼Œå°±æ˜¯.java ä¸­çš„æ–¹æ³•æºä»£ç ç¼–è¯‘åè®© JVM çœŸæ­£æ‰§è¡Œçš„æ“ä½œç ã€‚ä¸ºäº†å¸®åŠ©äººä»¬ç†è§£ï¼Œåç¼–è¯‘åçœ‹åˆ°çš„æ˜¯åå…­è¿›åˆ¶æ“ä½œç æ‰€å¯¹åº”çš„åŠ©è®°ç¬¦ï¼Œåå…­è¿›åˆ¶å€¼æ“ä½œç ä¸åŠ©è®°ç¬¦çš„å¯¹åº”å…³ç³»ï¼Œä»¥åŠæ¯ä¸€ä¸ªæ“ä½œç çš„ç”¨å¤„å¯ä»¥æŸ¥çœ‹ Oracle å®˜æ–¹æ–‡æ¡£è¿›è¡Œäº†è§£ï¼Œåœ¨éœ€è¦ç”¨åˆ°æ—¶è¿›è¡ŒæŸ¥é˜…å³å¯ã€‚æ¯”å¦‚ä¸Šå›¾ä¸­ç¬¬ä¸€ä¸ªåŠ©è®°ç¬¦ä¸º iconst_2ï¼Œå¯¹åº”åˆ°å›¾ 2 ä¸­çš„å­—èŠ‚ç ä¸º 0x05ï¼Œç”¨å¤„æ˜¯å°† int å€¼ 2 å‹å…¥æ“ä½œæ•°æ ˆä¸­ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¯¹ 0~17 çš„åŠ©è®°ç¬¦ç†è§£åï¼Œå°±æ˜¯å®Œæ•´çš„ add () æ–¹æ³•çš„å®ç°ã€‚</p>
<h3 id="-847"><a class="markdownIt-Anchor" href="#-847">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_1-4-%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E5%92%8C%E5%AD%97%E8%8A%82%E7%A0%81">#</a>1.4. æ“ä½œæ•°æ ˆå’Œå­—èŠ‚ç </h3>
<p>JVM çš„æŒ‡ä»¤é›†æ˜¯åŸºäºæ ˆè€Œä¸æ˜¯å¯„å­˜å™¨ï¼ŒåŸºäºæ ˆå¯ä»¥å…·å¤‡å¾ˆå¥½çš„è·¨å¹³å°æ€§ï¼ˆå› ä¸ºå¯„å­˜å™¨æŒ‡ä»¤é›†å¾€å¾€å’Œç¡¬ä»¶æŒ‚é’©ï¼‰ï¼Œä½†ç¼ºç‚¹åœ¨äºï¼Œè¦å®ŒæˆåŒæ ·çš„æ“ä½œï¼ŒåŸºäºæ ˆçš„å®ç°éœ€è¦æ›´å¤šæŒ‡ä»¤æ‰èƒ½å®Œæˆï¼ˆå› ä¸ºæ ˆåªæ˜¯ä¸€ä¸ª FILO ç»“æ„ï¼Œéœ€è¦é¢‘ç¹å‹æ ˆå‡ºæ ˆï¼‰ã€‚å¦å¤–ï¼Œç”±äºæ ˆæ˜¯åœ¨å†…å­˜å®ç°çš„ï¼Œè€Œå¯„å­˜å™¨æ˜¯åœ¨ CPU çš„é«˜é€Ÿç¼“å­˜åŒºï¼Œç›¸è¾ƒè€Œè¨€ï¼ŒåŸºäºæ ˆçš„é€Ÿåº¦è¦æ…¢å¾ˆå¤šï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†è·¨å¹³å°æ€§è€Œåšå‡ºçš„ç‰ºç‰²ã€‚</p>
<p>æˆ‘ä»¬åœ¨ä¸Šæ–‡æ‰€è¯´çš„æ“ä½œç æˆ–è€…æ“ä½œé›†åˆï¼Œå…¶å®æ§åˆ¶çš„å°±æ˜¯è¿™ä¸ª JVM çš„æ“ä½œæ•°æ ˆã€‚ä¸ºäº†æ›´ç›´è§‚åœ°æ„Ÿå—æ“ä½œç æ˜¯å¦‚ä½•æ§åˆ¶æ“ä½œæ•°æ ˆçš„ï¼Œä»¥åŠç†è§£å¸¸é‡æ± ã€å˜é‡è¡¨çš„ä½œç”¨ï¼Œå°† add () æ–¹æ³•çš„å¯¹æ“ä½œæ•°æ ˆçš„æ“ä½œåˆ¶ä½œä¸º GIFï¼Œå¦‚ä¸‹å›¾ 14 æ‰€ç¤ºï¼Œå›¾ä¸­ä»…æˆªå–äº†å¸¸é‡æ± ä¸­è¢«å¼•ç”¨çš„éƒ¨åˆ†ï¼Œä»¥æŒ‡ä»¤ iconst_2 å¼€å§‹åˆ° ireturn ç»“æŸï¼Œä¸å›¾ 13 ä¸­ Code åŒº 0~17 çš„æŒ‡ä»¤ä¸€ä¸€å¯¹åº”ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdf9f0ee846?imageslim" alt="å›¾14 æ§åˆ¶æ“ä½œæ•°æ ˆç¤ºæ„å›¾"></p>
<h3 id="-848"><a class="markdownIt-Anchor" href="#-848">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_1-5-%E5%AD%97%E8%8A%82%E7%A0%81%E5%B7%A5%E5%85%B7">#</a>1.5. å­—èŠ‚ç å·¥å…·</h3>
<p>å¦‚æœæ¯æ¬¡æŸ¥çœ‹åç¼–è¯‘åçš„å­—èŠ‚ç éƒ½ä½¿ç”¨ javap å‘½ä»¤çš„è¯ï¼Œå¥½éå¸¸ç¹çã€‚è¿™é‡Œæ¨èä¸€ä¸ª Idea æ’ä»¶ï¼š<a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/9248-jclasslib-bytecode-viewer">jclasslib (opens new window)</a>ã€‚ä½¿ç”¨æ•ˆæœå¦‚å›¾ 15 æ‰€ç¤ºï¼Œä»£ç ç¼–è¯‘ååœ¨èœå•æ  &quot;View&quot; ä¸­é€‰æ‹© &quot;Show Bytecode With jclasslib&quot;ï¼Œå¯ä»¥å¾ˆç›´è§‚åœ°çœ‹åˆ°å½“å‰å­—èŠ‚ç æ–‡ä»¶çš„ç±»ä¿¡æ¯ã€å¸¸é‡æ± ã€æ–¹æ³•åŒºç­‰ä¿¡æ¯ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdfa08b6904?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾15 jclasslibæŸ¥çœ‹å­—èŠ‚ç "></p>
<h2 id="-849"><a class="markdownIt-Anchor" href="#-849">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_2-%E5%AD%97%E8%8A%82%E7%A0%81%E5%A2%9E%E5%BC%BA">#</a>2. å­—èŠ‚ç å¢å¼º</h2>
<h3 id="-850"><a class="markdownIt-Anchor" href="#-850">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_2-1-asm">#</a>2.1. Asm</h3>
<p>å¯¹äºéœ€è¦æ‰‹åŠ¨æ“çºµå­—èŠ‚ç çš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ Asmï¼Œå®ƒå¯ä»¥ç›´æ¥ç”Ÿäº§  <code>.class</code>  å­—èŠ‚ç æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»è¢«åŠ è½½å…¥ JVM ä¹‹å‰åŠ¨æ€ä¿®æ”¹ç±»è¡Œä¸ºï¼ˆå¦‚ä¸‹å›¾ 17 æ‰€ç¤ºï¼‰ã€‚</p>
<p>Asm çš„åº”ç”¨åœºæ™¯æœ‰ AOPï¼ˆCglib å°±æ˜¯åŸºäº Asmï¼‰ã€çƒ­éƒ¨ç½²ã€ä¿®æ”¹å…¶ä»– jar åŒ…ä¸­çš„ç±»ç­‰ã€‚å½“ç„¶ï¼Œæ¶‰åŠåˆ°å¦‚æ­¤åº•å±‚çš„æ­¥éª¤ï¼Œå®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/9/10/16d19bdfad737fd7?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="å›¾17 Asmä¿®æ”¹å­—èŠ‚ç "></p>
<p>Asm æœ‰ä¸¤ç±» APIï¼šæ ¸å¿ƒ API å’Œæ ‘å½¢ API</p>
<h4 id="-851"><a class="markdownIt-Anchor" href="#-851">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#%E6%A0%B8%E5%BF%83-api">#</a>æ ¸å¿ƒ API</h4>
<p>Asm Core API å¯ä»¥ç±»æ¯”è§£æ XML æ–‡ä»¶ä¸­çš„ SAX æ–¹å¼ï¼Œä¸éœ€è¦æŠŠè¿™ä¸ªç±»çš„æ•´ä¸ªç»“æ„è¯»å–è¿›æ¥ï¼Œå°±å¯ä»¥ç”¨æµå¼çš„æ–¹æ³•æ¥å¤„ç†å­—èŠ‚ç æ–‡ä»¶ã€‚å¥½å¤„æ˜¯éå¸¸èŠ‚çº¦å†…å­˜ï¼Œä½†æ˜¯ç¼–ç¨‹éš¾åº¦è¾ƒå¤§ã€‚ç„¶è€Œå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç¼–ç¨‹éƒ½ä½¿ç”¨ Core APIã€‚åœ¨ Core API ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªå…³é”®ç±»ï¼š</p>
<ul>
<li>ClassReaderï¼šç”¨äºè¯»å–å·²ç»ç¼–è¯‘å¥½çš„.class æ–‡ä»¶ã€‚</li>
<li>ClassWriterï¼šç”¨äºé‡æ–°æ„å»ºç¼–è¯‘åçš„ç±»ï¼Œå¦‚ä¿®æ”¹ç±»åã€å±æ€§ä»¥åŠæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆæ–°çš„ç±»çš„å­—èŠ‚ç æ–‡ä»¶ã€‚</li>
<li>å„ç§ Visitor ç±»ï¼šå¦‚ä¸Šæ‰€è¿°ï¼ŒCoreAPI æ ¹æ®å­—èŠ‚ç ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡å¤„ç†ï¼Œå¯¹äºå­—èŠ‚ç æ–‡ä»¶ä¸­ä¸åŒçš„åŒºåŸŸæœ‰ä¸åŒçš„ Visitorï¼Œæ¯”å¦‚ç”¨äºè®¿é—®æ–¹æ³•çš„ MethodVisitorã€ç”¨äºè®¿é—®ç±»å˜é‡çš„ FieldVisitorã€ç”¨äºè®¿é—®æ³¨è§£çš„ AnnotationVisitor ç­‰ã€‚ä¸ºäº†å®ç° AOPï¼Œé‡ç‚¹è¦ä½¿ç”¨çš„æ˜¯ MethodVisitorã€‚</li>
</ul>
<h4 id="-852"><a class="markdownIt-Anchor" href="#-852">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#%E6%A0%91%E5%BD%A2-api">#</a>æ ‘å½¢ API</h4>
<p>Asm Tree API å¯ä»¥ç±»æ¯”è§£æ XML æ–‡ä»¶ä¸­çš„ DOM æ–¹å¼ï¼ŒæŠŠæ•´ä¸ªç±»çš„ç»“æ„è¯»å–åˆ°å†…å­˜ä¸­ï¼Œç¼ºç‚¹æ˜¯æ¶ˆè€—å†…å­˜å¤šï¼Œä½†æ˜¯ç¼–ç¨‹æ¯”è¾ƒç®€å•ã€‚TreeApi ä¸åŒäº CoreAPIï¼ŒTreeAPI é€šè¿‡å„ç§ Node ç±»æ¥æ˜ å°„å­—èŠ‚ç çš„å„ä¸ªåŒºåŸŸï¼Œç±»æ¯” DOM èŠ‚ç‚¹ï¼Œå°±å¯ä»¥å¾ˆå¥½åœ°ç†è§£è¿™ç§ç¼–ç¨‹æ–¹å¼ã€‚</p>
<h3 id="-853"><a class="markdownIt-Anchor" href="#-853">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-bytecode.html#_2-2-javassist">#</a>2.2. Javassist</h3>
<p>åˆ©ç”¨ Javassist å®ç°å­—èŠ‚ç å¢å¼ºæ—¶ï¼Œå¯ä»¥æ— é¡»å…³æ³¨å­—èŠ‚ç åˆ»æ¿çš„ç»“æ„ï¼Œå…¶ä¼˜ç‚¹å°±åœ¨äºç¼–ç¨‹ç®€å•ã€‚ç›´æ¥ä½¿ç”¨ java ç¼–ç çš„å½¢å¼ï¼Œè€Œä¸éœ€è¦äº†è§£è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œå°±èƒ½åŠ¨æ€æ”¹å˜ç±»çš„ç»“æ„æˆ–è€…åŠ¨æ€ç”Ÿæˆç±»ã€‚</p>
<p>å…¶ä¸­æœ€é‡è¦çš„æ˜¯ ClassPoolã€CtClassã€CtMethodã€CtField è¿™å››ä¸ªç±»ï¼š</p>
<ul>
<li><code>CtClassï¼ˆcompile-time classï¼‰</code>  - ç¼–è¯‘æ—¶ç±»ä¿¡æ¯ï¼Œå®ƒæ˜¯ä¸€ä¸ª class æ–‡ä»¶åœ¨ä»£ç ä¸­çš„æŠ½è±¡è¡¨ç°å½¢å¼ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–ä¸€ä¸ª CtClass å¯¹è±¡ï¼Œç”¨æ¥è¡¨ç¤ºè¿™ä¸ªç±»æ–‡ä»¶ã€‚</li>
<li><code>ClassPool</code>  - ä»å¼€å‘è§†è§’æ¥çœ‹ï¼ŒClassPool æ˜¯ä¸€å¼ ä¿å­˜ CtClass ä¿¡æ¯çš„ HashTableï¼Œkey ä¸ºç±»åï¼Œvalue ä¸ºç±»åå¯¹åº”çš„ CtClass å¯¹è±¡ã€‚å½“æˆ‘ä»¬éœ€è¦å¯¹æŸä¸ªç±»è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå°±æ˜¯é€šè¿‡ pool.getCtClass (â€œclassNameâ€) æ–¹æ³•ä» pool ä¸­è·å–åˆ°ç›¸åº”çš„ CtClassã€‚</li>
<li><code>CtMethod</code> ã€ <code>CtField</code>  - è¿™ä¸¤ä¸ªæ¯”è¾ƒå¥½ç†è§£ï¼Œå¯¹åº”çš„æ˜¯ç±»ä¸­çš„æ–¹æ³•å’Œå±æ€§ã€‚</li>
</ul>
<hr>
<h1 id="jvm-ç±»åŠ è½½"><a class="markdownIt-Anchor" href="#jvm-ç±»åŠ è½½">#</a> JVM ç±»åŠ è½½</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200617145849.png" alt="img"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#1-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6">1. ç±»åŠ è½½æœºåˆ¶</a></li>
<li>\2. ç±»çš„ç”Ÿå‘½å‘¨æœŸ
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#21-%E4%B8%80%E5%8A%A0%E8%BD%BD">2.1. ï¼ˆä¸€ï¼‰åŠ è½½</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#22-%E4%BA%8C%E9%AA%8C%E8%AF%81">2.2. ï¼ˆäºŒï¼‰éªŒè¯</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#23-%E4%B8%89%E5%87%86%E5%A4%87">2.3. ï¼ˆä¸‰ï¼‰å‡†å¤‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#24-%E5%9B%9B%E8%A7%A3%E6%9E%90">2.4. ï¼ˆå››ï¼‰è§£æ</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#25-%E4%BA%94%E5%88%9D%E5%A7%8B%E5%8C%96">2.5. ï¼ˆäº”ï¼‰åˆå§‹åŒ–</a></li>
</ul>
</li>
<li>\3. ClassLoader
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#31-%E7%B1%BB%E4%B8%8E%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">3.1. ç±»ä¸ç±»åŠ è½½å™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#32-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%B1%BB">3.2. ç±»åŠ è½½å™¨åˆ†ç±»</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#33-%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE">3.3. åŒäº²å§”æ´¾</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#34-classloader-%E5%8F%82%E6%95%B0">3.4. ClassLoader å‚æ•°</a></li>
</ul>
</li>
<li>\4. ç±»çš„åŠ è½½
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#41-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F">4.1. ç±»åŠ è½½æ–¹å¼</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#42-%E5%8A%A0%E8%BD%BD%E7%B1%BB%E9%94%99%E8%AF%AF">4.2. åŠ è½½ç±»é”™è¯¯</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#5-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">5. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-854"><a class="markdownIt-Anchor" href="#-854">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_1-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6">#</a>1. ç±»åŠ è½½æœºåˆ¶</h2>
<blockquote>
<p>ç±»æ˜¯åœ¨è¿è¡ŒæœŸé—´åŠ¨æ€åŠ è½½çš„ã€‚</p>
</blockquote>
<p>ç±»çš„åŠ è½½æŒ‡çš„æ˜¯å°†ç±»çš„  <code>.class</code>  æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå°†å…¶æ”¾åœ¨è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œç„¶ååœ¨å †åŒºåˆ›å»ºä¸€ä¸ª <code>java.lang.Class</code>  å¯¹è±¡ï¼Œç”¨æ¥å°è£…ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ã€‚ç±»çš„åŠ è½½çš„æœ€ç»ˆäº§å“æ˜¯ä½äºå †åŒºä¸­çš„ <code>Class</code>  å¯¹è±¡ï¼Œ <code>Class</code>  å¯¹è±¡å°è£…äº†ç±»åœ¨æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”å‘ Java ç¨‹åºå‘˜æä¾›äº†è®¿é—®æ–¹æ³•åŒºå†…çš„æ•°æ®ç»“æ„çš„æ¥å£ã€‚</p>
<p>ç±»åŠ è½½å™¨å¹¶ä¸éœ€è¦ç­‰åˆ°æŸä¸ªç±»è¢« â€œé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨â€ æ—¶å†åŠ è½½å®ƒï¼ŒJVM è§„èŒƒå…è®¸ç±»åŠ è½½å™¨åœ¨é¢„æ–™æŸä¸ªç±»å°†è¦è¢«ä½¿ç”¨æ—¶å°±é¢„å…ˆåŠ è½½å®ƒï¼Œå¦‚æœåœ¨é¢„å…ˆåŠ è½½çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†.class æ–‡ä»¶ç¼ºå¤±æˆ–å­˜åœ¨é”™è¯¯ï¼Œç±»åŠ è½½å™¨å¿…é¡»åœ¨ç¨‹åºé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨è¯¥ç±»æ—¶æ‰æŠ¥å‘Šé”™è¯¯ï¼ˆLinkageError é”™è¯¯ï¼‰å¦‚æœè¿™ä¸ªç±»ä¸€ç›´æ²¡æœ‰è¢«ç¨‹åºä¸»åŠ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆç±»åŠ è½½å™¨å°±ä¸ä¼šæŠ¥å‘Šé”™è¯¯</p>
<h2 id="-855"><a class="markdownIt-Anchor" href="#-855">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_2-%E7%B1%BB%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">#</a>2. ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h2>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200617115110.png" alt="img"></p>
<p>Java ç±»çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>åŠ è½½ï¼ˆLoadingï¼‰</strong></li>
<li>é“¾æ¥ï¼ˆLinkingï¼‰
<ul>
<li><strong>éªŒè¯ï¼ˆVerificationï¼‰</strong></li>
<li><strong>å‡†å¤‡ï¼ˆPreparationï¼‰</strong></li>
<li><strong>è§£æï¼ˆResolutionï¼‰</strong></li>
</ul>
</li>
<li><strong>åˆå§‹åŒ–ï¼ˆInitializationï¼‰</strong></li>
<li><strong>ä½¿ç”¨ï¼ˆUsingï¼‰</strong></li>
<li><strong>å¸è½½ï¼ˆUnloadingï¼‰</strong></li>
</ul>
<p>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–å’Œå¸è½½è¿™ 5 ä¸ªé˜¶æ®µçš„é¡ºåºæ˜¯ç¡®å®šçš„ï¼Œç±»çš„åŠ è½½è¿‡ç¨‹å¿…é¡»æŒ‰ç…§è¿™ç§é¡ºåºæŒ‰éƒ¨å°±ç­åœ°å¼€å§‹ã€‚è€Œ<strong>è§£æè¿‡ç¨‹åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥åœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åå†å¼€å§‹ï¼Œè¿™æ˜¯ä¸ºäº†æ”¯æŒ Java çš„åŠ¨æ€ç»‘å®š</strong>ã€‚</p>
<p>ç±»åŠ è½½è¿‡ç¨‹æ˜¯æŒ‡åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æå’Œåˆå§‹åŒ–è¿™ 5 ä¸ªé˜¶æ®µã€‚</p>
<h3 id="-856"><a class="markdownIt-Anchor" href="#-856">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_2-1-%E4%B8%80-%E5%8A%A0%E8%BD%BD">#</a>2.1. ï¼ˆä¸€ï¼‰åŠ è½½</h3>
<p>åŠ è½½æ˜¯ç±»åŠ è½½çš„ä¸€ä¸ªé˜¶æ®µï¼Œæ³¨æ„ä¸è¦æ··æ·†ã€‚</p>
<p><strong>åŠ è½½ï¼Œæ˜¯æŒ‡æŸ¥æ‰¾å­—èŠ‚æµï¼Œå¹¶ä¸”æ®æ­¤åˆ›å»ºç±»çš„è¿‡ç¨‹</strong>ã€‚</p>
<p>åŠ è½½è¿‡ç¨‹å®Œæˆä»¥ä¸‹ä¸‰ä»¶äº‹ï¼š</p>
<ul>
<li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li>
<li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶å­˜å‚¨ç»“æ„ã€‚</li>
<li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„  <code>Class</code>  å¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£ã€‚</li>
</ul>
<p>å…¶ä¸­äºŒè¿›åˆ¶å­—èŠ‚æµå¯ä»¥ä»ä»¥ä¸‹æ–¹å¼ä¸­è·å–ï¼š</p>
<ul>
<li>ä» ZIP åŒ…è¯»å–ï¼Œè¿™å¾ˆå¸¸è§ï¼Œæœ€ç»ˆæˆä¸ºæ—¥å JARã€EARã€WAR æ ¼å¼çš„åŸºç¡€ã€‚</li>
<li>ä»ç½‘ç»œä¸­è·å–ï¼Œè¿™ç§åœºæ™¯æœ€å…¸å‹çš„åº”ç”¨æ˜¯ Appletã€‚</li>
<li>è¿è¡Œæ—¶è®¡ç®—ç”Ÿæˆï¼Œè¿™ç§åœºæ™¯ä½¿ç”¨å¾—æœ€å¤šå¾—å°±æ˜¯åŠ¨æ€ä»£ç†æŠ€æœ¯ï¼Œåœ¨  <code>java.lang.reflect.Proxy</code>  ä¸­ï¼Œå°±æ˜¯ç”¨äº†  <code>ProxyGenerator.generateProxyClass</code>  çš„ä»£ç†ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚</li>
<li>ç”±å…¶ä»–æ–‡ä»¶ç”Ÿæˆï¼Œå…¸å‹åœºæ™¯æ˜¯ JSP åº”ç”¨ï¼Œå³ç”± JSP æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„ Class ç±»ã€‚</li>
<li>ä»æ•°æ®åº“è¯»å–ï¼Œè¿™ç§åœºæ™¯ç›¸å¯¹å°‘è§ï¼Œä¾‹å¦‚æœ‰äº›ä¸­é—´ä»¶æœåŠ¡å™¨ï¼ˆå¦‚ SAP Netweaverï¼‰å¯ä»¥é€‰æ‹©æŠŠç¨‹åºå®‰è£…åˆ°æ•°æ®åº“ä¸­æ¥å®Œæˆç¨‹åºä»£ç åœ¨é›†ç¾¤é—´çš„åˆ†å‘ã€‚ â€¦</li>
</ul>
<blockquote>
<p>æ›´è¯¦ç»†å†…å®¹ä¼šåœ¨ <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#3-classloader">3. ClassLoader</a> ä»‹ç»ã€‚</p>
</blockquote>
<h3 id="-857"><a class="markdownIt-Anchor" href="#-857">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_2-2-%E4%BA%8C-%E9%AA%8C%E8%AF%81">#</a>2.2. ï¼ˆäºŒï¼‰éªŒè¯</h3>
<p>éªŒè¯æ˜¯é“¾æ¥é˜¶æ®µçš„ç¬¬ä¸€æ­¥ã€‚<strong>éªŒè¯çš„ç›®æ ‡æ˜¯ç¡®ä¿ Class æ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚</strong>ï¼Œå¹¶ä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚</p>
<p>éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆ 4 ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼š</p>
<ul>
<li><strong>æ–‡ä»¶æ ¼å¼éªŒè¯</strong> - éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆ Class æ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¹¶ä¸”èƒ½è¢«å½“å‰ç‰ˆæœ¬çš„è™šæ‹Ÿæœºå¤„ç†ã€‚</li>
<li><strong>å…ƒæ•°æ®éªŒè¯</strong> - å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä»¥ä¿è¯å…¶æè¿°çš„ä¿¡æ¯ç¬¦åˆ Java è¯­è¨€è§„èŒƒçš„è¦æ±‚ã€‚</li>
<li><strong>å­—èŠ‚ç éªŒè¯</strong> - é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®ä¿ç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•ã€ç¬¦åˆé€»è¾‘çš„ã€‚</li>
<li><strong>ç¬¦å·å¼•ç”¨éªŒè¯</strong> - å‘ç”Ÿåœ¨è™šæ‹Ÿæœºå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨çš„æ—¶å€™ï¼Œå¯¹ç±»è‡ªèº«ä»¥å¤–ï¼ˆå¸¸é‡æ± ä¸­çš„å„ç§ç¬¦å·å¼•ç”¨ï¼‰çš„ä¿¡æ¯è¿›è¡ŒåŒ¹é…æ€§æ ¡éªŒã€‚</li>
</ul>
<p>éªŒè¯é˜¶æ®µæ˜¯éå¸¸é‡è¦çš„ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒå¯¹ç¨‹åºè¿è¡ŒæœŸæ²¡æœ‰å½±å“ï¼Œå¦‚æœæ‰€å¼•ç”¨çš„ç±»ç»è¿‡åå¤éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘é‡‡ç”¨  <code>-Xverifynone</code>  å‚æ•°æ¥å…³é—­å¤§éƒ¨åˆ†çš„ç±»éªŒè¯æªæ–½ï¼Œä»¥ç¼©çŸ­è™šæ‹Ÿæœºç±»åŠ è½½çš„æ—¶é—´ã€‚</p>
<h3 id="-858"><a class="markdownIt-Anchor" href="#-858">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_2-3-%E4%B8%89-%E5%87%86%E5%A4%87">#</a>2.3. ï¼ˆä¸‰ï¼‰å‡†å¤‡</h3>
<p><strong>ç±»å˜é‡æ˜¯è¢« static ä¿®é¥°çš„å˜é‡ï¼Œå‡†å¤‡é˜¶æ®µä¸º static å˜é‡åœ¨æ–¹æ³•åŒºåˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–ä¸ºé»˜è®¤å€¼ï¼Œä½¿ç”¨çš„æ˜¯æ–¹æ³•åŒºçš„å†…å­˜ã€‚</strong></p>
<p>å®ä¾‹å˜é‡ä¸ä¼šåœ¨è¿™é˜¶æ®µåˆ†é…å†…å­˜ï¼Œå®ƒå°†ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€èµ·åˆ†é…åœ¨ Java å †ä¸­ã€‚ï¼ˆå®ä¾‹åŒ–ä¸æ˜¯ç±»åŠ è½½çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œç±»åŠ è½½å‘ç”Ÿåœ¨æ‰€æœ‰å®ä¾‹åŒ–æ“ä½œä¹‹å‰ï¼Œå¹¶ä¸”ç±»åŠ è½½åªè¿›è¡Œä¸€æ¬¡ï¼Œå®ä¾‹åŒ–å¯ä»¥è¿›è¡Œå¤šæ¬¡ï¼‰</p>
<p>åˆå§‹å€¼ä¸€èˆ¬ä¸º 0 å€¼ï¼Œä¾‹å¦‚ä¸‹é¢çš„ç±»å˜é‡ value è¢«åˆå§‹åŒ–ä¸º 0 è€Œä¸æ˜¯ 123ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœç±»å˜é‡æ˜¯å¸¸é‡ï¼Œé‚£ä¹ˆä¼šæŒ‰ç…§è¡¨è¾¾å¼æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸æ˜¯èµ‹å€¼ä¸º 0ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å‡†å¤‡é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨ Java å †ä¸­ã€‚</li>
<li>è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚  <code>0</code> ã€ <code>0L</code> ã€ <code>null</code> ã€ <code>false</code>  ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯è¢«åœ¨ Java ä»£ç ä¸­è¢«æ˜¾å¼åœ°èµ‹äºˆçš„å€¼ã€‚</li>
</ul>
<p>å‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼š <code>public static int value = 3</code> ï¼›</p>
<p>é‚£ä¹ˆå˜é‡ value åœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º 0ï¼Œè€Œä¸æ˜¯ 3ï¼Œå› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½• Java æ–¹æ³•ï¼Œè€ŒæŠŠ value èµ‹å€¼ä¸º 3 çš„ <code>public static</code>  æŒ‡ä»¤æ˜¯åœ¨ç¨‹åºç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨ <code>ï¼ˆï¼‰</code> æ–¹æ³•ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æŠŠ value èµ‹å€¼ä¸º 3 çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚</p>
<blockquote>
<p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å¯¹åŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œå¯¹äºç±»å˜é‡ï¼ˆstaticï¼‰å’Œå…¨å±€å˜é‡ï¼Œå¦‚æœä¸æ˜¾å¼åœ°å¯¹å…¶èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œåˆ™ç³»ç»Ÿä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œè€Œå¯¹äºå±€éƒ¨å˜é‡æ¥è¯´ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ã€‚</li>
<li>å¯¹äºåŒæ—¶è¢« static å’Œ final ä¿®é¥°çš„å¸¸é‡ï¼Œå¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™å°±ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œå¦åˆ™ç¼–è¯‘æ—¶ä¸é€šè¿‡ï¼›è€Œåªè¢« final ä¿®é¥°çš„å¸¸é‡åˆ™æ—¢å¯ä»¥åœ¨å£°æ˜æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»åˆå§‹åŒ–æ—¶æ˜¾å¼åœ°ä¸ºå…¶èµ‹å€¼ï¼Œæ€»ä¹‹ï¼Œåœ¨ä½¿ç”¨å‰å¿…é¡»ä¸ºå…¶æ˜¾å¼åœ°èµ‹å€¼ï¼Œç³»ç»Ÿä¸ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤é›¶å€¼ã€‚</li>
<li>å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ reference æ¥è¯´ï¼Œå¦‚æ•°ç»„å¼•ç”¨ã€å¯¹è±¡å¼•ç”¨ç­‰ï¼Œå¦‚æœæ²¡æœ‰å¯¹å…¶è¿›è¡Œæ˜¾å¼åœ°èµ‹å€¼è€Œç›´æ¥ä½¿ç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå…¶èµ‹äºˆé»˜è®¤çš„é›¶å€¼ï¼Œå³ nullã€‚</li>
<li>å¦‚æœåœ¨æ•°ç»„åˆå§‹åŒ–æ—¶æ²¡æœ‰å¯¹æ•°ç»„ä¸­çš„å„å…ƒç´ èµ‹å€¼ï¼Œé‚£ä¹ˆå…¶ä¸­çš„å…ƒç´ å°†æ ¹æ®å¯¹åº”çš„æ•°æ®ç±»å‹è€Œè¢«èµ‹äºˆé»˜è®¤çš„é›¶å€¼ã€‚</li>
</ul>
</blockquote>
<ul>
<li>å¦‚æœç±»å­—æ®µçš„å­—æ®µå±æ€§è¡¨ä¸­å­˜åœ¨ <code>ConstantValue</code>  å±æ€§ï¼Œå³åŒæ—¶è¢« final å’Œ static ä¿®é¥°ï¼Œé‚£ä¹ˆåœ¨å‡†å¤‡é˜¶æ®µå˜é‡ value å°±ä¼šè¢«åˆå§‹åŒ–ä¸º ConstValue å±æ€§æ‰€æŒ‡å®šçš„å€¼ã€‚</li>
</ul>
<p>å‡è®¾ä¸Šé¢çš„ç±»å˜é‡ value è¢«å®šä¹‰ä¸ºï¼š  <code>public static final int value = 3</code> ï¼›</p>
<p>ç¼–è¯‘æ—¶ Javac å°†ä¼šä¸º value ç”Ÿæˆ ConstantValue å±æ€§ï¼Œåœ¨å‡†å¤‡é˜¶æ®µè™šæ‹Ÿæœºå°±ä¼šæ ¹æ® <code>ConstantValue</code>  çš„è®¾ç½®å°† value èµ‹å€¼ä¸º 3ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸º static final å¸¸é‡åœ¨ç¼–è¯‘æœŸå°±å°†å…¶ç»“æœæ”¾å…¥äº†è°ƒç”¨å®ƒçš„ç±»çš„å¸¸é‡æ± ä¸­</p>
<h3 id="-859"><a class="markdownIt-Anchor" href="#-859">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_2-4-%E5%9B%9B-%E8%A7%A3%E6%9E%90">#</a>2.4. ï¼ˆå››ï¼‰è§£æ</h3>
<p>åœ¨ class æ–‡ä»¶è¢«åŠ è½½è‡³ Java è™šæ‹Ÿæœºä¹‹å‰ï¼Œè¿™ä¸ªç±»æ— æ³•çŸ¥é“å…¶ä»–ç±»åŠå…¶æ–¹æ³•ã€å­—æ®µæ‰€å¯¹åº”çš„å…·ä½“åœ°å€ï¼Œç”šè‡³ä¸çŸ¥é“è‡ªå·±æ–¹æ³•ã€å­—æ®µçš„åœ°å€ã€‚å› æ­¤ï¼Œæ¯å½“éœ€è¦å¼•ç”¨è¿™äº›æˆå‘˜æ—¶ï¼ŒJava ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªç¬¦å·å¼•ç”¨ã€‚åœ¨è¿è¡Œé˜¶æ®µï¼Œè¿™ä¸ªç¬¦å·å¼•ç”¨ä¸€èˆ¬éƒ½èƒ½å¤Ÿæ— æ­§ä¹‰åœ°å®šä½åˆ°å…·ä½“ç›®æ ‡ä¸Šã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«ç›®æ ‡æ–¹æ³•æ‰€åœ¨ç±»çš„åå­—ã€ç›®æ ‡æ–¹æ³•çš„åå­—ã€æ¥æ”¶å‚æ•°ç±»å‹ä»¥åŠè¿”å›å€¼ç±»å‹çš„ç¬¦å·å¼•ç”¨ï¼Œæ¥æŒ‡ä»£æ‰€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p><strong>è§£æé˜¶æ®µç›®æ ‡æ˜¯å°†å¸¸é‡æ± çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</strong>ã€‚è§£æåŠ¨ä½œä¸»è¦é’ˆå¯¹ç±»æˆ–æ¥å£ã€å­—æ®µã€ç±»æ–¹æ³•ã€æ¥å£æ–¹æ³•ã€æ–¹æ³•ç±»å‹ã€æ–¹æ³•å¥æŸ„å’Œè°ƒç”¨ç‚¹é™å®šç¬¦ 7 ç±»ç¬¦å·å¼•ç”¨è¿›è¡Œã€‚</p>
<ul>
<li><strong>ç¬¦å·å¼•ç”¨ï¼ˆSymbolic Referencesï¼‰</strong> - ç¬¦å·å¼•ç”¨ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚</li>
<li><strong>ç›´æ¥å¼•ç”¨ï¼ˆDirect Referenceï¼‰</strong> - ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ã€‚</li>
</ul>
<h3 id="-860"><a class="markdownIt-Anchor" href="#-860">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_2-5-%E4%BA%94-%E5%88%9D%E5%A7%8B%E5%8C%96">#</a>2.5. ï¼ˆäº”ï¼‰åˆå§‹åŒ–</h3>
<p>åœ¨ Java ä»£ç ä¸­ï¼Œå¦‚æœè¦åˆå§‹åŒ–ä¸€ä¸ªé™æ€å­—æ®µï¼Œå¯ä»¥åœ¨å£°æ˜æ—¶ç›´æ¥èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åœ¨é™æ€ä»£ç å—ä¸­å¯¹å…¶èµ‹å€¼ã€‚</p>
<p>å¦‚æœç›´æ¥èµ‹å€¼çš„é™æ€å­—æ®µè¢«  <code>final</code>  æ‰€ä¿®é¥°ï¼Œå¹¶ä¸”å®ƒçš„ç±»å‹æ˜¯åŸºæœ¬ç±»å‹æˆ–å­—ç¬¦ä¸²æ—¶ï¼Œé‚£ä¹ˆè¯¥å­—æ®µä¾¿ä¼šè¢« Java ç¼–è¯‘å™¨æ ‡è®°æˆå¸¸é‡å€¼ï¼ˆConstantValueï¼‰ï¼Œå…¶åˆå§‹åŒ–ç›´æ¥ç”± Java è™šæ‹Ÿæœºå®Œæˆã€‚é™¤æ­¤ä¹‹å¤–çš„ç›´æ¥èµ‹å€¼æ“ä½œï¼Œä»¥åŠæ‰€æœ‰é™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œåˆ™ä¼šè¢« Java ç¼–è¯‘å™¨ç½®äºåŒä¸€æ–¹æ³•ä¸­ï¼Œå¹¶æŠŠå®ƒå‘½åä¸º  <code>&lt; clinit &gt;</code> ã€‚</p>
<p>åˆå§‹åŒ–é˜¶æ®µæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­çš„å®šä¹‰çš„ Java ç¨‹åºä»£ç ã€‚åˆå§‹åŒ–ï¼Œ<strong>ä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ï¼ŒJVM è´Ÿè´£å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸»è¦å¯¹ç±»å˜é‡è¿›è¡Œåˆå§‹åŒ–</strong>ã€‚</p>
<h4 id="-861"><a class="markdownIt-Anchor" href="#-861">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E5%BC%8F">#</a>ç±»åˆå§‹åŒ–æ–¹å¼</h4>
<ul>
<li>å£°æ˜ç±»å˜é‡æ—¶æŒ‡å®šåˆå§‹å€¼</li>
<li>ä½¿ç”¨é™æ€ä»£ç å—ä¸ºç±»å˜é‡æŒ‡å®šåˆå§‹å€¼</li>
</ul>
<blockquote>
<p>åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»å˜é‡å·²ç»èµ‹è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œæ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºåˆ¶å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶å®ƒèµ„æºã€‚</p>
</blockquote>
<h4 id="-862"><a class="markdownIt-Anchor" href="#-862">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96%E6%AD%A5%E9%AA%A4">#</a>ç±»åˆå§‹åŒ–æ­¥éª¤</h4>
<ol>
<li>å¦‚æœç±»è¿˜æ²¡æœ‰è¢«åŠ è½½å’Œé“¾æ¥ï¼Œå¼€å§‹åŠ è½½è¯¥ç±»ã€‚</li>
<li>å¦‚æœè¯¥ç±»çš„ç›´æ¥çˆ¶ç±»è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå…ˆåˆå§‹åŒ–å…¶çˆ¶ç±»ã€‚</li>
<li>å¦‚æœè¯¥ç±»æœ‰åˆå§‹åŒ–è¯­å¥ï¼Œåˆ™ä¾æ¬¡æ‰§è¡Œè¿™äº›åˆå§‹åŒ–è¯­å¥ã€‚</li>
</ol>
<h4 id="-863"><a class="markdownIt-Anchor" href="#-863">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E6%9C%BA">#</a>ç±»åˆå§‹åŒ–æ—¶æœº</h4>
<p>åªæœ‰ä¸»åŠ¨å¼•ç”¨ç±»çš„æ—¶å€™æ‰ä¼šå¯¼è‡´ç±»çš„åˆå§‹åŒ–ã€‚</p>
<p><strong>ï¼ˆ1ï¼‰ä¸»åŠ¨å¼•ç”¨</strong></p>
<p>ç±»çš„ä¸»åŠ¨å¼•ç”¨åŒ…æ‹¬ä»¥ä¸‹å…­ç§ï¼š</p>
<ul>
<li><strong>åˆ›å»ºç±»çš„å®ä¾‹</strong> - ä¹Ÿå°±æ˜¯  <code>new</code>  å¯¹è±¡</li>
<li><strong>è®¿é—®é™æ€å˜é‡</strong> - è®¿é—®æŸä¸ªç±»æˆ–æ¥å£çš„é™æ€å˜é‡ï¼Œæˆ–è€…å¯¹è¯¥é™æ€å˜é‡èµ‹å€¼</li>
<li><strong>è®¿é—®é™æ€æ–¹æ³•</strong></li>
<li><strong>åå°„</strong> - å¦‚ <code>Class.forName(â€œcom.shengsiyuan.Testâ€)</code></li>
<li><strong>åˆå§‹åŒ–å­ç±»</strong> - åˆå§‹åŒ–æŸä¸ªç±»çš„å­ç±»ï¼Œåˆ™å…¶çˆ¶ç±»ä¹Ÿä¼šè¢«åˆå§‹åŒ–</li>
<li><strong>å¯åŠ¨ç±»</strong> - Java è™šæ‹Ÿæœºå¯åŠ¨æ—¶è¢«æ ‡æ˜ä¸ºå¯åŠ¨ç±»çš„ç±»ï¼ˆ <code>Java Test</code> ï¼‰ï¼Œç›´æ¥ä½¿ç”¨ <code>java.exe</code>  å‘½ä»¤æ¥è¿è¡ŒæŸä¸ªä¸»ç±»</li>
</ul>
<p><strong>ï¼ˆ2ï¼‰è¢«åŠ¨å¼•ç”¨</strong></p>
<p>ä»¥ä¸Š 5 ç§åœºæ™¯ä¸­çš„è¡Œä¸ºç§°ä¸ºå¯¹ä¸€ä¸ªç±»è¿›è¡Œä¸»åŠ¨å¼•ç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚è¢«åŠ¨å¼•ç”¨çš„å¸¸è§ä¾‹å­åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>é€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–</strong>ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">SubClass</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// value å­—æ®µåœ¨ SuperClass ä¸­å®šä¹‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><strong>é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–</strong>ã€‚è¯¥è¿‡ç¨‹ä¼šå¯¹æ•°ç»„ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œæ•°ç»„ç±»æ˜¯ä¸€ä¸ªç”±è™šæ‹Ÿæœºè‡ªåŠ¨ç”Ÿæˆçš„ã€ç›´æ¥ç»§æ‰¿è‡ª  <code>Object</code>  çš„å­ç±»ï¼Œå…¶ä¸­åŒ…å«äº†æ•°ç»„çš„å±æ€§å’Œæ–¹æ³•ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">SuperClass</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sca <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperClass</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šå¹¶æ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘<strong>å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–</strong>ã€‚</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ConstClass</span><span class="token punctuation">.</span>HELLOWORLD<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="-864"><a class="markdownIt-Anchor" href="#-864">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#%E7%B1%BB%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BB%86%E8%8A%82">#</a>ç±»åˆå§‹åŒ–ç»†èŠ‚</h4>
<p>ç±»åˆå§‹åŒ–  <code>&lt;clinit&gt;()</code>  æ–¹æ³•çš„ç»†èŠ‚ï¼š</p>
<ul>
<li>æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­æ‰€æœ‰ç±»å˜é‡çš„èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—ï¼ˆstatic {} å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„ï¼Œç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºå†³å®šã€‚ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œé™æ€è¯­å¥å—åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨å®ƒä¹‹å‰çš„ç±»å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒä¹‹åçš„ç±»å˜é‡åªèƒ½èµ‹å€¼ï¼Œä¸èƒ½è®¿é—®ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
        i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token comment">// ç»™å˜é‡èµ‹å€¼å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¿™å¥ç¼–è¯‘å™¨ä¼šæç¤ºâ€œéæ³•å‘å‰å¼•ç”¨â€</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>ä¸ç±»çš„æ„é€ å‡½æ•°ï¼ˆæˆ–è€…è¯´å®ä¾‹æ„é€ å™¨  <code>&lt;init&gt;()</code> ï¼‰ä¸åŒï¼Œä¸éœ€è¦æ˜¾å¼çš„è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ã€‚è™šæ‹Ÿæœºä¼šè‡ªåŠ¨ä¿è¯åœ¨å­ç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•è¿è¡Œä¹‹å‰ï¼Œçˆ¶ç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•å·²ç»æ‰§è¡Œç»“æŸã€‚å› æ­¤è™šæ‹Ÿæœºä¸­ç¬¬ä¸€ä¸ªæ‰§è¡Œ  <code>&lt;clinit&gt;()</code>  æ–¹æ³•çš„ç±»è‚¯å®šä¸º  <code>java.lang.Object</code> ã€‚</li>
<li>ç”±äºçˆ¶ç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•å…ˆæ‰§è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€è¯­å¥å—è¦ä¼˜äºå­ç±»çš„å˜é‡èµ‹å€¼æ“ä½œã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</li>
</ul>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">A</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">A</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Sub</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">B</span> <span class="token operator">=</span> <span class="token class-name">A</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Sub<span class="token punctuation">.</span>B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¾“å‡ºç»“æœæ˜¯çˆ¶ç±»ä¸­çš„é™æ€å˜é‡ A çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ 2ã€‚</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>&lt;clinit&gt;()</code>  æ–¹æ³•å¯¹äºç±»æˆ–æ¥å£ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸€ä¸ªç±»ä¸­ä¸åŒ…å«é™æ€è¯­å¥å—ï¼Œä¹Ÿæ²¡æœ‰å¯¹ç±»å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œç¼–è¯‘å™¨å¯ä»¥ä¸ä¸ºè¯¥ç±»ç”Ÿæˆ  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ã€‚</li>
<li>æ¥å£ä¸­ä¸å¯ä»¥ä½¿ç”¨é™æ€è¯­å¥å—ï¼Œä½†ä»ç„¶æœ‰ç±»å˜é‡åˆå§‹åŒ–çš„èµ‹å€¼æ“ä½œï¼Œå› æ­¤æ¥å£ä¸ç±»ä¸€æ ·éƒ½ä¼šç”Ÿæˆ  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ã€‚ä½†æ¥å£ä¸ç±»ä¸åŒçš„æ˜¯ï¼Œæ‰§è¡Œæ¥å£çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ä¸éœ€è¦å…ˆæ‰§è¡Œçˆ¶æ¥å£çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ã€‚åªæœ‰å½“çˆ¶æ¥å£ä¸­å®šä¹‰çš„å˜é‡ä½¿ç”¨æ—¶ï¼Œçˆ¶æ¥å£æ‰ä¼šåˆå§‹åŒ–ã€‚å¦å¤–ï¼Œæ¥å£çš„å®ç°ç±»åœ¨åˆå§‹åŒ–æ—¶ä¹Ÿä¸€æ ·ä¸ä¼šæ‰§è¡Œæ¥å£çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ã€‚</li>
<li>è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¢«æ­£ç¡®çš„åŠ é”å’ŒåŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¿™ä¸ªç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ï¼Œå…¶å®ƒçº¿ç¨‹éƒ½ä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ  <code>&lt;clinit&gt;()</code>  æ–¹æ³•å®Œæ¯•ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„  <code>&lt;clinit&gt;()</code>  æ–¹æ³•ä¸­æœ‰è€—æ—¶çš„æ“ä½œï¼Œå°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­æ­¤ç§é˜»å¡å¾ˆéšè”½ã€‚</li>
</ul>
<h2 id="-865"><a class="markdownIt-Anchor" href="#-865">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_3-classloader">#</a>3. ClassLoader</h2>
<p><code>ClassLoader</code>  å³ç±»åŠ è½½å™¨ï¼Œè´Ÿè´£å°†ç±»åŠ è½½åˆ° JVMã€‚åœ¨ Java è™šæ‹Ÿæœºå¤–éƒ¨å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€è¦çš„ç±»ã€‚</p>
<p>JVM åŠ è½½  <code>class</code>  æ–‡ä»¶åˆ°å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>éšå¼åŠ è½½ - JVM è‡ªåŠ¨åŠ è½½éœ€è¦çš„ç±»åˆ°å†…å­˜ä¸­ã€‚</li>
<li>æ˜¾ç¤ºåŠ è½½ - é€šè¿‡ä½¿ç”¨  <code>ClassLoader</code>  æ¥åŠ è½½ä¸€ä¸ªç±»åˆ°å†…å­˜ä¸­ã€‚</li>
</ul>
<h3 id="-866"><a class="markdownIt-Anchor" href="#-866">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_3-1-%E7%B1%BB%E4%B8%8E%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">#</a>3.1. ç±»ä¸ç±»åŠ è½½å™¨</h3>
<p>å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸ç­‰ï¼šç±»æœ¬èº«ç›¸ç­‰ï¼Œå¹¶ä¸”ä½¿ç”¨åŒä¸€ä¸ªç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚è¿™æ˜¯å› ä¸º<strong>æ¯ä¸€ä¸ª  <code>ClassLoader</code>  éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´</strong>ã€‚</p>
<p>è¿™é‡Œçš„ç›¸ç­‰ï¼ŒåŒ…æ‹¬ç±»çš„  <code>Class</code>  å¯¹è±¡çš„  <code>equals()</code>  æ–¹æ³•ã€ <code>isAssignableFrom()</code>  æ–¹æ³•ã€ <code>isInstance()</code>  æ–¹æ³•çš„è¿”å›ç»“æœä¸º trueï¼Œä¹ŸåŒ…æ‹¬ä½¿ç”¨  <code>instanceof</code>  å…³é”®å­—åšå¯¹è±¡æ‰€å±å…³ç³»åˆ¤å®šç»“æœä¸º trueã€‚</p>
<h3 id="-867"><a class="markdownIt-Anchor" href="#-867">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_3-2-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%88%86%E7%B1%BB">#</a>3.2. ç±»åŠ è½½å™¨åˆ†ç±»</h3>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200617115936.png" alt="img"></p>
<h4 id="-868"><a class="markdownIt-Anchor" href="#-868">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#bootstrap-classloader">#</a>Bootstrap ClassLoader</h4>
<p><code>Bootstrap ClassLoader</code>  ï¼Œå³å¯åŠ¨ç±»åŠ è½½å™¨ ï¼Œ<strong>è´Ÿè´£åŠ è½½ JVM è‡ªèº«å·¥ä½œæ‰€éœ€è¦çš„ç±»</strong>ã€‚</p>
<p><strong> <code>Bootstrap ClassLoader</code>  ä¼šå°†å­˜æ”¾åœ¨  <code>&lt;JAVA_HOME&gt;\lib</code>  ç›®å½•ä¸­çš„ï¼Œæˆ–è€…è¢«  <code>-Xbootclasspath</code>  å‚æ•°æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­çš„ï¼Œå¹¶ä¸”æ˜¯è™šæ‹Ÿæœºè¯†åˆ«çš„ï¼ˆä»…æŒ‰ç…§æ–‡ä»¶åè¯†åˆ«ï¼Œå¦‚ rt.jarï¼Œåå­—ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨ lib ç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ï¼‰ç±»åº“åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­</strong>ã€‚</p>
<p><code>Bootstrap ClassLoader</code>  æ˜¯ç”± C++ å®ç°çš„ï¼Œå®ƒå®Œå…¨ç”± JVM è‡ªå·±æ§åˆ¶çš„ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢« Java ç¨‹åºç›´æ¥å¼•ç”¨ï¼Œç”¨æˆ·åœ¨ç¼–å†™è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶ï¼Œå¦‚æœéœ€è¦æŠŠåŠ è½½è¯·æ±‚å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œç›´æ¥ä½¿ç”¨  <code>null</code>  ä»£æ›¿å³å¯ã€‚</p>
<h4 id="-869"><a class="markdownIt-Anchor" href="#-869">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#extclassloader">#</a>ExtClassLoader</h4>
<p><code>ExtClassLoader</code> ï¼Œå³æ‰©å±•ç±»åŠ è½½å™¨ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”±  <code>ExtClassLoader(sun.misc.Launcher\$ExtClassLoader)</code>  å®ç°çš„ã€‚</p>
<p><strong> <code>ExtClassLoader</code>  è´Ÿè´£å°†  <code>&lt;JAVA_HOME&gt;\lib\ext</code>  æˆ–è€…è¢«  <code>java.ext.dir</code>  ç³»ç»Ÿå˜é‡æ‰€æŒ‡å®šè·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨</strong>ã€‚</p>
<h4 id="-870"><a class="markdownIt-Anchor" href="#-870">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#appclassloader">#</a>AppClassLoader</h4>
<p><code>AppClassLoader</code> ï¼Œå³åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯ç”±  <code>AppClassLoader(sun.misc.Launcher\$AppClassLoader)</code>  å®ç°çš„ã€‚ç”±äºè¿™ä¸ªç±»åŠ è½½å™¨æ˜¯  <code>ClassLoader</code>  ä¸­çš„  <code>getSystemClassLoader()</code>  æ–¹æ³•çš„è¿”å›å€¼ï¼Œå› æ­¤ä¸€èˆ¬ç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚</p>
<p><strong> <code>AppClassLoader</code>  è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆå³  <code>classpath</code> ï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“</strong>ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚</p>
<h4 id="-871"><a class="markdownIt-Anchor" href="#-871">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">#</a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4>
<p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯ä»¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>åœ¨æ‰§è¡Œéç½®ä¿¡ä»£ç ä¹‹å‰ï¼Œè‡ªåŠ¨éªŒè¯æ•°å­—ç­¾åã€‚</li>
<li>åŠ¨æ€åœ°åˆ›å»ºç¬¦åˆç”¨æˆ·ç‰¹å®šéœ€è¦çš„å®šåˆ¶åŒ–æ„å»ºç±»ã€‚</li>
<li>ä»ç‰¹å®šçš„åœºæ‰€å–å¾— java classï¼Œä¾‹å¦‚æ•°æ®åº“ä¸­å’Œç½‘ç»œä¸­ã€‚</li>
</ul>
<p>å‡è®¾ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªåä¸º  <code>FileSystemClassLoader</code>  çš„ç±»åŠ è½½å™¨ï¼Œç»§æ‰¿è‡ª  <code>java.lang.ClassLoader</code> ï¼Œç”¨äºåŠ è½½æ–‡ä»¶ç³»ç»Ÿä¸Šçš„ç±»ã€‚å®ƒé¦–å…ˆæ ¹æ®ç±»çš„å…¨ååœ¨æ–‡ä»¶ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ç±»çš„å­—èŠ‚ä»£ç æ–‡ä»¶ï¼ˆ <code>.class</code>  æ–‡ä»¶ï¼‰ï¼Œç„¶åè¯»å–è¯¥æ–‡ä»¶å†…å®¹ï¼Œæœ€åé€šè¿‡  <code>defineClass()</code>  æ–¹æ³•æ¥æŠŠè¿™äº›å­—èŠ‚ä»£ç è½¬æ¢æˆ  <code>java.lang.Class</code>  ç±»çš„å®ä¾‹ã€‚</p>
<p><code>java.lang.ClassLoader</code>  ç±»çš„æ–¹æ³•  <code>loadClass()</code>  å®ç°äº†åŒäº²å§”æ´¾æ¨¡å‹çš„é€»è¾‘ï¼Œå› æ­¤è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸€èˆ¬ä¸å»è¦†å†™å®ƒï¼Œè€Œæ˜¯é€šè¿‡è¦†å†™  <code>findClass()</code>  æ–¹æ³•ã€‚</p>
<p><code>ClassLoader</code>  å¸¸ç”¨çš„åœºæ™¯ï¼š</p>
<ul>
<li>å®¹å™¨ - å…¸å‹åº”ç”¨ï¼šServlet å®¹å™¨ï¼ˆå¦‚ï¼šTomcatã€Jettyï¼‰ã€udf ï¼ˆMysqlã€Hiveï¼‰ç­‰ã€‚åŠ è½½è§£å‹ jar åŒ…æˆ– war åŒ…åï¼ŒåŠ è½½å…¶ Class åˆ°æŒ‡å®šçš„ç±»åŠ è½½å™¨ä¸­è¿è¡Œï¼ˆé€šå¸¸éœ€è¦è€ƒè™‘ç©ºé—´éš”ç¦»ï¼‰ã€‚</li>
<li>çƒ­éƒ¨ç½²ã€çƒ­æ’æ‹” - åº”ç”¨å¯åŠ¨åï¼ŒåŠ¨æ€è·å¾—æŸä¸ªç±»ä¿¡æ¯ï¼Œç„¶ååŠ è½½åˆ° JVM ä¸­å·¥ä½œã€‚å¾ˆå¤šè‘—åçš„å®¹å™¨è½¯ä»¶ã€æ¡†æ¶ï¼ˆå¦‚ï¼šSpring ç­‰ï¼‰ï¼Œéƒ½ä½¿ç”¨  <code>ClassLoader</code>  æ¥å®ç°è‡ªèº«çš„çƒ­éƒ¨ç½²ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘è‡ªå®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileSystemClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> rootDir<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">FileSystemClassLoader</span><span class="token punctuation">(</span><span class="token class-name">String</span> rootDir<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rootDir <span class="token operator">=</span> rootDir<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classData <span class="token operator">=</span> <span class="token function">getClassData</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>classData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> classData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getClassData</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">classNameToPath</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">InputStream</span> ins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> bufferSize <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>bufferSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> bytesNumRead<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>bytesNumRead <span class="token operator">=</span> ins<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                baos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> bytesNumRead<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">classNameToPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> rootDir <span class="token operator">+</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separatorChar
                <span class="token operator">+</span> className<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token class-name">File</span><span class="token punctuation">.</span>separatorChar<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".class"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-872"><a class="markdownIt-Anchor" href="#-872">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_3-3-%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE">#</a>3.3. åŒäº²å§”æ´¾</h3>
<p>ç†è§£åŒäº²å§”æ´¾ä¹‹å‰ï¼Œå…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘å¯»æ‰¾ç±»åŠ è½½ç¤ºä¾‹</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">ClassLoader</span> loader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è¾“å‡ºï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">sun.misc.Launcher$AppClassLoader@18b4aac2
sun.misc.Launcher$ExtClassLoader@19e1023e
null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œå¹¶æ²¡æœ‰è·å–åˆ°  <code>ExtClassLoader</code>  çš„çˆ¶ Loaderï¼ŒåŸå› æ˜¯  <code>Bootstrap Loader</code> ï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œæ‰¾ä¸åˆ°ä¸€ä¸ªç¡®å®šçš„è¿”å›çˆ¶ Loader çš„æ–¹å¼ï¼Œäºæ˜¯å°±è¿”å› nullã€‚</p>
<p>ä¸‹å›¾å±•ç¤ºçš„ç±»åŠ è½½å™¨ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼Œç§°ä¸ºç±»åŠ è½½å™¨çš„<strong>åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParents Delegation Modelï¼‰</strong>ã€‚<strong>è¯¥æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„ Bootstrap ClassLoader å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨</strong>ã€‚<strong>è¿™é‡Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬é€šè¿‡ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»å®ç°</strong>ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/jmm-%25E7%25B1%25BB%25E5%258A%25A0%25E8%25BD%25BD-%25E5%258F%258C%25E4%25BA%25B2%25E5%25A7%2594%25E6%25B4%25BE.png" alt="img"></p>
<p><strong>ï¼ˆ1ï¼‰å·¥ä½œè¿‡ç¨‹</strong></p>
<p><strong>ä¸€ä¸ªç±»åŠ è½½å™¨é¦–å…ˆå°†ç±»åŠ è½½è¯·æ±‚ä¼ é€åˆ°çˆ¶ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆç±»åŠ è½½è¯·æ±‚æ—¶æ‰å°è¯•åŠ è½½</strong>ã€‚</p>
<p><strong>ï¼ˆ2ï¼‰å¥½å¤„</strong></p>
<p><strong>ä½¿å¾— Java ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·æœ‰ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»</strong>ï¼Œä»è€Œä½¿å¾—åŸºç¡€ç±»å¾—åˆ°ç»Ÿä¸€ï¼š</p>
<ul>
<li>ç³»ç»Ÿç±»é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä»½åŒæ ·çš„å­—èŠ‚ç </li>
<li>ä¿è¯ Java ç¨‹åºå®‰å…¨ç¨³å®šè¿è¡Œ</li>
</ul>
<p>ä¾‹å¦‚ï¼š  <code>java.lang.Object</code>  å­˜æ”¾åœ¨ rt.jar ä¸­ï¼Œå¦‚æœç¼–å†™å¦å¤–ä¸€ä¸ª  <code>java.lang.Object</code>  çš„ç±»å¹¶æ”¾åˆ°  <code>classpath</code>  ä¸­ï¼Œç¨‹åºå¯ä»¥ç¼–è¯‘é€šè¿‡ã€‚å› ä¸ºåŒäº²å§”æ´¾æ¨¡å‹çš„å­˜åœ¨ï¼Œæ‰€ä»¥åœ¨ rt.jar ä¸­çš„  <code>Object</code>  æ¯”åœ¨  <code>classpath</code>  ä¸­çš„  <code>Object</code>  ä¼˜å…ˆçº§æ›´é«˜ï¼Œå› ä¸º rt.jar ä¸­çš„  <code>Object</code>  ä½¿ç”¨çš„æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè€Œ  <code>classpath</code>  ä¸­çš„  <code>Object</code>  ä½¿ç”¨çš„æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚æ­£å› ä¸º rt.jar ä¸­çš„  <code>Object</code>  ä¼˜å…ˆçº§æ›´é«˜ï¼Œå› ä¸ºç¨‹åºä¸­æ‰€æœ‰çš„  <code>Object</code>  éƒ½æ˜¯è¿™ä¸ª  <code>Object</code> ã€‚</p>
<p><strong>ï¼ˆ3ï¼‰å®ç°</strong></p>
<p>ä»¥ä¸‹æ˜¯æŠ½è±¡ç±»  <code>java.lang.ClassLoader</code>  çš„ä»£ç ç‰‡æ®µï¼Œå…¶ä¸­çš„  <code>loadClass()</code>  æ–¹æ³•è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// The parent class loader for delegation</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> parent<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token function">getClassLoadingLock</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// é¦–å…ˆåˆ¤æ–­è¯¥ç±»å‹æ˜¯å¦å·²ç»è¢«åŠ è½½</span>
            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// å¦‚æœæ²¡æœ‰è¢«åŠ è½½ï¼Œå°±å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½æˆ–è€…å§”æ´¾ç»™å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½</span>
                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">// å¦‚æœå­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œå°±å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½</span>
                        c <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">// å¦‚æœä¸å­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œå°±æ£€æŸ¥æ˜¯å¦æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œé€šè¿‡è°ƒç”¨æœ¬åœ°æ–¹æ³•native Class findBootstrapClass(String name)</span>
                        c <span class="token operator">=</span> <span class="token function">findBootstrapClassOrNull</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// å¦‚æœçˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥ï¼Œä¼šæŠ›å‡º ClassNotFoundException</span>
                <span class="token punctuation">&#125;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// å¦‚æœçˆ¶ç±»åŠ è½½å™¨å’Œå¯åŠ¨ç±»åŠ è½½å™¨éƒ½ä¸èƒ½å®ŒæˆåŠ è½½ä»»åŠ¡ï¼Œæ‰è°ƒç”¨è‡ªèº«çš„åŠ è½½åŠŸèƒ½</span>
                    c <span class="token operator">=</span> <span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token function">resolveClass</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> c<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è¯´æ˜ã€‘</p>
<ul>
<li>å…ˆæ£€æŸ¥ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®©çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½ã€‚</li>
<li>å½“çˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥æ—¶æŠ›å‡º  <code>ClassNotFoundException</code> ï¼Œæ­¤æ—¶å°è¯•è‡ªå·±å»åŠ è½½ã€‚</li>
</ul>
<h3 id="-873"><a class="markdownIt-Anchor" href="#-873">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_3-4-classloader-%E5%8F%82%E6%95%B0">#</a>3.4. ClassLoader å‚æ•°</h3>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šå¯åŠ¨ java åº”ç”¨æ—¶ï¼Œé€šå¸¸ä¼šæŒ‡å®šä¸€äº›  <code>ClassLoader</code>  å‚æ•°ï¼Œä»¥åŠ è½½åº”ç”¨æ‰€éœ€è¦çš„ libï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">java -jar xxx.jar -classpath lib/*<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>ClassLoader</code>  ç›¸å…³å‚æ•°é€‰é¡¹ï¼š</p>
<table>
<thead>
<tr>
<th>å‚æ•°é€‰é¡¹</th>
<th>ClassLoader ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-Xbootclasspath</code></td>
<td><code>Bootstrap ClassLoader</code></td>
<td>è®¾ç½®  <code>Bootstrap ClassLoader</code>  æœç´¢è·¯å¾„ã€‚ã€ä¸å¸¸ç”¨ã€‘</td>
</tr>
<tr>
<td><code>-Xbootclasspath/a</code></td>
<td><code>Bootstrap ClassLoader</code></td>
<td>æŠŠè·¯å¾„æ·»åŠ åˆ°å·²å­˜åœ¨çš„  <code>Bootstrap ClassLoader</code>  æœç´¢è·¯å¾„åé¢ã€‚ã€å¸¸ç”¨ã€‘</td>
</tr>
<tr>
<td><code>-Xbootclasspath/p</code></td>
<td><code>Bootstrap ClassLoader</code></td>
<td>æŠŠè·¯å¾„æ·»åŠ åˆ°å·²å­˜åœ¨çš„  <code>Bootstrap ClassLoader</code>  æœç´¢è·¯å¾„å‰é¢ã€‚ã€ä¸å¸¸ç”¨ã€‘</td>
</tr>
<tr>
<td><code>-Djava.ext.dirs</code></td>
<td><code>ExtClassLoader</code></td>
<td>è®¾ç½®  <code>ExtClassLoader</code>  æœç´¢è·¯å¾„ã€‚</td>
</tr>
<tr>
<td><code>-Djava.class.path</code>  æˆ–  <code>-cp</code>  æˆ–  <code>-classpath</code></td>
<td><code>AppClassLoader</code></td>
<td>è®¾ç½®  <code>AppClassLoader</code>  æœç´¢è·¯å¾„ã€‚</td>
</tr>
</tbody>
</table>
<h2 id="-874"><a class="markdownIt-Anchor" href="#-874">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_4-%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD">#</a>4. ç±»çš„åŠ è½½</h2>
<h3 id="-875"><a class="markdownIt-Anchor" href="#-875">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_4-1-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F">#</a>4.1. ç±»åŠ è½½æ–¹å¼</h3>
<p>ç±»åŠ è½½æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li>å‘½ä»¤è¡Œå¯åŠ¨åº”ç”¨æ—¶å€™ç”± JVM åˆå§‹åŒ–åŠ è½½</li>
<li>é€šè¿‡  <code>Class.forName()</code>  æ–¹æ³•åŠ¨æ€åŠ è½½</li>
<li>é€šè¿‡  <code>ClassLoader.loadClass()</code>  æ–¹æ³•åŠ¨æ€åŠ è½½</li>
</ul>
<p><strong> <code>Class.forName()</code>  å’Œ  <code>ClassLoader.loadClass()</code>  åŒºåˆ«</strong></p>
<ul>
<li><code>Class.forName()</code>  å°†ç±»çš„  <code>.class</code>  æ–‡ä»¶åŠ è½½åˆ° jvm ä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„  <code>static</code>  å—ï¼›</li>
<li><code>ClassLoader.loadClass()</code>  åªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†  <code>.class</code>  æ–‡ä»¶åŠ è½½åˆ° jvm ä¸­ï¼Œä¸ä¼šæ‰§è¡Œ  <code>static</code>  ä¸­çš„å†…å®¹ï¼Œåªæœ‰åœ¨  <code>newInstance</code>  æ‰ä¼šå»æ‰§è¡Œ  <code>static</code>  å—ã€‚</li>
<li><code>Class.forName(name, initialize, loader)</code>  å¸¦å‚å‡½æ•°ä¹Ÿå¯æ§åˆ¶æ˜¯å¦åŠ è½½  <code>static</code>  å—ã€‚å¹¶ä¸”åªæœ‰è°ƒç”¨äº†  <code>newInstance()</code>  æ–¹æ³•é‡‡ç”¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡ ã€‚</li>
</ul>
<h3 id="-876"><a class="markdownIt-Anchor" href="#-876">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#_4-2-%E5%8A%A0%E8%BD%BD%E7%B1%BB%E9%94%99%E8%AF%AF">#</a>4.2. åŠ è½½ç±»é”™è¯¯</h3>
<h4 id="-877"><a class="markdownIt-Anchor" href="#-877">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#classnotfoundexception">#</a>ClassNotFoundException</h4>
<p><code>ClassNotFoundException</code>  å¼‚å¸¸å‡ºé•œç‡æé«˜ã€‚<strong> <code>ClassNotFoundException</code>  è¡¨ç¤ºå½“å‰  <code>classpath</code>  ä¸‹æ‰¾ä¸åˆ°æŒ‡å®šç±»</strong>ã€‚</p>
<p>å¸¸è§é—®é¢˜åŸå› ï¼š</p>
<ul>
<li>è°ƒç”¨  <code>Class</code>  çš„  <code>forName()</code>  æ–¹æ³•ï¼Œæœªæ‰¾åˆ°ç±»ã€‚</li>
<li>è°ƒç”¨  <code>ClassLoader</code>  ä¸­çš„  <code>loadClass()</code>  æ–¹æ³•ï¼Œæœªæ‰¾åˆ°ç±»ã€‚</li>
<li>è°ƒç”¨  <code>ClassLoader</code>  ä¸­çš„  <code>findSystemClass()</code>  æ–¹æ³•ï¼Œæœªæ‰¾åˆ°ç±»ã€‚</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œä¼šæŠ›å‡º  <code>ClassNotFoundException</code>  å¼‚å¸¸ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassNotFoundExceptionDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"NotFound"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>è§£å†³æ–¹æ³•ï¼šæ£€æŸ¥  <code>classpath</code>  ä¸‹æœ‰æ²¡æœ‰ç›¸åº”çš„ class æ–‡ä»¶ã€‚</p>
<h4 id="-878"><a class="markdownIt-Anchor" href="#-878">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#noclassdeffounderror">#</a>NoClassDefFoundError</h4>
<p>å¸¸è§é—®é¢˜åŸå› ï¼š</p>
<ul>
<li>ç±»ä¾èµ–çš„ Class æˆ–è€… jar ä¸å­˜åœ¨ã€‚</li>
<li>ç±»æ–‡ä»¶å­˜åœ¨ï¼Œä½†æ˜¯å­˜åœ¨ä¸åŒçš„åŸŸä¸­ã€‚</li>
</ul>
<p>è§£å†³æ–¹æ³•ï¼šç°ä»£ Java é¡¹ç›®ï¼Œä¸€èˆ¬ä½¿ç”¨  <code>maven</code> ã€ <code>gradle</code>  ç­‰æ„å»ºå·¥å…·ç®¡ç†é¡¹ç›®ï¼Œä»”ç»†æ£€æŸ¥æ‰¾ä¸åˆ°çš„ç±»æ‰€åœ¨çš„ jar åŒ…æ˜¯å¦å·²æ·»åŠ ä¸ºä¾èµ–ã€‚</p>
<h4 id="-879"><a class="markdownIt-Anchor" href="#-879">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#unsatisfiedlinkerror">#</a>UnsatisfiedLinkError</h4>
<p>è¿™ä¸ªå¼‚å¸¸å€’ä¸æ˜¯å¾ˆå¸¸è§ï¼Œä½†æ˜¯å‡ºé”™çš„è¯ï¼Œé€šå¸¸æ˜¯åœ¨ JVM å¯åŠ¨çš„æ—¶å€™å¦‚æœä¸€ä¸å°å¿ƒå°†åœ¨ JVM ä¸­çš„æŸä¸ª lib åˆ é™¤äº†ï¼Œå¯èƒ½å°±ä¼šæŠ¥è¿™ä¸ªé”™è¯¯äº†ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œä¼šæŠ›å‡º  <code>UnsatisfiedLinkError</code>  é”™è¯¯ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnsatisfiedLinkErrorDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">nativeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token string">"NoLib"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">new</span> <span class="token class-name">UnsatisfiedLinkErrorDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nativeMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è¾“å‡ºã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>UnsatisfiedLinkError</span><span class="token operator">:</span> no <span class="token class-name">NoLib</span> in java<span class="token punctuation">.</span>library<span class="token punctuation">.</span>path
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassLoader</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1867</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">.</span><span class="token function">loadLibrary0</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">870</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>System</span><span class="token punctuation">.</span><span class="token function">loadLibrary</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1122</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span>classloader<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span>UnsatisfiedLinkErrorDemo</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>clinit<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token class-name">UnsatisfiedLinkErrorDemo</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-880"><a class="markdownIt-Anchor" href="#-880">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-class-loader.html#classcastexception">#</a>ClassCastException</h4>
<p><code>ClassCastException</code>  å¼‚å¸¸é€šå¸¸æ˜¯åœ¨ç¨‹åºä¸­å¼ºåˆ¶ç±»å‹è½¬æ¢å¤±è´¥æ—¶å‡ºç°ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼Œä¼šæŠ›å‡º  <code>ClassCastException</code>  å¼‚å¸¸ã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassCastExceptionDemo</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EmptyClass</span> newObj <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EmptyClass</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EmptyClass</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€è¾“å‡ºã€‘</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassCastException</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span> cannot be cast <span class="token keyword">to</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span>classloader<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ClassCastExceptionDemo</span>$<span class="token class-name">EmptyClass</span>
	at <span class="token class-name"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>dunwu<span class="token punctuation">.</span>javacore<span class="token punctuation">.</span>jvm<span class="token punctuation">.</span>classloader<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span>ClassCastExceptionDemo</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">ClassCastExceptionDemo</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<hr>
<h1 id="jvm-å®æˆ˜"><a class="markdownIt-Anchor" href="#jvm-å®æˆ˜">#</a> JVM å®æˆ˜</h1>
<blockquote>
<p><strong>ğŸ“¦ æœ¬æ–‡ä»¥åŠç¤ºä¾‹æºç å·²å½’æ¡£åœ¨ <a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/">javacore(opens new window)</a></strong></p>
</blockquote>
<ul>
<li>\1. JVM è°ƒä¼˜æ¦‚è¿°
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#11-gc-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87">1.1. GC æ€§èƒ½æŒ‡æ ‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#12-%E8%B0%83%E4%BC%98%E5%8E%9F%E5%88%99">1.2. è°ƒä¼˜åŸåˆ™</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#13-gc-%E4%BC%98%E5%8C%96%E7%9A%84%E8%BF%87%E7%A8%8B">1.3. GC ä¼˜åŒ–çš„è¿‡ç¨‹</a></li>
</ul>
</li>
<li>\2. GC æ—¥å¿—
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#21-%E8%8E%B7%E5%8F%96-gc-%E6%97%A5%E5%BF%97">2.1. è·å– GC æ—¥å¿—</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#22-%E5%88%86%E6%9E%90-gc-%E6%97%A5%E5%BF%97">2.2. åˆ†æ GC æ—¥å¿—</a></li>
</ul>
</li>
<li>\3. GC é…ç½®
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#31-%E5%A0%86%E5%A4%A7%E5%B0%8F%E8%AE%BE%E7%BD%AE">3.1. å †å¤§å°è®¾ç½®</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#32-jvm-%E5%86%85%E5%AD%98%E9%85%8D%E7%BD%AE">3.2. JVM å†…å­˜é…ç½®</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#33-gc-%E7%B1%BB%E5%9E%8B%E9%85%8D%E7%BD%AE">3.3. GC ç±»å‹é…ç½®</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#34-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E9%80%9A%E7%94%A8%E5%8F%82%E6%95%B0">3.4. åƒåœ¾å›æ”¶å™¨é€šç”¨å‚æ•°</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#35-jmx">3.5. JMX</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#36-%E8%BF%9C%E7%A8%8B-debug">3.6. è¿œç¨‹ DEBUG</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#37-heapdump">3.7. HeapDump</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#38-%E8%BE%85%E5%8A%A9%E9%85%8D%E7%BD%AE">3.8. è¾…åŠ©é…ç½®</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#4-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">4. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-881"><a class="markdownIt-Anchor" href="#-881">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_1-jvm-%E8%B0%83%E4%BC%98%E6%A6%82%E8%BF%B0">#</a>1. JVM è°ƒä¼˜æ¦‚è¿°</h2>
<h3 id="-882"><a class="markdownIt-Anchor" href="#-882">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_1-1-gc-%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87">#</a>1.1. GC æ€§èƒ½æŒ‡æ ‡</h3>
<p>å¯¹äº JVM è°ƒä¼˜æ¥è¯´ï¼Œéœ€è¦å…ˆæ˜ç¡®è°ƒä¼˜çš„ç›®æ ‡ã€‚ ä»æ€§èƒ½çš„è§’åº¦çœ‹ï¼Œé€šå¸¸å…³æ³¨ä¸‰ä¸ªæŒ‡æ ‡ï¼š</p>
<ul>
<li><code>ååé‡ï¼ˆthroughputï¼‰</code>  - æŒ‡ä¸è€ƒè™‘ GC å¼•èµ·çš„åœé¡¿æ—¶é—´æˆ–å†…å­˜æ¶ˆè€—ï¼Œåƒåœ¾æ”¶é›†å™¨èƒ½æ”¯æ’‘åº”ç”¨è¾¾åˆ°çš„æœ€é«˜æ€§èƒ½æŒ‡æ ‡ã€‚</li>
<li><code>åœé¡¿æ—¶é—´ï¼ˆlatencyï¼‰</code>  - å…¶åº¦é‡æ ‡å‡†æ˜¯ç¼©çŸ­ç”±äºåƒåœ¾å•Šæ”¶é›†å¼•èµ·çš„åœé¡¿æ—¶é—´æˆ–è€…å®Œå…¨æ¶ˆé™¤å› åƒåœ¾æ”¶é›†æ‰€å¼•èµ·çš„åœé¡¿ï¼Œé¿å…åº”ç”¨è¿è¡Œæ—¶å‘ç”ŸæŠ–åŠ¨ã€‚</li>
<li><code>åƒåœ¾å›æ”¶é¢‘ç‡</code>  - ä¹…å‘ç”Ÿä¸€æ¬¡æŒ‡åƒåœ¾å›æ”¶å‘¢ï¼Ÿé€šå¸¸åƒåœ¾å›æ”¶çš„é¢‘ç‡è¶Šä½è¶Šå¥½ï¼Œå¢å¤§å †å†…å­˜ç©ºé—´å¯ä»¥æœ‰æ•ˆé™ä½åƒåœ¾å›æ”¶å‘ç”Ÿçš„é¢‘ç‡ï¼Œä½†åŒæ—¶ä¹Ÿæ„å‘³ç€å †ç§¯çš„å›æ”¶å¯¹è±¡è¶Šå¤šï¼Œæœ€ç»ˆä¹Ÿä¼šå¢åŠ å›æ”¶æ—¶çš„åœé¡¿æ—¶é—´ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦é€‚å½“åœ°å¢å¤§å †å†…å­˜ç©ºé—´ï¼Œä¿è¯æ­£å¸¸çš„åƒåœ¾å›æ”¶é¢‘ç‡å³å¯ã€‚</li>
</ul>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹è°ƒä¼˜ä¼šä¾§é‡äºå…¶ä¸­ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªæ–¹é¢çš„ç›®æ ‡ï¼Œå¾ˆå°‘æœ‰æƒ…å†µå¯ä»¥å…¼é¡¾ä¸‰ä¸ªä¸åŒçš„è§’åº¦ã€‚</p>
<h3 id="-883"><a class="markdownIt-Anchor" href="#-883">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_1-2-%E8%B0%83%E4%BC%98%E5%8E%9F%E5%88%99">#</a>1.2. è°ƒä¼˜åŸåˆ™</h3>
<p>GC ä¼˜åŒ–çš„ä¸¤ä¸ªç›®æ ‡ï¼š</p>
<ul>
<li><strong>é™ä½ Full GC çš„é¢‘ç‡</strong></li>
<li><strong>å‡å°‘ Full GC çš„æ‰§è¡Œæ—¶é—´</strong></li>
</ul>
<p>GC ä¼˜åŒ–çš„åŸºæœ¬åŸåˆ™æ˜¯ï¼šå°†ä¸åŒçš„ GC å‚æ•°åº”ç”¨åˆ°ä¸¤ä¸ªåŠä»¥ä¸Šçš„æœåŠ¡å™¨ä¸Šç„¶åæ¯”è¾ƒå®ƒä»¬çš„æ€§èƒ½ï¼Œç„¶åå°†é‚£äº›è¢«è¯æ˜å¯ä»¥æé«˜æ€§èƒ½æˆ–å‡å°‘ GC æ‰§è¡Œæ—¶é—´çš„å‚æ•°åº”ç”¨äºæœ€ç»ˆçš„å·¥ä½œæœåŠ¡å™¨ä¸Šã€‚</p>
<h4 id="-884"><a class="markdownIt-Anchor" href="#-884">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#%E9%99%8D%E4%BD%8E-minor-gc-%E9%A2%91%E7%8E%87">#</a>é™ä½ Minor GC é¢‘ç‡</h4>
<p>å¦‚æœæ–°ç”Ÿä»£ç©ºé—´è¾ƒå°ï¼ŒEden åŒºå¾ˆå¿«è¢«å¡«æ»¡ï¼Œå°±ä¼šå¯¼è‡´é¢‘ç¹ Minor GCï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢å¤§æ–°ç”Ÿä»£ç©ºé—´æ¥é™ä½ Minor GC çš„é¢‘ç‡ã€‚</p>
<p>å¯èƒ½ä½ ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼Œæ‰©å®¹ Eden åŒºè™½ç„¶å¯ä»¥å‡å°‘ Minor GC çš„æ¬¡æ•°ï¼Œä½†ä¸ä¼šå¢åŠ å•æ¬¡ Minor GC çš„æ—¶é—´å—ï¼Ÿå¦‚æœå•æ¬¡ Minor GC çš„æ—¶é—´å¢åŠ ï¼Œé‚£ä¹Ÿå¾ˆéš¾è¾¾åˆ°æˆ‘ä»¬æœŸå¾…çš„ä¼˜åŒ–æ•ˆæœå‘€ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå•æ¬¡ Minor GC æ—¶é—´æ˜¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šT1ï¼ˆæ‰«ææ–°ç”Ÿä»£ï¼‰å’Œ T2ï¼ˆå¤åˆ¶å­˜æ´»å¯¹è±¡ï¼‰ã€‚å‡è®¾ä¸€ä¸ªå¯¹è±¡åœ¨ Eden åŒºçš„å­˜æ´»æ—¶é—´ä¸º 500msï¼ŒMinor GC çš„æ—¶é—´é—´éš”æ˜¯ 300msï¼Œé‚£ä¹ˆæ­£å¸¸æƒ…å†µä¸‹ï¼ŒMinor GC çš„æ—¶é—´ä¸º ï¼šT1+T2ã€‚</p>
<p>å½“æˆ‘ä»¬å¢å¤§æ–°ç”Ÿä»£ç©ºé—´ï¼ŒMinor GC çš„æ—¶é—´é—´éš”å¯èƒ½ä¼šæ‰©å¤§åˆ° 600msï¼Œæ­¤æ—¶ä¸€ä¸ªå­˜æ´» 500ms çš„å¯¹è±¡å°±ä¼šåœ¨ Eden åŒºä¸­è¢«å›æ”¶æ‰ï¼Œæ­¤æ—¶å°±ä¸å­˜åœ¨å¤åˆ¶å­˜æ´»å¯¹è±¡äº†ï¼Œæ‰€ä»¥å†å‘ç”Ÿ Minor GC çš„æ—¶é—´ä¸ºï¼šä¸¤æ¬¡æ‰«ææ–°ç”Ÿä»£ï¼Œå³ 2T1ã€‚</p>
<p>å¯è§ï¼Œæ‰©å®¹åï¼ŒMinor GC æ—¶å¢åŠ äº† T1ï¼Œä½†çœå»äº† T2 çš„æ—¶é—´ã€‚é€šå¸¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œå¤åˆ¶å¯¹è±¡çš„æˆæœ¬è¦è¿œé«˜äºæ‰«ææˆæœ¬ã€‚</p>
<p>å¦‚æœåœ¨å †å†…å­˜ä¸­å­˜åœ¨è¾ƒå¤šçš„é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œæ­¤æ—¶å¢åŠ å¹´è½»ä»£ç©ºé—´ï¼Œåè€Œä¼šå¢åŠ  Minor GC çš„æ—¶é—´ã€‚å¦‚æœå †ä¸­çš„çŸ­æœŸå¯¹è±¡å¾ˆå¤šï¼Œé‚£ä¹ˆæ‰©å®¹æ–°ç”Ÿä»£ï¼Œå•æ¬¡ Minor GC æ—¶é—´ä¸ä¼šæ˜¾è‘—å¢åŠ ã€‚å› æ­¤ï¼Œå•æ¬¡ Minor GC æ—¶é—´æ›´å¤šå–å†³äº GC åå­˜æ´»å¯¹è±¡çš„æ•°é‡ï¼Œè€Œé Eden åŒºçš„å¤§å°ã€‚</p>
<h4 id="-885"><a class="markdownIt-Anchor" href="#-885">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#%E9%99%8D%E4%BD%8E-full-gc-%E7%9A%84%E9%A2%91%E7%8E%87">#</a>é™ä½ Full GC çš„é¢‘ç‡</h4>
<p>Full GC ç›¸å¯¹æ¥è¯´ä¼šæ¯” Minor GC æ›´è€—æ—¶ã€‚å‡å°‘è¿›å…¥è€å¹´ä»£çš„å¯¹è±¡æ•°é‡å¯ä»¥æ˜¾è‘—é™ä½ Full GC çš„é¢‘ç‡ã€‚</p>
<p>** å‡å°‘åˆ›å»ºå¤§å¯¹è±¡ï¼š*<em> å¦‚æœ *<em> å¯¹è±¡å ç”¨å†…å­˜è¿‡å¤§ï¼Œåœ¨ Eden åŒºè¢«åˆ›å»ºåä¼šç›´æ¥è¢«ä¼ å…¥è€å¹´ä»£</em></em>ã€‚åœ¨å¹³å¸¸çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¹ æƒ¯ä¸€æ¬¡æ€§ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºä¸€ä¸ªå¤§å¯¹è±¡ç”¨äº web ç«¯æ˜¾ç¤ºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä¹‹å‰ç¢°åˆ°è¿‡ä¸€ä¸ªä¸€æ¬¡æ€§æŸ¥è¯¢å‡º 60 ä¸ªå­—æ®µçš„ä¸šåŠ¡æ“ä½œï¼Œè¿™ç§å¤§å¯¹è±¡å¦‚æœè¶…è¿‡å¹´è½»ä»£æœ€å¤§å¯¹è±¡é˜ˆå€¼ï¼Œä¼šè¢«ç›´æ¥åˆ›å»ºåœ¨è€å¹´ä»£ï¼›å³ä½¿è¢«åˆ›å»ºåœ¨äº†å¹´è½»ä»£ï¼Œç”±äºå¹´è½»ä»£çš„å†…å­˜ç©ºé—´æœ‰é™ï¼Œé€šè¿‡ Minor GC ä¹‹åä¹Ÿä¼šè¿›å…¥åˆ°è€å¹´ä»£ã€‚è¿™ç§å¤§å¯¹è±¡å¾ˆå®¹æ˜“äº§ç”Ÿè¾ƒå¤šçš„ Full GCã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†è¿™ç§å¤§å¯¹è±¡æ‹†è§£å‡ºæ¥ï¼Œé¦–æ¬¡åªæŸ¥è¯¢ä¸€äº›æ¯”è¾ƒé‡è¦çš„å­—æ®µï¼Œå¦‚æœè¿˜éœ€è¦å…¶å®ƒå­—æ®µè¾…åŠ©æŸ¥çœ‹ï¼Œå†é€šè¿‡ç¬¬äºŒæ¬¡æŸ¥è¯¢æ˜¾ç¤ºå‰©ä½™çš„å­—æ®µã€‚</p>
<p>** å¢å¤§å †å†…å­˜ç©ºé—´ï¼š** åœ¨å †å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œå¢å¤§å †å†…å­˜ç©ºé—´ï¼Œä¸”è®¾ç½®åˆå§‹åŒ–å †å†…å­˜ä¸ºæœ€å¤§å †å†…å­˜ï¼Œä¹Ÿå¯ä»¥é™ä½ Full GC çš„é¢‘ç‡ã€‚</p>
<h4 id="-886"><a class="markdownIt-Anchor" href="#-886">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#%E9%99%8D%E4%BD%8E-full-gc-%E7%9A%84%E6%97%B6%E9%97%B4">#</a>é™ä½ Full GC çš„æ—¶é—´</h4>
<p>Full GC çš„æ‰§è¡Œæ—¶é—´æ¯” Minor GC è¦é•¿å¾ˆå¤šï¼Œå› æ­¤ï¼Œå¦‚æœåœ¨ Full GC ä¸ŠèŠ±è´¹è¿‡å¤šçš„æ—¶é—´ï¼ˆè¶…è¿‡ 1sï¼‰ï¼Œå°†å¯èƒ½å‡ºç°è¶…æ—¶é”™è¯¯ã€‚</p>
<ul>
<li>å¦‚æœ<strong>é€šè¿‡å‡å°è€å¹´ä»£å†…å­˜æ¥å‡å°‘ Full GC æ—¶é—´</strong>ï¼Œå¯èƒ½ä¼šå¼•èµ·  <code>OutOfMemoryError</code>  æˆ–è€…å¯¼è‡´ Full GC çš„é¢‘ç‡å‡é«˜ã€‚</li>
<li>å¦å¤–ï¼Œå¦‚æœ<strong>é€šè¿‡å¢åŠ è€å¹´ä»£å†…å­˜æ¥é™ä½ Full GC çš„é¢‘ç‡</strong>ï¼ŒFull GC çš„æ—¶é—´å¯èƒ½å› æ­¤å¢åŠ ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œä½ <strong>éœ€è¦æŠŠè€å¹´ä»£çš„å¤§å°è®¾ç½®æˆä¸€ä¸ª â€œåˆé€‚â€ çš„å€¼</strong>ã€‚</p>
<p><strong>GC ä¼˜åŒ–éœ€è¦è€ƒè™‘çš„ JVM å‚æ•°</strong></p>
<table>
<thead>
<tr>
<th><strong>ç±»å‹</strong></th>
<th><strong>å‚æ•°</strong></th>
<th><strong>æè¿°</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>å †å†…å­˜å¤§å°</td>
<td><code>-Xms</code></td>
<td>å¯åŠ¨ JVM æ—¶å †å†…å­˜çš„å¤§å°</td>
</tr>
<tr>
<td></td>
<td><code>-Xmx</code></td>
<td>å †å†…å­˜æœ€å¤§é™åˆ¶</td>
</tr>
<tr>
<td>æ–°ç”Ÿä»£ç©ºé—´å¤§å°</td>
<td><code>-XX:NewRatio</code></td>
<td>æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„å†…å­˜æ¯”</td>
</tr>
<tr>
<td></td>
<td><code>-XX:NewSize</code></td>
<td>æ–°ç”Ÿä»£å†…å­˜å¤§å°</td>
</tr>
<tr>
<td></td>
<td><code>-XX:SurvivorRatio</code></td>
<td>Eden åŒºå’Œ Survivor åŒºçš„å†…å­˜æ¯”</td>
</tr>
</tbody>
</table>
<p>GC ä¼˜åŒ–æ—¶æœ€å¸¸ç”¨çš„å‚æ•°æ˜¯ <code>-Xms</code> , <code>-Xmx</code>  å’Œ <code>-XX:NewRatio</code> ã€‚ <code>-Xms</code>  å’Œ <code>-Xmx</code>  å‚æ•°é€šå¸¸æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥ <code>NewRatio</code>  çš„å€¼å°†å¯¹ GC æ€§èƒ½äº§ç”Ÿé‡è¦çš„å½±å“ã€‚</p>
<p>æœ‰äº›äººå¯èƒ½ä¼šé—®<strong>å¦‚ä½•è®¾ç½®æ°¸ä¹…ä»£å†…å­˜å¤§å°</strong>ï¼Œä½ å¯ä»¥ç”¨ <code>-XX:PermSize</code>  å’Œ <code>-XX:MaxPermSize</code>  å‚æ•°æ¥è¿›è¡Œè®¾ç½®ï¼Œä½†æ˜¯è¦è®°ä½ï¼Œåªæœ‰å½“å‡ºç° <code>OutOfMemoryError</code>  é”™è¯¯æ—¶ä½ æ‰éœ€è¦å»è®¾ç½®æ°¸ä¹…ä»£å†…å­˜ã€‚</p>
<h3 id="-887"><a class="markdownIt-Anchor" href="#-887">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_1-3-gc-%E4%BC%98%E5%8C%96%E7%9A%84%E8%BF%87%E7%A8%8B">#</a>1.3. GC ä¼˜åŒ–çš„è¿‡ç¨‹</h3>
<p>GC ä¼˜åŒ–çš„è¿‡ç¨‹å¤§è‡´å¯åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p>
<h4 id="-888"><a class="markdownIt-Anchor" href="#-888">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_1-%E7%9B%91%E6%8E%A7-gc-%E7%8A%B6%E6%80%81">#</a>ï¼ˆ1ï¼‰ç›‘æ§ GC çŠ¶æ€</h4>
<p>ä½ éœ€è¦ç›‘æ§ GC ä»è€Œæ£€æŸ¥ç³»ç»Ÿä¸­è¿è¡Œçš„ GC çš„å„ç§çŠ¶æ€ã€‚</p>
<h4 id="-889"><a class="markdownIt-Anchor" href="#-889">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_2-%E5%88%86%E6%9E%90-gc-%E6%97%A5%E5%BF%97">#</a>ï¼ˆ2ï¼‰åˆ†æ GC æ—¥å¿—</h4>
<p>åœ¨æ£€æŸ¥ GC çŠ¶æ€åï¼Œä½ éœ€è¦åˆ†æç›‘æ§ç»“æ„å¹¶å†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œ GC ä¼˜åŒ–ã€‚å¦‚æœåˆ†æç»“æœæ˜¾ç¤ºè¿è¡Œ GC çš„æ—¶é—´åªæœ‰ 0.1-0.3 ç§’ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æŠŠæ—¶é—´æµªè´¹åœ¨ GC ä¼˜åŒ–ä¸Šï¼Œä½†å¦‚æœè¿è¡Œ GC çš„æ—¶é—´è¾¾åˆ° 1-3 ç§’ï¼Œç”šè‡³å¤§äº 10 ç§’ï¼Œé‚£ä¹ˆ GC ä¼˜åŒ–å°†æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ å·²ç»åˆ†é…äº†å¤§çº¦ 10GB å†…å­˜ç»™ Javaï¼Œå¹¶ä¸”è¿™äº›å†…å­˜æ— æ³•çœä¸‹ï¼Œé‚£ä¹ˆå°±æ— æ³•è¿›è¡Œ GC ä¼˜åŒ–äº†ã€‚åœ¨è¿›è¡Œ GC ä¼˜åŒ–ä¹‹å‰ï¼Œä½ éœ€è¦è€ƒè™‘ä¸ºä»€ä¹ˆä½ éœ€è¦åˆ†é…è¿™ä¹ˆå¤§çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœä½ åˆ†é…äº† 1GB æˆ– 2GB å¤§å°çš„å†…å­˜å¹¶ä¸”å‡ºç°äº† <code>OutOfMemoryError</code> ï¼Œé‚£ä½ å°±åº”è¯¥æ‰§è¡Œ ** å †å¿«ç…§ï¼ˆheap dumpï¼‰** æ¥æ¶ˆé™¤å¯¼è‡´å¼‚å¸¸çš„åŸå› ã€‚</p>
<blockquote>
<p>ğŸ”” æ³¨æ„ï¼š</p>
</blockquote>
<blockquote>
<p>** å †å¿«ç…§ï¼ˆheap dumpï¼‰** æ˜¯ä¸€ä¸ªç”¨æ¥æ£€æŸ¥ Java å†…å­˜ä¸­çš„å¯¹è±¡å’Œæ•°æ®çš„å†…å­˜æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¯ä»¥é€šè¿‡æ‰§è¡Œ JDK ä¸­çš„ <code>jmap</code>  å‘½ä»¤æ¥åˆ›å»ºã€‚åœ¨åˆ›å»ºæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ Java ç¨‹åºéƒ½å°†æš‚åœï¼Œå› æ­¤ï¼Œä¸è¦åœ¨ç³»ç»Ÿæ‰§è¡Œè¿‡ç¨‹ä¸­åˆ›å»ºè¯¥æ–‡ä»¶ã€‚</p>
</blockquote>
<blockquote>
<p>ä½ å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæœç´¢ heap dump çš„è¯¦ç»†è¯´æ˜ã€‚</p>
</blockquote>
<h4 id="-890"><a class="markdownIt-Anchor" href="#-890">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-%E9%80%89%E6%8B%A9%E5%90%88%E9%80%82-gc-%E5%9B%9E%E6%94%B6%E5%99%A8">#</a>ï¼ˆ3ï¼‰é€‰æ‹©åˆé€‚ GC å›æ”¶å™¨</h4>
<p>å¦‚æœä½ å†³å®šè¦è¿›è¡Œ GC ä¼˜åŒ–ï¼Œé‚£ä¹ˆä½ éœ€è¦é€‰æ‹©ä¸€ä¸ª GC å›æ”¶å™¨ï¼Œå¹¶ä¸”ä¸ºå®ƒè®¾ç½®åˆç† JVM å‚æ•°ã€‚æ­¤æ—¶å¦‚æœä½ æœ‰å¤šä¸ªæœåŠ¡å™¨ï¼Œè¯·å¦‚ä¸Šæ–‡æåˆ°çš„é‚£æ ·ï¼Œåœ¨æ¯å°æœºå™¨ä¸Šè®¾ç½®ä¸åŒçš„ GC å‚æ•°å¹¶åˆ†æå®ƒä»¬çš„åŒºåˆ«ã€‚</p>
<h4 id="-891"><a class="markdownIt-Anchor" href="#-891">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_4-%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C">#</a>ï¼ˆ4ï¼‰åˆ†æç»“æœ</h4>
<p>åœ¨è®¾ç½®å®Œ GC å‚æ•°åå°±å¯ä»¥å¼€å§‹æ”¶é›†æ•°æ®ï¼Œè¯·åœ¨æ”¶é›†è‡³å°‘ 24 å°æ—¶åå†è¿›è¡Œç»“æœåˆ†æã€‚å¦‚æœä½ è¶³å¤Ÿå¹¸è¿ï¼Œä½ å¯èƒ½ä¼šæ‰¾åˆ°ç³»ç»Ÿçš„æœ€ä½³ GC å‚æ•°ã€‚å¦‚è‹¥ä¸ç„¶ï¼Œä½ è¿˜éœ€è¦åˆ†æè¾“å‡ºæ—¥å¿—å¹¶æ£€æŸ¥åˆ†é…çš„å†…å­˜ï¼Œç„¶åéœ€è¦é€šè¿‡ä¸æ–­è°ƒæ•´ GC ç±»å‹ / å†…å­˜å¤§å°æ¥æ‰¾åˆ°ç³»ç»Ÿçš„æœ€ä½³å‚æ•°ã€‚</p>
<h4 id="-892"><a class="markdownIt-Anchor" href="#-892">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_5-%E5%BA%94%E7%94%A8%E4%BC%98%E5%8C%96%E9%85%8D%E7%BD%AE">#</a>ï¼ˆ5ï¼‰åº”ç”¨ä¼˜åŒ–é…ç½®</h4>
<p>å¦‚æœ GC ä¼˜åŒ–çš„ç»“æœä»¤äººæ»¡æ„ï¼Œå°±å¯ä»¥å°†å‚æ•°åº”ç”¨åˆ°æ‰€æœ‰æœåŠ¡å™¨ä¸Šï¼Œå¹¶åœæ­¢ GC ä¼˜åŒ–ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­ï¼Œä½ å°†ä¼šçœ‹åˆ°ä¸Šè¿°æ¯ä¸€æ­¥æ‰€åšçš„å…·ä½“å·¥ä½œã€‚</p>
<h2 id="-893"><a class="markdownIt-Anchor" href="#-893">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_2-gc-%E6%97%A5%E5%BF%97">#</a>2. GC æ—¥å¿—</h2>
<h3 id="-894"><a class="markdownIt-Anchor" href="#-894">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_2-1-%E8%8E%B7%E5%8F%96-gc-%E6%97%A5%E5%BF%97">#</a>2.1. è·å– GC æ—¥å¿—</h3>
<p>è·å– GC æ—¥å¿—æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ä½¿ç”¨  <code>jstat</code>  å‘½ä»¤åŠ¨æ€æŸ¥çœ‹</li>
<li>åœ¨å®¹å™¨ä¸­è®¾ç½®ç›¸å…³å‚æ•°æ‰“å° GC æ—¥å¿—</li>
</ul>
<h4 id="-895"><a class="markdownIt-Anchor" href="#-895">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#jstat-%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B-gc">#</a>jstat å‘½ä»¤æŸ¥çœ‹ GC</h4>
<p><code>jstat -gc</code>  ç»Ÿè®¡åƒåœ¾å›æ”¶å †çš„è¡Œä¸ºï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">jstat <span class="token operator">-</span>gc <span class="token number">1262</span>
 S0C    S1C     S0U     S1U   EC       EU        OC         OU        PC       PU         YGC    YGCT    FGC    FGCT     GCT
<span class="token number">26112.0</span> <span class="token number">24064.0</span> <span class="token number">6562.5</span>  <span class="token number">0.0</span>   <span class="token number">564224.0</span> <span class="token number">76274.5</span>   <span class="token number">434176.0</span>   <span class="token number">388518.3</span>  <span class="token number">524288.0</span> <span class="token number">42724.7</span>    <span class="token number">320</span>    <span class="token number">6.417</span>   <span class="token number">1</span>      <span class="token number">0.398</span>    <span class="token number">6.815</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ä¹Ÿå¯ä»¥è®¾ç½®é—´éš”å›ºå®šæ—¶é—´æ¥æ‰“å°ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jstat -gc <span class="token number">1262</span> <span class="token number">2000</span> <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>è¿™ä¸ªå‘½ä»¤æ„æ€å°±æ˜¯æ¯éš” 2000ms è¾“å‡º 1262 çš„ gc æƒ…å†µï¼Œä¸€å…±è¾“å‡º 20 æ¬¡</p>
<h4 id="-896"><a class="markdownIt-Anchor" href="#-896">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#%E6%89%93%E5%8D%B0-gc-%E7%9A%84%E5%8F%82%E6%95%B0">#</a>æ‰“å° GC çš„å‚æ•°</h4>
<p>é€šè¿‡ JVM å‚æ•°é¢„å…ˆè®¾ç½® GC æ—¥å¿—ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§ JVM å‚æ•°è®¾ç½®ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">-XX:+PrintGC è¾“å‡º GC æ—¥å¿—
-XX:+PrintGCDetails è¾“å‡º GC çš„è¯¦ç»†æ—¥å¿—
-XX:+PrintGCTimeStamps è¾“å‡º GC çš„æ—¶é—´æˆ³ï¼ˆä»¥åŸºå‡†æ—¶é—´çš„å½¢å¼ï¼‰
-XX:+PrintGCDateStamps è¾“å‡º GC çš„æ—¶é—´æˆ³ï¼ˆä»¥æ—¥æœŸçš„å½¢å¼ï¼Œå¦‚ 2013-05-04T21:53:59.234+0800ï¼‰
-XX:+PrintHeapAtGC åœ¨è¿›è¡Œ GC çš„å‰åæ‰“å°å‡ºå †çš„ä¿¡æ¯
-verbose:gc -Xloggc:../logs/gc.log æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºè·¯å¾„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœæ˜¯é•¿æ—¶é—´çš„ GC æ—¥å¿—ï¼Œæˆ‘ä»¬å¾ˆéš¾é€šè¿‡æ–‡æœ¬å½¢å¼å»æŸ¥çœ‹æ•´ä½“çš„ GC æ€§èƒ½ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<a target="_blank" rel="noopener" href="https://sourceforge.net/projects/gcviewer/"> GCView (opens new window)</a> å·¥å…·æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå›¾å½¢åŒ–ç•Œé¢æŸ¥çœ‹æ•´ä½“çš„ GC æ€§èƒ½ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘Tomcat è®¾ç½®ç¤ºä¾‹</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span><span class="token string">"-server -Xms2000m -Xmx2000m -Xmn800m -XX:PermSize=64m -XX:MaxPermSize=256m -XX:SurvivorRatio=4
-verbose:gc -Xloggc:<span class="token variable">$CATALINA_HOME</span>/logs/gc.log
-Djava.awt.headless=true
-XX:+PrintGCTimeStamps -XX:+PrintGCDetails
-Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000
-XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>-Xms2000m -Xmx2000m -Xmn800m -XX:PermSize=64m -XX:MaxPermSize=256m</code>  Xmsï¼Œå³ä¸º jvm å¯åŠ¨æ—¶å¾— JVM åˆå§‹å †å¤§å°ï¼ŒXmx ä¸º jvm çš„æœ€å¤§å †å¤§å°ï¼Œxmn ä¸ºæ–°ç”Ÿä»£çš„å¤§å°ï¼Œpermsize ä¸ºæ°¸ä¹…ä»£çš„åˆå§‹å¤§å°ï¼ŒMaxPermSize ä¸ºæ°¸ä¹…ä»£çš„æœ€å¤§ç©ºé—´ã€‚</li>
<li><code>-XX:SurvivorRatio=4</code>  SurvivorRatio ä¸ºæ–°ç”Ÿä»£ç©ºé—´ä¸­çš„ Eden åŒºå’Œæ•‘åŠ©ç©ºé—´ Survivor åŒºçš„å¤§å°æ¯”å€¼ï¼Œé»˜è®¤æ˜¯ 8ï¼Œåˆ™ä¸¤ä¸ª Survivor åŒºä¸ä¸€ä¸ª Eden åŒºçš„æ¯”å€¼ä¸º 2:8, ä¸€ä¸ª Survivor åŒºå æ•´ä¸ªå¹´è½»ä»£çš„ 1/10ã€‚è°ƒå°è¿™ä¸ªå‚æ•°å°†å¢å¤§ survivor åŒºï¼Œè®©å¯¹è±¡å°½é‡åœ¨ survitor åŒºå‘†é•¿ä¸€ç‚¹ï¼Œå‡å°‘è¿›å…¥å¹´è€ä»£çš„å¯¹è±¡ã€‚å»æ‰æ•‘åŠ©ç©ºé—´çš„æƒ³æ³•æ˜¯è®©å¤§éƒ¨åˆ†ä¸èƒ½é©¬ä¸Šå›æ”¶çš„æ•°æ®å°½å¿«è¿›å…¥å¹´è€ä»£ï¼ŒåŠ å¿«å¹´è€ä»£çš„å›æ”¶é¢‘ç‡ï¼Œå‡å°‘å¹´è€ä»£æš´æ¶¨çš„å¯èƒ½æ€§ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡å°† - XX:SurvivorRatio è®¾ç½®æˆæ¯”è¾ƒå¤§çš„å€¼ï¼ˆæ¯”å¦‚ 65536) æ¥åšåˆ°ã€‚</li>
<li><code>-verbose:gc -Xloggc:$CATALINA_HOME/logs/gc.log</code>  å°†è™šæ‹Ÿæœºæ¯æ¬¡åƒåœ¾å›æ”¶çš„ä¿¡æ¯å†™åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åç”± file æŒ‡å®šï¼Œæ–‡ä»¶æ ¼å¼æ˜¯å¹³æ–‡ä»¶ï¼Œå†…å®¹å’Œ - verbose:gc è¾“å‡ºå†…å®¹ç›¸åŒã€‚</li>
<li><code>-Djava.awt.headless=true</code>  Headless æ¨¡å¼æ˜¯ç³»ç»Ÿçš„ä¸€ç§é…ç½®æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿç¼ºå°‘äº†æ˜¾ç¤ºè®¾å¤‡ã€é”®ç›˜æˆ–é¼ æ ‡ã€‚</li>
<li><code>-XX:+PrintGCTimeStamps -XX:+PrintGCDetails</code>  è®¾ç½® gc æ—¥å¿—çš„æ ¼å¼</li>
<li><code>-Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000</code>  æŒ‡å®š rmi è°ƒç”¨æ—¶ gc çš„æ—¶é—´é—´éš”</li>
<li><code>-XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15</code>  é‡‡ç”¨å¹¶å‘ gc æ–¹å¼ï¼Œç»è¿‡ 15 æ¬¡ minor gc åè¿›å…¥å¹´è€ä»£</li>
</ul>
<h3 id="-897"><a class="markdownIt-Anchor" href="#-897">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_2-2-%E5%88%86%E6%9E%90-gc-%E6%97%A5%E5%BF%97">#</a>2.2. åˆ†æ GC æ—¥å¿—</h3>
<p>Young GC å›æ”¶æ—¥å¿—:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">2016</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">05</span>T10<span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">18.093</span><span class="token operator">+</span><span class="token number">0800</span><span class="token operator">:</span> <span class="token number">25.395</span><span class="token operator">:</span> <span class="token punctuation">[</span>GC <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">274931</span>K<span class="token operator">-></span><span class="token function">10738K</span><span class="token punctuation">(</span><span class="token number">274944</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">371093</span>K<span class="token operator">-></span><span class="token function">147186K</span><span class="token punctuation">(</span><span class="token number">450048</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0668480</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.17</span> sys<span class="token operator">=</span><span class="token number">0.08</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.07</span> secs<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Full GC å›æ”¶æ—¥å¿—:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">2016</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">05</span>T10<span class="token operator">:</span><span class="token number">43</span><span class="token operator">:</span><span class="token number">18.160</span><span class="token operator">+</span><span class="token number">0800</span><span class="token operator">:</span> <span class="token number">25.462</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token class-name">Full</span> GC <span class="token punctuation">[</span><span class="token class-name">PSYoungGen</span><span class="token operator">:</span> <span class="token number">10738</span>K<span class="token operator">-></span><span class="token function">0K</span><span class="token punctuation">(</span><span class="token number">274944</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">ParOldGen</span><span class="token operator">:</span> <span class="token number">136447</span>K<span class="token operator">-></span><span class="token function">140379K</span><span class="token punctuation">(</span><span class="token number">302592</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token number">147186</span>K<span class="token operator">-></span><span class="token function">140379K</span><span class="token punctuation">(</span><span class="token number">577536</span>K<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">PSPermGen</span><span class="token operator">:</span> <span class="token number">85411</span>K<span class="token operator">-></span><span class="token function">85376K</span><span class="token punctuation">(</span><span class="token number">171008</span>K<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.6763541</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">1.75</span> sys<span class="token operator">=</span><span class="token number">0.02</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.68</span> secs<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>é€šè¿‡ä¸Šé¢æ—¥å¿—åˆ†æå¾—å‡ºï¼ŒPSYoungGenã€ParOldGenã€PSPermGen å±äº Parallel æ”¶é›†å™¨ã€‚å…¶ä¸­ PSYoungGen è¡¨ç¤º gc å›æ”¶å‰åå¹´è½»ä»£çš„å†…å­˜å˜åŒ–ï¼›ParOldGen è¡¨ç¤º gc å›æ”¶å‰åè€å¹´ä»£çš„å†…å­˜å˜åŒ–ï¼›PSPermGen è¡¨ç¤º gc å›æ”¶å‰åæ°¸ä¹…åŒºçš„å†…å­˜å˜åŒ–ã€‚young gc ä¸»è¦æ˜¯é’ˆå¯¹å¹´è½»ä»£è¿›è¡Œå†…å­˜å›æ”¶æ¯”è¾ƒé¢‘ç¹ï¼Œè€—æ—¶çŸ­ï¼›full gc ä¼šå¯¹æ•´ä¸ªå †å†…å­˜è¿›è¡Œå›åŸï¼Œè€—æ—¶é•¿ï¼Œå› æ­¤ä¸€èˆ¬å°½é‡å‡å°‘ full gc çš„æ¬¡æ•°</p>
<p>é€šè¿‡ä¸¤å¼ å›¾éå¸¸æ˜æ˜¾çœ‹å‡º gc æ—¥å¿—æ„æˆï¼š</p>
<p>YOUNG GC</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20220107093538.jfif" alt="img"></p>
<p>FULL GC</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20220107093543.jfif" alt="img"></p>
<h4 id="-898"><a class="markdownIt-Anchor" href="#-898">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#cpu-%E8%BF%87%E9%AB%98">#</a>CPU è¿‡é«˜</h4>
<p>å®šä½æ­¥éª¤ï¼š</p>
<p>ï¼ˆ1ï¼‰æ‰§è¡Œ top -c å‘½ä»¤ï¼Œæ‰¾åˆ° cpu æœ€é«˜çš„è¿›ç¨‹çš„ id</p>
<p>ï¼ˆ2ï¼‰jstack PID å¯¼å‡º Java åº”ç”¨ç¨‹åºçš„çº¿ç¨‹å †æ ˆä¿¡æ¯ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">jstack <span class="token number">6795</span>

<span class="token string">"Low Memory Detector"</span> daemon prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x081465f8</span> nid<span class="token operator">=</span><span class="token number">0x7</span> runnable <span class="token punctuation">[</span><span class="token number">0x00000000</span><span class="token punctuation">.</span><span class="token number">.0</span>x00000000<span class="token punctuation">]</span>
        <span class="token string">"CompilerThread0"</span> daemon prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x08143c58</span> nid<span class="token operator">=</span><span class="token number">0x6</span> waiting on condition <span class="token punctuation">[</span><span class="token number">0x00000000</span><span class="token punctuation">.</span><span class="token number">.0</span>xfb5fd798<span class="token punctuation">]</span>
        <span class="token string">"Signal Dispatcher"</span> daemon prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x08142f08</span> nid<span class="token operator">=</span><span class="token number">0x5</span> waiting on condition <span class="token punctuation">[</span><span class="token number">0x00000000</span><span class="token punctuation">.</span><span class="token number">.0</span>x00000000<span class="token punctuation">]</span>
        <span class="token string">"Finalizer"</span> daemon prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x08137ca0</span> nid<span class="token operator">=</span><span class="token number">0x4</span> in <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0xfbeed000</span><span class="token punctuation">.</span><span class="token number">.0</span>xfbeeddb8<span class="token punctuation">]</span>

        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>

        <span class="token operator">-</span> waiting on <span class="token generics"><span class="token punctuation">&lt;</span>0xef600848<span class="token punctuation">></span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>ReferenceQueue</span>$<span class="token class-name">Lock</span><span class="token punctuation">)</span>

        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>ReferenceQueue</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">ReferenceQueue</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">116</span><span class="token punctuation">)</span>

        <span class="token operator">-</span> locked <span class="token generics"><span class="token punctuation">&lt;</span>0xef600848<span class="token punctuation">></span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>ReferenceQueue</span>$<span class="token class-name">Lock</span><span class="token punctuation">)</span>

        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>ReferenceQueue</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">ReferenceQueue</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">132</span><span class="token punctuation">)</span>

        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>Finalizer</span>$<span class="token class-name">FinalizerThread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Finalizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">159</span><span class="token punctuation">)</span>

        <span class="token string">"Reference Handler"</span> daemon prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x081370f0</span> nid<span class="token operator">=</span><span class="token number">0x3</span> in <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0xfbf4a000</span><span class="token punctuation">.</span><span class="token number">.0</span>xfbf4aa38<span class="token punctuation">]</span>

        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>

        <span class="token operator">-</span> waiting on <span class="token generics"><span class="token punctuation">&lt;</span>0xef600758<span class="token punctuation">></span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>Reference</span>$<span class="token class-name">Lock</span><span class="token punctuation">)</span>

        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">474</span><span class="token punctuation">)</span>

        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>Reference</span>$<span class="token class-name">ReferenceHandler</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Reference</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">116</span><span class="token punctuation">)</span>

        <span class="token operator">-</span> locked <span class="token generics"><span class="token punctuation">&lt;</span>0xef600758<span class="token punctuation">></span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>ref<span class="token punctuation">.</span></span>Reference</span>$<span class="token class-name">Lock</span><span class="token punctuation">)</span>

        <span class="token string">"VM Thread"</span> prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x08134878</span> nid<span class="token operator">=</span><span class="token number">0x2</span> runnable

        <span class="token string">"VM Periodic Task Thread"</span> prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x08147768</span> nid<span class="token operator">=</span><span class="token number">0x8</span> waiting on condition<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åœ¨æ‰“å°çš„å †æ ˆæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œtid å’Œ nid çš„å«ä¹‰ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">nid : å¯¹åº”çš„ Linux æ“ä½œç³»ç»Ÿä¸‹çš„ tid çº¿ç¨‹å·ï¼Œä¹Ÿå°±æ˜¯å‰é¢è½¬åŒ–çš„ 16 è¿›åˆ¶æ•°å­—
tid: è¿™ä¸ªåº”è¯¥æ˜¯ jvm çš„ jmm å†…å­˜è§„èŒƒä¸­çš„å”¯ä¸€åœ°å€å®šä½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>åœ¨ CPU è¿‡é«˜çš„æƒ…å†µä¸‹ï¼ŒæŸ¥æ‰¾å“åº”çš„çº¿ç¨‹ï¼Œä¸€èˆ¬å®šä½éƒ½æ˜¯ç”¨ nid æ¥å®šä½çš„ã€‚è€Œå¦‚æœå‘ç”Ÿæ­»é”ä¹‹ç±»çš„é—®é¢˜ï¼Œä¸€èˆ¬ç”¨ tid æ¥å®šä½ã€‚</p>
<p>ï¼ˆ3ï¼‰å®šä½ CPU é«˜çš„çº¿ç¨‹æ‰“å°å…¶ nid</p>
<p>æŸ¥çœ‹çº¿ç¨‹ä¸‹å…·ä½“è¿›ç¨‹ä¿¡æ¯çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<p>top -H -p 6735</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">top <span class="token operator">-</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">20</span><span class="token operator">:</span><span class="token number">09</span> up <span class="token number">611</span> days<span class="token punctuation">,</span>  <span class="token number">2</span><span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">,</span>  <span class="token number">1</span> user<span class="token punctuation">,</span>  load average<span class="token operator">:</span> <span class="token number">13.19</span><span class="token punctuation">,</span> <span class="token number">7.76</span><span class="token punctuation">,</span> <span class="token number">7.82</span>
<span class="token class-name">Threads</span><span class="token operator">:</span> <span class="token number">6991</span> total<span class="token punctuation">,</span>  <span class="token number">17</span> running<span class="token punctuation">,</span> <span class="token number">6974</span> sleeping<span class="token punctuation">,</span>   <span class="token number">0</span> stopped<span class="token punctuation">,</span>   <span class="token number">0</span> zombie
<span class="token operator">%</span><span class="token class-name">Cpu</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">90.4</span> us<span class="token punctuation">,</span>  <span class="token number">2.1</span> sy<span class="token punctuation">,</span>  <span class="token number">0.0</span> ni<span class="token punctuation">,</span>  <span class="token number">7.0</span> id<span class="token punctuation">,</span>  <span class="token number">0.0</span> wa<span class="token punctuation">,</span>  <span class="token number">0.0</span> hi<span class="token punctuation">,</span>  <span class="token number">0.4</span> si<span class="token punctuation">,</span>  <span class="token number">0.0</span> st
<span class="token class-name">KiB</span> <span class="token class-name">Mem</span><span class="token operator">:</span>  <span class="token number">32783044</span> total<span class="token punctuation">,</span> <span class="token number">32505008</span> used<span class="token punctuation">,</span>   <span class="token number">278036</span> free<span class="token punctuation">,</span>   <span class="token number">120304</span> buffers
<span class="token class-name">KiB</span> <span class="token class-name">Swap</span><span class="token operator">:</span>        <span class="token number">0</span> total<span class="token punctuation">,</span>        <span class="token number">0</span> used<span class="token punctuation">,</span>        <span class="token number">0</span> free<span class="token punctuation">.</span> <span class="token number">4497428</span> cached <span class="token class-name">Mem</span>

  PID USER      PR  NI    VIRT    RES    SHR <span class="token class-name">S</span> <span class="token operator">%</span>CPU <span class="token operator">%</span>MEM     TIME<span class="token operator">+</span> COMMAND
 <span class="token number">6800</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">54.7</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">55.61</span> java
 <span class="token number">6803</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">54.4</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">52.59</span> java
 <span class="token number">6798</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">53.7</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">55.08</span> java
 <span class="token number">6801</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">53.7</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">55.25</span> java
 <span class="token number">6797</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">53.1</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">52.78</span> java
 <span class="token number">6804</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">53.1</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">55.76</span> java
 <span class="token number">6802</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">52.1</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">54.79</span> java
 <span class="token number">6799</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">51.8</span> <span class="token number">70.1</span> <span class="token number">187</span><span class="token operator">:</span><span class="token number">53.36</span> java
 <span class="token number">6807</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span> <span class="token number">13.6</span> <span class="token number">70.1</span>  <span class="token number">48</span><span class="token operator">:</span><span class="token number">58.60</span> java
<span class="token number">11014</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">R</span>  <span class="token number">8.4</span> <span class="token number">70.1</span>   <span class="token number">8</span><span class="token operator">:</span><span class="token number">00.32</span> java
<span class="token number">10642</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">R</span>  <span class="token number">6.5</span> <span class="token number">70.1</span>   <span class="token number">6</span><span class="token operator">:</span><span class="token number">32.06</span> java
 <span class="token number">6808</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span>  <span class="token number">6.1</span> <span class="token number">70.1</span> <span class="token number">159</span><span class="token operator">:</span><span class="token number">08.40</span> java
<span class="token number">11315</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span>  <span class="token number">3.9</span> <span class="token number">70.1</span>   <span class="token number">5</span><span class="token operator">:</span><span class="token number">54.10</span> java
<span class="token number">12545</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span>  <span class="token number">3.9</span> <span class="token number">70.1</span>   <span class="token number">6</span><span class="token operator">:</span><span class="token number">55.48</span> java
<span class="token number">23353</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span>  <span class="token number">3.9</span> <span class="token number">70.1</span>   <span class="token number">2</span><span class="token operator">:</span><span class="token number">20.55</span> java
<span class="token number">24868</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span>  <span class="token number">3.9</span> <span class="token number">70.1</span>   <span class="token number">2</span><span class="token operator">:</span><span class="token number">12.46</span> java
 <span class="token number">9146</span> root      <span class="token number">20</span>   <span class="token number">0</span> <span class="token number">27.299</span>g <span class="token number">0.021</span>t   <span class="token number">7172</span> <span class="token class-name">S</span>  <span class="token number">3.6</span> <span class="token number">70.1</span>   <span class="token number">7</span><span class="token operator">:</span><span class="token number">42.72</span> java<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ç”±æ­¤å¯ä»¥çœ‹å‡ºå ç”¨ CPU è¾ƒé«˜çš„çº¿ç¨‹ï¼Œä½†æ˜¯è¿™äº›è¿˜ä¸é«˜ï¼Œæ— æ³•ç›´æ¥å®šä½åˆ°å…·ä½“çš„ç±»ã€‚nid æ˜¯ 16 è¿›åˆ¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è·å–çº¿ç¨‹çš„ 16 è¿›åˆ¶ IDï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">printf "%x\n" 6800
è¾“å‡ºç»“æœ:45cd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>ç„¶åæ ¹æ®è¾“å‡ºç»“æœåˆ° jstack æ‰“å°çš„å †æ ˆæ—¥å¿—ä¸­æŸ¥å®šä½ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token string">"catalina-exec-5692"</span> daemon prio<span class="token operator">=</span><span class="token number">10</span> tid<span class="token operator">=</span><span class="token number">0x00007f3b05013800</span> nid<span class="token operator">=</span><span class="token number">0x45cd</span> waiting on condition <span class="token punctuation">[</span><span class="token number">0x00007f3ae08e3000</span><span class="token punctuation">]</span>
   <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread<span class="token punctuation">.</span>State</span><span class="token operator">:</span> TIMED_WAITING <span class="token punctuation">(</span>parking<span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>Unsafe</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> parking <span class="token keyword">to</span> <span class="token namespace">wait</span> <span class="token keyword">for</span>  <span class="token generics"><span class="token punctuation">&lt;</span>0x00000006a7800598<span class="token punctuation">></span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span>$<span class="token class-name">ConditionObject</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>LockSupport</span><span class="token punctuation">.</span><span class="token function">parkNanos</span><span class="token punctuation">(</span><span class="token class-name">LockSupport</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">226</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span>$<span class="token class-name">ConditionObject</span><span class="token punctuation">.</span><span class="token function">awaitNanos</span><span class="token punctuation">(</span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2082</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>LinkedBlockingQueue</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">LinkedBlockingQueue</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">467</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span>TaskQueue</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">TaskQueue</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">86</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span>TaskQueue</span><span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">TaskQueue</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token function">getTask</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1068</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1130</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span>$<span class="token class-name">Worker</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">615</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>tomcat<span class="token punctuation">.</span>util<span class="token punctuation">.</span>threads<span class="token punctuation">.</span></span>TaskThread</span>$<span class="token class-name">WrappingRunnable</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TaskThread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">61</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">745</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-899"><a class="markdownIt-Anchor" href="#-899">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-gc-%E9%85%8D%E7%BD%AE">#</a>3. GC é…ç½®</h2>
<blockquote>
<p>è¯¦ç»†å‚æ•°è¯´æ˜è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html">JavaHotSpot VM Options (opens new window)</a>ï¼Œè¿™é‡Œä»…åˆ—ä¸¾å¸¸ç”¨å‚æ•°ã€‚</p>
</blockquote>
<h3 id="-900"><a class="markdownIt-Anchor" href="#-900">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-1-%E5%A0%86%E5%A4%A7%E5%B0%8F%E8%AE%BE%E7%BD%AE">#</a>3.1. å †å¤§å°è®¾ç½®</h3>
<p><strong>å¹´è½»ä»£çš„è®¾ç½®å¾ˆå…³é”®ã€‚</strong></p>
<p>JVM ä¸­æœ€å¤§å †å¤§å°æœ‰ä¸‰æ–¹é¢é™åˆ¶ï¼š</p>
<ol>
<li>ç›¸å…³æ“ä½œç³»ç»Ÿçš„æ•°æ®æ¨¡å‹ï¼ˆ32-bt è¿˜æ˜¯ 64-bitï¼‰é™åˆ¶ï¼›</li>
<li>ç³»ç»Ÿçš„å¯ç”¨è™šæ‹Ÿå†…å­˜é™åˆ¶ï¼›</li>
<li>ç³»ç»Ÿçš„å¯ç”¨ç‰©ç†å†…å­˜é™åˆ¶ã€‚</li>
</ol>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">æ•´ä¸ªå †å¤§å° = å¹´è½»ä»£å¤§å° + å¹´è€ä»£å¤§å° + æŒä¹…ä»£å¤§å°<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>æŒä¹…ä»£ä¸€èˆ¬å›ºå®šå¤§å°ä¸º  <code>64m</code> ã€‚ä½¿ç”¨  <code>-XX:PermSize</code>  è®¾ç½®ã€‚</li>
<li>å®˜æ–¹æ¨èå¹´è½»ä»£å æ•´ä¸ªå †çš„ 3/8ã€‚ä½¿ç”¨  <code>-Xmn</code>  è®¾ç½®ã€‚</li>
</ul>
<h3 id="-901"><a class="markdownIt-Anchor" href="#-901">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-2-jvm-%E5%86%85%E5%AD%98%E9%85%8D%E7%BD%AE">#</a>3.2. JVM å†…å­˜é…ç½®</h3>
<table>
<thead>
<tr>
<th>é…ç½®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-Xss</code></td>
<td>è™šæ‹Ÿæœºæ ˆå¤§å°ã€‚</td>
</tr>
<tr>
<td><code>-Xms</code></td>
<td>å †ç©ºé—´åˆå§‹å€¼ã€‚</td>
</tr>
<tr>
<td><code>-Xmx</code></td>
<td>å †ç©ºé—´æœ€å¤§å€¼ã€‚</td>
</tr>
<tr>
<td><code>-Xmn</code></td>
<td>æ–°ç”Ÿä»£ç©ºé—´å¤§å°ã€‚</td>
</tr>
<tr>
<td><code>-XX:NewSize</code></td>
<td>æ–°ç”Ÿä»£ç©ºé—´åˆå§‹å€¼ã€‚</td>
</tr>
<tr>
<td><code>-XX:MaxNewSize</code></td>
<td>æ–°ç”Ÿä»£ç©ºé—´æœ€å¤§å€¼ã€‚</td>
</tr>
<tr>
<td><code>-XX:NewRatio</code></td>
<td>æ–°ç”Ÿä»£ä¸å¹´è€ä»£çš„æ¯”ä¾‹ã€‚é»˜è®¤ä¸º 2ï¼Œæ„å‘³ç€è€å¹´ä»£æ˜¯æ–°ç”Ÿä»£çš„ 2 å€ã€‚</td>
</tr>
<tr>
<td><code>-XX:SurvivorRatio</code></td>
<td>æ–°ç”Ÿä»£ä¸­è°ƒæ•´ eden åŒºä¸ survivor åŒºçš„æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º 8ã€‚å³  <code>eden</code>  åŒºä¸º 80% çš„å¤§å°ï¼Œä¸¤ä¸ª  <code>survivor</code>  åˆ†åˆ«ä¸º 10% çš„å¤§å°ã€‚</td>
</tr>
<tr>
<td><code>-XX:PermSize</code></td>
<td>æ°¸ä¹…ä»£ç©ºé—´çš„åˆå§‹å€¼ã€‚</td>
</tr>
<tr>
<td><code>-XX:MaxPermSize</code></td>
<td>æ°¸ä¹…ä»£ç©ºé—´çš„æœ€å¤§å€¼ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="-902"><a class="markdownIt-Anchor" href="#-902">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-3-gc-%E7%B1%BB%E5%9E%8B%E9%85%8D%E7%BD%AE">#</a>3.3. GC ç±»å‹é…ç½®</h3>
<table>
<thead>
<tr>
<th>é…ç½®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-XX:+UseSerialGC</code></td>
<td>ä½¿ç”¨ Serial + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆ</td>
</tr>
<tr>
<td><code>-XX:+UseParallelGC</code></td>
<td>ä½¿ç”¨ Parallel Scavenge + Parallel Old åƒåœ¾å›æ”¶å™¨ç»„åˆ</td>
</tr>
<tr>
<td><code>-XX:+UseParallelOldGC</code></td>
<td>ä½¿ç”¨ Parallel Old åƒåœ¾å›æ”¶å™¨ï¼ˆJDK5 åå·²æ— ç”¨ï¼‰</td>
</tr>
<tr>
<td><code>-XX:+UseParNewGC</code></td>
<td>ä½¿ç”¨ ParNew + Serial Old åƒåœ¾å›æ”¶å™¨</td>
</tr>
<tr>
<td><code>-XX:+UseConcMarkSweepGC</code></td>
<td>ä½¿ç”¨ CMS + ParNew + Serial Old åƒåœ¾å›æ”¶å™¨ç»„åˆ</td>
</tr>
<tr>
<td><code>-XX:+UseG1GC</code></td>
<td>ä½¿ç”¨ G1 åƒåœ¾å›æ”¶å™¨</td>
</tr>
<tr>
<td><code>-XX:ParallelCMSThreads</code></td>
<td>å¹¶å‘æ ‡è®°æ‰«æåƒåœ¾å›æ”¶å™¨ = ä¸ºä½¿ç”¨çš„çº¿ç¨‹æ•°é‡</td>
</tr>
</tbody>
</table>
<h3 id="-903"><a class="markdownIt-Anchor" href="#-903">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-4-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E9%80%9A%E7%94%A8%E5%8F%82%E6%95%B0">#</a>3.4. åƒåœ¾å›æ”¶å™¨é€šç”¨å‚æ•°</h3>
<table>
<thead>
<tr>
<th>é…ç½®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PretenureSizeThreshold</code></td>
<td>æ™‹å‡å¹´è€ä»£çš„å¯¹è±¡å¤§å°ã€‚é»˜è®¤ä¸º 0ã€‚æ¯”å¦‚è®¾ä¸º 10Mï¼Œåˆ™è¶…è¿‡ 10M çš„å¯¹è±¡å°†ä¸åœ¨ eden åŒºåˆ†é…ï¼Œè€Œç›´æ¥è¿›å…¥å¹´è€ä»£ã€‚</td>
</tr>
<tr>
<td><code>MaxTenuringThreshold</code></td>
<td>æ™‹å‡è€å¹´ä»£çš„æœ€å¤§å¹´é¾„ã€‚é»˜è®¤ä¸º 15ã€‚æ¯”å¦‚è®¾ä¸º 10ï¼Œåˆ™å¯¹è±¡åœ¨ 10 æ¬¡æ™®é€š GC åå°†ä¼šè¢«æ”¾å…¥å¹´è€ä»£ã€‚</td>
</tr>
<tr>
<td><code>DisableExplicitGC</code></td>
<td>ç¦ç”¨  <code>System.gc()</code></td>
</tr>
</tbody>
</table>
<h3 id="-904"><a class="markdownIt-Anchor" href="#-904">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-5-jmx">#</a>3.5. JMX</h3>
<p>å¼€å¯ JMX åï¼Œå¯ä»¥ä½¿ç”¨  <code>jconsole</code>  æˆ–  <code>jvisualvm</code>  è¿›è¡Œç›‘æ§ Java ç¨‹åºçš„åŸºæœ¬ä¿¡æ¯å’Œè¿è¡Œæƒ…å†µã€‚</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token operator">=</span><span class="token boolean">true</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>ssl<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>authenticate<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token operator">-</span><span class="token class-name">Djava</span><span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>server<span class="token punctuation">.</span>hostname<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">18888</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>-Djava.rmi.server.hostname</code>  æŒ‡å®š Java ç¨‹åºè¿è¡Œçš„æœåŠ¡å™¨ï¼Œ <code>-Dcom.sun.management.jmxremote.port</code>  æŒ‡å®šæœåŠ¡ç›‘å¬ç«¯å£ã€‚</p>
<h3 id="-905"><a class="markdownIt-Anchor" href="#-905">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-6-%E8%BF%9C%E7%A8%8B-debug">#</a>3.6. è¿œç¨‹ DEBUG</h3>
<p>å¦‚æœå¼€å¯ Java åº”ç”¨çš„è¿œç¨‹ Debug åŠŸèƒ½ï¼Œéœ€è¦æŒ‡å®šå¦‚ä¸‹å‚æ•°ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span><span class="token class-name">Xdebug</span>
<span class="token operator">-</span><span class="token class-name">Xnoagent</span>
<span class="token operator">-</span><span class="token class-name">Djava</span><span class="token punctuation">.</span>compiler<span class="token operator">=</span>NONE
<span class="token operator">-</span><span class="token class-name">Xrunjdwp</span><span class="token operator">:</span>transport<span class="token operator">=</span>dt_socket<span class="token punctuation">,</span>address<span class="token operator">=</span><span class="token number">28888</span><span class="token punctuation">,</span>server<span class="token operator">=</span>y<span class="token punctuation">,</span>suspend<span class="token operator">=</span>n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>address å³ä¸ºè¿œç¨‹ debug çš„ç›‘å¬ç«¯å£ã€‚</p>
<h3 id="-906"><a class="markdownIt-Anchor" href="#-906">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-7-heapdump">#</a>3.7. HeapDump</h3>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">-</span><span class="token class-name">OmitStackTraceInFastThrow</span> <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">HeapDumpOnOutOfMemoryError</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-907"><a class="markdownIt-Anchor" href="#-907">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-action.html#_3-8-%E8%BE%85%E5%8A%A9%E9%85%8D%E7%BD%AE">#</a>3.8. è¾…åŠ©é…ç½®</h3>
<table>
<thead>
<tr>
<th>é…ç½®</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-XX:+PrintGCDetails</code></td>
<td>æ‰“å° GC æ—¥å¿—</td>
</tr>
<tr>
<td><code>-Xloggc:&lt;filename&gt;</code></td>
<td>æŒ‡å®š GC æ—¥å¿—æ–‡ä»¶å</td>
</tr>
<tr>
<td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td>
<td>å†…å­˜æº¢å‡ºæ—¶è¾“å‡ºå †å¿«ç…§æ–‡ä»¶</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="jvm-å‘½ä»¤è¡Œå·¥å…·"><a class="markdownIt-Anchor" href="#jvm-å‘½ä»¤è¡Œå·¥å…·">#</a> JVM å‘½ä»¤è¡Œå·¥å…·</h1>
<blockquote>
<p>Java ç¨‹åºå‘˜å…ä¸äº†æ•…éšœæ’æŸ¥å·¥ä½œï¼Œæ‰€ä»¥ç»å¸¸éœ€è¦ä½¿ç”¨ä¸€äº› JVM å·¥å…·ã€‚</p>
<p>JDK è‡ªå¸¦äº†ä¸€äº›å®ç”¨çš„å‘½ä»¤è¡Œå·¥å…·æ¥ç›‘æ§ã€åˆ†æ JVM ä¿¡æ¯ï¼ŒæŒæ¡å®ƒä»¬ï¼Œéå¸¸æœ‰åŠ©äº TroubleShootingã€‚</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯è¾ƒå¸¸ç”¨çš„ JDK å‘½ä»¤è¡Œå·¥å…·ï¼š</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jps</code></td>
<td>JVM è¿›ç¨‹çŠ¶æ€å·¥å…·ã€‚æ˜¾ç¤ºç³»ç»Ÿå†…çš„æ‰€æœ‰ JVM è¿›ç¨‹ã€‚</td>
</tr>
<tr>
<td><code>jstat</code></td>
<td>JVM ç»Ÿè®¡ç›‘æ§å·¥å…·ã€‚ç›‘æ§è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡º JVM è¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€GCã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</td>
</tr>
<tr>
<td><code>jmap</code></td>
<td>JVM å †å†…å­˜åˆ†æå·¥å…·ã€‚ç”¨äºæ‰“å° JVM è¿›ç¨‹å¯¹è±¡ç›´æ–¹å›¾ã€ç±»åŠ è½½ç»Ÿè®¡ã€‚å¹¶ä¸”å¯ä»¥ç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º heapdump æˆ– dump æ–‡ä»¶ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>jstack</code></td>
<td>JVM æ ˆæŸ¥çœ‹å·¥å…·ã€‚ç”¨äºæ‰“å° JVM è¿›ç¨‹çš„çº¿ç¨‹å’Œé”çš„æƒ…å†µã€‚å¹¶ä¸”å¯ä»¥ç”Ÿæˆçº¿ç¨‹å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º threaddump æˆ– javacore æ–‡ä»¶ï¼‰ã€‚</td>
</tr>
<tr>
<td><code>jhat</code></td>
<td>ç”¨æ¥åˆ†æ jmap ç”Ÿæˆçš„ dump æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td><code>jinfo</code></td>
<td>JVM ä¿¡æ¯æŸ¥çœ‹å·¥å…·ã€‚ç”¨äºå®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´ JVM è¿›ç¨‹å‚æ•°ã€‚</td>
</tr>
<tr>
<td><code>jcmd</code></td>
<td>JVM å‘½ä»¤è¡Œè°ƒè¯• å·¥å…·ã€‚ç”¨äºå‘ JVM è¿›ç¨‹å‘é€è°ƒè¯•å‘½ä»¤ã€‚</td>
</tr>
</tbody>
</table>
<ul>
<li>\1. jps
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#11-jps-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">1.1. jps å‘½ä»¤ç”¨æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#12-jps-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">1.2. jps ä½¿ç”¨ç¤ºä¾‹</a></li>
</ul>
</li>
<li>\2. jstat
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#21-jstat-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">2.1. jstat å‘½ä»¤ç”¨æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#22-jstat-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">2.2. jstat ä½¿ç”¨ç¤ºä¾‹</a></li>
</ul>
</li>
<li>\3. jmap
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#31-jmap-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">3.1. jmap å‘½ä»¤ç”¨æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#32-jstat-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">3.2. jstat ä½¿ç”¨ç¤ºä¾‹</a></li>
</ul>
</li>
<li>\4. jstack
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#41-jstack-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">4.1. jstack å‘½ä»¤ç”¨æ³•</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#42-thread-dump-%E6%96%87%E4%BB%B6">4.2. thread dump æ–‡ä»¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#43-%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81">4.3. ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#44-jstack-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">4.4. jstack ä½¿ç”¨ç¤ºä¾‹</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#5-jinfo">5. jinfo</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#6-jhat">6. jhat</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#7-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">7. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-908"><a class="markdownIt-Anchor" href="#-908">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_1-jps">#</a>1. jps</h2>
<blockquote>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jps.html#GUID-6EB65B96-F9DD-4356-B825-6146E9EEC81E">jps(JVM Process Status Tool) (opens new window)</a> æ˜¯è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€å·¥å…·</strong>ã€‚å®ƒå¯ä»¥æ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„ HotSpot è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€ä¿¡æ¯ã€‚jps é€šè¿‡ RMI åè®®æŸ¥è¯¢å¼€å¯äº† RMI æœåŠ¡çš„è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹çŠ¶æ€ã€‚</p>
</blockquote>
<h3 id="-909"><a class="markdownIt-Anchor" href="#-909">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_1-1-jps-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">#</a>1.1. jps å‘½ä»¤ç”¨æ³•</h3>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jps <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>hostid<span class="token punctuation">]</span>
jps <span class="token punctuation">[</span>-help<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¦‚æœä¸æŒ‡å®š hostid å°±é»˜è®¤ä¸ºå½“å‰ä¸»æœºæˆ–æœåŠ¡å™¨ã€‚</p>
<p>å¸¸ç”¨å‚æ•°ï¼š</p>
<ul>
<li>
<pre><code>  option
  <pre class="line-numbers language-none"><code class="language-none">
	 

	\- é€‰é¡¹å‚æ•°

	- &#96;-m&#96; - è¾“å‡º JVM å¯åŠ¨æ—¶ä¼ é€’ç»™ main() çš„å‚æ•°ã€‚
	- &#96;-l&#96; - è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯ jar åŒ…ï¼Œè¾“å‡º jar è·¯å¾„ã€‚
	- &#96;-v&#96; - æ˜¾ç¤ºä¼ é€’ç»™ JVM çš„å‚æ•°ã€‚
	- &#96;-q&#96; - ä»…è¾“å‡ºæœ¬åœ° JVM è¿›ç¨‹ IDã€‚
	- &#96;-V&#96; - ä»…è¾“å‡ºæœ¬åœ° JVM æ ‡è¯†ç¬¦ã€‚

- &#96;hostid&#96; - RMI æ³¨å†Œè¡¨ä¸­æ³¨å†Œçš„ä¸»æœºåã€‚å¦‚æœä¸æŒ‡å®š hostid å°±é»˜è®¤ä¸ºå½“å‰ä¸»æœºæˆ–æœåŠ¡å™¨ã€‚

å…¶ä¸­ &#96;option&#96;ã€&#96;hostid&#96; å‚æ•°ä¹Ÿå¯ä»¥ä¸å†™ã€‚

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;jvm&#x2F;jvm-cli-tools.html#_1-2-jps-ä½¿ç”¨ç¤ºä¾‹)1.2. jps ä½¿ç”¨ç¤ºä¾‹

ã€ç¤ºä¾‹ã€‘åˆ—å‡ºæœ¬åœ° Java è¿›ç¨‹

&#96;&#96;&#96;shell
$ jps
18027 Java2Demo.JAR
18032 jps
18005 jstat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘åˆ—å‡ºæœ¬åœ° Java è¿›ç¨‹ ID</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jps -q
<span class="token number">8841</span>
<span class="token number">1292</span>
<span class="token number">5398</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘åˆ—å‡ºæœ¬åœ° Java è¿›ç¨‹ IDï¼Œå¹¶è¾“å‡ºä¸»ç±»çš„å…¨åï¼Œå¦‚æœè¿›ç¨‹æ‰§è¡Œçš„æ˜¯ jar åŒ…ï¼Œè¾“å‡º jar è·¯å¾„</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jps -l remote.domain
<span class="token number">3002</span> /opt/jdk1.7.0/demo/jfc/Java2D/Java2Demo.JAR
<span class="token number">2857</span> sun.tools.jstatd.jstatd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="-910"><a class="markdownIt-Anchor" href="#-910">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_2-jstat">#</a>2. jstat</h2>
<blockquote>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jstat.html">jstat(JVM statistics Monitoring) (opens new window)</a>ï¼Œæ˜¯è™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘è§†å·¥å…·</strong>ã€‚jstat ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JIT ç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</p>
</blockquote>
<h3 id="-911"><a class="markdownIt-Anchor" href="#-911">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_2-1-jstat-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">#</a>2.1. jstat å‘½ä»¤ç”¨æ³•</h3>
<p>å‘½ä»¤æ ¼å¼ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jstat <span class="token punctuation">[</span>option<span class="token punctuation">]</span> VMID <span class="token punctuation">[</span>interval<span class="token punctuation">]</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¸¸ç”¨å‚æ•°ï¼š</p>
<ul>
<li>
<pre><code>  option
  <pre class="line-numbers language-none"><code class="language-none">
	 

	\- é€‰é¡¹å‚æ•°ï¼Œç”¨äºæŒ‡å®šç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„è™šæ‹Ÿæœºä¿¡æ¯

	- &#96;-class&#96; - ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠç±»è£…è½½æ‰€è€—è´¹çš„æ—¶é—´
	- &#96;-compiler&#96;ï¼šæ˜¾ç¤º JIT ç¼–è¯‘çš„ç›¸å…³ä¿¡æ¯ï¼›
	- &#96;-gc&#96;ï¼šç›‘è§† Java å †çŠ¶å†µï¼ŒåŒ…æ‹¬ Eden åŒºã€ä¸¤ä¸ª survivor åŒºã€è€å¹´ä»£ã€æ°¸ä¹…ä»£ç­‰åŒºçš„å®¹é‡ã€å·²ç”¨ç©ºé—´ã€GC æ—¶é—´åˆè®¡ç­‰ä¿¡æ¯ã€‚
	- &#96;-gccapacity&#96;ï¼šæ˜¾ç¤ºå„ä¸ªä»£çš„å®¹é‡ä»¥åŠä½¿ç”¨æƒ…å†µï¼›
	- &#96;-gcmetacapacity&#96;ï¼šæ˜¾ç¤º Metaspace çš„å¤§å°ï¼›
	- &#96;-gcnew&#96;ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£ä¿¡æ¯ï¼›
	- &#96;-gcnewcapacity&#96;ï¼šæ˜¾ç¤ºæ–°ç”Ÿä»£å¤§å°å’Œä½¿ç”¨æƒ…å†µï¼›
	- &#96;-gcold&#96;ï¼šæ˜¾ç¤ºè€å¹´ä»£å’Œæ°¸ä¹…ä»£çš„ä¿¡æ¯ï¼›
	- &#96;-gcoldcapacity&#96;ï¼šæ˜¾ç¤ºè€å¹´ä»£çš„å¤§å°ï¼›
	- &#96;-gcutil&#96;ï¼šæ˜¾ç¤ºåƒåœ¾å›æ”¶ç»Ÿè®¡ä¿¡æ¯ï¼›
	- &#96;-gccause&#96;ï¼šæ˜¾ç¤ºåƒåœ¾å›æ”¶çš„ç›¸å…³ä¿¡æ¯ï¼ˆé€š -gcutilï¼‰ï¼ŒåŒæ—¶æ˜¾ç¤ºæœ€åä¸€æ¬¡æˆ–å½“å‰æ­£åœ¨å‘ç”Ÿçš„åƒåœ¾å›æ”¶çš„è¯±å› ï¼›
	- &#96;-printcompilation&#96;ï¼šè¾“å‡º JIT ç¼–è¯‘çš„æ–¹æ³•ä¿¡æ¯ã€‚

- &#96;VMID&#96; - å¦‚æœæ˜¯æœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œåˆ™ VMID ä¸ LVMID æ˜¯ä¸€è‡´çš„ï¼›å¦‚æœæ˜¯è¿œç¨‹è™šæ‹Ÿæœºè¿›ç¨‹ï¼Œé‚£ VMID çš„æ ¼å¼åº”å½“æ˜¯ï¼š&#96;[protocol:][&#x2F;&#x2F;]lvmid[@hostname[:port]&#x2F;servername]&#96;

- &#96;interval&#96; - æŸ¥è¯¢é—´éš”

- &#96;count&#96; - æŸ¥è¯¢æ¬¡æ•°

&gt; ã€å‚è€ƒã€‘æ›´è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒï¼š[jstat å‘½ä»¤æŸ¥çœ‹ jvm çš„ GC æƒ…å†µ(opens new window)](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;yjd_hycf_space&#x2F;p&#x2F;7755633.html)

### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;jvm&#x2F;jvm-cli-tools.html#_2-2-jstat-ä½¿ç”¨ç¤ºä¾‹)2.2. jstat ä½¿ç”¨ç¤ºä¾‹

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;jvm&#x2F;jvm-cli-tools.html#ç±»åŠ è½½ç»Ÿè®¡)ç±»åŠ è½½ç»Ÿè®¡

ä½¿ç”¨ &#96;jstat -class pid&#96; å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ã€‚

ã€å‚æ•°ã€‘

- Loaded - åŠ è½½ class çš„æ•°é‡
- Bytes - æ‰€å ç”¨ç©ºé—´å¤§å°
- Unloaded - æœªåŠ è½½æ•°é‡
- Bytes - æœªåŠ è½½å ç”¨ç©ºé—´
- Time - æ—¶é—´

ã€ç¤ºä¾‹ã€‘æŸ¥çœ‹ç±»åŠ è½½ä¿¡æ¯

&#96;&#96;&#96;shell
$ jstat -class 7129
Loaded  Bytes  Unloaded  Bytes     Time
 26749 50405.3      873  1216.8      19.75<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

</code></pre>
</li>
</ul>
<h4 id="-912"><a class="markdownIt-Anchor" href="#-912">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%BC%96%E8%AF%91%E7%BB%9F%E8%AE%A1">#</a>ç¼–è¯‘ç»Ÿè®¡</h4>
<p>ä½¿ç”¨  <code>jstat -compiler pid</code>  å‘½ä»¤å¯ä»¥æŸ¥çœ‹ç¼–è¯‘ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jstat -compiler <span class="token number">7129</span>
Compiled Failed Invalid   Time   FailedType FailedMethod
   <span class="token number">42030</span>      <span class="token number">2</span>       <span class="token number">0</span>   <span class="token number">302.53</span>          <span class="token number">1</span> org/apache/felix/framework/BundleWiringImpl<span class="token variable">$BundleClassLoader</span> findClass<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>ã€å‚æ•°ã€‘</p>
<ul>
<li>Compiled - ç¼–è¯‘æ•°é‡</li>
<li>Failed - å¤±è´¥æ•°é‡</li>
<li>Invalid - ä¸å¯ç”¨æ•°é‡</li>
<li>Time - æ—¶é—´</li>
<li>FailedType - å¤±è´¥ç±»å‹</li>
<li>FailedMethod - å¤±è´¥çš„æ–¹æ³•</li>
</ul>
<h4 id="-913"><a class="markdownIt-Anchor" href="#-913">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#gc-%E7%BB%9F%E8%AE%A1">#</a>GC ç»Ÿè®¡</h4>
<p>ä½¿ç”¨  <code>jstat -gc pid time</code>  å‘½ä»¤å¯ä»¥æŸ¥çœ‹ GC ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ä»¥ 250 æ¯«ç§’çš„é—´éš”è¿›è¡Œ 7 ä¸ªé‡‡æ ·ï¼Œå¹¶æ˜¾ç¤º - gcutil é€‰é¡¹æŒ‡å®šçš„è¾“å‡ºã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jstat -gcutil <span class="token number">21891</span> <span class="token number">250</span> <span class="token number">7</span>
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT
  <span class="token number">0.00</span>  <span class="token number">97.02</span>  <span class="token number">70.31</span>  <span class="token number">66.80</span>  <span class="token number">95.52</span>  <span class="token number">89.14</span>      <span class="token number">7</span>    <span class="token number">0.300</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.300</span>
  <span class="token number">0.00</span>  <span class="token number">97.02</span>  <span class="token number">86.23</span>  <span class="token number">66.80</span>  <span class="token number">95.52</span>  <span class="token number">89.14</span>      <span class="token number">7</span>    <span class="token number">0.300</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.300</span>
  <span class="token number">0.00</span>  <span class="token number">97.02</span>  <span class="token number">96.53</span>  <span class="token number">66.80</span>  <span class="token number">95.52</span>  <span class="token number">89.14</span>      <span class="token number">7</span>    <span class="token number">0.300</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.300</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>   <span class="token number">1.98</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>  <span class="token number">15.82</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>  <span class="token number">17.80</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span>
 <span class="token number">91.03</span>   <span class="token number">0.00</span>  <span class="token number">17.80</span>  <span class="token number">68.19</span>  <span class="token number">95.89</span>  <span class="token number">91.24</span>      <span class="token number">8</span>    <span class="token number">0.378</span>     <span class="token number">0</span>    <span class="token number">0.000</span>    <span class="token number">0.378</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ã€ç¤ºä¾‹ã€‘ä»¥ 1 ç§’çš„é—´éš”è¿›è¡Œ 4 ä¸ªé‡‡æ ·ï¼Œå¹¶æ˜¾ç¤º - gc é€‰é¡¹æŒ‡å®šçš„è¾“å‡ºã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jstat -gc <span class="token number">25196</span> 1s <span class="token number">4</span>
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span>
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span>
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span>
<span class="token number">20928.0</span> <span class="token number">20928.0</span>  <span class="token number">0.0</span>    <span class="token number">0.0</span>   <span class="token number">167936.0</span>  <span class="token number">8880.5</span>   <span class="token number">838912.0</span>   <span class="token number">80291.2</span>   <span class="token number">106668.0</span> <span class="token number">100032.1</span> <span class="token number">12772.0</span> <span class="token number">11602.2</span>    <span class="token number">760</span>   <span class="token number">14.332</span>  <span class="token number">580</span>   <span class="token number">656.218</span>  <span class="token number">670.550</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>S0C</code> ï¼šå¹´è½»ä»£ä¸­ To Survivor çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>S1C</code> ï¼šå¹´è½»ä»£ä¸­ From Survivor çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>S0U</code> ï¼šå¹´è½»ä»£ä¸­ To Survivor ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>S1U</code> ï¼šå¹´è½»ä»£ä¸­ From Survivor ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>EC</code> ï¼šå¹´è½»ä»£ä¸­ Eden çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>EU</code> ï¼šå¹´è½»ä»£ä¸­ Eden ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>OC</code> ï¼šOld ä»£çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>OU</code> ï¼šOld ä»£ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>MC</code> ï¼šMetaspace çš„å®¹é‡ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>MU</code> ï¼šMetaspace ç›®å‰å·²ä½¿ç”¨ç©ºé—´ï¼ˆå•ä½ KBï¼‰ï¼›</li>
<li><code>YGC</code> ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­ gc æ¬¡æ•°ï¼›</li>
<li><code>YGCT</code> ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶å¹´è½»ä»£ä¸­ gc æ‰€ç”¨æ—¶é—´ (s)ï¼›</li>
<li><code>FGC</code> ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ old ä»£ï¼ˆå…¨ gcï¼‰gc æ¬¡æ•°ï¼›</li>
<li><code>FGCT</code> ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ old ä»£ï¼ˆå…¨ gcï¼‰gc æ‰€ç”¨æ—¶é—´ (s)ï¼›</li>
<li><code>GCT</code> ï¼šä»åº”ç”¨ç¨‹åºå¯åŠ¨åˆ°é‡‡æ ·æ—¶ gc ç”¨çš„æ€»æ—¶é—´ (s)ã€‚</li>
</ul>
<blockquote>
<p>æ³¨ï¼šæ›´è¯¦ç»†çš„å‚æ•°å«ä¹‰å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html">http://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstat.html</a></p>
</blockquote>
<h2 id="-914"><a class="markdownIt-Anchor" href="#-914">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_3-jmap">#</a>3. jmap</h2>
<blockquote>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jmap.html">jmap(JVM Memory Map) (opens new window)</a> æ˜¯ Java å†…å­˜æ˜ åƒå·¥å…·</strong>ã€‚jmap ç”¨äºç”Ÿæˆå †è½¬å‚¨å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º heapdump æˆ– dump æ–‡ä»¶ï¼‰ã€‚jmap ä¸ä»…èƒ½ç”Ÿæˆ dump æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢  <code>finalize</code>  æ‰§è¡Œé˜Ÿåˆ—ã€Java å †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å½“å‰ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p>
<p>å¦‚æœä¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨  <code>-XX:+HeapDumpOnOutOfMemoryError</code>  å‚æ•°æ¥è®©è™šæ‹Ÿæœºå‡ºç° OOM çš„æ—¶å€™ï¼Œè‡ªåŠ¨ç”Ÿæˆ dump æ–‡ä»¶ã€‚</p>
</blockquote>
<h3 id="-915"><a class="markdownIt-Anchor" href="#-915">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_3-1-jmap-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">#</a>3.1. jmap å‘½ä»¤ç”¨æ³•</h3>
<p>å‘½ä»¤æ ¼å¼ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">jmap [option] pid<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>option</code>  é€‰é¡¹å‚æ•°ï¼š</p>
<ul>
<li><code>-dump</code>  - ç”Ÿæˆå †è½¬å‚¨å¿«ç…§ã€‚ <code>-dump:live</code>  åªä¿å­˜å †ä¸­çš„å­˜æ´»å¯¹è±¡ã€‚</li>
<li><code>-finalizerinfo</code>  - æ˜¾ç¤ºåœ¨ F-Queue é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œ  <code>finalizer</code>  æ–¹æ³•çš„å¯¹è±¡</li>
<li><code>-heap</code>  - æ˜¾ç¤º Java å †è¯¦ç»†ä¿¡æ¯ã€‚</li>
<li><code>-histo</code>  - æ˜¾ç¤ºå †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»ã€å®ä¾‹æ•°é‡ã€åˆè®¡å®¹é‡ã€‚ <code>-histo:live</code>  åªç»Ÿè®¡å †ä¸­çš„å­˜æ´»å¯¹è±¡ã€‚</li>
<li><code>-permstat</code>  - to print permanent generation statistics</li>
<li><code>-F</code>  - å½“ - dump æ²¡æœ‰å“åº”æ—¶ï¼Œå¼ºåˆ¶ç”Ÿæˆ dump å¿«ç…§</li>
</ul>
<h3 id="-916"><a class="markdownIt-Anchor" href="#-916">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_3-2-jstat-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">#</a>3.2. jstat ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 id="-917"><a class="markdownIt-Anchor" href="#-917">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%94%9F%E6%88%90-heapdump-%E5%BF%AB%E7%85%A7">#</a>ç”Ÿæˆ heapdump å¿«ç…§</h4>
<p>dump å †åˆ°æ–‡ä»¶ï¼Œformat æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼Œlive æŒ‡æ˜æ˜¯æ´»ç€çš„å¯¹è±¡ï¼Œfile æŒ‡å®šæ–‡ä»¶å</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jmap -dump:live,format<span class="token operator">=</span>b,file<span class="token operator">=</span>dump.hprof <span class="token number">28920</span>
Dumping heap to /home/xxx/dump.hprof <span class="token punctuation">..</span>.
Heap dump <span class="token function">file</span> created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>dump.hprof è¿™ä¸ªåç¼€æ˜¯ä¸ºäº†åç»­å¯ä»¥ç›´æ¥ç”¨ MAT (Memory Anlysis Tool) ç­‰å·¥å…·æ‰“å¼€ã€‚</p>
<h4 id="-918"><a class="markdownIt-Anchor" href="#-918">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E6%9F%A5%E7%9C%8B%E5%AE%9E%E4%BE%8B%E6%95%B0%E6%9C%80%E5%A4%9A%E7%9A%84%E7%B1%BB">#</a>æŸ¥çœ‹å®ä¾‹æ•°æœ€å¤šçš„ç±»</h4>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jmap -histo <span class="token number">29527</span> <span class="token operator">|</span> <span class="token function">head</span> -n <span class="token number">6</span>

 num     <span class="token comment">#instances         #bytes  class name</span>
----------------------------------------------
   <span class="token number">1</span>:      <span class="token number">13673280</span>     <span class="token number">1438961864</span>  <span class="token punctuation">[</span>C
   <span class="token number">2</span>:       <span class="token number">1207166</span>      <span class="token number">411277184</span>  <span class="token punctuation">[</span>I
   <span class="token number">3</span>:       <span class="token number">7382322</span>      <span class="token number">347307096</span>  <span class="token punctuation">[</span>Ljava.lang.Object<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-919"><a class="markdownIt-Anchor" href="#-919">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%A0%86%E4%BF%A1%E6%81%AF">#</a>æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„å †ä¿¡æ¯</h4>
<p>æ³¨æ„ï¼šä½¿ç”¨ CMS GC æƒ…å†µä¸‹ï¼Œ <code>jmap -heap PID</code>  çš„æ‰§è¡Œæœ‰å¯èƒ½ä¼šå¯¼è‡´ java è¿›ç¨‹æŒ‚èµ·ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jmap -heap <span class="token number">12379</span>
Attaching to process ID <span class="token number">12379</span>, please wait<span class="token punctuation">..</span>.
Debugger attached successfully.
Server compiler detected.
JVM version is <span class="token number">17.0</span>-b16

using thread-local object allocation.
Parallel GC with <span class="token number">6</span> thread<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

Heap Configuration:
   MinHeapFreeRatio <span class="token operator">=</span> <span class="token number">40</span>
   MaxHeapFreeRatio <span class="token operator">=</span> <span class="token number">70</span>
   MaxHeapSize      <span class="token operator">=</span> <span class="token number">83886080</span> <span class="token punctuation">(</span><span class="token number">80</span>.0MB<span class="token punctuation">)</span>
   NewSize          <span class="token operator">=</span> <span class="token number">1310720</span> <span class="token punctuation">(</span><span class="token number">1</span>.25MB<span class="token punctuation">)</span>
   MaxNewSize       <span class="token operator">=</span> <span class="token number">17592186044415</span> MB
   OldSize          <span class="token operator">=</span> <span class="token number">5439488</span> <span class="token punctuation">(</span><span class="token number">5</span>.1875MB<span class="token punctuation">)</span>
   NewRatio         <span class="token operator">=</span> <span class="token number">2</span>
   SurvivorRatio    <span class="token operator">=</span> <span class="token number">8</span>
   PermSize         <span class="token operator">=</span> <span class="token number">20971520</span> <span class="token punctuation">(</span><span class="token number">20</span>.0MB<span class="token punctuation">)</span>
   MaxPermSize      <span class="token operator">=</span> <span class="token number">88080384</span> <span class="token punctuation">(</span><span class="token number">84</span>.0MB<span class="token punctuation">)</span>

Heap Usage:
PS Young Generation
Eden Space:
   capacity <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">5375360</span> <span class="token punctuation">(</span><span class="token number">5</span>.1263427734375MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">3930752</span> <span class="token punctuation">(</span><span class="token number">3</span>.7486572265625MB<span class="token punctuation">)</span>
   <span class="token number">57.761608714788736</span>% used
From Space:
   capacity <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">3425240</span> <span class="token punctuation">(</span><span class="token number">3</span>.2665634155273438MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">5880872</span> <span class="token punctuation">(</span><span class="token number">5</span>.608436584472656MB<span class="token punctuation">)</span>
   <span class="token number">36.80634834397007</span>% used
To Space:
   capacity <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>.0MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">9306112</span> <span class="token punctuation">(</span><span class="token number">8</span>.875MB<span class="token punctuation">)</span>
   <span class="token number">0.0</span>% used
PS Old Generation
   capacity <span class="token operator">=</span> <span class="token number">55967744</span> <span class="token punctuation">(</span><span class="token number">53</span>.375MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">48354640</span> <span class="token punctuation">(</span><span class="token number">46</span>.11457824707031MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">7613104</span> <span class="token punctuation">(</span><span class="token number">7</span>.2604217529296875MB<span class="token punctuation">)</span>
   <span class="token number">86.39733629427693</span>% used
PS Perm Generation
   capacity <span class="token operator">=</span> <span class="token number">62062592</span> <span class="token punctuation">(</span><span class="token number">59</span>.1875MB<span class="token punctuation">)</span>
   used     <span class="token operator">=</span> <span class="token number">60243112</span> <span class="token punctuation">(</span><span class="token number">57</span>.452308654785156MB<span class="token punctuation">)</span>
   <span class="token function">free</span>     <span class="token operator">=</span> <span class="token number">1819480</span> <span class="token punctuation">(</span><span class="token number">1</span>.7351913452148438MB<span class="token punctuation">)</span>
   <span class="token number">97.06831451706046</span>% used<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-920"><a class="markdownIt-Anchor" href="#-920">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_4-jstack">#</a>4. jstack</h2>
<blockquote>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jstack.html">jstack(Stack Trace for java) (opens new window)</a> æ˜¯ Java å †æ ˆè·Ÿè¸ªå·¥å…·</strong>ã€‚jstack ç”¨æ¥æ‰“å°ç›®æ ‡ Java è¿›ç¨‹ä¸­å„ä¸ªçº¿ç¨‹çš„æ ˆè½¨è¿¹ï¼Œä»¥åŠè¿™äº›çº¿ç¨‹æ‰€æŒæœ‰çš„é”ï¼Œå¹¶å¯ä»¥ç”Ÿæˆ java è™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ï¼ˆä¸€èˆ¬ç§°ä¸º threaddump æˆ– javacore æ–‡ä»¶ï¼‰ã€‚</p>
<p><strong>çº¿ç¨‹å¿«ç…§æ˜¯å½“å‰è™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰</strong>ã€‚</p>
</blockquote>
<p><code>jstack</code>  é€šå¸¸ä¼šç»“åˆ  <code>top -Hp pid</code>  æˆ–  <code>pidstat -p pid -t</code>  ä¸€èµ·æŸ¥çœ‹å…·ä½“çº¿ç¨‹çš„çŠ¶æ€ï¼Œä¹Ÿç»å¸¸ç”¨æ¥æ’æŸ¥ä¸€äº›æ­»é”çš„å¼‚å¸¸ã€‚</p>
<p>çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡ jstack æ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚ å¦‚æœ java ç¨‹åºå´©æºƒç”Ÿæˆ core æ–‡ä»¶ï¼Œjstack å·¥å…·å¯ä»¥ç”¨æ¥è·å¾— core æ–‡ä»¶çš„ java stack å’Œ native stack çš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“ java ç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚å¦å¤–ï¼Œjstack å·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„ java ç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„ java ç¨‹åºçš„ java stack å’Œ native stack çš„ä¿¡æ¯ï¼Œå¦‚æœç°åœ¨è¿è¡Œçš„ java ç¨‹åºå‘ˆç° hung çš„çŠ¶æ€ï¼Œjstack æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<h3 id="-921"><a class="markdownIt-Anchor" href="#-921">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_4-1-jstack-%E5%91%BD%E4%BB%A4%E7%94%A8%E6%B3%95">#</a>4.1. jstack å‘½ä»¤ç”¨æ³•</h3>
<p>å‘½ä»¤æ ¼å¼ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jstack <span class="token punctuation">[</span>option<span class="token punctuation">]</span> pid<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>option</code>  é€‰é¡¹å‚æ•°</p>
<ul>
<li><code>-F</code>  - å½“æ­£å¸¸è¾“å‡ºè¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</li>
<li><code>-l</code>  - é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</li>
<li><code>-m</code>  - æ‰“å° java å’Œ jni æ¡†æ¶çš„æ‰€æœ‰æ ˆä¿¡æ¯</li>
</ul>
<h3 id="-922"><a class="markdownIt-Anchor" href="#-922">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_4-2-thread-dump-%E6%96%87%E4%BB%B6">#</a>4.2. thread dump æ–‡ä»¶</h3>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200730112431.png" alt="img"></p>
<p>ä¸€ä¸ª Thread Dump æ–‡ä»¶å¤§è‡´å¯ä»¥åˆ†ä¸ºäº”ä¸ªéƒ¨åˆ†ã€‚</p>
<h4 id="-923"><a class="markdownIt-Anchor" href="#-923">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86-full-thread-dump-identifier">#</a>ç¬¬ä¸€éƒ¨åˆ†ï¼šFull thread dump identifier</h4>
<p>è¿™ä¸€éƒ¨åˆ†æ˜¯å†…å®¹æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œå±•ç¤ºäº†å¿«ç…§æ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´å’Œ JVM çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">2017-10-19 10:46:44
Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.79-b02 mixed mode):<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h4 id="-924"><a class="markdownIt-Anchor" href="#-924">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86-java-ee-middleware-third-party-custom-application-threads">#</a>ç¬¬äºŒéƒ¨åˆ†ï¼šJava EE middleware, third party &amp; custom application Threads</h4>
<p>è¿™æ˜¯æ•´ä¸ªæ–‡ä»¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé‡Œé¢å±•ç¤ºäº† JavaEE å®¹å™¨ï¼ˆå¦‚ tomcatã€resin ç­‰ï¼‰ã€è‡ªå·±çš„ç¨‹åºä¸­æ‰€ä½¿ç”¨çš„çº¿ç¨‹ä¿¡æ¯ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"resin-22129" daemon prio=10 tid=0x00007fbe5c34e000 nid=0x4cb1 waiting on condition [0x00007fbe4ff7c000]
   java.lang.Thread.State: WAITING (parking)
    at sun.misc.Unsafe.park(Native Method)
    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:315)
    at com.caucho.env.thread2.ResinThread2.park(ResinThread2.java:196)
    at com.caucho.env.thread2.ResinThread2.runTasks(ResinThread2.java:147)
    at com.caucho.env.thread2.ResinThread2.run(ResinThread2.java:118)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>&quot;resin-22129&quot;</code>  ** çº¿ç¨‹åç§°ï¼š** å¦‚æœä½¿ç”¨ java.lang.Thread ç±»ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œçº¿ç¨‹åç§°ä¸º Thread-(æ•°å­—) çš„å½¢å¼ï¼Œè¿™é‡Œæ˜¯ resin ç”Ÿæˆçš„çº¿ç¨‹ï¼›</li>
<li><code>daemon</code>  ** çº¿ç¨‹ç±»å‹ï¼š** çº¿ç¨‹åˆ†ä¸ºå®ˆæŠ¤çº¿ç¨‹ (daemon) å’Œéå®ˆæŠ¤çº¿ç¨‹ (non-daemon) ä¸¤ç§ï¼Œé€šå¸¸éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼›</li>
<li><code>prio=10</code>  ** çº¿ç¨‹ä¼˜å…ˆçº§ï¼š** é»˜è®¤ä¸º 5ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›</li>
<li><code>tid=0x00007fbe5c34e000</code>  **JVM çº¿ç¨‹çš„ idï¼š**JVM å†…éƒ¨çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡ java.lang.Thread.getId () è·å–ï¼Œé€šå¸¸ç”¨è‡ªå¢çš„æ–¹å¼å®ç°ï¼›</li>
<li><code>nid=0x4cb1</code>  ** ç³»ç»Ÿçº¿ç¨‹ idï¼š** å¯¹åº”çš„ç³»ç»Ÿçº¿ç¨‹ idï¼ˆNative Thread ID)ï¼Œå¯ä»¥é€šè¿‡ top å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ï¼Œç°åœº id æ˜¯åå…­è¿›åˆ¶çš„å½¢å¼ï¼›</li>
<li><code>waiting on condition</code>  ** ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ï¼š** è¿™é‡Œæ˜¯ç³»ç»Ÿçš„çº¿ç¨‹çŠ¶æ€ï¼›</li>
<li><code>[0x00007fbe4ff7c000]</code>  ** èµ·å§‹æ ˆåœ°å€ï¼š** çº¿ç¨‹å †æ ˆè°ƒç”¨çš„å…¶å®å†…å­˜åœ°å€ï¼›</li>
<li><code>java.lang.Thread.State: WAITING (parking)</code>  **JVM çº¿ç¨‹çŠ¶æ€ï¼š** è¿™é‡Œæ ‡æ˜äº†çº¿ç¨‹åœ¨ä»£ç çº§åˆ«çš„çŠ¶æ€ã€‚</li>
<li>** çº¿ç¨‹è°ƒç”¨æ ˆä¿¡æ¯ï¼š** ä¸‹é¢å°±æ˜¯å½“å‰çº¿ç¨‹è°ƒç”¨çš„è¯¦ç»†æ ˆä¿¡æ¯ï¼Œç”¨äºä»£ç çš„åˆ†æã€‚å †æ ˆä¿¡æ¯åº”è¯¥ä»ä¸‹å‘ä¸Šè§£è¯»ï¼Œå› ä¸ºç¨‹åºè°ƒç”¨çš„é¡ºåºæ˜¯ä»ä¸‹å‘ä¸Šçš„ã€‚</li>
</ul>
<h4 id="-925"><a class="markdownIt-Anchor" href="#-925">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86-hotspot-vm-thread">#</a>ç¬¬ä¸‰éƒ¨åˆ†ï¼šHotSpot VM Thread</h4>
<p>è¿™ä¸€éƒ¨åˆ†å±•ç¤ºäº† JVM å†…éƒ¨çº¿ç¨‹çš„ä¿¡æ¯ï¼Œç”¨äºæ‰§è¡Œå†…éƒ¨çš„åŸç”Ÿæ“ä½œã€‚ä¸‹é¢å¸¸è§çš„é›†ä¸­å†…ç½®çº¿ç¨‹ï¼š</p>
<h5 id="-926"><a class="markdownIt-Anchor" href="#-926">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#attach-listener">#</a>â€œAttach Listenerâ€</h5>
<p>è¯¥çº¿ç¨‹è´Ÿè´£æ¥æ”¶å¤–éƒ¨å‘½ä»¤ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤å¹¶æŠŠç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼Œæ­¤ç§ç±»å‹çš„çº¿ç¨‹é€šå¸¸åœ¨æ¡Œé¢ç¨‹åºä¸­å‡ºç°ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Attach Listener" daemon prio=5 tid=0x00007fc6b6800800 nid=0x3b07 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="-927"><a class="markdownIt-Anchor" href="#-927">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#destroyjavavm">#</a>â€œDestroyJavaVMâ€</h5>
<p>æ‰§è¡Œ  <code>main()</code>  çš„çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä¹‹åè°ƒç”¨ JNI ä¸­çš„  <code>jni_DestroyJavaVM()</code>  æ–¹æ³•ä¼šå”¤èµ·  <code>DestroyJavaVM</code>  çº¿ç¨‹ï¼Œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹ï¼ˆjava çº¿ç¨‹å’Œ native çº¿ç¨‹ï¼‰é€€å‡ºæ—¶é€šçŸ¥å®ƒå¸è½½ JVMã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"DestroyJavaVM" prio=5 tid=0x00007fc6b3001000 nid=0x1903 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="-928"><a class="markdownIt-Anchor" href="#-928">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#service-thread">#</a>â€œService Threadâ€</h5>
<p>ç”¨äºå¯åŠ¨æœåŠ¡çš„çº¿ç¨‹</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Service Thread" daemon prio=10 tid=0x00007fbea81b3000 nid=0x5f2 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="-929"><a class="markdownIt-Anchor" href="#-929">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#compilerthread">#</a>â€œCompilerThreadâ€</h5>
<p>ç”¨æ¥è°ƒç”¨ JITingï¼Œå®æ—¶ç¼–è¯‘è£…å¸ç±»ã€‚é€šå¸¸ JVM ä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™éƒ¨åˆ†å·¥ä½œï¼Œçº¿ç¨‹åç§°åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ï¼Œæ¯”å¦‚ CompilerThread1ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"C2 CompilerThread1" daemon prio=10 tid=0x00007fbea814b000 nid=0x5f1 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

"C2 CompilerThread0" daemon prio=10 tid=0x00007fbea8142000 nid=0x5f0 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="-930"><a class="markdownIt-Anchor" href="#-930">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#signal-dispatcher">#</a>â€œSignal Dispatcherâ€</h5>
<p>Attach Listener çº¿ç¨‹çš„èŒè´£æ˜¯æ¥æ”¶å¤–éƒ¨ jvm å‘½ä»¤ï¼Œå½“å‘½ä»¤æ¥æ”¶æˆåŠŸåï¼Œä¼šäº¤ç»™ signal dispather çº¿ç¨‹å»è¿›è¡Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„æ¨¡å—å¤„ç†å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›å¤„ç†ç»“æœã€‚ signal dispather çº¿ç¨‹ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶å¤–éƒ¨ jvm å‘½ä»¤æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Signal Dispatcher" daemon prio=10 tid=0x00007fbea81bf800 nid=0x5ef runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h5 id="-931"><a class="markdownIt-Anchor" href="#-931">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#finalizer">#</a>â€œFinalizerâ€</h5>
<p>è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ˜¯åœ¨ main çº¿ç¨‹ä¹‹ååˆ›å»ºçš„ï¼Œå…¶ä¼˜å…ˆçº§ä¸º 10ï¼Œä¸»è¦ç”¨äºåœ¨åƒåœ¾æ”¶é›†å‰ï¼Œè°ƒç”¨å¯¹è±¡çš„  <code>finalize()</code>  æ–¹æ³•ï¼›å…³äº Finalizer çº¿ç¨‹çš„å‡ ç‚¹ï¼š</p>
<ul>
<li>åªæœ‰å½“å¼€å§‹ä¸€è½®åƒåœ¾æ”¶é›†æ—¶ï¼Œæ‰ä¼šå¼€å§‹è°ƒç”¨ finalize () æ–¹æ³•ï¼›å› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡çš„ finalize () æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼›</li>
<li>è¯¥çº¿ç¨‹ä¹Ÿæ˜¯ daemon çº¿ç¨‹ï¼Œå› æ­¤å¦‚æœè™šæ‹Ÿæœºä¸­æ²¡æœ‰å…¶ä»–é daemon çº¿ç¨‹ï¼Œä¸ç®¡è¯¥çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œ finalize () æ–¹æ³•ï¼ŒJVM ä¹Ÿä¼šé€€å‡ºï¼›</li>
<li>JVM åœ¨åƒåœ¾æ”¶é›†æ—¶ä¼šå°†å¤±å»å¼•ç”¨çš„å¯¹è±¡åŒ…è£…æˆ Finalizer å¯¹è±¡ï¼ˆReference çš„å®ç°ï¼‰ï¼Œå¹¶æ”¾å…¥ ReferenceQueueï¼Œç”± Finalizer çº¿ç¨‹æ¥å¤„ç†ï¼›æœ€åå°†è¯¥ Finalizer å¯¹è±¡çš„å¼•ç”¨ç½®ä¸º nullï¼Œç”±åƒåœ¾æ”¶é›†å™¨æ¥å›æ”¶ï¼›</li>
</ul>
<p>JVM ä¸ºä»€ä¹ˆè¦å•ç‹¬ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œ  <code>finalize()</code>  æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>å¦‚æœ JVM çš„åƒåœ¾æ”¶é›†çº¿ç¨‹è‡ªå·±æ¥åšï¼Œå¾ˆæœ‰å¯èƒ½ç”±äºåœ¨ finalize () æ–¹æ³•ä¸­è¯¯æ“ä½œå¯¼è‡´ GC çº¿ç¨‹åœæ­¢æˆ–ä¸å¯æ§ï¼Œè¿™å¯¹ GC çº¿ç¨‹æ¥è¯´æ˜¯ä¸€ç§ç¾éš¾ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Finalizer" daemon prio=10 tid=0x00007fbea80da000 nid=0x5eb in Object.wait() [0x00007fbeac044000]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)
    - locked &lt;0x00000006d173c1a8> (a java.lang.ref.ReferenceQueue$Lock)
    at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)
    at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="-932"><a class="markdownIt-Anchor" href="#-932">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#reference-handler">#</a>â€œReference Handlerâ€</h5>
<p>JVM åœ¨åˆ›å»º main çº¿ç¨‹åå°±åˆ›å»º Reference Handler çº¿ç¨‹ï¼Œå…¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º 10ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„åƒåœ¾å›æ”¶é—®é¢˜ ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Reference Handler" daemon prio=10 tid=0x00007fbea80d8000 nid=0x5ea in Object.wait() [0x00007fbeac085000]
   java.lang.Thread.State: WAITING (on object monitor)
    at java.lang.Object.wait(Native Method)
    at java.lang.Object.wait(Object.java:503)
    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
    - locked &lt;0x00000006d173c1f0> (a java.lang.ref.Reference$Lock)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="-933"><a class="markdownIt-Anchor" href="#-933">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#vm-thread">#</a>â€œVM Threadâ€</h5>
<p>JVM ä¸­çº¿ç¨‹çš„æ¯ä½“ï¼Œæ ¹æ® HotSpot æºç ä¸­å…³äº vmThread.hpp é‡Œé¢çš„æ³¨é‡Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä¾‹çš„å¯¹è±¡ï¼ˆæœ€åŸå§‹çš„çº¿ç¨‹ï¼‰ä¼šäº§ç”Ÿæˆ–è§¦å‘æ‰€æœ‰å…¶ä»–çš„çº¿ç¨‹ï¼Œè¿™ä¸ªå•ä¾‹çš„ VM çº¿ç¨‹æ˜¯ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€ä½¿ç”¨æ¥åšä¸€äº› VM æ“ä½œï¼ˆå¦‚æ¸…æ‰«åƒåœ¾ç­‰ï¼‰ã€‚ åœ¨ VM Thread çš„ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ª VMOperationQueue åˆ—é˜Ÿï¼Œæ‰€æœ‰çš„ VM çº¿ç¨‹æ“ä½œ (vm_operation) éƒ½ä¼šè¢«ä¿å­˜åˆ°è¿™ä¸ªåˆ—é˜Ÿå½“ä¸­ï¼ŒVMThread æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹è´Ÿè´£æ‰§è¡Œä¸€ä¸ªè‡ªè½®è¯¢çš„ loop å‡½æ•° (å…·ä½“å¯ä»¥å‚è€ƒï¼šVMThread.cpp é‡Œé¢çš„ void VMThread::loop ()) ï¼Œè¯¥ loop å‡½æ•°ä» VMOperationQueue åˆ—é˜Ÿä¸­æŒ‰ç…§ä¼˜å…ˆçº§å–å‡ºå½“å‰éœ€è¦æ‰§è¡Œçš„æ“ä½œå¯¹è±¡ (VM_Operation)ï¼Œå¹¶ä¸”è°ƒç”¨ VM_Operation-&gt;evaluate å‡½æ•°å»æ‰§è¡Œè¯¥æ“ä½œç±»å‹æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘ã€‚ VM æ“ä½œç±»å‹è¢«å®šä¹‰åœ¨ vm_operations.hpp æ–‡ä»¶å†…ï¼Œåˆ—ä¸¾å‡ ä¸ªï¼šThreadStopã€ThreadDumpã€PrintThreadsã€GenCollectFullã€GenCollectFullConcurrentã€CMS_Initial_Markã€CMS_Final_Remarkâ€¦â€¦ æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥è‡ªå·±å»æŸ¥çœ‹æºæ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"VM Thread" prio=10 tid=0x00007fbea80d3800 nid=0x5e9 runnable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="-934"><a class="markdownIt-Anchor" href="#-934">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86-hotspot-gc-thread">#</a>ç¬¬å››éƒ¨åˆ†ï¼šHotSpot GC Thread</h4>
<p>JVM ä¸­ç”¨äºè¿›è¡Œèµ„æºå›æ”¶çš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»å‹çš„çº¿ç¨‹ï¼š</p>
<h5 id="-935"><a class="markdownIt-Anchor" href="#-935">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#vm-periodic-task-thread">#</a>â€œVM Periodic Task Threadâ€</h5>
<p>è¯¥çº¿ç¨‹æ˜¯ JVM å‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„çº¿ç¨‹ï¼Œå®ƒç”± WatcherThread åˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ã€‚è¯¥çº¿ç¨‹åœ¨ JVM å†…ä½¿ç”¨å¾—æ¯”è¾ƒé¢‘ç¹ï¼Œæ¯”å¦‚ï¼šå®šæœŸçš„å†…å­˜ç›‘æ§ã€JVM è¿è¡ŒçŠ¶å†µç›‘æ§ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"VM Periodic Task Thread" prio=10 tid=0x00007fbea82ae800 nid=0x5fa waiting on condition<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¯ä»¥ä½¿ç”¨ jstat å‘½ä»¤æŸ¥çœ‹ GC çš„æƒ…å†µï¼Œæ¯”å¦‚æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨å¯ä»¥ä½¿ç”¨å‘½ä»¤  <code>jstat -gcutil 250 7</code>  å‚æ•°ä¸­ pid æ˜¯è¿›ç¨‹ idï¼Œåé¢çš„ 250 å’Œ 7 è¡¨ç¤ºæ¯ 250 æ¯«ç§’æ‰“å°ä¸€æ¬¡ï¼Œæ€»å…±æ‰“å° 7 æ¬¡ã€‚ è¿™å¯¹äºé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ native åº“æˆ–è€…ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚</p>
<h5 id="-936"><a class="markdownIt-Anchor" href="#-936">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#gc-task-thread-0-parallelgc">#</a>â€œGC task thread#0 (ParallelGC)â€</h5>
<p>åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šè´Ÿè´£è¿›è¡Œåƒåœ¾å›æ”¶ã€‚é€šå¸¸ JVM ä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªå·¥ä½œï¼Œçº¿ç¨‹åç§°ä¸­ #åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"GC task thread#0 (ParallelGC)" prio=5 tid=0x00007fc6b480d000 nid=0x2503 runnable

"GC task thread#1 (ParallelGC)" prio=5 tid=0x00007fc6b2812000 nid=0x2703 runnable

"GC task thread#2 (ParallelGC)" prio=5 tid=0x00007fc6b2812800 nid=0x2903 runnable

"GC task thread#3 (ParallelGC)" prio=5 tid=0x00007fc6b2813000 nid=0x2b03 runnable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å¦‚æœåœ¨ JVM ä¸­å¢åŠ äº†  <code>-XX:+UseConcMarkSweepGC</code>  å‚æ•°å°†ä¼šå¯ç”¨ CMS ï¼ˆConcurrent Mark-Sweepï¼‰GC Thread æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯è¯¥æ¨¡å¼ä¸‹çš„çº¿ç¨‹ç±»å‹ï¼š</p>
<h5 id="-937"><a class="markdownIt-Anchor" href="#-937">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#gang-worker-0-parallel-gc-threads">#</a>â€œGang worker#0 (Parallel GC Threads)â€</h5>
<p>åŸæ¥åƒåœ¾å›æ”¶çº¿ç¨‹ GC task thread#0 (ParallelGC) è¢«æ›¿æ¢ä¸º Gang worker#0 (Parallel GC Threads)ã€‚Gang worker æ˜¯ JVM ç”¨äºå¹´è½»ä»£åƒåœ¾å›æ”¶ (minor gc) çš„çº¿ç¨‹ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Gang worker#0 (Parallel GC Threads)" prio=10 tid=0x00007fbea801b800 nid=0x5e4 runnable

"Gang worker#1 (Parallel GC Threads)" prio=10 tid=0x00007fbea801d800 nid=0x5e7 runnable<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h5 id="-938"><a class="markdownIt-Anchor" href="#-938">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#concurrent-mark-sweep-gc-thread">#</a>â€œConcurrent Mark-Sweep GC Threadâ€</h5>
<p>å¹¶å‘æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨ï¼ˆå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ CMS GCï¼‰çº¿ç¨‹ï¼Œ è¯¥çº¿ç¨‹ä¸»è¦é’ˆå¯¹äºå¹´è€ä»£åƒåœ¾å›æ”¶ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Concurrent Mark-Sweep GC Thread" prio=10 tid=0x00007fbea8073800 nid=0x5e8 runnable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h5 id="-939"><a class="markdownIt-Anchor" href="#-939">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#surrogate-locker-thread-concurrent-gc">#</a>â€œSurrogate Locker Thread (Concurrent GC)â€</h5>
<p>æ­¤çº¿ç¨‹ä¸»è¦é…åˆ CMS åƒåœ¾å›æ”¶å™¨æ¥ä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å¤„ç† GC è¿‡ç¨‹ä¸­ Java å±‚çš„ Referenceï¼ˆæŒ‡è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ç­‰ç­‰ï¼‰ä¸ jvm å†…éƒ¨å±‚é¢çš„å¯¹è±¡çŠ¶æ€åŒæ­¥ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"Surrogate Locker Thread (Concurrent GC)" daemon prio=10 tid=0x00007fbea8158800 nid=0x5ee waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿™é‡Œä»¥ WeakHashMap ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼š</p>
<ul>
<li>WeakHashMap å’Œ HashMap ä¸€æ ·ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ª Entry [] æ•°ç»„ï¼›</li>
<li>WeakHashMap çš„ Entry æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ç»§æ‰¿ä½“ç³»ç»“æ„ä¸º Entry-&gt;WeakReference-&gt;Reference;</li>
<li>Reference é‡Œé¢æœ‰ä¸€ä¸ªå…¨å±€é”å¯¹è±¡ï¼šLockï¼Œå®ƒä¹Ÿè¢«ç§°ä¸º pending_lockï¼Œæ³¨æ„ï¼šå®ƒæ˜¯é™æ€å¯¹è±¡ï¼›</li>
<li>Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å˜é‡ï¼špendingï¼›</li>
<li>Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼šReferenceHandler çš„çº¿ç¨‹ï¼Œå®ƒåœ¨ static å—é‡Œé¢è¢«åˆå§‹åŒ–å¹¶ä¸”å¯åŠ¨ï¼Œå¯åŠ¨å®Œæˆåå¤„äº wait çŠ¶æ€ï¼Œå®ƒåœ¨ä¸€ä¸ª Lock åŒæ­¥é”æ¨¡å—ä¸­ç­‰å¾…ï¼›</li>
<li>WeakHashMap é‡Œé¢è¿˜å®ä¾‹åŒ–äº†ä¸€ä¸ª ReferenceQueue åˆ—é˜Ÿ</li>
</ul>
<p>å‡è®¾ï¼ŒWeakHashMap å¯¹è±¡é‡Œé¢å·²ç»ä¿å­˜äº†å¾ˆå¤šå¯¹è±¡çš„å¼•ç”¨ï¼ŒJVM åœ¨è¿›è¡Œ CMS GC çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ª ConcurrentMarkSweepThreadï¼ˆç®€ç§° CMSTï¼‰çº¿ç¨‹å»è¿›è¡Œ GCã€‚ConcurrentMarkSweepThread çº¿ç¨‹è¢«åˆ›å»ºçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ª SurrogateLockerThreadï¼ˆç®€ç§° SLTï¼‰çº¿ç¨‹å¹¶ä¸”å¯åŠ¨å®ƒï¼ŒSLT å¯åŠ¨ä¹‹åï¼Œå¤„äºç­‰å¾…é˜¶æ®µã€‚ CMST å¼€å§‹ GC æ—¶ï¼Œä¼šå‘ä¸€ä¸ªæ¶ˆæ¯ç»™ SLT è®©å®ƒå»è·å– Java å±‚ Reference å¯¹è±¡çš„å…¨å±€é”ï¼šLockã€‚ç›´åˆ° CMS GC å®Œæ¯•ä¹‹åï¼ŒJVM ä¼šå°† WeakHashMap ä¸­æ‰€æœ‰è¢«å›æ”¶çš„å¯¹è±¡æ‰€å±çš„ WeakReference å®¹å™¨å¯¹è±¡æ”¾å…¥åˆ° Reference çš„ pending å±æ€§å½“ä¸­ï¼ˆæ¯æ¬¡ GC å®Œæ¯•ä¹‹åï¼Œpending å±æ€§åŸºæœ¬ä¸Šéƒ½ä¸ä¼šä¸º null äº†ï¼‰ï¼Œç„¶åé€šçŸ¥ SLT é‡Šæ”¾å¹¶ä¸” notify å…¨å±€é”ï¼šLockã€‚æ­¤æ—¶æ¿€æ´»äº† ReferenceHandler çº¿ç¨‹çš„ run æ–¹æ³•ï¼Œä½¿å…¶è„±ç¦» wait çŠ¶æ€ï¼Œå¼€å§‹å·¥ä½œäº†ã€‚ ReferenceHandler è¿™ä¸ªçº¿ç¨‹ä¼šå°† pending ä¸­çš„æ‰€æœ‰ WeakReference å¯¹è±¡éƒ½ç§»åŠ¨åˆ°å®ƒä»¬å„è‡ªçš„åˆ—é˜Ÿå½“ä¸­ï¼Œæ¯”å¦‚å½“å‰è¿™ä¸ª WeakReference å±äºæŸä¸ª WeakHashMap å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ”¾å…¥ç›¸åº”çš„ ReferenceQueue åˆ—é˜Ÿé‡Œé¢ï¼ˆè¯¥åˆ—é˜Ÿæ˜¯é“¾è¡¨ç»“æ„ï¼‰ã€‚ å½“æˆ‘ä»¬ä¸‹æ¬¡ä» WeakHashMap å¯¹è±¡é‡Œé¢ getã€put æ•°æ®æˆ–è€…è°ƒç”¨ size æ–¹æ³•çš„æ—¶å€™ï¼ŒWeakHashMap å°±ä¼šå°† ReferenceQueue åˆ—é˜Ÿä¸­çš„ WeakReference ä¾ä¾ poll å‡ºæ¥å»å’Œ Entry [] æ•°æ®åšæ¯”è¾ƒï¼Œå¦‚æœå‘ç°ç›¸åŒçš„ï¼Œåˆ™è¯´æ˜è¿™ä¸ª Entry æ‰€ä¿å­˜çš„å¯¹è±¡å·²ç»è¢« GC æ‰äº†ï¼Œé‚£ä¹ˆå°† Entry [] å†…çš„ Entry å¯¹è±¡å‰”é™¤æ‰ã€‚</p>
<h4 id="-940"><a class="markdownIt-Anchor" href="#-940">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86-jni-global-references-count">#</a>ç¬¬äº”éƒ¨åˆ†ï¼šJNI global references count</h4>
<p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦å›æ”¶é‚£äº›åœ¨ native ä»£ç ä¸Šè¢«å¼•ç”¨ï¼Œä½†åœ¨ java ä»£ç ä¸­å´æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨ï¼Œå¯¹äºé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ native åº“æˆ–ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">JNI global references: 830<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« å°†è¦è®²è¿°ä¸€ä¸ªç›´æ¥æ‰¾å‡º CPU 100% çº¿ç¨‹çš„ä¾‹å­ã€‚</p>
<h3 id="-941"><a class="markdownIt-Anchor" href="#-941">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_4-3-%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81">#</a>4.3. ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€</h3>
<p>ç³»ç»Ÿçº¿ç¨‹æœ‰å¦‚ä¸‹çŠ¶æ€ï¼š</p>
<h4 id="-942"><a class="markdownIt-Anchor" href="#-942">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#deadlock">#</a>deadlock</h4>
<p>æ­»é”çº¿ç¨‹ï¼Œä¸€èˆ¬æŒ‡å¤šä¸ªçº¿ç¨‹è°ƒç”¨æœŸé—´è¿›å…¥äº†ç›¸äº’èµ„æºå ç”¨ï¼Œå¯¼è‡´ä¸€ç›´ç­‰å¾…æ— æ³•é‡Šæ”¾çš„æƒ…å†µã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘deadlock ç¤ºä¾‹</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"DEADLOCK_TEST-1" daemon prio=6 tid=0x000000000690f800 nid=0x1820 waiting for monitor entry [0x000000000805f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)
                - waiting to lock &lt;0x00000007d58f5e60> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)
                - locked &lt;0x00000007d58f5e48> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)

   Locked ownable synchronizers:
                - None

"DEADLOCK_TEST-2" daemon prio=6 tid=0x0000000006858800 nid=0x17b8 waiting for monitor entry [0x000000000815f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)
                - waiting to lock &lt;0x00000007d58f5e78> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)
                - locked &lt;0x00000007d58f5e60> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)

   Locked ownable synchronizers:
                - None

"DEADLOCK_TEST-3" daemon prio=6 tid=0x0000000006859000 nid=0x25dc waiting for monitor entry [0x000000000825f000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.goMonitorDeadlock(ThreadDeadLockState.java:197)
                - waiting to lock &lt;0x00000007d58f5e48> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.monitorOurLock(ThreadDeadLockState.java:182)
                - locked &lt;0x00000007d58f5e78> (a com.nbp.theplatform.threaddump.ThreadDeadLockState$Monitor)
                at com.nbp.theplatform.threaddump.ThreadDeadLockState$DeadlockThread.run(ThreadDeadLockState.java:135)

   Locked ownable synchronizers:
                - None<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-943"><a class="markdownIt-Anchor" href="#-943">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#runnable">#</a>runnable</h4>
<p>ä¸€èˆ¬æŒ‡è¯¥çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒçŠ¶æ€ä¸­ï¼Œè¯¥çº¿ç¨‹å ç”¨äº†èµ„æºï¼Œæ­£åœ¨å¤„ç†æŸä¸ªæ“ä½œï¼Œå¦‚é€šè¿‡ SQL è¯­å¥æŸ¥è¯¢æ•°æ®åº“ã€å¯¹æŸä¸ªæ–‡ä»¶è¿›è¡Œå†™å…¥ç­‰ã€‚</p>
<h4 id="-944"><a class="markdownIt-Anchor" href="#-944">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#blocked">#</a>blocked</h4>
<p>çº¿ç¨‹æ­£å¤„äºé˜»å¡çŠ¶æ€ï¼ŒæŒ‡å½“å‰çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€éœ€è¦çš„èµ„æºé•¿æ—¶é—´ç­‰å¾…å´ä¸€ç›´æœªèƒ½è·å–åˆ°ï¼Œè¢«å®¹å™¨çš„çº¿ç¨‹ç®¡ç†å™¨æ ‡è¯†ä¸ºé˜»å¡çŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºç­‰å¾…èµ„æºè¶…æ—¶çš„çº¿ç¨‹ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘blocked ç¤ºä¾‹</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"BLOCKED_TEST pool-1-thread-2" prio=6 tid=0x0000000007673800 nid=0x260c waiting for monitor entry [0x0000000008abf000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadBlockedState.monitorLock(ThreadBlockedState.java:43)
                - waiting to lock &lt;0x0000000780a000b0> (a com.nbp.theplatform.threaddump.ThreadBlockedState)
                at com.nbp.theplatform.threaddump.ThreadBlockedState$2.run(ThreadBlockedState.java:26)
                at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
                at java.lang.Thread.run(Thread.java:662)
   Locked ownable synchronizers:
                - &lt;0x0000000780b0c6a0> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
"BLOCKED_TEST pool-1-thread-3" prio=6 tid=0x00000000074f5800 nid=0x1994 waiting for monitor entry [0x0000000008bbf000]
   java.lang.Thread.State: BLOCKED (on object monitor)
                at com.nbp.theplatform.threaddump.ThreadBlockedState.monitorLock(ThreadBlockedState.java:42)
                - waiting to lock &lt;0x0000000780a000b0> (a com.nbp.theplatform.threaddump.ThreadBlockedState)
                at com.nbp.theplatform.threaddump.ThreadBlockedState$3.run(ThreadBlockedState.java:34)
                at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886
                at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
                at java.lang.Thread.run(Thread.java:662)
   Locked ownable synchronizers:
                - &lt;0x0000000780b0e1b8> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-945"><a class="markdownIt-Anchor" href="#-945">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#waiting-on-condition">#</a>waiting on condition</h4>
<p>çº¿ç¨‹æ­£å¤„äºç­‰å¾…èµ„æºæˆ–ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼Œå…·ä½“çš„åŸå› éœ€è¦ç»“åˆä¸‹é¢å †æ ˆä¿¡æ¯è¿›è¡Œåˆ†æã€‚</p>
<p>ï¼ˆ1ï¼‰å¦‚æœå †æ ˆä¿¡æ¯æ˜ç¡®æ˜¯åº”ç”¨ä»£ç ï¼Œåˆ™è¯æ˜è¯¥çº¿ç¨‹æ­£åœ¨ç­‰å¾…èµ„æºï¼Œä¸€èˆ¬æ˜¯å¤§é‡è¯»å–æŸç§èµ„æºä¸”è¯¥èµ„æºé‡‡ç”¨äº†èµ„æºé”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…èµ„æºçš„è¯»å–ï¼Œæˆ–è€…æ­£åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œç­‰ã€‚</p>
<p>ï¼ˆ2ï¼‰å¦‚æœå‘ç°æœ‰å¤§é‡çš„çº¿ç¨‹éƒ½æ­£å¤„äºè¿™ç§çŠ¶æ€ï¼Œå¹¶ä¸”å †æ ˆä¿¡æ¯ä¸­å¾—çŸ¥æ­£ç­‰å¾…ç½‘ç»œè¯»å†™ï¼Œè¿™æ˜¯å› ä¸ºç½‘ç»œé˜»å¡å¯¼è‡´çº¿ç¨‹æ— æ³•æ‰§è¡Œï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªç½‘ç»œç“¶é¢ˆçš„å¾å…†ï¼š</p>
<ul>
<li>ç½‘ç»œéå¸¸ç¹å¿™ï¼Œå‡ ä¹æ¶ˆè€—äº†æ‰€æœ‰çš„å¸¦å®½ï¼Œä»ç„¶æœ‰å¤§é‡æ•°æ®ç­‰å¾…ç½‘ç»œè¯»å†™ï¼›</li>
<li>ç½‘ç»œå¯èƒ½æ˜¯ç©ºé—²çš„ï¼Œä½†ç”±äºè·¯ç”±æˆ–é˜²ç«å¢™ç­‰åŸå› ï¼Œå¯¼è‡´åŒ…æ— æ³•æ­£å¸¸åˆ°è¾¾ï¼›</li>
</ul>
<p>æ‰€ä»¥ä¸€å®šè¦ç»“åˆç³»ç»Ÿçš„ä¸€äº›æ€§èƒ½è§‚å¯Ÿå·¥å…·è¿›è¡Œç»¼åˆåˆ†æï¼Œæ¯”å¦‚ netstat ç»Ÿè®¡å•ä½æ—¶é—´çš„å‘é€åŒ…çš„æ•°é‡ï¼Œçœ‹æ˜¯å¦å¾ˆæ˜æ˜¾è¶…è¿‡äº†æ‰€åœ¨ç½‘ç»œå¸¦å®½çš„é™åˆ¶ï¼›è§‚å¯Ÿ CPU çš„åˆ©ç”¨ç‡ï¼Œçœ‹ç³»ç»Ÿæ€çš„ CPU æ—¶é—´æ˜¯å¦æ˜æ˜¾å¤§äºç”¨æˆ·æ€çš„ CPU æ—¶é—´ã€‚è¿™äº›éƒ½æŒ‡å‘ç”±äºç½‘ç»œå¸¦å®½æ‰€é™å¯¼è‡´çš„ç½‘ç»œç“¶é¢ˆã€‚</p>
<p>ï¼ˆ3ï¼‰è¿˜æœ‰ä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯è¯¥çº¿ç¨‹åœ¨ sleepï¼Œç­‰å¾… sleep çš„æ—¶é—´åˆ°äº†ï¼Œå°†è¢«å”¤é†’ã€‚</p>
<p>ã€ç¤ºä¾‹ã€‘ç­‰å¾…çŠ¶æ€æ ·ä¾‹</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">"IoWaitThread" prio=6 tid=0x0000000007334800 nid=0x2b3c waiting on condition [0x000000000893f000]
  java.lang.Thread.State: WAITING (parking)
               at sun.misc.Unsafe.park(Native Method)
               - parking to wait for  &lt;0x00000007d5c45850> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
               at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)
               at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1987)
               at java.util.concurrent.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:440)
               at java.util.concurrent.LinkedBlockingDeque.take(LinkedBlockingDeque.java:629)
               at com.nbp.theplatform.threaddump.ThreadIoWaitState$IoWaitHandler2.run(ThreadIoWaitState.java:89)
               at java.lang.Thread.run(Thread.java:662)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="-946"><a class="markdownIt-Anchor" href="#-946">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#waiting-for-monitor-entry-%E6%88%96-in-object-wait">#</a>waiting for monitor entry æˆ– in Object.wait ()</h4>
<p>Moniter æ˜¯ Java ä¸­ç”¨ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„äº’æ–¥ä¸åä½œçš„ä¸»è¦æ‰‹æ®µï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯å¯¹è±¡æˆ–è€… class çš„é”ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ï¼Œä¹Ÿä»…æœ‰ä¸€ä¸ª Monitorã€‚</p>
<p><img src="https://www.javatang.com/wp-content/uploads/2017/10/java-monitor.png" alt="img"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ª Monitor åœ¨æŸä¸ªæ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ â€œActive Threadâ€ï¼Œè€Œå…¶ä»–çº¿ç¨‹éƒ½æ˜¯ â€œWaiting Threadâ€ï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªé˜Ÿåˆ— &quot;Entry Set&quot; å’Œ &quot;Waint Set&quot; é‡Œé¢ç­‰å¾…ã€‚å…¶ä¸­åœ¨ â€œEntry Setâ€ ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯  <code>waiting for monitor entry</code> ï¼Œåœ¨ â€œWait Setâ€ ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯  <code>in Object.wait()</code> ã€‚</p>
<p>ï¼ˆ1ï¼‰&quot;Entry Set&quot; é‡Œé¢çš„çº¿ç¨‹ã€‚</p>
<p>æˆ‘ä»¬ç§°è¢«  <code>synchronized</code>  ä¿æŠ¤èµ·æ¥çš„ä»£ç æ®µä¸ºä¸´ç•ŒåŒºï¼Œå¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">synchronized</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å½“ä¸€ä¸ªçº¿ç¨‹ç”³è¯·è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒå°±è¿›å…¥äº† â€œEntry Setâ€ é˜Ÿåˆ—ä¸­ï¼Œè¿™æ—¶å€™æœ‰ä¸¤ç§å¯èƒ½æ€§ï¼š</p>
<ul>
<li>è¯¥ Monitor ä¸è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œ&quot;Entry Set&quot; é‡Œé¢ä¹Ÿæ²¡æœ‰å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹ã€‚æœ¬çº¿ç¨‹å³æˆä¸ºç›¸åº”ç±»æˆ–è€…å¯¹è±¡çš„ Monitor çš„ Ownerï¼Œæ‰§è¡Œä¸´ç•ŒåŒºé‡Œé¢çš„ä»£ç ï¼›æ­¤æ—¶åœ¨ Thread Dump ä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äº â€œRunnableâ€ çŠ¶æ€ã€‚</li>
<li>è¯¥ Monitor è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œæœ¬çº¿ç¨‹åœ¨ â€œEntry Setâ€ é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚æ­¤æ—¶åœ¨ Thread Dump ä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äº â€œwaiting for monity entryâ€ çŠ¶æ€ã€‚</li>
</ul>
<p>ä¸´ç•ŒåŒºçš„è®¾ç½®æ˜¯ä¸ºäº†ä¿è¯å…¶å†…éƒ¨çš„ä»£ç æ‰§è¡Œçš„åŸå­æ€§å’Œå®Œæ•´æ€§ï¼Œä½†å› ä¸ºä¸´ç•ŒåŒºåœ¨ä»»ä½•æ—¶é—´åªå…è®¸çº¿ç¨‹ä¸²è¡Œé€šè¿‡ï¼Œè¿™å’Œæˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹çš„åˆè¡·æ˜¯ç›¸åçš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¤§é‡ä½¿ç”¨ synchronizedï¼Œæˆ–è€…ä¸é€‚å½“çš„ä½¿ç”¨å®ƒï¼Œä¼šé€ æˆå¤§é‡çº¿ç¨‹åœ¨ä¸´ç•ŒåŒºçš„å…¥å£ç­‰å¾…ï¼Œé€ æˆç³»ç»Ÿçš„æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚å¦‚æœåœ¨ Thread Dump ä¸­å‘ç°è¿™ä¸ªæƒ…å†µï¼Œåº”è¯¥å®¡è§†æºç å¹¶å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚</p>
<p>ï¼ˆ2ï¼‰&quot;Wait Set&quot; é‡Œé¢çš„çº¿ç¨‹</p>
<p>å½“çº¿ç¨‹è·å¾—äº† Monitorï¼Œè¿›å…¥äº†ä¸´ç•ŒåŒºä¹‹åï¼Œå¦‚æœå‘ç°çº¿ç¨‹ç»§ç»­è¿è¡Œçš„æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå®ƒåˆ™è°ƒç”¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯è¢« synchronized çš„å¯¹è±¡ï¼‰çš„ wait () æ–¹æ³•ï¼Œæ”¾å¼ƒ Monitorï¼Œè¿›å…¥ &quot;Wait Set&quot; é˜Ÿåˆ—ã€‚åªæœ‰å½“åˆ«çš„çº¿ç¨‹åœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨äº† notify () æˆ–è€… notifyAll () æ–¹æ³•ï¼Œ&quot;Wait Set&quot; é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ‰å¾—åˆ°æœºä¼šå»ç«äº‰ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„ Monitorï¼Œæ¢å¤åˆ°è¿è¡Œæ€ã€‚&quot;Wait Set&quot; ä¸­çš„çº¿ç¨‹åœ¨ Thread Dump ä¸­æ˜¾ç¤ºçš„çŠ¶æ€ä¸º in Object.wait ()ã€‚é€šå¸¸æ¥è¯´ï¼Œå½“ CPU å¾ˆå¿™çš„æ—¶å€™å…³æ³¨ Runnable çŠ¶æ€çš„çº¿ç¨‹ï¼Œåä¹‹åˆ™å…³æ³¨ waiting for monitor entry çŠ¶æ€çš„çº¿ç¨‹ã€‚</p>
<h3 id="-947"><a class="markdownIt-Anchor" href="#-947">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_4-4-jstack-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">#</a>4.4. jstack ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 id="-948"><a class="markdownIt-Anchor" href="#-948">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E6%89%BE%E5%87%BA%E6%9F%90-java-%E8%BF%9B%E7%A8%8B%E4%B8%AD%E6%9C%80%E8%80%97%E8%B4%B9-cpu-%E7%9A%84-java-%E7%BA%BF%E7%A8%8B">#</a>æ‰¾å‡ºæŸ Java è¿›ç¨‹ä¸­æœ€è€—è´¹ CPU çš„ Java çº¿ç¨‹</h4>
<p>ï¼ˆ1ï¼‰æ‰¾å‡º Java è¿›ç¨‹</p>
<p>å‡è®¾åº”ç”¨åç§°ä¸º myappï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jps <span class="token operator">|</span> <span class="token function">grep</span> myapp
<span class="token number">29527</span> myapp.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¾—åˆ°è¿›ç¨‹ ID ä¸º 21711</p>
<p>ï¼ˆ2ï¼‰æ‰¾å‡ºè¯¥è¿›ç¨‹å†…æœ€è€—è´¹ CPU çš„çº¿ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨  <code>ps -Lfp pid</code>  æˆ–è€…  <code>ps -mp pid -o THREAD, tid, time</code>  æˆ–è€…  <code>top -Hp pid</code></p>
<p><img src="http://static.oschina.net/uploads/space/2014/0128/170402_A57i_111708.png" alt="img"> TIME åˆ—å°±æ˜¯å„ä¸ª Java çº¿ç¨‹è€—è´¹çš„ CPU æ—¶é—´ï¼ŒCPU æ—¶é—´æœ€é•¿çš„æ˜¯çº¿ç¨‹ ID ä¸º 21742 çš„çº¿ç¨‹ï¼Œç”¨</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">printf</span> <span class="token string">"%x<span class="token entity" title="\n">\n</span>"</span> <span class="token number">21742</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¾—åˆ° 21742 çš„åå…­è¿›åˆ¶å€¼ä¸º 54eeï¼Œä¸‹é¢ä¼šç”¨åˆ°ã€‚</p>
<p>ï¼ˆ3ï¼‰ä½¿ç”¨ jstack æ‰“å°çº¿ç¨‹å †æ ˆä¿¡æ¯</p>
<p>ä¸‹ä¸€æ­¥ç»ˆäºè½®åˆ° jstack ä¸Šåœºäº†ï¼Œå®ƒç”¨æ¥è¾“å‡ºè¿›ç¨‹ 21711 çš„å †æ ˆä¿¡æ¯ï¼Œç„¶åæ ¹æ®çº¿ç¨‹ ID çš„åå…­è¿›åˆ¶å€¼ grepï¼Œå¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jstack <span class="token number">21711</span> <span class="token operator">|</span> <span class="token function">grep</span> 54ee
<span class="token string">"PollIntervalRetrySchedulerThread"</span> <span class="token assign-left variable">prio</span><span class="token operator">=</span><span class="token number">10</span> <span class="token assign-left variable">tid</span><span class="token operator">=</span>0x00007f950043e000 <span class="token assign-left variable">nid</span><span class="token operator">=</span>0x54ee <span class="token keyword">in</span> Object.wait<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>0x00007f94c6eda000<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ° CPU æ¶ˆè€—åœ¨  <code>PollIntervalRetrySchedulerThread</code>  è¿™ä¸ªç±»çš„  <code>Object.wait()</code> ã€‚</p>
<blockquote>
<p>æ³¨ï¼šä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé»˜è®¤åªæ˜¾ç¤ºäº†ä¸€è¡Œä¿¡æ¯ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›æŸ¥çœ‹æ›´è¯¦ç»†çš„è°ƒç”¨æ ˆã€‚å¯ä»¥é€šè¿‡æŒ‡å®š  <code>-A &lt;num&gt;</code>  çš„æ–¹å¼æ¥æ˜¾ç¤ºè¡Œæ•°ã€‚ä¾‹å¦‚ï¼š <code>jstack -l &lt;pid&gt; | grep &lt;thread-hex-id&gt; -A 10</code></p>
</blockquote>
<p>ï¼ˆ4ï¼‰åˆ†æä»£ç </p>
<p>æˆ‘æ‰¾äº†ä¸‹æˆ‘çš„ä»£ç ï¼Œå®šä½åˆ°ä¸‹é¢çš„ä»£ç ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Idle wait</span>
<span class="token function">getLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Thread ["</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] is idle waiting..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
schedulerThreadState <span class="token operator">=</span> <span class="token class-name">PollTaskSchedulerThreadState<span class="token punctuation">.</span>IdleWaiting</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> waitTime <span class="token operator">=</span> now <span class="token operator">+</span> <span class="token function">getIdleWaitTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> timeUntilContinue <span class="token operator">=</span> waitTime <span class="token operator">-</span> now<span class="token punctuation">;</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>sigLock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>halted<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    		sigLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span>timeUntilContinue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	<span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å®ƒæ˜¯è½®è¯¢ä»»åŠ¡çš„ç©ºé—²ç­‰å¾…ä»£ç ï¼Œä¸Šé¢çš„  <code>sigLock.wait(timeUntilContinue)</code>  å°±å¯¹åº”äº†å‰é¢çš„  <code>Object.wait()</code> ã€‚</p>
<h4 id="-949"><a class="markdownIt-Anchor" href="#-949">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#%E7%94%9F%E6%88%90-threaddump-%E6%96%87%E4%BB%B6">#</a>ç”Ÿæˆ threaddump æ–‡ä»¶</h4>
<p>å¯ä»¥ä½¿ç”¨  <code>jstack -l &lt;pid&gt; &gt; &lt;file-path&gt;</code>  å‘½ä»¤ç”Ÿæˆ threaddump æ–‡ä»¶</p>
<p>ã€ç¤ºä¾‹ã€‘ç”Ÿæˆè¿›ç¨‹ ID ä¸º 8841 çš„ Java è¿›ç¨‹çš„ threaddump æ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">jstack -l 8841 > /home/threaddump.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="-950"><a class="markdownIt-Anchor" href="#-950">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_5-jinfo">#</a>5. jinfo</h2>
<blockquote>
<p><strong><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/11/tools/jinfo.html">jinfo(JVM Configuration info) (opens new window)</a>ï¼Œæ˜¯ Java é…ç½®ä¿¡æ¯å·¥å…·</strong>ã€‚jinfo ç”¨äºå®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ã€‚å¦‚ä¼ é€’ç»™ Java è™šæ‹Ÿæœºçš„ <code>-X</code> ï¼ˆå³è¾“å‡ºä¸­çš„ jvm_argsï¼‰ã€ <code>-XX</code>  å‚æ•°ï¼ˆå³è¾“å‡ºä¸­çš„ VM Flagsï¼‰ï¼Œä»¥åŠå¯åœ¨ Java å±‚é¢é€šè¿‡ <code>System.getProperty</code>  è·å–çš„ <code>-D</code>  å‚æ•°ï¼ˆå³è¾“å‡ºä¸­çš„ System Propertiesï¼‰ã€‚</p>
</blockquote>
<p>ä¹‹å‰çš„  <code>jps -v</code>  å£ä»¤åªèƒ½æŸ¥çœ‹åˆ°æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹æœªè¢«æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°çš„å€¼å°±è¦ä½¿ç”¨ jinfo å£ä»¤ã€‚</p>
<p>jinfo å‘½ä»¤æ ¼å¼ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jinfo <span class="token punctuation">[</span>option<span class="token punctuation">]</span> pid<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>option</code>  é€‰é¡¹å‚æ•°ï¼š</p>
<ul>
<li><code>-flag</code>  - è¾“å‡ºæŒ‡å®š args å‚æ•°çš„å€¼</li>
<li><code>-sysprops</code>  - è¾“å‡ºç³»ç»Ÿå±æ€§ï¼Œç­‰åŒäº  <code>System.getProperties()</code></li>
</ul>
<p>ã€ç¤ºä¾‹ã€‘jinfo ä½¿ç”¨ç¤ºä¾‹</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jinfo -sysprops <span class="token number">29527</span>
Attaching to process ID <span class="token number">29527</span>, please wait<span class="token punctuation">..</span>.
Debugger attached successfully.
Server compiler detected.
JVM version is <span class="token number">25.222</span>-b10
<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-951"><a class="markdownIt-Anchor" href="#-951">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-cli-tools.html#_6-jhat">#</a>6. jhat</h2>
<blockquote>
<p><strong>jhat (JVM Heap Analysis Tool)ï¼Œæ˜¯è™šæ‹Ÿæœºå †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·</strong>ã€‚jhat ä¸ jmap æ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æ jmap ç”Ÿæˆçš„ dump æ–‡ä»¶ã€‚jhat å†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„ HTTP/HTML æœåŠ¡å™¨ï¼Œç”Ÿæˆ dump çš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚</p>
<p>æ³¨æ„ï¼šä¸€èˆ¬ä¸ä¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆ†æï¼Œå› ä¸º jhat æ˜¯ä¸€ä¸ªè€—æ—¶å¹¶ä¸”è€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æŠŠæœåŠ¡å™¨ç”Ÿæˆçš„ dump æ–‡ä»¶ï¼Œç”¨ jvisualvm ã€Eclipse Memory Analyzerã€IBM HeapAnalyzer ç­‰å·¥å…·æ¥åˆ†æã€‚</p>
</blockquote>
<p>å‘½ä»¤æ ¼å¼ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jhat <span class="token punctuation">[</span>dumpfile<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<hr>
<h1 id="jvm-gui-å·¥å…·"><a class="markdownIt-Anchor" href="#jvm-gui-å·¥å…·">#</a> JVM GUI å·¥å…·</h1>
<blockquote>
<p>Java ç¨‹åºå‘˜å…ä¸äº†æ•…éšœæ’æŸ¥å·¥ä½œï¼Œæ‰€ä»¥ç»å¸¸éœ€è¦ä½¿ç”¨ä¸€äº› JVM å·¥å…·ã€‚</p>
<p>æœ¬æ–‡ç³»ç»Ÿæ€§çš„ä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„ JVM GUI å·¥å…·ã€‚</p>
</blockquote>
<ul>
<li>\1. jconsole
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#11-%E5%BC%80%E5%90%AF-jmx">1.1. å¼€å¯ JMX</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#12-%E8%BF%9E%E6%8E%A5-jconsole">1.2. è¿æ¥ jconsole</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#13-jconsole-%E7%95%8C%E9%9D%A2">1.3. jconsole ç•Œé¢</a></li>
</ul>
</li>
<li>\2. jvisualvm
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#21-jvisualvm-%E6%A6%82%E8%BF%B0%E9%A1%B5%E9%9D%A2">2.1. jvisualvm æ¦‚è¿°é¡µé¢</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#22-jvisualvm-%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2">2.2. jvisualvm ç›‘æ§é¡µé¢</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#23-jvisualvm-%E7%BA%BF%E7%A8%8B%E9%A1%B5%E9%9D%A2">2.3. jvisualvm çº¿ç¨‹é¡µé¢</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#24-jvisualvm-%E6%8A%BD%E6%A0%B7%E5%99%A8%E9%A1%B5%E9%9D%A2">2.4. jvisualvm æŠ½æ ·å™¨é¡µé¢</a></li>
</ul>
</li>
<li>\3. MAT
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#31-mat-%E9%85%8D%E7%BD%AE">3.1. MAT é…ç½®</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#32-mat-%E5%88%86%E6%9E%90">3.2. MAT åˆ†æ</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#4-jprofile">4. JProfile</a></li>
<li>\5. Arthas
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#51-arthas-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4">5.1. Arthas åŸºç¡€å‘½ä»¤</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#52-arthas-jvm-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">5.2. Arthas jvm ç›¸å…³å‘½ä»¤</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#53-arthas-classclassloader-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">5.3. Arthas class/classloader ç›¸å…³å‘½ä»¤</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#54-arthas-monitorwatchtrace-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">5.4. Arthas monitor/watch/trace ç›¸å…³å‘½ä»¤</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#6-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">6. å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-952"><a class="markdownIt-Anchor" href="#-952">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_1-jconsole">#</a>1. jconsole</h2>
<blockquote>
<p>jconsole æ˜¯ JDK è‡ªå¸¦çš„ GUI å·¥å…·ã€‚<strong>jconsole (Java Monitoring and Management Console) æ˜¯ä¸€ç§åŸºäº JMX çš„å¯è§†åŒ–ç›‘è§†ä¸ç®¡ç†å·¥å…·</strong>ã€‚</p>
<p>jconsole çš„ç®¡ç†åŠŸèƒ½æ˜¯é’ˆå¯¹ JMX MBean è¿›è¡Œç®¡ç†ï¼Œç”±äº MBean å¯ä»¥ä½¿ç”¨ä»£ç ã€ä¸­é—´ä»¶æœåŠ¡å™¨çš„ç®¡ç†æ§åˆ¶å°æˆ–æ‰€æœ‰ç¬¦åˆ JMX è§„èŒƒçš„è½¯ä»¶è¿›è¡Œè®¿é—®ã€‚</p>
</blockquote>
<p>æ³¨æ„ï¼šä½¿ç”¨ jconsole çš„å‰ææ˜¯ Java åº”ç”¨å¼€å¯ JMXã€‚</p>
<h3 id="-953"><a class="markdownIt-Anchor" href="#-953">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_1-1-%E5%BC%80%E5%90%AF-jmx">#</a>1.1. å¼€å¯ JMX</h3>
<p>Java åº”ç”¨å¼€å¯ JMX åï¼Œå¯ä»¥ä½¿ç”¨  <code>jconsole</code>  æˆ–  <code>jvisualvm</code>  è¿›è¡Œç›‘æ§ Java ç¨‹åºçš„åŸºæœ¬ä¿¡æ¯å’Œè¿è¡Œæƒ…å†µã€‚</p>
<p>å¼€å¯æ–¹æ³•æ˜¯ï¼Œåœ¨ java æŒ‡ä»¤åï¼Œæ·»åŠ ä»¥ä¸‹å‚æ•°ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token operator">=</span><span class="token boolean">true</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>ssl<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>authenticate<span class="token operator">=</span><span class="token boolean">false</span>
<span class="token operator">-</span><span class="token class-name">Djava</span><span class="token punctuation">.</span>rmi<span class="token punctuation">.</span>server<span class="token punctuation">.</span>hostname<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
<span class="token operator">-</span><span class="token class-name">Dcom</span><span class="token punctuation">.</span>sun<span class="token punctuation">.</span>management<span class="token punctuation">.</span>jmxremote<span class="token punctuation">.</span>port<span class="token operator">=</span><span class="token number">18888</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>-Djava.rmi.server.hostname</code>  - æŒ‡å®š Java ç¨‹åºè¿è¡Œçš„æœåŠ¡å™¨</li>
<li><code>-Dcom.sun.management.jmxremote.port</code>  - æŒ‡å®š JMX æœåŠ¡ç›‘å¬ç«¯å£</li>
</ul>
<h3 id="-954"><a class="markdownIt-Anchor" href="#-954">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_1-2-%E8%BF%9E%E6%8E%A5-jconsole">#</a>1.2. è¿æ¥ jconsole</h3>
<p>å¦‚æœæ˜¯æœ¬åœ° Java è¿›ç¨‹ï¼Œjconsole å¯ä»¥ç›´æ¥ç»‘å®šè¿æ¥ã€‚</p>
<p>å¦‚æœæ˜¯è¿œç¨‹ Java è¿›ç¨‹ï¼Œéœ€è¦è¿æ¥ Java è¿›ç¨‹çš„ JMX ç«¯å£ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/connectadv.gif" alt="Connecting to a JMX Agent Using the JMX Service URL"></p>
<h3 id="-955"><a class="markdownIt-Anchor" href="#-955">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_1-3-jconsole-%E7%95%8C%E9%9D%A2">#</a>1.3. jconsole ç•Œé¢</h3>
<p>è¿›å…¥ jconsole åº”ç”¨åï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ tab é¡µé¢ã€‚</p>
<ul>
<li><code>æ¦‚è¿°</code>  - æ˜¾ç¤ºæœ‰å…³ Java VM å’Œç›‘è§†å€¼çš„æ¦‚è¿°ä¿¡æ¯ã€‚</li>
<li><code>å†…å­˜</code>  - æ˜¾ç¤ºæœ‰å…³å†…å­˜ä½¿ç”¨çš„ä¿¡æ¯ã€‚å†…å­˜é¡µç›¸å½“äºå¯è§†åŒ–çš„  <code>jstat</code>  å‘½ä»¤ã€‚</li>
<li><code>çº¿ç¨‹</code>  - æ˜¾ç¤ºæœ‰å…³çº¿ç¨‹ä½¿ç”¨çš„ä¿¡æ¯ã€‚</li>
<li><code>ç±»</code>  - æ˜¾ç¤ºæœ‰å…³ç±»åŠ è½½çš„ä¿¡æ¯ã€‚</li>
<li><code>VM æ‘˜è¦</code>  - æ˜¾ç¤ºæœ‰å…³ Java VM çš„ä¿¡æ¯ã€‚</li>
<li><code>MBean</code>  - æ˜¾ç¤ºæœ‰å…³ MBean çš„ä¿¡æ¯ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200730151422.png" alt="img"></p>
<h2 id="-956"><a class="markdownIt-Anchor" href="#-956">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_2-jvisualvm">#</a>2. jvisualvm</h2>
<blockquote>
<p>jvisualvm æ˜¯ JDK è‡ªå¸¦çš„ GUI å·¥å…·ã€‚<strong>jvisualvm (All-In-One Java Troubleshooting Tool) æ˜¯å¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·</strong>ã€‚å®ƒæ”¯æŒè¿è¡Œç›‘è§†ã€æ•…éšœå¤„ç†ã€æ€§èƒ½åˆ†æç­‰åŠŸèƒ½ã€‚</p>
</blockquote>
<p>ä¸ªäººè§‰å¾— jvisualvm æ¯” jconsole å¥½ç”¨ã€‚</p>
<h3 id="-957"><a class="markdownIt-Anchor" href="#-957">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_2-1-jvisualvm-%E6%A6%82%E8%BF%B0%E9%A1%B5%E9%9D%A2">#</a>2.1. jvisualvm æ¦‚è¿°é¡µé¢</h3>
<p>jvisualvm æ¦‚è¿°é¡µé¢å¯ä»¥æŸ¥çœ‹å½“å‰ Java è¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚ï¼šJDK ç‰ˆæœ¬ã€Java è¿›ç¨‹ã€JVM å‚æ•°ç­‰ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200730150147.png" alt="img"></p>
<h3 id="-958"><a class="markdownIt-Anchor" href="#-958">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_2-2-jvisualvm-%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2">#</a>2.2. jvisualvm ç›‘æ§é¡µé¢</h3>
<p>åœ¨ jvisualvm ç›‘æ§é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ° Java è¿›ç¨‹çš„ CPUã€å†…å­˜ã€ç±»åŠ è½½ã€çº¿ç¨‹çš„å®æ—¶å˜åŒ–ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200730150254.png" alt="img"></p>
<h3 id="-959"><a class="markdownIt-Anchor" href="#-959">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_2-3-jvisualvm-%E7%BA%BF%E7%A8%8B%E9%A1%B5%E9%9D%A2">#</a>2.3. jvisualvm çº¿ç¨‹é¡µé¢</h3>
<p>jvisualvm çº¿ç¨‹é¡µé¢å±•ç¤ºäº†å½“å‰çš„çº¿ç¨‹çŠ¶æ€ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200730150416.png" alt="img"></p>
<p>jvisualvm è¿˜å¯ä»¥ç”Ÿæˆçº¿ç¨‹ Dump æ–‡ä»¶ï¼Œå¸®åŠ©è¿›ä¸€æ­¥åˆ†æçº¿ç¨‹æ ˆä¿¡æ¯ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200730150830.png" alt="img"></p>
<h3 id="-960"><a class="markdownIt-Anchor" href="#-960">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_2-4-jvisualvm-%E6%8A%BD%E6%A0%B7%E5%99%A8%E9%A1%B5%E9%9D%A2">#</a>2.4. jvisualvm æŠ½æ ·å™¨é¡µé¢</h3>
<p>jvisualvm å¯ä»¥å¯¹ CPUã€å†…å­˜è¿›è¡ŒæŠ½æ ·ï¼Œå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ€§èƒ½åˆ†æã€‚</p>
<p><img src="C:/%5CUsers%5Czp%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200730150648010.png" alt="image-20200730150648010"></p>
<h2 id="-961"><a class="markdownIt-Anchor" href="#-961">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_3-mat">#</a>3. MAT</h2>
<p><a target="_blank" rel="noopener" href="https://www.eclipse.org/mat/">MAT (opens new window)</a> å³ Eclipse Memory Analyzer Tool çš„ç¼©å†™ã€‚</p>
<p>MAT æœ¬èº«ä¹Ÿèƒ½å¤Ÿè·å–å †çš„äºŒè¿›åˆ¶å¿«ç…§ã€‚è¯¥åŠŸèƒ½å°†å€ŸåŠ©  <code>jps</code>  åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„ Java è¿›ç¨‹ï¼Œä»¥ä¾›é€‰æ‹©å¹¶è·å–å¿«ç…§ã€‚ç”±äº  <code>jps</code>  ä¼šå°†è‡ªå·±åˆ—å…¥å…¶ä¸­ï¼Œå› æ­¤ä½ ä¼šåœ¨åˆ—è¡¨ä¸­å‘ç°ä¸€ä¸ªå·²ç»ç»“æŸè¿è¡Œçš„  <code>jps</code>  è¿›ç¨‹ã€‚</p>
<p>MAT å¯ä»¥ç‹¬ç«‹å®‰è£…ï¼ˆ<a target="_blank" rel="noopener" href="http://www.eclipse.org/mat/downloads.php">å®˜æ–¹ä¸‹è½½åœ°å€ (opens new window)</a>ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½œä¸º Eclipse IDE çš„æ’ä»¶å®‰è£…ã€‚</p>
<h3 id="-962"><a class="markdownIt-Anchor" href="#-962">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_3-1-mat-%E9%85%8D%E7%BD%AE">#</a>3.1. MAT é…ç½®</h3>
<p>MAT è§£å‹åï¼Œå®‰è£…ç›®å½•ä¸‹æœ‰ä¸ª  <code>MemoryAnalyzer.ini</code>  æ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-none"><code class="language-none">MemoryAnalyzer.ini&#96; ä¸­æœ‰ä¸ªé‡è¦çš„å‚æ•° &#96;Xmx&#96; è¡¨ç¤ºæœ€å¤§å†…å­˜ï¼Œé»˜è®¤ä¸ºï¼š&#96;-vmargs -Xmx1024m<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœè¯•å›¾ç”¨ MAT å¯¼å…¥çš„ dump æ–‡ä»¶è¶…è¿‡ 1024 Mï¼Œä¼šæŠ¥é”™ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">An internal error occurred during: <span class="token string">"Parsing heap dump from XXX"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>æ­¤æ—¶ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´  <code>Xmx</code>  å¤§å°ã€‚å¦‚æœè®¾ç½®çš„  <code>Xmx</code>  æ•°å€¼è¿‡å¤§ï¼Œæœ¬æœºå†…å­˜ä¸è¶³ä»¥æ”¯æ’‘ï¼Œå¯åŠ¨ MAT ä¼šæŠ¥é”™ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Failed to create the Java Virtual Machine<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="-963"><a class="markdownIt-Anchor" href="#-963">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_3-2-mat-%E5%88%86%E6%9E%90">#</a>3.2. MAT åˆ†æ</h3>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200308092746.png" alt="img"></p>
<p>ç‚¹å‡» Leak Suspects å¯ä»¥è¿›å…¥å†…å­˜æ³„æ¼é¡µé¢ã€‚</p>
<p>ï¼ˆ1ï¼‰é¦–å…ˆï¼Œå¯ä»¥æŸ¥çœ‹é¥¼å›¾äº†è§£å†…å­˜çš„æ•´ä½“æ¶ˆè€—æƒ…å†µ</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200308150556.png" alt="img"></p>
<p>ï¼ˆ2ï¼‰ç¼©å°èŒƒå›´ï¼Œå¯»æ‰¾é—®é¢˜ç–‘ä¼¼ç‚¹</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20160223202154818" alt="img"></p>
<p>å¯ä»¥ç‚¹å‡»è¿›å…¥è¯¦æƒ…é¡µé¢ï¼Œåœ¨è¯¦æƒ…é¡µé¢ Shortest Paths To the Accumulation Point è¡¨ç¤º GC root åˆ°å†…å­˜æ¶ˆè€—èšé›†ç‚¹çš„æœ€çŸ­è·¯å¾„ï¼Œå¦‚æœæŸä¸ªå†…å­˜æ¶ˆè€—èšé›†ç‚¹æœ‰è·¯å¾„åˆ°è¾¾ GC rootï¼Œåˆ™è¯¥å†…å­˜æ¶ˆè€—èšé›†ç‚¹ä¸ä¼šè¢«å½“åšåƒåœ¾è¢«å›æ”¶ã€‚</p>
<p>ä¸ºäº†æ‰¾åˆ°å†…å­˜æ³„éœ²ï¼Œæˆ‘è·å–äº†ä¸¤ä¸ªå †è½¬å‚¨æ–‡ä»¶ï¼Œä¸¤ä¸ªæ–‡ä»¶è·å–æ—¶é—´é—´éš”æ˜¯ä¸€å¤©ï¼ˆå› ä¸ºå†…å­˜åªæ˜¯å°å¹…åº¦å¢é•¿ï¼ŒçŸ­æ—¶é—´å¾ˆéš¾å‘ç°é—®é¢˜ï¼‰ã€‚å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶çš„å¯¹è±¡ï¼Œé€šè¿‡å¯¹æ¯”åçš„ç»“æœå¯ä»¥å¾ˆæ–¹ä¾¿å®šä½å†…å­˜æ³„éœ²ã€‚</p>
<p>MAT åŒæ—¶æ‰“å¼€ä¸¤ä¸ªå †è½¬å‚¨æ–‡ä»¶ï¼Œåˆ†åˆ«æ‰“å¼€ Histogramï¼Œå¦‚ä¸‹å›¾ã€‚åœ¨ä¸‹å›¾ä¸­æ–¹æ¡† 1 æŒ‰é’®ç”¨äºå¯¹æ¯”ä¸¤ä¸ª Histogramï¼Œå¯¹æ¯”ååœ¨æ–¹æ¡† 2 å¤„é€‰æ‹© Group By packageï¼Œç„¶åå¯¹æ¯”å„å¯¹è±¡çš„å˜åŒ–ã€‚ä¸éš¾å‘ç° heap3.hprof æ¯” heap6.hprof å°‘äº† 64 ä¸ª eventInfo å¯¹è±¡ï¼Œå¦‚æœå¯¹ä»£ç æ¯”è¾ƒç†Ÿæ‚‰çš„è¯æƒ³å¿…è¿™æ ·ä¸€ä¸ªç»“æœæ˜¯èƒ½å¤Ÿç»™ç¨‹åºå‘˜ä¸€å®šçš„å¯ç¤ºçš„ã€‚è€Œæˆ‘ä¹Ÿæ˜¯æ ¹æ®è¿™ä¸ªå¯ç¤ºå·®æ‰¾åˆ°äº†æœ€ç»ˆå†…å­˜æ³„éœ²çš„ä½ç½®ã€‚ <img src="https://img-blog.csdn.net/20160223203226362" alt="img"></p>
<h2 id="-964"><a class="markdownIt-Anchor" href="#-964">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_4-jprofile">#</a>4. JProfile</h2>
<p><a target="_blank" rel="noopener" href="https://www.ej-technologies.com/products/jprofiler/overview.html">JProfiler (opens new window)</a> æ˜¯ä¸€æ¬¾æ€§èƒ½åˆ†æå·¥å…·ã€‚</p>
<p>ç”±äºå®ƒæ˜¯æ”¶è´¹çš„ï¼Œæ‰€ä»¥æˆ‘æœ¬äººä½¿ç”¨è¾ƒå°‘ã€‚ä½†æ˜¯ï¼Œå®ƒç¡®å®åŠŸèƒ½å¼ºå¤§ï¼Œä¸”æ–¹ä¾¿ä½¿ç”¨ï¼Œè¿˜å¯ä»¥å’Œ Intellij Idea é›†æˆã€‚</p>
<p><img src="C:/%5CUsers%5Czp%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200730152158398.png" alt="image-20200730152158398"></p>
<h2 id="-965"><a class="markdownIt-Anchor" href="#-965">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_5-arthas">#</a>5. Arthas</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas">Arthas (opens new window)</a> æ˜¯ Alibaba å¼€æºçš„ Java è¯Šæ–­å·¥å…·ï¼Œæ·±å—å¼€å‘è€…å–œçˆ±ã€‚åœ¨çº¿æ’æŸ¥é—®é¢˜ï¼Œæ— éœ€é‡å¯ï¼›åŠ¨æ€è·Ÿè¸ª Java ä»£ç ï¼›å®æ—¶ç›‘æ§ JVM çŠ¶æ€ã€‚</p>
<p>Arthas æ”¯æŒ JDK 6+ï¼Œæ”¯æŒ Linux/Mac/Windowsï¼Œé‡‡ç”¨å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼ŒåŒæ—¶æä¾›ä¸°å¯Œçš„  <code>Tab</code>  è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æ–¹ä¾¿è¿›è¡Œé—®é¢˜çš„å®šä½å’Œè¯Šæ–­ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20200730145030.png" alt="img"></p>
<h3 id="-966"><a class="markdownIt-Anchor" href="#-966">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_5-1-arthas-%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4">#</a>5.1. Arthas åŸºç¡€å‘½ä»¤</h3>
<ul>
<li>helpâ€”â€” æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/cat.html">cat (opens new window)</a>â€”â€” æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œå’Œ linux é‡Œçš„ cat å‘½ä»¤ç±»ä¼¼</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/echo.html">echo (opens new window)</a>â€“æ‰“å°å‚æ•°ï¼Œå’Œ linux é‡Œçš„ echo å‘½ä»¤ç±»ä¼¼</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/grep.html">grep (opens new window)</a>â€”â€” åŒ¹é…æŸ¥æ‰¾ï¼Œå’Œ linux é‡Œçš„ grep å‘½ä»¤ç±»ä¼¼</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/tee.html">tee (opens new window)</a>â€”â€” å¤åˆ¶æ ‡å‡†è¾“å…¥åˆ°æ ‡å‡†è¾“å‡ºå’ŒæŒ‡å®šçš„æ–‡ä»¶ï¼Œå’Œ linux é‡Œçš„ tee å‘½ä»¤ç±»ä¼¼</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/pwd.html">pwd (opens new window)</a>â€”â€” è¿”å›å½“å‰çš„å·¥ä½œç›®å½•ï¼Œå’Œ linux å‘½ä»¤ç±»ä¼¼</li>
<li>clsâ€”â€” æ¸…ç©ºå½“å‰å±å¹•åŒºåŸŸ</li>
<li>sessionâ€”â€” æŸ¥çœ‹å½“å‰ä¼šè¯çš„ä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/reset.html">reset (opens new window)</a>â€”â€” é‡ç½®å¢å¼ºç±»ï¼Œå°†è¢« Arthas å¢å¼ºè¿‡çš„ç±»å…¨éƒ¨è¿˜åŸï¼ŒArthas æœåŠ¡ç«¯å…³é—­æ—¶ä¼šé‡ç½®æ‰€æœ‰å¢å¼ºè¿‡çš„ç±»</li>
<li>versionâ€”â€” è¾“å‡ºå½“å‰ç›®æ ‡ Java è¿›ç¨‹æ‰€åŠ è½½çš„ Arthas ç‰ˆæœ¬å·</li>
<li>historyâ€”â€” æ‰“å°å‘½ä»¤å†å²</li>
<li>quitâ€”â€” é€€å‡ºå½“å‰ Arthas å®¢æˆ·ç«¯ï¼Œå…¶ä»– Arthas å®¢æˆ·ç«¯ä¸å—å½±å“</li>
<li>stopâ€”â€” å…³é—­ Arthas æœåŠ¡ç«¯ï¼Œæ‰€æœ‰ Arthas å®¢æˆ·ç«¯å…¨éƒ¨é€€å‡º</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/keymap.html">keymap (opens new window)</a>â€”â€”Arthas å¿«æ·é”®åˆ—è¡¨åŠè‡ªå®šä¹‰å¿«æ·é”®</li>
</ul>
<h3 id="-967"><a class="markdownIt-Anchor" href="#-967">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_5-2-arthas-jvm-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">#</a>5.2. Arthas jvm ç›¸å…³å‘½ä»¤</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/dashboard.html">dashboard (opens new window)</a>â€”â€” å½“å‰ç³»ç»Ÿçš„å®æ—¶æ•°æ®é¢æ¿</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/thread.html">thread (opens new window)</a>â€”â€” æŸ¥çœ‹å½“å‰ JVM çš„çº¿ç¨‹å †æ ˆä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/jvm.html">jvm (opens new window)</a>â€”â€” æŸ¥çœ‹å½“å‰ JVM çš„ä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/sysprop.html">sysprop (opens new window)</a>â€”â€” æŸ¥çœ‹å’Œä¿®æ”¹ JVM çš„ç³»ç»Ÿå±æ€§</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/sysenv.html">sysenv (opens new window)</a>â€”â€” æŸ¥çœ‹ JVM çš„ç¯å¢ƒå˜é‡</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/vmoption.html">vmoption (opens new window)</a>â€”â€” æŸ¥çœ‹å’Œä¿®æ”¹ JVM é‡Œè¯Šæ–­ç›¸å…³çš„ option</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/perfcounter.html">perfcounter (opens new window)</a>â€”â€” æŸ¥çœ‹å½“å‰ JVM çš„ Perf Counter ä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/logger.html">logger (opens new window)</a>â€”â€” æŸ¥çœ‹å’Œä¿®æ”¹ logger</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/getstatic.html">getstatic (opens new window)</a>â€”â€” æŸ¥çœ‹ç±»çš„é™æ€å±æ€§</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/ognl.html">ognl (opens new window)</a>â€”â€” æ‰§è¡Œ ognl è¡¨è¾¾å¼</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/mbean.html">mbean (opens new window)</a>â€”â€” æŸ¥çœ‹ Mbean çš„ä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/heapdump.html">heapdump (opens new window)</a>â€”â€”dump java heap, ç±»ä¼¼ jmap å‘½ä»¤çš„ heap dump åŠŸèƒ½</li>
</ul>
<h3 id="-968"><a class="markdownIt-Anchor" href="#-968">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_5-3-arthas-class-classloader-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">#</a>5.3. Arthas class/classloader ç›¸å…³å‘½ä»¤</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/sc.html">sc (opens new window)</a>â€”â€” æŸ¥çœ‹ JVM å·²åŠ è½½çš„ç±»ä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/sm.html">sm (opens new window)</a>â€”â€” æŸ¥çœ‹å·²åŠ è½½ç±»çš„æ–¹æ³•ä¿¡æ¯</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/jad.html">jad (opens new window)</a>â€”â€” åç¼–è¯‘æŒ‡å®šå·²åŠ è½½ç±»çš„æºç </li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/mc.html">mc (opens new window)</a>â€”â€” å†…å­˜ç¼–è¯‘å™¨ï¼Œå†…å­˜ç¼–è¯‘ <code>.java</code>  æ–‡ä»¶ä¸º <code>.class</code>  æ–‡ä»¶</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/redefine.html">redefine (opens new window)</a>â€”â€” åŠ è½½å¤–éƒ¨çš„ <code>.class</code>  æ–‡ä»¶ï¼Œredefine åˆ° JVM é‡Œ</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/dump.html">dump (opens new window)</a>â€”â€”dump å·²åŠ è½½ç±»çš„ byte code åˆ°ç‰¹å®šç›®å½•</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/classloader.html">classloader (opens new window)</a>â€”â€” æŸ¥çœ‹ classloader çš„ç»§æ‰¿æ ‘ï¼Œurlsï¼Œç±»åŠ è½½ä¿¡æ¯ï¼Œä½¿ç”¨ classloader å» getResource</li>
</ul>
<h3 id="-969"><a class="markdownIt-Anchor" href="#-969">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-gui-tools.html#_5-4-arthas-monitor-watch-trace-%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4">#</a>5.4. Arthas monitor/watch/trace ç›¸å…³å‘½ä»¤</h3>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œè¿™äº›å‘½ä»¤ï¼Œéƒ½é€šè¿‡å­—èŠ‚ç å¢å¼ºæŠ€æœ¯æ¥å®ç°çš„ï¼Œä¼šåœ¨æŒ‡å®šç±»çš„æ–¹æ³•ä¸­æ’å…¥ä¸€äº›åˆ‡é¢æ¥å®ç°æ•°æ®ç»Ÿè®¡å’Œè§‚æµ‹ï¼Œå› æ­¤åœ¨çº¿ä¸Šã€é¢„å‘ä½¿ç”¨æ—¶ï¼Œè¯·å°½é‡æ˜ç¡®éœ€è¦è§‚æµ‹çš„ç±»ã€æ–¹æ³•ä»¥åŠæ¡ä»¶ï¼Œè¯Šæ–­ç»“æŸè¦æ‰§è¡Œ  <code>stop</code>  æˆ–å°†å¢å¼ºè¿‡çš„ç±»æ‰§è¡Œ  <code>reset</code>  å‘½ä»¤ã€‚</p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/monitor.html">monitor (opens new window)</a>â€”â€” æ–¹æ³•æ‰§è¡Œç›‘æ§</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/watch.html">watch (opens new window)</a>â€”â€” æ–¹æ³•æ‰§è¡Œæ•°æ®è§‚æµ‹</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/trace.html">trace (opens new window)</a>â€”â€” æ–¹æ³•å†…éƒ¨è°ƒç”¨è·¯å¾„ï¼Œå¹¶è¾“å‡ºæ–¹æ³•è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè€—æ—¶</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/stack.html">stack (opens new window)</a>â€”â€” è¾“å‡ºå½“å‰æ–¹æ³•è¢«è°ƒç”¨çš„è°ƒç”¨è·¯å¾„</li>
<li><a target="_blank" rel="noopener" href="https://alibaba.github.io/arthas/tt.html">tt (opens new window)</a>â€”â€” æ–¹æ³•æ‰§è¡Œæ•°æ®çš„æ—¶ç©ºéš§é“ï¼Œè®°å½•ä¸‹æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒçš„æ—¶é—´ä¸‹è°ƒç”¨è¿›è¡Œè§‚æµ‹</li>
</ul>
<hr>
<h1 id="java-åº”ç”¨æ•…éšœè¯Šæ–­"><a class="markdownIt-Anchor" href="#java-åº”ç”¨æ•…éšœè¯Šæ–­">#</a> Java åº”ç”¨æ•…éšœè¯Šæ–­</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E4%B8%80%E6%95%85%E9%9A%9C%E5%AE%9A%E4%BD%8D%E6%80%9D%E8%B7%AF">ä¸€ã€æ•…éšœå®šä½æ€è·¯</a></li>
<li>äºŒã€CPU é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E6%89%BE-cpu-%E5%8D%A0%E7%94%A8%E7%8E%87%E8%BE%83%E9%AB%98%E7%9A%84%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B">æŸ¥æ‰¾ CPU å ç”¨ç‡è¾ƒé«˜çš„è¿›ç¨‹ã€çº¿ç¨‹</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E9%A2%91%E7%B9%81-gc">æ˜¯å¦å­˜åœ¨é¢‘ç¹ GC</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E9%A2%91%E7%B9%81%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2">æ˜¯å¦å­˜åœ¨é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E4%B8%89%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98">ä¸‰ã€å†…å­˜é—®é¢˜</a></li>
<li>å››ã€ç£ç›˜é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E7%9C%8B%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87">æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E7%9C%8B%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E6%80%A7%E8%83%BD">æŸ¥çœ‹ç£ç›˜è¯»å†™æ€§èƒ½</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E7%9C%8B%E5%85%B7%E4%BD%93%E7%9A%84%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%83%85%E5%86%B5">æŸ¥çœ‹å…·ä½“çš„æ–‡ä»¶è¯»å†™æƒ…å†µ</a></li>
</ul>
</li>
<li>äº”ã€ç½‘ç»œé—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5">æ— æ³•è¿æ¥</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E7%BD%91%E7%BB%9C%E8%B6%85%E6%97%B6">ç½‘ç»œè¶…æ—¶</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#tcp-%E9%98%9F%E5%88%97%E6%BA%A2%E5%87%BA">TCP é˜Ÿåˆ—æº¢å‡º</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#rst-%E5%BC%82%E5%B8%B8">RST å¼‚å¸¸</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#time_wait-%E5%92%8C-close_wait">TIME_WAIT å’Œ CLOSE_WAIT</a></li>
</ul>
</li>
<li>å…­ã€GC é—®é¢˜
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#oom">OOM</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#minor-gc">Minor GC</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#full-gc-%E8%BF%87%E9%A2%91">Full GC è¿‡é¢‘</a></li>
</ul>
</li>
<li>ä¸ƒã€å¸¸ç”¨ Linux å‘½ä»¤
<ul>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#top">top</a></li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#vmstat">vmstat</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">å‚è€ƒèµ„æ–™</a></li>
</ul>
<h2 id="-970"><a class="markdownIt-Anchor" href="#-970">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E4%B8%80%E3%80%81%E6%95%85%E9%9A%9C%E5%AE%9A%E4%BD%8D%E6%80%9D%E8%B7%AF">#</a>ä¸€ã€æ•…éšœå®šä½æ€è·¯</h2>
<p>Java åº”ç”¨å‡ºç°çº¿ä¸Šæ•…éšœï¼Œå¦‚ä½•è¿›è¡Œè¯Šæ–­ï¼Ÿ</p>
<p>æˆ‘ä»¬åœ¨å®šä½çº¿ä¸Šé—®é¢˜æ—¶è¦æœ‰ä¸€ä¸ªæ•´ä½“çš„æ€è·¯ï¼Œé¡ºè—¤æ‘¸ç“œï¼Œæ‰èƒ½è¾ƒå¿«çš„æ‰¾åˆ°é—®é¢˜åŸå› ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒæœåŠ¡å™¨æ•…éšœè¯Šæ–­çš„æ•´ä½“æ€è·¯å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200309181645.png" alt="img"></p>
<p>åº”ç”¨æ•…éšœè¯Šæ–­æ€è·¯ï¼š</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/20200309181831.png" alt="img"></p>
<h2 id="-971"><a class="markdownIt-Anchor" href="#-971">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E4%BA%8C%E3%80%81cpu-%E9%97%AE%E9%A2%98">#</a>äºŒã€CPU é—®é¢˜</h2>
<p>ä¸€ã€<strong>CPU ä½¿ç”¨ç‡è¿‡é«˜</strong>ï¼šå¾€å¾€æ˜¯ç”±äºç¨‹åºé€»è¾‘é—®é¢˜å¯¼è‡´çš„ã€‚å¸¸è§å¯¼è‡´ CPU é£™å‡çš„é—®é¢˜åœºæ™¯å¦‚ï¼šæ­»å¾ªç¯ï¼Œæ— é™é€’å½’ã€é¢‘ç¹ GCã€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡å¤šã€‚</p>
<p>äºŒã€<strong>CPU å§‹ç»ˆå‡ä¸ä¸Šå»</strong>ï¼šå¾€å¾€æ˜¯ç”±äºç¨‹åºä¸­å­˜åœ¨å¤§é‡ IO æ“ä½œå¹¶ä¸”æ—¶é—´å¾ˆé•¿ï¼ˆæ•°æ®åº“è¯»å†™ã€æ—¥å¿—ç­‰ï¼‰ã€‚</p>
<h3 id="-972"><a class="markdownIt-Anchor" href="#-972">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E6%89%BE-cpu-%E5%8D%A0%E7%94%A8%E7%8E%87%E8%BE%83%E9%AB%98%E7%9A%84%E8%BF%9B%E7%A8%8B%E3%80%81%E7%BA%BF%E7%A8%8B">#</a>æŸ¥æ‰¾ CPU å ç”¨ç‡è¾ƒé«˜çš„è¿›ç¨‹ã€çº¿ç¨‹</h3>
<p>çº¿ä¸Šç¯å¢ƒçš„ Java åº”ç”¨å¯èƒ½æœ‰å¤šä¸ªè¿›ç¨‹ã€çº¿ç¨‹ï¼Œæ‰€ä»¥ï¼Œè¦å…ˆæ‰¾åˆ° CPU å ç”¨ç‡è¾ƒé«˜çš„è¿›ç¨‹ã€çº¿ç¨‹ã€‚</p>
<p>ï¼ˆ1ï¼‰ä½¿ç”¨  <code>ps</code>  å‘½ä»¤æŸ¥çœ‹ xxx åº”ç”¨çš„è¿›ç¨‹ IDï¼ˆPIDï¼‰</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨  <code>jps</code>  å‘½ä»¤æ¥æŸ¥çœ‹ã€‚</p>
<p>ï¼ˆ2ï¼‰å¦‚æœåº”ç”¨æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œå¯ä»¥ç”¨  <code>top</code>  å‘½ä»¤æŸ¥çœ‹å“ªä¸ªå ç”¨ CPU è¾ƒé«˜ã€‚</p>
<p>ï¼ˆ3ï¼‰ç”¨  <code>top -Hp pid</code>  æ¥æ‰¾åˆ° CPU ä½¿ç”¨ç‡æ¯”è¾ƒé«˜çš„ä¸€äº›çº¿ç¨‹ã€‚</p>
<p>ï¼ˆ4ï¼‰å°†å ç”¨ CPU æœ€é«˜çš„ PID è½¬æ¢ä¸º 16 è¿›åˆ¶ï¼Œä½¿ç”¨  <code>printf '%x\n' pid</code>  å¾—åˆ°  <code>nid</code></p>
<p>ï¼ˆ5ï¼‰ä½¿ç”¨  <code>jstack pic | grep 'nid' -C5</code>  å‘½ä»¤ï¼ŒæŸ¥çœ‹å †æ ˆä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jstack <span class="token number">7129</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'0x1c23'</span> -C5
        at java.lang.Object.wait<span class="token punctuation">(</span>Object.java:502<span class="token punctuation">)</span>
        at java.lang.ref.Reference.tryHandlePending<span class="token punctuation">(</span>Reference.java:191<span class="token punctuation">)</span>
        - locked <span class="token operator">&lt;</span>0x00000000b5383ff<span class="token operator"><span class="token file-descriptor important">0</span>></span> <span class="token punctuation">(</span>a java.lang.ref.Reference<span class="token variable">$Lock</span><span class="token punctuation">)</span>
        at java.lang.ref.Reference<span class="token variable">$ReferenceHandler</span>.run<span class="token punctuation">(</span>Reference.java:153<span class="token punctuation">)</span>

<span class="token string">"main"</span> <span class="token comment">#1 prio=5 os_prio=0 tid=0x00007f4df400a800 nid=0x1c23 in Object.wait() [0x00007f4dfdec8000]</span>
   java.lang.Thread.State: WAITING <span class="token punctuation">(</span>on object monitor<span class="token punctuation">)</span>
        at java.lang.Object.wait<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
        - waiting on <span class="token operator">&lt;</span>0x00000000b538401<span class="token operator"><span class="token file-descriptor important">8</span>></span> <span class="token punctuation">(</span>a org.apache.felix.framework.util.ThreadGate<span class="token punctuation">)</span>
        at org.apache.felix.framework.util.ThreadGate.await<span class="token punctuation">(</span>ThreadGate.java:79<span class="token punctuation">)</span>
        - locked <span class="token operator">&lt;</span>0x00000000b538401<span class="token operator"><span class="token file-descriptor important">8</span>></span> <span class="token punctuation">(</span>a org.apache.felix.framework.util.ThreadGate<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ï¼ˆ6ï¼‰æ›´å¸¸è§çš„æ“ä½œæ˜¯ç”¨  <code>jstack</code>  ç”Ÿæˆå †æ ˆå¿«ç…§ï¼Œç„¶ååŸºäºå¿«ç…§æ–‡ä»¶è¿›è¡Œåˆ†æã€‚ç”Ÿæˆå¿«ç…§å‘½ä»¤ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">jstack -F -l pid <span class="token operator">>></span> threaddump.log<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ï¼ˆ7ï¼‰åˆ†æå †æ ˆä¿¡æ¯</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒçŠ¶æ€ä¸º  <code>WAITING</code> ã€ <code>TIMED_WAITING</code>  ã€ <code>BLOCKED</code>  çš„çº¿ç¨‹æ›´å¯èƒ½å‡ºç°é—®é¢˜ã€‚å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ç»Ÿè®¡ï¼š</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">cat threaddump.log | grep "java.lang.Thread.State" | sort -nr | uniq -c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>å¦‚æœå­˜åœ¨å¤§é‡  <code>WAITING</code> ã€ <code>TIMED_WAITING</code>  ã€ <code>BLOCKED</code>  ï¼Œé‚£ä¹ˆå¤šåŠæ˜¯æœ‰é—®é¢˜å•¦ã€‚</p>
<h3 id="-973"><a class="markdownIt-Anchor" href="#-973">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E9%A2%91%E7%B9%81-gc">#</a>æ˜¯å¦å­˜åœ¨é¢‘ç¹ GC</h3>
<p>å¦‚æœåº”ç”¨é¢‘ç¹ GCï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ CPU é£™å‡ã€‚ä¸ºä½•é¢‘ç¹ GC å¯ä»¥ä½¿ç”¨  <code>jstack</code>  æ¥åˆ†æé—®é¢˜ï¼ˆåˆ†æå’Œè§£å†³é¢‘ç¹ GC é—®é¢˜ï¼Œåœ¨åç»­è®²è§£ï¼‰ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•åˆ¤æ–­ Java è¿›ç¨‹ GC æ˜¯å¦é¢‘ç¹ï¼Ÿ</p>
<p>å¯ä»¥ä½¿ç”¨  <code>jstat -gc pid 1000</code>  å‘½ä»¤æ¥è§‚å¯Ÿ GC çŠ¶æ€ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ jstat -gc <span class="token number">29527</span> <span class="token number">200</span> <span class="token number">5</span>
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
<span class="token number">22528.0</span> <span class="token number">22016.0</span>  <span class="token number">0.0</span>   <span class="token number">21388.2</span> <span class="token number">4106752.0</span> <span class="token number">921244.7</span> <span class="token number">5592576.0</span>  <span class="token number">2086826.5</span>  <span class="token number">110716.0</span> <span class="token number">103441.1</span> <span class="token number">12416.0</span> <span class="token number">11167.7</span>   <span class="token number">3189</span>   <span class="token number">90.057</span>  <span class="token number">10</span>      <span class="token number">2.140</span>   <span class="token number">92.197</span>
<span class="token number">22528.0</span> <span class="token number">22016.0</span>  <span class="token number">0.0</span>   <span class="token number">21388.2</span> <span class="token number">4106752.0</span> <span class="token number">921244.7</span> <span class="token number">5592576.0</span>  <span class="token number">2086826.5</span>  <span class="token number">110716.0</span> <span class="token number">103441.1</span> <span class="token number">12416.0</span> <span class="token number">11167.7</span>   <span class="token number">3189</span>   <span class="token number">90.057</span>  <span class="token number">10</span>      <span class="token number">2.140</span>   <span class="token number">92.197</span>
<span class="token number">22528.0</span> <span class="token number">22016.0</span>  <span class="token number">0.0</span>   <span class="token number">21388.2</span> <span class="token number">4106752.0</span> <span class="token number">921244.7</span> <span class="token number">5592576.0</span>  <span class="token number">2086826.5</span>  <span class="token number">110716.0</span> <span class="token number">103441.1</span> <span class="token number">12416.0</span> <span class="token number">11167.7</span>   <span class="token number">3189</span>   <span class="token number">90.057</span>  <span class="token number">10</span>      <span class="token number">2.140</span>   <span class="token number">92.197</span>
<span class="token number">22528.0</span> <span class="token number">22016.0</span>  <span class="token number">0.0</span>   <span class="token number">21388.2</span> <span class="token number">4106752.0</span> <span class="token number">921244.7</span> <span class="token number">5592576.0</span>  <span class="token number">2086826.5</span>  <span class="token number">110716.0</span> <span class="token number">103441.1</span> <span class="token number">12416.0</span> <span class="token number">11167.7</span>   <span class="token number">3189</span>   <span class="token number">90.057</span>  <span class="token number">10</span>      <span class="token number">2.140</span>   <span class="token number">92.197</span>
<span class="token number">22528.0</span> <span class="token number">22016.0</span>  <span class="token number">0.0</span>   <span class="token number">21388.2</span> <span class="token number">4106752.0</span> <span class="token number">921244.7</span> <span class="token number">5592576.0</span>  <span class="token number">2086826.5</span>  <span class="token number">110716.0</span> <span class="token number">103441.1</span> <span class="token number">12416.0</span> <span class="token number">11167.7</span>   <span class="token number">3189</span>   <span class="token number">90.057</span>  <span class="token number">10</span>      <span class="token number">2.140</span>   <span class="token number">92.197</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-974"><a class="markdownIt-Anchor" href="#-974">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8%E9%A2%91%E7%B9%81%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2">#</a>æ˜¯å¦å­˜åœ¨é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢</h3>
<p>é’ˆå¯¹é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨  <code>vmstat pid</code>  å‘½ä»¤æ¥è¿›è¡ŒæŸ¥çœ‹ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">vmstat</span> <span class="token number">7129</span>
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   <span class="token function">free</span>   buff  cache   si   so    bi    bo   <span class="token keyword">in</span>   cs us sy <span class="token function">id</span> wa st
 <span class="token number">1</span>  <span class="token number">0</span>   <span class="token number">6836</span> <span class="token number">737532</span>   <span class="token number">1588</span> <span class="token number">3504956</span>    <span class="token number">0</span>    <span class="token number">0</span>     <span class="token number">1</span>     <span class="token number">4</span>    <span class="token number">5</span>    <span class="token number">3</span>  <span class="token number">0</span>  <span class="token number">0</span> <span class="token number">100</span>  <span class="token number">0</span>  <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å…¶ä¸­ï¼Œ <code>cs</code>  ä¸€åˆ—ä»£è¡¨äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚</p>
<p>ã€è§£å†³æ–¹æ³•ã€‘</p>
<p>å¦‚æœï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¾ˆé¢‘ç¹ï¼Œå¯ä»¥è€ƒè™‘åœ¨åº”ç”¨ä¸­é’ˆå¯¹çº¿ç¨‹è¿›è¡Œä¼˜åŒ–ï¼Œæ–¹æ³•æœ‰ï¼š</p>
<ul>
<li><strong>æ— é”å¹¶å‘</strong>ï¼šå¤šçº¿ç¨‹ç«äº‰æ—¶ï¼Œä¼šå¼•èµ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥å¤šçº¿ç¨‹å¤„ç†æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨ä¸€äº›åŠæ³•æ¥é¿å…ä½¿ç”¨é”ï¼Œå¦‚å°†æ•°æ®çš„ ID æŒ‰ç…§ Hash å–æ¨¡åˆ†æ®µï¼Œä¸åŒçš„çº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ®ï¼›</li>
<li><strong>CAS ç®—æ³•</strong>ï¼šJava çš„ Atomic åŒ…ä½¿ç”¨ CAS ç®—æ³•æ¥æ›´æ–°æ•°æ®ï¼Œè€Œä¸éœ€è¦åŠ é”ï¼›</li>
<li><strong>æœ€å°‘çº¿ç¨‹</strong>ï¼šé¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ä»»åŠ¡å¾ˆå°‘ï¼Œä½†æ˜¯åˆ›å»ºäº†å¾ˆå¤šçº¿ç¨‹æ¥å¤„ç†ï¼Œè¿™æ ·ä¼šé€ æˆå¤§é‡çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ï¼›</li>
<li><strong>ä½¿ç”¨åç¨‹</strong>ï¼šåœ¨å•çº¿ç¨‹é‡Œå®ç°å¤šä»»åŠ¡çš„è°ƒåº¦ï¼Œå¹¶åœ¨å•çº¿ç¨‹é‡Œç»´æŒå¤šä¸ªä»»åŠ¡é—´çš„åˆ‡æ¢ï¼›</li>
</ul>
<h2 id="-975"><a class="markdownIt-Anchor" href="#-975">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E4%B8%89%E3%80%81%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98">#</a>ä¸‰ã€å†…å­˜é—®é¢˜</h2>
<p>å†…å­˜é—®é¢˜è¯Šæ–­èµ·æ¥ç›¸å¯¹æ¯” CPU éº»çƒ¦ä¸€äº›ï¼Œåœºæ™¯ä¹Ÿæ¯”è¾ƒå¤šã€‚ä¸»è¦åŒ…æ‹¬ OOMã€GC é—®é¢˜å’Œå †å¤–å†…å­˜ã€‚ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬ä¼šå…ˆç”¨  <code>free</code>  å‘½ä»¤å…ˆæ¥æ£€æŸ¥ä¸€å‘å†…å­˜çš„å„ç§æƒ…å†µã€‚</p>
<p>è¯Šæ–­å†…å­˜é—®é¢˜ï¼Œä¸€èˆ¬é¦–å…ˆä¼šç”¨  <code>free</code>  å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹æœºå™¨çš„ç‰©ç†å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">free</span>
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:        <span class="token number">8011164</span>     <span class="token number">3767900</span>      <span class="token number">735364</span>        <span class="token number">8804</span>     <span class="token number">3507900</span>     <span class="token number">3898568</span>
Swap:       <span class="token number">5242876</span>        <span class="token number">6836</span>     <span class="token number">5236040</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="-976"><a class="markdownIt-Anchor" href="#-976">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E5%9B%9B%E3%80%81%E7%A3%81%E7%9B%98%E9%97%AE%E9%A2%98">#</a>å››ã€ç£ç›˜é—®é¢˜</h2>
<h3 id="-977"><a class="markdownIt-Anchor" href="#-977">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E7%9C%8B%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E4%BD%BF%E7%94%A8%E7%8E%87">#</a>æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡</h3>
<p>å¯ä»¥ä½¿ç”¨  <code>df -hl</code>  å‘½ä»¤æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">$ df -hl
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        494M     0  494M   0% /dev
tmpfs           504M     0  504M   0% /dev/shm
tmpfs           504M   58M  447M  12% /run
tmpfs           504M     0  504M   0% /sys/fs/cgroup
/dev/sda2        20G  5.7G   13G  31% /
/dev/sda1       380M  142M  218M  40% /boot
tmpfs           101M     0  101M   0% /run/user/0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-978"><a class="markdownIt-Anchor" href="#-978">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E7%9C%8B%E7%A3%81%E7%9B%98%E8%AF%BB%E5%86%99%E6%80%A7%E8%83%BD">#</a>æŸ¥çœ‹ç£ç›˜è¯»å†™æ€§èƒ½</h3>
<p>å¯ä»¥ä½¿ç”¨  <code>iostat</code>  å‘½ä»¤æŸ¥çœ‹ç£ç›˜è¯»å†™æ€§èƒ½ã€‚</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">iostat -d -k -x
Linux 3.10.0-327.el7.x86_64 (elk-server)        03/07/2020      _x86_64_        (4 CPU)

Device:         rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util
sda               0.00     0.14    0.01    1.63     0.42   157.56   193.02     0.00    2.52   11.43    2.48   0.60   0.10
scd0              0.00     0.00    0.00    0.00     0.00     0.00     8.00     0.00    0.27    0.27    0.00   0.27   0.00
dm-0              0.00     0.00    0.01    1.78     0.41   157.56   177.19     0.00    2.46   12.09    2.42   0.59   0.10
dm-1              0.00     0.00    0.00    0.00     0.00     0.00    16.95     0.00    1.04    1.04    0.00   1.02   0.00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="-979"><a class="markdownIt-Anchor" href="#-979">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%9F%A5%E7%9C%8B%E5%85%B7%E4%BD%93%E7%9A%84%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%83%85%E5%86%B5">#</a>æŸ¥çœ‹å…·ä½“çš„æ–‡ä»¶è¯»å†™æƒ…å†µ</h3>
<p>å¯ä»¥ä½¿ç”¨  <code>lsof -p pid</code>  å‘½ä»¤</p>
<h2 id="-980"><a class="markdownIt-Anchor" href="#-980">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E4%BA%94%E3%80%81%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98">#</a>äº”ã€ç½‘ç»œé—®é¢˜</h2>
<h3 id="-981"><a class="markdownIt-Anchor" href="#-981">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5">#</a>æ— æ³•è¿æ¥</h3>
<p>å¯ä»¥é€šè¿‡  <code>ping</code>  å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å¦èƒ½è¿é€šã€‚</p>
<p>é€šè¿‡  <code>netstat -nlp | grep &lt;port&gt;</code>  å‘½ä»¤ï¼ŒæŸ¥çœ‹æœåŠ¡ç«¯å£æ˜¯å¦åœ¨å·¥ä½œã€‚</p>
<h3 id="-982"><a class="markdownIt-Anchor" href="#-982">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E7%BD%91%E7%BB%9C%E8%B6%85%E6%97%B6">#</a>ç½‘ç»œè¶…æ—¶</h3>
<p>ç½‘ç»œè¶…æ—¶é—®é¢˜å¤§éƒ¨åˆ†å‡ºåœ¨åº”ç”¨å±‚é¢ã€‚è¶…æ—¶å¤§ä½“å¯ä»¥åˆ†ä¸ºè¿æ¥è¶…æ—¶å’Œè¯»å†™è¶…æ—¶ï¼ŒæŸäº›ä½¿ç”¨è¿æ¥æ± çš„å®¢æˆ·ç«¯æ¡†æ¶è¿˜ä¼šå­˜åœ¨è·å–è¿æ¥è¶…æ—¶å’Œç©ºé—²è¿æ¥æ¸…ç†è¶…æ—¶ã€‚</p>
<ul>
<li>è¯»å†™è¶…æ—¶ã€‚readTimeout/writeTimeoutï¼Œæœ‰äº›æ¡†æ¶å«åš so_timeout æˆ–è€… socketTimeoutï¼Œå‡æŒ‡çš„æ˜¯æ•°æ®è¯»å†™è¶…æ—¶ã€‚æ³¨æ„è¿™è¾¹çš„è¶…æ—¶å¤§éƒ¨åˆ†æ˜¯æŒ‡é€»è¾‘ä¸Šçš„è¶…æ—¶ã€‚soa çš„è¶…æ—¶æŒ‡çš„ä¹Ÿæ˜¯è¯»è¶…æ—¶ã€‚è¯»å†™è¶…æ—¶ä¸€èˆ¬éƒ½åªé’ˆå¯¹å®¢æˆ·ç«¯è®¾ç½®ã€‚</li>
<li>è¿æ¥è¶…æ—¶ã€‚connectionTimeoutï¼Œå®¢æˆ·ç«¯é€šå¸¸æŒ‡ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„æœ€å¤§æ—¶é—´ã€‚æœåŠ¡ç«¯è¿™è¾¹ connectionTimeout å°±æœ‰äº›äº”èŠ±å…«é—¨äº†ï¼Œjetty ä¸­è¡¨ç¤ºç©ºé—²è¿æ¥æ¸…ç†æ—¶é—´ï¼Œtomcat åˆ™è¡¨ç¤ºè¿æ¥ç»´æŒçš„æœ€å¤§æ—¶é—´ã€‚</li>
<li>å…¶ä»–ã€‚åŒ…æ‹¬è¿æ¥è·å–è¶…æ—¶ connectionAcquireTimeout å’Œç©ºé—²è¿æ¥æ¸…ç†è¶…æ—¶ idleConnectionTimeoutã€‚å¤šç”¨äºä½¿ç”¨è¿æ¥æ± æˆ–é˜Ÿåˆ—çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯æ¡†æ¶ã€‚</li>
</ul>
<p>æˆ‘ä»¬åœ¨è®¾ç½®å„ç§è¶…æ—¶æ—¶é—´ä¸­ï¼Œéœ€è¦ç¡®è®¤çš„æ˜¯å°½é‡ä¿æŒå®¢æˆ·ç«¯çš„è¶…æ—¶å°äºæœåŠ¡ç«¯çš„è¶…æ—¶ï¼Œä»¥ä¿è¯è¿æ¥æ­£å¸¸ç»“æŸã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å…³å¿ƒæœ€å¤šçš„åº”è¯¥æ˜¯æ¥å£çš„è¯»å†™è¶…æ—¶äº†ã€‚</p>
<p>å¦‚ä½•è®¾ç½®åˆç†çš„æ¥å£è¶…æ—¶æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å¦‚æœæ¥å£è¶…æ—¶è®¾ç½®çš„è¿‡é•¿ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šè¿‡å¤šåœ°å ç”¨æœåŠ¡ç«¯çš„ tcp è¿æ¥ã€‚è€Œå¦‚æœæ¥å£è®¾ç½®çš„è¿‡çŸ­ï¼Œé‚£ä¹ˆæ¥å£è¶…æ—¶å°±ä¼šéå¸¸é¢‘ç¹ã€‚</p>
<p>æœåŠ¡ç«¯æ¥å£æ˜æ˜ rt é™ä½ï¼Œä½†å®¢æˆ·ç«¯ä»ç„¶ä¸€ç›´è¶…æ—¶åˆæ˜¯å¦ä¸€ä¸ªé—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆç®€å•ï¼Œå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„é“¾è·¯åŒ…æ‹¬ç½‘ç»œä¼ è¾“ã€æ’é˜Ÿä»¥åŠæœåŠ¡å¤„ç†ç­‰ï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½æ˜¯è€—æ—¶çš„åŸå› ã€‚</p>
<h3 id="-983"><a class="markdownIt-Anchor" href="#-983">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#tcp-%E9%98%9F%E5%88%97%E6%BA%A2%E5%87%BA">#</a>TCP é˜Ÿåˆ—æº¢å‡º</h3>
<p>tcp é˜Ÿåˆ—æº¢å‡ºæ˜¯ä¸ªç›¸å¯¹åº•å±‚çš„é”™è¯¯ï¼Œå®ƒå¯èƒ½ä¼šé€ æˆè¶…æ—¶ã€rst ç­‰æ›´è¡¨å±‚çš„é”™è¯¯ã€‚å› æ­¤é”™è¯¯ä¹Ÿæ›´éšè”½ï¼Œæ‰€ä»¥æˆ‘ä»¬å•ç‹¬è¯´ä¸€è¯´ã€‚ <img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2019-11-04-083827.jpg" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼šsyns queue (åŠè¿æ¥é˜Ÿåˆ—ï¼‰ã€accept queueï¼ˆå…¨è¿æ¥é˜Ÿåˆ—ï¼‰ã€‚ä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨ server æ”¶åˆ° client çš„ syn åï¼ŒæŠŠæ¶ˆæ¯æ”¾åˆ° syns queueï¼Œå›å¤ syn+ack ç»™ clientï¼Œserver æ”¶åˆ° client çš„ ackï¼Œå¦‚æœè¿™æ—¶ accept queue æ²¡æ»¡ï¼Œé‚£å°±ä» syns queue æ‹¿å‡ºæš‚å­˜çš„ä¿¡æ¯æ”¾å…¥ accept queue ä¸­ï¼Œå¦åˆ™æŒ‰ tcp_abort_on_overflow æŒ‡ç¤ºçš„æ‰§è¡Œã€‚</p>
<p>tcp_abort_on_overflow 0 è¡¨ç¤ºå¦‚æœä¸‰æ¬¡æ¡æ‰‹ç¬¬ä¸‰æ­¥çš„æ—¶å€™ accept queue æ»¡äº†é‚£ä¹ˆ server æ‰”æ‰ client å‘è¿‡æ¥çš„ ackã€‚tcp_abort_on_overflow 1 åˆ™è¡¨ç¤ºç¬¬ä¸‰æ­¥çš„æ—¶å€™å¦‚æœå…¨è¿æ¥é˜Ÿåˆ—æ»¡äº†ï¼Œserver å‘é€ä¸€ä¸ª rst åŒ…ç»™ clientï¼Œè¡¨ç¤ºåºŸæ‰è¿™ä¸ªæ¡æ‰‹è¿‡ç¨‹å’Œè¿™ä¸ªè¿æ¥ï¼Œæ„å‘³ç€æ—¥å¿—é‡Œå¯èƒ½ä¼šæœ‰å¾ˆå¤š <code>connection reset / connection reset by peer</code> ã€‚</p>
<p>é‚£ä¹ˆåœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆèƒ½å¿«é€Ÿå®šä½åˆ° tcp é˜Ÿåˆ—æº¢å‡ºå‘¢ï¼Ÿ</p>
<p><strong>netstat å‘½ä»¤ï¼Œæ‰§è¡Œ netstat -s | egrep â€œlisten|LISTENâ€</strong> <img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2019-11-04-83828.jpg" alt="img"> å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œoverflowed è¡¨ç¤ºå…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„æ¬¡æ•°ï¼Œsockets dropped è¡¨ç¤ºåŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„æ¬¡æ•°ã€‚</p>
<p><strong>ss å‘½ä»¤ï¼Œæ‰§è¡Œ ss -lnt</strong> <img src="https://fredal-blog.oss-cn-hangzhou.aliyuncs.com/2019-11-04-083828.jpg" alt="img"> ä¸Šé¢çœ‹åˆ° Send-Q è¡¨ç¤ºç¬¬ä¸‰åˆ—çš„ listen ç«¯å£ä¸Šçš„å…¨è¿æ¥é˜Ÿåˆ—æœ€å¤§ä¸º 5ï¼Œç¬¬ä¸€åˆ— Recv-Q ä¸ºå…¨è¿æ¥é˜Ÿåˆ—å½“å‰ä½¿ç”¨äº†å¤šå°‘ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬çœ‹çœ‹æ€ä¹ˆè®¾ç½®å…¨è¿æ¥ã€åŠè¿æ¥é˜Ÿåˆ—å¤§å°å§ï¼š</p>
<p>å…¨è¿æ¥é˜Ÿåˆ—çš„å¤§å°å–å†³äº min (backlog, somaxconn)ã€‚backlog æ˜¯åœ¨ socket åˆ›å»ºçš„æ—¶å€™ä¼ å…¥çš„ï¼Œsomaxconn æ˜¯ä¸€ä¸ª os çº§åˆ«çš„ç³»ç»Ÿå‚æ•°ã€‚è€ŒåŠè¿æ¥é˜Ÿåˆ—çš„å¤§å°å–å†³äº max (64, /proc/sys/net/ipv4/tcp_max_syn_backlog)ã€‚</p>
<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä½¿ç”¨ servlet å®¹å™¨ä½œä¸ºæœåŠ¡ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿéœ€è¦å…³æ³¨å®¹å™¨çš„è¿æ¥é˜Ÿåˆ—å¤§å°ã€‚åœ¨ tomcat ä¸­ backlog å«åš <code>acceptCount</code> ï¼Œåœ¨ jetty é‡Œé¢åˆ™æ˜¯ <code>acceptQueueSize</code> ã€‚</p>
<h3 id="-984"><a class="markdownIt-Anchor" href="#-984">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#rst-%E5%BC%82%E5%B8%B8">#</a>RST å¼‚å¸¸</h3>
<p>RST åŒ…è¡¨ç¤ºè¿æ¥é‡ç½®ï¼Œç”¨äºå…³é—­ä¸€äº›æ— ç”¨çš„è¿æ¥ï¼Œé€šå¸¸è¡¨ç¤ºå¼‚å¸¸å…³é—­ï¼ŒåŒºåˆ«äºå››æ¬¡æŒ¥æ‰‹ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šçœ‹åˆ° <code>connection reset / connection reset by peer</code>  é”™è¯¯ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯ RST åŒ…å¯¼è‡´çš„ã€‚</p>
<p><strong>ç«¯å£ä¸å­˜åœ¨</strong></p>
<p>å¦‚æœåƒä¸å­˜åœ¨çš„ç«¯å£å‘å‡ºå»ºç«‹è¿æ¥ SYN è¯·æ±‚ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å‘ç°è‡ªå·±å¹¶æ²¡æœ‰è¿™ä¸ªç«¯å£åˆ™ä¼šç›´æ¥è¿”å›ä¸€ä¸ª RST æŠ¥æ–‡ï¼Œç”¨äºä¸­æ–­è¿æ¥ã€‚</p>
<p><strong>ä¸»åŠ¨ä»£æ›¿ FIN ç»ˆæ­¢è¿æ¥</strong></p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ­£å¸¸çš„è¿æ¥å…³é—­éƒ½æ˜¯éœ€è¦é€šè¿‡ FIN æŠ¥æ–‡å®ç°ï¼Œç„¶è€Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ RST æŠ¥æ–‡æ¥ä»£æ›¿ FINï¼Œè¡¨ç¤ºç›´æ¥ç»ˆæ­¢è¿æ¥ã€‚å®é™…å¼€å‘ä¸­ï¼Œå¯è®¾ç½® SO_LINGER æ•°å€¼æ¥æ§åˆ¶ï¼Œè¿™ç§å¾€å¾€æ˜¯æ•…æ„çš„ï¼Œæ¥è·³è¿‡ TIMED_WAITï¼Œæä¾›äº¤äº’æ•ˆç‡ï¼Œä¸é—²å°±æ…ç”¨ã€‚</p>
<p><strong>å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯æœ‰ä¸€è¾¹å‘ç”Ÿäº†å¼‚å¸¸ï¼Œè¯¥æ–¹å‘å¯¹ç«¯å‘é€ RST ä»¥å‘ŠçŸ¥å…³é—­è¿æ¥</strong></p>
<p>æˆ‘ä»¬ä¸Šé¢è®²çš„ tcp é˜Ÿåˆ—æº¢å‡ºå‘é€ RST åŒ…å…¶å®ä¹Ÿæ˜¯å±äºè¿™ä¸€ç§ã€‚è¿™ç§å¾€å¾€æ˜¯ç”±äºæŸäº›åŸå› ï¼Œä¸€æ–¹æ— æ³•å†èƒ½æ­£å¸¸å¤„ç†è¯·æ±‚è¿æ¥äº† (æ¯”å¦‚ç¨‹åºå´©äº†ï¼Œé˜Ÿåˆ—æ»¡äº†)ï¼Œä»è€Œå‘ŠçŸ¥å¦ä¸€æ–¹å…³é—­è¿æ¥ã€‚</p>
<p><strong>æ¥æ”¶åˆ°çš„ TCP æŠ¥æ–‡ä¸åœ¨å·²çŸ¥çš„ TCP è¿æ¥å†…</strong></p>
<p>æ¯”å¦‚ï¼Œä¸€æ–¹æœºå™¨ç”±äºç½‘ç»œå®åœ¨å¤ªå·® TCP æŠ¥æ–‡å¤±è¸ªäº†ï¼Œå¦ä¸€æ–¹å…³é—­äº†è¯¥è¿æ¥ï¼Œç„¶åè¿‡äº†è®¸ä¹…æ”¶åˆ°äº†ä¹‹å‰å¤±è¸ªçš„ TCP æŠ¥æ–‡ï¼Œä½†ç”±äºå¯¹åº”çš„ TCP è¿æ¥å·²ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šç›´æ¥å‘ä¸€ä¸ª RST åŒ…ä»¥ä¾¿å¼€å¯æ–°çš„è¿æ¥ã€‚</p>
<p><strong>ä¸€æ–¹é•¿æœŸæœªæ”¶åˆ°å¦ä¸€æ–¹çš„ç¡®è®¤æŠ¥æ–‡ï¼Œåœ¨ä¸€å®šæ—¶é—´æˆ–é‡ä¼ æ¬¡æ•°åå‘å‡º RST æŠ¥æ–‡</strong></p>
<p>è¿™ç§å¤§å¤šä¹Ÿå’Œç½‘ç»œç¯å¢ƒç›¸å…³äº†ï¼Œç½‘ç»œç¯å¢ƒå·®å¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„ RST æŠ¥æ–‡ã€‚</p>
<p>ä¹‹å‰è¯´è¿‡ RST æŠ¥æ–‡å¤šä¼šå¯¼è‡´ç¨‹åºæŠ¥é”™ï¼Œåœ¨ä¸€ä¸ªå·²å…³é—­çš„è¿æ¥ä¸Šè¯»æ“ä½œä¼šæŠ¥ <code>connection reset</code> ï¼Œè€Œåœ¨ä¸€ä¸ªå·²å…³é—­çš„è¿æ¥ä¸Šå†™æ“ä½œåˆ™ä¼šæŠ¥ <code>connection reset by peer</code> ã€‚é€šå¸¸æˆ‘ä»¬å¯èƒ½è¿˜ä¼šçœ‹åˆ° <code>broken pipe</code>  é”™è¯¯ï¼Œè¿™æ˜¯ç®¡é“å±‚é¢çš„é”™è¯¯ï¼Œè¡¨ç¤ºå¯¹å·²å…³é—­çš„ç®¡é“è¿›è¡Œè¯»å†™ï¼Œå¾€å¾€æ˜¯åœ¨æ”¶åˆ° RSTï¼ŒæŠ¥å‡º <code>connection reset</code>  é”™åç»§ç»­è¯»å†™æ•°æ®æŠ¥çš„é”™ï¼Œè¿™ä¸ªåœ¨ glibc æºç æ³¨é‡Šä¸­ä¹Ÿæœ‰ä»‹ç»ã€‚</p>
<p>æˆ‘ä»¬åœ¨è¯Šæ–­æ•…éšœæ—¶å€™æ€ä¹ˆç¡®å®šæœ‰ RST åŒ…çš„å­˜åœ¨å‘¢ï¼Ÿå½“ç„¶æ˜¯ä½¿ç”¨ tcpdump å‘½ä»¤è¿›è¡ŒæŠ“åŒ…ï¼Œå¹¶ä½¿ç”¨ wireshark è¿›è¡Œç®€å•åˆ†æäº†ã€‚ <code>tcpdump -i en0 tcp -w xxx.cap</code> ï¼Œen0 è¡¨ç¤ºç›‘å¬çš„ç½‘å¡ã€‚ <img src="https://fredal-blog.oss-cn-hangzhou.aliyuncs.com/2019-11-04-083829.jpg" alt="img"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ wireshark æ‰“å¼€æŠ“åˆ°çš„åŒ…ï¼Œå¯èƒ½å°±èƒ½çœ‹åˆ°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œçº¢è‰²çš„å°±è¡¨ç¤º RST åŒ…äº†ã€‚ <img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2019-11-04-083830.jpg" alt="img"></p>
<h3 id="-985"><a class="markdownIt-Anchor" href="#-985">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#time-wait-%E5%92%8C-close-wait">#</a>TIME_WAIT å’Œ CLOSE_WAIT</h3>
<p>TIME_WAIT å’Œ CLOSE_WAIT æ˜¯å•¥æ„æ€ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ã€‚ åœ¨çº¿ä¸Šæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨å‘½ä»¤ <code>netstat -n | awk '/^tcp/ &#123;++S[$NF]&#125; END &#123;for(a in S) print a, S[a]&#125;'</code>  æ¥æŸ¥çœ‹ time-wait å’Œ close_wait çš„æ•°é‡</p>
<p>ç”¨ ss å‘½ä»¤ä¼šæ›´å¿« <code>ss -ant | awk '&#123;++S[$1]&#125; END &#123;for(a in S) print a, S[a]&#125;'</code></p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2019-11-04-083830.png" alt="img"></p>
<h4 id="-986"><a class="markdownIt-Anchor" href="#-986">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#time-wait">#</a>TIME_WAIT</h4>
<p>time_wait çš„å­˜åœ¨ä¸€æ˜¯ä¸ºäº†ä¸¢å¤±çš„æ•°æ®åŒ…è¢«åé¢è¿æ¥å¤ç”¨ï¼ŒäºŒæ˜¯ä¸ºäº†åœ¨ 2MSL çš„æ—¶é—´èŒƒå›´å†…æ­£å¸¸å…³é—­è¿æ¥ã€‚å®ƒçš„å­˜åœ¨å…¶å®ä¼šå¤§å¤§å‡å°‘ RST åŒ…çš„å‡ºç°ã€‚</p>
<p>è¿‡å¤šçš„ time_wait åœ¨çŸ­è¿æ¥é¢‘ç¹çš„åœºæ™¯æ¯”è¾ƒå®¹æ˜“å‡ºç°ã€‚è¿™ç§æƒ…å†µå¯ä»¥åœ¨æœåŠ¡ç«¯åšä¸€äº›å†…æ ¸å‚æ•°è°ƒä¼˜:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">#è¡¨ç¤ºå¼€å¯é‡ç”¨ã€‚å…è®¸å°†TIME<span class="token operator">-</span>WAIT socketsé‡æ–°ç”¨äºæ–°çš„TCPè¿æ¥ï¼Œé»˜è®¤ä¸º<span class="token number">0</span>ï¼Œè¡¨ç¤ºå…³é—­
net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span>
#è¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME<span class="token operator">-</span>WAIT socketsçš„å¿«é€Ÿå›æ”¶ï¼Œé»˜è®¤ä¸º<span class="token number">0</span>ï¼Œè¡¨ç¤ºå…³é—­
net<span class="token punctuation">.</span>ipv4<span class="token punctuation">.</span>tcp_tw_recycle <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>å½“ç„¶æˆ‘ä»¬ä¸è¦å¿˜è®°åœ¨ NAT ç¯å¢ƒä¸‹å› ä¸ºæ—¶é—´æˆ³é”™ä¹±å¯¼è‡´æ•°æ®åŒ…è¢«æ‹’ç»çš„å‘äº†ï¼Œå¦å¤–çš„åŠæ³•å°±æ˜¯æ”¹å° <code>tcp_max_tw_buckets</code> ï¼Œè¶…è¿‡è¿™ä¸ªæ•°çš„ time_wait éƒ½ä¼šè¢«å¹²æ‰ï¼Œä¸è¿‡è¿™ä¹Ÿä¼šå¯¼è‡´æŠ¥ <code>time wait bucket table overflow</code>  çš„é”™ã€‚</p>
<h4 id="-987"><a class="markdownIt-Anchor" href="#-987">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#close-wait">#</a>CLOSE_WAIT</h4>
<p>close_wait å¾€å¾€éƒ½æ˜¯å› ä¸ºåº”ç”¨ç¨‹åºå†™çš„æœ‰é—®é¢˜ï¼Œæ²¡æœ‰åœ¨ ACK åå†æ¬¡å‘èµ· FIN æŠ¥æ–‡ã€‚close_wait å‡ºç°çš„æ¦‚ç‡ç”šè‡³æ¯” time_wait è¦æ›´é«˜ï¼Œåæœä¹Ÿæ›´ä¸¥é‡ã€‚å¾€å¾€æ˜¯ç”±äºæŸä¸ªåœ°æ–¹é˜»å¡ä½äº†ï¼Œæ²¡æœ‰æ­£å¸¸å…³é—­è¿æ¥ï¼Œä»è€Œæ¸æ¸åœ°æ¶ˆè€—å®Œæ‰€æœ‰çš„çº¿ç¨‹ã€‚</p>
<p>æƒ³è¦å®šä½è¿™ç±»é—®é¢˜ï¼Œæœ€å¥½æ˜¯é€šè¿‡ jstack æ¥åˆ†æçº¿ç¨‹å †æ ˆæ¥è¯Šæ–­é—®é¢˜ï¼Œå…·ä½“å¯å‚è€ƒä¸Šè¿°ç« èŠ‚ã€‚è¿™é‡Œä»…ä¸¾ä¸€ä¸ªä¾‹å­ã€‚</p>
<p>å¼€å‘åŒå­¦è¯´åº”ç”¨ä¸Šçº¿å CLOSE_WAIT å°±ä¸€ç›´å¢å¤šï¼Œç›´åˆ°æŒ‚æ‰ä¸ºæ­¢ï¼Œjstack åæ‰¾åˆ°æ¯”è¾ƒå¯ç–‘çš„å †æ ˆæ˜¯å¤§éƒ¨åˆ†çº¿ç¨‹éƒ½å¡åœ¨äº† <code>countdownlatch.await</code>  æ–¹æ³•ï¼Œæ‰¾å¼€å‘åŒå­¦äº†è§£åå¾—çŸ¥ä½¿ç”¨äº†å¤šçº¿ç¨‹ä½†æ˜¯ç¡®æ²¡æœ‰ catch å¼‚å¸¸ï¼Œä¿®æ”¹åå‘ç°å¼‚å¸¸ä»…ä»…æ˜¯æœ€ç®€å•çš„å‡çº§ sdk åå¸¸å‡ºç°çš„ <code>class not found</code> ã€‚</p>
<h2 id="-988"><a class="markdownIt-Anchor" href="#-988">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E5%85%AD%E3%80%81gc-%E9%97%AE%E9%A2%98">#</a>å…­ã€GC é—®é¢˜</h2>
<p>GC é—®é¢˜é™¤äº†å½±å“ CPU ä¹Ÿä¼šå½±å“å†…å­˜ï¼Œè¯Šæ–­æ€è·¯ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>ï¼ˆ1ï¼‰é€šå¸¸ï¼Œå…ˆä½¿ç”¨  <code>jstat</code>  æ¥æŸ¥çœ‹åˆ†ä»£å˜åŒ–æƒ…å†µï¼Œæ¯”å¦‚ <strong>minor gc</strong> æˆ– <strong>full gc</strong> æ¬¡æ•°æ˜¯ä¸æ˜¯å¤ªé¢‘ç¹ã€è€—æ—¶å¤ªä¹…ã€‚</p>
<p>çº¿ç¨‹é‡å¤ªå¤§ï¼Œä¸”ä¸è¢«åŠæ—¶ GC ä¹Ÿä¼šå¼•å‘ OOMï¼Œå¤§éƒ¨åˆ†å°±æ˜¯ä¹‹å‰è¯´çš„  <code>unable to create new native thread</code> ã€‚é™¤äº† jstack ç»†ç»†åˆ†æ dump æ–‡ä»¶å¤–ï¼Œæˆ‘ä»¬ä¸€èˆ¬å…ˆä¼šçœ‹ä¸‹æ€»ä½“çº¿ç¨‹ã€‚</p>
<p>å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¸­ä»»æ„ä¸€ä¸ªï¼Œæ²¡æ¥æŸ¥çœ‹å½“å‰è¿›ç¨‹åˆ›å»ºçš„æ€»çº¿ç¨‹æ•°ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">pstreee -p pid <span class="token operator">|</span> <span class="token function">wc</span> -l
<span class="token function">ls</span> -l /proc/pid/task <span class="token operator">|</span> <span class="token function">wc</span> -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å †å†…å†…å­˜æ³„æ¼æ€»æ˜¯å’Œ GC å¼‚å¸¸ç›¸ä¼´ã€‚ä¸è¿‡ GC é—®é¢˜ä¸åªæ˜¯å’Œå†…å­˜é—®é¢˜ç›¸å…³ï¼Œè¿˜æœ‰å¯èƒ½å¼•èµ· CPU è´Ÿè½½ã€ç½‘ç»œé—®é¢˜ç­‰ç³»åˆ—å¹¶å‘ç—‡ï¼Œåªæ˜¯ç›¸å¯¹æ¥è¯´å’Œå†…å­˜è”ç³»ç´§å¯†äº›ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ­¤å•ç‹¬æ€»ç»“ä¸€ä¸‹ GC ç›¸å…³é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬åœ¨ cpu ç« ä»‹ç»äº†ä½¿ç”¨ jstat æ¥è·å–å½“å‰ GC åˆ†ä»£å˜åŒ–ä¿¡æ¯ã€‚è€Œæ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ GC æ—¥å¿—æ¥è¯Šæ–­é—®é¢˜çš„ï¼Œåœ¨å¯åŠ¨å‚æ•°ä¸­åŠ ä¸Š <code>-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps</code>  æ¥å¼€å¯ GC æ—¥å¿—ã€‚ å¸¸è§çš„ Minor GCã€Full GC æ—¥å¿—å«ä¹‰åœ¨æ­¤å°±ä¸åšèµ˜è¿°äº†ã€‚</p>
<p>é’ˆå¯¹ gc æ—¥å¿—ï¼Œæˆ‘ä»¬å°±èƒ½å¤§è‡´æ¨æ–­å‡º Minor GC ä¸ fullGC æ˜¯å¦è¿‡äºé¢‘ç¹æˆ–è€…è€—æ—¶è¿‡é•¿ï¼Œä»è€Œå¯¹ç—‡ä¸‹è¯ã€‚æˆ‘ä»¬ä¸‹é¢å°†å¯¹ G1 åƒåœ¾æ”¶é›†å™¨æ¥åšåˆ†æï¼Œè¿™è¾¹ä¹Ÿå»ºè®®å¤§å®¶ä½¿ç”¨ G1 <code>-XX:+UseG1GC</code> ã€‚</p>
<h3 id="-989"><a class="markdownIt-Anchor" href="#-989">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#oom">#</a>OOM</h3>
<p>æŸ¥çœ‹ GC æ—¥å¿—ï¼Œå¦‚æœæœ‰æ˜æ˜¾æç¤º OOM é—®é¢˜ï¼Œé‚£å°±å¯ä»¥æ ¹æ®æç¤ºä¿¡æ¯ï¼Œè¾ƒä¸ºå¿«é€Ÿçš„å®šä½é—®é¢˜ã€‚</p>
<blockquote>
<p>OOM å®šä½å¯ä»¥å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/jvm-memory.html#%E4%B8%89OutOfMemoryError">JVM å†…å­˜ç®¡ç† ä¹‹ OutOfMemoryError</a></p>
</blockquote>
<h3 id="-990"><a class="markdownIt-Anchor" href="#-990">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#minor-gc">#</a>Minor GC</h3>
<h4 id="-991"><a class="markdownIt-Anchor" href="#-991">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#minor-gc-%E8%BF%87%E9%A2%91">#</a>Minor GC è¿‡é¢‘</h4>
<p><strong>Minor GC é¢‘ç¹ä¸€èˆ¬æ˜¯çŸ­å‘¨æœŸçš„ Java å°å¯¹è±¡è¾ƒå¤š</strong>ã€‚</p>
<p>ï¼ˆ1ï¼‰å…ˆè€ƒè™‘æ˜¯ä¸æ˜¯ Eden åŒº / æ–°ç”Ÿä»£è®¾ç½®çš„å¤ªå°äº†ï¼Œçœ‹èƒ½å¦é€šè¿‡è°ƒæ•´  <code>-Xmnã€-XX:SurvivorRatio</code>  ç­‰å‚æ•°è®¾ç½®æ¥è§£å†³é—®é¢˜ã€‚</p>
<p>ï¼ˆ2ï¼‰å¦‚æœå‚æ•°æ­£å¸¸ï¼Œä½†æ˜¯ Minor GC é¢‘ç‡è¿˜æ˜¯å¤ªé«˜ï¼Œå°±éœ€è¦ä½¿ç”¨  <code>jmap</code>  å’Œ  <code>MAT</code>  å¯¹ dump æ–‡ä»¶è¿›è¡Œè¿›ä¸€æ­¥è¯Šæ–­äº†ã€‚</p>
<h4 id="-992"><a class="markdownIt-Anchor" href="#-992">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#minor-gc-%E8%80%97%E6%97%B6%E8%BF%87%E9%95%BF">#</a>Minor GC è€—æ—¶è¿‡é•¿</h4>
<p>Minor GC è€—æ—¶è¿‡é•¿é—®é¢˜å°±è¦çœ‹ GC æ—¥å¿—é‡Œè€—æ—¶è€—åœ¨å“ªä¸€å—äº†ã€‚</p>
<p>ä»¥ G1 GC æ—¥å¿—ä¸ºä¾‹ï¼Œå¯ä»¥å…³æ³¨ Root Scanningã€Object Copyã€Ref Proc ç­‰é˜¶æ®µã€‚Ref Proc è€—æ—¶é•¿ï¼Œå°±è¦æ³¨æ„å¼•ç”¨ç›¸å…³çš„å¯¹è±¡ã€‚Root Scanning è€—æ—¶é•¿ï¼Œå°±è¦æ³¨æ„çº¿ç¨‹æ•°ã€è·¨ä»£å¼•ç”¨ã€‚Object Copy åˆ™éœ€è¦å…³æ³¨å¯¹è±¡ç”Ÿå­˜å‘¨æœŸã€‚è€Œä¸”è€—æ—¶åˆ†æå®ƒéœ€è¦æ¨ªå‘æ¯”è¾ƒï¼Œå°±æ˜¯å’Œå…¶ä»–é¡¹ç›®æˆ–è€…æ­£å¸¸æ—¶é—´æ®µçš„è€—æ—¶æ¯”è¾ƒã€‚</p>
<h3 id="-993"><a class="markdownIt-Anchor" href="#-993">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#full-gc-%E8%BF%87%E9%A2%91">#</a>Full GC è¿‡é¢‘</h3>
<p>G1 ä¸­æ›´å¤šçš„è¿˜æ˜¯ mixedGCï¼Œä½† mixedGC å¯ä»¥å’Œ Minor GC æ€è·¯ä¸€æ ·å»è¯Šæ–­ã€‚è§¦å‘ fullGC äº†ä¸€èˆ¬éƒ½ä¼šæœ‰é—®é¢˜ï¼ŒG1 ä¼šé€€åŒ–ä½¿ç”¨ Serial æ”¶é›†å™¨æ¥å®Œæˆåƒåœ¾çš„æ¸…ç†å·¥ä½œï¼Œæš‚åœæ—¶é•¿è¾¾åˆ°ç§’çº§åˆ«ï¼Œå¯ä»¥è¯´æ˜¯åŠè·ªäº†ã€‚</p>
<p>fullGC çš„åŸå› å¯èƒ½åŒ…æ‹¬ä»¥ä¸‹è¿™äº›ï¼Œä»¥åŠå‚æ•°è°ƒæ•´æ–¹é¢çš„ä¸€äº›æ€è·¯ï¼š</p>
<ul>
<li>å¹¶å‘é˜¶æ®µå¤±è´¥ï¼šåœ¨å¹¶å‘æ ‡è®°é˜¶æ®µï¼ŒMixGC ä¹‹å‰è€å¹´ä»£å°±è¢«å¡«æ»¡äº†ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ G1 å°±ä¼šæ”¾å¼ƒæ ‡è®°å‘¨æœŸã€‚è¿™ç§æƒ…å†µï¼Œå¯èƒ½å°±éœ€è¦å¢åŠ å †å¤§å°ï¼Œæˆ–è€…è°ƒæ•´å¹¶å‘æ ‡è®°çº¿ç¨‹æ•° <code>-XX:ConcGCThreads</code> ã€‚</li>
<li>æ™‹å‡å¤±è´¥ï¼šåœ¨ GC çš„æ—¶å€™æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ä¾›å­˜æ´» / æ™‹å‡å¯¹è±¡ä½¿ç”¨ï¼Œæ‰€ä»¥è§¦å‘äº† Full GCã€‚è¿™æ—¶å€™å¯ä»¥é€šè¿‡ <code>-XX:G1ReservePercent</code>  æ¥å¢åŠ é¢„ç•™å†…å­˜ç™¾åˆ†æ¯”ï¼Œå‡å°‘ <code>-XX:InitiatingHeapOccupancyPercent</code>  æ¥æå‰å¯åŠ¨æ ‡è®°ï¼Œ <code>-XX:ConcGCThreads</code>  æ¥å¢åŠ æ ‡è®°çº¿ç¨‹æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</li>
<li>å¤§å¯¹è±¡åˆ†é…å¤±è´¥ï¼šå¤§å¯¹è±¡æ‰¾ä¸åˆ°åˆé€‚çš„ region ç©ºé—´è¿›è¡Œåˆ†é…ï¼Œå°±ä¼šè¿›è¡Œ fullGCï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥å¢å¤§å†…å­˜æˆ–è€…å¢å¤§ <code>-XX:G1HeapRegionSize</code> ã€‚</li>
<li>ç¨‹åºä¸»åŠ¨æ‰§è¡Œ System.gc ()ï¼šä¸è¦éšä¾¿å†™å°±å¯¹äº†ã€‚</li>
</ul>
<p>å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯åŠ¨å‚æ•°ä¸­é…ç½® <code>-XX:HeapDumpPath=/xxx/dump.hprof</code>  æ¥ dump fullGC ç›¸å…³çš„æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ jinfo æ¥è¿›è¡Œ gc å‰åçš„ dump</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">jinfo <span class="token operator">-</span>flag <span class="token operator">+</span><span class="token class-name">HeapDumpBeforeFullGC</span> pid
jinfo <span class="token operator">-</span>flag <span class="token operator">+</span><span class="token class-name">HeapDumpAfterFullGC</span> pid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>è¿™æ ·å¾—åˆ° 2 ä»½ dump æ–‡ä»¶ï¼Œå¯¹æ¯”åä¸»è¦å…³æ³¨è¢« gc æ‰çš„é—®é¢˜å¯¹è±¡æ¥å®šä½é—®é¢˜ã€‚</p>
<h2 id="-994"><a class="markdownIt-Anchor" href="#-994">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#%E4%B8%83%E3%80%81%E5%B8%B8%E7%94%A8-linux-%E5%91%BD%E4%BB%A4">#</a>ä¸ƒã€å¸¸ç”¨ Linux å‘½ä»¤</h2>
<p>åœ¨æ•…éšœæ’æŸ¥æ—¶ï¼Œæœ‰ä¸€äº› Linux å‘½ä»¤ååˆ†æœ‰ç”¨ï¼Œå»ºè®®æŒæ¡ã€‚</p>
<h3 id="-995"><a class="markdownIt-Anchor" href="#-995">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#top">#</a>top</h3>
<p>top å‘½ä»¤å¯ä»¥å®æ—¶åŠ¨æ€åœ°æŸ¥çœ‹ç³»ç»Ÿçš„æ•´ä½“è¿è¡Œæƒ…å†µï¼Œæ˜¯ä¸€ä¸ªç»¼åˆäº†å¤šæ–¹ä¿¡æ¯ç›‘æµ‹ç³»ç»Ÿæ€§èƒ½å’Œè¿è¡Œä¿¡æ¯çš„å®ç”¨å·¥å…·ã€‚</p>
<p>é€šå¸¸ï¼Œä¼šä½¿ç”¨  <code>top -Hp pid</code>  æŸ¥çœ‹å…·ä½“çº¿ç¨‹ä½¿ç”¨ç³»ç»Ÿèµ„æºæƒ…å†µã€‚</p>
<blockquote>
<p>å‘½ä»¤è¯¦æƒ…å‚è€ƒï¼š<a target="_blank" rel="noopener" href="http://man.linuxde.net/top">http://man.linuxde.net/top</a></p>
</blockquote>
<h3 id="-996"><a class="markdownIt-Anchor" href="#-996">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/jvm/trouble-shooting.html#vmstat">#</a>vmstat</h3>
<p>vmstat æ˜¯ä¸€æ¬¾æŒ‡å®šé‡‡æ ·å‘¨æœŸå’Œæ¬¡æ•°çš„åŠŸèƒ½æ€§ç›‘æµ‹å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¸ä»…å¯ä»¥ç»Ÿè®¡å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œè¿˜å¯ä»¥è§‚æµ‹åˆ° CPU çš„ä½¿ç”¨ç‡ã€swap çš„ä½¿ç”¨æƒ…å†µã€‚ä½† vmstat ä¸€èˆ¬å¾ˆå°‘ç”¨æ¥æŸ¥çœ‹å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œè€Œæ˜¯ç»å¸¸è¢«ç”¨æ¥è§‚å¯Ÿè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p>
<ul>
<li>rï¼šç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ•°ï¼›</li>
<li>bï¼šå¤„äºéä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•°ï¼›</li>
<li>swpdï¼šè™šæ‹Ÿå†…å­˜ä½¿ç”¨æƒ…å†µï¼›</li>
<li>freeï¼šç©ºé—²çš„å†…å­˜ï¼›</li>
<li>buffï¼šç”¨æ¥ä½œä¸ºç¼“å†²çš„å†…å­˜æ•°ï¼›</li>
<li>siï¼šä»ç£ç›˜äº¤æ¢åˆ°å†…å­˜çš„äº¤æ¢é¡µæ•°é‡ï¼›</li>
<li>soï¼šä»å†…å­˜äº¤æ¢åˆ°ç£ç›˜çš„äº¤æ¢é¡µæ•°é‡ï¼›</li>
<li>biï¼šå‘é€åˆ°å—è®¾å¤‡çš„å—æ•°ï¼›</li>
<li>boï¼šä»å—è®¾å¤‡æ¥æ”¶åˆ°çš„å—æ•°ï¼›</li>
<li>inï¼šæ¯ç§’ä¸­æ–­æ•°ï¼›</li>
<li>csï¼šæ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼›</li>
<li>usï¼šç”¨æˆ· CPU ä½¿ç”¨æ—¶é—´ï¼›</li>
<li>syï¼šå†…æ ¸ CPU ç³»ç»Ÿä½¿ç”¨æ—¶é—´ï¼›</li>
<li>idï¼šç©ºé—²æ—¶é—´ï¼›</li>
<li>waï¼šç­‰å¾… I/O æ—¶é—´ï¼›</li>
<li>stï¼šè¿è¡Œè™šæ‹Ÿæœºçªƒå–çš„æ—¶é—´ã€‚</li>
</ul>
<hr>
<h1 id="é¢è¯•é¢˜"><a class="markdownIt-Anchor" href="#é¢è¯•é¢˜">#</a> é¢è¯•é¢˜</h1>
<h2 id="åŸºç¡€"><a class="markdownIt-Anchor" href="#åŸºç¡€">#</a> åŸºç¡€</h2>
<h3 id="-997"><a class="markdownIt-Anchor" href="#-997">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B7%A5%E5%85%B7%E7%B1%BB">#</a>å·¥å…·ç±»</h3>
<h4 id="-998"><a class="markdownIt-Anchor" href="#-998">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#string">#</a>String</h4>
<blockquote>
<p>String ç±»èƒ½è¢«ç»§æ‰¿å—ï¼Ÿ</p>
<p>Stringï¼ŒStringBufferï¼ŒStringBuilder çš„åŒºåˆ«ã€‚</p>
</blockquote>
<p>String ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚å› ä¸ºå…¶è¢« final ä¿®é¥°ï¼Œæ‰€ä»¥æ— æ³•è¢«ç»§æ‰¿ã€‚</p>
<p>StringBufferï¼ŒStringBuilder æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ append æ¯” String æ•ˆç‡é«˜ã€‚å› ä¸º String ä¼šéšå¼ new String å¯¹è±¡ã€‚</p>
<p>StringBuffer ä¸»è¦æ–¹æ³•éƒ½ç”¨ synchronized ä¿®é¥°ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è€Œ StringBuilder ä¸æ˜¯ã€‚</p>
<h3 id="-999"><a class="markdownIt-Anchor" href="#-999">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1">#</a>é¢å‘å¯¹è±¡</h3>
<blockquote>
<p>æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«ï¼Ÿ</p>
<p>ç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªç±»ä¹ˆï¼Ÿæ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ä¹ˆï¼Ÿç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆï¼Ÿ</p>
</blockquote>
<p>ç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚æ¥å£å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ã€‚</p>
<blockquote>
<p>ç»§æ‰¿å’Œèšåˆçš„åŒºåˆ«åœ¨å“ªï¼Ÿ</p>
</blockquote>
<p>ä¸€èˆ¬ï¼Œèƒ½ç”¨èšåˆå°±åˆ«ç”¨ç»§æ‰¿ã€‚</p>
<h3 id="-1000"><a class="markdownIt-Anchor" href="#-1000">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%8F%8D%E5%B0%84">#</a>åå°„</h3>
<h4 id="-1001"><a class="markdownIt-Anchor" href="#-1001">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B">#</a>â­ åˆ›å»ºå®ä¾‹</h4>
<blockquote>
<p>åå°„åˆ›å»ºå®ä¾‹æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</p>
</blockquote>
<p>é€šè¿‡åå°„æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>ç”¨  <code>Class</code>  å¯¹è±¡çš„  <code>newInstance</code>  æ–¹æ³•ã€‚</li>
<li>ç”¨  <code>Constructor</code>  å¯¹è±¡çš„  <code>newInstance</code>  æ–¹æ³•ã€‚</li>
</ul>
<h4 id="-1002"><a class="markdownIt-Anchor" href="#-1002">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-%E5%8A%A0%E8%BD%BD%E5%AE%9E%E4%BE%8B">#</a>â­ åŠ è½½å®ä¾‹</h4>
<blockquote>
<p>åŠ è½½å®ä¾‹æœ‰å‡ ç§æ–¹å¼ï¼Ÿ</p>
<p>Class.forName (â€œclassNameâ€) å’Œ ClassLoader.laodClass (â€œclassNameâ€) æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
</blockquote>
<ul>
<li><code>Class.forName(&quot;className&quot;)</code>  åŠ è½½çš„æ˜¯å·²ç»åˆå§‹åŒ–åˆ° JVM ä¸­çš„ç±»ã€‚</li>
<li><code>ClassLoader.laodClass(&quot;className&quot;)</code>  è£…è½½çš„æ˜¯è¿˜æ²¡æœ‰åˆå§‹åŒ–åˆ° JVM ä¸­çš„ç±»ã€‚</li>
</ul>
<h4 id="-1003"><a class="markdownIt-Anchor" href="#-1003">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">#</a>â­â­ åŠ¨æ€ä»£ç†</h4>
<blockquote>
<p>åŠ¨æ€ä»£ç†æœ‰å‡ ç§å®ç°æ–¹å¼ï¼Ÿæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</p>
<p>JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
</blockquote>
<p>ï¼ˆ1ï¼‰JDK æ–¹å¼</p>
<p>ä»£ç†ç±»ä¸å§”æ‰˜ç±»å®ç°åŒä¸€æ¥å£ï¼Œä¸»è¦æ˜¯é€šè¿‡ä»£ç†ç±»å®ç°  <code>InvocationHandler</code>  å¹¶é‡å†™  <code>invoke</code>  æ–¹æ³•æ¥è¿›è¡ŒåŠ¨æ€ä»£ç†çš„ï¼Œåœ¨  <code>invoke</code>  æ–¹æ³•ä¸­å°†å¯¹æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p>
<p>JDK åŠ¨æ€ä»£ç†ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç›¸å¯¹äºé™æ€ä»£ç†æ¨¡å¼ï¼Œä¸éœ€è¦ç¡¬ç¼–ç æ¥å£ï¼Œä»£ç å¤ç”¨ç‡é«˜ã€‚</li>
<li>ç¼ºç‚¹ï¼šå¼ºåˆ¶è¦æ±‚ä»£ç†ç±»å®ç°  <code>InvocationHandler</code>  æ¥å£ã€‚</li>
</ul>
<p>ï¼ˆ2ï¼‰CGLIB</p>
<p>CGLIB åº•å±‚ï¼Œå…¶å®æ˜¯å€ŸåŠ©äº† ASM è¿™ä¸ªå¼ºå¤§çš„ Java å­—èŠ‚ç æ¡†æ¶å»è¿›è¡Œå­—èŠ‚ç å¢å¼ºæ“ä½œã€‚</p>
<p>CGLIB åŠ¨æ€ä»£ç†ç‰¹ç‚¹ï¼š</p>
<p>ä¼˜ç‚¹ï¼šä½¿ç”¨å­—èŠ‚ç å¢å¼ºï¼Œæ¯” JDK åŠ¨æ€ä»£ç†æ–¹å¼æ€§èƒ½é«˜ã€‚å¯ä»¥åœ¨è¿è¡Œæ—¶å¯¹ç±»æˆ–è€…æ˜¯æ¥å£è¿›è¡Œå¢å¼ºæ“ä½œï¼Œä¸”å§”æ‰˜ç±»æ— éœ€å®ç°æ¥å£ã€‚</p>
<p>ç¼ºç‚¹ï¼šä¸èƒ½å¯¹  <code>final</code>  ç±»ä»¥åŠ  <code>final</code>  æ–¹æ³•è¿›è¡Œä»£ç†ã€‚</p>
<h3 id="-1004"><a class="markdownIt-Anchor" href="#-1004">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#jdk8">#</a>JDK8</h3>
<h3 id="-1005"><a class="markdownIt-Anchor" href="#-1005">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%85%B6%E4%BB%96">#</a>å…¶ä»–</h3>
<h4 id="-1006"><a class="markdownIt-Anchor" href="#-1006">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-hashcode">#</a>â­ hashcode</h4>
<blockquote>
<p>æœ‰ <code>==</code>  è¿ç®—ç¬¦äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ equals å•Šï¼Ÿ</p>
<p>è¯´ä¸€è¯´ä½ å¯¹ java.lang.Object å¯¹è±¡ä¸­ hashCode å’Œ equals æ–¹æ³•çš„ç†è§£ã€‚åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€ è¦é‡æ–°å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<p>æœ‰æ²¡æœ‰å¯èƒ½ 2 ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡æœ‰ç›¸åŒçš„ hashcode</p>
</blockquote>
<p>ï¼ˆ1ï¼‰æœ‰ <code>==</code>  è¿ç®—ç¬¦äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ equals å•Šï¼Ÿ</p>
<p>equals ç­‰ä»·äº <code>==</code> , è€Œ <code>==</code>  è¿ç®—ç¬¦æ˜¯åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå³ä»–ä»¬çš„<strong>åœ°å€æ˜¯å¦ç›¸ç­‰</strong>ã€‚è€Œè¦†å†™ equals æ›´å¤šçš„æ˜¯è¿½æ±‚ä¸¤ä¸ªå¯¹è±¡åœ¨<strong>é€»è¾‘ä¸Šçš„ç›¸ç­‰</strong>ï¼Œä½ å¯ä»¥è¯´æ˜¯<strong>å€¼ç›¸ç­‰</strong>ï¼Œä¹Ÿå¯è¯´æ˜¯<strong>å†…å®¹ç›¸ç­‰</strong>ã€‚</p>
<p>ï¼ˆ2ï¼‰è¯´ä¸€è¯´ä½ å¯¹ java.lang.Object å¯¹è±¡ä¸­ hashCode å’Œ equals æ–¹æ³•çš„ç†è§£ã€‚åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€ è¦é‡æ–°å®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<p>åœ¨é›†åˆæŸ¥æ‰¾æ—¶ï¼Œhashcode èƒ½å¤§å¤§é™ä½å¯¹è±¡æ¯”è¾ƒæ¬¡æ•°ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡ï¼</p>
<p>ï¼ˆ3ï¼‰æœ‰æ²¡æœ‰å¯èƒ½ 2 ä¸ªä¸ç›¸ç­‰çš„å¯¹è±¡æœ‰ç›¸åŒçš„ hashcode</p>
<p>æœ‰å¯èƒ½ã€‚</p>
<ul>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ equalsï¼ŒJava è¿è¡Œæ—¶ç¯å¢ƒä¼šè®¤ä¸ºä»–ä»¬çš„ hashcode ä¸€å®šç›¸ç­‰ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸ equalsï¼Œä»–ä»¬çš„ hashcode æœ‰å¯èƒ½ç›¸ç­‰ã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ hashcode ç›¸ç­‰ï¼Œä»–ä»¬ä¸ä¸€å®š equalsã€‚</li>
<li>å¦‚æœä¸¤ä¸ªå¯¹è±¡ hashcode ä¸ç›¸ç­‰ï¼Œä»–ä»¬ä¸€å®šä¸ equalsã€‚</li>
</ul>
<h2 id="-1007"><a class="markdownIt-Anchor" href="#-1007">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#io">#</a>IO</h2>
<h3 id="-1008"><a class="markdownIt-Anchor" href="#-1008">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#nio">#</a>NIO</h3>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ NIOï¼Ÿ</p>
<p>NIO å’Œ BIOã€AIO æœ‰ä½•å·®åˆ«ï¼Ÿ</p>
</blockquote>
<h3 id="-1009"><a class="markdownIt-Anchor" href="#-1009">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%BA%8F%E5%88%97%E5%8C%96">#</a>åºåˆ—åŒ–</h3>
<h4 id="-1010"><a class="markdownIt-Anchor" href="#-1010">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-%E5%BA%8F%E5%88%97%E5%8C%96%E9%97%AE%E9%A2%98">#</a>â­ åºåˆ—åŒ–é—®é¢˜</h4>
<blockquote>
<p>åºåˆ—åŒ–ã€ååºåˆ—åŒ–æœ‰å“ªäº›é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</p>
</blockquote>
<p>Java çš„åºåˆ—åŒ–èƒ½ä¿è¯å¯¹è±¡çŠ¶æ€çš„æŒä¹…ä¿å­˜ï¼Œä½†æ˜¯é‡åˆ°ä¸€äº›å¯¹è±¡ç»“æ„å¤æ‚çš„æƒ…å†µè¿˜æ˜¯éš¾ä»¥å¤„ç†ï¼Œè¿™é‡Œå½’çº³ä¸€ä¸‹ï¼š</p>
<ul>
<li>å½“çˆ¶ç±»ç»§æ‰¿  <code>Serializable</code>  æ¥å£æ—¶ï¼Œæ‰€æœ‰å­ç±»éƒ½å¯ä»¥è¢«åºåˆ—åŒ–ã€‚</li>
<li>å­ç±»å®ç°äº†  <code>Serializable</code>  æ¥å£ï¼Œçˆ¶ç±»æ²¡æœ‰ï¼Œåˆ™çˆ¶ç±»çš„å±æ€§ä¸ä¼šè¢«åºåˆ—åŒ–ï¼ˆä¸æŠ¥é”™ï¼Œæ•°æ®ä¸¢å¤±ï¼‰ï¼Œå­ç±»çš„å±æ€§ä»å¯ä»¥æ­£ç¡®åºåˆ—åŒ–ã€‚</li>
<li>å¦‚æœåºåˆ—åŒ–çš„å±æ€§æ˜¯å¯¹è±¡ï¼Œåˆ™è¿™ä¸ªå¯¹è±¡ä¹Ÿå¿…é¡»å®ç°  <code>Serializable</code>  æ¥å£ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li>
<li>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœå¯¹è±¡çš„å±æ€§æœ‰ä¿®æ”¹æˆ–åˆ å‡ï¼Œåˆ™ä¿®æ”¹çš„éƒ¨åˆ†å±æ€§ä¼šä¸¢å¤±ï¼Œä½†ä¸ä¼šæŠ¥é”™ã€‚</li>
<li>åœ¨ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœ  <code>serialVersionUID</code>  è¢«ä¿®æ”¹ï¼Œåˆ™ååºåˆ—åŒ–æ—¶ä¼šå¤±è´¥ã€‚</li>
</ul>
<h2 id="-1011"><a class="markdownIt-Anchor" href="#-1011">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%AE%B9%E5%99%A8">#</a>å®¹å™¨</h2>
<h3 id="-1012"><a class="markdownIt-Anchor" href="#-1012">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#list">#</a>List</h3>
<h4 id="-1013"><a class="markdownIt-Anchor" href="#-1013">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#arraylist-%E5%92%8C-linkedlist-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB">#</a>ArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h4>
<p>ArrayList æ˜¯æ•°ç»„é“¾è¡¨ï¼Œè®¿é—®æ•ˆç‡æ›´é«˜ã€‚</p>
<p>LinkedList æ˜¯åŒé“¾è¡¨ï¼Œæ•°æ®æœ‰åºå­˜å‚¨ã€‚</p>
<h3 id="-1014"><a class="markdownIt-Anchor" href="#-1014">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#map">#</a>Map</h3>
<p>è¯·æè¿° HashMap çš„å®ç°åŸç†ï¼Ÿ</p>
<h2 id="-1015"><a class="markdownIt-Anchor" href="#-1015">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B9%B6%E5%8F%91">#</a>å¹¶å‘</h2>
<h3 id="-1016"><a class="markdownIt-Anchor" href="#-1016">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B">#</a>å¹¶å‘ç®€ä»‹</h3>
<h4 id="-1017"><a class="markdownIt-Anchor" href="#-1017">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%BB%80%E4%B9%88%E6%98%AF%E8%BF%9B%E7%A8%8B-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB">#</a>ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</h4>
<ul>
<li>ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ
<ul>
<li>ç®€è¨€ä¹‹ï¼Œè¿›ç¨‹å¯è§†ä¸ºä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚</li>
<li>è¿›ç¨‹æ˜¯å…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ã€‚è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ã€‚</li>
</ul>
</li>
<li>ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ
<ul>
<li>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚</li>
</ul>
</li>
<li>è¿›ç¨‹ vs. çº¿ç¨‹
<ul>
<li>ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</li>
<li>çº¿ç¨‹æ¯”è¿›ç¨‹åˆ’åˆ†æ›´ç»†ï¼Œæ‰€ä»¥æ‰§è¡Œå¼€é”€æ›´å°ï¼Œå¹¶å‘æ€§æ›´é«˜ã€‚</li>
<li>è¿›ç¨‹æ˜¯ä¸€ä¸ªå®ä½“ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„èµ„æºï¼›è€ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¿›ç¨‹çš„èµ„æºã€‚</li>
</ul>
</li>
</ul>
<h4 id="-1018"><a class="markdownIt-Anchor" href="#-1018">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B9%B6%E5%8F%91-%E5%A4%9A%E7%BA%BF%E7%A8%8B-%E7%BC%96%E7%A8%8B%E7%9A%84%E5%A5%BD%E5%A4%84%E6%98%AF%E4%BB%80%E4%B9%88">#</a>å¹¶å‘ï¼ˆå¤šçº¿ç¨‹ï¼‰ç¼–ç¨‹çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li>æ›´æœ‰æ•ˆç‡çš„åˆ©ç”¨å¤šå¤„ç†å™¨æ ¸å¿ƒ</li>
<li>æ›´å¿«çš„å“åº”æ—¶é—´</li>
<li>æ›´å¥½çš„ç¼–ç¨‹æ¨¡å‹</li>
</ul>
<h4 id="-1019"><a class="markdownIt-Anchor" href="#-1019">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B9%B6%E5%8F%91%E4%B8%80%E5%AE%9A%E6%AF%94%E4%B8%B2%E8%A1%8C%E6%9B%B4%E5%BF%AB%E5%90%97">#</a>å¹¶å‘ä¸€å®šæ¯”ä¸²è¡Œæ›´å¿«å—ï¼Ÿ</h4>
<p>ç­”ï¼šå¦ã€‚</p>
<p>è¦ç‚¹ï¼š<strong>åˆ›å»ºçº¿ç¨‹å’Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æœ‰ä¸€å®šå¼€é”€</strong>ã€‚</p>
<p>è¯´æ˜ï¼šå³ä½¿æ˜¯å•æ ¸å¤„ç†å™¨ä¹Ÿæ”¯æŒå¤šçº¿ç¨‹ã€‚CPU é€šè¿‡ç»™æ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´åˆ‡ç‰‡çš„ç®—æ³•æ¥å¾ªç¯æ‰§è¡Œä»»åŠ¡ï¼Œå½“å‰ä»»åŠ¡æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä½†æ˜¯ï¼Œåœ¨åˆ‡æ¢å‰ä¼šä¿æŒä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚æ‰€ä»¥<strong>ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚</p>
<p>å¼•ç”³</p>
<ul>
<li>å¦‚ä½•å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ
<ul>
<li>å°½é‡å°‘ç”¨é”</li>
<li>CAS ç®—æ³•</li>
<li>çº¿ç¨‹æ•°è¦åˆç†</li>
<li>åç¨‹ï¼šåœ¨å•çº¿ç¨‹ä¸­å®ç°å¤šä»»åŠ¡è°ƒåº¦ï¼Œå¹¶åœ¨å•çº¿ç¨‹ä¸­ç»´æŒå¤šä¸ªä»»åŠ¡çš„åˆ‡æ¢</li>
</ul>
</li>
</ul>
<h4 id="-1020"><a class="markdownIt-Anchor" href="#-1020">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%A6%82%E4%BD%95%E8%AE%A9%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%9A%82%E5%81%9C%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4">#</a>å¦‚ä½•è®©æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´ï¼Ÿ</h4>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨  <code>Thread</code>  ç±»çš„ Sleep () æ–¹æ³•è®©çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™å¹¶ä¸ä¼šè®©çº¿ç¨‹ç»ˆæ­¢ï¼Œä¸€æ—¦ä»ä¼‘çœ ä¸­å”¤é†’çº¿ç¨‹ï¼Œçº¿ç¨‹çš„çŠ¶æ€å°†ä¼šè¢«æ”¹å˜ä¸º Runnableï¼Œå¹¶ä¸”æ ¹æ®çº¿ç¨‹è°ƒåº¦ï¼Œå®ƒå°†å¾—åˆ°æ‰§è¡Œã€‚</p>
<h4 id="-1021"><a class="markdownIt-Anchor" href="#-1021">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8-thread-scheduler-%E5%92%8C%E6%97%B6%E9%97%B4%E5%88%86%E7%89%87-time-slicing">#</a>ä»€ä¹ˆæ˜¯çº¿ç¨‹è°ƒåº¦å™¨ (Thread Scheduler) å’Œæ—¶é—´åˆ†ç‰‡ (Time Slicing)ï¼Ÿ</h4>
<p>çº¿ç¨‹è°ƒåº¦å™¨æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»ŸæœåŠ¡ï¼Œå®ƒè´Ÿè´£ä¸º  <code>Runnable</code>  çŠ¶æ€çš„çº¿ç¨‹åˆ†é… CPU æ—¶é—´ã€‚ä¸€æ—¦æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¹¶å¯åŠ¨å®ƒï¼Œå®ƒçš„æ‰§è¡Œä¾¿ä¾èµ–äºçº¿ç¨‹è°ƒåº¦å™¨çš„å®ç°ã€‚</p>
<p>æ—¶é—´åˆ†ç‰‡æ˜¯æŒ‡å°†å¯ç”¨çš„ CPU æ—¶é—´åˆ†é…ç»™å¯ç”¨çš„  <code>Runnable</code>  çº¿ç¨‹çš„è¿‡ç¨‹ã€‚</p>
<p>åˆ†é… CPU æ—¶é—´å¯ä»¥åŸºäºçº¿ç¨‹ä¼˜å…ˆçº§æˆ–è€…çº¿ç¨‹ç­‰å¾…çš„æ—¶é—´ã€‚çº¿ç¨‹è°ƒåº¦å¹¶ä¸å—åˆ° Java è™šæ‹Ÿæœºæ§åˆ¶ï¼Œæ‰€ä»¥ç”±åº”ç”¨ç¨‹åºæ¥æ§åˆ¶å®ƒæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼ˆä¹Ÿå°±æ˜¯è¯´ä¸è¦è®©ä½ çš„ç¨‹åºä¾èµ–äºçº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼‰ã€‚</p>
<h4 id="-1022"><a class="markdownIt-Anchor" href="#-1022">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%9C%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%AD-%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2-context-switching">#</a>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ (context-switching)ï¼Ÿ</h4>
<p>ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯å­˜å‚¨å’Œæ¢å¤ CPU çŠ¶æ€çš„è¿‡ç¨‹ï¼Œå®ƒä½¿å¾—çº¿ç¨‹æ‰§è¡Œèƒ½å¤Ÿä»ä¸­æ–­ç‚¹æ¢å¤æ‰§è¡Œã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå’Œå¤šçº¿ç¨‹ç¯å¢ƒçš„åŸºæœ¬ç‰¹å¾ã€‚</p>
<h4 id="-1023"><a class="markdownIt-Anchor" href="#-1023">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%A6%82%E4%BD%95%E7%A1%AE%E4%BF%9D%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8">#</a>å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4>
<ul>
<li>åŸå­ç±» (atomic concurrent classes)</li>
<li>é”</li>
<li><code>volatile</code>  å…³é”®å­—</li>
<li>ä¸å˜ç±»å’Œçº¿ç¨‹å®‰å…¨ç±»</li>
</ul>
<h4 id="-1024"><a class="markdownIt-Anchor" href="#-1024">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%BB%80%E4%B9%88%E6%98%AF%E6%AD%BB%E9%94%81-deadlock-%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%92%8C%E9%81%BF%E5%85%8D%E6%AD%BB%E9%94%81">#</a>ä»€ä¹ˆæ˜¯æ­»é” (Deadlock)ï¼Ÿå¦‚ä½•åˆ†æå’Œé¿å…æ­»é”ï¼Ÿ</h4>
<p>æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹æ°¸è¿œç›¸äº’é˜»å¡çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µäº§ç”Ÿè‡³å°‘éœ€è¦ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹å’Œä¸¤ä¸ªä»¥ä¸Šçš„èµ„æºã€‚</p>
<p>åˆ†ææ­»é”ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ Java åº”ç”¨ç¨‹åºçš„çº¿ç¨‹è½¬å‚¨ã€‚æˆ‘ä»¬éœ€è¦æ‰¾å‡ºé‚£äº›çŠ¶æ€ä¸º BLOCKED çš„çº¿ç¨‹å’Œä»–ä»¬ç­‰å¾…çš„èµ„æºã€‚æ¯ä¸ªèµ„æºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ idï¼Œç”¨è¿™ä¸ª id æˆ‘ä»¬å¯ä»¥æ‰¾å‡ºå“ªäº›çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†å®ƒçš„å¯¹è±¡é”ã€‚</p>
<p>é¿å…åµŒå¥—é”ï¼Œåªåœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨é”å’Œé¿å…æ— é™æœŸç­‰å¾…æ˜¯é¿å…æ­»é”çš„é€šå¸¸åŠæ³•ã€‚</p>
<h3 id="-1025"><a class="markdownIt-Anchor" href="#-1025">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80">#</a>çº¿ç¨‹åŸºç¡€</h3>
<h4 id="-1026"><a class="markdownIt-Anchor" href="#-1026">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#java-%E7%BA%BF%E7%A8%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E7%8A%B6%E6%80%81-%E5%90%84%E7%8A%B6%E6%80%81%E4%B9%8B%E9%97%B4%E5%A6%82%E4%BD%95%E5%88%87%E6%8D%A2">#</a>Java çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸­æœ‰å“ªäº›çŠ¶æ€ï¼Ÿå„çŠ¶æ€ä¹‹é—´å¦‚ä½•åˆ‡æ¢ï¼Ÿ</h4>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/java-thread_1.png" alt="img"></p>
<p><code>java.lang.Thread.State</code>  ä¸­å®šä¹‰äº† <strong>6</strong> ç§ä¸åŒçš„çº¿ç¨‹çŠ¶æ€ï¼Œåœ¨ç»™å®šçš„ä¸€ä¸ªæ—¶åˆ»ï¼Œçº¿ç¨‹åªèƒ½å¤„äºå…¶ä¸­çš„ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å„çŠ¶æ€çš„è¯´æ˜ï¼Œä»¥åŠçŠ¶æ€é—´çš„è”ç³»ï¼š</p>
<ul>
<li>
<p><strong>å¼€å§‹ï¼ˆNewï¼‰</strong> - è¿˜æ²¡æœ‰è°ƒç”¨  <code>start()</code>  æ–¹æ³•çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€ã€‚</p>
</li>
<li>
<p><strong>å¯è¿è¡Œï¼ˆRunnableï¼‰</strong> - å·²ç»è°ƒç”¨äº†  <code>start()</code>  æ–¹æ³•çš„çº¿ç¨‹çŠ¶æ€ã€‚æ­¤çŠ¶æ€æ„å‘³ç€ï¼Œçº¿ç¨‹å·²ç»å‡†å¤‡å¥½äº†ï¼Œä¸€æ—¦è¢«çº¿ç¨‹è°ƒåº¦å™¨åˆ†é…äº† CPU æ—¶é—´ç‰‡ï¼Œå°±å¯ä»¥è¿è¡Œçº¿ç¨‹ã€‚</p>
</li>
<li>
<p><strong>é˜»å¡ï¼ˆBlockedï¼‰</strong> - é˜»å¡çŠ¶æ€ã€‚çº¿ç¨‹é˜»å¡çš„çº¿ç¨‹çŠ¶æ€ç­‰å¾…ç›‘è§†å™¨é”å®šã€‚å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹æ­£åœ¨ç­‰å¾…ç›‘è§†å™¨é”å®šï¼Œä»¥ä¾¿åœ¨è°ƒç”¨  <code>Object.wait()</code>  ä¹‹åè¾“å…¥åŒæ­¥å— / æ–¹æ³•æˆ–é‡æ–°è¾“å…¥åŒæ­¥å— / æ–¹æ³•ã€‚</p>
</li>
<li>
<p>ç­‰å¾…ï¼ˆWaitingï¼‰</p>
<p>- ç­‰å¾…çŠ¶æ€ã€‚ä¸€ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œæ˜¯ç”±äºæ‰§è¡Œäº† 3 ä¸ªæ–¹æ³•ä¸­çš„ä»»æ„æ–¹æ³•ï¼š</p>
<ul>
<li><code>Object.wait()</code></li>
<li><code>Thread.join()</code></li>
<li><code>LockSupport.park()</code></li>
</ul>
</li>
<li>
<p>å®šæ—¶ç­‰å¾…ï¼ˆTimed waitingï¼‰</p>
<p>- ç­‰å¾…æŒ‡å®šæ—¶é—´çš„çŠ¶æ€ã€‚ä¸€ä¸ªçº¿ç¨‹å¤„äºå®šæ—¶ç­‰å¾…çŠ¶æ€ï¼Œæ˜¯ç”±äºæ‰§è¡Œäº†ä»¥ä¸‹æ–¹æ³•ä¸­çš„ä»»æ„æ–¹æ³•ï¼š</p>
<ul>
<li><code>Thread.sleep(sleeptime)</code></li>
<li><code>Object.wait(timeout)</code></li>
<li><code>Thread.join(timeout)</code></li>
<li><code>LockSupport.parkNanos(timeout)</code></li>
<li><code>LockSupport.parkUntil(timeout)</code></li>
</ul>
</li>
<li>
<p><strong>ç»ˆæ­¢ (Terminated)</strong> - çº¿ç¨‹  <code>run()</code>  æ–¹æ³•æ‰§è¡Œç»“æŸï¼Œæˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†  <code>run()</code>  æ–¹æ³•ï¼Œåˆ™è¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚æ­»äº¡çš„çº¿ç¨‹ä¸å¯å†æ¬¡å¤ç”Ÿã€‚</p>
</li>
</ul>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.w3resource.com/java-tutorial/java-threadclass-methods-and-threadstates.php">Java <code>Thread</code>  Methods and  <code>Thread</code>  States (opens new window)</a>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/pange1991/article/details/53860651">Java çº¿ç¨‹çš„ 5 ç§çŠ¶æ€åŠåˆ‡æ¢ (é€å½»è®²è§£)(opens new window)</a></p>
</blockquote>
<h4 id="-1027"><a class="markdownIt-Anchor" href="#-1027">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E6%9C%89%E5%93%AA%E4%BA%9B%E6%96%B9%E5%BC%8F-%E8%BF%99%E4%BA%9B%E6%96%B9%E6%B3%95%E5%90%84%E8%87%AA%E5%88%A9%E5%BC%8A%E6%98%AF%E4%BB%80%E4%B9%88">#</a>åˆ›å»ºçº¿ç¨‹æœ‰å“ªäº›æ–¹å¼ï¼Ÿè¿™äº›æ–¹æ³•å„è‡ªåˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p>åˆ›å»ºçº¿ç¨‹ä¸»è¦æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<p><strong>1. ç»§æ‰¿  <code>Thread</code>  ç±»</strong></p>
<ul>
<li>å®šä¹‰  <code>Thread</code>  ç±»çš„å­ç±»ï¼Œå¹¶é‡å†™è¯¥ç±»çš„  <code>run()</code>  æ–¹æ³•ï¼Œè¯¥  <code>run()</code>  æ–¹æ³•çš„æ–¹æ³•ä½“å°±ä»£è¡¨äº†çº¿ç¨‹è¦å®Œæˆçš„ä»»åŠ¡ã€‚å› æ­¤æŠŠ  <code>run()</code>  æ–¹æ³•ç§°ä¸ºæ‰§è¡Œä½“ã€‚</li>
<li>åˆ›å»º  <code>Thread</code>  å­ç±»çš„å®ä¾‹ï¼Œå³åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ã€‚</li>
<li>è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„  <code>start()</code>  æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li>
</ul>
<p><strong>2. å®ç°  <code>Runnable</code>  æ¥å£</strong></p>
<ul>
<li>å®šä¹‰  <code>Runnable</code>  æ¥å£çš„å®ç°ç±»ï¼Œå¹¶é‡å†™è¯¥æ¥å£çš„  <code>run()</code>  æ–¹æ³•ï¼Œè¯¥  <code>run()</code>  æ–¹æ³•çš„æ–¹æ³•ä½“åŒæ ·æ˜¯è¯¥çº¿ç¨‹çš„çº¿ç¨‹æ‰§è¡Œä½“ã€‚</li>
<li>åˆ›å»º  <code>Runnable</code>  å®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶ä»¥æ­¤å®ä¾‹ä½œä¸º  <code>Thread</code>  å¯¹è±¡ï¼Œè¯¥  <code>Thread</code>  å¯¹è±¡æ‰æ˜¯çœŸæ­£çš„çº¿ç¨‹å¯¹è±¡ã€‚</li>
<li>è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„ start () æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li>
</ul>
<p><strong>3. é€šè¿‡  <code>Callable</code>  æ¥å£å’Œ  <code>Future</code>  æ¥å£</strong></p>
<ul>
<li>åˆ›å»º  <code>Callable</code>  æ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°  <code>call()</code>  æ–¹æ³•ï¼Œè¯¥  <code>call()</code>  æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå¹¶ä¸”æœ‰è¿”å›å€¼ã€‚</li>
<li>åˆ›å»º  <code>Callable</code>  å®ç°ç±»çš„å®ä¾‹ï¼Œä½¿ç”¨  <code>FutureTask</code>  ç±»æ¥åŒ…è£…  <code>Callable</code>  å¯¹è±¡ï¼Œè¯¥  <code>FutureTask</code>  å¯¹è±¡å°è£…äº†è¯¥  <code>Callable</code>  å¯¹è±¡çš„  <code>call()</code>  æ–¹æ³•çš„è¿”å›å€¼ã€‚</li>
<li>ä½¿ç”¨  <code>FutureTask</code>  å¯¹è±¡ä½œä¸º  <code>Thread</code>  å¯¹è±¡çš„ target åˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚</li>
<li>è°ƒç”¨  <code>FutureTask</code>  å¯¹è±¡çš„  <code>get()</code>  æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼</li>
</ul>
<p>ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ–¹å¼å¯¹æ¯”</p>
<ul>
<li>å®ç°  <code>Runnable</code>  æ¥å£ä¼˜äºç»§æ‰¿  <code>Thread</code>  ç±»ï¼Œå› ä¸ºæ ¹æ®å¼€æ”¾å°é—­åŸåˆ™ â€”â€” å®ç°æ¥å£æ›´ä¾¿äºæ‰©å±•ï¼›</li>
<li>å®ç°  <code>Runnable</code>  æ¥å£çš„çº¿ç¨‹æ²¡æœ‰è¿”å›å€¼ï¼›è€Œä½¿ç”¨  <code>Callable</code>  /  <code>Future</code>  æ–¹å¼å¯ä»¥è®©çº¿ç¨‹æœ‰è¿”å›å€¼ã€‚</li>
</ul>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/longshengguoji/article/details/41126119">Java åˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼åŠå…¶å¯¹æ¯” (opens new window)</a></p>
</blockquote>
<h4 id="-1028"><a class="markdownIt-Anchor" href="#-1028">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%BB%80%E4%B9%88%E6%98%AF-callable-%E5%92%8C-future-%E4%BB%80%E4%B9%88%E6%98%AF-futuretask">#</a>ä»€ä¹ˆæ˜¯  <code>Callable</code>  å’Œ  <code>Future</code> ï¼Ÿä»€ä¹ˆæ˜¯  <code>FutureTask</code> ï¼Ÿ</h4>
<p><strong>ä»€ä¹ˆæ˜¯  <code>Callable</code>  å’Œ  <code>Future</code> ï¼Ÿ</strong></p>
<p>Java 5 åœ¨ concurrency åŒ…ä¸­å¼•å…¥äº†  <code>Callable</code>  æ¥å£ï¼Œå®ƒå’Œ  <code>Runnable</code>  æ¥å£å¾ˆç›¸ä¼¼ï¼Œä½†å®ƒå¯ä»¥è¿”å›ä¸€ä¸ªå¯¹è±¡æˆ–è€…æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p>
<p><code>Callable</code>  æ¥å£ä½¿ç”¨æ³›å‹å»å®šä¹‰å®ƒçš„è¿”å›ç±»å‹ã€‚ <code>Executors</code>  ç±»æä¾›äº†ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•å»åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œ  <code>Callable</code>  å†…çš„ä»»åŠ¡ã€‚ç”±äº  <code>Callable</code>  ä»»åŠ¡æ˜¯å¹¶è¡Œçš„ï¼Œæˆ‘ä»¬å¿…é¡»ç­‰å¾…å®ƒè¿”å›çš„ç»“æœã€‚ <code>Future</code>  å¯¹è±¡ä¸ºæˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚åœ¨çº¿ç¨‹æ± æäº¤  <code>Callable</code>  ä»»åŠ¡åè¿”å›äº†ä¸€ä¸ª  <code>Future</code>  å¯¹è±¡ï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥çŸ¥é“  <code>Callable</code>  ä»»åŠ¡çš„çŠ¶æ€å’Œå¾—åˆ°  <code>Callable</code>  è¿”å›çš„æ‰§è¡Œç»“æœã€‚ <code>Future</code>  æä¾›äº†  <code>get()</code>  æ–¹æ³•è®©æˆ‘ä»¬å¯ä»¥ç­‰å¾…  <code>Callable</code>  ç»“æŸå¹¶è·å–å®ƒçš„æ‰§è¡Œç»“æœã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯  <code>FutureTask</code> ï¼Ÿ</strong></p>
<p><code>FutureTask</code>  æ˜¯  <code>Future</code>  çš„ä¸€ä¸ªåŸºç¡€å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒåŒ  <code>Executors</code>  ä½¿ç”¨å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚é€šå¸¸æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨  <code>FutureTask</code>  ç±»ï¼Œå•å½“æˆ‘ä»¬æ‰“ç®—é‡å†™  <code>Future</code>  æ¥å£çš„ä¸€äº›æ–¹æ³•å¹¶ä¿æŒåŸæ¥åŸºç¡€çš„å®ç°æ˜¯ï¼Œå®ƒå°±å˜å¾—éå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»…ä»…ç»§æ‰¿äºå®ƒå¹¶é‡å†™æˆ‘ä»¬éœ€è¦çš„æ–¹æ³•ã€‚é˜…è¯» Java  <code>FutureTask</code>  ä¾‹å­ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="http://www.cnblogs.com/dolphin0520/p/3949310.html">Java å¹¶å‘ç¼–ç¨‹ï¼šCallableã€Future å’Œ FutureTask (opens new window)</a></p>
</blockquote>
<h4 id="-1029"><a class="markdownIt-Anchor" href="#-1029">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#start-%E5%92%8C-run-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB-%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8-thread-%E7%B1%BB%E7%9A%84-run-%E6%96%B9%E6%B3%95%E4%B9%88">#</a> <code>start()</code>  å’Œ  <code>run()</code>  æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¯ä»¥ç›´æ¥è°ƒç”¨  <code>Thread</code>  ç±»çš„  <code>run()</code>  æ–¹æ³•ä¹ˆï¼Ÿ</h4>
<ul>
<li><code>run()</code>  æ–¹æ³•æ˜¯çº¿ç¨‹çš„æ‰§è¡Œä½“ã€‚</li>
<li><code>start()</code>  æ–¹æ³•è´Ÿè´£å¯åŠ¨çº¿ç¨‹ï¼Œç„¶å JVM ä¼šè®©è¿™ä¸ªçº¿ç¨‹å»æ‰§è¡Œ  <code>run()</code>  æ–¹æ³•ã€‚</li>
</ul>
<p>å¯ä»¥ç›´æ¥è°ƒç”¨  <code>Thread</code>  ç±»çš„  <code>run()</code>  æ–¹æ³•ä¹ˆï¼Ÿ</p>
<ul>
<li>å¯ä»¥ã€‚ä½†æ˜¯å¦‚æœç›´æ¥è°ƒç”¨  <code>Thread</code>  çš„  <code>run()</code>  æ–¹æ³•ï¼Œå®ƒçš„è¡Œä¸ºå°±ä¼šå’Œæ™®é€šçš„æ–¹æ³•ä¸€æ ·ã€‚</li>
<li>ä¸ºäº†åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œå¿…é¡»ä½¿ç”¨  <code>start()</code>  æ–¹æ³•ã€‚</li>
</ul>
<h4 id="-1030"><a class="markdownIt-Anchor" href="#-1030">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#sleep-%E3%80%81yield-%E3%80%81join-%E6%96%B9%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB-%E4%B8%BA%E4%BB%80%E4%B9%88-sleep-%E5%92%8C-yield-%E6%96%B9%E6%B3%95%E6%98%AF%E9%9D%99%E6%80%81-static-%E7%9A%84">#</a> <code>sleep()</code> ã€ <code>yield()</code> ã€ <code>join()</code>  æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ  <code>sleep()</code>  å’Œ  <code>yield()</code>  æ–¹æ³•æ˜¯é™æ€ï¼ˆstaticï¼‰çš„ï¼Ÿ</h4>
<p><strong> <code>yield()</code> </strong></p>
<ul>
<li><code>yield()</code>  æ–¹æ³•å¯ä»¥è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æš‚åœï¼Œä½†å®ƒä¸ä¼šé˜»å¡è¯¥çº¿ç¨‹ï¼Œå®ƒåªæ˜¯å°†è¯¥çº¿ç¨‹ä» <strong>Running</strong> çŠ¶æ€è½¬å…¥  <code>Runnable</code>  çŠ¶æ€ã€‚</li>
<li>å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨äº†  <code>yield()</code>  æ–¹æ³•æš‚åœä¹‹åï¼Œåªæœ‰ä¼˜å…ˆçº§ä¸å½“å‰çº¿ç¨‹ç›¸åŒï¼Œæˆ–è€…ä¼˜å…ˆçº§æ¯”å½“å‰çº¿ç¨‹æ›´é«˜çš„å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹æ‰ä¼šè·å¾—æ‰§è¡Œçš„æœºä¼šã€‚</li>
</ul>
<p><strong> <code>sleep()</code> </strong></p>
<ul>
<li><code>sleep()</code>  æ–¹æ³•éœ€è¦æŒ‡å®šç­‰å¾…çš„æ—¶é—´ï¼Œå®ƒå¯ä»¥è®©å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å†…æš‚åœæ‰§è¡Œï¼Œè¿›å…¥ <strong>Blocked</strong> çŠ¶æ€ã€‚</li>
<li>è¯¥æ–¹æ³•æ—¢å¯ä»¥è®©å…¶ä»–åŒä¼˜å…ˆçº§æˆ–è€…é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹å¾—åˆ°æ‰§è¡Œçš„æœºä¼šï¼Œä¹Ÿå¯ä»¥è®©ä½ä¼˜å…ˆçº§çš„çº¿ç¨‹å¾—åˆ°æ‰§è¡Œæœºä¼šã€‚</li>
<li>ä½†æ˜¯ï¼Œ <code>sleep()</code>  æ–¹æ³•ä¸ä¼šé‡Šæ”¾ â€œé”æ ‡å¿—â€ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæœ‰  <code>synchronized</code>  åŒæ­¥å—ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶ä¸èƒ½è®¿é—®å…±äº«æ•°æ®ã€‚</li>
</ul>
<p><strong> <code>join()</code> </strong></p>
<ul>
<li><code>join()</code>  æ–¹æ³•ä¼šä½¿å½“å‰çº¿ç¨‹è½¬å…¥ <strong>Blocked</strong> çŠ¶æ€ï¼Œç­‰å¾…è°ƒç”¨  <code>join()</code>  æ–¹æ³•çš„çº¿ç¨‹ç»“æŸåæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆ  <code>sleep()</code>  å’Œ  <code>yield()</code>  æ–¹æ³•æ˜¯é™æ€ï¼ˆstaticï¼‰çš„ï¼Ÿ</strong></p>
<ul>
<li><code>Thread</code>  ç±»çš„  <code>sleep()</code>  å’Œ  <code>yield()</code>  æ–¹æ³•å°†å¤„ç† <strong>Running</strong> çŠ¶æ€çš„çº¿ç¨‹ã€‚æ‰€ä»¥åœ¨å…¶ä»–å¤„äºé <strong>Running</strong> çŠ¶æ€çš„çº¿ç¨‹ä¸Šæ‰§è¡Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›æ–¹æ³•æ˜¯é™æ€çš„ã€‚å®ƒä»¬å¯ä»¥åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ä¸­å·¥ä½œï¼Œå¹¶é¿å…ç¨‹åºå‘˜é”™è¯¯çš„è®¤ä¸ºå¯ä»¥åœ¨å…¶ä»–éè¿è¡Œçº¿ç¨‹è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="http://www.importnew.com/14958.html">Java çº¿ç¨‹ä¸­ yield ä¸ join æ–¹æ³•çš„åŒºåˆ« (opens new window)</a>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/xiangwanpeng/article/details/54972952">sleep ()ï¼Œwait ()ï¼Œyield () å’Œ join () æ–¹æ³•çš„åŒºåˆ« (opens new window)</a></p>
</blockquote>
<h4 id="-1031"><a class="markdownIt-Anchor" href="#-1031">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#java-%E7%9A%84%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6-%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84-java-%E7%BA%BF%E7%A8%8B%E4%B8%80%E5%AE%9A%E5%85%88%E6%89%A7%E8%A1%8C%E5%90%97">#</a>Java çš„çº¿ç¨‹ä¼˜å…ˆçº§å¦‚ä½•æ§åˆ¶ï¼Ÿé«˜ä¼˜å…ˆçº§çš„ Java çº¿ç¨‹ä¸€å®šå…ˆæ‰§è¡Œå—ï¼Ÿ</h4>
<p><strong>Java ä¸­çš„çº¿ç¨‹ä¼˜å…ˆçº§å¦‚ä½•æ§åˆ¶</strong></p>
<ul>
<li>Java ä¸­çš„çº¿ç¨‹ä¼˜å…ˆçº§çš„èŒƒå›´æ˜¯  <code>[1,10]</code> ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œé«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹åœ¨è¿è¡Œæ—¶ä¼šå…·æœ‰ä¼˜å…ˆæƒã€‚å¯ä»¥é€šè¿‡  <code>thread.setPriority(Thread.MAX_PRIORITY)</code>  çš„æ–¹å¼è®¾ç½®ï¼Œé»˜è®¤ä¼˜å…ˆçº§ä¸º  <code>5</code> ã€‚</li>
</ul>
<p><strong>é«˜ä¼˜å…ˆçº§çš„ Java çº¿ç¨‹ä¸€å®šå…ˆæ‰§è¡Œå—</strong></p>
<ul>
<li>å³ä½¿è®¾ç½®äº†çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œä¹Ÿ<strong>æ— æ³•ä¿è¯é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹ä¸€å®šå…ˆæ‰§è¡Œ</strong>ã€‚</li>
<li>åŸå› ï¼šè¿™æ˜¯å› ä¸º <strong>Java çº¿ç¨‹ä¼˜å…ˆçº§ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„æ”¯æŒ</strong>ï¼Œç„¶è€Œï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿæ”¯æŒçš„çº¿ç¨‹ä¼˜å…ˆçº§å¹¶ä¸ç›¸åŒï¼Œä¸èƒ½å¾ˆå¥½çš„å’Œ Java ä¸­çº¿ç¨‹ä¼˜å…ˆçº§ä¸€ä¸€å¯¹åº”ã€‚</li>
<li>ç»“è®ºï¼šJava çº¿ç¨‹ä¼˜å…ˆçº§æ§åˆ¶å¹¶ä¸å¯é ã€‚</li>
</ul>
<h4 id="-1032"><a class="markdownIt-Anchor" href="#-1032">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B-%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B">#</a>ä»€ä¹ˆæ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨å®ˆæŠ¤çº¿ç¨‹ï¼Ÿå¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹ï¼Ÿ</h4>
<p><strong>ä»€ä¹ˆæ˜¯å®ˆæŠ¤çº¿ç¨‹</strong></p>
<ul>
<li>å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰æ˜¯åœ¨åå°æ‰§è¡Œå¹¶ä¸”ä¸ä¼šé˜»æ­¢ JVM ç»ˆæ­¢çš„çº¿ç¨‹ã€‚</li>
<li>ä¸å®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰ç›¸åçš„ï¼Œå«ç”¨æˆ·çº¿ç¨‹ï¼ˆUser Threadï¼‰ï¼Œä¹Ÿå°±æ˜¯éå®ˆæŠ¤çº¿ç¨‹ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¦ç”¨å®ˆæŠ¤çº¿ç¨‹</strong></p>
<ul>
<li>å®ˆæŠ¤çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œç”¨äºä¸ºç³»ç»Ÿä¸­çš„å…¶å®ƒå¯¹è±¡å’Œçº¿ç¨‹æä¾›æœåŠ¡ã€‚å…¸å‹çš„åº”ç”¨å°±æ˜¯åƒåœ¾å›æ”¶å™¨ã€‚</li>
</ul>
<p><strong>å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹</strong></p>
<ul>
<li>ä½¿ç”¨  <code>thread.setDaemon(true)</code>  å¯ä»¥è®¾ç½® thread çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</li>
<li>æ³¨æ„ç‚¹ï¼š
<ul>
<li>æ­£åœ¨è¿è¡Œçš„ç”¨æˆ·çº¿ç¨‹æ— æ³•è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥  <code>thread.setDaemon(true)</code>  å¿…é¡»åœ¨  <code>thread.start()</code>  ä¹‹å‰è®¾ç½®ï¼Œå¦åˆ™ä¼šæŠ›å‡º  <code>llegalThreadStateException</code>  å¼‚å¸¸ï¼›</li>
<li>ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹åˆ›å»ºçš„å­çº¿ç¨‹ä¾ç„¶æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚</li>
<li>ä¸è¦è®¤ä¸ºæ‰€æœ‰çš„åº”ç”¨éƒ½å¯ä»¥åˆ†é…ç»™å®ˆæŠ¤çº¿ç¨‹æ¥è¿›è¡ŒæœåŠ¡ï¼Œæ¯”å¦‚è¯»å†™æ“ä½œæˆ–è€…è®¡ç®—é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/shimiso/article/details/8964414">Java ä¸­å®ˆæŠ¤çº¿ç¨‹çš„æ€»ç»“ (opens new window)</a></p>
</blockquote>
<h4 id="-1033"><a class="markdownIt-Anchor" href="#-1033">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E7%BA%BF%E7%A8%8B%E9%97%B4%E6%98%AF%E5%A6%82%E4%BD%95%E9%80%9A%E4%BF%A1%E7%9A%84">#</a>çº¿ç¨‹é—´æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Ÿ</h4>
<p>å½“çº¿ç¨‹é—´æ˜¯å¯ä»¥å…±äº«èµ„æºæ—¶ï¼Œçº¿ç¨‹é—´é€šä¿¡æ˜¯åè°ƒå®ƒä»¬çš„é‡è¦çš„æ‰‹æ®µã€‚ <code>Object</code>  ç±»ä¸­  <code>wait()</code> ,  <code>notify()</code>  å’Œ  <code>notifyAll()</code>  æ–¹æ³•å¯ä»¥ç”¨äºçº¿ç¨‹é—´é€šä¿¡å…³äºèµ„æºçš„é”çš„çŠ¶æ€ã€‚</p>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="http://www.cnblogs.com/dolphin0520/p/3920385.html">Java å¹¶å‘ç¼–ç¨‹ï¼šçº¿ç¨‹é—´åä½œçš„ä¸¤ç§æ–¹å¼ï¼šwaitã€notifyã€notifyAll å’Œ Condition (opens new window)</a></p>
</blockquote>
<h4 id="-1034"><a class="markdownIt-Anchor" href="#-1034">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%E7%9A%84%E6%96%B9%E6%B3%95-wait-notify-%E5%92%8C-notifyall-%E8%A2%AB%E5%AE%9A%E4%B9%89%E5%9C%A8-object-%E7%B1%BB%E9%87%8C">#</a>ä¸ºä»€ä¹ˆçº¿ç¨‹é€šä¿¡çš„æ–¹æ³•  <code>wait()</code> ,  <code>notify()</code>  å’Œ  <code>notifyAll()</code>  è¢«å®šä¹‰åœ¨ Object ç±»é‡Œï¼Ÿ</h4>
<p>Java çš„æ¯ä¸ªå¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªé” (monitorï¼Œä¹Ÿå¯ä»¥æˆä¸ºç›‘è§†å™¨) å¹¶ä¸”  <code>wait()</code> ã€ <code>notify()</code>  ç­‰æ–¹æ³•ç”¨äºç­‰å¾…å¯¹è±¡çš„é”æˆ–è€…é€šçŸ¥å…¶ä»–çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨å¯ç”¨ã€‚åœ¨ Java çš„çº¿ç¨‹ä¸­å¹¶æ²¡æœ‰å¯ä¾›ä»»ä½•å¯¹è±¡ä½¿ç”¨çš„é”å’ŒåŒæ­¥å™¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™äº›æ–¹æ³•æ˜¯ Object ç±»çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ · Java çš„æ¯ä¸€ä¸ªç±»éƒ½æœ‰ç”¨äºçº¿ç¨‹é—´é€šä¿¡çš„åŸºæœ¬æ–¹æ³•</p>
<h4 id="-1035"><a class="markdownIt-Anchor" href="#-1035">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%B8%BA%E4%BB%80%E4%B9%88-wait-notify-%E5%92%8C-notifyall-%E5%BF%85%E9%A1%BB%E5%9C%A8%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95%E6%88%96%E8%80%85%E5%90%8C%E6%AD%A5%E5%9D%97%E4%B8%AD%E8%A2%AB%E8%B0%83%E7%94%A8">#</a>ä¸ºä»€ä¹ˆ  <code>wait()</code> ,  <code>notify()</code>  å’Œ  <code>notifyAll()</code>  å¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­è¢«è°ƒç”¨ï¼Ÿ</h4>
<p>å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è°ƒç”¨å¯¹è±¡çš„  <code>wait()</code>  æ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªçº¿ç¨‹å¿…é¡»æ‹¥æœ‰è¯¥å¯¹è±¡çš„é”ï¼Œæ¥ç€å®ƒå°±ä¼šé‡Šæ”¾è¿™ä¸ªå¯¹è±¡é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨è¿™ä¸ªå¯¹è±¡ä¸Šçš„  <code>notify()</code>  æ–¹æ³•ã€‚åŒæ ·çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è°ƒç”¨å¯¹è±¡çš„  <code>notify()</code>  æ–¹æ³•æ—¶ï¼Œå®ƒä¼šé‡Šæ”¾è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œä»¥ä¾¿å…¶ä»–åœ¨ç­‰å¾…çš„çº¿ç¨‹å°±å¯ä»¥å¾—åˆ°è¿™ä¸ªå¯¹è±¡é”ã€‚</p>
<p>ç”±äºæ‰€æœ‰çš„è¿™äº›æ–¹æ³•éƒ½éœ€è¦çº¿ç¨‹æŒæœ‰å¯¹è±¡çš„é”ï¼Œè¿™æ ·å°±åªèƒ½é€šè¿‡åŒæ­¥æ¥å®ç°ï¼Œæ‰€ä»¥ä»–ä»¬åªèƒ½åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­è¢«è°ƒç”¨ã€‚</p>
<h3 id="-1036"><a class="markdownIt-Anchor" href="#-1036">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B9%B6%E5%8F%91%E6%9C%BA%E5%88%B6%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0">#</a>å¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°</h3>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%B9%B6%E5%8F%91%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6.md">Java å¹¶å‘æ ¸å¿ƒæœºåˆ¶ (opens new window)</a></p>
</blockquote>
<h4 id="-1037"><a class="markdownIt-Anchor" href="#-1037">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90%E2%AD%90-synchronized">#</a>â­â­â­  <code>synchronized</code></h4>
<blockquote>
<p><code>synchronized</code>  æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
<p><code>synchronized</code>  çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥å—ï¼Œå“ªä¸ªæ›´å¥½ï¼Ÿ</p>
<p>JDK1.6 å¯¹ <code>synchronized</code>  åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ</p>
<p>ä½¿ç”¨  <code>synchronized</code>  ä¿®é¥°é™æ€æ–¹æ³•å’Œéé™æ€æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p><strong> <code>synchronized</code>  å¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—</strong>ã€‚</p>
<p><code>synchronized</code>  æœ‰ 3 ç§åº”ç”¨æ–¹å¼ï¼š</p>
<ul>
<li><strong>åŒæ­¥å®ä¾‹æ–¹æ³•</strong> - å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡</li>
<li><strong>åŒæ­¥é™æ€æ–¹æ³•</strong> - å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„  <code>Class</code>  å¯¹è±¡</li>
<li><strong>åŒæ­¥ä»£ç å—</strong> - å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯  <code>synchonized</code>  æ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡</li>
</ul>
<p><strong>åŸç†</strong></p>
<p><code>synchronized</code>  ç»è¿‡ç¼–è¯‘åï¼Œä¼šåœ¨åŒæ­¥å—çš„å‰ååˆ†åˆ«å½¢æˆ  <code>monitorenter</code>  å’Œ  <code>monitorexit</code>  è¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤ï¼Œè¿™ä¸¤ä¸ªå­—èŠ‚ç æŒ‡ä»¤éƒ½éœ€è¦ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°æ¥æŒ‡æ˜è¦é”å®šå’Œè§£é”çš„å¯¹è±¡ã€‚å¦‚æœ  <code>synchronized</code>  æ˜ç¡®åˆ¶å®šäº†å¯¹è±¡å‚æ•°ï¼Œé‚£å°±æ˜¯è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼›å¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œé‚£å°±æ ¹æ®  <code>synchronized</code>  ä¿®é¥°çš„æ˜¯å®ä¾‹æ–¹æ³•è¿˜æ˜¯é™æ€æ–¹æ³•ï¼Œå»å¯¹å¯¹åº”çš„å¯¹è±¡å®ä¾‹æˆ–  <code>Class</code>  å¯¹è±¡æ¥ä½œä¸ºé”å¯¹è±¡ã€‚</p>
<p><code>synchronized</code>  åŒæ­¥å—å¯¹åŒä¸€çº¿ç¨‹æ¥è¯´æ˜¯å¯é‡å…¥çš„ï¼Œä¸ä¼šå‡ºç°é”æ­»é—®é¢˜ã€‚</p>
<p><code>synchronized</code>  åŒæ­¥å—æ˜¯äº’æ–¥çš„ï¼Œå³å·²è¿›å…¥çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆå‰ï¼Œä¼šé˜»å¡å…¶ä»–è¯•å›¾è¿›å…¥çš„çº¿ç¨‹ã€‚</p>
<p><strong>ä¼˜åŒ–</strong></p>
<p>Java 1.6 ä»¥åï¼Œ <code>synchronized</code>  åšäº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå…¶æ€§èƒ½å·²ç»ä¸  <code>Lock</code>  ã€ <code>ReadWriteLock</code>  åŸºæœ¬ä¸ŠæŒå¹³ã€‚</p>
<p><code>synchronized</code>  çš„ä¼˜åŒ–æ˜¯å°†é”ç²’åº¦åˆ†ä¸ºä¸åŒçº§åˆ«ï¼Œ <code>synchronized</code>  ä¼šæ ¹æ®è¿è¡ŒçŠ¶æ€åŠ¨æ€çš„ç”±ä½åˆ°é«˜è°ƒæ•´é”çº§åˆ«ï¼ˆ<strong>åå‘é”</strong> -&gt; <strong>è½»é‡çº§é”</strong> -&gt; <strong>é‡é‡çº§é”</strong>ï¼‰ï¼Œä»¥å‡å°‘é˜»å¡ã€‚</p>
<p><strong>åŒæ­¥æ–¹æ³• or åŒæ­¥å—ï¼Ÿ</strong></p>
<ul>
<li>åŒæ­¥å—æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li>
<li>å› ä¸ºå®ƒä¸ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥è®©å®ƒé”ä½æ•´ä¸ªå¯¹è±¡ï¼‰ã€‚åŒæ­¥æ–¹æ³•ä¼šé”ä½æ•´ä¸ªå¯¹è±¡ï¼Œå“ªæ€•è¿™ä¸ªç±»ä¸­æœ‰å¤šä¸ªä¸ç›¸å…³è”çš„åŒæ­¥å—ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä»–ä»¬åœæ­¢æ‰§è¡Œå¹¶éœ€è¦ç­‰å¾…è·å¾—è¿™ä¸ªå¯¹è±¡ä¸Šçš„é”ã€‚</li>
</ul>
<h4 id="-1038"><a class="markdownIt-Anchor" href="#-1038">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-volatile">#</a>â­  <code>volatile</code></h4>
<blockquote>
<p><code>volatile</code>  æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
<p><code>volatile</code>  çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><code>volatile</code>  èƒ½ä»£æ›¿é”å—ï¼Ÿ</p>
<p><code>volatile</code>  å’Œ  <code>synchronized</code>  çš„åŒºåˆ«ï¼Ÿ</p>
</blockquote>
<p><strong> <code>volatile</code>  æ— æ³•æ›¿ä»£  <code>synchronized</code>  ï¼Œå› ä¸º  <code>volatile</code>  æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§</strong>ã€‚</p>
<p><strong>ä½œç”¨</strong></p>
<p>è¢«  <code>volatile</code>  å…³é”®å­—ä¿®é¥°çš„å˜é‡æœ‰ä¸¤å±‚å«ä¹‰ï¼š</p>
<ul>
<li><strong>ä¿è¯äº†ä¸åŒçº¿ç¨‹å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œæ“ä½œæ—¶çš„å¯è§æ€§</strong>ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†æŸä¸ªå˜é‡çš„å€¼ï¼Œè¿™æ–°å€¼å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´æ˜¯ç«‹å³å¯è§çš„ã€‚</li>
<li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</strong>ã€‚</li>
</ul>
<p><strong>åŸç†</strong></p>
<p>è§‚å¯ŸåŠ å…¥ volatile å…³é”®å­—å’Œæ²¡æœ‰åŠ å…¥ volatile å…³é”®å­—æ—¶æ‰€ç”Ÿæˆçš„æ±‡ç¼–ä»£ç å‘ç°ï¼Œ<strong>åŠ å…¥  <code>volatile</code>  å…³é”®å­—æ—¶ï¼Œä¼šå¤šå‡ºä¸€ä¸ª  <code>lock</code>  å‰ç¼€æŒ‡ä»¤</strong>ã€‚</p>
<p><strong> <code>lock</code>  å‰ç¼€æŒ‡ä»¤å®é™…ä¸Šç›¸å½“äºä¸€ä¸ªå†…å­˜å±éšœ</strong>ï¼ˆä¹Ÿæˆå†…å­˜æ …æ ï¼‰ï¼Œå†…å­˜å±éšœä¼šæä¾› 3 ä¸ªåŠŸèƒ½ï¼š</p>
<ul>
<li>å®ƒç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ä¸ä¼šæŠŠå…¶åé¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœä¹‹å‰çš„ä½ç½®ï¼Œä¹Ÿä¸ä¼šæŠŠå‰é¢çš„æŒ‡ä»¤æ’åˆ°å†…å­˜å±éšœçš„åé¢ï¼›å³åœ¨æ‰§è¡Œåˆ°å†…å­˜å±éšœè¿™å¥æŒ‡ä»¤æ—¶ï¼Œåœ¨å®ƒå‰é¢çš„æ“ä½œå·²ç»å…¨éƒ¨å®Œæˆï¼›</li>
<li>å®ƒä¼šå¼ºåˆ¶å°†å¯¹ç¼“å­˜çš„ä¿®æ”¹æ“ä½œç«‹å³å†™å…¥ä¸»å­˜ï¼›</li>
<li>å¦‚æœæ˜¯å†™æ“ä½œï¼Œå®ƒä¼šå¯¼è‡´å…¶ä»– CPU ä¸­å¯¹åº”çš„ç¼“å­˜è¡Œæ— æ•ˆã€‚</li>
</ul>
<p><strong> <code>volatile</code>  å’Œ  <code>synchronized</code>  çš„åŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li><code>volatile</code>  æœ¬è´¨æ˜¯åœ¨å‘Šè¯‰ jvm å½“å‰å˜é‡åœ¨å¯„å­˜å™¨ï¼ˆå·¥ä½œå†…å­˜ï¼‰ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„ï¼Œéœ€è¦ä»ä¸»å­˜ä¸­è¯»å–ï¼›  <code>synchronized</code>  åˆ™æ˜¯é”å®šå½“å‰å˜é‡ï¼Œåªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡ï¼Œå…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä½ã€‚</li>
<li><code>volatile</code>  ä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«ï¼›synchronized åˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡ã€æ–¹æ³•ã€å’Œç±»çº§åˆ«çš„ã€‚</li>
<li><code>volatile</code>  ä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§ï¼Œä¸èƒ½ä¿è¯åŸå­æ€§ï¼›è€Œ  <code>synchronized</code>  åˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§</li>
<li><code>volatile</code>  ä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ï¼›synchronized å¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ã€‚</li>
<li><code>volatile</code>  æ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–ï¼›synchronized æ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–ã€‚</li>
</ul>
<h4 id="-1039"><a class="markdownIt-Anchor" href="#-1039">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90-cas">#</a>â­â­ CAS</h4>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ CASï¼Ÿ</p>
<p>CAS æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
<p>CAS çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>CAS çš„ä¸‰å¤§é—®é¢˜ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p><strong>CASï¼ˆCompare and Swapï¼‰</strong>ï¼Œå­—é¢æ„æ€ä¸º<strong>æ¯”è¾ƒå¹¶äº¤æ¢</strong>ã€‚CAS æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯ï¼šå†…å­˜å€¼ Vï¼Œæ—§çš„é¢„æœŸå€¼ Aï¼Œè¦ä¿®æ”¹çš„æ–°å€¼ Bã€‚å½“ä¸”ä»…å½“é¢„æœŸå€¼ A å’Œå†…å­˜å€¼ V ç›¸åŒæ—¶ï¼Œå°†å†…å­˜å€¼ V ä¿®æ”¹ä¸º Bï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸åšã€‚</p>
<p><strong>åŸç†</strong></p>
<p>Java ä¸»è¦åˆ©ç”¨  <code>Unsafe</code>  è¿™ä¸ªç±»æä¾›çš„ CAS æ“ä½œã€‚ <code>Unsafe</code>  çš„ CAS ä¾èµ–çš„æ˜¯ JV M é’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿå®ç°çš„  <code>Atomic::cmpxchg</code>  æŒ‡ä»¤ã€‚</p>
<p><strong>ä¸‰å¤§é—®é¢˜</strong></p>
<ol>
<li><strong>ABA é—®é¢˜</strong>ï¼šå› ä¸º CAS éœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥ä¸‹å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–åˆ™æ›´æ–°ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå€¼åŸæ¥æ˜¯ Aï¼Œå˜æˆäº† Bï¼Œåˆå˜æˆäº† Aï¼Œé‚£ä¹ˆä½¿ç”¨ CAS è¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å®ƒçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šå´å˜åŒ–äº†ã€‚ABA é—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·ã€‚åœ¨å˜é‡å‰é¢è¿½åŠ ä¸Šç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œé‚£ä¹ˆ Aï¼Bï¼A å°±ä¼šå˜æˆ 1A-2Bï¼3Aã€‚</li>
<li><strong>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</strong>ã€‚è‡ªæ—‹ CAS å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™ CPU å¸¦æ¥éå¸¸å¤§çš„æ‰§è¡Œå¼€é”€ã€‚å¦‚æœ JVM èƒ½æ”¯æŒå¤„ç†å™¨æä¾›çš„ pause æŒ‡ä»¤é‚£ä¹ˆæ•ˆç‡ä¼šæœ‰ä¸€å®šçš„æå‡ï¼Œpause æŒ‡ä»¤æœ‰ä¸¤ä¸ªä½œç”¨ï¼Œç¬¬ä¸€å®ƒå¯ä»¥å»¶è¿Ÿæµæ°´çº¿æ‰§è¡ŒæŒ‡ä»¤ï¼ˆde-pipelineï¼‰, ä½¿ CPU ä¸ä¼šæ¶ˆè€—è¿‡å¤šçš„æ‰§è¡Œèµ„æºï¼Œå»¶è¿Ÿçš„æ—¶é—´å–å†³äºå…·ä½“å®ç°çš„ç‰ˆæœ¬ï¼Œåœ¨ä¸€äº›å¤„ç†å™¨ä¸Šå»¶è¿Ÿæ—¶é—´æ˜¯é›¶ã€‚ç¬¬äºŒå®ƒå¯ä»¥é¿å…åœ¨é€€å‡ºå¾ªç¯çš„æ—¶å€™å› å†…å­˜é¡ºåºå†²çªï¼ˆmemory order violationï¼‰è€Œå¼•èµ· CPU æµæ°´çº¿è¢«æ¸…ç©ºï¼ˆCPU pipeline flushï¼‰ï¼Œä»è€Œæé«˜ CPU çš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li><strong>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</strong>ã€‚å½“å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¾ªç¯ CAS çš„æ–¹å¼æ¥ä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼Œå¾ªç¯ CAS å°±æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç”¨é”ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªå–å·§çš„åŠæ³•ï¼Œå°±æ˜¯æŠŠå¤šä¸ªå…±äº«å˜é‡åˆå¹¶æˆä¸€ä¸ªå…±äº«å˜é‡æ¥æ“ä½œã€‚æ¯”å¦‚æœ‰ä¸¤ä¸ªå…±äº«å˜é‡ i ï¼ 2,j=aï¼Œåˆå¹¶ä¸€ä¸‹ ij=2aï¼Œç„¶åç”¨ CAS æ¥æ“ä½œ ijã€‚ä» Java1.5 å¼€å§‹ JDK æä¾›äº† AtomicReference ç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œä½ å¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡Œ CAS æ“ä½œã€‚</li>
</ol>
<h4 id="-1040"><a class="markdownIt-Anchor" href="#-1040">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-threadlocal">#</a>â­  <code>ThreadLocal</code></h4>
<blockquote>
<p><code>ThreadLocal</code>  æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
<p><code>ThreadLocal</code>  çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å¦‚ä½•è§£å†³  <code>ThreadLocal</code>  å†…å­˜æ³„æ¼é—®é¢˜ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p><strong> <code>ThreadLocal</code>  æ˜¯ä¸€ä¸ªå­˜å‚¨çº¿ç¨‹æœ¬åœ°å‰¯æœ¬çš„å·¥å…·ç±»</strong>ã€‚</p>
<p><strong>åŸç†</strong></p>
<p><code>Thread</code>  ç±»ä¸­ç»´æŠ¤ç€ä¸€ä¸ª  <code>ThreadLocal.ThreadLocalMap</code>  ç±»å‹çš„æˆå‘˜  <code>threadLocals</code> ã€‚è¿™ä¸ªæˆå‘˜å°±æ˜¯ç”¨æ¥å­˜å‚¨å½“å‰çº¿ç¨‹ç‹¬å çš„å˜é‡å‰¯æœ¬ã€‚</p>
<p><code>ThreadLocalMap</code>  æ˜¯  <code>ThreadLocal</code>  çš„å†…éƒ¨ç±»ï¼Œå®ƒç»´æŠ¤ç€ä¸€ä¸ª  <code>Entry</code>  æ•°ç»„ï¼Œ  <code>Entry</code>  ç”¨äºä¿å­˜é”®å€¼å¯¹ï¼Œå…¶ key æ˜¯  <code>ThreadLocal</code>  å¯¹è±¡ï¼Œvalue æ˜¯ä¼ é€’è¿›æ¥çš„å¯¹è±¡ï¼ˆå˜é‡å‰¯æœ¬ï¼‰ã€‚  <code>Entry</code>  ç»§æ‰¿äº†  <code>WeakReference</code>  ï¼Œæ‰€ä»¥æ˜¯å¼±å¼•ç”¨ã€‚</p>
<p><strong>å†…å­˜æ³„æ¼é—®é¢˜</strong></p>
<p>ThreadLocalMap çš„  <code>Entry</code>  ç»§æ‰¿äº†  <code>WeakReference</code> ï¼Œæ‰€ä»¥å®ƒçš„ key ï¼ˆ <code>ThreadLocal</code>  å¯¹è±¡ï¼‰æ˜¯å¼±å¼•ç”¨ï¼Œè€Œ value ï¼ˆå˜é‡å‰¯æœ¬ï¼‰æ˜¯å¼ºå¼•ç”¨ã€‚</p>
<ul>
<li>å¦‚æœ  <code>ThreadLocal</code>  å¯¹è±¡æ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨æ¥å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆ  <code>ThreadLocal</code>  å¯¹è±¡ä¼šåœ¨ä¸‹æ¬¡ GC æ—¶è¢«å›æ”¶ã€‚</li>
<li>æ­¤æ—¶ï¼Œ <code>Entry</code>  ä¸­çš„ key å·²ç»è¢«å›æ”¶ï¼Œä½†æ˜¯ value ç”±äºæ˜¯å¼ºå¼•ç”¨ä¸ä¼šè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚å¦‚æœåˆ›å»º  <code>ThreadLocal</code>  çš„çº¿ç¨‹ä¸€ç›´æŒç»­è¿è¡Œï¼Œé‚£ä¹ˆ value å°±ä¼šä¸€ç›´å¾—ä¸åˆ°å›æ”¶ï¼Œäº§ç”Ÿå†…å­˜æ³„éœ²ã€‚</li>
</ul>
<p>é‚£ä¹ˆå¦‚ä½•é¿å…å†…å­˜æ³„æ¼å‘¢ï¼Ÿæ–¹æ³•å°±æ˜¯ï¼š<strong>ä½¿ç”¨  <code>ThreadLocal</code>  çš„  <code>set</code>  æ–¹æ³•åï¼Œæ˜¾ç¤ºçš„è°ƒç”¨  <code>remove</code>  æ–¹æ³•</strong> ã€‚</p>
<h3 id="-1041"><a class="markdownIt-Anchor" href="#-1041">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">#</a>å†…å­˜æ¨¡å‹</h3>
<h4 id="-1042"><a class="markdownIt-Anchor" href="#-1042">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E4%BB%80%E4%B9%88%E6%98%AF-java-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">#</a>ä»€ä¹ˆæ˜¯ Java å†…å­˜æ¨¡å‹</h4>
<ul>
<li>Java å†…å­˜æ¨¡å‹å³ Java Memory Modelï¼Œç®€ç§° JMMã€‚JMM å®šä¹‰äº† JVM åœ¨è®¡ç®—æœºå†…å­˜ (RAM) ä¸­çš„å·¥ä½œæ–¹å¼ã€‚JMM æ˜¯éš¶å±äº JVM çš„ã€‚</li>
<li>å¹¶å‘ç¼–ç¨‹é¢†åŸŸä¸¤ä¸ªå…³é”®é—®é¢˜ï¼šçº¿ç¨‹é—´é€šä¿¡å’Œçº¿ç¨‹é—´åŒæ­¥</li>
<li>çº¿ç¨‹é—´é€šä¿¡æœºåˆ¶
<ul>
<li>å…±äº«å†…å­˜ - çº¿ç¨‹é—´é€šè¿‡å†™ - è¯»å†…å­˜ä¸­çš„å…¬å…±çŠ¶æ€æ¥éšå¼è¿›è¡Œé€šä¿¡ã€‚</li>
<li>æ¶ˆæ¯ä¼ é€’ - java ä¸­å…¸å‹çš„æ¶ˆæ¯ä¼ é€’æ–¹å¼å°±æ˜¯ wait () å’Œ notify ()ã€‚</li>
</ul>
</li>
<li>çº¿ç¨‹é—´åŒæ­¥æœºåˆ¶
<ul>
<li>åœ¨å…±äº«å†…å­˜æ¨¡å‹ä¸­ï¼Œå¿…é¡»æ˜¾ç¤ºæŒ‡å®šæŸä¸ªæ–¹æ³•æˆ–æŸæ®µä»£ç åœ¨çº¿ç¨‹é—´äº’æ–¥åœ°æ‰§è¡Œã€‚</li>
<li>åœ¨æ¶ˆæ¯ä¼ é€’æ¨¡å‹ä¸­ï¼Œç”±äºå‘é€æ¶ˆæ¯å¿…é¡»åœ¨æ¥æ”¶æ¶ˆæ¯ä¹‹å‰ï¼Œå› æ­¤åŒæ­¥æ˜¯éšå¼è¿›è¡Œçš„ã€‚</li>
</ul>
</li>
<li>Java çš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹</li>
<li>JMM å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</li>
<li>çº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯» / å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚</li>
<li>JMM æŠŠå†…å­˜åˆ†æˆäº†ä¸¤éƒ¨åˆ†ï¼šçº¿ç¨‹æ ˆåŒºå’Œå †åŒº
<ul>
<li>çº¿ç¨‹æ ˆ
<ul>
<li>JVM ä¸­è¿è¡Œçš„æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„çº¿ç¨‹æ ˆï¼Œçº¿ç¨‹æ ˆåŒ…å«äº†å½“å‰çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•è°ƒç”¨ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¹ŸæŠŠå®ƒç§°ä½œè°ƒç”¨æ ˆã€‚éšç€ä»£ç çš„ä¸æ–­æ‰§è¡Œï¼Œè°ƒç”¨æ ˆä¼šä¸æ–­å˜åŒ–ã€‚</li>
<li>çº¿ç¨‹æ ˆè¿˜åŒ…å«äº†å½“å‰æ–¹æ³•çš„æ‰€æœ‰æœ¬åœ°å˜é‡ä¿¡æ¯ã€‚çº¿ç¨‹ä¸­çš„æœ¬åœ°å˜é‡å¯¹å…¶å®ƒçº¿ç¨‹æ˜¯ä¸å¯è§çš„ã€‚</li>
</ul>
</li>
<li>å †åŒº
<ul>
<li>å †åŒºåŒ…å«äº† Java åº”ç”¨åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ä¿¡æ¯ï¼Œä¸ç®¡å¯¹è±¡æ˜¯å“ªä¸ªçº¿ç¨‹åˆ›å»ºçš„ï¼Œå…¶ä¸­çš„å¯¹è±¡åŒ…æ‹¬åŸå§‹ç±»å‹çš„å°è£…ç±»ï¼ˆå¦‚ Byteã€Integerã€Long ç­‰ç­‰ï¼‰ã€‚ä¸ç®¡å¯¹è±¡æ˜¯å±äºä¸€ä¸ªæˆå‘˜å˜é‡è¿˜æ˜¯æ–¹æ³•ä¸­çš„æœ¬åœ°å˜é‡ï¼Œå®ƒéƒ½ä¼šè¢«å­˜å‚¨åœ¨å †åŒºã€‚</li>
</ul>
</li>
<li>ä¸€ä¸ªæœ¬åœ°å˜é‡å¦‚æœæ˜¯åŸå§‹ç±»å‹ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«å®Œå…¨å­˜å‚¨åˆ°æ ˆåŒºã€‚</li>
<li>ä¸€ä¸ªæœ¬åœ°å˜é‡ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæœ¬åœ°å¼•ç”¨ä¼šè¢«å­˜å‚¨åˆ°æ ˆä¸­ï¼Œä½†æ˜¯å¯¹è±¡æœ¬èº«ä»ç„¶å­˜å‚¨åœ¨å †åŒºã€‚</li>
<li>å¯¹äºä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸­åŒ…å«æœ¬åœ°å˜é‡ï¼Œä»éœ€è¦å­˜å‚¨åœ¨æ ˆåŒºï¼Œå³ä½¿å®ƒä»¬æ‰€å±çš„å¯¹è±¡åœ¨å †åŒºã€‚</li>
<li>å¯¹äºä¸€ä¸ªå¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œä¸ç®¡å®ƒæ˜¯åŸå§‹ç±»å‹è¿˜æ˜¯åŒ…è£…ç±»å‹ï¼Œéƒ½ä¼šè¢«å­˜å‚¨åˆ°å †åŒºã€‚</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/java-memory-model_3.png" alt="img"></p>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/suifeng3051/article/details/52611310">å…¨é¢ç†è§£ Java å†…å­˜æ¨¡å‹ (opens new window)</a></p>
</blockquote>
<h3 id="-1043"><a class="markdownIt-Anchor" href="#-1043">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%90%8C%E6%AD%A5%E5%AE%B9%E5%99%A8%E5%92%8C%E5%B9%B6%E5%8F%91%E5%AE%B9%E5%99%A8">#</a>åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨</h3>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8.md">Java å¹¶å‘å®¹å™¨ (opens new window)</a></p>
</blockquote>
<h4 id="-1044"><a class="markdownIt-Anchor" href="#-1044">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-%E5%90%8C%E6%AD%A5%E5%AE%B9%E5%99%A8">#</a>â­ åŒæ­¥å®¹å™¨</h4>
<blockquote>
<p>ä»€ä¹ˆæ˜¯åŒæ­¥å®¹å™¨ï¼Ÿ</p>
<p>æœ‰å“ªäº›å¸¸è§åŒæ­¥å®¹å™¨ï¼Ÿ</p>
<p>å®ƒä»¬æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</p>
<p>åŒæ­¥å®¹å™¨çœŸçš„çº¿ç¨‹å®‰å…¨å—ï¼Ÿ</p>
</blockquote>
<p><strong>ç±»å‹</strong></p>
<pre class="line-numbers language-none"><code class="language-none">Vector&#96;ã€&#96;Stack&#96;ã€&#96;Hashtable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>ä½œç”¨ / åŸç†</strong></p>
<p>åŒæ­¥å®¹å™¨çš„åŒæ­¥åŸç†å°±æ˜¯åœ¨æ–¹æ³•ä¸Šç”¨  <code>synchronized</code>  ä¿®é¥°ã€‚ <strong> <code>synchronized</code>  å¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡ŒæŸä¸ªæ–¹æ³•æˆ–è€…æŸä¸ªä»£ç å—</strong>ã€‚</p>
<p><code>synchronized</code>  çš„äº’æ–¥åŒæ­¥ä¼šäº§ç”Ÿé˜»å¡å’Œå”¤é†’çº¿ç¨‹çš„å¼€é”€ã€‚æ˜¾ç„¶ï¼Œè¿™ç§æ–¹å¼æ¯”æ²¡æœ‰ä½¿ç”¨  <code>synchronized</code>  çš„å®¹å™¨æ€§èƒ½è¦å·®ã€‚</p>
<p><strong>çº¿ç¨‹å®‰å…¨</strong></p>
<p>åŒæ­¥å®¹å™¨çœŸçš„ç»å¯¹å®‰å…¨å—ï¼Ÿ</p>
<p>å…¶å®ä¹Ÿæœªå¿…ã€‚åœ¨åšå¤åˆæ“ä½œï¼ˆéåŸå­æ“ä½œï¼‰æ—¶ï¼Œä»ç„¶éœ€è¦åŠ é”æ¥ä¿æŠ¤ã€‚å¸¸è§å¤åˆæ“ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>è¿­ä»£</strong>ï¼šåå¤è®¿é—®å…ƒç´ ï¼Œç›´åˆ°éå†å®Œå…¨éƒ¨å…ƒç´ ï¼›</li>
<li><strong>è·³è½¬</strong>ï¼šæ ¹æ®æŒ‡å®šé¡ºåºå¯»æ‰¾å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªï¼ˆä¸‹ n ä¸ªï¼‰å…ƒç´ ï¼›</li>
<li><strong>æ¡ä»¶è¿ç®—</strong>ï¼šä¾‹å¦‚è‹¥æ²¡æœ‰åˆ™æ·»åŠ ç­‰ï¼›</li>
</ul>
<h4 id="-1045"><a class="markdownIt-Anchor" href="#-1045">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90%E2%AD%90-concurrenthashmap">#</a>â­â­â­ ConcurrentHashMap</h4>
<blockquote>
<p>è¯·æè¿° ConcurrentHashMap çš„å®ç°åŸç†ï¼Ÿ</p>
<p>ConcurrentHashMap ä¸ºä»€ä¹ˆæ”¾å¼ƒäº†åˆ†æ®µé”ï¼Ÿ</p>
</blockquote>
<p>åŸºç¡€æ•°æ®ç»“æ„åŸç†å’Œ  <code>HashMap</code>  ä¸€æ ·ï¼ŒJDK 1.7 é‡‡ç”¨ æ•°ç»„ï¼‹å•é“¾è¡¨ï¼›JDK 1.8 é‡‡ç”¨æ•°ç»„ï¼‹å•é“¾è¡¨ï¼‹çº¢é»‘æ ‘ã€‚</p>
<p>å¹¶å‘å®‰å…¨ç‰¹æ€§çš„å®ç°ï¼š</p>
<p>JDK 1.7ï¼š</p>
<ul>
<li>ä½¿ç”¨åˆ†æ®µé”ï¼Œè®¾è®¡æ€è·¯æ˜¯ç¼©å°é”ç²’åº¦ï¼Œæé«˜å¹¶å‘ååã€‚</li>
<li>å†™æ•°æ®æ—¶ï¼Œä¼šä½¿ç”¨å¯é‡å…¥é”å»é”ä½åˆ†æ®µï¼ˆsegmentï¼‰ã€‚</li>
</ul>
<p>JDK 1.8ï¼š</p>
<ul>
<li>
<p>å–æ¶ˆåˆ†æ®µé”ï¼Œç›´æ¥é‡‡ç”¨  <code>transient volatile HashEntry&lt;K,V&gt;[] table</code>  ä¿å­˜æ•°æ®ï¼Œé‡‡ç”¨ table æ•°ç»„å…ƒç´ ä½œä¸ºé”ï¼Œä»è€Œå®ç°äº†å¯¹æ¯ä¸€è¡Œæ•°æ®è¿›è¡ŒåŠ é”ï¼Œè¿›ä¸€æ­¥å‡å°‘å¹¶å‘å†²çªçš„æ¦‚ç‡ã€‚</p>
</li>
<li>
<p>å†™æ•°æ®æ—¶ï¼Œä½¿ç”¨æ˜¯ CAS +</p>
  <pre class="line-numbers language-none"><code class="language-none">synchronized<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>ã€‚</p>
<ul>
<li>æ ¹æ® key è®¡ç®—å‡º hashcode ã€‚</li>
<li>åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
<li><code>f</code>  å³ä¸ºå½“å‰ key å®šä½å‡ºçš„ Nodeï¼Œå¦‚æœä¸ºç©ºè¡¨ç¤ºå½“å‰ä½ç½®å¯ä»¥å†™å…¥æ•°æ®ï¼Œåˆ©ç”¨ CAS å°è¯•å†™å…¥ï¼Œå¤±è´¥åˆ™è‡ªæ—‹ä¿è¯æˆåŠŸã€‚</li>
<li>å¦‚æœå½“å‰ä½ç½®çš„  <code>hashcode == MOVED == -1</code> , åˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚</li>
<li>å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™åˆ©ç”¨ synchronized é”å†™å…¥æ•°æ®ã€‚</li>
<li>å¦‚æœæ•°é‡å¤§äº  <code>TREEIFY_THRESHOLD</code>  åˆ™è¦è½¬æ¢ä¸ºçº¢é»‘æ ‘ã€‚</li>
</ul>
</li>
</ul>
<h4 id="-1046"><a class="markdownIt-Anchor" href="#-1046">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90-copyonwritearraylist">#</a>â­â­ CopyOnWriteArrayList</h4>
<blockquote>
<p>CopyOnWriteArrayList çš„ä½œç”¨ï¼Ÿ</p>
<p>CopyOnWriteArrayList çš„åŸç†ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p>CopyOnWrite å­—é¢æ„æ€ä¸ºå†™å…¥æ—¶å¤åˆ¶ã€‚CopyOnWriteArrayList æ˜¯çº¿ç¨‹å®‰å…¨çš„ ArrayListã€‚</p>
<p><strong>åŸç†</strong></p>
<ul>
<li>åœ¨  <code>CopyOnWriteAarrayList</code>  ä¸­ï¼Œè¯»æ“ä½œä¸åŒæ­¥ï¼Œå› ä¸ºå®ƒä»¬åœ¨å†…éƒ¨æ•°ç»„çš„å¿«ç…§ä¸Šå·¥ä½œï¼Œæ‰€ä»¥å¤šä¸ªè¿­ä»£å™¨å¯ä»¥åŒæ—¶éå†è€Œä¸ä¼šç›¸äº’é˜»å¡ï¼ˆ1,2,4ï¼‰ã€‚</li>
<li>æ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯åŒæ­¥çš„ã€‚ä»–ä»¬åœ¨å¤‡ä»½æ•°ç»„ï¼ˆ3ï¼‰çš„å‰¯æœ¬ä¸Šå·¥ä½œã€‚å†™æ“ä½œå®Œæˆåï¼Œåå¤‡é˜µåˆ—å°†è¢«æ›¿æ¢ä¸ºå¤åˆ¶çš„é˜µåˆ—ï¼Œå¹¶é‡Šæ”¾é”å®šã€‚æ”¯æŒæ•°ç»„å˜å¾—æ˜“å˜ï¼Œæ‰€ä»¥æ›¿æ¢æ•°ç»„çš„è°ƒç”¨æ˜¯åŸå­ï¼ˆ5ï¼‰ã€‚</li>
<li>å†™æ“ä½œååˆ›å»ºçš„è¿­ä»£å™¨å°†èƒ½å¤Ÿçœ‹åˆ°ä¿®æ”¹çš„ç»“æ„ï¼ˆ6,7ï¼‰ã€‚</li>
<li>å†™æ—¶å¤åˆ¶é›†åˆè¿”å›çš„è¿­ä»£å™¨ä¸ä¼šæŠ›å‡º ConcurrentModificationExceptionï¼Œå› ä¸ºå®ƒä»¬åœ¨æ•°ç»„çš„å¿«ç…§ä¸Šå·¥ä½œï¼Œå¹¶ä¸”æ— è®ºåç»­çš„ä¿®æ”¹ï¼ˆ2,4ï¼‰å¦‚ä½•ï¼Œéƒ½ä¼šåƒè¿­ä»£å™¨åˆ›å»ºæ—¶é‚£æ ·å®Œå…¨è¿”å›å…ƒç´ ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/container/CopyOnWriteArrayList.png" alt="img"></p>
<h3 id="-1047"><a class="markdownIt-Anchor" href="#-1047">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B9%B6%E5%8F%91%E9%94%81">#</a>å¹¶å‘é”</h3>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E9%94%81.md">Java å¹¶å‘é” (opens new window)</a></p>
</blockquote>
<h4 id="-1048"><a class="markdownIt-Anchor" href="#-1048">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90-%E9%94%81%E7%B1%BB%E5%9E%8B">#</a>â­â­ é”ç±»å‹</h4>
<blockquote>
<p>Java ä¸­æœ‰å“ªäº›é”ï¼Ÿ</p>
<p>è¿™äº›é”æœ‰ä»€ä¹ˆç‰¹æ€§ï¼Ÿ</p>
</blockquote>
<p><strong>å¯é‡å…¥é”</strong></p>
<ul>
<li><strong> <code>ReentrantLock</code>  ã€ <code>ReentrantReadWriteLock</code>  æ˜¯å¯é‡å…¥é”</strong>ã€‚è¿™ç‚¹ï¼Œä»å…¶å‘½åä¹Ÿä¸éš¾çœ‹å‡ºã€‚</li>
<li><strong> <code>synchronized</code>  ä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”</strong>ã€‚</li>
</ul>
<p><strong>å…¬å¹³é”ä¸éå…¬å¹³é”</strong></p>
<ul>
<li><strong> <code>synchronized</code>  åªæ”¯æŒéå…¬å¹³é”</strong>ã€‚</li>
<li><strong> <code>ReentrantLock</code>  ã€ <code>ReentrantReadWriteLock</code> ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ï¼Œä½†æ”¯æŒå…¬å¹³é”</strong>ã€‚</li>
</ul>
<p><strong>ç‹¬äº«é”ä¸å…±äº«é”</strong></p>
<ul>
<li><strong> <code>synchronized</code>  ã€ <code>ReentrantLock</code>  åªæ”¯æŒç‹¬äº«é”</strong>ã€‚</li>
<li><strong> <code>ReentrantReadWriteLock</code>  å…¶å†™é”æ˜¯ç‹¬äº«é”ï¼Œå…¶è¯»é”æ˜¯å…±äº«é”</strong>ã€‚è¯»é”æ˜¯å…±äº«é”ä½¿å¾—å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œè¯»å†™ï¼Œå†™è¯» ï¼Œå†™å†™çš„è¿‡ç¨‹æ˜¯äº’æ–¥çš„ã€‚</li>
</ul>
<p><strong>æ‚²è§‚é”ä¸ä¹è§‚é”</strong></p>
<ul>
<li>æ‚²è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é€šè¿‡ä½¿ç”¨  <code>synchronized</code>  å’Œ  <code>Lock</code>  æ˜¾ç¤ºåŠ é”æ¥è¿›è¡Œäº’æ–¥åŒæ­¥ï¼Œè¿™æ˜¯ä¸€ç§é˜»å¡åŒæ­¥ã€‚</li>
<li>ä¹è§‚é”åœ¨ Java ä¸­çš„åº”ç”¨å°±æ˜¯é‡‡ç”¨ CAS æœºåˆ¶ï¼ˆCAS æ“ä½œé€šè¿‡  <code>Unsafe</code>  ç±»æä¾›ï¼Œä½†è¿™ä¸ªç±»ä¸ç›´æ¥æš´éœ²ä¸º APIï¼Œæ‰€ä»¥éƒ½æ˜¯é—´æ¥ä½¿ç”¨ï¼Œå¦‚å„ç§åŸå­ç±»ï¼‰ã€‚</li>
</ul>
<p><strong>åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</strong></p>
<p>Java 1.6 ä»¥å‰ï¼Œé‡é‡çº§é”ä¸€èˆ¬æŒ‡çš„æ˜¯  <code>synchronized</code>  ï¼Œè€Œè½»é‡çº§é”æŒ‡çš„æ˜¯  <code>volatile</code> ã€‚</p>
<p>Java 1.6 ä»¥åï¼Œé’ˆå¯¹  <code>synchronized</code>  åšäº†å¤§é‡ä¼˜åŒ–ï¼Œå¼•å…¥ 4 ç§é”çŠ¶æ€ï¼š æ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”å¯ä»¥å•å‘çš„ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†ä»è½»é‡çº§é”å‡çº§åˆ°é‡é‡çº§é” ã€‚</p>
<p><strong>åˆ†æ®µé”</strong></p>
<p>åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ã€‚å…¸å‹ï¼šJDK1.7 ä¹‹å‰çš„  <code>ConcurrentHashMap</code></p>
<p><strong>æ˜¾ç¤ºé”å’Œå†…ç½®é”</strong></p>
<ul>
<li>å†…ç½®é”ï¼š <code>synchronized</code></li>
<li>æ˜¾ç¤ºé”ï¼š <code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code>  ç­‰ã€‚</li>
</ul>
<h4 id="-1049"><a class="markdownIt-Anchor" href="#-1049">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90-aqs">#</a>â­â­ AQS</h4>
<blockquote>
<p>ä»€ä¹ˆæ˜¯ AQSï¼Ÿ</p>
<p>AQS çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>AQS çš„åŸç†ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p><code>AbstractQueuedSynchronizer</code> ï¼ˆç®€ç§° <strong>AQS</strong>ï¼‰æ˜¯<strong>é˜Ÿåˆ—åŒæ­¥å™¨</strong>ï¼Œé¡¾åæ€ä¹‰ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¤„ç†åŒæ­¥ã€‚å®ƒæ˜¯å¹¶å‘é”å’Œå¾ˆå¤šåŒæ­¥å·¥å…·ç±»çš„å®ç°åŸºçŸ³ï¼ˆå¦‚  <code>ReentrantLock</code> ã€ <code>ReentrantReadWriteLock</code> ã€ <code>Semaphore</code>  ç­‰ï¼‰ã€‚</p>
<p><strong>AQS æä¾›äº†å¯¹ç‹¬äº«é”ä¸å…±äº«é”çš„æ”¯æŒ</strong>ã€‚</p>
<p><strong>åŸç†</strong></p>
<p>ï¼ˆ1ï¼‰æ•°æ®ç»“æ„</p>
<ul>
<li>
<pre><code>  state
  <pre class="line-numbers language-none"><code class="language-none">
 

\- AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  volatile
  <pre class="line-numbers language-none"><code class="language-none">
	 

	å˜é‡æ¥

	 

	ç»´æŠ¤åŒæ­¥çŠ¶æ€

	ã€‚

	- è¿™ä¸ªæ•´æ•°çŠ¶æ€çš„æ„ä¹‰ç”±å­ç±»æ¥èµ‹äºˆï¼Œå¦‚&#96;ReentrantLock&#96; ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºæ‰€æœ‰è€…çº¿ç¨‹å·²ç»é‡å¤è·å–è¯¥é”çš„æ¬¡æ•°ï¼Œ&#96;Semaphore&#96; ä¸­è¯¥çŠ¶æ€å€¼è¡¨ç¤ºå‰©ä½™çš„è®¸å¯æ•°é‡ã€‚

- &#96;head&#96; å’Œ &#96;tail&#96; - AQS **ç»´æŠ¤äº†ä¸€ä¸ª &#96;Node&#96; ç±»å‹ï¼ˆAQS çš„å†…éƒ¨ç±»ï¼‰çš„åŒé“¾è¡¨æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†**ã€‚è¿™ä¸ªåŒé“¾è¡¨æ˜¯ä¸€ä¸ªåŒå‘çš„ FIFO é˜Ÿåˆ—ï¼Œé€šè¿‡ &#96;head&#96; å’Œ &#96;tail&#96; æŒ‡é’ˆè¿›è¡Œè®¿é—®ã€‚å½“ **æœ‰çº¿ç¨‹è·å–é”å¤±è´¥åï¼Œå°±è¢«æ·»åŠ åˆ°é˜Ÿåˆ—æœ«å°¾**ã€‚

ï¼ˆ2ï¼‰è·å–ç‹¬å é”

AQS ä¸­ä½¿ç”¨ &#96;acquire(int arg)&#96; æ–¹æ³•è·å–ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š

1. å…ˆå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚
2. å¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼ŒAQS ä¼šä¸æ–­å°è¯•åˆ©ç”¨ CAS æ“ä½œå°†å½“å‰çº¿ç¨‹æ’å…¥ç­‰å¾…åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚
3. æ¥ç€ï¼Œä¸æ–­å°è¯•ä¸ºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹èŠ‚ç‚¹è·å–ç‹¬å é”ã€‚

ï¼ˆ3ï¼‰é‡Šæ”¾ç‹¬å é”

AQS ä¸­ä½¿ç”¨ &#96;release(int arg)&#96; æ–¹æ³•é‡Šæ”¾ç‹¬å é”ï¼Œå…¶å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š

1. å…ˆå°è¯•è·å–è§£é”çº¿ç¨‹çš„åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€ä¸æˆåŠŸï¼Œåˆ™ç»“æŸæ–¹æ³•ï¼Œç›´æ¥è¿”å›ã€‚
2. å¦‚æœè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼ŒAQS ä¼šå°è¯•å”¤é†’å½“å‰çº¿ç¨‹èŠ‚ç‚¹çš„åç»§èŠ‚ç‚¹ã€‚

ï¼ˆ4ï¼‰è·å–å…±äº«é”

AQS ä¸­ä½¿ç”¨ &#96;acquireShared(int arg)&#96; æ–¹æ³•è·å–å…±äº«é”ã€‚

&#96;acquireShared&#96; æ–¹æ³•å’Œ &#96;acquire&#96; æ–¹æ³•çš„é€»è¾‘å¾ˆç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºè‡ªæ—‹çš„æ¡ä»¶ä»¥åŠèŠ‚ç‚¹å‡ºé˜Ÿçš„æ“ä½œæœ‰æ‰€ä¸åŒã€‚

æˆåŠŸè·å¾—å…±äº«é”çš„æ¡ä»¶å¦‚ä¸‹ï¼š

- &#96;tryAcquireShared(arg)&#96; è¿”å›å€¼å¤§äºç­‰äº 0 ï¼ˆè¿™æ„å‘³ç€å…±äº«é”çš„ permit è¿˜æ²¡æœ‰ç”¨å®Œï¼‰ã€‚
- å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ã€‚

ï¼ˆ5ï¼‰é‡Šæ”¾å…±äº«é”

AQS ä¸­ä½¿ç”¨ &#96;releaseShared(int arg)&#96; æ–¹æ³•é‡Šæ”¾å…±äº«é”ã€‚

&#96;releaseShared&#96; é¦–å…ˆä¼šå°è¯•é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è§£é”ä¸€ä¸ªæˆ–å¤šä¸ªåç»§çº¿ç¨‹èŠ‚ç‚¹ã€‚é‡Šæ”¾å…±äº«é”å’Œé‡Šæ”¾ç‹¬äº«é”æµç¨‹å¤§ä½“ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š

å¯¹äºç‹¬äº«æ¨¡å¼ï¼Œå¦‚æœéœ€è¦ SIGNALï¼Œé‡Šæ”¾ä»…ç›¸å½“äºè°ƒç”¨å¤´èŠ‚ç‚¹çš„ &#96;unparkSuccessor&#96;ã€‚

#### [#](https:&#x2F;&#x2F;dunwu.github.io&#x2F;javacore&#x2F;java-interview.html#â­â­-reentrantlock)â­â­ ReentrantLock

&gt; ä»€ä¹ˆæ˜¯ ReentrantLockï¼Ÿ
&gt;
&gt; ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Ÿ
&gt;
&gt; ReentrantLock æœ‰ä»€ä¹ˆç”¨ï¼Ÿ
&gt;
&gt; ReentrantLock åŸç†ï¼Ÿ

**ä½œç”¨**

**&#96;ReentrantLock&#96; æä¾›äº†ä¸€ç»„æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„ã€å®šæ—¶çš„ä»¥åŠå¯ä¸­æ–­çš„é”æ“ä½œ**

&#96;ReentrantLock&#96; çš„ç‰¹æ€§å¦‚ä¸‹ï¼š

- **&#96;ReentrantLock&#96; æä¾›äº†ä¸ &#96;synchronized&#96; ç›¸åŒçš„äº’æ–¥æ€§ã€å†…å­˜å¯è§æ€§å’Œå¯é‡å…¥æ€§**ã€‚

- &#96;ReentrantLock&#96; æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰ä¸¤ç§æ¨¡å¼ã€‚

- &#96;&#96;&#96;
	ReentrantLock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  å®ç°äº†

   

  <pre class="line-numbers language-none"><code class="language-none">Lock<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

   

  æ¥å£ï¼Œæ”¯æŒäº†

   

  <pre class="line-numbers language-none"><code class="language-none">synchronized<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

   

  æ‰€ä¸å…·å¤‡çš„

  çµæ´»æ€§

  ã€‚

  - `synchronized` æ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹
  - `synchronized` æ— æ³•åœ¨è¯·æ±‚è·å–ä¸€ä¸ªé”æ—¶æ— ä¼‘æ­¢åœ°ç­‰å¾…

</code></pre>
</li>
</ul>
<p><strong>åŸç†</strong></p>
<p><code>ReentrantLock</code>  åŸºäºå…¶å†…éƒ¨ç±»  <code>ReentrantLock.Sync</code>  å®ç°ï¼Œ <code>Sync</code>  ç»§æ‰¿è‡ª AQSã€‚å®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š</p>
<ul>
<li><code>ReentrantLock.FairSync</code>  - å…¬å¹³é”ã€‚</li>
<li><code>ReentrantLock.NonfairSync</code>  - éå…¬å¹³é”ã€‚</li>
</ul>
<p>æœ¬è´¨ä¸Šï¼Œå°±æ˜¯åŸºäº AQS å®ç°ã€‚</p>
<h4 id="-1050"><a class="markdownIt-Anchor" href="#-1050">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-reentrantreadwritelock">#</a>â­ ReentrantReadWriteLock</h4>
<blockquote>
<p>ReentrantReadWriteLock æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ReentrantReadWriteLock çš„ä½œç”¨ï¼Ÿ</p>
<p>ReentrantReadWriteLock çš„åŸç†ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p><code>ReentrantReadWriteLock</code>  æ˜¯ä¸€ä¸ª<strong>å¯é‡å…¥çš„è¯»å†™é”</strong>ã€‚<strong> <code>ReentrantReadWriteLock</code>  ç»´æŠ¤äº†ä¸€å¯¹è¯»å†™é”ï¼Œå°†è¯»å†™é”åˆ†å¼€ï¼Œæœ‰åˆ©äºæé«˜å¹¶å‘æ•ˆç‡</strong>ã€‚</p>
<p><strong>åŸç†</strong></p>
<p><code>ReentrantReadWriteLock</code>  æœ¬è´¨ä¸Šä¹Ÿæ˜¯åŸºäº AQS å®ç°ã€‚æœ‰ä¸‰ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p>
<ul>
<li><code>sync</code>  - å†…éƒ¨ç±»  <code>ReentrantReadWriteLock.Sync</code>  å¯¹è±¡ã€‚ä¸  <code>ReentrantLock</code>  ç±»ä¼¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š <code>ReentrantReadWriteLock.FairSync</code>  å’Œ  <code>ReentrantReadWriteLock.NonfairSync</code>  ï¼Œåˆ†åˆ«è¡¨ç¤ºå…¬å¹³é”å’Œéå…¬å¹³é”çš„å®ç°ã€‚</li>
<li><code>readerLock</code>  - å†…éƒ¨ç±»  <code>ReentrantReadWriteLock.ReadLock</code>  å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠè¯»é”ã€‚</li>
<li><code>writerLock</code>  - å†…éƒ¨ç±»  <code>ReentrantReadWriteLock.WriteLock</code>  å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€æŠŠå†™é”ã€‚</li>
</ul>
<h4 id="-1051"><a class="markdownIt-Anchor" href="#-1051">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-condition">#</a>â­ Condition</h4>
<blockquote>
<p>Condition æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
<p>ä½¿ç”¨ Lock çš„çº¿ç¨‹ï¼Œå½¼æ­¤å¦‚ä½•é€šä¿¡ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p>å¯ä»¥ç†è§£ä¸ºï¼Œä»€ä¹ˆæ ·çš„é”é…ä»€ä¹ˆæ ·çš„é’¥åŒ™ã€‚</p>
<p><strong>å†…ç½®é”ï¼ˆ <code>synchronized</code> ï¼‰é…åˆå†…ç½®æ¡ä»¶é˜Ÿåˆ—ï¼ˆ <code>wait</code> ã€ <code>notify</code> ã€ <code>notifyAll</code>  ï¼‰ï¼Œæ˜¾å¼é”ï¼ˆ <code>Lock</code> ï¼‰é…åˆæ˜¾å¼æ¡ä»¶é˜Ÿåˆ—ï¼ˆ <code>Condition</code>  ï¼‰</strong>ã€‚</p>
<h4 id="-1052"><a class="markdownIt-Anchor" href="#-1052">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90-%E6%AD%BB%E9%94%81">#</a>â­â­ æ­»é”</h4>
<blockquote>
<p>å¦‚ä½•é¿å…æ­»é”ï¼Ÿ</p>
</blockquote>
<ul>
<li>é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”</li>
<li>é¿å…ä¸€ä¸ªçº¿ç¨‹åœ¨é”å†…åŒæ—¶å ç”¨å¤šä¸ªèµ„æºï¼Œå°½é‡ä¿è¯æ¯ä¸ªé”åªå ç”¨ä¸€ä¸ªèµ„æº</li>
<li>å°è¯•ä½¿ç”¨å®šæ—¶é” lock.tryLock (timeout)ï¼Œé¿å…é”ä¸€ç›´ä¸èƒ½é‡Šæ”¾</li>
<li>å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’Œè§£é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸­é‡Œï¼Œå¦åˆ™ä¼šå‡ºç°è§£é”å¤±è´¥çš„æƒ…å†µã€‚</li>
</ul>
<h3 id="-1053"><a class="markdownIt-Anchor" href="#-1053">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%8E%9F%E5%AD%90%E5%8F%98%E9%87%8F%E7%B1%BB">#</a>åŸå­å˜é‡ç±»</h3>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%8E%9F%E5%AD%90%E7%B1%BB.md">Java åŸå­ç±» (opens new window)</a></p>
</blockquote>
<h4 id="-1054"><a class="markdownIt-Anchor" href="#-1054">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-%E5%8E%9F%E5%AD%90%E7%B1%BB%E7%AE%80%E4%BB%8B">#</a>â­ åŸå­ç±»ç®€ä»‹</h4>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦ç”¨åŸå­ç±»ï¼Ÿ</p>
<p>ç”¨è¿‡å“ªäº›åŸå­ç±»ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p>å¸¸è§„çš„é”ï¼ˆ <code>Lock</code> ã€ <code>sychronized</code> ï¼‰ç”±äºæ˜¯é˜»å¡å¼çš„ï¼ŒåŠ¿å¿…å½±å“å¹¶å‘ååé‡ã€‚</p>
<p><code>volatile</code>  å·ç§°è½»é‡çº§çš„é”ï¼Œä½†ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p>
<p>ä¸ºäº†å…¼é¡¾åŸå­æ€§å’Œé”çš„æ€§èƒ½é—®é¢˜ï¼Œæ‰€ä»¥å¼•å…¥äº†åŸå­ç±»ã€‚</p>
<p><strong>ç±»å‹</strong></p>
<p>åŸå­å˜é‡ç±»å¯ä»¥åˆ†ä¸º 4 ç»„ï¼š</p>
<ul>
<li>åŸºæœ¬ç±»å‹
<ul>
<li><code>AtomicBoolean</code>  - å¸ƒå°”ç±»å‹åŸå­ç±»</li>
<li><code>AtomicInteger</code>  - æ•´å‹åŸå­ç±»</li>
<li><code>AtomicLong</code>  - é•¿æ•´å‹åŸå­ç±»</li>
</ul>
</li>
<li>å¼•ç”¨ç±»å‹
<ul>
<li><code>AtomicReference</code>  - å¼•ç”¨ç±»å‹åŸå­ç±»</li>
<li><code>AtomicMarkableReference</code>  - å¸¦æœ‰æ ‡è®°ä½çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li>
<li><code>AtomicStampedReference</code>  - å¸¦æœ‰ç‰ˆæœ¬å·çš„å¼•ç”¨ç±»å‹åŸå­ç±»</li>
</ul>
</li>
<li>æ•°ç»„ç±»å‹
<ul>
<li><code>AtomicIntegerArray</code>  - æ•´å½¢æ•°ç»„åŸå­ç±»</li>
<li><code>AtomicLongArray</code>  - é•¿æ•´å‹æ•°ç»„åŸå­ç±»</li>
<li><code>AtomicReferenceArray</code>  - å¼•ç”¨ç±»å‹æ•°ç»„åŸå­ç±»</li>
</ul>
</li>
<li>å±æ€§æ›´æ–°å™¨ç±»å‹
<ul>
<li><code>AtomicIntegerFieldUpdater</code>  - æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li>
<li><code>AtomicLongFieldUpdater</code>  - é•¿æ•´å‹å­—æ®µçš„åŸå­æ›´æ–°å™¨ã€‚</li>
<li><code>AtomicReferenceFieldUpdater</code>  - åŸå­æ›´æ–°å¼•ç”¨ç±»å‹é‡Œçš„å­—æ®µã€‚</li>
</ul>
</li>
</ul>
<h4 id="-1055"><a class="markdownIt-Anchor" href="#-1055">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-%E5%8E%9F%E5%AD%90%E7%B1%BB%E7%9A%84%E5%8E%9F%E7%90%86">#</a>â­ åŸå­ç±»çš„åŸç†</h4>
<ol>
<li>å¤„ç†å™¨å®ç°åŸå­æ“ä½œï¼šä½¿ç”¨æ€»çº¿é”ä¿è¯åŸå­æ€§ï¼Œä½¿ç”¨ç¼“å­˜é”ä¿è¯åŸå­æ€§ï¼ˆä¿®æ”¹å†…å­˜åœ°å€ï¼Œç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ï¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”± 2 ä¸ªä»¥ä¸Šçš„å¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®ï¼‰</li>
<li>JAVA å®ç°åŸå­æ“ä½œï¼šå¾ªç¯ä½¿ç”¨ CAS ï¼ˆè‡ªæ—‹ CASï¼‰å®ç°åŸå­æ“ä½œ</li>
</ol>
<h3 id="-1056"><a class="markdownIt-Anchor" href="#-1056">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB">#</a>å¹¶å‘å·¥å…·ç±»</h3>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB.md">Java å¹¶å‘å·¥å…·ç±» (opens new window)</a></p>
</blockquote>
<h4 id="-1057"><a class="markdownIt-Anchor" href="#-1057">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-countdownlatch">#</a>â­ CountDownLatch</h4>
<blockquote>
<p>CountDownLatch ä½œç”¨ï¼Ÿ</p>
<p>CountDownLatch åŸç†ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p>å­—é¢æ„æ€ä¸º <strong>é€’å‡è®¡æ•°é”</strong>ã€‚ç”¨äºæ§åˆ¶ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ç­‰å¾…å¤šä¸ªçº¿ç¨‹ã€‚</p>
<p><code>CountDownLatch</code>  ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ countï¼Œè¡¨ç¤ºéœ€è¦ç­‰å¾…çš„äº‹ä»¶æ•°é‡ã€‚ <code>countDown</code>  æ–¹æ³•é€’å‡è®¡æ•°å™¨ï¼Œè¡¨ç¤ºæœ‰ä¸€ä¸ªäº‹ä»¶å·²ç»å‘ç”Ÿã€‚è°ƒç”¨  <code>await</code>  æ–¹æ³•çš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ç›´åˆ°è®¡æ•°å™¨ä¸ºé›¶ï¼Œæˆ–è€…ç­‰å¾…ä¸­çš„çº¿ç¨‹ä¸­æ–­ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ã€‚</p>
<p><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/CountDownLatch.png" alt="img"></p>
<p><strong>åŸç†</strong></p>
<p><code>CountDownLatch</code>  æ˜¯åŸºäº AQS ( <code>AbstractQueuedSynchronizer</code> ) å®ç°çš„ã€‚</p>
<h4 id="-1058"><a class="markdownIt-Anchor" href="#-1058">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-cyclicbarrier">#</a>â­ CyclicBarrier</h4>
<blockquote>
<p>CyclicBarrier æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
<p>CyclicBarrier çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>CyclicBarrier å’Œ CountDownLatch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p>å­—é¢æ„æ€æ˜¯ <strong>å¾ªç¯æ …æ </strong>ã€‚<strong> <code>CyclicBarrier</code>  å¯ä»¥è®©ä¸€ç»„çº¿ç¨‹ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼ˆéµå¾ªå­—é¢æ„æ€ï¼Œä¸å¦¨ç§°è¿™ä¸ªçŠ¶æ€ä¸ºæ …æ ï¼‰ä¹‹åå†å…¨éƒ¨åŒæ—¶æ‰§è¡Œ</strong>ã€‚ä¹‹æ‰€ä»¥å«å¾ªç¯æ …æ æ˜¯å› ä¸ºï¼šå½“æ‰€æœ‰ç­‰å¾…çº¿ç¨‹éƒ½è¢«é‡Šæ”¾ä»¥åï¼Œ <code>CyclicBarrier</code>  å¯ä»¥è¢«é‡ç”¨ã€‚</p>
<p><code>CyclicBarrier</code>  ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ countã€‚æ¯æ¬¡æ‰§è¡Œ  <code>await</code>  æ–¹æ³•ä¹‹åï¼Œcount åŠ  1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å’Œè®¾ç½®çš„å€¼ç›¸ç­‰ï¼Œç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/CyclicBarrier.png" alt="img"></p>
<p><strong>åŸç†</strong></p>
<p><code>CyclicBarrier</code>  æ˜¯åŸºäº  <code>ReentrantLock</code>  å’Œ  <code>Condition</code>  å®ç°çš„ã€‚</p>
<p><strong>åŒºåˆ«</strong></p>
<p><code>CyclicBarrier</code>  å’Œ  <code>CountDownLatch</code>  éƒ½å¯ä»¥ç”¨æ¥è®©ä¸€ç»„çº¿ç¨‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹ã€‚ä¸  <code>CyclicBarrier</code>  ä¸åŒçš„æ˜¯ï¼Œ <code>CountdownLatch</code>  ä¸èƒ½é‡ç”¨ã€‚</p>
<h4 id="-1059"><a class="markdownIt-Anchor" href="#-1059">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-semaphore">#</a>â­ Semaphore</h4>
<blockquote>
<p>Semaphore ä½œç”¨ï¼Ÿ</p>
</blockquote>
<p><strong>ä½œç”¨</strong></p>
<p>å­—é¢æ„æ€ä¸º <strong>ä¿¡å·é‡</strong>ã€‚ <code>Semaphore</code>  ç”¨æ¥æ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªç‰¹å®šèµ„æºçš„æ“ä½œæ•°é‡ï¼Œæˆ–è€…åŒæ—¶æ‰§è¡ŒæŸä¸ªæŒ‡å®šæ“ä½œçš„æ•°é‡ã€‚</p>
<p><code>Semaphore</code>  ç®¡ç†ç€ä¸€ç»„è™šæ‹Ÿçš„è®¸å¯ï¼ˆpermitï¼‰ï¼Œpermit çš„åˆå§‹æ•°é‡å¯é€šè¿‡æ„é€ æ–¹æ³•æ¥æŒ‡å®šã€‚æ¯æ¬¡æ‰§è¡Œ  <code>acquire</code>  æ–¹æ³•å¯ä»¥è·å–ä¸€ä¸ª permitï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼›è€Œ  <code>release</code>  æ–¹æ³•å¯ä»¥é‡Šæ”¾ä¸€ä¸ª permitã€‚</p>
<ul>
<li><code>Semaphore</code>  å¯ä»¥ç”¨äºå®ç°èµ„æºæ± ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€‚</li>
<li><code>Semaphore</code>  å¯ä»¥ç”¨äºå°†ä»»ä½•ä¸€ç§å®¹å™¨å˜æˆæœ‰ç•Œé˜»å¡å®¹å™¨ã€‚</li>
</ul>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/Semaphore.png" alt="img"></p>
<h3 id="-1060"><a class="markdownIt-Anchor" href="#-1060">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E7%BA%BF%E7%A8%8B%E6%B1%A0">#</a>çº¿ç¨‹æ± </h3>
<blockquote>
<p>ğŸ‘‰ å‚è€ƒé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://github.com/dunwu/javacore/blob/master/docs/concurrent/Java%E7%BA%BF%E7%A8%8B%E6%B1%A0.md">Java çº¿ç¨‹æ±  (opens new window)</a></p>
</blockquote>
<h4 id="-1061"><a class="markdownIt-Anchor" href="#-1061">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90%E2%AD%90-threadpoolexecutor">#</a>â­â­ ThreadPoolExecutor</h4>
<blockquote>
<p><code>ThreadPoolExecutor</code>  æœ‰å“ªäº›å‚æ•°ï¼Œå„è‡ªæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p>
<p><code>ThreadPoolExecutor</code>  å·¥ä½œåŸç†ï¼Ÿ</p>
</blockquote>
<p><strong>åŸç†</strong></p>
<p><img src="https://raw.githubusercontent.com/dunwu/images/dev/cs/java/javacore/concurrent/java-thread-pool_1.png" alt="img"></p>
<p><strong>å‚æ•°</strong></p>
<p><code>java.uitl.concurrent.ThreadPoolExecutor</code>  ç±»æ˜¯  <code>Executor</code>  æ¡†æ¶ä¸­æœ€æ ¸å¿ƒçš„ä¸€ä¸ªç±»ã€‚</p>
<p>ThreadPoolExecutor æœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå‰ä¸‰ä¸ªéƒ½æ˜¯åŸºäºç¬¬å››ä¸ªå®ç°ã€‚ç¬¬å››ä¸ªæ„é€ æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">></span></span> workQueue<span class="token punctuation">,</span>
                          <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
                          <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>
<pre><code>  corePoolSize
  <pre class="line-numbers language-none"><code class="language-none">
 

\-

 

æ ¸å¿ƒçº¿ç¨‹æ•°é‡

ã€‚å½“æœ‰æ–°ä»»åŠ¡é€šè¿‡

 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
  execute
  <pre class="line-numbers language-none"><code class="language-none">
	 

	æ–¹æ³•æäº¤æ—¶ ï¼Œçº¿ç¨‹æ± ä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼š

	- å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°å°‘äº &#96;corePoolSize&#96;ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå³ä½¿çº¿ç¨‹æ± ä¸­çš„å…¶ä»–çº¿ç¨‹æ˜¯ç©ºé—²çš„ã€‚
	- å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº &#96;corePoolSize&#96; ä¸”å°äº &#96;maximumPoolSize&#96;ï¼Œåˆ™åªæœ‰å½“ &#96;workQueue&#96; æ»¡æ—¶æ‰åˆ›å»ºæ–°çš„çº¿ç¨‹å»å¤„ç†ä»»åŠ¡ï¼›
	- å¦‚æœè®¾ç½®çš„ &#96;corePoolSize&#96; å’Œ &#96;maximumPoolSize&#96; ç›¸åŒï¼Œåˆ™åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚è¿™æ—¶å¦‚æœæœ‰æ–°ä»»åŠ¡æäº¤ï¼Œè‹¥ &#96;workQueue&#96; æœªæ»¡ï¼Œåˆ™å°†è¯·æ±‚æ”¾å…¥ &#96;workQueue&#96; ä¸­ï¼Œç­‰å¾…æœ‰ç©ºé—²çš„çº¿ç¨‹å»ä» &#96;workQueue&#96; ä¸­å–ä»»åŠ¡å¹¶å¤„ç†ï¼›
	- å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äº &#96;maximumPoolSize&#96;ï¼Œè¿™æ—¶å¦‚æœ &#96;workQueue&#96; å·²ç»æ»¡äº†ï¼Œåˆ™ä½¿ç”¨ &#96;handler&#96; æ‰€æŒ‡å®šçš„ç­–ç•¥æ¥å¤„ç†ä»»åŠ¡ï¼›
	- æ‰€ä»¥ï¼Œä»»åŠ¡æäº¤æ—¶ï¼Œåˆ¤æ–­çš„é¡ºåºä¸º &#96;corePoolSize&#96; &#x3D;&gt; &#96;workQueue&#96; &#x3D;&gt; &#96;maximumPoolSize&#96;ã€‚

- &#96;&#96;&#96;
	maximumPoolSize<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  \-

   

  æœ€å¤§çº¿ç¨‹æ•°é‡

  ã€‚

  - å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™çº¿ç¨‹æ± ä¼šå†åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚
  - å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½¿ç”¨äº†æ— ç•Œçš„ä»»åŠ¡é˜Ÿåˆ—è¿™ä¸ªå‚æ•°å°±æ²¡ä»€ä¹ˆæ•ˆæœã€‚

</code></pre>
</li>
<li>
<pre><code>  keepAliveTime
  <pre class="line-numbers language-none"><code class="language-none">
	ï¼š

	çº¿ç¨‹ä¿æŒæ´»åŠ¨çš„æ—¶é—´

	ã€‚

	- å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº &#96;corePoolSize&#96; çš„æ—¶å€™ï¼Œå¦‚æœè¿™æ—¶æ²¡æœ‰æ–°çš„ä»»åŠ¡æäº¤ï¼Œæ ¸å¿ƒçº¿ç¨‹å¤–çš„çº¿ç¨‹ä¸ä¼šç«‹å³é”€æ¯ï¼Œè€Œæ˜¯ä¼šç­‰å¾…ï¼Œç›´åˆ°ç­‰å¾…çš„æ—¶é—´è¶…è¿‡äº† &#96;keepAliveTime&#96;ã€‚
	- æ‰€ä»¥ï¼Œå¦‚æœä»»åŠ¡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥è°ƒå¤§è¿™ä¸ªæ—¶é—´ï¼Œæé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡ã€‚

- &#96;unit&#96; - **&#96;keepAliveTime&#96; çš„æ—¶é—´å•ä½**ã€‚æœ‰ 7 ç§å–å€¼ã€‚å¯é€‰çš„å•ä½æœ‰å¤©ï¼ˆDAYSï¼‰ï¼Œå°æ—¶ï¼ˆHOURSï¼‰ï¼Œåˆ†é’Ÿï¼ˆMINUTESï¼‰ï¼Œæ¯«ç§’(MILLISECONDS)ï¼Œå¾®ç§’(MICROSECONDS, åƒåˆ†ä¹‹ä¸€æ¯«ç§’)å’Œæ¯«å¾®ç§’(NANOSECONDS, åƒåˆ†ä¹‹ä¸€å¾®ç§’)ã€‚

- &#96;&#96;&#96;
	workQueue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

   

  \-

   

  ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—

  ã€‚ç”¨äºä¿å­˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚ å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚

  - ```
  	ArrayBlockingQueue
  	<pre class="line-numbers language-none"><code class="language-none">
	 

	\-

	 

	æœ‰ç•Œé˜»å¡é˜Ÿåˆ—

	ã€‚

	- æ­¤é˜Ÿåˆ—æ˜¯**åŸºäºæ•°ç»„çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰**ã€‚
	- æ­¤é˜Ÿåˆ—åˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ã€‚

- &#96;&#96;&#96;
	LinkedBlockingQueue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

  	 

  	\-

  	 

  	æ— ç•Œé˜»å¡é˜Ÿåˆ—

  	ã€‚

  	- æ­¤é˜Ÿåˆ—æ˜¯**åŸºäºé“¾è¡¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼ˆFIFOï¼‰**ã€‚
  	- å¦‚æœåˆ›å»ºæ—¶æ²¡æœ‰æŒ‡å®šæ­¤é˜Ÿåˆ—å¤§å°ï¼Œåˆ™é»˜è®¤ä¸º `Integer.MAX_VALUE`ã€‚
  	- ååé‡é€šå¸¸è¦é«˜äº `ArrayBlockingQueue`ã€‚
  	- ä½¿ç”¨ `LinkedBlockingQueue` æ„å‘³ç€ï¼š `maximumPoolSize` å°†ä¸èµ·ä½œç”¨ï¼Œçº¿ç¨‹æ± èƒ½åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ä¸º `corePoolSize`ï¼Œå› ä¸ºä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—ã€‚
  	- `Executors.newFixedThreadPool` ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚

  - ```
  	SynchronousQueue
  	```

  	 

  	\-

  	 

  	ä¸ä¼šä¿å­˜æäº¤çš„ä»»åŠ¡ï¼Œè€Œæ˜¯å°†ç›´æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡

  	ã€‚

  	- æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ã€‚
  	- ååé‡é€šå¸¸è¦é«˜äº `LinkedBlockingQueue`ã€‚
  	- `Executors.newCachedThreadPool` ä½¿ç”¨äº†è¿™ä¸ªé˜Ÿåˆ—ã€‚

  - `PriorityBlockingQueue` - **å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—**ã€‚

</code></pre>
</li>
<li>
<p><code>threadFactory</code>  - <strong>çº¿ç¨‹å·¥å‚</strong>ã€‚å¯ä»¥é€šè¿‡çº¿ç¨‹å·¥å‚ç»™æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹è®¾ç½®æ›´æœ‰æ„ä¹‰çš„åå­—ã€‚</p>
</li>
<li>
<p><code>handler</code>  - é¥±å’Œç­–ç•¥ã€‚å®ƒæ˜¯ RejectedExecutionHandler ç±»å‹çš„å˜é‡ã€‚å½“é˜Ÿåˆ—å’Œçº¿ç¨‹æ± éƒ½æ»¡äº†ï¼Œè¯´æ˜çº¿ç¨‹æ± å¤„äºé¥±å’ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†æäº¤çš„æ–°ä»»åŠ¡ã€‚çº¿ç¨‹æ± æ”¯æŒä»¥ä¸‹ç­–ç•¥ï¼š</p>
<ul>
<li><code>AbortPolicy</code>  - ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è¿™ä¹Ÿæ˜¯é»˜è®¤ç­–ç•¥ã€‚</li>
<li><code>DiscardPolicy</code>  - ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li><code>DiscardOldestPolicy</code>  - ä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ã€‚</li>
<li><code>CallerRunsPolicy</code>  - åªç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ã€‚</li>
<li>å¦‚æœä»¥ä¸Šç­–ç•¥éƒ½ä¸èƒ½æ»¡è¶³éœ€è¦ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ç°  <code>RejectedExecutionHandler</code>  æ¥å£æ¥å®šåˆ¶å¤„ç†ç­–ç•¥ã€‚å¦‚è®°å½•æ—¥å¿—æˆ–æŒä¹…åŒ–ä¸èƒ½å¤„ç†çš„ä»»åŠ¡ã€‚</li>
</ul>
</li>
</ul>
<h4 id="-1062"><a class="markdownIt-Anchor" href="#-1062">#</a> <a target="_blank" rel="noopener" href="https://dunwu.github.io/javacore/java-interview.html#%E2%AD%90-executors">#</a>â­ Executors</h4>
<blockquote>
<p>Executors æä¾›äº†å“ªäº›å†…ç½®çš„çº¿ç¨‹æ± ï¼Ÿ</p>
<p>è¿™äº›çº¿ç¨‹æ± å„è‡ªæœ‰ä»€ä¹ˆç‰¹æ€§ï¼Ÿé€‚åˆç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ</p>
</blockquote>
<p>Executors ä¸º Executorï¼ŒExecutorServiceï¼ŒScheduledExecutorServiceï¼ŒThreadFactory å’Œ  <code>Callable</code>  ç±»æä¾›äº†ä¸€äº›å·¥å…·æ–¹æ³•ã€‚</p>
<p>ï¼ˆ1ï¼‰newSingleThreadExecutor</p>
<p><strong>åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± </strong>ã€‚</p>
<p>åªä¼šåˆ›å»ºå”¯ä¸€çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œä¿è¯æ‰€æœ‰ä»»åŠ¡æŒ‰ç…§æŒ‡å®šé¡ºåº (FIFO, LIFO, ä¼˜å…ˆçº§) æ‰§è¡Œã€‚ <strong>å¦‚æœè¿™ä¸ªå”¯ä¸€çš„çº¿ç¨‹å› ä¸ºå¼‚å¸¸ç»“æŸï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ›¿ä»£å®ƒ</strong> ã€‚</p>
<p>å•å·¥ä½œçº¿ç¨‹æœ€å¤§çš„ç‰¹ç‚¹æ˜¯ï¼š<strong>å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡</strong>ã€‚</p>
<p>ï¼ˆ2ï¼‰newFixedThreadPool</p>
<p><strong>åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </strong>ã€‚</p>
<p><strong>æ¯æ¬¡æäº¤ä¸€ä¸ªä»»åŠ¡å°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœå·¥ä½œçº¿ç¨‹æ•°é‡è¾¾åˆ°çº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™å°†æäº¤çš„ä»»åŠ¡å­˜å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­</strong>ã€‚</p>
<p><code>FixedThreadPool</code>  æ˜¯ä¸€ä¸ªå…¸å‹ä¸”ä¼˜ç§€çš„çº¿ç¨‹æ± ï¼Œå®ƒå…·æœ‰çº¿ç¨‹æ± æé«˜ç¨‹åºæ•ˆç‡å’ŒèŠ‚çœåˆ›å»ºçº¿ç¨‹æ—¶æ‰€è€—çš„å¼€é”€çš„ä¼˜ç‚¹ã€‚ä½†æ˜¯ï¼Œåœ¨çº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œå³çº¿ç¨‹æ± ä¸­æ²¡æœ‰å¯è¿è¡Œä»»åŠ¡æ—¶ï¼Œå®ƒä¸ä¼šé‡Šæ”¾å·¥ä½œçº¿ç¨‹ï¼Œè¿˜ä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚</p>
<p>ï¼ˆ3ï¼‰newCachedThreadPool</p>
<p><strong>åˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± </strong>ã€‚</p>
<ul>
<li>å¦‚æœçº¿ç¨‹æ± å¤§å°è¶…è¿‡å¤„ç†ä»»åŠ¡æ‰€éœ€è¦çš„çº¿ç¨‹æ•°ï¼Œå°±ä¼šå›æ”¶éƒ¨åˆ†ç©ºé—²çš„çº¿ç¨‹ï¼›</li>
<li>å¦‚æœé•¿æ—¶é—´æ²¡æœ‰å¾€çº¿ç¨‹æ± ä¸­æäº¤ä»»åŠ¡ï¼Œå³å¦‚æœå·¥ä½œçº¿ç¨‹ç©ºé—²äº†æŒ‡å®šçš„æ—¶é—´ï¼ˆé»˜è®¤ä¸º 1 åˆ†é’Ÿï¼‰ï¼Œåˆ™è¯¥å·¥ä½œçº¿ç¨‹å°†è‡ªåŠ¨ç»ˆæ­¢ã€‚ç»ˆæ­¢åï¼Œå¦‚æœä½ åˆæäº¤äº†æ–°çš„ä»»åŠ¡ï¼Œåˆ™çº¿ç¨‹æ± é‡æ–°åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</li>
<li>æ­¤çº¿ç¨‹æ± ä¸ä¼šå¯¹çº¿ç¨‹æ± å¤§å°åšé™åˆ¶ï¼Œçº¿ç¨‹æ± å¤§å°å®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿï¼ˆæˆ–è€…è¯´ JVMï¼‰èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹å¤§å°ã€‚ å› æ­¤ï¼Œä½¿ç”¨  <code>CachedThreadPool</code>  æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æ§åˆ¶ä»»åŠ¡çš„æ•°é‡ï¼Œå¦åˆ™ï¼Œç”±äºå¤§é‡çº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå¾ˆæœ‰ä¼šé€ æˆç³»ç»Ÿç˜«ç—ªã€‚</li>
</ul>
<p>ï¼ˆ4ï¼‰newScheduleThreadPool</p>
<p>åˆ›å»ºä¸€ä¸ªå¤§å°æ— é™çš„çº¿ç¨‹æ± ã€‚æ­¤çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡çš„éœ€æ±‚ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Harry Qu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://harryqu1229.github.io/2022/02/25/java%E5%A4%A7%E6%80%BB%E7%BB%93/">https://harryqu1229.github.io/2022/02/25/java%E5%A4%A7%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/fundamental/">fundamental</a><a class="post-meta__tags" href="/tags/javase/">javase</a><a class="post-meta__tags" href="/tags/summary/">summary</a></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-621848f44e1c3724" async="async"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/25/javase+jvm+%E7%AE%97%E6%B3%95+%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><img class="prev-cover" src="https://w.wallhaven.cc/full/v9/wallhaven-v9v9o5.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Javase + jvm + Algorithm + Design Patterns</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/25/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"><img class="next-cover" src="https://w.wallhaven.cc/full/3z/wallhaven-3zgdd3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Design Patterns - Prototype</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/02/25/%E7%AE%97%E6%B3%95%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" title="Algorithm and Data Structure notes summary"><img class="cover" src="https://w.wallhaven.cc/full/k7/wallhaven-k7v9yq.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-25</div><div class="title">Algorithm and Data Structure notes summary</div></div></a></div><div><a href="/2022/02/25/MySQL%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%E6%B1%87%E6%80%BB/" title="Mysql commonly used functions"><img class="cover" src="https://c.pxhere.com/photos/e5/15/watercolour_painting_technique_soluble_in_water_not_opaque_color_image_color_sketch_turquoise-1110070.jpg!d" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-25</div><div class="title">Mysql commonly used functions</div></div></a></div><div><a href="/2022/02/25/%E4%B8%80%E4%BA%9B%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Frontend Algorithm and Data Structure"><img class="cover" src="https://c.pxhere.com/photos/e5/15/watercolour_painting_technique_soluble_in_water_not_opaque_color_image_color_sketch_turquoise-1110070.jpg!d" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-25</div><div class="title">Frontend Algorithm and Data Structure</div></div></a></div><div><a href="/2022/02/25/%E4%B8%80%E4%BA%9B%E7%AE%97%E6%B3%95%E7%9A%84%E5%B0%8F%E6%80%BB%E7%BB%93/" title="Algorithm and Data Structure interview summary notes"><img class="cover" src="https://w.wallhaven.cc/full/k7/wallhaven-k7v9yq.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-25</div><div class="title">Algorithm and Data Structure interview summary notes</div></div></a></div><div><a href="/2022/02/25/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" title="Mysql data types"><img class="cover" src="https://w.wallhaven.cc/full/3z/wallhaven-3zgdd3.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-25</div><div class="title">Mysql data types</div></div></a></div><div><a href="/2022/02/25/%E7%AE%97%E6%B3%95%20-%20%E5%85%B6%E5%AE%83/" title="Algorithm and Data Structure - Other"><img class="cover" src="https://w.wallhaven.cc/full/wq/wallhaven-wqvov7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-25</div><div class="title">Algorithm and Data Structure - Other</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Disqus</span><span class="switch-btn"></span><span class="second-comment">Gitalk</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/6aca34ee52f40fe1b2d637474f90111e2c151939/notes-img/%E5%85%B6%E4%B8%AD%E5%8C%85%E6%8B%AC%E5%9B%BE%E7%89%87%EF%BC%9A%7B%7B%20pinTitle%20%7D%7D_m6kogp.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Harry Qu</div><div class="author-info__description">Software Engineering Student</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">171</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">89</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">60</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/HarryQu1229"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://www.linkedin.com/in/harry-qu-a0a38220a" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a><a class="social-icon" href="https://github.com/HarryQu1229" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:Harryqu666@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="weixin://dl/chat?harry666ya" target="_blank" title="Wechat"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">be healthy, stay safe</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95%E7%89%B9%E6%80%A7"><span class="toc-number">1.</span> <span class="toc-text"> Java åŸºç¡€è¯­æ³•ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%B3%A8%E9%87%8A"><span class="toc-number">1.1.</span> <span class="toc-text"> 1. æ³¨é‡Š</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text"> 2. åŸºæœ¬æ•°æ®ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%98%E9%87%8F"><span class="toc-number">1.3.</span> <span class="toc-text"> 3. å˜é‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%95%B0%E7%BB%84"><span class="toc-number">1.4.</span> <span class="toc-text"> 4. æ•°ç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.5.</span> <span class="toc-text"> 5. æšä¸¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">1.6.</span> <span class="toc-text"> 6. æ“ä½œç¬¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text"> 7. æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.8.</span> <span class="toc-text"> 8. æ§åˆ¶è¯­å¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%BC%82%E5%B8%B8"><span class="toc-number">1.9.</span> <span class="toc-text"> 9. å¼‚å¸¸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E6%B3%9B%E5%9E%8B"><span class="toc-number">1.10.</span> <span class="toc-text"> 10. æ³›å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E5%8F%8D%E5%B0%84"><span class="toc-number">1.11.</span> <span class="toc-text"> 11. åå°„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.12.</span> <span class="toc-text"> 12. æ³¨è§£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.13.</span> <span class="toc-text"> 13. åºåˆ—åŒ–</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java åŸºæœ¬æ•°æ®ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">2.1.</span> <span class="toc-text"> 1. æ•°æ®ç±»å‹åˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-2"><span class="toc-number">2.1.1.</span> <span class="toc-text"> 1.1. å€¼ç±»å‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-3"><span class="toc-number">2.1.2.</span> <span class="toc-text"> 1.2. å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-4"><span class="toc-number">2.2.</span> <span class="toc-text"> 2. æ•°æ®è½¬æ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-5"><span class="toc-number">2.2.1.</span> <span class="toc-text"> 2.1. è‡ªåŠ¨è½¬æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-6"><span class="toc-number">2.2.2.</span> <span class="toc-text"> 2.2. å¼ºåˆ¶è½¬æ¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-7"><span class="toc-number">2.3.</span> <span class="toc-text"> 3. è£…ç®±å’Œæ‹†ç®±</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-8"><span class="toc-number">2.3.1.</span> <span class="toc-text"> 3.1. åŒ…è£…ç±»ã€è£…ç®±ã€æ‹†ç®±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-9"><span class="toc-number">2.3.2.</span> <span class="toc-text"> 3.2. è‡ªåŠ¨è£…ç®±ã€è‡ªåŠ¨æ‹†ç®±</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-10"><span class="toc-number">2.3.3.</span> <span class="toc-text"> 3.3. è£…ç®±ã€æ‹†ç®±çš„åº”ç”¨å’Œæ³¨æ„ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-11"><span class="toc-number">2.3.3.1.</span> <span class="toc-text"> è£…ç®±ã€æ‹†ç®±åº”ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-12"><span class="toc-number">2.3.3.2.</span> <span class="toc-text"> è£…ç®±ã€æ‹†ç®±åº”ç”¨æ³¨æ„ç‚¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-13"><span class="toc-number">2.4.</span> <span class="toc-text"> 4. åˆ¤ç­‰é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-14"><span class="toc-number">2.4.1.</span> <span class="toc-text"> 4.1. åŒ…è£…ç±»çš„åˆ¤ç­‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-15"><span class="toc-number">2.4.2.</span> <span class="toc-text"> 4.2. String çš„åˆ¤ç­‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-16"><span class="toc-number">2.4.3.</span> <span class="toc-text"> 4.3. å®ç° equals</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-17"><span class="toc-number">2.4.4.</span> <span class="toc-text"> 4.4. hashCode å’Œ equals è¦é…å¯¹å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-18"><span class="toc-number">2.4.5.</span> <span class="toc-text"> 4.5. compareTo å’Œ equals çš„é€»è¾‘ä¸€è‡´æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-19"><span class="toc-number">2.4.6.</span> <span class="toc-text"> 4.6. å°å¿ƒ Lombok ç”Ÿæˆä»£ç çš„ â€œå‘â€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-20"><span class="toc-number">2.5.</span> <span class="toc-text"> 5. æ•°å€¼è®¡ç®—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-21"><span class="toc-number">2.5.1.</span> <span class="toc-text"> 5.1. æµ®ç‚¹æ•°è®¡ç®—é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-22"><span class="toc-number">2.5.2.</span> <span class="toc-text"> 5.2. æµ®ç‚¹æ•°ç²¾åº¦å’Œæ ¼å¼åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-23"><span class="toc-number">2.5.3.</span> <span class="toc-text"> 5.3. BigDecimal åˆ¤ç­‰é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-24"><span class="toc-number">2.5.4.</span> <span class="toc-text"> 5.4. æ•°å€¼æº¢å‡º</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-string-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java String ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-25"><span class="toc-number">3.1.</span> <span class="toc-text"> 1. String çš„ä¸å¯å˜æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-26"><span class="toc-number">3.2.</span> <span class="toc-text"> 2. String çš„æ€§èƒ½è€ƒé‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-27"><span class="toc-number">3.2.1.</span> <span class="toc-text"> 2.1. å­—ç¬¦ä¸²æ‹¼æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-28"><span class="toc-number">3.2.2.</span> <span class="toc-text"> 2.2. å­—ç¬¦ä¸²åˆ†å‰²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-29"><span class="toc-number">3.2.3.</span> <span class="toc-text"> 2.3. String.intern</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-30"><span class="toc-number">3.3.</span> <span class="toc-text"> 3. Stringã€StringBufferã€StringBuilder æœ‰ä»€ä¹ˆåŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.</span> <span class="toc-text"> Java é¢å‘å¯¹è±¡</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-31"><span class="toc-number">4.1.</span> <span class="toc-text"> 1. é¢å‘å¯¹è±¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-32"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 1.1. å°è£…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-33"><span class="toc-number">4.1.2.</span> <span class="toc-text"> 1.2. ç»§æ‰¿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-34"><span class="toc-number">4.1.2.1.</span> <span class="toc-text"> ç»§æ‰¿ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-35"><span class="toc-number">4.1.2.2.</span> <span class="toc-text"> ç»§æ‰¿çš„ç‰¹æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-36"><span class="toc-number">4.1.2.3.</span> <span class="toc-text"> ç»§æ‰¿å…³é”®å­—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-37"><span class="toc-number">4.1.3.</span> <span class="toc-text"> 1.3. å¤šæ€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-38"><span class="toc-number">4.2.</span> <span class="toc-text"> 2. ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-39"><span class="toc-number">4.3.</span> <span class="toc-text"> 3. æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-40"><span class="toc-number">4.3.1.</span> <span class="toc-text"> 3.1. æ–¹æ³•å®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-41"><span class="toc-number">4.3.2.</span> <span class="toc-text"> 3.2. æ–¹æ³•è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-42"><span class="toc-number">4.3.3.</span> <span class="toc-text"> 3.3. æ„é€ æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-43"><span class="toc-number">4.4.</span> <span class="toc-text"> 4. å˜é‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-44"><span class="toc-number">4.4.1.</span> <span class="toc-text"> 4.1. å˜é‡ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-45"><span class="toc-number">4.4.2.</span> <span class="toc-text"> 4.2. åˆ›å»ºå¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-46"><span class="toc-number">4.4.3.</span> <span class="toc-text"> 4.3. è®¿é—®å®ä¾‹å˜é‡å’Œæ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-47"><span class="toc-number">4.5.</span> <span class="toc-text"> 5. è®¿é—®æƒé™æ§åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-48"><span class="toc-number">4.5.1.</span> <span class="toc-text"> 5.1. ä»£ç ç»„ç»‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-49"><span class="toc-number">4.5.1.1.</span> <span class="toc-text"> package</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-50"><span class="toc-number">4.5.1.2.</span> <span class="toc-text"> import</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-51"><span class="toc-number">4.5.2.</span> <span class="toc-text"> 5.2. è®¿é—®æƒé™ä¿®é¥°å…³é”®å­—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-52"><span class="toc-number">4.6.</span> <span class="toc-text"> 6. æ¥å£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-53"><span class="toc-number">4.7.</span> <span class="toc-text"> 7. æŠ½è±¡ç±»</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E6%96%B9%E6%B3%95"><span class="toc-number">5.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-54"><span class="toc-number">5.1.</span> <span class="toc-text"> 1. æ–¹æ³•çš„ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-55"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 1.1. æ–¹æ³•å®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-56"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 1.2. æ–¹æ³•çš„è°ƒç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-57"><span class="toc-number">5.1.2.1.</span> <span class="toc-text"> é€’å½’è°ƒç”¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-58"><span class="toc-number">5.2.</span> <span class="toc-text"> 2. æ–¹æ³•å‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-59"><span class="toc-number">5.3.</span> <span class="toc-text"> 3. æ–¹æ³•ä¿®é¥°ç¬¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-60"><span class="toc-number">5.3.1.</span> <span class="toc-text"> 3.1. è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-61"><span class="toc-number">5.3.2.</span> <span class="toc-text"> 3.2. static</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-62"><span class="toc-number">5.3.3.</span> <span class="toc-text"> 3.3. final</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-63"><span class="toc-number">5.3.4.</span> <span class="toc-text"> 3.4. default</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-64"><span class="toc-number">5.3.5.</span> <span class="toc-text"> 3.5. abstract</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-65"><span class="toc-number">5.3.6.</span> <span class="toc-text"> 3.6. synchronized</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-66"><span class="toc-number">5.4.</span> <span class="toc-text"> 4. ç‰¹æ®Šæ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-67"><span class="toc-number">5.4.1.</span> <span class="toc-text"> 4.1. main æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-68"><span class="toc-number">5.4.2.</span> <span class="toc-text"> 4.2. æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-69"><span class="toc-number">5.4.3.</span> <span class="toc-text"> 4.3. å˜å‚æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-70"><span class="toc-number">5.4.4.</span> <span class="toc-text"> 4.4. finalize () æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-71"><span class="toc-number">5.5.</span> <span class="toc-text"> 5. è¦†å†™å’Œé‡è½½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-72"><span class="toc-number">5.6.</span> <span class="toc-text"> 6. å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E6%95%B0%E7%BB%84"><span class="toc-number">6.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java æ•°ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-73"><span class="toc-number">6.1.</span> <span class="toc-text"> 1. ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-74"><span class="toc-number">6.1.1.</span> <span class="toc-text"> 1.1. æ•°ç»„çš„ç‰¹æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-75"><span class="toc-number">6.1.2.</span> <span class="toc-text"> 1.2. æ•°ç»„å’Œå®¹å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-76"><span class="toc-number">6.1.3.</span> <span class="toc-text"> 1.3. Java æ•°ç»„çš„æœ¬è´¨æ˜¯å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-77"><span class="toc-number">6.1.4.</span> <span class="toc-text"> 1.4. Java æ•°ç»„å’Œå†…å­˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-78"><span class="toc-number">6.2.</span> <span class="toc-text"> 2. å£°æ˜æ•°ç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-79"><span class="toc-number">6.3.</span> <span class="toc-text"> 3. åˆ›å»ºæ•°ç»„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-80"><span class="toc-number">6.3.1.</span> <span class="toc-text"> 3.1. æ•°ç»„ç»´åº¦çš„å½¢å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-81"><span class="toc-number">6.3.2.</span> <span class="toc-text"> 3.2. æ•°ç»„ç»´åº¦çš„å¤§å°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-82"><span class="toc-number">6.4.</span> <span class="toc-text"> 4. è®¿é—®æ•°ç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-83"><span class="toc-number">6.5.</span> <span class="toc-text"> 5. æ•°ç»„çš„å¼•ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-84"><span class="toc-number">6.6.</span> <span class="toc-text"> 6. æ³›å‹å’Œæ•°ç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-85"><span class="toc-number">6.7.</span> <span class="toc-text"> 7. å¤šç»´æ•°ç»„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-86"><span class="toc-number">6.8.</span> <span class="toc-text"> 8. Arrays ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-87"><span class="toc-number">6.9.</span> <span class="toc-text"> 9. å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E6%9E%9A%E4%B8%BE"><span class="toc-number">7.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java æšä¸¾</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-88"><span class="toc-number">7.1.</span> <span class="toc-text"> 1. ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-89"><span class="toc-number">7.2.</span> <span class="toc-text"> 2. æšä¸¾çš„æœ¬è´¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-90"><span class="toc-number">7.3.</span> <span class="toc-text"> 3. æšä¸¾çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-91"><span class="toc-number">7.4.</span> <span class="toc-text"> 4. æšä¸¾çš„ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-92"><span class="toc-number">7.4.1.</span> <span class="toc-text"> 4.1. åŸºæœ¬ç‰¹æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-93"><span class="toc-number">7.4.2.</span> <span class="toc-text"> 4.2. æšä¸¾å¯ä»¥æ·»åŠ æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-94"><span class="toc-number">7.4.3.</span> <span class="toc-text"> 4.3. æšä¸¾å¯ä»¥å®ç°æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-95"><span class="toc-number">7.4.4.</span> <span class="toc-text"> 4.4. æšä¸¾ä¸å¯ä»¥ç»§æ‰¿</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-96"><span class="toc-number">7.5.</span> <span class="toc-text"> 5. æšä¸¾çš„åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-97"><span class="toc-number">7.5.1.</span> <span class="toc-text"> 5.1. ç»„ç»‡å¸¸é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-98"><span class="toc-number">7.5.2.</span> <span class="toc-text"> 5.2. switch çŠ¶æ€æœº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-99"><span class="toc-number">7.5.3.</span> <span class="toc-text"> 5.3. é”™è¯¯ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-100"><span class="toc-number">7.5.4.</span> <span class="toc-text"> 5.4. ç»„ç»‡æšä¸¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-101"><span class="toc-number">7.5.5.</span> <span class="toc-text"> 5.5. ç­–ç•¥æšä¸¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-102"><span class="toc-number">7.5.6.</span> <span class="toc-text"> 5.6. æšä¸¾å®ç°å•ä¾‹æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-103"><span class="toc-number">7.6.</span> <span class="toc-text"> 6. æšä¸¾å·¥å…·ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-104"><span class="toc-number">7.6.1.</span> <span class="toc-text"> 6.1. EnumSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-105"><span class="toc-number">7.6.2.</span> <span class="toc-text"> 6.2. EnumMap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-106"><span class="toc-number">7.7.</span> <span class="toc-text"> 7. å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">8.</span> <span class="toc-text"> Java æ§åˆ¶è¯­å¥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-107"><span class="toc-number">8.1.</span> <span class="toc-text"> 1. é€‰æ‹©è¯­å¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-108"><span class="toc-number">8.1.1.</span> <span class="toc-text"> 1.1. if è¯­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-109"><span class="toc-number">8.1.2.</span> <span class="toc-text"> 1.2. ifâ€¦else è¯­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-110"><span class="toc-number">8.1.3.</span> <span class="toc-text"> 1.3. ifâ€¦else ifâ€¦else è¯­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-111"><span class="toc-number">8.1.4.</span> <span class="toc-text"> 1.4. åµŒå¥—çš„ ifâ€¦else è¯­å¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-112"><span class="toc-number">8.1.5.</span> <span class="toc-text"> 1.5. switch è¯­å¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-113"><span class="toc-number">8.2.</span> <span class="toc-text"> 2. å¾ªç¯è¯­å¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-114"><span class="toc-number">8.2.1.</span> <span class="toc-text"> 2.1. while å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-115"><span class="toc-number">8.2.2.</span> <span class="toc-text"> 2.2. do while å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-116"><span class="toc-number">8.2.3.</span> <span class="toc-text"> 2.3. for å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-117"><span class="toc-number">8.2.4.</span> <span class="toc-text"> 2.4. foreach å¾ªç¯</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-118"><span class="toc-number">8.3.</span> <span class="toc-text"> 3. ä¸­æ–­è¯­å¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-119"><span class="toc-number">8.3.1.</span> <span class="toc-text"> 3.1. break å…³é”®å­—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-120"><span class="toc-number">8.3.2.</span> <span class="toc-text"> 3.2. continue å…³é”®å­—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-121"><span class="toc-number">8.3.3.</span> <span class="toc-text"> 3.3. return å…³é”®å­—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-122"><span class="toc-number">8.4.</span> <span class="toc-text"> 4. æœ€ä½³å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E5%BC%82%E5%B8%B8"><span class="toc-number">9.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java å¼‚å¸¸</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-123"><span class="toc-number">9.1.</span> <span class="toc-text"> 1. å¼‚å¸¸æ¡†æ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-124"><span class="toc-number">9.1.1.</span> <span class="toc-text"> 1.1. Throwable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-125"><span class="toc-number">9.1.2.</span> <span class="toc-text"> 1.2. Error</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-126"><span class="toc-number">9.1.3.</span> <span class="toc-text"> 1.3. Exception</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-127"><span class="toc-number">9.1.4.</span> <span class="toc-text"> 1.4. RuntimeException</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-128"><span class="toc-number">9.2.</span> <span class="toc-text"> 2. è‡ªå®šä¹‰å¼‚å¸¸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-129"><span class="toc-number">9.3.</span> <span class="toc-text"> 3. æŠ›å‡ºå¼‚å¸¸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-130"><span class="toc-number">9.4.</span> <span class="toc-text"> 4. æ•è·å¼‚å¸¸</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-131"><span class="toc-number">9.5.</span> <span class="toc-text"> 5. å¼‚å¸¸é“¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-132"><span class="toc-number">9.6.</span> <span class="toc-text"> 6. å¼‚å¸¸æ³¨æ„äº‹é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-133"><span class="toc-number">9.6.1.</span> <span class="toc-text"> 6.1. finally è¦†ç›–å¼‚å¸¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-134"><span class="toc-number">9.6.2.</span> <span class="toc-text"> 6.2. è¦†ç›–æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-135"><span class="toc-number">9.6.3.</span> <span class="toc-text"> 6.3. å¼‚å¸¸å’Œçº¿ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-136"><span class="toc-number">9.7.</span> <span class="toc-text"> 7. æœ€ä½³å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E6%B3%9B%E5%9E%8B"><span class="toc-number">10.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java æ³›å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-137"><span class="toc-number">10.1.</span> <span class="toc-text"> 1. ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-138"><span class="toc-number">10.2.</span> <span class="toc-text"> 2. æ³›å‹ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-139"><span class="toc-number">10.2.1.</span> <span class="toc-text"> 2.1. æ³›å‹ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-140"><span class="toc-number">10.2.2.</span> <span class="toc-text"> 2.2. æ³›å‹æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-141"><span class="toc-number">10.3.</span> <span class="toc-text"> 3. æ³›å‹æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-142"><span class="toc-number">10.4.</span> <span class="toc-text"> 4. ç±»å‹æ“¦é™¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-143"><span class="toc-number">10.5.</span> <span class="toc-text"> 5. æ³›å‹å’Œç»§æ‰¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-144"><span class="toc-number">10.6.</span> <span class="toc-text"> 6. ç±»å‹è¾¹ç•Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-145"><span class="toc-number">10.7.</span> <span class="toc-text"> 7. ç±»å‹é€šé…ç¬¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-146"><span class="toc-number">10.7.1.</span> <span class="toc-text"> 7.1. ä¸Šç•Œé€šé…ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-147"><span class="toc-number">10.7.2.</span> <span class="toc-text"> 7.2. ä¸‹ç•Œé€šé…ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-148"><span class="toc-number">10.7.3.</span> <span class="toc-text"> 7.3. æ— ç•Œé€šé…ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-149"><span class="toc-number">10.7.4.</span> <span class="toc-text"> 7.4. é€šé…ç¬¦å’Œå‘ä¸Šè½¬å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-150"><span class="toc-number">10.8.</span> <span class="toc-text"> 8. æ³›å‹çš„çº¦æŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-151"><span class="toc-number">10.9.</span> <span class="toc-text"> 9. æ³›å‹æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-152"><span class="toc-number">10.9.1.</span> <span class="toc-text"> 9.1. æ³›å‹å‘½å</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-153"><span class="toc-number">10.9.2.</span> <span class="toc-text"> 9.2. ä½¿ç”¨æ³›å‹çš„å»ºè®®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-154"><span class="toc-number">10.10.</span> <span class="toc-text"> 10. å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E5%8F%8D%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">11.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java åå°„å’ŒåŠ¨æ€ä»£ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-155"><span class="toc-number">11.1.</span> <span class="toc-text"> 1. åå°„ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-156"><span class="toc-number">11.1.1.</span> <span class="toc-text"> 1.1. ä»€ä¹ˆæ˜¯åå°„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-157"><span class="toc-number">11.1.2.</span> <span class="toc-text"> 1.2. åå°„çš„åº”ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-158"><span class="toc-number">11.1.3.</span> <span class="toc-text"> 1.3. åå°„çš„ç¼ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-159"><span class="toc-number">11.2.</span> <span class="toc-text"> 2. åå°„æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-160"><span class="toc-number">11.2.1.</span> <span class="toc-text"> 2.1. ç±»åŠ è½½è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-161"><span class="toc-number">11.2.2.</span> <span class="toc-text"> 2.2. Class å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-162"><span class="toc-number">11.2.3.</span> <span class="toc-text"> 2.3. æ–¹æ³•çš„åå°„è°ƒç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-163"><span class="toc-number">11.2.4.</span> <span class="toc-text"> 2.4. åå°„è°ƒç”¨çš„å¼€é”€</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-164"><span class="toc-number">11.3.</span> <span class="toc-text"> 3. ä½¿ç”¨åå°„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-165"><span class="toc-number">11.3.1.</span> <span class="toc-text"> 3.1. java.lang.reflect åŒ…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-166"><span class="toc-number">11.3.2.</span> <span class="toc-text"> 3.2. è·å– Class å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-167"><span class="toc-number">11.3.3.</span> <span class="toc-text"> 3.3. åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªç±»çš„å®ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-168"><span class="toc-number">11.3.4.</span> <span class="toc-text"> 3.4. åˆ›å»ºå®ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-169"><span class="toc-number">11.3.5.</span> <span class="toc-text"> 3.5. åˆ›å»ºæ•°ç»„å®ä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-170"><span class="toc-number">11.3.6.</span> <span class="toc-text"> 3.6. Field</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-171"><span class="toc-number">11.3.7.</span> <span class="toc-text"> 3.7. Method</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-172"><span class="toc-number">11.3.8.</span> <span class="toc-text"> 3.8. Constructor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-173"><span class="toc-number">11.3.9.</span> <span class="toc-text"> 3.9. ç»•å¼€è®¿é—®é™åˆ¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-174"><span class="toc-number">11.4.</span> <span class="toc-text"> 4. åŠ¨æ€ä»£ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-175"><span class="toc-number">11.4.1.</span> <span class="toc-text"> 4.1. é™æ€ä»£ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-176"><span class="toc-number">11.4.2.</span> <span class="toc-text"> 4.2. JDK åŠ¨æ€ä»£ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-177"><span class="toc-number">11.4.2.1.</span> <span class="toc-text"> InvocationHandler æ¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-178"><span class="toc-number">11.4.2.2.</span> <span class="toc-text"> Proxy ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-179"><span class="toc-number">11.4.2.3.</span> <span class="toc-text"> JDK åŠ¨æ€ä»£ç†å®ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-180"><span class="toc-number">11.4.2.4.</span> <span class="toc-text"> JDK åŠ¨æ€ä»£ç†å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-181"><span class="toc-number">11.4.3.</span> <span class="toc-text"> 4.3. CGLIB åŠ¨æ€ä»£ç†</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E6%B3%A8%E8%A7%A3"><span class="toc-number">12.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-182"><span class="toc-number">12.1.</span> <span class="toc-text"> 1. ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-183"><span class="toc-number">12.1.1.</span> <span class="toc-text"> 1.1. æ³¨è§£çš„å½¢å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-184"><span class="toc-number">12.1.2.</span> <span class="toc-text"> 1.2. ä»€ä¹ˆæ˜¯æ³¨è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-185"><span class="toc-number">12.1.3.</span> <span class="toc-text"> 1.3. æ³¨è§£çš„ä½œç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-186"><span class="toc-number">12.1.4.</span> <span class="toc-text"> 1.4. æ³¨è§£çš„ä»£ä»·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-187"><span class="toc-number">12.1.5.</span> <span class="toc-text"> 1.5. æ³¨è§£çš„åº”ç”¨èŒƒå›´</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-188"><span class="toc-number">12.2.</span> <span class="toc-text"> 2. å†…ç½®æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-189"><span class="toc-number">12.2.1.</span> <span class="toc-text"> 2.1. @Override</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-190"><span class="toc-number">12.2.2.</span> <span class="toc-text"> 2.2. @Deprecated</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-191"><span class="toc-number">12.2.3.</span> <span class="toc-text"> 2.3. @SuppressWarnnings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-192"><span class="toc-number">12.2.4.</span> <span class="toc-text"> 2.4. @SafeVarargs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-193"><span class="toc-number">12.2.5.</span> <span class="toc-text"> 2.5. @FunctionalInterface</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-194"><span class="toc-number">12.3.</span> <span class="toc-text"> 3. å…ƒæ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-195"><span class="toc-number">12.3.1.</span> <span class="toc-text"> 3.1. @Retention</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-196"><span class="toc-number">12.3.2.</span> <span class="toc-text"> 3.2. @Documented</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-197"><span class="toc-number">12.3.3.</span> <span class="toc-text"> 3.3. @Target</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-198"><span class="toc-number">12.3.4.</span> <span class="toc-text"> 3.4. @Inherited</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-199"><span class="toc-number">12.3.5.</span> <span class="toc-text"> 3.5. @Repeatable</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-200"><span class="toc-number">12.4.</span> <span class="toc-text"> 4. è‡ªå®šä¹‰æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-201"><span class="toc-number">12.4.1.</span> <span class="toc-text"> 4.1. æ³¨è§£çš„å®šä¹‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-202"><span class="toc-number">12.4.2.</span> <span class="toc-text"> 4.2. æ³¨è§£å±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-203"><span class="toc-number">12.4.3.</span> <span class="toc-text"> 4.3. æ³¨è§£å¤„ç†å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-204"><span class="toc-number">12.4.4.</span> <span class="toc-text"> 4.4. ä½¿ç”¨æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-205"><span class="toc-number">12.5.</span> <span class="toc-text"> 5. å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E6%AD%A3%E5%88%99%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A"><span class="toc-number">13.</span> <span class="toc-text"> Java æ­£åˆ™ä»å…¥é—¨åˆ°ç²¾é€š</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-206"><span class="toc-number">13.1.</span> <span class="toc-text"> 1. æ­£åˆ™ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-207"><span class="toc-number">13.1.1.</span> <span class="toc-text"> 1.1. æ­£åˆ™è¡¨è¾¾å¼æ˜¯ä»€ä¹ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-208"><span class="toc-number">13.1.2.</span> <span class="toc-text"> 1.2. å¦‚ä½•å­¦ä¹ æ­£åˆ™</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-209"><span class="toc-number">13.2.</span> <span class="toc-text"> 2. æ­£åˆ™å·¥å…·ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-210"><span class="toc-number">13.2.1.</span> <span class="toc-text"> 2.1. Pattern ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-211"><span class="toc-number">13.2.2.</span> <span class="toc-text"> 2.2. Matcher ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-212"><span class="toc-number">13.2.2.1.</span> <span class="toc-text"> æ ¡éªŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-213"><span class="toc-number">13.2.2.2.</span> <span class="toc-text"> æŸ¥æ‰¾</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-214"><span class="toc-number">13.2.2.3.</span> <span class="toc-text"> æ›¿æ¢</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-215"><span class="toc-number">13.3.</span> <span class="toc-text"> 3. å…ƒå­—ç¬¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-216"><span class="toc-number">13.3.1.</span> <span class="toc-text"> 3.1. åŸºæœ¬å…ƒå­—ç¬¦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-217"><span class="toc-number">13.3.1.1.</span> <span class="toc-text"> å¤šé€‰ï¼ˆ | ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-218"><span class="toc-number">13.3.1.2.</span> <span class="toc-text"> åˆ†ç»„ï¼ˆ () ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-219"><span class="toc-number">13.3.1.3.</span> <span class="toc-text"> æŒ‡å®šå•å­—ç¬¦æœ‰æ•ˆèŒƒå›´ï¼ˆ [] ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-220"><span class="toc-number">13.3.1.4.</span> <span class="toc-text"> æŒ‡å®šå•å­—ç¬¦æ— æ•ˆèŒƒå›´ï¼ˆ  [^] ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-221"><span class="toc-number">13.3.1.5.</span> <span class="toc-text"> é™åˆ¶å­—ç¬¦æ•°é‡ï¼ˆ {} ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-222"><span class="toc-number">13.3.1.6.</span> <span class="toc-text"> è½¬ä¹‰å­—ç¬¦ï¼ˆ &#x2F; ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-223"><span class="toc-number">13.3.1.7.</span> <span class="toc-text"> æŒ‡å®šè¡¨è¾¾å¼å­—ç¬¦ä¸²çš„å¼€å§‹ï¼ˆ ^ ï¼‰å’Œç»“å°¾ï¼ˆ $ ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-224"><span class="toc-number">13.3.2.</span> <span class="toc-text"> 3.2. ç­‰ä»·å­—ç¬¦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-225"><span class="toc-number">13.3.2.1.</span> <span class="toc-text"> è¡¨ç¤ºæŸä¸€ç±»å‹å­—ç¬¦çš„ç­‰ä»·å­—ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-226"><span class="toc-number">13.3.2.2.</span> <span class="toc-text"> é™åˆ¶å­—ç¬¦æ•°é‡çš„ç­‰ä»·å­—ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-227"><span class="toc-number">13.3.2.3.</span> <span class="toc-text"> å…ƒå­—ç¬¦ä¼˜å…ˆçº§é¡ºåº</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-228"><span class="toc-number">13.4.</span> <span class="toc-text"> 4. åˆ†ç»„æ„é€ </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-229"><span class="toc-number">13.4.1.</span> <span class="toc-text"> 4.1. æ•è·ä¸éæ•è·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-230"><span class="toc-number">13.4.2.</span> <span class="toc-text"> 4.2. åå‘å¼•ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-231"><span class="toc-number">13.4.2.0.1.</span> <span class="toc-text"> å¸¦ç¼–å·çš„åå‘å¼•ç”¨</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-232"><span class="toc-number">13.4.2.1.</span> <span class="toc-text"> å‘½åçš„åå‘å¼•ç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-233"><span class="toc-number">13.4.3.</span> <span class="toc-text"> 4.3. éæ•è·ç»„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-234"><span class="toc-number">13.4.4.</span> <span class="toc-text"> 4.4. é›¶å®½æ–­è¨€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-235"><span class="toc-number">13.4.4.1.</span> <span class="toc-text"> åŒ¹é… exp å‰é¢çš„ä½ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-236"><span class="toc-number">13.4.4.2.</span> <span class="toc-text"> åŒ¹é… exp åé¢çš„ä½ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-237"><span class="toc-number">13.4.4.3.</span> <span class="toc-text"> åŒ¹é…åé¢è·Ÿçš„ä¸æ˜¯ exp çš„ä½ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-238"><span class="toc-number">13.4.4.4.</span> <span class="toc-text"> åŒ¹é…å‰é¢ä¸æ˜¯ exp çš„ä½ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-239"><span class="toc-number">13.5.</span> <span class="toc-text"> 5. è´ªå©ªä¸æ‡’æƒ°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-240"><span class="toc-number">13.6.</span> <span class="toc-text"> 6. æ­£åˆ™é™„å½•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-241"><span class="toc-number">13.6.1.</span> <span class="toc-text"> 6.1. åŒ¹é…æ­£åˆ™å­—ç¬¦ä¸²çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-242"><span class="toc-number">13.6.2.</span> <span class="toc-text"> 6.2. é€ŸæŸ¥å…ƒå­—ç¬¦å­—å…¸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-243"><span class="toc-number">13.6.2.1.</span> <span class="toc-text"> é™å®šç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-244"><span class="toc-number">13.6.2.2.</span> <span class="toc-text"> å®šä½ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-245"><span class="toc-number">13.6.2.3.</span> <span class="toc-text"> éæ‰“å°å­—ç¬¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-246"><span class="toc-number">13.6.2.4.</span> <span class="toc-text"> åˆ†ç»„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-247"><span class="toc-number">13.6.2.5.</span> <span class="toc-text"> ç‰¹æ®Šç¬¦å·</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-248"><span class="toc-number">13.7.</span> <span class="toc-text"> 7. æ­£åˆ™å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-249"><span class="toc-number">13.7.1.</span> <span class="toc-text"> 7.1. æœ€å®ç”¨çš„æ­£åˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-250"><span class="toc-number">13.7.1.1.</span> <span class="toc-text"> æ ¡éªŒä¸­æ–‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-251"><span class="toc-number">13.7.1.2.</span> <span class="toc-text"> æ ¡éªŒèº«ä»½è¯å·ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-252"><span class="toc-number">13.7.1.3.</span> <span class="toc-text"> æ ¡éªŒæœ‰æ•ˆç”¨æˆ·åã€å¯†ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-253"><span class="toc-number">13.7.1.4.</span> <span class="toc-text"> æ ¡éªŒé‚®ç®±</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-254"><span class="toc-number">13.7.1.5.</span> <span class="toc-text"> æ ¡éªŒ URL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-255"><span class="toc-number">13.7.1.6.</span> <span class="toc-text"> æ ¡éªŒæ—¶é—´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-256"><span class="toc-number">13.7.1.7.</span> <span class="toc-text"> æ ¡éªŒæ—¥æœŸ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-257"><span class="toc-number">13.7.1.8.</span> <span class="toc-text"> æ ¡éªŒä¸­å›½æ‰‹æœºå·ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-258"><span class="toc-number">13.7.1.9.</span> <span class="toc-text"> æ ¡éªŒä¸­å›½å›ºè¯å·ç </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-259"><span class="toc-number">13.7.1.10.</span> <span class="toc-text"> æ ¡éªŒ IPv4 åœ°å€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-260"><span class="toc-number">13.7.1.11.</span> <span class="toc-text"> æ ¡éªŒ IPv6 åœ°å€</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-261"><span class="toc-number">13.7.2.</span> <span class="toc-text"> 7.2. ç‰¹å®šå­—ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-262"><span class="toc-number">13.7.3.</span> <span class="toc-text"> 7.3. ç‰¹å®šæ•°å­—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-263"><span class="toc-number">13.8.</span> <span class="toc-text"> 8. æ­£åˆ™è¡¨è¾¾å¼çš„æ€§èƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-264"><span class="toc-number">13.8.1.</span> <span class="toc-text"> 8.1. NFA è‡ªåŠ¨æœºçš„å›æº¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-265"><span class="toc-number">13.8.2.</span> <span class="toc-text"> 8.2. å¦‚ä½•é¿å…å›æº¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-266"><span class="toc-number">13.8.2.1.</span> <span class="toc-text"> è´ªå©ªæ¨¡å¼ï¼ˆGreedyï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-267"><span class="toc-number">13.8.2.2.</span> <span class="toc-text"> æ‡’æƒ°æ¨¡å¼ï¼ˆReluctantï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-268"><span class="toc-number">13.8.2.3.</span> <span class="toc-text"> ç‹¬å æ¨¡å¼ï¼ˆPossessiveï¼‰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-269"><span class="toc-number">13.8.3.</span> <span class="toc-text"> 8.3. æ­£åˆ™è¡¨è¾¾å¼çš„ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-270"><span class="toc-number">13.8.3.1.</span> <span class="toc-text"> å°‘ç”¨è´ªå©ªæ¨¡å¼ï¼Œå¤šç”¨ç‹¬å æ¨¡å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-271"><span class="toc-number">13.8.3.2.</span> <span class="toc-text"> å‡å°‘åˆ†æ”¯é€‰æ‹©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-272"><span class="toc-number">13.8.3.3.</span> <span class="toc-text"> å‡å°‘æ•è·åµŒå¥—</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E7%BC%96%E7%A0%81%E5%92%8C%E5%8A%A0%E5%AF%86"><span class="toc-number">14.</span> <span class="toc-text"> Java ç¼–ç å’ŒåŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-273"><span class="toc-number">14.1.</span> <span class="toc-text"> ä¸€ã€Base64 ç¼–ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-274"><span class="toc-number">14.1.1.</span> <span class="toc-text"> Base64 åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-275"><span class="toc-number">14.1.2.</span> <span class="toc-text"> Base64 åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-276"><span class="toc-number">14.2.</span> <span class="toc-text"> äºŒã€æ¶ˆæ¯æ‘˜è¦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-277"><span class="toc-number">14.2.1.</span> <span class="toc-text"> æ¶ˆæ¯æ‘˜è¦æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-278"><span class="toc-number">14.2.2.</span> <span class="toc-text"> æ¶ˆæ¯æ‘˜è¦ç‰¹ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-279"><span class="toc-number">14.2.3.</span> <span class="toc-text"> æ¶ˆæ¯æ‘˜è¦å¸¸ç”¨ç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-280"><span class="toc-number">14.2.4.</span> <span class="toc-text"> æ¶ˆæ¯æ‘˜è¦åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-281"><span class="toc-number">14.2.4.1.</span> <span class="toc-text"> MD5ã€SHA çš„èŒƒä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-282"><span class="toc-number">14.2.4.2.</span> <span class="toc-text"> HMAC çš„èŒƒä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-283"><span class="toc-number">14.3.</span> <span class="toc-text"> ä¸‰ã€æ•°å­—ç­¾å</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-284"><span class="toc-number">14.3.1.</span> <span class="toc-text"> æ•°å­—ç­¾åæ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-285"><span class="toc-number">14.3.2.</span> <span class="toc-text"> æ•°å­—ç­¾åç®—æ³•åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-286"><span class="toc-number">14.3.2.1.</span> <span class="toc-text"> DSA çš„èŒƒä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-287"><span class="toc-number">14.4.</span> <span class="toc-text"> å››ã€å¯¹ç§°åŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-288"><span class="toc-number">14.4.1.</span> <span class="toc-text"> å¯¹ç§°åŠ å¯†æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-289"><span class="toc-number">14.4.1.1.</span> <span class="toc-text"> å¯¹ç§°åŠ å¯†åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-290"><span class="toc-number">14.4.1.2.</span> <span class="toc-text"> å¯¹ç§°åŠ å¯†å·¥ä½œæ¨¡å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-291"><span class="toc-number">14.4.1.3.</span> <span class="toc-text"> å¯¹ç§°åŠ å¯†å¡«å……æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-292"><span class="toc-number">14.4.2.</span> <span class="toc-text"> å¯¹ç§°åŠ å¯†åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-293"><span class="toc-number">14.4.2.1.</span> <span class="toc-text"> åŸºäºå¯†é’¥åŠ å¯†çš„æµç¨‹ï¼ˆDESã€DESedeã€AES å’Œ IDEAï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-294"><span class="toc-number">14.4.2.2.</span> <span class="toc-text"> åŸºäºå£ä»¤åŠ å¯†çš„æµç¨‹ï¼ˆPBEï¼‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-295"><span class="toc-number">14.5.</span> <span class="toc-text"> äº”ã€éå¯¹ç§°åŠ å¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-296"><span class="toc-number">14.5.1.</span> <span class="toc-text"> éå¯¹ç§°åŠ å¯†æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-297"><span class="toc-number">14.5.2.</span> <span class="toc-text"> éå¯¹ç§°åŠ å¯†ç®—æ³•åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-298"><span class="toc-number">14.6.</span> <span class="toc-text"> å…­ã€æœ¯è¯­</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E6%9C%AC%E5%9C%B0%E5%8C%96"><span class="toc-number">15.</span> <span class="toc-text"> Java æœ¬åœ°åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-299"><span class="toc-number">15.1.</span> <span class="toc-text"> èƒŒæ™¯çŸ¥è¯†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-300"><span class="toc-number">15.1.1.</span> <span class="toc-text"> è¯­è¨€ç¼–ç ã€å›½å®¶ &#x2F; åœ°åŒºç¼–ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-301"><span class="toc-number">15.1.2.</span> <span class="toc-text"> å­—ç¬¦ç¼–ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-302"><span class="toc-number">15.2.</span> <span class="toc-text"> Java ä¸­å®ç°æœ¬åœ°åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-303"><span class="toc-number">15.2.1.</span> <span class="toc-text"> å®šä¹‰ä¸åŒè¯­ç§çš„æ¨¡æ¿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-304"><span class="toc-number">15.2.1.1.</span> <span class="toc-text"> å®šä¹‰ properties æ–‡ä»¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-305"><span class="toc-number">15.2.1.2.</span> <span class="toc-text"> Unicode è½¬æ¢å·¥å…·</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-306"><span class="toc-number">15.2.2.</span> <span class="toc-text"> é€‰æ‹©è¯­ç§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-307"><span class="toc-number">15.2.2.1.</span> <span class="toc-text"> Locale</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-308"><span class="toc-number">15.2.3.</span> <span class="toc-text"> åŠ è½½æŒ‡å®šè¯­ç§çš„æ¨¡æ¿</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-309"><span class="toc-number">15.2.3.1.</span> <span class="toc-text"> ResourceBoundle</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-310"><span class="toc-number">15.3.</span> <span class="toc-text"> æ”¯æŒæœ¬åœ°åŒ–çš„å·¥å…·ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-311"><span class="toc-number">15.3.1.</span> <span class="toc-text"> NumberFormat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-312"><span class="toc-number">15.3.2.</span> <span class="toc-text"> DateFormat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-313"><span class="toc-number">15.3.3.</span> <span class="toc-text"> MessageFormat</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jdk8-%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97"><span class="toc-number">16.</span> <span class="toc-text"> JDK8 å…¥é—¨æŒ‡å—</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-314"><span class="toc-number">16.1.</span> <span class="toc-text"> Default Methods for Interfaces (æ¥å£çš„é»˜è®¤æ–¹æ³•)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-315"><span class="toc-number">16.2.</span> <span class="toc-text"> Lambda expressions (Lambda è¡¨è¾¾å¼)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-316"><span class="toc-number">16.3.</span> <span class="toc-text"> Functional Interfaces (å‡½æ•°æ¥å£)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-317"><span class="toc-number">16.4.</span> <span class="toc-text"> Method and Constructor References (æ–¹æ³•å’Œæ„é€ å™¨å¼•ç”¨)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-318"><span class="toc-number">16.5.</span> <span class="toc-text"> Lambda Scopes (Lambda ä½œç”¨åŸŸ)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-319"><span class="toc-number">16.5.1.</span> <span class="toc-text"> Accessing local variables (è®¿é—®æœ¬åœ°å˜é‡)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-320"><span class="toc-number">16.5.2.</span> <span class="toc-text"> Accessing fields and static variables (è®¿é—®æˆå‘˜å˜é‡å’Œé™æ€å˜é‡)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-321"><span class="toc-number">16.5.3.</span> <span class="toc-text"> Accessing Default Interface Methodsï¼ˆè®¿é—®é»˜è®¤çš„æ¥å£æ–¹æ³•ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-322"><span class="toc-number">16.6.</span> <span class="toc-text"> Built-in Functional Interfaces (å†…ç½®å‡½æ•°æ¥å£)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-323"><span class="toc-number">16.6.1.</span> <span class="toc-text"> Predicates</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-324"><span class="toc-number">16.6.2.</span> <span class="toc-text"> Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-325"><span class="toc-number">16.6.3.</span> <span class="toc-text"> Suppliers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-326"><span class="toc-number">16.6.4.</span> <span class="toc-text"> Consumers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-327"><span class="toc-number">16.6.5.</span> <span class="toc-text"> Comparators</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-328"><span class="toc-number">16.7.</span> <span class="toc-text"> Optionals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-329"><span class="toc-number">16.8.</span> <span class="toc-text"> Streams</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-330"><span class="toc-number">16.8.1.</span> <span class="toc-text"> Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-331"><span class="toc-number">16.8.2.</span> <span class="toc-text"> Sorted</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-332"><span class="toc-number">16.8.3.</span> <span class="toc-text"> Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-333"><span class="toc-number">16.8.4.</span> <span class="toc-text"> Match</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-334"><span class="toc-number">16.8.4.1.</span> <span class="toc-text"> Count</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-335"><span class="toc-number">16.8.5.</span> <span class="toc-text"> Reduce</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-336"><span class="toc-number">16.9.</span> <span class="toc-text"> Parallel Streams</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-337"><span class="toc-number">16.9.1.</span> <span class="toc-text"> Sequential Sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-338"><span class="toc-number">16.9.2.</span> <span class="toc-text"> Parallel Sort</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-339"><span class="toc-number">16.10.</span> <span class="toc-text"> Maps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-340"><span class="toc-number">16.11.</span> <span class="toc-text"> Date API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-341"><span class="toc-number">16.11.1.</span> <span class="toc-text"> Clock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-342"><span class="toc-number">16.11.2.</span> <span class="toc-text"> Timezones</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-343"><span class="toc-number">16.11.3.</span> <span class="toc-text"> LocalTime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-344"><span class="toc-number">16.11.4.</span> <span class="toc-text"> LocalDate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-345"><span class="toc-number">16.11.5.</span> <span class="toc-text"> LocalDateTime</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-346"><span class="toc-number">16.12.</span> <span class="toc-text"> Annotations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-347"><span class="toc-number">16.12.1.</span> <span class="toc-text"> Variant 1: ä½¿ç”¨å®¹å™¨æ³¨è§£ (è€å¥—è·¯)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-348"><span class="toc-number">16.12.2.</span> <span class="toc-text"> Variant 2: ä½¿ç”¨ repeatable æ³¨è§£ (æ–°å¥—è·¯)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-349"><span class="toc-number">16.13.</span> <span class="toc-text"> JDK8 å‡çº§å¸¸è§é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-350"><span class="toc-number">16.13.1.</span> <span class="toc-text"> Intellij ä¸­çš„ JDK ç¯å¢ƒè®¾ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-351"><span class="toc-number">16.13.1.1.</span> <span class="toc-text"> Settings</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-352"><span class="toc-number">16.13.1.2.</span> <span class="toc-text"> Projcet Settings</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-353"><span class="toc-number">16.13.1.3.</span> <span class="toc-text"> Application</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-354"><span class="toc-number">16.13.2.</span> <span class="toc-text"> Linux ç¯å¢ƒä¿®æ”¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-355"><span class="toc-number">16.13.2.1.</span> <span class="toc-text"> ä¿®æ”¹ç¯å¢ƒå˜é‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-356"><span class="toc-number">16.13.2.2.</span> <span class="toc-text"> ä¿®æ”¹ maven</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-357"><span class="toc-number">16.13.2.3.</span> <span class="toc-text"> ä¿®æ”¹ server</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-358"><span class="toc-number">16.13.3.</span> <span class="toc-text"> sun.* åŒ…ç¼ºå¤±é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-359"><span class="toc-number">16.13.4.</span> <span class="toc-text"> é»˜è®¤å®‰å…¨ç­–ç•¥ä¿®æ”¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-360"><span class="toc-number">16.13.5.</span> <span class="toc-text"> JVM å‚æ•°è°ƒæ•´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-361"><span class="toc-number">16.13.6.</span> <span class="toc-text"> å­—èŠ‚ç é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-362"><span class="toc-number">16.13.7.</span> <span class="toc-text"> Java è¿æ¥ redis å¯åŠ¨æŠ¥é”™ Error redis clients jedis HostAndPort cant resolve localhost address</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-363"><span class="toc-number">16.13.8.</span> <span class="toc-text"> Resin å®¹å™¨æŒ‡å®š JDK 1.8</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%AE%B9%E5%99%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">17.</span> <span class="toc-text"> Java å®¹å™¨ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-364"><span class="toc-number">17.1.</span> <span class="toc-text"> 1. å®¹å™¨ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-365"><span class="toc-number">17.1.1.</span> <span class="toc-text"> 1.1. æ•°ç»„ä¸å®¹å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-366"><span class="toc-number">17.1.2.</span> <span class="toc-text"> 1.2. å®¹å™¨æ¡†æ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-367"><span class="toc-number">17.1.3.</span> <span class="toc-text"> 2.2. Iterable å’Œ Iterator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-368"><span class="toc-number">17.1.4.</span> <span class="toc-text"> 2.3. Comparable å’Œ Comparator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-369"><span class="toc-number">17.1.5.</span> <span class="toc-text"> 2.4. Cloneable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-370"><span class="toc-number">17.1.6.</span> <span class="toc-text"> 2.5. fail-fast</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-371"><span class="toc-number">17.1.6.1.</span> <span class="toc-text"> fail-fast çš„è¦ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-372"><span class="toc-number">17.1.6.2.</span> <span class="toc-text"> è§£å†³ fail-fast</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-373"><span class="toc-number">17.2.</span> <span class="toc-text"> 3. å®¹å™¨å’Œçº¿ç¨‹å®‰å…¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%AE%B9%E5%99%A8%E4%B9%8B-list"><span class="toc-number">18.</span> <span class="toc-text"> Java å®¹å™¨ä¹‹ List</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-374"><span class="toc-number">18.1.</span> <span class="toc-text"> 1. List ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-375"><span class="toc-number">18.1.1.</span> <span class="toc-text"> 1.1. ArrayList å’Œ LinkedList</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-376"><span class="toc-number">18.1.2.</span> <span class="toc-text"> 1.2. Vector å’Œ Stack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-377"><span class="toc-number">18.2.</span> <span class="toc-text"> 2. ArrayList</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-378"><span class="toc-number">18.2.1.</span> <span class="toc-text"> 2.1. ArrayList è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-379"><span class="toc-number">18.2.2.</span> <span class="toc-text"> 2.2. ArrayList åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-380"><span class="toc-number">18.2.2.1.</span> <span class="toc-text"> ArrayList çš„æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-381"><span class="toc-number">18.2.2.2.</span> <span class="toc-text"> ArrayList çš„åºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-382"><span class="toc-number">18.2.2.3.</span> <span class="toc-text"> ArrayList æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-383"><span class="toc-number">18.2.2.4.</span> <span class="toc-text"> ArrayList è®¿é—®å…ƒç´ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-384"><span class="toc-number">18.2.2.5.</span> <span class="toc-text"> ArrayList æ·»åŠ å…ƒç´ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-385"><span class="toc-number">18.2.2.6.</span> <span class="toc-text"> ArrayList åˆ é™¤å…ƒç´ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-386"><span class="toc-number">18.2.2.7.</span> <span class="toc-text"> ArrayList çš„ Fail-Fast</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-387"><span class="toc-number">18.3.</span> <span class="toc-text"> 3. LinkedList</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-388"><span class="toc-number">18.3.1.</span> <span class="toc-text"> 3.1. LinkedList è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-389"><span class="toc-number">18.3.2.</span> <span class="toc-text"> 3.2. LinkedList åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-390"><span class="toc-number">18.3.2.1.</span> <span class="toc-text"> LinkedList çš„æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-391"><span class="toc-number">18.3.2.2.</span> <span class="toc-text"> LinkedList çš„åºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-392"><span class="toc-number">18.3.2.3.</span> <span class="toc-text"> LinkedList è®¿é—®å…ƒç´ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-393"><span class="toc-number">18.3.2.4.</span> <span class="toc-text"> LinkedList æ·»åŠ å…ƒç´ </span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-394"><span class="toc-number">18.3.2.5.</span> <span class="toc-text"> LinkedList åˆ é™¤å…ƒç´ </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-395"><span class="toc-number">18.3.3.</span> <span class="toc-text"> 4.2. List.subList é—®é¢˜ç‚¹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%AE%B9%E5%99%A8%E4%B9%8B-map"><span class="toc-number">19.</span> <span class="toc-text"> Java å®¹å™¨ä¹‹ Map</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-396"><span class="toc-number">19.1.</span> <span class="toc-text"> 1. Map ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-397"><span class="toc-number">19.1.1.</span> <span class="toc-text"> 1.1. Map æ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-398"><span class="toc-number">19.1.2.</span> <span class="toc-text"> 1.2. Map æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-399"><span class="toc-number">19.1.3.</span> <span class="toc-text"> 1.3. Map.Entry æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-400"><span class="toc-number">19.1.4.</span> <span class="toc-text"> 1.4. AbstractMap æŠ½è±¡ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-401"><span class="toc-number">19.1.5.</span> <span class="toc-text"> 1.5. SortedMap æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-402"><span class="toc-number">19.1.6.</span> <span class="toc-text"> 1.6. NavigableMap æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-403"><span class="toc-number">19.1.7.</span> <span class="toc-text"> 1.7. Dictionary æŠ½è±¡ç±»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-404"><span class="toc-number">19.2.</span> <span class="toc-text"> 2. HashMap ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-405"><span class="toc-number">19.2.1.</span> <span class="toc-text"> 2.1. HashMap è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-406"><span class="toc-number">19.2.2.</span> <span class="toc-text"> 2.2. HashMap åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-407"><span class="toc-number">19.2.2.1.</span> <span class="toc-text"> HashMap æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-408"><span class="toc-number">19.2.2.2.</span> <span class="toc-text"> HashMap æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-409"><span class="toc-number">19.2.2.3.</span> <span class="toc-text"> put æ–¹æ³•çš„å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-410"><span class="toc-number">19.2.2.4.</span> <span class="toc-text"> get æ–¹æ³•çš„å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-411"><span class="toc-number">19.2.2.5.</span> <span class="toc-text"> hash æ–¹æ³•çš„å®ç°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-412"><span class="toc-number">19.2.2.6.</span> <span class="toc-text"> resize çš„å®ç°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-413"><span class="toc-number">19.3.</span> <span class="toc-text"> 3. LinkedHashMap ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-414"><span class="toc-number">19.3.1.</span> <span class="toc-text"> 3.1. LinkedHashMap è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-415"><span class="toc-number">19.3.2.</span> <span class="toc-text"> 3.2. LinkedHashMap è¦ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-416"><span class="toc-number">19.3.2.1.</span> <span class="toc-text"> LinkedHashMap æ•°æ®ç»“æ„</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-417"><span class="toc-number">19.4.</span> <span class="toc-text"> 4. TreeMap ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-418"><span class="toc-number">19.4.1.</span> <span class="toc-text"> 4.1. TreeMap è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-419"><span class="toc-number">19.4.2.</span> <span class="toc-text"> 4.2. TreeMap åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-420"><span class="toc-number">19.4.2.1.</span> <span class="toc-text"> put æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-421"><span class="toc-number">19.4.2.2.</span> <span class="toc-text"> get æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-422"><span class="toc-number">19.4.3.</span> <span class="toc-text"> 4.3. remove æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-423"><span class="toc-number">19.4.4.</span> <span class="toc-text"> 4.4. TreeMap ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-424"><span class="toc-number">19.5.</span> <span class="toc-text"> 5. WeakHashMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%AE%B9%E5%99%A8%E4%B9%8B-set"><span class="toc-number">20.</span> <span class="toc-text"> Java å®¹å™¨ä¹‹ Set</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-425"><span class="toc-number">20.1.</span> <span class="toc-text"> 1. Set ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-426"><span class="toc-number">20.1.1.</span> <span class="toc-text"> 1.1. Set æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-427"><span class="toc-number">20.1.2.</span> <span class="toc-text"> 1.2. SortedSet æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-428"><span class="toc-number">20.1.3.</span> <span class="toc-text"> 1.3. NavigableSet æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-429"><span class="toc-number">20.1.4.</span> <span class="toc-text"> 1.4. AbstractSet æŠ½è±¡ç±»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-430"><span class="toc-number">20.2.</span> <span class="toc-text"> 2. HashSet ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-431"><span class="toc-number">20.2.1.</span> <span class="toc-text"> 2.1. HashSet è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-432"><span class="toc-number">20.2.2.</span> <span class="toc-text"> 2.2. HashSet åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-433"><span class="toc-number">20.2.3.</span> <span class="toc-text"> 3.1. TreeSet è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-434"><span class="toc-number">20.2.4.</span> <span class="toc-text"> 3.2. TreeSet æºç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-435"><span class="toc-number">20.3.</span> <span class="toc-text"> 4. LinkedHashSet ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-436"><span class="toc-number">20.3.1.</span> <span class="toc-text"> 4.1. LinkedHashSet è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-437"><span class="toc-number">20.3.2.</span> <span class="toc-text"> 4.2. LinkedHashSet åŸç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-438"><span class="toc-number">20.4.</span> <span class="toc-text"> 5. EnumSet ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-439"><span class="toc-number">20.4.1.</span> <span class="toc-text"> 5.1. EnumSet è¦ç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-440"><span class="toc-number">20.5.</span> <span class="toc-text"> 6. è¦ç‚¹æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%AE%B9%E5%99%A8%E4%B9%8B-queue"><span class="toc-number">21.</span> <span class="toc-text"> Java å®¹å™¨ä¹‹ Queue</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-441"><span class="toc-number">21.1.</span> <span class="toc-text"> 1. Queue ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-442"><span class="toc-number">21.1.1.</span> <span class="toc-text"> 1.1. Queue æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-443"><span class="toc-number">21.1.2.</span> <span class="toc-text"> 1.2. AbstractQueue æŠ½è±¡ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-444"><span class="toc-number">21.1.3.</span> <span class="toc-text"> 1.3. Deque æ¥å£</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-445"><span class="toc-number">21.2.</span> <span class="toc-text"> 2. ArrayDeque</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-446"><span class="toc-number">21.3.</span> <span class="toc-text"> 3. LinkedList</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-447"><span class="toc-number">21.4.</span> <span class="toc-text"> 4. PriorityQueue</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-io-%E6%A8%A1%E5%9E%8B"><span class="toc-number">22.</span> <span class="toc-text"> Java IO æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-448"><span class="toc-number">22.1.</span> <span class="toc-text"> UNIX I&#x2F;O æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-449"><span class="toc-number">22.1.1.</span> <span class="toc-text"> åŒæ­¥é˜»å¡ I&#x2F;O</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-450"><span class="toc-number">22.1.2.</span> <span class="toc-text"> åŒæ­¥éé˜»å¡ I&#x2F;O</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-451"><span class="toc-number">22.1.3.</span> <span class="toc-text"> I&#x2F;O å¤šè·¯å¤ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-452"><span class="toc-number">22.1.4.</span> <span class="toc-text"> ä¿¡å·é©±åŠ¨ I&#x2F;O</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-453"><span class="toc-number">22.1.5.</span> <span class="toc-text"> å¼‚æ­¥ I&#x2F;O</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-454"><span class="toc-number">22.2.</span> <span class="toc-text"> Java I&#x2F;O æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-455"><span class="toc-number">22.2.1.</span> <span class="toc-text"> BIO</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-456"><span class="toc-number">22.2.1.1.</span> <span class="toc-text"> BIO ç®€ä»‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-457"><span class="toc-number">22.2.1.2.</span> <span class="toc-text"> BIO çš„æ€§èƒ½ç¼ºé™·</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-458"><span class="toc-number">22.2.2.</span> <span class="toc-text"> NIO</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-459"><span class="toc-number">22.2.2.1.</span> <span class="toc-text"> ä½¿ç”¨ç¼“å†²åŒºä¼˜åŒ–è¯»å†™æµ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-460"><span class="toc-number">22.2.2.2.</span> <span class="toc-text"> ä½¿ç”¨ DirectBuffer å‡å°‘å†…å­˜å¤åˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-461"><span class="toc-number">22.2.2.3.</span> <span class="toc-text"> ä¼˜åŒ– I&#x2F;Oï¼Œé¿å…é˜»å¡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-462"><span class="toc-number">22.2.3.</span> <span class="toc-text"> AIO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-463"><span class="toc-number">22.3.</span> <span class="toc-text"> ä¼ ç»Ÿ IO æµ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-464"><span class="toc-number">22.3.1.</span> <span class="toc-text"> å­—èŠ‚æµ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-465"><span class="toc-number">22.3.1.1.</span> <span class="toc-text"> æ–‡ä»¶å­—èŠ‚æµ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-466"><span class="toc-number">22.3.1.2.</span> <span class="toc-text"> å†…å­˜å­—èŠ‚æµ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-467"><span class="toc-number">22.3.1.3.</span> <span class="toc-text"> ç®¡é“æµ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-468"><span class="toc-number">22.3.1.4.</span> <span class="toc-text"> å¯¹è±¡å­—èŠ‚æµ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-469"><span class="toc-number">22.3.1.5.</span> <span class="toc-text"> æ•°æ®æ“ä½œæµ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-470"><span class="toc-number">22.3.1.6.</span> <span class="toc-text"> åˆå¹¶æµ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-471"><span class="toc-number">22.3.2.</span> <span class="toc-text"> å­—ç¬¦æµ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-472"><span class="toc-number">22.3.2.1.</span> <span class="toc-text"> æ–‡ä»¶å­—ç¬¦æµ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-473"><span class="toc-number">22.3.2.2.</span> <span class="toc-text"> å­—èŠ‚æµè½¬æ¢å­—ç¬¦æµ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-474"><span class="toc-number">22.3.3.</span> <span class="toc-text"> å­—èŠ‚æµ vs. å­—ç¬¦æµ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-nio"><span class="toc-number">23.</span> <span class="toc-text"> Java NIO</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-475"><span class="toc-number">23.1.</span> <span class="toc-text"> ä¸€ã€NIO ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-476"><span class="toc-number">23.1.1.</span> <span class="toc-text"> NIO å’Œ BIO çš„åŒºåˆ«</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-477"><span class="toc-number">23.1.1.1.</span> <span class="toc-text"> Non-blocking IO (éé˜»å¡)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-478"><span class="toc-number">23.1.1.2.</span> <span class="toc-text"> Buffer (ç¼“å†²åŒº)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-479"><span class="toc-number">23.1.1.3.</span> <span class="toc-text"> Channel (é€šé“)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-480"><span class="toc-number">23.1.1.4.</span> <span class="toc-text"> Selector (é€‰æ‹©å™¨)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-481"><span class="toc-number">23.1.2.</span> <span class="toc-text"> NIO çš„åŸºæœ¬æµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-482"><span class="toc-number">23.1.3.</span> <span class="toc-text"> NIO æ ¸å¿ƒç»„ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-483"><span class="toc-number">23.2.</span> <span class="toc-text"> äºŒã€Channel (é€šé“)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-484"><span class="toc-number">23.3.</span> <span class="toc-text"> ä¸‰ã€Buffer (ç¼“å†²åŒº)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-485"><span class="toc-number">23.3.1.</span> <span class="toc-text"> ç¼“å†²åŒºçŠ¶æ€å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-486"><span class="toc-number">23.3.2.</span> <span class="toc-text"> æ–‡ä»¶ NIO ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-487"><span class="toc-number">23.3.3.</span> <span class="toc-text"> DirectBuffer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-488"><span class="toc-number">23.4.</span> <span class="toc-text"> å››ã€Selector (é€‰æ‹©å™¨)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-489"><span class="toc-number">23.4.1.</span> <span class="toc-text"> åˆ›å»ºé€‰æ‹©å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-490"><span class="toc-number">23.4.2.</span> <span class="toc-text"> å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-491"><span class="toc-number">23.4.3.</span> <span class="toc-text"> ç›‘å¬äº‹ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-492"><span class="toc-number">23.4.4.</span> <span class="toc-text"> è·å–åˆ°è¾¾çš„äº‹ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-493"><span class="toc-number">23.4.5.</span> <span class="toc-text"> äº‹ä»¶å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-494"><span class="toc-number">23.4.6.</span> <span class="toc-text"> å¥—æ¥å­— NIO ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-495"><span class="toc-number">23.4.7.</span> <span class="toc-text"> å†…å­˜æ˜ å°„æ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-496"><span class="toc-number">23.5.</span> <span class="toc-text"> äº”ã€NIO vs. BIO</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">24.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java åºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-497"><span class="toc-number">24.1.</span> <span class="toc-text"> 1. Java åºåˆ—åŒ–ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-498"><span class="toc-number">24.2.</span> <span class="toc-text"> 2. Java åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-499"><span class="toc-number">24.3.</span> <span class="toc-text"> 3. Serializable æ¥å£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-500"><span class="toc-number">24.3.1.</span> <span class="toc-text"> 3.1. serialVersionUID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-501"><span class="toc-number">24.3.2.</span> <span class="toc-text"> 3.2. é»˜è®¤åºåˆ—åŒ–æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-502"><span class="toc-number">24.3.3.</span> <span class="toc-text"> 3.3. transient</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-503"><span class="toc-number">24.4.</span> <span class="toc-text"> 4. Externalizable æ¥å£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-504"><span class="toc-number">24.4.1.</span> <span class="toc-text"> 4.1. Externalizable æ¥å£çš„æ›¿ä»£æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-505"><span class="toc-number">24.4.2.</span> <span class="toc-text"> 4.2. readResolve () æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-506"><span class="toc-number">24.5.</span> <span class="toc-text"> 5. Java åºåˆ—åŒ–é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-507"><span class="toc-number">24.6.</span> <span class="toc-text"> 6. Java åºåˆ—åŒ–çš„ç¼ºé™·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-508"><span class="toc-number">24.7.</span> <span class="toc-text"> 7. åºåˆ—åŒ–æŠ€æœ¯é€‰å‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">25.</span> <span class="toc-text"> Java ç½‘ç»œç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-509"><span class="toc-number">25.1.</span> <span class="toc-text"> ä¸€ã€Socket å’Œ ServerSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-510"><span class="toc-number">25.1.1.</span> <span class="toc-text"> ServerSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-511"><span class="toc-number">25.1.1.1.</span> <span class="toc-text"> ServerSocket æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-512"><span class="toc-number">25.1.1.2.</span> <span class="toc-text"> ServerSocket å¸¸ç”¨æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-513"><span class="toc-number">25.1.2.</span> <span class="toc-text"> Socket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-514"><span class="toc-number">25.1.2.1.</span> <span class="toc-text"> Socket æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-515"><span class="toc-number">25.1.2.2.</span> <span class="toc-text"> Socket å¸¸ç”¨æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-516"><span class="toc-number">25.1.3.</span> <span class="toc-text"> Socket é€šä¿¡ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-517"><span class="toc-number">25.2.</span> <span class="toc-text"> äºŒã€DatagramSocket å’Œ DatagramPacket</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-518"><span class="toc-number">25.3.</span> <span class="toc-text"> ä¸‰ã€InetAddress</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-519"><span class="toc-number">25.4.</span> <span class="toc-text"> å››ã€URL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-io-%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">26.</span> <span class="toc-text"> Java IO å·¥å…·ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-520"><span class="toc-number">26.1.</span> <span class="toc-text"> ä¸€ã€File</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-521"><span class="toc-number">26.1.1.</span> <span class="toc-text"> createNewFille</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-522"><span class="toc-number">26.1.2.</span> <span class="toc-text"> mkdir</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-523"><span class="toc-number">26.1.3.</span> <span class="toc-text"> delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-524"><span class="toc-number">26.1.4.</span> <span class="toc-text"> list å’Œ listFiles</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-525"><span class="toc-number">26.2.</span> <span class="toc-text"> äºŒã€RandomAccessFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-526"><span class="toc-number">26.2.1.</span> <span class="toc-text"> RandomAccessFile å†™æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-527"><span class="toc-number">26.2.2.</span> <span class="toc-text"> RandomAccessFile è¯»æ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-528"><span class="toc-number">26.3.</span> <span class="toc-text"> ä¸‰ã€System</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-529"><span class="toc-number">26.4.</span> <span class="toc-text"> å››ã€Scanner</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%B9%B6%E5%8F%91%E7%AE%80%E4%BB%8B"><span class="toc-number">27.</span> <span class="toc-text"> Java å¹¶å‘ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-530"><span class="toc-number">27.1.</span> <span class="toc-text"> 1. å¹¶å‘æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-531"><span class="toc-number">27.1.1.</span> <span class="toc-text"> 1.1. å¹¶å‘å’Œå¹¶è¡Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-532"><span class="toc-number">27.1.2.</span> <span class="toc-text"> 1.2. åŒæ­¥å’Œå¼‚æ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-533"><span class="toc-number">27.1.3.</span> <span class="toc-text"> 1.3. é˜»å¡å’Œéé˜»å¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-534"><span class="toc-number">27.1.4.</span> <span class="toc-text"> 1.4. è¿›ç¨‹å’Œçº¿ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-535"><span class="toc-number">27.1.5.</span> <span class="toc-text"> 1.5. ç«æ€æ¡ä»¶å’Œä¸´ç•ŒåŒº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-536"><span class="toc-number">27.1.6.</span> <span class="toc-text"> 1.6. ç®¡ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-537"><span class="toc-number">27.2.</span> <span class="toc-text"> 2. å¹¶å‘çš„ç‰¹ç‚¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-538"><span class="toc-number">27.2.1.</span> <span class="toc-text"> 2.1. æå‡èµ„æºåˆ©ç”¨ç‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-539"><span class="toc-number">27.2.2.</span> <span class="toc-text"> 2.2. ç¨‹åºå“åº”æ›´å¿«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-540"><span class="toc-number">27.2.3.</span> <span class="toc-text"> 2.3. å¹¶å‘çš„é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-541"><span class="toc-number">27.3.</span> <span class="toc-text"> 3. å®‰å…¨æ€§é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-542"><span class="toc-number">27.3.1.</span> <span class="toc-text"> 3.1. ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-543"><span class="toc-number">27.3.2.</span> <span class="toc-text"> 3.2. çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-544"><span class="toc-number">27.3.3.</span> <span class="toc-text"> 3.3. ç¼–è¯‘ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-545"><span class="toc-number">27.3.4.</span> <span class="toc-text"> 3.4. ä¿è¯å¹¶å‘å®‰å…¨çš„æ€è·¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-546"><span class="toc-number">27.3.4.1.</span> <span class="toc-text"> äº’æ–¥åŒæ­¥ï¼ˆé˜»å¡åŒæ­¥ï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-547"><span class="toc-number">27.3.4.2.</span> <span class="toc-text"> éé˜»å¡åŒæ­¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-548"><span class="toc-number">27.3.4.3.</span> <span class="toc-text"> æ— åŒæ­¥</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-549"><span class="toc-number">27.4.</span> <span class="toc-text"> 4. æ´»è·ƒæ€§é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-550"><span class="toc-number">27.4.1.</span> <span class="toc-text"> 4.1. æ­»é”ï¼ˆDeadlockï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-551"><span class="toc-number">27.4.1.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯æ­»é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-552"><span class="toc-number">27.4.1.2.</span> <span class="toc-text"> é¿å…æ­»é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-553"><span class="toc-number">27.4.2.</span> <span class="toc-text"> 4.2. æ´»é”ï¼ˆLivelockï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-554"><span class="toc-number">27.4.2.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯æ´»é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-555"><span class="toc-number">27.4.2.2.</span> <span class="toc-text"> é¿å…æ´»é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-556"><span class="toc-number">27.4.3.</span> <span class="toc-text"> 4.3. é¥¥é¥¿ï¼ˆStarvationï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-557"><span class="toc-number">27.4.3.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯é¥¥é¥¿</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-558"><span class="toc-number">27.4.3.2.</span> <span class="toc-text"> è§£å†³é¥¥é¥¿</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-559"><span class="toc-number">27.5.</span> <span class="toc-text"> 5. æ€§èƒ½é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-560"><span class="toc-number">27.5.1.</span> <span class="toc-text"> 5.1. ä¸Šä¸‹æ–‡åˆ‡æ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-561"><span class="toc-number">27.5.1.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-562"><span class="toc-number">27.5.1.2.</span> <span class="toc-text"> å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-563"><span class="toc-number">27.5.2.</span> <span class="toc-text"> 5.2. èµ„æºé™åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-564"><span class="toc-number">27.5.2.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯èµ„æºé™åˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-565"><span class="toc-number">27.5.2.2.</span> <span class="toc-text"> èµ„æºé™åˆ¶å¼•å‘çš„é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-566"><span class="toc-number">27.5.2.3.</span> <span class="toc-text"> å¦‚ä½•è§£å†³èµ„æºé™åˆ¶çš„é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-567"><span class="toc-number">27.6.</span> <span class="toc-text"> 6. å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80"><span class="toc-number">28.</span> <span class="toc-text"> Java çº¿ç¨‹åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-568"><span class="toc-number">28.1.</span> <span class="toc-text"> 1. çº¿ç¨‹ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-569"><span class="toc-number">28.1.1.</span> <span class="toc-text"> 1.1. ä»€ä¹ˆæ˜¯è¿›ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-570"><span class="toc-number">28.1.2.</span> <span class="toc-text"> 1.2. ä»€ä¹ˆæ˜¯çº¿ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-571"><span class="toc-number">28.1.3.</span> <span class="toc-text"> 1.3. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-572"><span class="toc-number">28.2.</span> <span class="toc-text"> 2. åˆ›å»ºçº¿ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-573"><span class="toc-number">28.2.1.</span> <span class="toc-text"> 2.1. Thread</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-574"><span class="toc-number">28.2.2.</span> <span class="toc-text"> 2.2. Runnable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-575"><span class="toc-number">28.2.3.</span> <span class="toc-text"> 2.3. Callableã€Futureã€FutureTask</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-576"><span class="toc-number">28.2.3.1.</span> <span class="toc-text"> Callable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-577"><span class="toc-number">28.2.3.2.</span> <span class="toc-text"> Future</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-578"><span class="toc-number">28.2.3.3.</span> <span class="toc-text"> FutureTask</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-579"><span class="toc-number">28.2.3.4.</span> <span class="toc-text"> Callable + Future + FutureTask ç¤ºä¾‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-580"><span class="toc-number">28.3.</span> <span class="toc-text"> 3. çº¿ç¨‹åŸºæœ¬ç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-581"><span class="toc-number">28.3.1.</span> <span class="toc-text"> 3.1. çº¿ç¨‹ä¼‘çœ </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-582"><span class="toc-number">28.3.2.</span> <span class="toc-text"> 3.2. çº¿ç¨‹ç¤¼è®©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-583"><span class="toc-number">28.3.3.</span> <span class="toc-text"> 3.3. ç»ˆæ­¢çº¿ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-584"><span class="toc-number">28.3.4.</span> <span class="toc-text"> 3.4. å®ˆæŠ¤çº¿ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-585"><span class="toc-number">28.4.</span> <span class="toc-text"> 4. çº¿ç¨‹é€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-586"><span class="toc-number">28.4.1.</span> <span class="toc-text"> 4.1. wait&#x2F;notify&#x2F;notifyAll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-587"><span class="toc-number">28.4.2.</span> <span class="toc-text"> 4.2. join</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-588"><span class="toc-number">28.4.3.</span> <span class="toc-text"> 4.3. ç®¡é“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-589"><span class="toc-number">28.5.</span> <span class="toc-text"> 5. çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-590"><span class="toc-number">28.6.</span> <span class="toc-text"> 6. çº¿ç¨‹å¸¸è§é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-591"><span class="toc-number">28.6.1.</span> <span class="toc-text"> 6.1. sleepã€yieldã€join æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-592"><span class="toc-number">28.6.1.1.</span> <span class="toc-text"> åŒæ­¥é™æ€æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-593"><span class="toc-number">28.6.1.2.</span> <span class="toc-text"> åŒæ­¥ä»£ç å—</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-594"><span class="toc-number">28.6.2.</span> <span class="toc-text"> 2.2. synchronized çš„åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-595"><span class="toc-number">28.6.2.1.</span> <span class="toc-text"> åŒæ­¥ä»£ç å—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-596"><span class="toc-number">28.6.2.2.</span> <span class="toc-text"> åŒæ­¥æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-597"><span class="toc-number">28.6.2.3.</span> <span class="toc-text"> Monitor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-598"><span class="toc-number">28.6.3.</span> <span class="toc-text"> 2.3. synchronized çš„ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-599"><span class="toc-number">28.6.3.1.</span> <span class="toc-text"> Java å¯¹è±¡å¤´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-600"><span class="toc-number">28.6.3.2.</span> <span class="toc-text"> åå‘é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-601"><span class="toc-number">28.6.3.3.</span> <span class="toc-text"> è½»é‡çº§é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-602"><span class="toc-number">28.6.3.4.</span> <span class="toc-text"> é”æ¶ˆé™¤ &#x2F; é”ç²—åŒ–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-603"><span class="toc-number">28.6.3.5.</span> <span class="toc-text"> è‡ªæ—‹é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-604"><span class="toc-number">28.6.4.</span> <span class="toc-text"> 2.4. synchronized çš„è¯¯åŒº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-605"><span class="toc-number">28.6.4.1.</span> <span class="toc-text"> synchronized ä½¿ç”¨èŒƒå›´ä¸å½“å¯¼è‡´çš„é”™è¯¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-606"><span class="toc-number">28.6.4.2.</span> <span class="toc-text"> synchronized ä¿æŠ¤å¯¹è±¡ä¸å¯¹å¯¼è‡´çš„é”™è¯¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-607"><span class="toc-number">28.6.4.3.</span> <span class="toc-text"> é”ç²’åº¦å¯¼è‡´çš„é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-608"><span class="toc-number">28.7.</span> <span class="toc-text"> 3. volatile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-609"><span class="toc-number">28.7.1.</span> <span class="toc-text"> 3.1. volatile çš„è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-610"><span class="toc-number">28.7.2.</span> <span class="toc-text"> 3.2. volatile çš„åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-611"><span class="toc-number">28.7.3.</span> <span class="toc-text"> 3.3. volatile çš„åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-612"><span class="toc-number">28.7.4.</span> <span class="toc-text"> 3.4. volatile çš„é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-613"><span class="toc-number">28.8.</span> <span class="toc-text"> 4. CAS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-614"><span class="toc-number">28.8.1.</span> <span class="toc-text"> 4.1. CAS çš„è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-615"><span class="toc-number">28.8.2.</span> <span class="toc-text"> 4.2. CAS çš„åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-616"><span class="toc-number">28.8.2.1.</span> <span class="toc-text"> åŸå­ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-617"><span class="toc-number">28.8.2.2.</span> <span class="toc-text"> è‡ªæ—‹é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-618"><span class="toc-number">28.8.3.</span> <span class="toc-text"> 4.3. CAS çš„åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-619"><span class="toc-number">28.8.4.</span> <span class="toc-text"> 4.4. CAS çš„é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-620"><span class="toc-number">28.8.4.1.</span> <span class="toc-text"> ABA é—®é¢˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-621"><span class="toc-number">28.8.4.2.</span> <span class="toc-text"> å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-622"><span class="toc-number">28.8.4.3.</span> <span class="toc-text"> åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ€§</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-623"><span class="toc-number">28.9.</span> <span class="toc-text"> 5. ThreadLocal</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-624"><span class="toc-number">28.9.1.</span> <span class="toc-text"> 5.1. ThreadLocal çš„åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-625"><span class="toc-number">28.9.2.</span> <span class="toc-text"> 5.2. ThreadLocal çš„åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-626"><span class="toc-number">28.9.2.1.</span> <span class="toc-text"> å­˜å‚¨ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-627"><span class="toc-number">28.9.2.2.</span> <span class="toc-text"> å¦‚ä½•è§£å†³ Hash å†²çª</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-628"><span class="toc-number">28.9.2.3.</span> <span class="toc-text"> å†…å­˜æ³„æ¼é—®é¢˜</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-629"><span class="toc-number">28.9.3.</span> <span class="toc-text"> 5.3. ThreadLocal çš„è¯¯åŒº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-630"><span class="toc-number">28.9.3.1.</span> <span class="toc-text"> ThreadLocal é”™è¯¯æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-631"><span class="toc-number">28.9.3.2.</span> <span class="toc-text"> ThreadLocal é”™è¯¯æ¡ˆä¾‹ä¿®æ­£</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-632"><span class="toc-number">28.9.4.</span> <span class="toc-text"> 5.4. InheritableThreadLocal</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3-java-%E5%B9%B6%E5%8F%91%E9%94%81"><span class="toc-number">29.</span> <span class="toc-text"> æ·±å…¥ç†è§£ Java å¹¶å‘é”</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-633"><span class="toc-number">29.1.</span> <span class="toc-text"> 1. å¹¶å‘é”ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-634"><span class="toc-number">29.1.1.</span> <span class="toc-text"> 1.1. å¯é‡å…¥é”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-635"><span class="toc-number">29.1.2.</span> <span class="toc-text"> 1.2. å…¬å¹³é”ä¸éå…¬å¹³é”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-636"><span class="toc-number">29.1.3.</span> <span class="toc-text"> 1.3. ç‹¬äº«é”ä¸å…±äº«é”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-637"><span class="toc-number">29.1.4.</span> <span class="toc-text"> 1.4. æ‚²è§‚é”ä¸ä¹è§‚é”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-638"><span class="toc-number">29.1.5.</span> <span class="toc-text"> 1.5. åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-639"><span class="toc-number">29.1.6.</span> <span class="toc-text"> 1.6. åˆ†æ®µé”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-640"><span class="toc-number">29.1.7.</span> <span class="toc-text"> 1.7. æ˜¾ç¤ºé”å’Œå†…ç½®é”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-641"><span class="toc-number">29.2.</span> <span class="toc-text"> 2. Lock å’Œ Condition</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-642"><span class="toc-number">29.2.1.</span> <span class="toc-text"> 2.1. ä¸ºä½•å¼•å…¥ Lock å’Œ Condition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-643"><span class="toc-number">29.2.2.</span> <span class="toc-text"> 2.2. Lock æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-644"><span class="toc-number">29.2.3.</span> <span class="toc-text"> 2.3. Condition</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-645"><span class="toc-number">29.2.3.1.</span> <span class="toc-text"> Condition çš„ç‰¹æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-646"><span class="toc-number">29.2.3.2.</span> <span class="toc-text"> Condition çš„ç”¨æ³•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-647"><span class="toc-number">29.3.</span> <span class="toc-text"> 3. ReentrantLock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-648"><span class="toc-number">29.3.1.</span> <span class="toc-text"> 3.1. ReentrantLock çš„ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-649"><span class="toc-number">29.3.1.1.</span> <span class="toc-text"> lock å’Œ unlock æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-650"><span class="toc-number">29.3.1.2.</span> <span class="toc-text"> tryLock æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-651"><span class="toc-number">29.3.1.3.</span> <span class="toc-text"> lockInterruptibly æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-652"><span class="toc-number">29.3.1.4.</span> <span class="toc-text"> newCondition æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-653"><span class="toc-number">29.3.2.</span> <span class="toc-text"> 3.3. ReentrantLock çš„åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-654"><span class="toc-number">29.3.2.1.</span> <span class="toc-text"> ReentrantLock çš„å¯è§æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-655"><span class="toc-number">29.3.2.2.</span> <span class="toc-text"> ReentrantLock çš„æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-656"><span class="toc-number">29.3.2.3.</span> <span class="toc-text"> ReentrantLock çš„è·å–é”å’Œé‡Šæ”¾é”</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-657"><span class="toc-number">29.3.2.4.</span> <span class="toc-text"> å…¬å¹³é”å’Œéå…¬å¹³é”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-658"><span class="toc-number">29.4.</span> <span class="toc-text"> 4. ReentrantReadWriteLock</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-659"><span class="toc-number">29.4.1.</span> <span class="toc-text"> 4.1. ReentrantReadWriteLock çš„ç‰¹æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-660"><span class="toc-number">29.4.2.</span> <span class="toc-text"> 4.2. ReentrantReadWriteLock çš„ç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-661"><span class="toc-number">29.4.2.1.</span> <span class="toc-text"> ReentrantReadWriteLock çš„æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-662"><span class="toc-number">29.4.2.2.</span> <span class="toc-text"> ReentrantReadWriteLock çš„ä½¿ç”¨å®ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-663"><span class="toc-number">29.4.3.</span> <span class="toc-text"> 4.3. ReentrantReadWriteLock çš„åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-664"><span class="toc-number">29.4.3.1.</span> <span class="toc-text"> ReentrantReadWriteLock çš„æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-665"><span class="toc-number">29.4.3.2.</span> <span class="toc-text"> ReentrantReadWriteLock çš„è·å–é”å’Œé‡Šæ”¾é”</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-666"><span class="toc-number">29.5.</span> <span class="toc-text"> 5. StampedLock</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-667"><span class="toc-number">29.6.</span> <span class="toc-text"> 6. AQS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-668"><span class="toc-number">29.6.1.</span> <span class="toc-text"> 6.1. AQS çš„è¦ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-669"><span class="toc-number">29.6.2.</span> <span class="toc-text"> 6.2. AQS çš„åº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-670"><span class="toc-number">29.6.2.1.</span> <span class="toc-text"> ç‹¬äº«é” API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-671"><span class="toc-number">29.6.3.</span> <span class="toc-text"> 6.3. AQS çš„åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-672"><span class="toc-number">29.6.3.1.</span> <span class="toc-text"> AQS çš„æ•°æ®ç»“æ„</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-673"><span class="toc-number">29.6.4.</span> <span class="toc-text"> 2.2.  AtomicInteger  å®ç°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-674"><span class="toc-number">29.7.</span> <span class="toc-text"> 3. å¼•ç”¨ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-675"><span class="toc-number">29.8.</span> <span class="toc-text"> 4. æ•°ç»„ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-676"><span class="toc-number">29.9.</span> <span class="toc-text"> 5. å±æ€§æ›´æ–°å™¨ç±»å‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-677"><span class="toc-number">29.10.</span> <span class="toc-text"> 6. åŸå­åŒ–çš„ç´¯åŠ å™¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%B9%B6%E5%8F%91%E5%92%8C%E5%AE%B9%E5%99%A8"><span class="toc-number">30.</span> <span class="toc-text"> Java å¹¶å‘å’Œå®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-678"><span class="toc-number">30.1.</span> <span class="toc-text"> 1. åŒæ­¥å®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-679"><span class="toc-number">30.1.1.</span> <span class="toc-text"> 1.1. åŒæ­¥å®¹å™¨ç®€ä»‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-680"><span class="toc-number">30.2.</span> <span class="toc-text"> 2. å¹¶å‘å®¹å™¨ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-681"><span class="toc-number">30.2.1.</span> <span class="toc-text"> 2.1. å¹¶å‘åœºæ™¯ä¸‹çš„ Map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-682"><span class="toc-number">30.2.2.</span> <span class="toc-text"> 2.2. å¹¶å‘åœºæ™¯ä¸‹çš„ List</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-683"><span class="toc-number">30.3.</span> <span class="toc-text"> 3. Map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-684"><span class="toc-number">30.3.1.</span> <span class="toc-text"> 3.1. ConcurrentHashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-685"><span class="toc-number">30.3.1.1.</span> <span class="toc-text">  ConcurrentHashMap  çš„ç‰¹æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-686"><span class="toc-number">30.3.1.2.</span> <span class="toc-text"> ConcurrentHashMap çš„ç”¨æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-687"><span class="toc-number">30.3.1.3.</span> <span class="toc-text"> ConcurrentHashMap çš„åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-688"><span class="toc-number">30.3.1.3.1.</span> <span class="toc-text"> Java 1.7 çš„å®ç°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-689"><span class="toc-number">30.3.1.3.2.</span> <span class="toc-text"> Java 1.8 çš„å®ç°</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-690"><span class="toc-number">30.3.1.4.</span> <span class="toc-text"> ConcurrentHashMap çš„å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-691"><span class="toc-number">30.3.1.4.1.</span> <span class="toc-text"> ConcurrentHashMap é”™è¯¯ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-692"><span class="toc-number">30.3.1.4.2.</span> <span class="toc-text"> ConcurrentHashMap é”™è¯¯ç¤ºä¾‹ä¿®æ­£ 1.0 ç‰ˆ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-693"><span class="toc-number">30.3.1.4.3.</span> <span class="toc-text"> ConcurrentHashMap é”™è¯¯ç¤ºä¾‹ä¿®æ­£ 2.0 ç‰ˆ</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-694"><span class="toc-number">30.4.</span> <span class="toc-text"> 4. List</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-695"><span class="toc-number">30.4.1.</span> <span class="toc-text"> 4.1. CopyOnWriteArrayList</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-696"><span class="toc-number">30.4.1.1.</span> <span class="toc-text"> CopyOnWriteArrayList åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-697"><span class="toc-number">30.4.1.2.</span> <span class="toc-text"> CopyOnWriteArrayList ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-698"><span class="toc-number">30.4.1.3.</span> <span class="toc-text"> CopyOnWriteArrayList å®æˆ˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-699"><span class="toc-number">30.5.</span> <span class="toc-text"> 5. Set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-700"><span class="toc-number">30.6.</span> <span class="toc-text"> 6. Queue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-701"><span class="toc-number">30.6.1.</span> <span class="toc-text"> 6.1. BlockingQueue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-702"><span class="toc-number">30.6.2.</span> <span class="toc-text"> 6.2. PriorityBlockingQueue ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-703"><span class="toc-number">30.6.2.1.</span> <span class="toc-text"> PriorityBlockingQueue è¦ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-704"><span class="toc-number">30.6.2.2.</span> <span class="toc-text"> PriorityBlockingQueue åŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-705"><span class="toc-number">30.6.3.</span> <span class="toc-text"> 6.3. ArrayBlockingQueue ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-706"><span class="toc-number">30.6.3.1.</span> <span class="toc-text"> ArrayBlockingQueue è¦ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-707"><span class="toc-number">30.6.3.2.</span> <span class="toc-text"> ArrayBlockingQueue åŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-708"><span class="toc-number">30.6.4.</span> <span class="toc-text"> 6.4. LinkedBlockingQueue ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-709"><span class="toc-number">30.6.4.1.</span> <span class="toc-text"> LinkedBlockingQueue è¦ç‚¹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-710"><span class="toc-number">30.6.4.2.</span> <span class="toc-text"> LinkedBlockingQueue åŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-711"><span class="toc-number">30.6.5.</span> <span class="toc-text"> 6.5. SynchronousQueue ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-712"><span class="toc-number">30.6.6.</span> <span class="toc-text"> 6.6. ConcurrentLinkedDeque ç±»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-713"><span class="toc-number">30.6.7.</span> <span class="toc-text"> 6.7. Queue çš„å¹¶å‘åº”ç”¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="toc-number">31.</span> <span class="toc-text"> Java çº¿ç¨‹æ± </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-714"><span class="toc-number">31.1.</span> <span class="toc-text"> 1. ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-715"><span class="toc-number">31.1.1.</span> <span class="toc-text"> 1.1. ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-716"><span class="toc-number">31.1.2.</span> <span class="toc-text"> 1.2. ä¸ºä»€ä¹ˆè¦ç”¨çº¿ç¨‹æ± </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-717"><span class="toc-number">31.2.</span> <span class="toc-text"> 2. Executor æ¡†æ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-718"><span class="toc-number">31.2.1.</span> <span class="toc-text"> 2.1. æ ¸å¿ƒ API æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-719"><span class="toc-number">31.2.2.</span> <span class="toc-text"> 2.3. ExecutorService</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-720"><span class="toc-number">31.2.3.</span> <span class="toc-text"> 2.4. ScheduledExecutorService</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-721"><span class="toc-number">31.3.</span> <span class="toc-text"> 3. ThreadPoolExecutor</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-722"><span class="toc-number">31.3.1.</span> <span class="toc-text"> 3.1. é‡è¦å­—æ®µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-723"><span class="toc-number">31.3.2.</span> <span class="toc-text"> 3.3. execute æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-724"><span class="toc-number">31.3.3.</span> <span class="toc-text"> 3.4. å…¶ä»–é‡è¦æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-725"><span class="toc-number">31.3.4.</span> <span class="toc-text"> 3.5. ä½¿ç”¨ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-726"><span class="toc-number">31.4.</span> <span class="toc-text"> 4. Executors</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-727"><span class="toc-number">31.4.1.</span> <span class="toc-text"> 4.1. newSingleThreadExecutor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-728"><span class="toc-number">31.4.2.</span> <span class="toc-text"> 4.2. newFixedThreadPool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-729"><span class="toc-number">31.4.3.</span> <span class="toc-text"> 4.3. newCachedThreadPool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-730"><span class="toc-number">31.4.4.</span> <span class="toc-text"> 4.4. newScheduleThreadPool</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-731"><span class="toc-number">31.4.5.</span> <span class="toc-text"> 4.5. newWorkStealingPool</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-732"><span class="toc-number">31.5.</span> <span class="toc-text"> 5. çº¿ç¨‹æ± æœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-733"><span class="toc-number">31.5.1.</span> <span class="toc-text"> 5.1. è®¡ç®—çº¿ç¨‹æ•°é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-734"><span class="toc-number">31.5.2.</span> <span class="toc-text"> 5.2. å»ºè®®ä½¿ç”¨æœ‰ç•Œé˜»å¡é˜Ÿåˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-735"><span class="toc-number">31.5.3.</span> <span class="toc-text"> 5.3. é‡è¦ä»»åŠ¡åº”è¯¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">32.</span> <span class="toc-text"> Java å¹¶å‘å·¥å…·ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-736"><span class="toc-number">32.1.</span> <span class="toc-text"> 1. CountDownLatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-737"><span class="toc-number">32.2.</span> <span class="toc-text"> 2. CyclicBarrier</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-738"><span class="toc-number">32.3.</span> <span class="toc-text"> 3. Semaphore</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-739"><span class="toc-number">32.4.</span> <span class="toc-text"> 4. æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B"><span class="toc-number">33.</span> <span class="toc-text"> Java å†…å­˜æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-740"><span class="toc-number">33.1.</span> <span class="toc-text"> 1. ç‰©ç†å†…å­˜æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-741"><span class="toc-number">33.1.1.</span> <span class="toc-text"> 1.1. ç¡¬ä»¶å¤„ç†æ•ˆç‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-742"><span class="toc-number">33.1.2.</span> <span class="toc-text"> 1.2. ç¼“å­˜ä¸€è‡´æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-743"><span class="toc-number">33.1.3.</span> <span class="toc-text"> 1.3. ä»£ç ä¹±åºæ‰§è¡Œä¼˜åŒ–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-744"><span class="toc-number">33.2.</span> <span class="toc-text"> 2. Java å†…å­˜æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-745"><span class="toc-number">33.2.1.</span> <span class="toc-text"> 2.1. ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-746"><span class="toc-number">33.2.2.</span> <span class="toc-text"> 2.2. JMM å†…å­˜æ“ä½œçš„é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-747"><span class="toc-number">33.2.3.</span> <span class="toc-text"> 2.3. å†…å­˜é—´äº¤äº’æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-748"><span class="toc-number">33.2.4.</span> <span class="toc-text"> 2.4. å¹¶å‘å®‰å…¨ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-749"><span class="toc-number">33.2.4.1.</span> <span class="toc-text"> åŸå­æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-750"><span class="toc-number">33.2.4.2.</span> <span class="toc-text"> å¯è§æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-751"><span class="toc-number">33.2.4.3.</span> <span class="toc-text"> æœ‰åºæ€§</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-752"><span class="toc-number">33.3.</span> <span class="toc-text"> 3. Happens-Before</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-753"><span class="toc-number">33.4.</span> <span class="toc-text"> 4. å†…å­˜å±éšœ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-754"><span class="toc-number">33.5.</span> <span class="toc-text"> 5. volatile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-755"><span class="toc-number">33.5.0.1.</span> <span class="toc-text"> volatile å˜é‡çš„ç‰¹æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-756"><span class="toc-number">33.5.0.1.1.</span> <span class="toc-text"> ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-757"><span class="toc-number">33.5.0.1.2.</span> <span class="toc-text"> è¯­ä¹‰ 2 ç¦æ­¢è¿›è¡ŒæŒ‡ä»¤é‡æ’åº</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-758"><span class="toc-number">33.5.0.2.</span> <span class="toc-text"> volatile çš„åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-759"><span class="toc-number">33.5.0.3.</span> <span class="toc-text"> volatile çš„ä½¿ç”¨åœºæ™¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-760"><span class="toc-number">33.6.</span> <span class="toc-text"> 6. synchronized</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-761"><span class="toc-number">33.6.1.</span> <span class="toc-text"> 6.1. long å’Œ double å˜é‡çš„ç‰¹æ®Šè§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-762"><span class="toc-number">33.6.2.</span> <span class="toc-text"> 6.2. final å‹é‡çš„ç‰¹æ®Šè§„åˆ™</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vm-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">34.</span> <span class="toc-text"> VM ä½“ç³»ç»“æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-763"><span class="toc-number">34.1.</span> <span class="toc-text"> 1. JVM ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-764"><span class="toc-number">34.1.1.</span> <span class="toc-text"> 1.1. è®¡ç®—æœºä½“ç³»ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-765"><span class="toc-number">34.1.2.</span> <span class="toc-text"> 1.2. JVM ä½“ç³»ç»“æ„ç®€ä»‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-766"><span class="toc-number">34.2.</span> <span class="toc-text"> 2. Hotspot æ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-767"><span class="toc-number">34.2.1.</span> <span class="toc-text"> 2.1. Hotspot å…³é”®ç»„ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-768"><span class="toc-number">34.2.2.</span> <span class="toc-text"> 2.2. æ€§èƒ½æŒ‡æ ‡</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">35.</span> <span class="toc-text"> Java å†…å­˜ç®¡ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-769"><span class="toc-number">35.1.</span> <span class="toc-text"> 1. å†…å­˜ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-770"><span class="toc-number">35.1.1.</span> <span class="toc-text"> 1.1. ç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-771"><span class="toc-number">35.1.2.</span> <span class="toc-text"> 1.2. å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-772"><span class="toc-number">35.1.3.</span> <span class="toc-text"> 1.3. ä½¿ç”¨å†…å­˜çš„ Java ç»„ä»¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-773"><span class="toc-number">35.2.</span> <span class="toc-text"> 2. è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-774"><span class="toc-number">35.2.1.</span> <span class="toc-text"> 2.1. ç¨‹åºè®¡æ•°å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-775"><span class="toc-number">35.2.2.</span> <span class="toc-text"> 2.2. Java è™šæ‹Ÿæœºæ ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-776"><span class="toc-number">35.2.3.</span> <span class="toc-text"> 2.3. æœ¬åœ°æ–¹æ³•æ ˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-777"><span class="toc-number">35.2.4.</span> <span class="toc-text"> 2.4. Java å †</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-778"><span class="toc-number">35.2.5.</span> <span class="toc-text"> 2.5. æ–¹æ³•åŒº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-779"><span class="toc-number">35.2.6.</span> <span class="toc-text"> 2.6. è¿è¡Œæ—¶å¸¸é‡æ± </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-780"><span class="toc-number">35.2.7.</span> <span class="toc-text"> 2.7. ç›´æ¥å†…å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-781"><span class="toc-number">35.2.8.</span> <span class="toc-text"> 2.8. Java å†…å­˜åŒºåŸŸå¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-782"><span class="toc-number">35.3.</span> <span class="toc-text"> 3. JVM è¿è¡ŒåŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-783"><span class="toc-number">35.4.</span> <span class="toc-text"> 4. OutOfMemoryError</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-784"><span class="toc-number">35.4.1.</span> <span class="toc-text"> 4.1. ä»€ä¹ˆæ˜¯ OutOfMemoryError</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-785"><span class="toc-number">35.4.2.</span> <span class="toc-text"> 4.2. å †ç©ºé—´æº¢å‡º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-786"><span class="toc-number">35.4.2.1.</span> <span class="toc-text"> Java heap space åˆ†ææ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-787"><span class="toc-number">35.4.2.2.</span> <span class="toc-text"> å†…å­˜æ³„æ¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-788"><span class="toc-number">35.4.2.3.</span> <span class="toc-text"> å†…å­˜æº¢å‡º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-789"><span class="toc-number">35.4.3.</span> <span class="toc-text"> 4.3. GC å¼€é”€è¶…è¿‡é™åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-790"><span class="toc-number">35.4.4.</span> <span class="toc-text"> 4.4. æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-791"><span class="toc-number">35.4.4.1.</span> <span class="toc-text"> åˆå§‹åŒ–æ—¶æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-792"><span class="toc-number">35.4.4.2.</span> <span class="toc-text"> é‡éƒ¨ç½²æ—¶æ°¸ä¹…ä»£ç©ºé—´ä¸è¶³</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-793"><span class="toc-number">35.4.4.3.</span> <span class="toc-text"> PermGen space è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-794"><span class="toc-number">35.4.5.</span> <span class="toc-text"> 4.5. å…ƒæ•°æ®åŒºç©ºé—´ä¸è¶³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-795"><span class="toc-number">35.4.6.</span> <span class="toc-text"> 4.6. æ— æ³•æ–°å»ºæœ¬åœ°çº¿ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-796"><span class="toc-number">35.4.7.</span> <span class="toc-text"> 4.7. ç›´æ¥å†…å­˜æº¢å‡º</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-797"><span class="toc-number">35.5.</span> <span class="toc-text"> 5. StackOverflowError</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jvm-%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86"><span class="toc-number">36.</span> <span class="toc-text"> JVM åƒåœ¾æ”¶é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-798"><span class="toc-number">36.1.</span> <span class="toc-text"> 1. å¯¹è±¡æ´»ç€å—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-799"><span class="toc-number">36.1.1.</span> <span class="toc-text"> 1.1. å¼•ç”¨è®¡æ•°ç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-800"><span class="toc-number">36.1.2.</span> <span class="toc-text"> 1.2. å¯è¾¾æ€§åˆ†æç®—æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-801"><span class="toc-number">36.1.3.</span> <span class="toc-text"> 1.3. å¼•ç”¨ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-802"><span class="toc-number">36.1.3.1.</span> <span class="toc-text"> å¼ºå¼•ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-803"><span class="toc-number">36.1.3.2.</span> <span class="toc-text"> è½¯å¼•ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-804"><span class="toc-number">36.1.3.3.</span> <span class="toc-text"> å¼±å¼•ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-805"><span class="toc-number">36.1.3.4.</span> <span class="toc-text"> è™šå¼•ç”¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-806"><span class="toc-number">36.1.4.</span> <span class="toc-text"> 1.4. æ–¹æ³•åŒºçš„å›æ”¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-807"><span class="toc-number">36.1.5.</span> <span class="toc-text"> 1.5. finalize()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-808"><span class="toc-number">36.2.</span> <span class="toc-text"> 2. åƒåœ¾æ”¶é›†ç®—æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-809"><span class="toc-number">36.2.1.</span> <span class="toc-text"> 2.1. åƒåœ¾æ”¶é›†æ€§èƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-810"><span class="toc-number">36.2.2.</span> <span class="toc-text"> 2.2. æ ‡è®° - æ¸…é™¤ï¼ˆMark-Sweepï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-811"><span class="toc-number">36.2.3.</span> <span class="toc-text"> 2.3. æ ‡è®° - æ•´ç†ï¼ˆMark-Compactï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-812"><span class="toc-number">36.2.4.</span> <span class="toc-text"> 2.4. å¤åˆ¶ï¼ˆCopyingï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-813"><span class="toc-number">36.2.5.</span> <span class="toc-text"> 2.5. åˆ†ä»£æ”¶é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-814"><span class="toc-number">36.2.5.1.</span> <span class="toc-text"> æ–°ç”Ÿä»£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-815"><span class="toc-number">36.2.5.2.</span> <span class="toc-text"> è€å¹´ä»£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-816"><span class="toc-number">36.2.5.3.</span> <span class="toc-text"> æ°¸ä¹…ä»£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-817"><span class="toc-number">36.2.5.4.</span> <span class="toc-text"> JVM å‚æ•°</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-818"><span class="toc-number">36.3.</span> <span class="toc-text"> 3. åƒåœ¾æ”¶é›†å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-819"><span class="toc-number">36.3.1.</span> <span class="toc-text"> 3.1. ä¸²è¡Œæ”¶é›†å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-820"><span class="toc-number">36.3.1.1.</span> <span class="toc-text"> Serial æ”¶é›†å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-821"><span class="toc-number">36.3.1.2.</span> <span class="toc-text"> Serial Old æ”¶é›†å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-822"><span class="toc-number">36.3.2.</span> <span class="toc-text"> 3.2. å¹¶è¡Œæ”¶é›†å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-823"><span class="toc-number">36.3.2.1.</span> <span class="toc-text"> Parallel Scavenge æ”¶é›†å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-824"><span class="toc-number">36.3.2.2.</span> <span class="toc-text"> Parallel Old æ”¶é›†å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-825"><span class="toc-number">36.3.3.</span> <span class="toc-text"> 3.3. å¹¶å‘æ ‡è®°æ¸…é™¤æ”¶é›†å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-826"><span class="toc-number">36.3.3.1.</span> <span class="toc-text"> CMS æ”¶é›†å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-827"><span class="toc-number">36.3.3.1.1.</span> <span class="toc-text"> CMS å›æ”¶æœºåˆ¶</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-828"><span class="toc-number">36.3.3.1.2.</span> <span class="toc-text"> CMS å›æ”¶å¹´è½»ä»£è¯¦ç»†æ­¥éª¤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-829"><span class="toc-number">36.3.3.1.3.</span> <span class="toc-text"> CMS å›æ”¶å¹´è€ä»£è¯¦ç»†æ­¥éª¤</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-830"><span class="toc-number">36.3.3.1.4.</span> <span class="toc-text"> CMS ç‰¹ç‚¹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-831"><span class="toc-number">36.3.3.2.</span> <span class="toc-text"> ParNew æ”¶é›†å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-832"><span class="toc-number">36.3.4.</span> <span class="toc-text"> 3.4. G1 æ”¶é›†å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-833"><span class="toc-number">36.3.4.1.</span> <span class="toc-text"> åˆ†ä»£å’Œåˆ†åŒº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-834"><span class="toc-number">36.3.4.2.</span> <span class="toc-text"> G1 å›æ”¶æœºåˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-835"><span class="toc-number">36.3.4.3.</span> <span class="toc-text"> G1 å›æ”¶å¹´è½»ä»£è¯¦ç»†æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-836"><span class="toc-number">36.3.4.4.</span> <span class="toc-text"> G1 å›æ”¶å¹´è€ä»£è¯¦ç»†æ­¥éª¤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-837"><span class="toc-number">36.3.5.</span> <span class="toc-text"> 3.5. æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-838"><span class="toc-number">36.4.</span> <span class="toc-text"> 4. å†…å­˜åˆ†é…ä¸å›æ”¶ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-839"><span class="toc-number">36.4.1.</span> <span class="toc-text"> 4.1. Minor GC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-840"><span class="toc-number">36.4.2.</span> <span class="toc-text"> 4.2. Full GC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-841"><span class="toc-number">36.4.2.1.</span> <span class="toc-text"> å†…å­˜åˆ†é…ç­–ç•¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-842"><span class="toc-number">36.4.2.2.</span> <span class="toc-text"> Full GC çš„è§¦å‘æ¡ä»¶</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jvm-%E5%AD%97%E8%8A%82%E7%A0%81"><span class="toc-number">37.</span> <span class="toc-text"> JVM å­—èŠ‚ç </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-843"><span class="toc-number">37.1.</span> <span class="toc-text"> 1. å­—èŠ‚ç </span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-844"><span class="toc-number">37.1.1.</span> <span class="toc-text"> 1.1. ä»€ä¹ˆæ˜¯å­—èŠ‚ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-845"><span class="toc-number">37.1.2.</span> <span class="toc-text"> 1.2. å­—èŠ‚ç ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-846"><span class="toc-number">37.1.3.</span> <span class="toc-text"> 1.3. å­—èŠ‚ç æ“ä½œé›†åˆ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-847"><span class="toc-number">37.1.4.</span> <span class="toc-text"> 1.4. æ“ä½œæ•°æ ˆå’Œå­—èŠ‚ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-848"><span class="toc-number">37.1.5.</span> <span class="toc-text"> 1.5. å­—èŠ‚ç å·¥å…·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-849"><span class="toc-number">37.2.</span> <span class="toc-text"> 2. å­—èŠ‚ç å¢å¼º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-850"><span class="toc-number">37.2.1.</span> <span class="toc-text"> 2.1. Asm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-851"><span class="toc-number">37.2.1.1.</span> <span class="toc-text"> æ ¸å¿ƒ API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-852"><span class="toc-number">37.2.1.2.</span> <span class="toc-text"> æ ‘å½¢ API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-853"><span class="toc-number">37.2.2.</span> <span class="toc-text"> 2.2. Javassist</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jvm-%E7%B1%BB%E5%8A%A0%E8%BD%BD"><span class="toc-number">38.</span> <span class="toc-text"> JVM ç±»åŠ è½½</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-854"><span class="toc-number">38.1.</span> <span class="toc-text"> 1. ç±»åŠ è½½æœºåˆ¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-855"><span class="toc-number">38.2.</span> <span class="toc-text"> 2. ç±»çš„ç”Ÿå‘½å‘¨æœŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-856"><span class="toc-number">38.2.1.</span> <span class="toc-text"> 2.1. ï¼ˆä¸€ï¼‰åŠ è½½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-857"><span class="toc-number">38.2.2.</span> <span class="toc-text"> 2.2. ï¼ˆäºŒï¼‰éªŒè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-858"><span class="toc-number">38.2.3.</span> <span class="toc-text"> 2.3. ï¼ˆä¸‰ï¼‰å‡†å¤‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-859"><span class="toc-number">38.2.4.</span> <span class="toc-text"> 2.4. ï¼ˆå››ï¼‰è§£æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-860"><span class="toc-number">38.2.5.</span> <span class="toc-text"> 2.5. ï¼ˆäº”ï¼‰åˆå§‹åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-861"><span class="toc-number">38.2.5.1.</span> <span class="toc-text"> ç±»åˆå§‹åŒ–æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-862"><span class="toc-number">38.2.5.2.</span> <span class="toc-text"> ç±»åˆå§‹åŒ–æ­¥éª¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-863"><span class="toc-number">38.2.5.3.</span> <span class="toc-text"> ç±»åˆå§‹åŒ–æ—¶æœº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-864"><span class="toc-number">38.2.5.4.</span> <span class="toc-text"> ç±»åˆå§‹åŒ–ç»†èŠ‚</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-865"><span class="toc-number">38.3.</span> <span class="toc-text"> 3. ClassLoader</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-866"><span class="toc-number">38.3.1.</span> <span class="toc-text"> 3.1. ç±»ä¸ç±»åŠ è½½å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-867"><span class="toc-number">38.3.2.</span> <span class="toc-text"> 3.2. ç±»åŠ è½½å™¨åˆ†ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-868"><span class="toc-number">38.3.2.1.</span> <span class="toc-text"> Bootstrap ClassLoader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-869"><span class="toc-number">38.3.2.2.</span> <span class="toc-text"> ExtClassLoader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-870"><span class="toc-number">38.3.2.3.</span> <span class="toc-text"> AppClassLoader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-871"><span class="toc-number">38.3.2.4.</span> <span class="toc-text"> è‡ªå®šä¹‰ç±»åŠ è½½å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-872"><span class="toc-number">38.3.3.</span> <span class="toc-text"> 3.3. åŒäº²å§”æ´¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-873"><span class="toc-number">38.3.4.</span> <span class="toc-text"> 3.4. ClassLoader å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-874"><span class="toc-number">38.4.</span> <span class="toc-text"> 4. ç±»çš„åŠ è½½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-875"><span class="toc-number">38.4.1.</span> <span class="toc-text"> 4.1. ç±»åŠ è½½æ–¹å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-876"><span class="toc-number">38.4.2.</span> <span class="toc-text"> 4.2. åŠ è½½ç±»é”™è¯¯</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-877"><span class="toc-number">38.4.2.1.</span> <span class="toc-text"> ClassNotFoundException</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-878"><span class="toc-number">38.4.2.2.</span> <span class="toc-text"> NoClassDefFoundError</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-879"><span class="toc-number">38.4.2.3.</span> <span class="toc-text"> UnsatisfiedLinkError</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-880"><span class="toc-number">38.4.2.4.</span> <span class="toc-text"> ClassCastException</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jvm-%E5%AE%9E%E6%88%98"><span class="toc-number">39.</span> <span class="toc-text"> JVM å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-881"><span class="toc-number">39.1.</span> <span class="toc-text"> 1. JVM è°ƒä¼˜æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-882"><span class="toc-number">39.1.1.</span> <span class="toc-text"> 1.1. GC æ€§èƒ½æŒ‡æ ‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-883"><span class="toc-number">39.1.2.</span> <span class="toc-text"> 1.2. è°ƒä¼˜åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-884"><span class="toc-number">39.1.2.1.</span> <span class="toc-text"> é™ä½ Minor GC é¢‘ç‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-885"><span class="toc-number">39.1.2.2.</span> <span class="toc-text"> é™ä½ Full GC çš„é¢‘ç‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-886"><span class="toc-number">39.1.2.3.</span> <span class="toc-text"> é™ä½ Full GC çš„æ—¶é—´</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-887"><span class="toc-number">39.1.3.</span> <span class="toc-text"> 1.3. GC ä¼˜åŒ–çš„è¿‡ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-888"><span class="toc-number">39.1.3.1.</span> <span class="toc-text"> ï¼ˆ1ï¼‰ç›‘æ§ GC çŠ¶æ€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-889"><span class="toc-number">39.1.3.2.</span> <span class="toc-text"> ï¼ˆ2ï¼‰åˆ†æ GC æ—¥å¿—</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-890"><span class="toc-number">39.1.3.3.</span> <span class="toc-text"> ï¼ˆ3ï¼‰é€‰æ‹©åˆé€‚ GC å›æ”¶å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-891"><span class="toc-number">39.1.3.4.</span> <span class="toc-text"> ï¼ˆ4ï¼‰åˆ†æç»“æœ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-892"><span class="toc-number">39.1.3.5.</span> <span class="toc-text"> ï¼ˆ5ï¼‰åº”ç”¨ä¼˜åŒ–é…ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-893"><span class="toc-number">39.2.</span> <span class="toc-text"> 2. GC æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-894"><span class="toc-number">39.2.1.</span> <span class="toc-text"> 2.1. è·å– GC æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-895"><span class="toc-number">39.2.1.1.</span> <span class="toc-text"> jstat å‘½ä»¤æŸ¥çœ‹ GC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-896"><span class="toc-number">39.2.1.2.</span> <span class="toc-text"> æ‰“å° GC çš„å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-897"><span class="toc-number">39.2.2.</span> <span class="toc-text"> 2.2. åˆ†æ GC æ—¥å¿—</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-898"><span class="toc-number">39.2.2.1.</span> <span class="toc-text"> CPU è¿‡é«˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-899"><span class="toc-number">39.3.</span> <span class="toc-text"> 3. GC é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-900"><span class="toc-number">39.3.1.</span> <span class="toc-text"> 3.1. å †å¤§å°è®¾ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-901"><span class="toc-number">39.3.2.</span> <span class="toc-text"> 3.2. JVM å†…å­˜é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-902"><span class="toc-number">39.3.3.</span> <span class="toc-text"> 3.3. GC ç±»å‹é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-903"><span class="toc-number">39.3.4.</span> <span class="toc-text"> 3.4. åƒåœ¾å›æ”¶å™¨é€šç”¨å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-904"><span class="toc-number">39.3.5.</span> <span class="toc-text"> 3.5. JMX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-905"><span class="toc-number">39.3.6.</span> <span class="toc-text"> 3.6. è¿œç¨‹ DEBUG</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-906"><span class="toc-number">39.3.7.</span> <span class="toc-text"> 3.7. HeapDump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-907"><span class="toc-number">39.3.8.</span> <span class="toc-text"> 3.8. è¾…åŠ©é…ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jvm-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="toc-number">40.</span> <span class="toc-text"> JVM å‘½ä»¤è¡Œå·¥å…·</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-908"><span class="toc-number">40.1.</span> <span class="toc-text"> 1. jps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-909"><span class="toc-number">40.1.1.</span> <span class="toc-text"> 1.1. jps å‘½ä»¤ç”¨æ³•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-910"><span class="toc-number">40.2.</span> <span class="toc-text"> 2. jstat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-911"><span class="toc-number">40.2.1.</span> <span class="toc-text"> 2.1. jstat å‘½ä»¤ç”¨æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-912"><span class="toc-number">40.2.1.1.</span> <span class="toc-text"> ç¼–è¯‘ç»Ÿè®¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-913"><span class="toc-number">40.2.1.2.</span> <span class="toc-text"> GC ç»Ÿè®¡</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-914"><span class="toc-number">40.3.</span> <span class="toc-text"> 3. jmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-915"><span class="toc-number">40.3.1.</span> <span class="toc-text"> 3.1. jmap å‘½ä»¤ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-916"><span class="toc-number">40.3.2.</span> <span class="toc-text"> 3.2. jstat ä½¿ç”¨ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-917"><span class="toc-number">40.3.2.1.</span> <span class="toc-text"> ç”Ÿæˆ heapdump å¿«ç…§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-918"><span class="toc-number">40.3.2.2.</span> <span class="toc-text"> æŸ¥çœ‹å®ä¾‹æ•°æœ€å¤šçš„ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-919"><span class="toc-number">40.3.2.3.</span> <span class="toc-text"> æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„å †ä¿¡æ¯</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-920"><span class="toc-number">40.4.</span> <span class="toc-text"> 4. jstack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-921"><span class="toc-number">40.4.1.</span> <span class="toc-text"> 4.1. jstack å‘½ä»¤ç”¨æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-922"><span class="toc-number">40.4.2.</span> <span class="toc-text"> 4.2. thread dump æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-923"><span class="toc-number">40.4.2.1.</span> <span class="toc-text"> ç¬¬ä¸€éƒ¨åˆ†ï¼šFull thread dump identifier</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-924"><span class="toc-number">40.4.2.2.</span> <span class="toc-text"> ç¬¬äºŒéƒ¨åˆ†ï¼šJava EE middleware, third party &amp; custom application Threads</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-925"><span class="toc-number">40.4.2.3.</span> <span class="toc-text"> ç¬¬ä¸‰éƒ¨åˆ†ï¼šHotSpot VM Thread</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-926"><span class="toc-number">40.4.2.3.1.</span> <span class="toc-text"> â€œAttach Listenerâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-927"><span class="toc-number">40.4.2.3.2.</span> <span class="toc-text"> â€œDestroyJavaVMâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-928"><span class="toc-number">40.4.2.3.3.</span> <span class="toc-text"> â€œService Threadâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-929"><span class="toc-number">40.4.2.3.4.</span> <span class="toc-text"> â€œCompilerThreadâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-930"><span class="toc-number">40.4.2.3.5.</span> <span class="toc-text"> â€œSignal Dispatcherâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-931"><span class="toc-number">40.4.2.3.6.</span> <span class="toc-text"> â€œFinalizerâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-932"><span class="toc-number">40.4.2.3.7.</span> <span class="toc-text"> â€œReference Handlerâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-933"><span class="toc-number">40.4.2.3.8.</span> <span class="toc-text"> â€œVM Threadâ€</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-934"><span class="toc-number">40.4.2.4.</span> <span class="toc-text"> ç¬¬å››éƒ¨åˆ†ï¼šHotSpot GC Thread</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#-935"><span class="toc-number">40.4.2.4.1.</span> <span class="toc-text"> â€œVM Periodic Task Threadâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-936"><span class="toc-number">40.4.2.4.2.</span> <span class="toc-text"> â€œGC task thread#0 (ParallelGC)â€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-937"><span class="toc-number">40.4.2.4.3.</span> <span class="toc-text"> â€œGang worker#0 (Parallel GC Threads)â€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-938"><span class="toc-number">40.4.2.4.4.</span> <span class="toc-text"> â€œConcurrent Mark-Sweep GC Threadâ€</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#-939"><span class="toc-number">40.4.2.4.5.</span> <span class="toc-text"> â€œSurrogate Locker Thread (Concurrent GC)â€</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-940"><span class="toc-number">40.4.2.5.</span> <span class="toc-text"> ç¬¬äº”éƒ¨åˆ†ï¼šJNI global references count</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-941"><span class="toc-number">40.4.3.</span> <span class="toc-text"> 4.3. ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-942"><span class="toc-number">40.4.3.1.</span> <span class="toc-text"> deadlock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-943"><span class="toc-number">40.4.3.2.</span> <span class="toc-text"> runnable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-944"><span class="toc-number">40.4.3.3.</span> <span class="toc-text"> blocked</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-945"><span class="toc-number">40.4.3.4.</span> <span class="toc-text"> waiting on condition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-946"><span class="toc-number">40.4.3.5.</span> <span class="toc-text"> waiting for monitor entry æˆ– in Object.wait ()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-947"><span class="toc-number">40.4.4.</span> <span class="toc-text"> 4.4. jstack ä½¿ç”¨ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-948"><span class="toc-number">40.4.4.1.</span> <span class="toc-text"> æ‰¾å‡ºæŸ Java è¿›ç¨‹ä¸­æœ€è€—è´¹ CPU çš„ Java çº¿ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-949"><span class="toc-number">40.4.4.2.</span> <span class="toc-text"> ç”Ÿæˆ threaddump æ–‡ä»¶</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-950"><span class="toc-number">40.5.</span> <span class="toc-text"> 5. jinfo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-951"><span class="toc-number">40.6.</span> <span class="toc-text"> 6. jhat</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jvm-gui-%E5%B7%A5%E5%85%B7"><span class="toc-number">41.</span> <span class="toc-text"> JVM GUI å·¥å…·</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-952"><span class="toc-number">41.1.</span> <span class="toc-text"> 1. jconsole</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-953"><span class="toc-number">41.1.1.</span> <span class="toc-text"> 1.1. å¼€å¯ JMX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-954"><span class="toc-number">41.1.2.</span> <span class="toc-text"> 1.2. è¿æ¥ jconsole</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-955"><span class="toc-number">41.1.3.</span> <span class="toc-text"> 1.3. jconsole ç•Œé¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-956"><span class="toc-number">41.2.</span> <span class="toc-text"> 2. jvisualvm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-957"><span class="toc-number">41.2.1.</span> <span class="toc-text"> 2.1. jvisualvm æ¦‚è¿°é¡µé¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-958"><span class="toc-number">41.2.2.</span> <span class="toc-text"> 2.2. jvisualvm ç›‘æ§é¡µé¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-959"><span class="toc-number">41.2.3.</span> <span class="toc-text"> 2.3. jvisualvm çº¿ç¨‹é¡µé¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-960"><span class="toc-number">41.2.4.</span> <span class="toc-text"> 2.4. jvisualvm æŠ½æ ·å™¨é¡µé¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-961"><span class="toc-number">41.3.</span> <span class="toc-text"> 3. MAT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-962"><span class="toc-number">41.3.1.</span> <span class="toc-text"> 3.1. MAT é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-963"><span class="toc-number">41.3.2.</span> <span class="toc-text"> 3.2. MAT åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-964"><span class="toc-number">41.4.</span> <span class="toc-text"> 4. JProfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-965"><span class="toc-number">41.5.</span> <span class="toc-text"> 5. Arthas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-966"><span class="toc-number">41.5.1.</span> <span class="toc-text"> 5.1. Arthas åŸºç¡€å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-967"><span class="toc-number">41.5.2.</span> <span class="toc-text"> 5.2. Arthas jvm ç›¸å…³å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-968"><span class="toc-number">41.5.3.</span> <span class="toc-text"> 5.3. Arthas class&#x2F;classloader ç›¸å…³å‘½ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-969"><span class="toc-number">41.5.4.</span> <span class="toc-text"> 5.4. Arthas monitor&#x2F;watch&#x2F;trace ç›¸å…³å‘½ä»¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E5%BA%94%E7%94%A8%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD"><span class="toc-number">42.</span> <span class="toc-text"> Java åº”ç”¨æ•…éšœè¯Šæ–­</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-970"><span class="toc-number">42.1.</span> <span class="toc-text"> ä¸€ã€æ•…éšœå®šä½æ€è·¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-971"><span class="toc-number">42.2.</span> <span class="toc-text"> äºŒã€CPU é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-972"><span class="toc-number">42.2.1.</span> <span class="toc-text"> æŸ¥æ‰¾ CPU å ç”¨ç‡è¾ƒé«˜çš„è¿›ç¨‹ã€çº¿ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-973"><span class="toc-number">42.2.2.</span> <span class="toc-text"> æ˜¯å¦å­˜åœ¨é¢‘ç¹ GC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-974"><span class="toc-number">42.2.3.</span> <span class="toc-text"> æ˜¯å¦å­˜åœ¨é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-975"><span class="toc-number">42.3.</span> <span class="toc-text"> ä¸‰ã€å†…å­˜é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-976"><span class="toc-number">42.4.</span> <span class="toc-text"> å››ã€ç£ç›˜é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-977"><span class="toc-number">42.4.1.</span> <span class="toc-text"> æŸ¥çœ‹ç£ç›˜ç©ºé—´ä½¿ç”¨ç‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-978"><span class="toc-number">42.4.2.</span> <span class="toc-text"> æŸ¥çœ‹ç£ç›˜è¯»å†™æ€§èƒ½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-979"><span class="toc-number">42.4.3.</span> <span class="toc-text"> æŸ¥çœ‹å…·ä½“çš„æ–‡ä»¶è¯»å†™æƒ…å†µ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-980"><span class="toc-number">42.5.</span> <span class="toc-text"> äº”ã€ç½‘ç»œé—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-981"><span class="toc-number">42.5.1.</span> <span class="toc-text"> æ— æ³•è¿æ¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-982"><span class="toc-number">42.5.2.</span> <span class="toc-text"> ç½‘ç»œè¶…æ—¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-983"><span class="toc-number">42.5.3.</span> <span class="toc-text"> TCP é˜Ÿåˆ—æº¢å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-984"><span class="toc-number">42.5.4.</span> <span class="toc-text"> RST å¼‚å¸¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-985"><span class="toc-number">42.5.5.</span> <span class="toc-text"> TIME_WAIT å’Œ CLOSE_WAIT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-986"><span class="toc-number">42.5.5.1.</span> <span class="toc-text"> TIME_WAIT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-987"><span class="toc-number">42.5.5.2.</span> <span class="toc-text"> CLOSE_WAIT</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-988"><span class="toc-number">42.6.</span> <span class="toc-text"> å…­ã€GC é—®é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-989"><span class="toc-number">42.6.1.</span> <span class="toc-text"> OOM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-990"><span class="toc-number">42.6.2.</span> <span class="toc-text"> Minor GC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-991"><span class="toc-number">42.6.2.1.</span> <span class="toc-text"> Minor GC è¿‡é¢‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-992"><span class="toc-number">42.6.2.2.</span> <span class="toc-text"> Minor GC è€—æ—¶è¿‡é•¿</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-993"><span class="toc-number">42.6.3.</span> <span class="toc-text"> Full GC è¿‡é¢‘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-994"><span class="toc-number">42.7.</span> <span class="toc-text"> ä¸ƒã€å¸¸ç”¨ Linux å‘½ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-995"><span class="toc-number">42.7.1.</span> <span class="toc-text"> top</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-996"><span class="toc-number">42.7.2.</span> <span class="toc-text"> vmstat</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E9%A2%98"><span class="toc-number">43.</span> <span class="toc-text"> é¢è¯•é¢˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">43.1.</span> <span class="toc-text"> åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-997"><span class="toc-number">43.1.1.</span> <span class="toc-text"> å·¥å…·ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-998"><span class="toc-number">43.1.1.1.</span> <span class="toc-text"> String</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-999"><span class="toc-number">43.1.2.</span> <span class="toc-text"> é¢å‘å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1000"><span class="toc-number">43.1.3.</span> <span class="toc-text"> åå°„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1001"><span class="toc-number">43.1.3.1.</span> <span class="toc-text"> â­ åˆ›å»ºå®ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1002"><span class="toc-number">43.1.3.2.</span> <span class="toc-text"> â­ åŠ è½½å®ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1003"><span class="toc-number">43.1.3.3.</span> <span class="toc-text"> â­â­ åŠ¨æ€ä»£ç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1004"><span class="toc-number">43.1.4.</span> <span class="toc-text"> JDK8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1005"><span class="toc-number">43.1.5.</span> <span class="toc-text"> å…¶ä»–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1006"><span class="toc-number">43.1.5.1.</span> <span class="toc-text"> â­ hashcode</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-1007"><span class="toc-number">43.2.</span> <span class="toc-text"> IO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-1008"><span class="toc-number">43.2.1.</span> <span class="toc-text"> NIO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1009"><span class="toc-number">43.2.2.</span> <span class="toc-text"> åºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1010"><span class="toc-number">43.2.2.1.</span> <span class="toc-text"> â­ åºåˆ—åŒ–é—®é¢˜</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-1011"><span class="toc-number">43.3.</span> <span class="toc-text"> å®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-1012"><span class="toc-number">43.3.1.</span> <span class="toc-text"> List</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1013"><span class="toc-number">43.3.1.1.</span> <span class="toc-text"> ArrayList å’Œ LinkedList æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1014"><span class="toc-number">43.3.2.</span> <span class="toc-text"> Map</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-1015"><span class="toc-number">43.4.</span> <span class="toc-text"> å¹¶å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-1016"><span class="toc-number">43.4.1.</span> <span class="toc-text"> å¹¶å‘ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1017"><span class="toc-number">43.4.1.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1018"><span class="toc-number">43.4.1.2.</span> <span class="toc-text"> å¹¶å‘ï¼ˆå¤šçº¿ç¨‹ï¼‰ç¼–ç¨‹çš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1019"><span class="toc-number">43.4.1.3.</span> <span class="toc-text"> å¹¶å‘ä¸€å®šæ¯”ä¸²è¡Œæ›´å¿«å—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1020"><span class="toc-number">43.4.1.4.</span> <span class="toc-text"> å¦‚ä½•è®©æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æš‚åœä¸€æ®µæ—¶é—´ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1021"><span class="toc-number">43.4.1.5.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯çº¿ç¨‹è°ƒåº¦å™¨ (Thread Scheduler) å’Œæ—¶é—´åˆ†ç‰‡ (Time Slicing)ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1022"><span class="toc-number">43.4.1.6.</span> <span class="toc-text"> åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ (context-switching)ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1023"><span class="toc-number">43.4.1.7.</span> <span class="toc-text"> å¦‚ä½•ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1024"><span class="toc-number">43.4.1.8.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯æ­»é” (Deadlock)ï¼Ÿå¦‚ä½•åˆ†æå’Œé¿å…æ­»é”ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1025"><span class="toc-number">43.4.2.</span> <span class="toc-text"> çº¿ç¨‹åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1026"><span class="toc-number">43.4.2.1.</span> <span class="toc-text"> Java çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸä¸­æœ‰å“ªäº›çŠ¶æ€ï¼Ÿå„çŠ¶æ€ä¹‹é—´å¦‚ä½•åˆ‡æ¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1027"><span class="toc-number">43.4.2.2.</span> <span class="toc-text"> åˆ›å»ºçº¿ç¨‹æœ‰å“ªäº›æ–¹å¼ï¼Ÿè¿™äº›æ–¹æ³•å„è‡ªåˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1028"><span class="toc-number">43.4.2.3.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯  Callable  å’Œ  Future ï¼Ÿä»€ä¹ˆæ˜¯  FutureTask ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1029"><span class="toc-number">43.4.2.4.</span> <span class="toc-text">  start()  å’Œ  run()  æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå¯ä»¥ç›´æ¥è°ƒç”¨  Thread  ç±»çš„  run()  æ–¹æ³•ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1030"><span class="toc-number">43.4.2.5.</span> <span class="toc-text">  sleep() ã€ yield() ã€ join()  æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ  sleep()  å’Œ  yield()  æ–¹æ³•æ˜¯é™æ€ï¼ˆstaticï¼‰çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1031"><span class="toc-number">43.4.2.6.</span> <span class="toc-text"> Java çš„çº¿ç¨‹ä¼˜å…ˆçº§å¦‚ä½•æ§åˆ¶ï¼Ÿé«˜ä¼˜å…ˆçº§çš„ Java çº¿ç¨‹ä¸€å®šå…ˆæ‰§è¡Œå—ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1032"><span class="toc-number">43.4.2.7.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨å®ˆæŠ¤çº¿ç¨‹ï¼Ÿå¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1033"><span class="toc-number">43.4.2.8.</span> <span class="toc-text"> çº¿ç¨‹é—´æ˜¯å¦‚ä½•é€šä¿¡çš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1034"><span class="toc-number">43.4.2.9.</span> <span class="toc-text"> ä¸ºä»€ä¹ˆçº¿ç¨‹é€šä¿¡çš„æ–¹æ³•  wait() ,  notify()  å’Œ  notifyAll()  è¢«å®šä¹‰åœ¨ Object ç±»é‡Œï¼Ÿ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1035"><span class="toc-number">43.4.2.10.</span> <span class="toc-text"> ä¸ºä»€ä¹ˆ  wait() ,  notify()  å’Œ  notifyAll()  å¿…é¡»åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥å—ä¸­è¢«è°ƒç”¨ï¼Ÿ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1036"><span class="toc-number">43.4.3.</span> <span class="toc-text"> å¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1037"><span class="toc-number">43.4.3.1.</span> <span class="toc-text"> â­â­â­  synchronized</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1038"><span class="toc-number">43.4.3.2.</span> <span class="toc-text"> â­  volatile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1039"><span class="toc-number">43.4.3.3.</span> <span class="toc-text"> â­â­ CAS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1040"><span class="toc-number">43.4.3.4.</span> <span class="toc-text"> â­  ThreadLocal</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1041"><span class="toc-number">43.4.4.</span> <span class="toc-text"> å†…å­˜æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1042"><span class="toc-number">43.4.4.1.</span> <span class="toc-text"> ä»€ä¹ˆæ˜¯ Java å†…å­˜æ¨¡å‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1043"><span class="toc-number">43.4.5.</span> <span class="toc-text"> åŒæ­¥å®¹å™¨å’Œå¹¶å‘å®¹å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1044"><span class="toc-number">43.4.5.1.</span> <span class="toc-text"> â­ åŒæ­¥å®¹å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1045"><span class="toc-number">43.4.5.2.</span> <span class="toc-text"> â­â­â­ ConcurrentHashMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1046"><span class="toc-number">43.4.5.3.</span> <span class="toc-text"> â­â­ CopyOnWriteArrayList</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1047"><span class="toc-number">43.4.6.</span> <span class="toc-text"> å¹¶å‘é”</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1048"><span class="toc-number">43.4.6.1.</span> <span class="toc-text"> â­â­ é”ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1049"><span class="toc-number">43.4.6.2.</span> <span class="toc-text"> â­â­ AQS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1050"><span class="toc-number">43.4.6.3.</span> <span class="toc-text"> â­ ReentrantReadWriteLock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1051"><span class="toc-number">43.4.6.4.</span> <span class="toc-text"> â­ Condition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1052"><span class="toc-number">43.4.6.5.</span> <span class="toc-text"> â­â­ æ­»é”</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1053"><span class="toc-number">43.4.7.</span> <span class="toc-text"> åŸå­å˜é‡ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1054"><span class="toc-number">43.4.7.1.</span> <span class="toc-text"> â­ åŸå­ç±»ç®€ä»‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1055"><span class="toc-number">43.4.7.2.</span> <span class="toc-text"> â­ åŸå­ç±»çš„åŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1056"><span class="toc-number">43.4.8.</span> <span class="toc-text"> å¹¶å‘å·¥å…·ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1057"><span class="toc-number">43.4.8.1.</span> <span class="toc-text"> â­ CountDownLatch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1058"><span class="toc-number">43.4.8.2.</span> <span class="toc-text"> â­ CyclicBarrier</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1059"><span class="toc-number">43.4.8.3.</span> <span class="toc-text"> â­ Semaphore</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1060"><span class="toc-number">43.4.9.</span> <span class="toc-text"> çº¿ç¨‹æ± </span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#-1061"><span class="toc-number">43.4.9.1.</span> <span class="toc-text"> â­â­ ThreadPoolExecutor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1062"><span class="toc-number">43.4.9.2.</span> <span class="toc-text"> â­ Executors</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-map"><div class="card-content"><div class="item-headline"><i class="fa fa-globe-asia" aria-hidden="true"></i><span>Visitor Map</span></div><script id="clstr_globe" type="text/javascript" defer="defer" src="//clustrmaps.com/globe.js?d=4LA950xi3DtQgUHPlkO0mo-n_QgrcOu-1BIiVpExg7k"></script></div></div><div class="card-widget card-pixiv"><div class="card-content"><div class="item-headline"><i class="fa fa-image" aria-hidden="true"></i><span>Pixiv Top50</span><iframe src="https://cloud.mokeyjay.com/pixiv" frameborder="0" style="width:99%;height:380px;margin:0;"></iframe></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/04/02/linux%E5%B0%8F%E7%AC%94%E8%AE%B0/" title="Linux easy notes"><img src="https://w.wallhaven.cc/full/8o/wallhaven-8oply1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux easy notes"/></a><div class="content"><a class="title" href="/2022/04/02/linux%E5%B0%8F%E7%AC%94%E8%AE%B0/" title="Linux easy notes">Linux easy notes</a><time datetime="2022-04-01T11:00:00.000Z" title="Created 2022-04-02 00:00:00">2022-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/02/linux%E7%9A%84%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4/" title="Linux commands"><img src="https://raw.githubusercontent.com/HarryQu1229/image-host/ca78dff38e0bfb81a8e98ad64f749e97bcc55f14/notes-img/Billfish.yWAOuM.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux commands"/></a><div class="content"><a class="title" href="/2022/04/02/linux%E7%9A%84%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4/" title="Linux commands">Linux commands</a><time datetime="2022-04-01T11:00:00.000Z" title="Created 2022-04-02 00:00:00">2022-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/02/Linux/" title="Linux notes"><img src="https://w.wallhaven.cc/full/k7/wallhaven-k7v9yq.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux notes"/></a><div class="content"><a class="title" href="/2022/04/02/Linux/" title="Linux notes">Linux notes</a><time datetime="2022-04-01T11:00:00.000Z" title="Created 2022-04-02 00:00:00">2022-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/01/nodejs/" title="Nodejs notes"><img src="https://w.wallhaven.cc/full/28/wallhaven-28wymm.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nodejs notes"/></a><div class="content"><a class="title" href="/2022/03/01/nodejs/" title="Nodejs notes">Nodejs notes</a><time datetime="2022-02-28T11:00:00.000Z" title="Created 2022-03-01 00:00:00">2022-03-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/01/%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Frontend interview questions"><img src="https://w.wallhaven.cc/full/q2/wallhaven-q257x7.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Frontend interview questions"/></a><div class="content"><a class="title" href="/2022/03/01/%E5%88%9D%E4%B8%AD%E7%BA%A7%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Frontend interview questions">Frontend interview questions</a><time datetime="2022-02-28T11:00:00.000Z" title="Created 2022-03-01 00:00:00">2022-03-01</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Harry Qu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="Chat"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://harryqu1229.github.io/2022/02/25/java%E5%A4%A7%E6%80%BB%E7%BB%93/'
    this.page.identifier = '2022/02/25/javaå¤§æ€»ç»“/'
    this.page.title = 'Java big Summary'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://harry-study-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script><script>if (window.DISQUSWIDGETS === undefined) {
  var d = document, s = d.createElement('script');
  s.src = 'https://harry-study-blog.disqus.com/count.js';
  s.id = 'dsq-count-scr';
  (d.head || d.body).appendChild(s);
} else {
  DISQUSWIDGETS.getCount({reset: true});
}</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '5df1e915e0fa867b50de',
      clientSecret: 'ce1cb793fe49078ee9d0102d3326d0d50ff6937b',
      repo: 'blog-comments-storage',
      owner: 'HarryQu1229',
      admin: ['HarryQu1229'],
      id: '94de97b7dd6e02133fc048206b04d910',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Disqus' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<code>.*?<\/code>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    fetch('https://disqus.com/api/3.0/forums/listPosts.json?forum=harry-study-blog&related=thread&limit=6&api_key=B5XFmdGuVaYDW7OIBakffpXoKorvphwRiwONIol4puEtr8YiwYAMAk2K7QcExNLY')
      .then(response => response.json())
      .then(data => {
        const disqusArray = data.response.map(item => {
          return {
            'avatar': item.author.avatar.cache,
            'content': changeContent(item.message),
            'nick': item.author.name,
            'url': item.url,
            'date': item.createdAt
          }
        })

        saveToLocal.set('disqus-newest-comments', JSON.stringify(disqusArray), 10/(60*24))
        generateHtml(disqusArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "Unable to get the data, please make sure the settings are correct."
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick}</span><time> / ${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('disqus-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="2809513713" data-server="netease" data-type="playlist" data-autoplay="false" data-fixed="true" data-order="random" data-theme="#e9ccd3"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>((window.gitter = {}).chat = {}).options = {
  disableDefaultChat: true,
};
document.addEventListener('gitter-sidecar-ready', (e) => {
  const GitterChat = e.detail.Chat
  let chat

  function initGitter () {
    chat = new GitterChat({
      room: 'HarryStudyBlog/community',
      activationElement: '#chat_btn'
    });
  }

  initGitter()

  if (true) {
    document.addEventListener('pjax:complete', () => {
      chat.destroy()
      initGitter()
    })
  }

})</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="async" defer="defer"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="åšå®¢æ¡†æ¶ä¸ºHexo_v5.4.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v3.8.2"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" style="margin-inline:5px" title="æœ¬ç«™ä½¿ç”¨JsDelivrä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œé»˜è®¤çº¿è·¯æ‰˜ç®¡äºVercel"><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨åŒçº¿éƒ¨ç½²ï¼Œè”é€šçº¿è·¯æ‰˜ç®¡äºCoding"><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&amp;logo=Codio" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('å·²æŒ‚è½½butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/footer-beautify-runtime.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitcalendar.akilar.top/api?HarryQu1229",['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'],'HarryQu1229')
    }
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":300,"height":450},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>