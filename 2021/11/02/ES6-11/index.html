<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>My Javascript ES6-11 notes | Harry Blog</title><meta name="keywords" content="frontend,javascript,es6"><meta name="author" content="Harry Qu"><meta name="copyright" content="Harry Qu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="# ECMASript 6 新特性 # 1. let 关键字 let  关键字用来声明变量，使用  let  声明的变量有几个特点：  不允许重复声明 (var 可以) 块级作用域 (ES6 才有的，只要是 let 声明的变量出了任何代码块 {} 就无效了，要是是 var 出了代码块 {} 有时还能用)   ES5-&gt; 全局作用域，函数作用域，eval 里面作用域 (这个也是！) ES6-&amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="My Javascript ES6-11 notes">
<meta property="og:url" content="https://harryqu1229.github.io/2021/11/02/ES6-11/index.html">
<meta property="og:site_name" content="Harry Blog">
<meta property="og:description" content="# ECMASript 6 新特性 # 1. let 关键字 let  关键字用来声明变量，使用  let  声明的变量有几个特点：  不允许重复声明 (var 可以) 块级作用域 (ES6 才有的，只要是 let 声明的变量出了任何代码块 {} 就无效了，要是是 var 出了代码块 {} 有时还能用)   ES5-&gt; 全局作用域，函数作用域，eval 里面作用域 (这个也是！) ES6-&amp;">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://harryqu1229.github.io/img/default-covers/cat.png">
<meta property="article:published_time" content="2021-11-01T11:00:00.000Z">
<meta property="article:modified_time" content="2022-06-12T01:06:29.942Z">
<meta property="article:author" content="Harry Qu">
<meta property="article:tag" content="frontend">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="es6">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://harryqu1229.github.io/img/default-covers/cat.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://harryqu1229.github.io/2021/11/02/ES6-11/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":100,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#C78550","bgDark":"#c08eaf","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'My Javascript ES6-11 notes',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-12 13:06:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">158</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">57</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://miro.medium.com/max/700/1*8nfBRAssY0DuETYwdwyqqw.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Harry Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">My Javascript ES6-11 notes</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-11-01T11:00:00.000Z" title="Created 2021-11-02 00:00:00">2021-11-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-12T01:06:29.942Z" title="Updated 2022-06-12 13:06:29">2022-06-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Frontend/">Frontend</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">32.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>119min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="My Javascript ES6-11 notes"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ecmasript-6-新特性"><a class="markdownIt-Anchor" href="#ecmasript-6-新特性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=%EF%BC%88%E4%BA%8C%EF%BC%89ecmasript-6-%E6%96%B0%E7%89%B9%E6%80%A7">ECMASript 6 新特性</a></h1>
<h2 id="1-let-关键字"><a class="markdownIt-Anchor" href="#1-let-关键字">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_1-let-%E5%85%B3%E9%94%AE%E5%AD%97">1. let 关键字</a></h2>
<p><code>let</code>  关键字用来声明变量，使用  <code>let</code>  声明的变量有几个特点：</p>
<ul>
<li><strong>不允许重复声明 (var 可以)</strong></li>
<li>块级作用域 (ES6 才有的，只要是 let 声明的变量出了任何代码块 {} 就无效了，要是是 var 出了代码块 {} 有时还能用)</li>
</ul>
<blockquote>
<p>ES5-&gt; 全局作用域，函数作用域，eval 里面作用域 (这个也是！)</p>
<p>ES6-&gt; 全局作用域，函数作用域，eval 里面作用域，还有__<mark>块级作用域</mark>__</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>用 var 在全局作用域中，相当于没有这个包裹他的块级作用域，就相当于给 window 加了个属性，所以照样可以访问到</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 报错</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>let 块级作用域，只有代码块中做效</p>
<p>当然像 if, for, while 等等等那些代码块都是有自己的块级作用域</p>
</blockquote>
<ul>
<li><strong>不存在变量提升</strong> (也是跟 var 不一样，var 允许变量提升)</li>
<li>不影响作用域链</li>
</ul>
<blockquote>
<p><strong><mark>块级作用域是不能从外向内找，作用域链是向外找，所以没关系</mark></strong></p>
</blockquote>
<h3 id="应用场景以后声明变量使用let-就对了"><a class="markdownIt-Anchor" href="#应用场景以后声明变量使用let-就对了">#</a> 应用场景：以后声明变量使用 let 就对了</h3>
<p><strong>案例 1</strong>：给多个  <code>div</code>  循环注册点击事件</p>
<ul>
<li>
<p>错误示例:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 错误示例，divs.length = = = 3</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.box div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> divs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        divs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            divs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'pink'</span><span class="token punctuation">;</span> <span class="token comment">//这个我们之前说过的</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
i 为当前作用域下的共享变量。
当每次点击 div 的时候，各个点击事件共享 i 的值。
此时 i = 3，这将报错。
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>在全局作用域中的 for 循环里 var 声明 i, 然后循环很多次其实就是相当于是:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220119144743308.png" alt="image-20220119144743308"></p>
<blockquote>
<p>因为 var 没有块级作用域，所以这么做其实也就是让全局的 i 变了 (window.i), 最后循环结束，window.i 也变成最后的值</p>
<p>所以之后要是触发事件开启异步任务再按照作用域去找 i 这个变量就会找到这个全局变量 i 一看就是最后的值</p>
</blockquote>
</li>
<li>
<p>正确实例：将以上代码中的  <code>var</code>  改为  <code>let</code> 。<mark>不用像 ES5 那样使用闭包等等方式也能解决</mark></p>
</li>
</ul>
<blockquote>
<p>在全局作用域中的 for 循环里 let 声明 i, 然后循环很多次其实就是相当于是:</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220119145207859.png" alt="image-20220119145207859"></p>
<blockquote>
<p>因为 let 有块级作用域，他们之间是互不影响到，自己在当前的 iteration 里面使用，跟其他 iteration 的 i 不相关</p>
<p>因为他们是有块级作用域，所以并不会成为全局 (window) 的属性 (这样就不是 window.i 了)</p>
</blockquote>
<p><strong>案例 2</strong>：1s 后循环输出所有数字</p>
<ul>
<li>错误示例：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
输出：6 6 6 6 6
循环从1-5的时间很短暂，远不及 1s。
此时五个异步事件瞬间加入到异步事件队列中，等待 1s后依次执行。
而此时i为6，故瞬间输出 5 个 6。
异步事件队头
(1) console.log(i);
(2) console.log(i);
(3) console.log(i);
(4) console.log(i);
(5) console.log(i);
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>正确示例：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 输出：1 2 3 4 5</span>
<span class="token comment">// let 有块级作用域，每个 j 都会形成一个自己的块级作用域，与相应的异步事件共享：</span>
<span class="token comment">// &#123;j = 1;&#125; &#123;j = 2;&#125; &#123;j = 3;&#125; &#123;j = 4;&#125; &#123;j = 5;&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>解决方法 2：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 给每一个 i 设置一个立即执行函数，会形成自己的块级作用域，不影响外部变量。</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>这里的 let 跟 java 里的变量感觉很像</p>
</blockquote>
<hr>
<h2 id="2-const-关键字"><a class="markdownIt-Anchor" href="#2-const-关键字">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_2-const-%E5%85%B3%E9%94%AE%E5%AD%97">2. const 关键字</a></h2>
<p><code>const</code>  关键字用来声明常量， <code>const</code>  声明有以下特点：</p>
<ul>
<li>声明必须赋初始值</li>
<li>标识符一般为大写</li>
<li>不允许重复声明</li>
<li><strong>值不允许修改 (java 里的 static final? 像是)</strong></li>
<li><strong>块级作用域</strong></li>
</ul>
<p>注意：对象属性修改和数组元素变化不会出发  <code>const</code>  错误</p>
<blockquote>
<p>这点像是 java 里面用 final 标识一个变量，这个变量如果是基础性就不能变值，如果是 object, 那么这个变量存的这个 object 的地址不能变，但是这个 object 的属性可以随便变</p>
</blockquote>
<h3 id="应用场景声明对象类型使用-const非对象类型声明选择-let"><a class="markdownIt-Anchor" href="#应用场景声明对象类型使用-const非对象类型声明选择-let">#</a> 应用场景：声明对象类型使用 const，非对象类型声明选择 let</h3>
<p>案例：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 不报错</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    uname<span class="token operator">:</span> <span class="token string">'rick'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">&#125;</span>
obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>
<span class="token comment">// 只要不改变地址，就不报错</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="3-变量的解构赋值"><a class="markdownIt-Anchor" href="#3-变量的解构赋值">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_3-%E5%8F%98%E9%87%8F%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC">3. 变量的解构赋值</a></h2>
<p>ES6 允许按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为 <strong>解构赋值</strong>。</p>
<p>数组的解构赋值：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>数组用 []</p>
<p>变量名随便，反正都是按照顺序挨个取出来给你每个变量赋值</p>
</blockquote>
<p>对象的解构赋值：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    uname<span class="token operator">:</span> <span class="token string">'rick'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token function-variable function">sayHi</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">sayBye</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Bye~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> <span class="token punctuation">&#123;</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sayHi<span class="token punctuation">&#125;</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span> <span class="token comment">//这里就是给name,age,sayHi变量从obj里面找对应的键取值赋值</span>
<span class="token keyword">let</span> <span class="token punctuation">&#123;</span>sayBye<span class="token punctuation">&#125;</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span> <span class="token comment">// 本来在对象中是方法的也可以直接赋值然后调用</span>

<span class="token comment">//调用</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 就可以了, 这样不需要obj.sayHi()了</span>
<span class="token function">sayBye</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这个可以这样</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>对象用 {}</p>
<p>跟数组方式不同，注意用的变量名和对象里面想取值对应的属性名 (键名) 必须一样！</p>
</blockquote>
<h3 id="应用场景频繁使用对象方法-数组元素就可以使用解构赋值形式"><a class="markdownIt-Anchor" href="#应用场景频繁使用对象方法-数组元素就可以使用解构赋值形式">#</a> 应用场景：频繁使用对象方法、数组元素，就可以使用解构赋值形式。</h3>
<blockquote>
<p><mark>注意！</mark> <strong>数组是按顺序赋值的，对象是按变量名赋值的</strong></p>
</blockquote>
<hr>
<h2 id="4-模板字符串"><a class="markdownIt-Anchor" href="#4-模板字符串">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_4-%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2">4. 模板字符串</a></h2>
<p>模板字符串（template string）是增强版的字符串，用反引号 ` 标识，特点：</p>
<ul>
<li>字符串中可以出现__换行符__(就是你在 ide 之中直接换行可以的，如果是引号则不行需要用 + 连上)</li>
<li>可以使用  <code>$&#123;xxx&#125;</code>  形式输出变量</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'jack'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用``就可以用$&#123;变量名&#125;来获取变量值,而不是使用加号连接</span>
<span class="token keyword">let</span> ul <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;ul>                 
    &lt;li>apple&lt;/li>
    &lt;li>banana&lt;/li>
    &lt;li>peach&lt;/li>
    &lt;/ul></span><span class="token template-punctuation string">`</span></span>   <span class="token comment">//上方都是直接换行,都可以的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用场景当遇到字符串与变量拼接的情况使用模板字符串"><a class="markdownIt-Anchor" href="#应用场景当遇到字符串与变量拼接的情况使用模板字符串">#</a> 应用场景：当遇到字符串与变量拼接的情况使用模板字符串。</h3>
<hr>
<h2 id="5-简化对象写法"><a class="markdownIt-Anchor" href="#5-简化对象写法">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_5-%E7%AE%80%E5%8C%96%E5%AF%B9%E8%B1%A1%E5%86%99%E6%B3%95">5. 简化对象写法</a></h2>
<p>ES6 允许在大括号里面，直接写入变量和函数，作为对象的属性和方法。这样的书写更加简洁。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> uname <span class="token operator">=</span> <span class="token string">'rick'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 组建对象</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    uname<span class="token punctuation">,</span> <span class="token comment">// 直接放进来就行 (完整的方式是uname:uname)但是后面省略掉了</span>
    age<span class="token punctuation">,</span>
    <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//方法也不用冒号了 (sayHi: function()&#123;...&#125;) 直接这样就行</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用场景对象简写形式简化了代码所以以后用简写就对了"><a class="markdownIt-Anchor" href="#应用场景对象简写形式简化了代码所以以后用简写就对了">#</a> 应用场景：对象简写形式简化了代码，所以以后用简写就对了。</h3>
<hr>
<h2 id="6-箭头函数"><a class="markdownIt-Anchor" href="#6-箭头函数">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_6-%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0">6. 箭头函数</a></h2>
<p>ES6 允许使用「箭头」 <code>=&gt;</code>  定义函数。</p>
<ul>
<li><code>function</code>  写法：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> …<span class="token punctuation">,</span> paramN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
    <span class="token comment">// 函数体</span>
    <span class="token keyword">return</span> expression<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>=&gt;</code>  写法：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span> …<span class="token punctuation">,</span> paramN</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 函数体</span>
    <span class="token keyword">return</span> expression<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>一般都是省略掉参数括号前面的 &quot;function&quot; 然后再参数括号后面加上 =&gt;</p>
</blockquote>
<p>箭头函数的 <strong>注意点</strong>:</p>
<ul>
<li>如果形参只有一个，则小括号可以省略</li>
<li>函数体如果只有一条语句，则花括号可以省略 (此时 return 也必须省略)，函数的返回值为该条语句的执行结果</li>
<li>箭头函数  <code>this</code>  是静态的，始终指向__声明时所在作用域__下  <code>this</code>  的值</li>
</ul>
<blockquote>
<p>所以不论是用 this 改变方式比如说 call,apply,bind 都是不会变的</p>
</blockquote>
<ul>
<li><strong>箭头函数不能作为构造函数实例化</strong></li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//构造函数还是像之前一样的写法</span>
<span class="token keyword">function</span> <span class="token function">Ababa</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//或者是类里面的构造函数</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> uname<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>不能使用  <code>arguments</code></li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 省略小括号</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token parameter">n</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> n <span class="token operator">*</span> n<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 省略花括号</span>
<span class="token keyword">let</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a <span class="token operator">+</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>

<span class="token comment">// 箭头函数 this 始终指向声明时所在作用域下 this 的值</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    a<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token function">getA</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> <span class="token function-variable function">fn3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj &#123;...&#125;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例 1：箭头函数  <code>this</code>  始终指向声明时所在作用域下  <code>this</code>  的值， <code>call</code>  等方法无法改变其指向。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    uname<span class="token operator">:</span> <span class="token string">'rick'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">30</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// call 对箭头函数无效</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// window</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj &#123;...&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例 2：筛选偶数</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=></span> v <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">=</span> <span class="token operator">=</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [2 ,4 10, 12, 20]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例 3：点击 div 两秒后变成粉色</p>
<ul>
<li>方案 1：使用  <code>_this</code>  保存  <code>div</code>  下的  <code>this</code> ，从而设置  <code>div</code>  的  <code>style</code>  属性。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">div<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_this<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;div>...&lt;div></span>
        _this<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'pink'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>方案 2：使用  <code>=&gt;</code>  箭头函数__(重要！！！)__</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">div<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>thid<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;div>...&lt;/div></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'pink'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>注意这里是将里面的 function 替换为箭头函数，这么做可以让里面那个函数在声明的时候就确定当前函数里面的 this 指向的会是什么</p>
</blockquote>
<blockquote>
<p>如果是正常 function 的话，不能用 this 因为 setTimeout 函数里面的回调函数里面的 this 指向的是 window 而不是触发事件的 div</p>
</blockquote>
<blockquote>
<p>箭头函数里面的 this 是静态的，<strong> 箭头函数里面的 this__指向的是__声明那个函数所在的作用域下的 this 值</strong>，而在上面这个例子里，箭头函数是在这个外层的 click 事件触发而调用的回调函数里面所声明的，而这个外面这个回调函数是由 div 来调用的所以里面的 this 指向的是 div.</p>
<p>箭头函数在那个作用域下声明也会让自己的 this 指向 div. 所以就可以使用 this 了，而不是像之前一样把 div 地址存到变量然后通过作用域访或者使用 bind 等等</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220119160231624.png" alt="image-20220119160231624"></p>
<p><strong><mark>总结一句话，箭头函数所在的作用域里面的 this 指向谁那箭头函数里面的 this 就指向谁</mark></strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220119160302477.png" alt="image-20220119160302477"></p>
<ul>
<li>
<p>不适合事件回调函数因为回调函数一般都是由 DOM 元素触发事件调用的，所以一般里面的 this 是我们想要操作的.</p>
<p>但要是我们把回调函数设为箭头函数，那么里面的 this 就会指向那个回调函数声明的作用域之中 (比如说在全局作用域下), 那么里面的 this 就指向的是 window 了，并不是我们想要的</p>
</li>
<li>
<p>不适合对象方法也是差不多原因</p>
</li>
</ul>
<hr>
<h2 id="7-函数参数默认值设定"><a class="markdownIt-Anchor" href="#7-函数参数默认值设定">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_7-%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E9%BB%98%E8%AE%A4%E5%80%BC%E8%AE%BE%E5%AE%9A">7. 函数参数默认值设定</a></h2>
<p>ES6 允许给函数参数设置默认值，当调用函数时不给实参，则使用参数默认值。</p>
<p>具有默认值的形参，一般要靠后。</p>
<blockquote>
<p>如果那个参数在调用函数没有给它传参</p>
<p>要是你没给默认值就会是 undefined</p>
<p>要是给了默认值就会用那个默认值</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token operator">=</span><span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>可与解构赋值结合：</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> host <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> uesername<span class="token punctuation">,</span> password<span class="token punctuation">,</span> port <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 127.0.0.1</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uesername<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// host: 'docs.mphy.top',</span>
    uesername<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">3306</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p 对象里属性1的键名,对象里属性2的键名,对象里属性3的键名="">可以不是参数，可以直接</p>
<p>来代表传进来的对象，然后就可以直接用那个 键名 来代表他存的值而不是 对象。键名 (之前的方式)</p>
<p>当然是可以给摸个属性传默认值这样就算你传的对象里没有 host 属性也会取默认的</p>
<p>(注意！这跟上面传好几个参数不一样，那种方式是按熟顺序的)</p>
<p>对象则是按照键名匹配</p>
</blockquote>
<hr>
<h2 id="8-rest-参数"><a class="markdownIt-Anchor" href="#8-rest-参数">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_8-rest-%E5%8F%82%E6%95%B0">8. rest 参数</a></h2>
<p>ES6 引入 rest 参数，用于获取函数的实参，用来代替  <code>arguments</code> ，作用与  <code>arguments</code>  类似。将接收的参数序列转换为一个数组对象。</p>
<p>用在函数形参中，语法格式： <code>fn(a, b, ...args)</code> ，<strong>写在参数列表最后面。</strong></p>
<blockquote>
<p>函数参数声明必须是有 <code>...args</code>  来代表所有其他的 (所以当然可以跟其他参数一起用)</p>
<p>然后如果 <code>fn(a, b, ...args)</code>  传进来了五个参数，那么前面两个分别给了 <code>a</code>  和 <code>b</code> , 然后 <code>args</code>  则会代表剩下那三个，</p>
<p><strong>并且会把那三个存到一个数组里面，所以可以使用数组的各种方法</strong></p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
1
2
[3, 4, 5]
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例 1：求不定个数数字的和</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> sum <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=></span> pre <span class="token operator">+</span> cur<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 15</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="应用场景rest-参数非常适合不定个数参数函数的场景"><a class="markdownIt-Anchor" href="#应用场景rest-参数非常适合不定个数参数函数的场景">#</a> 应用场景：rest 参数非常适合不定个数参数函数的场景</h3>
<hr>
<h2 id="9-spread-扩展运算符"><a class="markdownIt-Anchor" href="#9-spread-扩展运算符">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_9-spread-%E6%89%A9%E5%B1%95%E8%BF%90%E7%AE%97%E7%AC%A6">9. spread 扩展运算符</a></h2>
<p>扩展运算符（ <code>spread</code> ）也是三个点（ <code>...</code> ）。它好比 rest 参数的__逆__运算，<strong>将一个数组转为用逗号分隔的参数序列</strong>，对数组进行解包。<strong><mark>可用在调用函数时，传递的实参，将一个数组转换为参数序列。(主要用法)</mark></strong></p>
<blockquote>
<p>跟 rest 反着来</p>
<ul>
<li>rest 放函数形参</li>
<li>… 放调用函数传参一个数组 (或对象) 的前面</li>
</ul>
</blockquote>
<p><strong>扩展运算符也可以将对象解包。</strong></p>
<p>展开数组：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span>
<span class="token comment">// [Arguments] &#123; '0': 'red', '1': 'green', '2': 'blue' &#125;</span>
<span class="token comment">// redgreenblue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>案例 1：数组合并</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">B</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">C</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token constant">B</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3, 4, 5, 6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>直接这样可合并 <code>let C = [...A, ...B];</code></p>
</blockquote>
<p>案例 2：数组克隆<br>
<strong><mark>这种数组克隆属于浅拷贝。</mark></strong></p>
<blockquote>
<p>浅拷贝只是拷贝对象__第一层__的普通数据类型，<mark> 不是直接拷贝那个对象的地址！</mark></p>
<p>浅拷贝被拷贝对象要是也有属性时复杂数据类型拷贝过去的就是地址了，而不是真正拷贝了一个一样的对象</p>
<p>所以浅拷贝真正只是创建了一个新对象然后拷贝了被拷贝对象的第一层属性为普通数据类型的值以及第一层属性为复杂数据类型的地址，所以这些被存地址的对象里面的普通数据类型和复杂数据类型属性都没被拷贝过去</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arr1<span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['a', 'b', 'c']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例 3：将伪数组转换为真实数组</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> divs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这里其实获得的是一个对象(节点对象)存着所有div,每个div都是属性的值(可以说是伪数组,不能用数组的方法),(其实对象里面的键就是0,1,2,3,...(看你有几个对象)),而那些div对象其实是值,这样就很伪数组因为都是0,1,2,..像是数组的下标</span>
<span class="token keyword">let</span> divArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>divs<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//这样就让每一个div对象存到一个数组里面,现在就可以用数组方法了</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divArr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>案例 4：对象合并</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 合并对象</span>
<span class="token keyword">let</span> obj1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    a<span class="token operator">:</span> <span class="token number">123</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    b<span class="token operator">:</span> <span class="token number">456</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    c<span class="token operator">:</span> <span class="token number">789</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>obj1<span class="token punctuation">,</span> <span class="token operator">...</span>obj2<span class="token punctuation">,</span> <span class="token operator">...</span>obj3 <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &#123; a: 123, b: 456, c: 789 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>可以将 ES5 中的 arguments 给转成数组，但是现在 ES6 有了 rest 就没有必要</p>
</blockquote>
<hr>
<h2 id="10-symbol"><a class="markdownIt-Anchor" href="#10-symbol">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_10-symbol">10. Symbol</a></h2>
<h3 id="101-symbol-基本介绍与使用"><a class="markdownIt-Anchor" href="#101-symbol-基本介绍与使用">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_101-symbol-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8">10.1 Symbol 基本介绍与使用</a></h3>
<p>ES6 引入了一种新的原始数据类型  <code>Symbol</code> ，表示独一无二的值。它是 JavaScript 语言的第七种数据类型，是一种类似于字符串的数据类型。</p>
<p>JavaScript 的七种基本数据类型：</p>
<ul>
<li>值类型（基本类型）：string、number、boolean、undefined、null、symbol</li>
<li>引用数据类型：object（包括了 array、function）</li>
</ul>
<p>Symbol 的特点：</p>
<ul>
<li>Symbol 的值是唯一的，用来解决命名冲突的问题</li>
<li>Symbol 值不能与其他数据进行运算 (比如说 ±*/, 比较&gt;&lt;, 等等等都不可以)</li>
<li>Symbol 定义的对象属性不能使用  <code>for...in</code>  循环遍历，但是可以使用  <code>Reflect.ownKeys</code>  来获取对象的所有键名</li>
</ul>
<p>Symbol 的创建：</p>
<ul>
<li>创建一个 <code>Symbol</code> ：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token keyword">typeof</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Symbol() symbol</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>
<p>添加具有标识的 <code>Symbol</code> ：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> s2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s2_1 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2 <span class="token operator">=</span> <span class="token operator">=</span> <span class="token operator">=</span> s2_1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// false</span>
<span class="token comment">// Symbol 都是独一无二的, 那个传的String类型参数只是用来形容给这个Symbol的,给我们看的,没有其他的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>上面代码中， <code>s1</code>  和 <code>s2</code>  是两个 Symbol 值。如果不加参数，它们在控制台的输出都是 <code>Symbol()</code> ，不利于区分。有了参数以后，就等于为它们加上了描述，输出的时候就能够分清，到底是哪一个值。</p>
</blockquote>
<blockquote>
<p>如果 Symbol 的参数是一个对象，就会调用该对象的 <code>toString</code>  方法，将其转为字符串，然后才生成一个 Symbol 值。</p>
</blockquote>
</li>
<li>
<p><strong>使用 <code>Symbol.for()</code>  方法创建，名字相同的 <code>Symbol</code>  具有相同的实体。</strong></p>
</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> s3 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> s3_1 <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s3 <span class="token operator">===</span> s3_1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>输出 <code>Symbol</code>  变量的描述，使用 <code>description</code>  属性</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> s4 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s4<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 测试</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="102-对象添加-symbol-类型的属性"><a class="markdownIt-Anchor" href="#102-对象添加-symbol-类型的属性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_102-%E5%AF%B9%E8%B1%A1%E6%B7%BB%E5%8A%A0-symbol-%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7">10.2 对象添加 Symbol 类型的属性</a></h3>
<p>案例：安全的向对象中添加属性和方法。<br>
分析：如果直接向对象中添加属性或方法，则原来对象中可能已经存在了同名属性或方法，会覆盖掉原来的。所以使用  <code>Symbol</code>  生成唯一的属性或方法名，可以更加安全的添加。</p>
<p>代码实现：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 这是一个 game 对象，假设我们不知道里面有什么属性和方法</span>
<span class="token keyword">const</span> game <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    uname<span class="token operator">:</span> <span class="token string">'俄罗斯方块'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">up</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">down</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 通过 Symbol 生成唯一的属性名，然后给 game 添加方法</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>up<span class="token punctuation">,</span> down<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'up'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'down'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
game<span class="token punctuation">[</span>up<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'up'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
game<span class="token punctuation">[</span>down<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'down'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 调用刚刚创建的方法</span>
game<span class="token punctuation">[</span>up<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//而不是用game里面的up方法(which is called by game.up())</span>
game<span class="token punctuation">[</span>down<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220119181159904.png" alt="image-20220119181159904"></p>
<blockquote>
<p>可以把 Symbol 理解成一个唯一的字符串，显示的是 Symbol ()，但实际上是一个字符串，添加到 game 方法，理论上不会和现有的属性名冲突，所以可以很安全的添加方法，调用使用 game [methods.up]()</p>
</blockquote>
<blockquote>
<p>总结：为了防止你创建和方法和对象本身的方法冲突，选择在另一个对象中用 symbol 创建独一无二的方法，用 [] 调用，不会污染本身对象中的方法</p>
</blockquote>
<h3 id="103-symbol-内置值"><a class="markdownIt-Anchor" href="#103-symbol-内置值">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_103-symbol-%E5%86%85%E7%BD%AE%E5%80%BC">10.3 Symbol 内置值</a></h3>
<p>除了定义自己使用的 Symbol 值以外，ES6 还提供了 11 个内置的 Symbol 值，指向语言内部使用的方法。可以称这些方法为魔术方法，因为它们会在特定的场景下自动执行。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Symbol.hasInstance</code></td>
<td>当其他对象使用  <code>instanceof</code>  运算符，判断是否为该对象的实例时，会调用这个方法</td>
</tr>
<tr>
<td><code>Symbol.isConcatSpreadable </code></td>
<td>对象的  <code>Symbol.isConcatSpreadable</code>  属性等于的是一个布尔值，表示该对象用于 <code>Array.prototype.concat()</code>  时，是否可以展开</td>
</tr>
<tr>
<td><code>Symbol.species</code></td>
<td>创建衍生对象时，会使用该属性</td>
</tr>
<tr>
<td><code>Symbol.match</code></td>
<td>当执行  <code>str.match(myObject)</code>  时，如果该属性存在，会调用它，返回该方法的返回值。</td>
</tr>
<tr>
<td><code>Symbol.replace </code></td>
<td>当该对象被  <code>str.replace(myObject)</code>  方法调用时，会返回该方法的返回值。</td>
</tr>
<tr>
<td><code>Symbol.search </code></td>
<td>当该对象被  <code>str.search(myObject)</code>  方法调用时，会返回该方法的返回值。</td>
</tr>
<tr>
<td><code>Symbol.split </code></td>
<td>当该对象被  <code>str.split(myObject)</code>  方法调用时，会返回该方法的返回值。</td>
</tr>
<tr>
<td><code>Symbol.iterator </code></td>
<td>对象进行 <code> for...of</code>  循环时，会调用  <code>Symbol.iterator</code>  方法，返回该对象的默认遍历器</td>
</tr>
<tr>
<td><code>Symbol.toPrimitive </code></td>
<td>该对象被转为原始类型的值时，会调用这个方法，返回该对象对应的原始类型值。</td>
</tr>
<tr>
<td><code>Symbol. toStringTag </code></td>
<td>在该对象上面调用  <code>toString()</code>  方法时，返回该方法的返回值</td>
</tr>
<tr>
<td><code>Symbol. unscopables </code></td>
<td>该对象指定了使用  <code>with</code>  关键字时，哪些属性会被  <code>with</code>  环境排除。</td>
</tr>
</tbody>
</table>
<blockquote>
<p>上面的都是 Symbol 对象的属性，而我们可以用这些 Symbol 的属性又被我们当做对我们一些对象的属性来改变我们对象在特定场景下的表现，<strong> 说白了就是扩展对象功能</strong></p>
</blockquote>
<p>案例 1： <code>Symbol.hasInstance</code>  方法判断是否属于这个对象时被调用。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'判断是否属于这个对象时被调用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">A</span>
<span class="token comment">// 判断是否属于这个对象时被调用</span>
<span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例 2：数组使用  <code>concat</code>  方法时，是否可以展开。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr2<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ 1, 2, 3, [ 4, 5, 6, [Symbol(Symbol.isConcatSpreadable)]: false ] ]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [ 1, 2, 3, 4, 5, 6 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="11-迭代器"><a class="markdownIt-Anchor" href="#11-迭代器">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_11-%E8%BF%AD%E4%BB%A3%E5%99%A8">11. 迭代器</a></h2>
<h3 id="111-定义"><a class="markdownIt-Anchor" href="#111-定义">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_111-%E5%AE%9A%E4%B9%89">11.1 定义</a></h3>
<p>遍历器（ <code>Iterator</code> ）就是一种机制。它是一种接口，为各种不同的数据结构提 供统一的访问机制。任何数据结构只要部署  <code>Iterator</code>  接口，就可以完成遍历操作。</p>
<ul>
<li>ES6 创造了一种新的遍历命令  <code>for...of</code>  循环， <code>Iterator</code>  接口主要供  <code>for...of</code>  消费。</li>
<li>原生具备 <code>iterator</code>  接口的数据 (可用 for of 遍历)
<ul>
<li><code>Array</code></li>
<li><code>Arguments</code></li>
<li><code>Set</code></li>
<li><code>Map</code></li>
<li><code>String</code></li>
<li><code>TypedArray</code></li>
<li><code>NodeList</code></li>
</ul>
</li>
</ul>
<blockquote>
<p>在 js 里面，接口可以看成是我们对象的一个属性 (属性名为 Symbol.iterator)</p>
</blockquote>
<p>案例：使用  <code>next()</code>  方法遍历原生自带  <code>iterator</code>  接口的数据：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 遍历 Map</span>
<span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iter1 <span class="token operator">=</span> mp<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// next() 方法每执行一次，指针自增</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: [ 'a', 1 ], done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: [ 'b', 2 ], done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: [ 'c', 3 ], done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter1<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: undefined, done: true &#125;</span>
<span class="token comment">// 遍历数组</span>
<span class="token keyword">let</span> xiyou <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'唐僧'</span><span class="token punctuation">,</span><span class="token string">'孙悟空'</span><span class="token punctuation">,</span><span class="token string">'猪八戒'</span><span class="token punctuation">,</span><span class="token string">'沙僧'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> iter2 <span class="token operator">=</span> xiyou<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: '唐僧', done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: '孙悟空', done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: '猪八戒', done: false &#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; value: '沙僧', done: false &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的案例只是为了证明他们自带  <code>iterator</code>  接口，实际上直接使用  <code>for...of</code>  方法遍历即可（ <code>iterator</code>  接口为  <code>for...of</code> ）服务。例如，可以使用  <code>for [k, v] of map</code>  来遍历 Map 数据结构中的键和值。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> mp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/*
a 1
b 2
c 3
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>for( let k in ...)</code>  ,k 保存的是键名</p>
<p><code>for( let v of ...)</code>  ,v 保存的是值</p>
</blockquote>
<h3 id="112-工作原理"><a class="markdownIt-Anchor" href="#112-工作原理">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_112-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">11.2 工作原理</a></h3>
<ul>
<li>这个你创建的对象的__proto__属性存的对应的原型对象里有 Symbol.iterator 属性，这个属性里面存了函数</li>
<li>这个函数里面，显示创建一个指针对象，指向当前数据结构 (就是那些原生具备 <code>iterator</code>  接口的数据结构) 的起始位置</li>
<li>第一次调用对象的  <code>next</code>  方法，指针自动指向数据结构的第一个成员</li>
<li>接下来不断调用  <code>next</code>  方法，指针一直往后移动，直到指向最后一个成员</li>
<li>每调用  <code>next</code>  方法返回一个包含  <code>value</code>  和  <code>done</code>  属性 (done 属性主要是看有没有完成遍历当前对象) 的对象</li>
</ul>
<h3 id="应用场景需要自定义遍历数据的时候要想到迭代器"><a class="markdownIt-Anchor" href="#应用场景需要自定义遍历数据的时候要想到迭代器">#</a> 应用场景：需要自定义遍历数据的时候，要想到迭代器。</h3>
<h3 id="113-自定义遍历数据给自己建的对象添加iterator接口属性"><a class="markdownIt-Anchor" href="#113-自定义遍历数据给自己建的对象添加iterator接口属性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_113-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%81%8D%E5%8E%86%E6%95%B0%E6%8D%AE">11.3 自定义遍历数据 (给自己建的对象添加 Iterator 接口 (属性))</a></h3>
<p>我们可以通过给数据结构添加自定义  <code>[Symbol.iterator]()</code>  方法来使该数据结构能够直接被遍历，从而使  <code>for...of</code>  能够直接遍历指定数据，达到为  <code>for...of</code>  服务的功能。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 需求：遍历对象中的数组</span>
<span class="token keyword">const</span> xiaomi <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    uname<span class="token operator">:</span> <span class="token string">'小明'</span><span class="token punctuation">,</span>
    course<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'高数'</span><span class="token punctuation">,</span> <span class="token string">'大物'</span><span class="token punctuation">,</span> <span class="token string">'英语'</span><span class="token punctuation">,</span> <span class="token string">'数据库'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 通过自定义 [Symbol.iterator]() 方法 , 记得外面这个[]括号</span>
    <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 初始指针对象指向数组第一个</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// 保存 xiaomi 的 this 值, 可以用这种方式或者箭头函数也可以</span>
        <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 不断调用 next 方法，直到指向最后一个成员</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> _this<span class="token punctuation">.</span>course<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> value<span class="token operator">:</span> _this<span class="token punctuation">.</span>course<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 每调用next 方法返回一个包含value 和done 属性的对象</span>
                    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> value<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> done<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// for...of直接遍历达到目的</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> xiaomi<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>上面这种方式可以按照我们想要遍历的数据而进行操作，而不是遍历所有的数据</p>
</blockquote>
<blockquote>
<p>这个 [Symbol.iterator] 方法其实就是返回了一个对象，这个对象 (可以看做就是指针) 里面有一个方法叫做 next</p>
<p>这个 next 方法就是遍历我们这个想要进行遍历的对象，这个 next 方法调用之后会按照我们给的条件来决定停不停止遍历</p>
</blockquote>
<blockquote>
<p>然后上面我们定的情况就是如果 <code>index &lt; _this.course.length</code>  也就是说如果 index 这个下标变量小于我们一开始定的想要被遍历的对象的 <code>course</code>  属性 (存的数组) 的长度就会返回一个对象，这个返回的对象有两个属性 (value 和 done), 这两个属性的值交给我们自己决定</p>
<ul>
<li>这个 value 属性就是我们用 <code>for (let v of 我们自己定的,想遍历的对象) </code> 时 v 的值</li>
<li>这个 done 属性就是说有没有遍历完，false 就是没有遍历完，没有遍历完就会默认一直调用 next 方法，直到返回的对象的 done 属性为 true.(这个也是我们按照外面 if statement 的 condition 来决定什么情况下才可以终止 next (返回对象的 done 属性为 true))</li>
</ul>
</blockquote>
<blockquote>
<p>在这里我们就可以看到我们可以决定到底遍历我们那个对象的哪些内容，是对象所有的属性？还是对象的某个数组 / 对象属性？</p>
<p>我们自己写这个遍历器属性可以按照自己需求来决定遍历什么，遍历多少，等等等 (通过改比如说什么条件结束遍历，返回的对象的 value 值到底是返回的是什么等)</p>
</blockquote>
<hr>
<h2 id="12-generator-生成器函数"><a class="markdownIt-Anchor" href="#12-generator-生成器函数">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_12-generator-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0">12. Generator 生成器函数</a></h2>
<h3 id="121-生成器函数的声明和调用"><a class="markdownIt-Anchor" href="#121-生成器函数的声明和调用">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_121-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E7%9A%84%E5%A3%B0%E6%98%8E%E5%92%8C%E8%B0%83%E7%94%A8">12.1 生成器函数的声明和调用</a></h3>
<p>生成器函数是 ES6 提供的一种 <strong><mark>异步编程解决方案</mark></strong>，语法行为与传统函数完全不同。</p>
<ul>
<li><code>*</code>  的位置没有限制 (放到 <code>function</code>  和函数名之间就行)</li>
<li>使用  <code>function * gen()</code>  和  <code>yield</code>  可以声明一个生成器函数。生成器函数返回的结果是迭代器对象，调用迭代器对象的  <code>next</code>  方法可以得到  <code>yield</code>  语句后的值。</li>
<li>每一个  <code>yield</code>  相当于函数的暂停标记，也可以认为是一个__分隔符__，每调用一次  <code>next()</code> ，生成器函数就往下执行一段。</li>
<li><code>next</code>  方法可以传递实参，作为  <code>yield</code>  语句的返回值</li>
</ul>
<p>例如以下生成器函数中，3 个  <code>yield</code>  语句将函数内部分成了 4 段。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before 111'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下面yield分割了,这一块是生成器第 1 段</span>
    <span class="token keyword">yield</span> <span class="token number">111</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before 222'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下面yield分割了,这一块是生成器第 2 段</span>
    <span class="token keyword">yield</span> <span class="token number">222</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'before 333'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 下面yield分割了,这一块是生成器第 3 段</span>
    <span class="token keyword">yield</span> <span class="token number">333</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'after 333'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这一块是生成器第 4 段</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> iter <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行函数返回一个迭代器对象</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//使用和这个迭代器对象的next方法就可以执行第一段(开始到遇到yield)代码并且返回一个对象,这个对象具有value和done属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//从第一个yield之后到第二个yield之间的,并且返回一个对象,这个对象具有value和done属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//so on...</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//最后一个yield到结束之间的最后的代码,并且返回一个对象,这个对象具有value和done属性</span>
<span class="token comment">/*
before 111
&#123; value: 111, done: false &#125;
before 222
&#123; value: 222, done: false &#125;
before 333
&#123; value: 333, done: false &#125;
after 333
&#123; value: undefined, done: true &#125;
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>以上每次 next 方法执行返回的结果都是一个对象由 value 和 done 属性，value 存的就是对应的每一段 <code>yield</code>  语句之后的值</p>
</blockquote>
<blockquote>
<p>遇到 yield 语句，就暂停执行后面的操作，并将紧跟在 yield 后面的那个表达式的值，作为返回的对象的 value 属性的值。</p>
<p>再次调用 next 方法时，再继续往下执行，直到遇到下一个 yield 语句。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220120140641962.png" alt="image-20220120140641962"></p>
<p>同样道理像我们这以前说的 for…of 那样，其实就是靠迭代器实现的，所以要是用 for…of</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220120140823735.png" alt="image-20220120140823735"></p>
<p>结果:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220120140838264.png" alt="image-20220120140838264"></p>
<p>也就是每个 next 方法返回的对象的 value (之前说过) 属性.</p>
<h3 id="122-生成器函数的参数传递"><a class="markdownIt-Anchor" href="#122-生成器函数的参数传递">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_122-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92">12.2 生成器函数的参数传递</a></h3>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成器第 1 段</span>
    <span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">111</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成器第 2 段</span>
    <span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">222</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成器第 3 段</span>
    <span class="token keyword">let</span> three <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">333</span><span class="token punctuation">;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>three<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 生成器第 4 段</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> iter <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传给生成器第 1 段</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传给生成器第 2 段，作为这一段开始的 yield 语句返回值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'ccc'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传给生成器第 3 段，作为这一段开始的 yield 语句返回值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">'ddd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传给生成器第 4 段，作为这一段开始的 yield 语句返回值</span>
<span class="token comment">/*
aaa
&#123; value: 111, done: false &#125;
bbb
&#123; value: 222, done: false &#125;
ccc
&#123; value: 333, done: false &#125;
ddd
&#123; value: undefined, done: true &#125;
*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>每次给 next 方法传参给的就是给上一个结尾的 yield 语句当做返回值的，而不是当前的.</p>
<p>所以要传要从第二个开始传 (第一个也没法传，(他之前也没 yield))</p>
</blockquote>
<h3 id="123-生成器函数案例"><a class="markdownIt-Anchor" href="#123-生成器函数案例">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_123-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E6%A1%88%E4%BE%8B">12.3 生成器函数案例</a></h3>
<p><strong>案例 1：1s 后输出 111，然后 2s 后输出 222，然后 3s 后输出 333</strong></p>
<ul>
<li>传统方式：嵌套太多，代码复杂，产生 <strong>回调地狱</strong>。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>生成器实现：结构简洁明了</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 第一个函数用作做第一个异步任务的</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 第二个函数用作做第二个异步任务的</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 第三个函数用作做第三个异步任务的</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">yield</span> <span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">two</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">three</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> iter <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>以上代码太妙了！！！</p>
<p>首先三个函数分别代表三个计时器每个即使器都有要执行的异步任务 (也就是先不执行，只有需要执行的时候才会去安排排队然后等主线程执行栈执行).</p>
<p>然后创建了一个生成器函数，有三个 yield 每个 yield 后面都对应一个异步任务 (计时器，不过计时器里设的异步任务), 然后调用了 next 方法会执行生成器第一段也就是开始到第一个 yield, 也会执行 (因为是加了括号，代表调用函数，函数的返回值作为 next 方法的返回对象的 value 值) yield 后面的那个 one 函数，然后执行 one 给加上了定时器，然后过了 1 秒 (roughly,more depend on how much tasks the js main thread has to do), 执行回调函数，这个执行函数里面有 <code>iter.next();</code>  所以就是让生成器执行现在开始 (也就是第一个 yield 之后) 一直到下一个 yield 然后因为那个 yield 后面也是个函数就执行了 (需要的是一个表达式作为 next 方法的返回对象的 value 值，而且这个后面跟的是一个调用而不是函数名，所以就会执行), 这个执行的函数是 two 函数，然后 so on… 就可以不用像之前一样嵌套这些定时器 (以及计时器里面的挨个的异步任务) 产生回调地狱.</p>
<p>这么做也可以而且很整洁</p>
</blockquote>
<p>案例 2：生成器函数模拟每隔 1s 获取商品数据</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">'用户数据'</span><span class="token punctuation">;</span>
        iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传参给生成器函数的第 2 段，后面类似</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">getOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">'订单数据'</span><span class="token punctuation">;</span>
        iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">getGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">'商品数据'</span><span class="token punctuation">;</span>
        iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> users <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> orders <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> goods <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>goods<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> iter <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>这里跟上面很像，只不过在执行 <code>getUsers()</code>  函数的时候，这个函数里面有 <code>iter.next(data);</code>  把自己的 data 作为参数传给 next 方法，这个是运行第二次执行 next 方法 (第一次就是在外面没有参数的，只是启动然后可以调用到第一个 yield 后面的 <code>getUsers()</code>  函数), 所以这个第二次执行 next 方法传进的参数会成为第一个 yield (也就是上一次 next (也就是最一开始那个 next) 结尾到达的 yield) 语句的返回值的 (注意不是 next 函数执行完返回的那个对象！那个对象的 value 属性就是 yield 后面跟着的东西 (因为这里是函数所以会先调用取到这个函数的返回值 (这里是 undefined, 因为这三个函数都没有返回什么)), 而 done 值就是看有没有结束当前的生成器的所有部分 (三个 yield 给生成器分为了四段，所以除了一开始的 next 还需要执行三次 next)).</p>
<p>所以给 next 方法传参数是给 yield 语句传返回值的，所以上面用了 <code>iter.next(data);</code>  把自己的 data 传进了第一个 yield 语句的返回值，所以第一个 yield 语句 -&gt; <code>yield getUsers();</code>  不管 yield 后面是什么返回值就是那个 data, 然后我们用 <code>users</code>  变量接收了一下，然后就是老样子执行下一个，下一个照样传，so on…</p>
<p>这样就可以获取到每个异步任务执行完毕所获得的值等.</p>
</blockquote>
<hr>
<h2 id="13-promise"><a class="markdownIt-Anchor" href="#13-promise">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_13-promise">13. Promise</a></h2>
<h3 id="131-promise-的定义和使用"><a class="markdownIt-Anchor" href="#131-promise-的定义和使用">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_131-promise-%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8">13.1 Promise 的定义和使用</a></h3>
<p><code>Promise</code>  是 ES6 引入的__异步编程的新解决方案__。<mark>语法上 <strong>Promise 是一个构造函数</strong>，用来封装异步操作并可以获取其成功或失败的结果。</mark></p>
<p>一个  <code>Promise</code>  必然处于以下几种状态之一：</p>
<ul>
<li>待定（ <code>pending</code> ）：初始状态，既没有被兑现，也没有被拒绝。</li>
<li>已兑现（ <code>fulfilled</code> ）：意味着操作成功完成。</li>
<li>已拒绝（ <code>rejected</code> ）：意味着操作失败。</li>
</ul>
<p><code>Promise</code>  的使用：</p>
<ul>
<li>Promise 构造函数： <code>new Promise((resolve, reject)=&gt;&#123;&#125;)</code></li>
<li><code>Promise.prototype.then</code>  方法</li>
<li><code>Promise.prototype.catch</code>  方法</li>
</ul>
<p>一个简单案例：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//实例化Promise对象</span>
    <span class="token comment">// 使用 setTimeout 模拟请求数据库数据操作</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 这个异步请求数据库数据操作是否正确返回数据</span>
        <span class="token keyword">let</span> isRight <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRight<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">'数据库中的数据'</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置 Promise 对象的状态为操作成功</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> err <span class="token operator">=</span> <span class="token string">'数据读取失败！'</span>
            <span class="token comment">// 设置 Promise 对象的状态为操作失败</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<ul>
<li>实例化 Promise 对象需要传进一个函数，这个函数有两个参数 (就是内部定的，跟之前 foreach 里的 value 和 index 那些很像), 当然这俩参数名随便写，一般我们是 resolve,reject</li>
<li>这两个参数其实是两个函数，由 js 引擎提供不用自己部署</li>
<li>在这个函数里面我们可以写个异步操作 (可以是整个定时器啥的), 反正只要里面会有属于异步任务就都可以放，毕竟这个 Promise 做的就是异步编程解决方案</li>
<li>之后在里面我们就可以调用那两个参数函数来改变我们这个 Promise 对象的状态</li>
<li>如果我们异步任务获取了想要的数据 data, 然后我们用成功 (参数) 函数 <code>resolve(data)</code></li>
<li>我们可以在这个实例化 Promise 对象的外面使用这个实例化对象来调用 <code>then</code>  方法</li>
<li>这个 then 方法需要两个参数，这两个参数也是两个函数，这两个参数函数每一个都有一个参数，一般第一个参数函数里面的参数我们称之为 value, 第二参数函数里面的参数我们称之为 reason</li>
<li>如果是 <code>resolve(data)</code>  那么就会执行 then 方法里面第一个参数 (函数) 里面的代码，其中这个函数的参数 (一般使用 value 来代表), 这个 value 就是这里我们传给 resolve 的那个 data 变量传的值</li>
<li>同理如果是 <code>reject(data2)</code>  就用会调用 then 方法的第二个参数函数，然后这个第二个参数函数里面的函数 (一般使用 reason 来代表), 这个 reason 就是这里我们传给 reject 的那个 data2 变量传的值
<ul>
<li>注意使用了 resolve 或者 reject 都会退出当前函数</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="132-promise-封装读取文件"><a class="markdownIt-Anchor" href="#132-promise-封装读取文件">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_132-promise-%E5%B0%81%E8%A3%85%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">13.2 Promise 封装读取文件</a></h3>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 使用 nodejs 的 fs 读取文件模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resources/为学.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// err 是一个异常对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 转为字符串输出</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取失败!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="133-promise-封装-ajax-请求"><a class="markdownIt-Anchor" href="#133-promise-封装-ajax-请求">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_133-promise-%E5%B0%81%E8%A3%85-ajax-%E8%AF%B7%E6%B1%82">13.3 Promise 封装 Ajax 请求</a></h3>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'https://api.apiopen.top/getJoke'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 成功</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 失败</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 指定回调</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>如果不用 Promise 封装，只是最原始的方法，就是只是放到 onreadystatechange 事件触发的回调函数里面操作得到的数据 / 错误.</p>
<p>而用了 Promise 封装，就是在这个异步任务之后，使用 then 的方法处理返回的数据 / 错误</p>
<p>注意这个<strong> promise</strong>. <strong>then</strong> 中的那些函数<strong>是异步</strong>执行，那些函数就是回调函数，只有在 Promise 对象为 resovled/rejected/… 的时候调用</p>
<p>使用了 Promise 封装，既让整个看起来非常整洁</p>
</blockquote>
<h3 id="134-promiseprototypethen-方法"><a class="markdownIt-Anchor" href="#134-promiseprototypethen-方法">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_134-promiseprototypethen-%E6%96%B9%E6%B3%95">13.4 Promise.prototype.then 方法</a></h3>
<p>先复习一下一个  <code>Promise</code>  的三种状态：</p>
<ul>
<li>待定（ <code>pending</code> ）：初始状态，既没有被兑现，也没有被拒绝。</li>
<li>已兑现（ <code>fulfilled</code> ）：意味着操作成功完成。</li>
<li>已拒绝（ <code>rejected</code> ）：意味着操作失败。</li>
</ul>
<blockquote>
<p><code>Promise.prototype.then</code>  方法返回的结果依然是  <code>Promise</code>  对象 (一个新的实例化的 Promise 对象)，<strong>对象状态由回调函数的执行结果决定</strong>。</p>
</blockquote>
<p>具体情况如下：</p>
<ul>
<li><strong>若 then 方法没有返回值，则 <code>then</code>  方法返回的对象的状态值为成功 <code>fulfilled</code> ，返回结果值为 <code>undefined</code> </strong></li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// resolve('用户数据')</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 未设定返回值</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 打印 then 方法的返回值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>打印的结果：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/es6-3.504usmc4kes0.png" alt="es6-3"></p>
<ul>
<li><strong>如果回调函数中返回的结果是非 <code>Promise</code>  类型的属性，则 then 方法返回的对象，其状态为成功（ <code>fulfilled</code> ），返回结果值取决于 <code>then</code>  方法所执行的是哪个函数（ <code>resolve</code>  或 <code>reject</code> ）。</strong></li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// resolve('用户数据')</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token comment">// 返回的非 Promise 对象</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'成功了！！'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">'出错啦！！'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 打印 then 方法的返回值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>打印结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/es6-4.2xdcb1x8jya0.png" alt="es6-4"></p>
<blockquote>
<p>看调用的哪个回调函数然后那个回调函数 return 后面就是 then 方法返回的 Promise 对象的 PromiseResult 属性的值</p>
</blockquote>
<ul>
<li>如果回调函数中返回的结果是 <code>Promise</code>  类型（ <code>return new Promise()</code> ），则 <code>then</code>  方法返回的 <code>Promise</code>  对象状态与该返回结果的状态相同，返回值也相同。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'用户数据'</span><span class="token punctuation">)</span> 
        <span class="token comment">// reject('出错了');</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回 Promise 对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'（1）成功了！！！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// reject('（1）出错了！！！')</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// resolve('（2）成功了！！！');</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'（2）出错了！！！'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">// 打印 then 方法的返回值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>打印结果：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/es6-5.6z1msm3xzpc0.png" alt="es6-5"></p>
<blockquote>
<p>这里上面先是 resolve 所以 then 会调用第一个参数 (回调函数), 然后在那里面又返回了一个 Promise 对象也是 resolve 然后值为 “（1）成功了！！！” 所以最后 then 方法返回的是这个 Promise 对象，状态为 fulfilled, 值为 “（1）成功了！！！”</p>
<p>如果回调函数里面返回的 Promise 实例化对象里面是失败那当然就是失败状态</p>
</blockquote>
<ul>
<li>如果回调函数中返回的结果是 <code>throw</code>  语句抛出异常 (<strong>不管是不是在返回的新的 Promise 对象里面抛出 (像下面那一样) 还是直接就是抛，都一样</strong>)，则 <code>then</code>  方法返回的实例化 Promise 的对象的状态值为 <code>rejected</code> ，返回结果值为 <code>throw</code>  抛出的字面量或者 <code>Error</code>  对象。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'用户数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'错误了！！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印结果</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>打印结果如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/es6-6.2c3aibc6l05c.png" alt="es6-6"></p>
<blockquote>
<p>如果调用 then 的 Promise 那个实例化对象里面 throw new … 那么也会调用 then 里面的第二个参数 (回调函数), 跟 <code>reject</code>  的一样</p>
</blockquote>
<h3 id="134-链式调用"><a class="markdownIt-Anchor" href="#134-链式调用">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_134-%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8">13.4 链式调用</a></h3>
<p><code>Promise.prototype.then</code>  方法返回的结果还是  <code>Promise</code>  对象，这意味着我们可以继续在该结果上使用  <code>then</code>  方法，也就是链式调用。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">reason</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">reason</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">reason</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>因为 then 方法也是返回的一个 Promise 对象，我们可以继续嵌套放 then 方法对于之前那个 then 方法返回的 promise 对象的状态进行对应的操作.</p>
</blockquote>
<blockquote>
<p>每个 then 方法两个参数 (分别是两个回调函数), 所以都是异步任务.</p>
<p>注意 then 方法可以只放一个参数 (回调函数), 这意味着只有调用当前这个 then 方法的那个 Promise 实例化对象的状态是 fulfilled (还是 resolved 来着) 才会调用这个回调函数 (让这个异步任务去排队等着执行)</p>
</blockquote>
<p><mark><strong>这么做可以解决回调地狱问题</strong></mark></p>
<h3 id="135-链式调用练习-多个文件读取"><a class="markdownIt-Anchor" href="#135-链式调用练习-多个文件读取">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_135-%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E7%BB%83%E4%B9%A0-%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">13.5 链式调用练习 - 多个文件读取</a></h3>
<p>如果是不用 Promise, 回调地狱: (而且可以看到取名也很麻烦，都要不同的变量名，这里 err 不用就懒得改了)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220121150721155.png" alt="image-20220121150721155"></p>
<p>如果使用 Promise:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resources/users.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 传给下一轮文件读取操作</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// value 为第一次读取的文件数据，data 为第二次（当前）读取的数据</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resources/orders.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 将上轮读取结果和本轮合并传到下一轮轮读取操作</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value<span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resources/goods.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// value 为上一轮传递过来的文件数据数组</span>
            value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 传给下一轮操作</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 合并数组元素，输出</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<ul>
<li>
<p>这里就是先建个 Promise 实例化对象，然后读取第一个文件 (读取也有回调函数作为参数，这个回调函数也是异步), 回调函数里面就是 resolve 获得的 data</p>
</li>
<li>
<p>接着就可以对这个 Promise 实例化对象使用 then 方法然后因为这个 Promsie 实例化对象是 resolve 状态我们就在 then 方法第一个参数 (回调函数) 去将这个接收到的数据和要读取的第二个文件放一起，怎么读取第二个文件？</p>
</li>
<li>
<p>跟读取第一个文件一样新建一个 Promise 实例化对象然后 return 作为当前 then 方法的返回值</p>
</li>
<li>
<p>注意这里不能不建新的 Promise 对象然后直接读取文件，因为这样是可以读取到第二个文件，但是获取到的第二个文件中的 data 无法给别人，只是自己有了，所以我们需要这个 Promise 对象包括住读取这个文件，然后再讲读取到的 data 与读取第一个文件中的 data 拼接一下然后 resolve 这个样子我们这个现在当前 then 方法返回的就是这个新建的 Promise 实例化对象然后这个对象的 PromiseResult 属性存的值 (也就是通过这个 Promise 实例对象调用 then 方法中第一个参数 (回调函数) 里面的那个 (系统默认给我们的) 那个参数) 存的就是上面我们传的拼接好的从两个文件读取出来的 data, 我们对这个实例化对象继续调用 then 方法来按照那个对象的状态调用函数然后用调用的函数里面 (系统默认给我们的) 的参数来处理所有接收到的 data.</p>
</li>
</ul>
</blockquote>
<h3 id="136-promiseprototypecatch"><a class="markdownIt-Anchor" href="#136-promiseprototypecatch">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_136-promiseprototypecatch">13.6 Promise.prototype.catch</a></h3>
<p><code>catch()</code>  方法返回一个  <code>Promise</code> ，并且处理拒绝的情况。它的行为与调用  <code>Promise.prototype.then(undefined, onRejected)</code>  相同。</p>
<blockquote>
<p><strong>Internally calls  <code>Promise.prototype.then</code>  on the object upon which is called, passing the parameters  <code>undefined</code>  and the  <code>onRejected</code>  handler received; then returns the value of that call (which is a <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"> <code>Promise</code> </a>).</strong></p>
</blockquote>
<p>即：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">obj<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>等同于：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">obj<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>语法：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">// 拒绝</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>举例：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Success!"</span>
    <span class="token keyword">throw</span> <span class="token string">'oh, no!'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "oh, no!"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有 catch 捕获异常，所以这句输出'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// then的</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有 catch 捕获异常，这句将不会输出'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果：</p>
<pre class="line-numbers language-none"><code class="language-none">Success
oh, no!
有 catch 捕获异常，所以这句输出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>catch</code>  不管被连接到哪里，都能捕获上层__<mark>未捕捉过</mark>__的错误。所以一般是放到最后，前面可能会有多个 then (链式调用)<strong> 且都没第二个回调函数 (要是有了可能就出问题了因为如果前面的 promise 被 reject 了会被这个 then 的第二个参数回调函数捕获然后调用然后返回一个 promise, 这个 promise 可能会是 resolve, 那么之后 catch 就接收不到了)</strong>, 所以会有多个 Promise 对象，然后这些对象任何错误，只要没被以及捕获 (then 的第二函数), 那么最后 catch 都会接收到</p>
</blockquote>
<h3 id="一-reject后的东西一定会进入then中的第二个回调如果then中没有写第二个回调则进入catch"><a class="markdownIt-Anchor" href="#一-reject后的东西一定会进入then中的第二个回调如果then中没有写第二个回调则进入catch">#</a> 一、reject 后的东西，一定会进入 then 中的第二个回调，如果 then 中没有写第二个回调，则进入 catch</h3>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有resolve'</span><span class="token punctuation">)</span>
   <span class="token comment">//throw new Error('手动返回错误')</span>
   <span class="token function">rej</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">)</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span><span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data::'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token parameter">err</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'err::'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>
   <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch data::'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token constant">VM367054</span><span class="token operator">:</span><span class="token number">2</span> 没有resolve
<span class="token constant">VM367054</span><span class="token operator">:</span><span class="token number">11</span> err<span class="token operator">:</span><span class="token operator">:</span> 失败了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>then 中没有第二个回调的情况</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有resolve'</span><span class="token punctuation">)</span>
   <span class="token comment">//throw new Error('手动返回错误')</span>
   <span class="token function">rej</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">)</span>

<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span><span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data::'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>
   <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch data::'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token constant">VM367054</span><span class="token operator">:</span><span class="token number">2</span> 没有resolve
<span class="token constant">VM367054</span><span class="token operator">:</span><span class="token number">11</span> catch data<span class="token operator">:</span><span class="token operator">:</span> 失败了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>如果没有 then， 也可以直接进入 catch</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"> <span class="token keyword">var</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没有 resolve'</span><span class="token punctuation">)</span>
    <span class="token comment">//throw new Error('手动返回错误')</span>
    <span class="token function">rej</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">)</span>

 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

 p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>
    <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch data::'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token constant">VM367087</span><span class="token operator">:</span><span class="token number">2</span> 没有resolve
<span class="token constant">VM367087</span><span class="token operator">:</span><span class="token number">9</span> catch data<span class="token operator">:</span><span class="token operator">:</span> 失败了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="二-resolve的东西一定会进入then的第一个回调肯定不会进入catch"><a class="markdownIt-Anchor" href="#二-resolve的东西一定会进入then的第一个回调肯定不会进入catch">#</a> 二、resolve 的东西，一定会进入 then 的第一个回调，肯定不会进入 catch</h3>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"> <span class="token keyword">var</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">)</span>
    <span class="token comment">//throw new Error('手动返回错误')</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">)</span>

 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

 p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'data::'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>
    <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch data::'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token constant">VM367087</span><span class="token operator">:</span><span class="token number">2</span> resolve
<span class="token constant">VM367087</span><span class="token operator">:</span><span class="token number">9</span> data<span class="token operator">:</span><span class="token operator">:</span> 成功了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>不会进入 catch 的情况</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"> <span class="token keyword">var</span> p1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolve'</span><span class="token punctuation">)</span>
    <span class="token comment">//throw new Error('手动返回错误')</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功了'</span><span class="token punctuation">)</span>

 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

 p1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>
    <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catch data::'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token constant">VM367087</span><span class="token operator">:</span><span class="token number">2</span> resolve<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>throw new Error 的情况和 rej 一样，但是他俩只会有一个发生</strong><br>
<strong>另外，网络异常（比如断网），会直接进入 catch 而不会进入 then 的第二个回调</strong></p>
<hr>
<h2 id="14-set"><a class="markdownIt-Anchor" href="#14-set">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_14-set">14. Set</a></h2>
<h3 id="141-set-的定义和使用"><a class="markdownIt-Anchor" href="#141-set-的定义和使用">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_141-set-%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8">14.1 Set 的定义和使用</a></h3>
<p>ES6 提供了新的数据结构  <code>Set</code> （集合）。它类似于数组，但 <strong>成员的值都是唯一的</strong>，集合实现了  <code>iterator</code>  接口，<strong>所以可以使用『扩展运算符』(也就是 &quot;…&quot;) 和『 <code>for...of</code> 』进行遍历。</strong></p>
<p>定义一个 Set 集合：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> st1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> st2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>可迭代对象<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//传的是数组,然后数组里面存的就是任何,然后我们之后就可以迭代里面的 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>集合（这里假设有一个集合  <code>st</code> ）的属性和方法：</p>
<ul>
<li><code>st.size</code> ：返回集合个数</li>
<li><code>st.add(item)</code> ：往集合中添加一个新元素  <code>item</code> ，返回当前集合</li>
<li><code>st.delete(item)</code> ：删除集合中的元素，返回  <code>boolean</code>  值</li>
<li><code>st.has(item)</code> ：检测集合中是否包含某个元素，返回  <code>boolean</code>  值</li>
<li><code>st.clear()</code> ：清空集合</li>
<li>集合转为数组： <code>[...st]</code></li>
<li>合并两个集合： <code>[...st1, ...st2]</code></li>
</ul>
<h3 id="142-集合案例"><a class="markdownIt-Anchor" href="#142-集合案例">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_142-%E9%9B%86%E5%90%88%E6%A1%88%E4%BE%8B">14.2 集合案例</a></h3>
<p>案例 1： 数组去重</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, 2, 3, 4 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>自动给我们传进去的数组去重</strong></p>
</blockquote>
<p>案例 2：数组求交集</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr2_1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr2_2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> res2 <span class="token operator">=</span> arr2_1<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr2_2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, 3, 4 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例 3：数组求并集</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr3_1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr3_2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> res3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>arr3_1<span class="token punctuation">,</span> <span class="token operator">...</span>arr3_2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, 2, 3, 4, 5, 6, 7 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例 4：数组求差集</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr4_1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> arr4_2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> res4 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr4_1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr4_2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 2, 5 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="15-map"><a class="markdownIt-Anchor" href="#15-map">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_15-map">15. Map</a></h2>
<p>ES6 提供了 Map 数据结构。它类似于对象，也是键值对的集合。<strong>但是 “键” 的范围不限于字符串，各种类型的值（包括对象）都可以当作键</strong>。<strong>Map 也实现了 iterator 接口，所以可以使用『扩展运算符』和『for…of』进行遍历。</strong></p>
<p>定义一个 Map：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> mp1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'bbb'</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mp1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'ccc'</span><span class="token punctuation">,</span> <span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mp2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">,</span> <span class="token number">111</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'bbb'</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'ccc'</span><span class="token punctuation">,</span> <span class="token number">333</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mp1<span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 111</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mp2<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 222</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Map 的属性和方法：（ <code>k</code>  为键， <code>v</code>  为值）</p>
<ul>
<li><code>size</code> ：返回 Map 的元素（键值对）个数</li>
<li><code>set(k, v)</code> ：增加一个键值对，返回当前 Map</li>
<li><code>get(k)</code> ：返回键值对的键值</li>
<li><code>has()</code> ：检测 Map 中是否包含某个元素</li>
<li><code>clear()</code> ：清空集合，返回  <code>undefined</code></li>
</ul>
<blockquote>
<p>使用 for…of 遍历一个 map 会获取到多个数组，第一个数组的第一个元素是这个 map 存的第一个键对象 (或者普通数据类型) 第二元素是这个 map 存的第一个值对象 (或者普通数据类型)</p>
</blockquote>
<hr>
<h2 id="16-class-类"><a class="markdownIt-Anchor" href="#16-class-类">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_16-class-%E7%B1%BB">16. class 类</a></h2>
<p>这部分在 JS 高级也涉及，故可以前往 <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/JS-Advance/ch01">JS 高阶 class</a> 学习。那部分的笔记更加详细，有原理。所以这一节后面部分只给出例子。</p>
<p>ES6 提供了更接近传统语言的写法，引入了 Class（类）这个概念，作为对象的模板。通过 class 关键字，可以定义类。基本上，ES6 的  <code>class</code>  可以看作只是一个语法糖，它的绝大部分功能，ES5 都可以做到，新的  <code>class</code>  写法只是让对象原型的写法更加清晰、更像面向对象编程的语法而已。</p>
<h3 id="161-复习-es5-function-构造函数-的继承"><a class="markdownIt-Anchor" href="#161-复习-es5-function-构造函数-的继承">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_161-%E5%A4%8D%E4%B9%A0-es5-function-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-%E7%9A%84%E7%BB%A7%E6%89%BF">16.1 复习 ES5 function 构造函数 的继承</a></h3>
<blockquote>
<p>具体知识点可以前往：<a target="_blank" rel="noopener" href="https://docs.mphy.top/#/JS-Advance/ch02">JS 高级</a></p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//手机</span>
<span class="token keyword">function</span> <span class="token function">Phone</span><span class="token punctuation">(</span><span class="token parameter">brand<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> brand<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">Phone</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">call</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我可以打电话"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//智能手机</span>
<span class="token keyword">function</span> <span class="token function">SmartPhone</span><span class="token punctuation">(</span><span class="token parameter">brand<span class="token punctuation">,</span> price<span class="token punctuation">,</span> color<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">Phone</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> brand<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//设置子级构造函数的原型</span>
<span class="token class-name">SmartPhone</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">;</span>
<span class="token comment">// 矫正 constructor 指向</span>
<span class="token class-name">SmartPhone</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> SmartPhone<span class="token punctuation">;</span>

<span class="token comment">//声明子类的方法</span>
<span class="token class-name">SmartPhone</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">photo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我可以拍照"</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">SmartPhone</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">playGame</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我可以玩游戏"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> chuizi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmartPhone</span><span class="token punctuation">(</span><span class="token string">'锤子'</span><span class="token punctuation">,</span><span class="token number">2499</span><span class="token punctuation">,</span><span class="token string">'黑色'</span><span class="token punctuation">,</span><span class="token string">'5.5inch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chuizi<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1615-es5和es6静态成员静态方法等"><a class="markdownIt-Anchor" href="#1615-es5和es6静态成员静态方法等">#</a> 16.15 ES5 和 ES6 静态成员，静态方法等</h3>
<h4 id="es5"><a class="markdownIt-Anchor" href="#es5">#</a> ES5</h4>
<blockquote>
<p>记得再这样 ES5 里，构造函数本身也是个对象，所以可以直接给这个对象加属性，但是之后要是创建了这个构造函数的实例化对象，这个实例化对象是无法 access 之前给构造函数对象添加的属性的，这些属性时__静态成员__.</p>
<p>(直接给构造函数对象添加的函数属性也是无法通过构造函数的实例化对象调用的，一般方法是需要放到构造函数对象的原型对象上)</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220121160240692.png" alt="image-20220121160240692"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220121160246306.png" alt="image-20220121160246306"></p>
<blockquote>
<p>同理，给实例化对象加的属性 (属性，方法等) 是无法用原来的构造函数对象获取的，这些是__实例成员.__</p>
</blockquote>
<blockquote>
<p>是无法让构造函数对象和构造函数实例化对象相同的，要想相同就要用构造函数的原型对象 \</p>
</blockquote>
<h4 id="es6"><a class="markdownIt-Anchor" href="#es6">#</a> ES6</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220121160426352.png" alt="image-20220121160426352"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220121160430372.png" alt="image-20220121160430372"></p>
<blockquote>
<p>一样，只要在类里面，在属性或者方法前面加上 <code>static</code> , 这些属于静态成员 / 方法</p>
<p><strong>实例化对象是无法调用或使用的，只能通过这个类的对象本身 (貌似在 ES6 之中，这个类本身也是个对象，跟 ES5 中构造函数本身就是一个对象一样)</strong></p>
<p><mark>这点跟 java 不一样，java 实例化对象还是可以 access 到静态成员 / 方法，这里不允许</mark></p>
</blockquote>
<h3 id="162-extends-类继承和方法的重写"><a class="markdownIt-Anchor" href="#162-extends-类继承和方法的重写">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_162-extends-%E7%B1%BB%E7%BB%A7%E6%89%BF%E5%92%8C%E6%96%B9%E6%B3%95%E7%9A%84%E9%87%8D%E5%86%99">16.2 extends 类继承和方法的重写</a></h3>
<p>ES6 中直接使用  <code>extends</code>  语法糖（更简洁高级的实现方式）来实现继承，同时可以重写父类的方法，直接在子类中重新写一次要重写的方法即可覆盖父类方法。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Phone</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//构造方法</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">brand<span class="token punctuation">,</span> price</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> brand<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">//父类的成员属性</span>
    <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"我可以打电话!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">SmartPhone</span> <span class="token keyword">extends</span> <span class="token class-name">Phone</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//构造方法</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">brand<span class="token punctuation">,</span> price<span class="token punctuation">,</span> color<span class="token punctuation">,</span> size</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>brand<span class="token punctuation">,</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Phone.call(this, brand, price)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>size <span class="token operator">=</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"拍照"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// 方法的重写</span>
    <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我可以进行视频通话'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> xiaomi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmartPhone</span><span class="token punctuation">(</span><span class="token string">'小米'</span><span class="token punctuation">,</span><span class="token number">799</span><span class="token punctuation">,</span><span class="token string">'黑色'</span><span class="token punctuation">,</span><span class="token string">'4.7inch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">xiaomi</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xiaomi<span class="token punctuation">.</span><span class="token function">photo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<ul>
<li>类里面的构造函数必须是 constructor</li>
<li>类里面的方法必须是  <code>方法名(...)&#123;...&#125;</code> , 不可以像我们在之前对象里面的写法 -&gt; <code>方法名:function(...)&#123;...&#125;</code></li>
<li><strong>注意类里面直接写的方法都会<mark>默认</mark>加到该类的 prototype 存的原型属性的身上</strong>，而不是像我们 ES5 那样特意要在外面给那个原型对象加上个属性存我们这个共享的方法</li>
<li>用类实现继承就很简单，很像 java, 不用 es5 那么麻烦</li>
<li>其实底层实现原理应该就是 es5 那么做，都是把子类对象的 prototype 设为 new 出来的父类的实例化对象，只是这样我们不用搞那么麻烦的，直接这样写就很方便</li>
<li><mark>可以不写 constructor, 也是可以的</mark></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>在子类声明跟父类重名的方法就会覆盖，要用父类就是 super. 方法名 ();</li>
</ul>
</blockquote>
<h3 id="163-getter-和-setter"><a class="markdownIt-Anchor" href="#163-getter-和-setter">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_163-getter-%E5%92%8C-setter">16.3 getter 和 setter</a></h3>
<p>实际上， <code>getter</code>  和  <code>setter</code>  是 ES5（ES2009）提出的特性，这里不做详细说明，只是配合  <code>class</code>  使用举个例子。<br>
当属性拥有  <code>get</code> / <code>set</code>  特性时，属性就是访问器属性。代表着在访问属性或者写入属性值时，对返回值做附加的操作。而这个操作就是  <code>getter</code> / <code>setter</code>  函数。</p>
<p>使用场景：  <code>getter</code>  是一种语法，这种  <code>get</code>  将对象属性绑定到 <strong>查询该属性时将被调用的函数</strong>。适用于某个需要动态计算的成员属性值的获取。 <code>setter</code>  则是在修改某一属性时所给出的相关提示。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">log</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>log <span class="token operator">=</span> log<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">get</span> <span class="token function">latest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'latest 被调用了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>log<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">set</span> <span class="token function">latest</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'latest 被修改了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>log<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这里才是真正修改了</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 每次 log 被修改都会给出提示,(并不会真正让test.latest变成'd')</span>
test<span class="token punctuation">.</span>latest <span class="token operator">=</span> <span class="token string">'d'</span><span class="token punctuation">;</span>
<span class="token comment">// 每次获取 log 的最后一个元素 latest，都能得到最新数据。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span>latest<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上输出：</p>
<pre class="line-numbers language-none"><code class="language-none">latest 被修改了
latest 被调用了
[ &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39; ]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><code>get 成员AAA () &#123;...; return 返回的值&#125;</code> , 然后  <code>实例化对象.成员AAA</code>  就是那个返回的值</p>
<ul>
<li>每次调用 <code>成员AAA</code> , 因为有这个 <code>get 成员AAA</code> , 就会运行这个 <code>get 成员AAA</code>  里面的代码</li>
</ul>
<p><code>set 成员AAA (XXX) &#123;...;&#125;</code> , 然后  <code>实例化对象.成员AAA = BBB</code>  就会把这个 BBB 传给那个 XXX 然后执行里面的代码</p>
<ul>
<li>set 必须需要一个参数</li>
<li>每次修改 <code>成员AAA</code>  的值，因为有这个 <code>set 成员AAA</code> , 就会运行这个 <code>set 成员AAA</code>  里面的代码，这里必须需要一个参数，那这个参数就是我们修改 <code>成员AAA</code>  给的新值</li>
<li>一般都是在这里 set 那里面的代码测试修改的新值符不符合我们要求，符合我们就在里面修改那个值，记住我们在外面修改这个值只是尝试并执行 set 里面的代码，真正修改不修改要看我们 set 里面的代码有没有写让他修改</li>
</ul>
</blockquote>
<hr>
<h2 id="17-数值扩展"><a class="markdownIt-Anchor" href="#17-数值扩展">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_17-%E6%95%B0%E5%80%BC%E6%89%A9%E5%B1%95">17. 数值扩展</a></h2>
<ol>
<li><code>Number.EPSILON</code>  是 JavaScript 表示的最小精度，<strong>一般用来处理浮点数运算。例如可以用于两个浮点数的比较。</strong></li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">equal</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=></span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> Number<span class="token punctuation">.</span><span class="token constant">EPSILON</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">===</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>二进制和八进制：二进制以  <code>0b</code>  开头，八进制以  <code>0o</code>  开头。</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0b1010</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token number">0o777</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>
<p><code>Number.isFinite</code>  检测一个数值是否为有限数。</p>
<p>console.log(Number.isFinite(100)); // false<br>
console.log(Number.isFinite(100 / 0)); // true<br>
console.log(Number.isFinite(Infinity)); // false</p>
</li>
<li>
<p>Number.parseInt 和 Number.parseFloat</p>
</li>
</ol>
<p>ES6 给  <code>Number</code>  添加了  <code>parseInt</code>  方法， <code>Number.parseInt</code>  完全等同于  <code>parseInt</code> 。将字符串转为整数，或者进行进制转换。 <code>Number.parseFloat</code>  则等同于  <code>parseFloat()</code></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">Number<span class="token punctuation">.</span>parseInt <span class="token operator">===</span> parseInt<span class="token punctuation">;</span> <span class="token comment">// true</span>
Number<span class="token punctuation">.</span>parseFloat <span class="token operator">===</span> parseFloat<span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> base<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>s</code> ：待转换的字符串</li>
<li><code>base</code> ：进位制的基数</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'5211314love'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5211314</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">'3.1415926神奇'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3.1415926</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="5">
<li><code>Number.isInteger()</code>  判断一个数是否为整数。</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ol start="6">
<li><code>Math.trunc()</code>  将数字的小数部分抹掉。</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">trunc</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="7">
<li><code>Math.sign</code>  判断一个数到底为正数 负数 还是零</li>
</ol>
<blockquote>
<p>上面有些方法本来就有，只不过是全局的函数，现在我们是将他们用 Number 也可以调用，成为 Number 对象的属性.</p>
<p>这么干就可以让别人更好知道在文档里去哪找那个函数</p>
</blockquote>
<hr>
<h2 id="18-对象方法扩展"><a class="markdownIt-Anchor" href="#18-对象方法扩展">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_18-%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95">18. 对象方法扩展</a></h2>
<p>ES6 新增了一些  <code>Object</code>  对象的方法。</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://Object.is">Object.is</a> 比较两个值是否严格相等，与『===』行为 <strong>基本一致</strong></li>
<li><code>Object.assign</code>  对象的合并，将源对象的所有可枚举属性，复制到目标对象</li>
<li><code>__proto__</code> 、 <code>setPrototypeOf</code> 、 <code>setPrototypeOf</code>  可以直接设置对象的原型</li>
</ul>
<h3 id="181-objectis"><a class="markdownIt-Anchor" href="#181-objectis">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_181-objectis">18.1 Object.is()</a></h3>
<p><code>Object.is()</code>  方法判断两个值是否完全相同。 <code>Object.is</code>  比较两个值是否严格相等，与  <code>===</code>  行为 <strong>基本一致</strong>。返回一个  <code>Boolean</code>  类型。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>value1<span class="token punctuation">,</span> value2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><code>Object.is()</code>  方法判断两个值是否为同一个值。如果满足以下条件则两个值相等：</p>
<ul>
<li>都是  <code>undefined</code></li>
<li>都是  <code>null</code></li>
<li>都是  <code>true</code>  或  <code>false</code></li>
<li>都是相同长度的字符串且相同字符按相同顺序排列</li>
<li>都是相同对象（意味着每个对象有同一个引用）</li>
<li>都是数字且
<ul>
<li>都是  <code>+0</code></li>
<li>都是  <code>-0</code></li>
<li>都是  <code>NaN</code></li>
<li>或都是非零而且非  <code>NaN</code>  且为同一个值</li>
</ul>
</li>
</ul>
<p>与  <code>==</code>  运算不同。  <code>==</code>  运算符在判断相等前对两边的变量（如果它们不是同一类型）进行强制转换 (这种行为的结果会将  <code>&quot;&quot; == false</code>  判断为  <code>true</code> )，而  <code>Object.is</code>  不会强制转换两边的值。</p>
<p>与  <code>===</code>  算也不相同。 === 运算符 (也包括  <code>==</code>  运算符) 将数字  <code>-0</code>  和  <code>+0</code>  视为相等，而将  <code>Number.NaN</code>  与  <code>NaN</code>  视为不相等。</p>
<h3 id="182-objectassign"><a class="markdownIt-Anchor" href="#182-objectassign">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_182-objectassign">18.2 Object.assign</a></h3>
<p><code>Object.assign</code>  对象的合并，<strong>相当于浅拷贝</strong>。</p>
<blockquote>
<p>注意跟完全浅拷贝不一样的是如果接收合并的对象有被合并的对象没有的属性，那么合并后接收合并的对象依然会有那个属性</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> config1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    pass<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    test<span class="token operator">:</span> <span class="token string">'test'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    host<span class="token operator">:</span> <span class="token string">'http://atguigu.com'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">33060</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'atguigu.com'</span><span class="token punctuation">,</span>
    pass<span class="token operator">:</span> <span class="token string">'iloveyou'</span><span class="token punctuation">,</span>
    test2<span class="token operator">:</span> <span class="token string">'test2'</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>config1<span class="token punctuation">,</span> config2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="183-objectsetprototypeof-和-objectgetprototypeof"><a class="markdownIt-Anchor" href="#183-objectsetprototypeof-和-objectgetprototypeof">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_183-objectsetprototypeof-%E5%92%8C-objectgetprototypeof">18.3 Object.setPrototypeOf 和 Object.getPrototypeof</a></h3>
<p><code>Object.setPrototypeOf</code>  用于设置对象的原型对象， <code>Object.getPrototypeof</code>  用于获取对象的原型对象，相当于  <code>__proto__</code> 。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> school <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span> <span class="token string">'尚硅谷'</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> cities <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    xiaoqu<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'北京'</span><span class="token punctuation">,</span><span class="token string">'上海'</span><span class="token punctuation">,</span><span class="token string">'深圳'</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>school<span class="token punctuation">,</span> cities<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>school<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>school<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="19-es6-模块化"><a class="markdownIt-Anchor" href="#19-es6-模块化">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_19-es6-%E6%A8%A1%E5%9D%97%E5%8C%96">19. ES6 模块化</a></h2>
<p>模块化是指将一个大的程序文件，拆分成许多小的文件，然后将小文件组合起来。</p>
<h3 id="191-模块化的好处"><a class="markdownIt-Anchor" href="#191-模块化的好处">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_191-%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E5%A5%BD%E5%A4%84">19.1 模块化的好处</a></h3>
<p>模块化的优势有以下几点：</p>
<ul>
<li>防止命名冲突</li>
<li>代码复用</li>
<li>高维护性</li>
</ul>
<h3 id="192-模块化规范产品"><a class="markdownIt-Anchor" href="#192-模块化规范产品">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_192-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%A7%84%E8%8C%83%E4%BA%A7%E5%93%81">19.2 模块化规范产品</a></h3>
<p>ES6 之前的模块化规范有：</p>
<ul>
<li>CommonJS =&gt; NodeJS、Browserify</li>
<li>AMD =&gt; requireJS</li>
<li>CMD =&gt; seaJS</li>
</ul>
<h3 id="193-es6-模块化语法"><a class="markdownIt-Anchor" href="#193-es6-模块化语法">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_193-es6-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AF%AD%E6%B3%95">19.3 ES6 模块化语法</a></h3>
<p>模块功能主要由两个命令构成： <code>export</code>  和  <code>import</code> 。</p>
<ul>
<li><code>export</code>  命令用于规定模块的对外接口</li>
<li><code>import</code>  命令用于输入其他模块提供的功能</li>
</ul>
<h4 id="1931-模块导出数据语法"><a class="markdownIt-Anchor" href="#1931-模块导出数据语法">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_1931-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E8%AF%AD%E6%B3%95">19.3.1 模块导出数据语法</a></h4>
<ol>
<li>单个导出</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 单个导出</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> uname <span class="token operator">=</span> <span class="token string">'Rick'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">let</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi, bro!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>合并导出</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> uname <span class="token operator">=</span> <span class="token string">'Rick'</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">sayHello</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi, bro!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 合并导出</span>
<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> uname<span class="token punctuation">,</span> sayHello <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>默认导出</li>
</ol>
<blockquote>
<p>一个 js 文件中只能有一个默认暴露</p>
<p>这是因为默认暴露比如说下面的这个对象，然后我们导入 <code>import XXX from 那个js文件</code> ，然后就这个 XXX 就相当于是这里导出的对象，可以 XXX.uname 啊 XXX.sayHello () 等</p>
<p>要是这个 js 文件还有另外一个默认暴露一个对象，或者其他的，那到时候我们导入，XXX 到底指的是导出的哪一个？</p>
<blockquote>
<p>所以一个 js 文件只能有一个默认导出，其他的要么合并导出，要么单个导出，然后接收的时候对于合并导出以及单个导出一般都是__解构赋值导入__, 这样就更方便，直接用 (看下面), 注意__解构赋值导入__其实跟我们之前学的解构对象一样，这里导出的不管是合并导出还是单个导出其实就是一整个就是个对象，然后我们导入的时候解构我们就需要用到那个值 (比如说导出的是 uname,sayHello 等，那么在解构赋值导入时那个 {} 里面也需要用 uname,sayHello 等), 不过我们可以用 <code>as</code>  取别名</p>
</blockquote>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 默认导出</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    uname<span class="token operator">:</span> <span class="token string">'Rick'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi, bro!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="1932-模块导入数据语法"><a class="markdownIt-Anchor" href="#1932-模块导入数据语法">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_1932-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E8%AF%AD%E6%B3%95">19.3.2 模块导入数据语法</a></h4>
<ol>
<li>通用导入方式</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m1 <span class="token keyword">from</span> <span class="token string">'./js/m1.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m2 <span class="token keyword">from</span> <span class="token string">'./js/m2.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m3 <span class="token keyword">from</span> <span class="token string">'./js/m3.js'</span><span class="token punctuation">;</span>
<span class="token comment">// m1,m2,m3都是变量可以在当前文件里可以使用,注意返回的是对象,对象属性存的则是我们设的各种数据或者方法</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>注意默认导出 (default), 这个 default 本身会是一个返回的对象的属性，然后这个 default 属性存的对象里面的属性才是我们设的各种数据或者方法</p>
<p>相当于是多了一层，调用的话就比如说是 m3.default.(我们设的方法或者数据)…;</p>
</blockquote>
<ol start="2">
<li>解构赋值导入</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> uname<span class="token punctuation">,</span> sayHello <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./js/m1.js'</span><span class="token punctuation">;</span>
<span class="token comment">// 有重复名可以设置别名</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> uname <span class="token keyword">as</span> uname2<span class="token punctuation">,</span> sayHello <span class="token keyword">as</span> sayHello2 <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./js/m2.js'</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配合默认导出</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span><span class="token keyword">default</span> <span class="token keyword">as</span> m3<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./src/js/m3.js"</span><span class="token punctuation">;</span> <span class="token comment">//default必须取别名不能直接default</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>上面做法就__不用__通过 m1.XX,m2.XX 来调用我们之前 export 的方法或者数据，直接用结构用的变量就行 (或者取得别名)</p>
<p>注意 default 方式还是需要 (比方说在这里) m3.XX (中间不需要 default 了)</p>
</blockquote>
<ol start="3">
<li>简便方式导入，针对默认暴露</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> m3 <span class="token keyword">from</span> <span class="token string">"./src/js/m3.js"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>重要！这种只能对我们 export 时使用 default 的方式时使用</p>
<p>这个 import 其实跟 ``import {default as m3} from “./src/js/m3.js”;` 一样，<strong> 我们这种方式直接用 m3.XXX 就行了</strong></p>
<p>这种引入方式其实就是把 {default as m3} 省略成了 m3 (直接用别名)</p>
<p><strong><mark>所以需要是 default 的引出才可以这样引入，其他引出方式不行的</mark></strong></p>
</blockquote>
<h4 id="1933-es6-使用模块化方式二"><a class="markdownIt-Anchor" href="#1933-es6-使用模块化方式二">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_1933-es6-%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97%E5%8C%96%E6%96%B9%E5%BC%8F%E4%BA%8C">19.3.3 ES6 使用模块化方式二</a></h4>
<blockquote>
<p><strong><mark>注意在 html 文件里面的 script 标签之中要 import 或者 script 标签的 src 属性的 js 文件里有 import 都需要给这个 script 标签一个 type 属性，值为 module</mark></strong></p>
</blockquote>
<p>将文件导入都写进一个 app.js 文件中，然后在里面写入要导入的模块。app.js 中的内容如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m1 <span class="token keyword">from</span> <span class="token string">'./js/m1.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m2 <span class="token keyword">from</span> <span class="token string">'./js/m2.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m3 <span class="token keyword">from</span> <span class="token string">'./js/m3.js'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m3<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 index.html 中引入 app.js 文件内容：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./app.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="194-使用-babel-对模块化代码转换"><a class="markdownIt-Anchor" href="#194-使用-babel-对模块化代码转换">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_194-%E4%BD%BF%E7%94%A8-babel-%E5%AF%B9%E6%A8%A1%E5%9D%97%E5%8C%96%E4%BB%A3%E7%A0%81%E8%BD%AC%E6%8D%A2">19.4 使用 babel 对模块化代码转换</a></h3>
<p>有的浏览器不支持 ES6 语法，这时候就需要使用 babel 来将其转换成 ES5 等价语法。</p>
<ol>
<li>安装工具</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm i babel-cli babel-preset-env browserify(webpack) -D<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="2">
<li>编译 (看 es6 js 文件然后创建出来对应的 es5 文件)</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npx babel src&#x2F;js -d dist&#x2F;js --presets&#x3D;babel-preset-env<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>
<p>打包 (将创建出来的 es5 文件预编译打包 nodejs 模块，使之能够在浏览器端使用)</p>
<p>这个只需要对我们 App.js (主入口) 文件产生的对应的 es5 js 文件使用，只用打包这一个，因为放到这个 html script 标签里的就是打完包的它</p>
</li>
</ol>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npx browserify dist&#x2F;js&#x2F;app.js -o dist&#x2F;bundle.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们之后会学到 webpack 代替这些</p>
<blockquote>
<p>为什么需要这个打包？</p>
<p>我们要是之前在原来 es6 js 文件中导入了其他 js 文件 (模块), 那么按照 es6 生成的 es5 js 文件里面会把那些 import 语句变换成 require, 也就是我们 common.js 里面那种方式 (导出方式也一样)</p>
<p>这个 require (等) 语句是属于 node 里面的，要是想让这个 js 文件用到浏览器端就需要打包了不然无法识别</p>
</blockquote>
<blockquote>
<p>最后就可以将打包之后生成的文件 (一般是 App.js 那个文件最后编译然后打包后的文件，因为这文件里面就导入了其他的各种 js 模块等进行操作) 放到我们 index.html 的 script 标签里，这样子就很整洁，就一个 script 标签 (或许还有但不会太多), 解决了我们之前没有 js 模块化时候的各种处理方式 (参考 “<a target="_blank" rel="noopener" href="http://xn--js-i15c94nep2a.md">js 模块化.md</a>”) 的麻烦</p>
<p><strong>哦，对了，记得那个 script 标签里面加上 <code>type=&quot;module&quot;</code> </strong></p>
</blockquote>
<h3 id="195-es6-模块化引入-npm-安装的包"><a class="markdownIt-Anchor" href="#195-es6-模块化引入-npm-安装的包">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch02?id=_195-es6-%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%95%E5%85%A5-npm-%E5%AE%89%E8%A3%85%E7%9A%84%E5%8C%85">19.5 ES6 模块化引入 npm 安装的包</a></h3>
<p>先下载再导入</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm install jquery<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>再通过  <code>import</code>  导入即可。 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/es6-7.216iomdsx9mo.png" alt="es6-7"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220123002542594.png" alt="image-20220123002542594"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220123005315608.png" alt="image-20220123005315608"></p>
<p>上面说的应该是 require (node 里面的，属于 common.js) 方法，不确定 import (es6 模块化方式) 会不会是一样的</p>
<hr>
<h1 id="ecmasript-7-新特性"><a class="markdownIt-Anchor" href="#ecmasript-7-新特性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch03?id=%EF%BC%88%E4%B8%89%EF%BC%89ecmasript-7-%E6%96%B0%E7%89%B9%E6%80%A7">ECMASript 7 新特性</a></h1>
<h2 id="1-arrayprototypeincludes"><a class="markdownIt-Anchor" href="#1-arrayprototypeincludes">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch03?id=_1-arrayprototypeincludes">1. Array.prototype.includes</a></h2>
<p><code>includes</code>  方法用来检测数组中是否包含某个元素，返回布尔类型值。</p>
<h2 id="2-指数运算符"><a class="markdownIt-Anchor" href="#2-指数运算符">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch03?id=_2-%E6%8C%87%E6%95%B0%E8%BF%90%E7%AE%97%E7%AC%A6">2. 指数运算符</a></h2>
<p>在 ES7 中引入指数运算符  <code>**</code> ，用来实现幂运算，功能与  <code>Math.pow(a, b)</code>  结果相同。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token number">2</span> <span class="token operator">**</span> <span class="token number">3</span> <span class="token comment">// 8</span>
Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<hr>
<h1 id="ecmascript-8-新特性"><a class="markdownIt-Anchor" href="#ecmascript-8-新特性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch04?id=%EF%BC%88%E5%9B%9B%EF%BC%89ecmascript-8-%E6%96%B0%E7%89%B9%E6%80%A7">ECMAScript 8 新特性</a></h1>
<h2 id="1-async-和-await"><a class="markdownIt-Anchor" href="#1-async-和-await">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch04?id=_1-async-%E5%92%8C-await">1. async 和 await</a></h2>
<p><code>async</code>  和  <code>await</code>  两种语法结合可以让异步代码像同步代码一样。（即：看起来是同步的，实质上是异步的。）</p>
<p>先从字面意思理解， <code>async</code>  意为异步，<strong>可以用于声明一个函数前，该函数是异步的</strong>。 <code>await</code>  意为等待，<strong>即等待一个异步方法完成</strong>。</p>
<h3 id="11-async"><a class="markdownIt-Anchor" href="#11-async">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch04?id=_11-async">1.1 async</a></h3>
<p><code>async</code>  声明（ <code>function</code> ）的函数成为 async 函数，语法：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">funcName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//statements </span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong> <code>async</code>  内部可以使用  <code>await</code> ，也可以不使用。  <code>async</code>  函数的返回值是一个  <code>Promise</code>  对象，因此执行这个函数时，可以使用  <code>then</code>  和  <code>catch</code>  方法。 根据 <strong>函数体内部</strong> 的返回值，  <code>async</code>  函数返回值具体情况如下：</strong></p>
<ul>
<li>函数体内不返回任何值，则 <code>async</code>  函数返回值为一个成功（ <code>fulfilled</code> ）的 <code>Promise</code>  对象，状态值为 <code>undefined</code></li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token comment">// Promise&#123;&lt;fullfilled>: undefined&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>返回结果__不是__一个 <code>Promise</code> ，则 <code>async</code>  函数返回值为一个成功（ <code>fulfilled</code> ）的 <code>Promise</code>  对象，状态值为这个内部返回值。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token string">'hello'</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> 
<span class="token comment">// Promise&#123;&lt;fullfilled>: 'hello'&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><strong>内部抛出错误</strong>，则 <code>async</code>  函数返回值为一个失败的 <code>Promise</code>  对象。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'出错了'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>若函数内部返回值是一个 <code>Promise</code>  对象，则 <code>async</code>  函数返回值的状态取决于这个 <code>Promise</code>  对象 (resolve 为 fulfilled,reject 为 rejected 状态)。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">a</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>就跟我们之前 Promise 的 then 方法很像</p>
</blockquote>
<h3 id="12-await"><a class="markdownIt-Anchor" href="#12-await">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch04?id=_12-await">1.2 await</a></h3>
<p><code>await</code>  相当于一个运算符，<strong>右边接一个值。一般为一个  <code>Promise</code>  对象，也可以是一个非  <code>Promise</code>  类型</strong>。当右接一个非  <code>Promise</code>  类型， <code>await</code>  表达式返回的值就是这个值；当右接一个  <code>Promise</code>  对象，则  <code>await</code>  表达式会阻塞后面的代码，等待当前  <code>Promise</code>  对象  <code>resolve</code>  的值。</p>
<ul>
<li>
<p>综合  <code>async</code>  和  <code>await</code>  而言。 <code>await</code>  必须结合  <code>async</code>  使用，而  <code>async</code>  则不一定需要  <code>await</code> 。</p>
</li>
<li>
<p><code>async</code>  会将其后的函数的返回值封装成一个  <code>Promise</code>  对象，而  <code>await</code>  会等待这个  <code>Promise</code>  完成，然后返回  <code>resolve</code>  的结果。</p>
</li>
<li>
<p>当这个  <code>Promise</code>  <strong>失败</strong><mark>或者</mark>__抛出异常__时，需要时使用  <code>try-catch</code>  捕获处理。</p>
</li>
</ul>
<blockquote>
<p><code>Promise</code>  使用链式调用解决了传统方式回调地狱的问题，而  <code>async-await</code>  又进一步优化了代码的可读性。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> p
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// '成功'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> p
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// '失败'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>await 后面跟着非 Promise 对象那么这个 await 语句返回的结果就是这个后面的非 Promise 对象</p>
<p>await 后面跟着 Promise 对象那么这个 await 语句返回的结果就是这个后面的 Promise 对象__resolve__的值 (不是状态), 如果是 reject 则是会被 try catch 接收到，然后 e 就代表了那个 reject 的值</p>
</blockquote>
<h3 id="13-综合应用-读取文件"><a class="markdownIt-Anchor" href="#13-综合应用-读取文件">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch04?id=_13-%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">1.3 综合应用 - 读取文件</a></h3>
<p>需求：先读取用户数据 user，然后读取订单数据 order，最后读取商品数据 goods。</p>
<p>对于这种异步操作很容易想到使用  <code>Promise</code> ，代码如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/user.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> rejecet</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/order.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">rejecet</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span>value<span class="token punctuation">,</span> data<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/goods.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>但是，使用  <code>Promise</code>  链式调用虽然避免了回调地狱，但这种链式调用过多难免引起代码复杂，看起来不直观。可以使用  <code>async</code>  和  <code>await</code>  方法优化，代码如下：</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">readUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/user.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">readOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/order.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">readGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./files/goods.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token keyword">try</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> order <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> goods <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span>user<span class="token punctuation">,</span> order<span class="token punctuation">,</span> goods<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong><mark>这样，代码看起来很直观，就好像是同步代码一样，实际上是异步操作。</mark></strong></p>
<blockquote>
<ul>
<li>
<p>async,await 想法就是将异步操作封装到一个 Promise 对象里面，每个异步操作对应一个 Promise 对象。这个 Promise 对象的状态和值都会按照我们具体异步操作的来决定</p>
</li>
<li>
<p>再将每一个 Promise 封装到一个函数里面，这个函数的返回值就是这个 Promise 对象</p>
</li>
<li>
<p>这样我们就可以再创建一个函数用 async 修饰，这么做这个函数默认__返回的就是个 Promise 对象 (很重要)__, 而这个对象具体状态以及值由我们写的而决定，async 函数会是异步</p>
</li>
<li>
<p>之后我们就可以再这个 async 函数里面执行那些有着异步操作的函数 (which returns a Promise 对象), 在每一个函数之前需要加上 await, 加上 await 就会__等 (异步，不是同步)__让他后面那个函数执行完 (因为返回出来的是个 Promise 对象)</p>
</li>
<li>
<p>如果这个函数的返回的 Promise 对象是 resolve, 那么这整个 await 语句就会返回这个 resolve 的值 (我们可以拿个变量接收)</p>
</li>
<li>
<p>如果这个函数的返回的 Promise 对象是 reject, 则会 try catch 到，执行 catch 语句中的.</p>
</li>
<li>
<p>这么干最后可以将所有用变量接收的数据聚齐再在这个 async 函数里面 return new Promise…, 在把这个数据用 resolve 传出去</p>
</li>
<li>
<p>如果是之前的触发了 try catch 那么就在 catch 语句里面也是 return new Promise…, 在把这个错误用 reject 传出去</p>
</li>
<li>
<p>这样再拿一个变量接收这个 async 函数的返回值，返回的就是个 Promise 对象，然后我们可以用 then 方法等看该对象的状态进行操作</p>
</li>
<li>
<p>记得那个 async 函数需要我们调用，不然只是声明</p>
</li>
</ul>
</blockquote>
<blockquote>
<p>async,await 结合就很像我们正常用函数接收返回值等等等，只不过在前面加上个 await 罢了</p>
</blockquote>
<h3 id="14-综合应用-封装ajax"><a class="markdownIt-Anchor" href="#14-综合应用-封装ajax">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch04?id=_14-%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85ajax">1.4 综合应用 - 封装 ajax</a></h3>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">>=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">sendAjax</span><span class="token punctuation">(</span><span class="token string">'http://poetry.apiopen.top/sentences'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> poem <span class="token operator">=</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'——'</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>result<span class="token punctuation">.</span>from
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerText <span class="token operator">=</span> poem
<span class="token punctuation">&#125;</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里封装的 ajax 还不能体现  <code>async-await</code>  的作用所在，因为没有出现多个 ajax 请求。在又多个 ajax 请求并且后续的请求依赖于前一个请求的结果的时候， <code>async-await</code>  的优点就体现出来了。</p>
<p>总结:</p>
<blockquote>
<p>一个函数如果加上 async ，那么该函数就会返回一个 Promise。</p>
<p>await 只能在 async 函数中使用，可以把 async 看成将函数返回值使用 Promise.resolve () 包裹了下。</p>
<p>async 和 await 相比直接使用 Promise 来说，优势在于处理 then 的调用链，能够更清晰准确的写出代码。</p>
<p><strong>缺点在于滥用 await 可能会导致性能问题，因为 await 会阻塞代码，也许之后的异步代码并不依赖于前者，但仍然需要等待前者完成，导致代码失去了并发性。</strong></p>
</blockquote>
<blockquote>
<p>任何一个 <code>await</code>  语句后面的 Promise 对象变为 <code>reject</code>  状态，那么整个 <code>async</code>  函数都会中断执行。</p>
</blockquote>
<blockquote>
<p>The  <code>await</code>  expression causes  <code>async</code>  function execution to pause until a  <code>Promise</code>  is settled (that is, fulfilled or rejected), and to resume execution of the  <code>async</code>  function after fulfillment. When resumed, the value of the  <code>await</code>  expression is that of the fulfilled  <code>Promise</code> .</p>
<p>If the  <code>Promise</code>  is rejected, the  <code>await</code>  expression throws the rejected value.</p>
<p>or throw new Error:  <code>async</code>  函数内部抛出错误，会导致返回的 Promise 对象变为 <code>reject</code>  状态。抛出的错误对象会被 <code>catch</code>  方法回调函数接收到。</p>
<p>If the value of the <em>expression</em> following the  <code>await</code>  operator is not a  <code>Promise</code> , it’s converted to a <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/resolve">resolved Promise</a>.</p>
</blockquote>
<blockquote>
<p>如果多个 await 然后每个后面都是一个函数 (有着异步操作的), 那么还是会排队，后面异步等前面异步结束 (因为 await 的存在)</p>
<p>要是这些异步任务没有依赖 (后面的不需要前面的发生了才能发生), 就可以:</p>
</blockquote>
<p>多个 <code>await</code>  命令后面的异步操作，如果不存在继发关系，最好让它们同时触发。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>上面代码中， <code>getFoo</code>  和 <code>getBar</code>  是两个独立的异步操作（即互不依赖），被写成继发关系。这样比较耗时，因为只有 <code>getFoo</code>  完成以后，才会执行 <code>getBar</code> ，完全可以让它们同时触发。</p>
<blockquote>
<p>这是因为 await 必须要等到当前那个异步操作结束才可以继续下一个</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 写法一</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 写法二</span>
<span class="token keyword">let</span> fooPromise <span class="token operator">=</span> <span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> barPromise <span class="token operator">=</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token keyword">await</span> fooPromise<span class="token punctuation">;</span>
<span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token keyword">await</span> barPromise<span class="token punctuation">;</span>
<span class="token comment">// 这第二个写法是先让那些异步函数排队(等着执行),也就相当于触发了异步操作</span>
<span class="token comment">// 然后之后的await就会等那个对应的异步操作返回的结果,因为这种方式先让他们都触发了,就比之前块了</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>上面两种写法， <code>getFoo</code>  和 <code>getBar</code>  都是同时触发，这样就会缩短程序的执行时间。</p>
</blockquote>
<hr>
<h2 id="2-objectvalues-和-objectentries"><a class="markdownIt-Anchor" href="#2-objectvalues-和-objectentries">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch04?id=_2-objectvalues-%E5%92%8C-objectentries">2. Object.values 和 Object.entries</a></h2>
<ul>
<li><code>Object.values()</code>  方法返回一个给定对象的所有可枚举属性值的数组，类似于 <code>Object.keys()</code> ，只是前者返回属性值，后者返回键值组合的数组。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  c<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// [1, &#123;1: 2&#125;, [1,2,3]]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// ['a', 'b', 'c']</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>Object.entries()</code>  方法返回一个给定对象自身可遍历属性 <code>[key,value]</code>  的数组（数组元素也是一个个的数组的数组）</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// [ [ 'a', 1 ], [ 'b', 2 ], [ 'c', 3 ] ]</span>


返回的是一个数组，这样就可以使用<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">for...of</span><span class="token template-punctuation string">`</span></span>遍历了。


<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> c<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="ecmascript-9-新特性"><a class="markdownIt-Anchor" href="#ecmascript-9-新特性">#</a> ECMAScript 9 新特性</h1>
<p>可以对对象使用 rest 参数和…(扩展元素符)</p>
<p>rest 参数:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>host<span class="token punctuation">,</span>port<span class="token punctuation">,</span><span class="token operator">...</span>user<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    host<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    a<span class="token operator">:</span><span class="token string">'hi'</span><span class="token punctuation">,</span>
    b<span class="token operator">:</span><span class="token string">'bye'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>上面 user 就代表了一个对象这个对象有个 a 属性 (值为 hi) 和 b 属性 (值为 bye)</p>
<p>这里跟数组不同的是，数组里 (一般用 arg 代表剩下所有的参数) 那个都是用数组存，对象里面剩下所有用 rest 代表会被以对象的形式代表</p>
</blockquote>
<p>…(扩展元素符):</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> obj1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
              
<span class="token keyword">const</span> all <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>obj1<span class="token punctuation">,</span><span class="token operator">...</span>obj2<span class="token punctuation">,</span><span class="token operator">...</span>obj2<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>用… 把每一个对象里面的键和值都分成多个参数，所以最后 all 就是有这上对象的所有属性与值</p>
<p><strong>就跟数组用的方式是一样的</strong></p>
</blockquote>
<hr>
<h1 id="ecmascript-10-新特性"><a class="markdownIt-Anchor" href="#ecmascript-10-新特性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch06?id=%EF%BC%88%E5%85%AD%EF%BC%89ecmascript-10-%E6%96%B0%E7%89%B9%E6%80%A7">ECMAScript 10 新特性</a></h1>
<h2 id="1-objectfromentries"><a class="markdownIt-Anchor" href="#1-objectfromentries">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch06?id=_1-objectfromentries">1. Object.fromEntries</a></h2>
<p>Object.fromEntries () 方法把可迭代对象的键值对列表转换为一个对象。<br>
语法：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>iterable<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li><code>iterable</code> ：类似 Array 、 Map 或者其它实现了可迭代协议的可迭代对象。</li>
<li>返回值：一个由该迭代对象条目提供对应属性的新对象。</li>
<li>相当于  <code>Object.entries</code>  （ES8）的逆运算。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
<span class="token comment">// &#123; '1': 2, '3': 4 &#125;</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &#123;'1': 2&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="2-trimstart-和-trimend"><a class="markdownIt-Anchor" href="#2-trimstart-和-trimend">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch06?id=_2-trimstart-%E5%92%8C-trimend">2. trimStart () 和 trimEnd ()</a></h2>
<ul>
<li><code>trimStart()</code>  去除字符串开头连续的空格（ <code>trimLeft</code>  是此方法的别名）</li>
<li><code>trimEnd()</code>  去除字符串末尾连续的空格（ <code>trimRight</code>  是此方法的别名）</li>
</ul>
<hr>
<h2 id="3-arrayprototypeflat-和-arrayprototypeflatmap"><a class="markdownIt-Anchor" href="#3-arrayprototypeflat-和-arrayprototypeflatmap">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch06?id=_3-arrayprototypeflat-%E5%92%8C-arrayprototypeflatmap">3. Array.prototype.flat 和 Array.prototype.flatMap</a></h2>
<ul>
<li><code>Array.prototype.flat(i)</code> ：展平一个多维数，i 为要展开的层数，默认为 1，即展开一层。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment">// [1,2,3,4,5]</span>
<span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// [1,2,3,4,5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>使用 <code>Infinity</code>  作为深度，展开任意深度的嵌套数组</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span>
<span class="token comment">// [1, 2, 3, 4, 5, 6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>也可以使用 <code>flat</code>  来去除数组空项</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
arr<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// [1,2,3,4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li><code>Array.prototype.flatMap</code> ：相当于 <code>map</code>  和 <code>flat</code>  的结合，方法首先使用映射函数映射每个元素，然后将结果压缩成一个新数组。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> res1 <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> <span class="token punctuation">[</span>x <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>
<span class="token comment">// [[1],[4],[9],[16]]</span>
<span class="token keyword">let</span> res2 <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> <span class="token punctuation">[</span>x <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span>
<span class="token comment">// [1,4,9,16]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="4-symbolprototypedescription"><a class="markdownIt-Anchor" href="#4-symbolprototypedescription">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch06?id=_4-symbolprototypedescription">4. Symbol.prototype.description</a></h2>
<p>使用  <code>Symbol()</code>  创建的  <code>Symbol</code>  字面量，可以直接使用  <code>description</code>  获取该字面量的描述。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> sym <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sym<span class="token punctuation">.</span>description<span class="token punctuation">)</span>
<span class="token comment">// hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<hr>
<h1 id="ecmascript-11-新特性"><a class="markdownIt-Anchor" href="#ecmascript-11-新特性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=%EF%BC%88%E4%B8%83%EF%BC%89ecmascript-11-%E6%96%B0%E7%89%B9%E6%80%A7">ECMAScript 11 新特性</a></h1>
<h2 id="1-类的私有属性"><a class="markdownIt-Anchor" href="#1-类的私有属性">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_1-%E7%B1%BB%E7%9A%84%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7">1. 类的私有属性</a></h2>
<p>ES11 提供了类的私有属性，在类的外部无法访问该属性。只有再类的内部能访问。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span>
  <span class="token comment">//公有属性</span>
  name<span class="token punctuation">;</span>
  <span class="token comment">//私有属性</span>
  #age<span class="token punctuation">;</span>
  #weight<span class="token punctuation">;</span>
  <span class="token comment">//构造方法</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> weight</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>#weight <span class="token operator">=</span> weight<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">intro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#weight<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//实例化</span>
<span class="token keyword">const</span> girl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'晓红'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">'45kg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 外部无法直接访问</span>
<span class="token comment">// console.log(girl.name);</span>
<span class="token comment">// console.log(girl.#age);</span>
<span class="token comment">// console.log(girl.#weight);</span>

girl<span class="token punctuation">.</span><span class="token function">intro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="2-allsettled"><a class="markdownIt-Anchor" href="#2-allsettled">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_2-allsettled">2. allSettled</a></h2>
<h3 id="promiseallsettled"><a class="markdownIt-Anchor" href="#promiseallsettled">#</a> Promise.allSettled()</h3>
<p>该  <code>Promise.allSettled()</code>  方法返回一个在所有给定的  <code>promise</code>  都已经  <code>fulfilled</code>  或  <code>rejected</code>  后的  <code>promise</code> ，并带有一个对象数组，每个对象表示对应的  <code>promise</code>  结果。<strong> <code>allSettled</code>  方法返回的  <code>Promise</code>  对象始终是成功（ <code>fulfilled</code> ）的。</strong><br>
使用场景：</p>
<ul>
<li><strong>有多个彼此不依赖的异步任务成功完成时使用</strong>。</li>
<li>想得到每个  <code>promise</code>  的结果时使用。</li>
</ul>
<blockquote>
<p>也就是传进去一个 Promise 数组，然后返回的是个 Promise 对象，这个对象的状态属性肯定为 fulfilled,value 属性为一个对象数组，数组里面每个对象对应了每个传进去的 Promise 对象，有着同样的属性和值 (状态 and value)</p>
</blockquote>
<h3 id="promiseall"><a class="markdownIt-Anchor" href="#promiseall">#</a> Promise.all()</h3>
<p>_<em>对比于  <code>Promise.all()</code> ， <code>all()</code>  也接受一个  <code>Promise</code>  <em>对象数组_参数，只要有一个失败（ <code>rejected</code> ），那么返回的  <code>Promise</code>  对象就是失败（ <code>rejected</code> ）的。</em></em></p>
<p>使用场景：</p>
<ul>
<li>传__进去的  <code>Promise</code>  对象彼此依赖，且需要在其中任何一个失败的时候停止。__</li>
</ul>
<blockquote>
<p>也就是传进去一个 Promise 数组，然后返回的是个 Promise 对象，如果传进去的 Promise 数组里面有任何一个 Promise 最后状态是 rejected 那么这个 Promise.all () 方法返回的 Promise 对象的状态属性肯定为 rejected (只有全是 resolve 这个才是 resolve, 有点事务的意思),value 属性为一个数组，数组里面每个元素对应了每个传进去的 Promise 对象的 value 属性</p>
</blockquote>
<p>两个  <code>Promise</code>  都是成功的情况：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'用户数据-1'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'订单数据-2'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> res1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> res2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果： <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/es11-1.2fgw7vvkb0kk.png" alt="es11-1"></p>
<p>一个成功，一个失败：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'用户数据-1'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败了'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> res1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">allSettled</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> res2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>打印结果： <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/ES11-2.17q27y7sy9mk.png" alt="ES11-2"></p>
<hr>
<h2 id="3-matchall"><a class="markdownIt-Anchor" href="#3-matchall">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_3-matchall">3. matchAll</a></h2>
<p><code>matchAll()</code>  方法返回一个包含所有匹配正则表达式的结果及分组捕获组的迭代器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> regexp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">t(e)(st(\d?))</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token string">'test1test2'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>str<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span>regexp<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: Array ["test1", "e", "st1", "1"]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: Array ["test2", "e", "st2", "2"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="4-可选链"><a class="markdownIt-Anchor" href="#4-可选链">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_4-%E5%8F%AF%E9%80%89%E9%93%BE">4. 可选链</a></h2>
<h3 id="41-定义"><a class="markdownIt-Anchor" href="#41-定义">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_41-%E5%AE%9A%E4%B9%89">4.1 定义</a></h3>
<p>可选链  <code>?.</code>  是一种访问嵌套对象属性的安全的方式。即使中间的属性不存在，也不会出现错误。<br>
原则：如果可选链  <code>?.</code>  前面的部分是  <code>undefined</code>  或者  <code>null</code> ，它会停止运算并返回该部分。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  address<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> user<span class="token operator">?.</span>address<span class="token operator">?.</span>street <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined（不报错）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="42-短路效应"><a class="markdownIt-Anchor" href="#42-短路效应">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_42-%E7%9F%AD%E8%B7%AF%E6%95%88%E5%BA%94">4.2 短路效应</a></h3>
<p>短路效应：正如前面所说的，如果  <code>?.</code>  左边部分不存在，就会立即停止运算（“短路效应”）。所以，如果后面有任何函数调用或者副作用，它们均不会执行。<br>
这有和  <code>&amp;&amp;</code>  的作用类似，但上述改用  <code>&amp;&amp;</code>  会显得代码冗余度高：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>street<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="43-其它变体"><a class="markdownIt-Anchor" href="#43-其它变体">#</a> [4.3 其它变体：?.()，?.<a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_43-%E5%85%B6%E5%AE%83%E5%8F%98%E4%BD%93%EF%BC%9A%EF%BC%8C">]</a></h3>
<p>可选链  <code>?.</code>  不是一个运算符，而是一个特殊的语法结构。它还 <strong>可以与函数和方括号一起使用</strong>。<br>
例如，将  <code>?.()</code>  用于调用一个可能不存在的函数（即使不存在也不报错）。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
foo<span class="token operator">?.</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// hello</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>?.[]</code>  允许从一个可能不存在的对象上安全地读取属性。（即使不存在也不报错）。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  key<span class="token operator">:</span> <span class="token number">123</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token operator">?.</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="5-动态-import-导入"><a class="markdownIt-Anchor" href="#5-动态-import-导入">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_5-%E5%8A%A8%E6%80%81-import-%E5%AF%BC%E5%85%A5">5. 动态 import 导入</a></h2>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

btn<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./hello.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">module</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    module<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h2 id="6-bigint"><a class="markdownIt-Anchor" href="#6-bigint">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_6-bigint">6. BigInt</a></h2>
<p><code>BigInt</code>  是一种特殊的数字类型，它提供了对任意长度整数的支持。</p>
<p>创建  <code>bigint</code>  的方式有两种：在一个整数字面量后面加  <code>n</code>  或者调用  <code>BigInt</code>  函数，该函数从字符串、数字等中生成  <code>bigint</code> 。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> n1 <span class="token operator">=</span> <span class="token number">123n</span>
<span class="token keyword">let</span> n2 <span class="token operator">=</span> <span class="token number">456n</span>
<span class="token keyword">let</span> n3 <span class="token operator">=</span> <span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">789</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> n1<span class="token punctuation">)</span> <span class="token comment">// bigint</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n1<span class="token operator">+</span>n2<span class="token punctuation">)</span> <span class="token comment">// 579n</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n2<span class="token operator">+</span>n3<span class="token punctuation">)</span> <span class="token comment">// 1245n</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>比较运算符：</p>
<ul>
<li>例如 <code>&lt;</code>  和 <code>&gt;</code> ，使用它们来对 <code>bigint</code>  和  <code>number</code>  类型的数字进行比较没有问题：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">2n</span> <span class="token operator">></span> <span class="token number">1n</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">2n</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>但是请注意，由于 <code>number</code>  和 <code>bigint</code>  属于不同类型，它们可能在进行 <code>==</code>  比较时相等，但在进行 <code>===</code> （严格相等）比较时不相等：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">1n</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">alert</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token operator">===</span> <span class="token number">1n</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<hr>
<h2 id="7-globalthis"><a class="markdownIt-Anchor" href="#7-globalthis">#</a> <a target="_blank" rel="noopener" href="https://docs.mphy.top/#/ECMAScript6+/ch07?id=_7-globalthis">7. globalThis</a></h2>
<p>全局对象提供可在任何地方使用的变量和函数。默认情况下，这些全局变量内置于语言或环境中。<br>
在浏览器中，它的名字是  <code>window</code> ，对 Node.js 而言，它的名字是  <code>global</code> ，其它环境可能用的是别的名字。<br>
ES11 中  <code>globalThis</code>  被作为全局对象的标准名称加入到了 JavaScript 中，所有环境都应该支持该名称。所有主流浏览器都支持它。<br>
使用场景： 假设我们的环境是浏览器，我们将使用  <code>window</code> 。如果你的脚本可能会用来在其他环境中运行，则最好使用  <code>globalThis</code> 。</p>
<hr>
<hr>
<h1 id="说下我的理解"><a class="markdownIt-Anchor" href="#说下我的理解">#</a> 说下我的理解</h1>
<h2 id="事件循环promiseasync-await异步微任务宏任务同步执行顺序"><a class="markdownIt-Anchor" href="#事件循环promiseasync-await异步微任务宏任务同步执行顺序">#</a> 事件循环，Promise,async-await, 异步 (微任务宏任务) 同步执行顺序</h2>
<blockquote>
<p>我的理解：要是代码遇到可能会耗时比较久的任务，比如说计时器 (就算是 0 秒也会在看到是个定时器时会认为是耗时的), 还有 ajax 请求，反正就是看起来会耗时的任务，这些一般都会是被异步操作.</p>
<ul>
<li>js 引擎 (执行栈) 一遇到一个看起来会耗时的任务就会把他放进宿主环境里面去执行，比如说是个定时器，在宿主环境中会先等我们执行栈的代码执行完之后再去执行，不过一般放在宿主环境 (web api (浏览器或者 node)) 是宏任务，而像 Promise.then,Promise.catch 这种微任务是在 js 引擎中的一块地方</li>
<li>现在我们同步任务都完成了 (记住包括 new Promise 对象里面那个函数的代码), 就回先去把微任务都挨个执行，这里的执行只是单纯将运行一下，但是不会运行里面的回调函数！！！里面的回调函数 (callback) 一般异步任务都会有的，这个回调函数 (不管宏任务还是微任务) 其实才是我们真正想执行的，这个函数就是我们真正想要执行的，只不过要么需要先等一个事件触发，要么需要计时到了，要么需要 ajax 请求返回了，要么需要等 Promise 对象返回了确定了状态属性，等等等</li>
</ul>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122131429162.png" alt="image-20220122131429162"></p>
<blockquote>
<ul>
<li>这样微任务里面的回调函数会给放入任务队列 (queue) 中排队等着执行</li>
<li>然后接着是宏任务，只是执行一下比如说计时器会开始倒计时，倒计时结束会把回调函数放到任务队列 (queue) 中排队等着执行，如果是事件触发，那么就会把那个事件触发留在那个宿主环境中 (web api), 这样之后一当我们触发了就会把那里面的函数放入任务队列 (queue) 中排队等着执行</li>
<li>当然每一次执行完每一个宏任务会先看看有没有微任务，一旦有就执行所有微任务把他们的回调函数放入任务队列排队
<ul>
<li>宏任务执行完毕后，立即执行当前微任务队列中的<strong>所有微任务</strong>（依次执行）</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122131616193.png" alt="image-20220122131616193"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122142737061.png" alt="image-20220122142737061"></p>
<blockquote>
<ul>
<li>
<p>要是没有，就回去执行剩下的宏任务 (要是有的话), 再把下个宏任务的回调函数放入任务队列排队</p>
<p><mark>注意在这一阶段 (确认了没有微任务), 在宏任务中，哪一个执行先满足了条件触发了回调函数，就把他的哪个回调函数放入任务队列排队</mark> -&gt; 比如说一个 ajax 请求 (ajax 请求本身如果设置为异步，<strong> 他请求本身就是异步的，会在同步代码执行完毕后请求</strong> (一般都是通过我们某个事件触发而发送的请求 (请求通过事件触发 -&gt; 服务器处理（这时浏览器仍然可以作其他事情）-&gt; 处理完毕同步需要等待返回结果才能继续，异步不必等待，一般需要监听异步的结果)))(请求中，需要 3ms), 还有个计时器 (2ms 触发), 会首先按照顺序先进来的执行，但这个执行只是相当于启动了一下，非常的快，这个时候因为是计时器先到了触发了回调函数，所以是计时器的回调函数先放到了任务队列排队 (<strong>所以这里并不是按照前后顺序什么的</strong>)</p>
</li>
<li>
<p>这个回调函数执行完之后当然就会看有没有微任务什么的</p>
</li>
</ul>
</blockquote>
<h6 id="非常重要-创建newpromise实例化对象时里面那个函数参数的里面的代码是同步操作的promise只有thencatch等等methods是异步操作微任务"><a class="markdownIt-Anchor" href="#非常重要-创建newpromise实例化对象时里面那个函数参数的里面的代码是同步操作的promise只有thencatch等等methods是异步操作微任务">#</a> 非常重要！创建 (new) Promise 实例化对象时里面那个函数参数的里面的代码是同步操作的，Promise 只有 then,catch, 等等 methods 是异步操作 (微任务)</h6>
<h6 id="同样async函数里面在到达await之前的代码都是同步执行的"><a class="markdownIt-Anchor" href="#同样async函数里面在到达await之前的代码都是同步执行的">#</a> 同样，async 函数里面在到达 await 之前的代码都是同步执行的</h6>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122131652575.png" alt="image-20220122131652575"></p>
<p><strong>await 做了什么</strong></p>
<p>从字面意思上看 await 就是等待，await 等待的是一个表达式，这个表达式的返回值可以是一个 promise 对象也可以是其他值。</p>
<p>很多人以为 await 会一直等待之后的表达式执行完之后才会继续执行后面的代码，<strong>实际上 await 是一个让出线程的标志</strong>。<strong><mark>await 后面的表达式会先执行一遍，将 await 后面 (下面) 的代码 (尽管这些代码都不是异步操作，都会被) 加入到 microtask (微任务！<span class="spoiler" title="..."> 不是宏任务</span>！) 中，_然后就会跳出整个 async 函数_来执行 async 函数后面 (下面) 的代码。</mark></strong></p>
<p>注意！</p>
<ul>
<li>
<p>await 对于__后面跟着的是 promise 对象__, 则会堵塞后面的，必须要等获得到了这个 promise 对象，所以要是一个函数的调用，await 必须等到那个函数执行完毕然后把那个 Promise 对象结果返回过来然后那个 Promise 对象有 resolve 的值了 (rejected 或者 throw… 会被 catch 接住) 才会把下面的代码放到微服务之中</p>
</li>
<li>
<p>await 对于__后面跟着的是非 promise 对象__，比如<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0&amp;spm=1001.2101.3001.7020">箭头函数</a>，同步表达式等等，await 等待函数或者直接量的返回，而不是等待其执行结果</p>
</li>
</ul>
<p><strong>比如说:</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的代码其实可以写为:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>所以 async2 函数因为用了小括号所以会被调用，这里还是属于同步操作 (因为看上方第二种写法，这个函数调用还是在 new Promise 阶段相当于 (我们上面讲的)), 调用 async2 函数里面的代码也是像我们上面说的在到达 await 之前的代码都是同步的除非是异步的操作 (任务) 比如说计时器等</p>
</blockquote>
<blockquote>
<p>执行完就会回来，这个 async1 函数里面的在 await 下面的代码就相当于是放进了 promise 对象.then 方法里面，也就是属于微任务了，所以会在微任务里面等我们同步任务都完成之后先执行微任务，比如说这里的 then 方法 (虽然第一个写法中看不到), 然后会把 then 方法里面的回调函数放到任务队列排队，这个回调函数里面包括的就是 async1 函数里面 await 下面的那些代码，要是这里面有其他微任务或者宏任务就是会正常操作 (该放微任务的放微任务，该放宏任务的放宏任务)</p>
</blockquote>
<p><strong>再比如说:</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> three <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面的代码其实可以写为 (<strong>我的理解</strong>):</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> one <span class="token operator">=</span> data<span class="token punctuation">;</span>
      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    	<span class="token keyword">let</span> two <span class="token operator">=</span> data<span class="token punctuation">;</span>
        Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    		<span class="token keyword">let</span> three <span class="token operator">=</span> data<span class="token punctuation">;</span>
  	    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  	  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><mark>以下都是我个人理解，可能是对可能是错</mark></p>
<p>这里主要就是相当于之前我们看到的多个 await 一个接一个其实是会堵塞的</p>
<p>这是因为 await 需要后面的值 (一般都是函数调用，所以需要函数调用完了) 然后再把 await 语句返回值给那个变量，其实在第二种写法中更直观 (按照我的理解写的第二种写法，<strong> 希望是对的</strong>).</p>
<ul>
<li>也就是在第一个 await 语句其实是在那个 async 函数里面是同步执行的 (因为属于 new Promise 的代码 (上面讲过))</li>
<li>然后结果赋值给 one 接着第二个 await, 也两个都是同步的，只不过是属于第一个 new Promise 出的 Promise 对象的 then 方法里面，这个 then 方法是微任务，会放到微任务那一块执行 (也或许是等待执行), 只有在那个 Promise 对象的状态和值确认了才会真正把 then 方法 (执行) 然后里面的回调函数放到任务队列里面排队，这个回调函数里面的代码就是我们给 one 赋值然后第二个 await</li>
<li>注意这里因为是 then 里面，所以是只有第一个 await 后面的函数 (fn1) 执行完了，然后 await 获取到了那个函数的返回值，第一个 Promise 对象才会被返回才可以调用 then</li>
<li>所以这就形成了继发关系</li>
</ul>
</blockquote>
<p><strong><mark>总结:</mark> 当 async 函数执行的时候，一旦遇到 await 就会先返回，等到异步操作完成，再接着执行函数体内后面的语句。那其实就是说在 async 函数内，每当遇到 await 关键字的时候，函数就是阻塞住，必须等到异步操作有结果时才会往下继续执行</strong></p>
<p>说明之前说到的继发关系解决方法:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 写法一</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">getFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个方法直接用就行不说明</span>

<span class="token comment">// 写法二</span>
<span class="token keyword">let</span> value1 <span class="token operator">=</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value2 <span class="token operator">=</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value3 <span class="token operator">=</span> <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token keyword">await</span> value1<span class="token punctuation">;</span> <span class="token comment">//这里等待value1的返回 后面可以do something</span>
<span class="token keyword">let</span> two <span class="token operator">=</span> <span class="token keyword">await</span> value2<span class="token punctuation">;</span> <span class="token comment">//这里等待value2的返回 后面可以do something</span>
<span class="token keyword">let</span> three <span class="token operator">=</span> <span class="token keyword">await</span> value3<span class="token punctuation">;</span> <span class="token comment">//这里等待value3的返回 后面可以do something</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>第二种解决方式是</p>
<blockquote>
<p>我们可以异步函数执行的结果储存起来，在需要的时候再去 await</p>
</blockquote>
<p>这里其实就是上面那些函数 (里面包含着返回的 Promise 对象这个 Promise 对象里面包含了异步操作) 先调用他们 (然后看到耗时的就放入微任务 / 宏任务那一块) 然后返回值放到一个变量中，所以上面的调用以及赋值其实相当于是异步操作，所以互相之间不会有影响，不像之前前面有了 await 就必须要执行完毕然后有了 Promise 对象那个 resolve 的值才可以继续 (将之后的放入微任务)</p>
<p>之后再 await, 这里等的就是变量，因为这些变量可能还没接收到那个返回的 Promise 对象，所以 await 会认为是非 Promise 就直接该怎么样就怎么样的返回给我们 one,two,three 变量.</p>
</blockquote>
<p><strong>上面解释的很勉强，其实我还是没怎么搞懂这个到底为什么解决了继发关系，多做研究</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122144104198.png" alt="image-20220122144104198"></p>
<hr>
<h1 id="参考题"><a class="markdownIt-Anchor" href="#参考题">#</a> 参考题</h1>
<h2 id="1-事件循环同步异步微任务宏任务"><a class="markdownIt-Anchor" href="#1-事件循环同步异步微任务宏任务">#</a> 1. 事件循环，同步异步，微任务宏任务</h2>
<p><em>JavaScript 主线程从 “任务队列” 中读取异步任务的回调函数，放到执行栈中依次执行。这个过程是循环不断的，所以整个的这种运行机制又称为 EventLoop (事件循环)</em></p>
<p>宏任务与微任务</p>
<p>宏任务：异步 Ajax 请求，setTimeout，setInterval，文件操作，new Promise 等</p>
<p>微任务：Promise.then、.catch、.finally，process.nextTick 等</p>
<p><em><mark>宏任务与微任务是交替执行的，每次执行完宏任务都会检查是否有微任务</mark></em></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>答案：1、3、5、4、2</p>
<p>解析：</p>
<p>主线程判断是同步代码还是异步代码</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// 同步任务</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 异步任务：宏任务</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 同步任务</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 异步任务：微任务</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">// 同步任务</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>注意构造 Promise 实例化对象里面的那个参数函数里面的代码是同步的！就跟正常的 new 一个实例化对象一样，只不过传的是一个函数作为参数</p>
<p><mark><strong>真正是异步任务 (微任务) 的是对于这个 Promise 对象调用 then 方法，这个是回调函数，只有在这个 Promise 对象执行完 resolve 或 reject 之后，这个 then 方法也就是说需要等，js 引擎一看这个要等就把他交给宿主环境来执行 then 方法，然后 then 方法里面的回调函数会在接收到 Promise 对象的 resolve 或 reject 之后才会执行</strong></mark></p>
</blockquote>
<p>执行同步任务</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// 同步任务</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// 同步任务</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment">// 同步任务</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>执行异步任务：微任务</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">// 异步任务：微任务</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>执行异步任务：宏任务</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 异步任务：宏任务</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<hr>
<h2 id="2-事件循环同步异步微任务宏任务"><a class="markdownIt-Anchor" href="#2-事件循环同步异步微任务宏任务">#</a> 2. 事件循环，同步异步，微任务宏任务</h2>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
  process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'6'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'7'</span><span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'9'</span><span class="token punctuation">)</span>
  process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'10'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>分析：</p>
<p>第一遍：</p>
<ol>
<li>首先执行第一行的同步任务，打印 1</li>
<li>第三行的 setTimeout 是异步任务中宏任务，加入宏任务记为 setTimeout1</li>
<li><em>下面第 15 行 Promise.then 是异步任务中的微任务，加入微任务记为 then</em></li>
<li><em>第 18 行 new Promise 是同步任务，执行第一个 log 直接打印 7，后面的 .then 是微任务，存入微任务中记为 then1</em></li>
<li><em>第 25 行 setTimeout 是异步任务中宏任务，加入宏任务记为 setTimeout2</em></li>
</ol>
<p><em>此时整个程序状态如下：</em></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1948650/202110/1948650-20211006103822089-2001243705.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1948650-20211006103822089-2001243705.png" alt="img"></a></p>
<p>第二遍：</p>
<ol>
<li>首先执行微任务区中的任务，then 打印 6，then1 打印 8</li>
<li>微任务区任务执行完成，再执行宏任务区 setTimeout1 ，打印 2，将第 5 行 process 微任务放入微任务区记作 process2</li>
<li>第 8 行 new Promise 为同步任务，立即执行打印 4，将后续 .then 微任务 放入微任务区记作 then2</li>
</ol>
<p><em>此时整个程序状态如下：</em></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1948650/202110/1948650-20211006102509257-1623746701.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img2020.cnblogs.com/blog/1948650/202110/1948650-20211006102509257-1623746701.png" alt="img"></a></p>
<p>第三遍：</p>
<ol>
<li>首先执行微任务区，process2，打印 3，再执行 then2，打印 5</li>
<li>微任务区执行完成，再去执行宏任务区中的 setTimeout2，首先是第 26 行 log 直接打印 9</li>
<li>将第 27 行 process 微任务放入微任务区记作 process3</li>
<li><em>第 30 行 new Promise 为同步任务，立即执行打印 11，将后续 .then 微任务 放入微任务区记作 then3</em></li>
</ol>
<p><strong>此时整个程序状态如下：</strong></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/1948650/202110/1948650-20211006102909991-1459883909.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1948650-20211006102909991-1459883909.png" alt="img"></a></p>
<p>最后一遍：</p>
<ol>
<li>执行微任务区 process3，打印 10</li>
<li>执行微任务区 then3，打印 12</li>
</ol>
<p>最终打印结果：1，7，6，8，2，4，3，5，9，11，10，12</p>
<hr>
<h2 id="3-asyncawait异步等执行顺序"><a class="markdownIt-Anchor" href="#3-asyncawait异步等执行顺序">#</a> 3. async,await, 异步等执行顺序</h2>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122142916499.png" alt="image-20220122142916499"></p>
<ol>
<li>首先，事件循环从宏任务 (macrotask) 队列开始，这个时候，宏任务队列中，只有一个 script (整体代码) 任务；当遇到任务源 (task source) 时，则会先分发任务到对应的任务队列中去。所以，上面例子的第一步执行如下图所示：</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122142936569.png" alt="image-20220122142936569"></p>
<ol start="2">
<li>然后我们看到首先定义了两个 async 函数，接着往下看，然后遇到了 console 语句，直接输出 script start。输出之后，script 任务继续往下执行，遇到 setTimeout，其作为一个宏任务源，则会先将其任务分发到对应的队列中：</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122142944781.png" alt="image-20220122142944781"></p>
<ol start="3">
<li>script 任务继续往下执行，执行了 async1 () 函数，前面讲过 async 函数中在 await 之前的代码是立即执行的，所以会立即输出 async1 start。 遇到了 await 时，会将 await 后面的表达式执行一遍，所以就紧接着输出 async2，然后将 await 后面的代码也就是 console.log (‘async1 end’) 加入到 microtask 中的 Promise 队列中，接着跳出 async1 函数来执行后面的代码。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122143025887.png" alt="image-20220122143025887"></p>
<ol start="4">
<li>script 任务继续往下执行，遇到 Promise 实例。由于 Promise 中的函数是立即执行的，而后续的 .then 则会被分发到 microtask 的 Promise 队列中去。所以会先输出 promise1，然后执行 resolve，将 promise2 分配到对应队列。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122143037221.png" alt="image-20220122143037221"></p>
<ol start="5">
<li>
<p>script 任务继续往下执行，最后只有一句输出了 script end，至此，全局任务就执行完毕了。 根据上述，每次执行完一个宏任务之后，会去检查是否存在 Microtasks；如果有，则执行 Microtasks 直至清空 Microtask Queue。 因而在 script 任务执行完毕之后，开始查找清空微任务队列。此时，微任务中， Promise 队列有的两个任务 async1 end 和 promise2，因此按先后顺序输出 async1 end，promise2。当所有的 Microtasks 执行完毕之后，表示第一轮的循环就结束了。</p>
</li>
<li>
<p>第二轮循环依旧从宏任务队列开始。此时宏任务中只有一个 setTimeout，取出直接输出即可，至此整个流程结束。</p>
</li>
</ol>
<p><strong>变式一</strong></p>
<p>在第一个变式中我将 async2 中的函数也变成了 Promise 函数，代码如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise4'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行结果入下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122143124377.png" alt="image-20220122143124377"></p>
<p>在第一次 macrotask 执行完之后，也就是输出 script end 之后，会去清理所有 microtask。所以会相继输出 promise2， async1 end ，promise4，其余不再多说。</p>
<p><strong>变式二</strong></p>
<p>在第二个变式中，我将 async1 中 await 后面的代码和 async2 的代码都改为异步的，代码如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout3'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行结果如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220122143116223.png" alt="image-20220122143116223"></p>
<p>在输出为 promise2 之后，接下来会按照加入 setTimeout 队列的顺序来依次输出，通过代码我们可以看到加入顺序为 3 2 1，所以会按 3，2，1 的顺序来输出。</p>
<p>只要前面的原理看懂了，任何的变式题都不会有问题。</p>
<hr>
<h2 id="4-try-catch能不能catch到reject状态的promise以及其他重要的"><a class="markdownIt-Anchor" href="#4-try-catch能不能catch到reject状态的promise以及其他重要的">#</a> 4. try catch 能不能 catch 到 reject 状态的 promise 以及其他重要的</h2>
<blockquote>
<p>之前有这样的疑问，不是说 try catch 能捕获错误吗？对于 promise.reject () 的怎么不行？<br>
 既然不行，为啥 await 又与 try catch 一起用？<br>
try catch 在什么时候才会生效<br>
啥时候用 try catch 捕获错误</p>
</blockquote>
<p>结论:</p>
<blockquote>
<ol>
<li>try catch 不能捕获异步代码，所以不能捕获 promise.reject () 的错误，并且 promise 期约故意将异步行为封装起来，从而隔离外部的同步代码</li>
<li>try catch 能对 promise 的 reject () 落定状态的结果进行捕获</li>
<li>try catch 能捕捉到的异常，必须是 <code>主线程执行</code> 已经进入 try catch, 但 try catch 尚未执行完的时候抛出来的，</li>
</ol>
<p>意思是如果将执行 try catch 分为前中后。只有中才能捕获到异常</p>
<ol start="4">
<li>应该只在确切知道接下来该做什么的时候捕获错误 (这里我单指 try catch)</li>
</ol>
</blockquote>
<h5 id="总结这篇真的非常细一步一步带着走大概花了一周时间吧所以真的值得一看喜欢的话就收藏吧我也会继续努力的冲呀"><a class="markdownIt-Anchor" href="#总结这篇真的非常细一步一步带着走大概花了一周时间吧所以真的值得一看喜欢的话就收藏吧我也会继续努力的冲呀">#</a> 总结这篇，真的非常细，一步一步带着走，大概花了一周时间吧，所以真的值得一看，喜欢的话就收藏吧，我也会继续努力的！！！冲呀</h5>
<h3 id="一-为什么要捕获错误处理错误"><a class="markdownIt-Anchor" href="#一-为什么要捕获错误处理错误">#</a> 一 为什么要捕获错误，处理错误</h3>
<p>默认情况下，所有浏览器都会隐藏错误信息。一个原因是除了开发者之外这些信息对别人没什么用，另一个原因是网页在正常操作中报错的固有特性。</p>
<p>当网页中的 JavaScript 脚本发生错误时，不同浏览器的处理方式不同，而且也只会在浏览器输出，有一个良好的错误处理策略可以让用户知道到底发生了什么，防止用户流失。为此，必须理解各种捕获和处理 JavaScript 错误的方式</p>
<h3 id="二-错误一般出现在哪里"><a class="markdownIt-Anchor" href="#二-错误一般出现在哪里">#</a> 二 错误一般出现在哪里</h3>
<p>pc 端：所有现代桌面浏览器都会通过控制台暴露错，也就是 pc 端能够在控制台去捕获错误</p>
<p>移动端：移动浏览器不会直接在设备上提供控制台界面。不过，还是有一些途径可以在移动设备中检查错 — 这里我推荐 vconsole 包</p>
<p>具体怎么用？看我这篇文章: <a target="_blank" rel="noopener" href="https://juejin.cn/post/6922416050545901582">juejin.cn/post/692241…</a> 为了防止你们这些臭屁的流失，我先上个图</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/02ee07e6c66b45a780774b3abc69c062%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<h3 id="三-错误捕获处理的方式try-catch基本介绍"><a class="markdownIt-Anchor" href="#三-错误捕获处理的方式try-catch基本介绍">#</a> 三 错误捕获处理的方式 try catch 基本介绍</h3>
<h4 id="31try-catch的出现处理异常的方法之一"><a class="markdownIt-Anchor" href="#31try-catch的出现处理异常的方法之一">#</a> 3.1.try catch 的出现，处理异常的方法之一</h4>
<p>任何可能出错的代码都应该放到 try 块中，而处理错误的代码则放在 catch 块中</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 可能出错的代码</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token comment">// 出错时要做什么</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="32-try-或-catch-块无法阻止-finally-块执行"><a class="markdownIt-Anchor" href="#32-try-或-catch-块无法阻止-finally-块执行">#</a> 3.2 try 或 catch 块无法阻止 finally 块执行</h4>
<p>3.2.1 调用了 window 没有的方法，必然报错，走 catch, 这时候 finanlly 有返回</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
   window<span class="token punctuation">.</span><span class="token function">someNonexistentFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'catch'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035022670.png" alt="image-20220125035022670"></p>
<p>3.2.2 没有报错，这时候 finanlly 有返回</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'catch'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'finally'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035027850.png" alt="image-20220125035027850"></p>
<p>3.2.3 那么对于 finally 我们能用他做啥呢？</p>
<blockquote>
<p>1. 例如 loading 的取消，不管我报错没，最后这个 loading 必须是要取消的<br>
 2. 比如做一些清除，销毁的操作</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035042562.png" alt="image-20220125035042562"></p>
<h4 id="33-return-语句无法阻止finally的执行"><a class="markdownIt-Anchor" href="#33-return-语句无法阻止finally的执行">#</a> 3.3 return 语句无法阻止 finally 的执行</h4>
<p>遇到 return 一般是出栈，出去这个函数，但是这里的 finally 仍然会执行</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">testFinally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
   <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
     <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
 <span class="token punctuation">&#125;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">testFinally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035126174.png" alt="image-20220125035126174"></p>
<h3 id="四-try-catch是如何捕获错误的什么时候才能捕获到错误-非常重要"><a class="markdownIt-Anchor" href="#四-try-catch是如何捕获错误的什么时候才能捕获到错误-非常重要">#</a> 四 try catch 是如何捕获错误的？什么时候才能捕获到错误 ( <code>非常重要</code> )</h3>
<p>try catch 能捕捉到的异常，必须是 <code>主线程执行</code> 已经进入 try catch, 但 try catch 尚未执行完的时候抛出来的，意思是如果将执行 try catch 分为前中后。只有中才能捕获到异常</p>
<h4 id="41-try-catch-之前-捕获不到的"><a class="markdownIt-Anchor" href="#41-try-catch-之前-捕获不到的">#</a> 4.1 try catch 之前 ( <code>捕获不到的</code> )</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035135534.png" alt="image-20220125035135534"></p>
<p>发现了没？连 6666 都没有打印，比如语法异常（syntaxError），因为语法异常是在语法检查阶段就报错了，线程执行尚未进入 try catch 代码块，自然就无法捕获到异常</p>
<h4 id="42-try-catch进行之中能捕获到"><a class="markdownIt-Anchor" href="#42-try-catch进行之中能捕获到">#</a> 4.2 try catch 进行之中 ( <code>能捕获到</code> )</h4>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
  window<span class="token punctuation">.</span><span class="token function">someNonexistentFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我要执行'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035300416.png" alt="image-20220125035300416"></p>
<p>这时候就能捕获到了</p>
<h4 id="43-try-catch进行之中重点不能捕获到"><a class="markdownIt-Anchor" href="#43-try-catch进行之中重点不能捕获到">#</a> 4.3 try catch 进行之中 ( <code>重点:不能捕获到</code> )</h4>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try里面'</span><span class="token punctuation">)</span>
     <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'try里面的setTimeOut'</span><span class="token punctuation">)</span>
       window<span class="token punctuation">.</span><span class="token function">someNonexistentFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 变成了未捕获的错误</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我要执行'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/b0c803d77dcf4342915370a3b72117d9%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p><code>这里没有catch到错误,是因为try catch是同步代码</code>  (一般我们用 setTimeOut 来模拟异步，也是因为他有延迟的特性，所以我们这里视为有异步操作)</p>
<blockquote>
<p>当 js 运行到 try 里面 setTimeOut 的时候，setTimeOut 先是去了 setTimeOut 线程，0 秒后去 task queue (任务队列) 进行排队，运行到 try catch 外面的 setTimeOut, 第二个 setTimeOut 也是先去 setTimeOut 线程，100/1000 秒然后去 task queue 排队，排在第一个后面<br>
那么执行的顺序就是 try catch 同步代码在主执行栈执行完了之后，去 task queue 看看有啥要执行的没，task queue 里面是遵循先进先出的原则，自然按照图片上的顺序进行</p>
</blockquote>
<p>这个例子也是说明了为啥 try catch 不能捕获到 promise.resolve 报错的一个原因</p>
<p>这里涉及到 eventloop, 下次补充</p>
<h4 id="44-promise的异常捕获"><a class="markdownIt-Anchor" href="#44-promise的异常捕获">#</a> 4.4 Promise 的异常捕获</h4>
<blockquote>
<p>如果不设置回调函数，Promise 内部抛出的错误，不会反应到外部。</p>
</blockquote>
<p>捕获 Promise 内部错误的两种方式以及 reject 回调后的错误捕获的一种方式</p>
<blockquote>
<ol>
<li>Promise.prototype.then () reject 回调函数</li>
<li>Promise.prototype.catch()</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li>结合 async/await 和 try…catch</li>
</ol>
</blockquote>
<p>4.4.1 Promise.prototype.then () 捕获 -- reject 回调函数</p>
<p>特点:</p>
<pre class="line-numbers language-none"><code class="language-none">1.无法捕获resolve()回调中出现的异常，需要无限链式调用then回调去捕获异常
2.无法中断后续的then操作
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>案例1</code>  能够在第二个 reject 回调中捕获到，如果又有报错，能在下一个 then 里面的 reject 回调捕获到</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'reject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'reject1'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">res</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'reject2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035415300.png" alt="image-20220125035415300"></p>
<p><code>案例2</code>  如果已经是 resove 的回调了，中间有报错，也能够在下一个 then 里面的 reject 回调能捕获到</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token comment">// 结果1</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   window<span class="token punctuation">.</span><span class="token function">someNonexistentFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'reject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">res</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'reject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>案例3</code>  能够在 reject 的回调函数里面去使用 try catch, 因为这里面就是同步代码，但是不用直接去捕获 Promise.reject ()</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'reject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
    window<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">res</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'reject2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035500912.png" alt="image-20220125035500912"></p>
<p>4.4.2 Promise.prototype.catch () 捕获异常</p>
<p>特点:</p>
<blockquote>
<p>因为 Promise 对象的错误具有 “冒泡” 性质，会一直向后传递，直到被捕获为止。也就是说，错误总是会被下一个 catch 语句捕获。</p>
<p>catch () 方法返回的还是一个 Promise 对象，因此后面还可以接着调用 then () 方法。</p>
</blockquote>
<p>记住一点:  <code>Promise.prototype.catch()</code>  方法用于给期约添加拒绝处理程序，这个方法只接收一个参数：onRejected 处理程序。事实上，这个方法就是一个语法糖，调用它就相当于调用  <code>Promise.prototype.then(null, onRejected)</code></p>
<p>下面这两个是相等的:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token comment">// 这两种添加拒绝处理程序的方式是一样的：</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rejected</span>
p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// rejected</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>案例1</code>  冒泡性质的抛错</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'reject'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/373e4225a6004b82ad31059a10edeaec%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p><code>案例2</code>  catch 也同 reject 回调一致，具有捕获错误的冒泡性质，只要有报错，不管经过创建多少个新的 promise, 后面仍然能捕获到</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'catch reject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/117d9f8125be4abca9a2d3fa612b7b6a%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p><code>案例3</code>  catch 到了错误，又是一个新的 promise,cath 回调里面没有报错，下一个 then 还是走 resolved 的回调</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolved1'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolved2'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'catche reject'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolved3'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035547635.png" alt="image-20220125035547635"></p>
<p>4.4.3 async/await 结合 try…catch 使用</p>
<p>什么是 async 函数？</p>
<blockquote>
<ol>
<li>async 函数完全可以看作多个异步操作，包装成的一个 Promise 对象，而 await 命令就是内部 then 命令的语法糖。</li>
<li>async 函数返回一个 Promise 对象，可以使用 then 方法添加回调函数。当函数执行的时候，一旦遇到 await 就会先返回，</li>
</ol>
<p>等到异步操作完成，再接着执行函数体内后面的语句。</p>
<p>什么是 await 命令？有那些特点</p>
</blockquote>
<blockquote>
<ol>
<li>await 只能在异步函数 async function 中使用。</li>
<li>await 表达式会暂停当前 async function 的执行，等待 Promise 处理完成。若 Promise 正常处理 (fulfilled)，<br>
其回调的 resolve 函数参数作为 await 表达式的值，继续执行 async function。</li>
<li>若 Promise 处理异常 (rejected)，await 表达式会把 Promise 的异常原因抛出。</li>
<li>await 如果返回的是 reject 状态的 promise，如果不被捕获抛出，就会中断 async 函数的执行。</li>
<li>另外，如果 await 操作符后的表达式的值不是一个 Promise，则返回该值本身。</li>
<li>async await 函数中，通常使用 try/catch 块来捕获错误。<br>
用大白话来说 await 之后的返回值就是 resolve 和 reject 回调的结果</li>
</ol>
</blockquote>
<p><code>案例1</code>  await 已经返回了 reject () 之后 reject 回调的结果，但是拿到结果并没有进行任何的操作  <code>这时候你发现了没,下面吗的console.log(res, 'await result');已经不执行了,</code>  对于调用一个请求，失败了，就要中断我们所有的代码执行，显然不是我们想要的结果，那么如何让调用接口失败，我们仍然可以继续操作呢？</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我反正进来了'</span><span class="token punctuation">)</span>
     <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> createPromise
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'await result'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/8ee2600cebb04defbab4183e4fdbefd6%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p><code>案例2</code>  对结果进行 try catch</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我反正进来了'</span><span class="token punctuation">)</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> createPromise
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'await调用报错咯!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'可以让我执行一下吗?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/a15aecc692424e71b7a5f279760ee0e9%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p><code>有没有想过一个问题? 虽然说await会返回reject回调里面的结果,或者是resolve回调里面的结果,那我try catch怎么就知道返回的东西是要报错的呢? 为啥reject返回的我就要报错呢?</code>  这里我又发现了一个好东西:</p>
<p>当 promise 函数里面调用 reject () 来落定拒绝契约的时候，实际上以下三个等价</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>等价于</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>那么 try catch 肯定能捕获到 throw new Error 的错误拉～请看来自 es6 的解释</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035821792.png" alt="image-20220125035821792"></p>
<p><code>案例3 </code> reject (new Error ()) 与 throw new Error (‘我是个错误，没有 reject ()’) 在什么情况下等价</p>
<pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">const createPromise &#x3D; new Promise((resove, reject) &#x3D;&gt; &#123; reject(new Error()) &#125;)

 createPromise.then((res) &#x3D;&gt; &#123; 
     console.log(res, &#39;resolved&#39;); &#125;
 ).catch(res &#x3D;&gt; &#123; console.log(res, &#39;catch&#39;); &#125;)


const createPromise &#x3D; new Promise((resove, reject) &#x3D;&gt; &#123; reject(new Error()) &#125;)

 createPromise.then((res) &#x3D;&gt; &#123; 
     throw new Error(&#39;我是个错误,没有reject()&#39;)&#125;
 ).catch(res &#x3D;&gt; &#123; console.log(res, &#39;catch&#39;); &#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035833329.png" alt="image-20220125035833329"></p>
<p>以上两种情况都是能够通过 Promise.catch () 捕获到错误的，也就是对应 es6 上面说的相等的情况，但是这里有个前提，是在 new Promise 里面没有异步的情况下.</p>
<p>那么为什么 throw new Error (‘我是个错误，没有 reject ()’) 与 reject (new Error ()) 相等？</p>
<p>源码解析:<a href="https://link.juejin.cn?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000014368256">segmentfault.com/a/119000001…</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/01e1c063478e49fabc8ad004522c62e9%7Etplv-k3u1fbpfcp-watermark.awebp" alt="1630242265(1).png"></p>
<p>源码中，会对传入的函数进行 try catch. 如果是 throw new Error (‘我是个错误，没有 reject ()’) 必定会被 catch 到错误，这里时候 catch 里面自动调用了 reject (). 也就是直接调用了拒绝的落定，而上面说过了 try,catch 里面的 catch 是不能 catch 到 setTimeOut 里面的错误的</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span>
<span class="token punctuation">&#123;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'catch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035857073.png" alt="image-20220125035857073"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span> 
 <span class="token punctuation">&#123;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'我是个错误,没有reject()'</span><span class="token punctuation">)</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

createPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'resolved'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'catch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/3245691d31924a4abf20fd8aa7afba90%7Etplv-k3u1fbpfcp-watermark.awebp" alt="1630242490(1).png"></p>
<p>为什么上面的有异步的 reject () 能捕获到，throw new Error (‘我是个错误，没有 reject ()’) 却不能 promise.catch () 到呢</p>
<p>上面提到了，源码中的第一个 try catch 是捕获不到 setTimeOut 的，里面有_state 四个状态</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">_state <span class="token operator">===</span> <span class="token number">0</span> <span class="token comment">// pending </span>
state <span class="token operator">===</span> <span class="token number">1</span> <span class="token comment">// fulfilled,执行了resolve函数，并且_value instanceof Promise === true</span>
_state <span class="token operator">===</span> <span class="token number">2</span> <span class="token comment">// rejected,执行了reject函数 </span>
_state <span class="token operator">===</span> <span class="token number">3</span> <span class="token comment">// fulfilled,执行了resolve函数，并且_value instanceof Promise === false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果没有调用 resolve 函数或者 reject 函数。始终是_state === 0 的 penging 状态。没有 setTimeOut 的时候是 try catch 到了 throw new Error () 做了自动的 reject (), 而如果有 setTimeOut 第一个 try catch 已经对里面的 setTimeOut 起不了作用了，所以_state 一直是等于 0, 而源码里面针对 new Promise 做了处理:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035923182.png" alt="image-20220125035923182"></p>
<p>也就说是 存在 setTimeOut, 会出现一个等待 reject () 或者 resolve () 调用的 pending 状态，如果里面没有出现一直处于 pending 状态，也就不能被 promise.catch () 到</p>
<p>这里最重要的要理解，try catch 是不可能 catch 到异步的，try catch 与 promise.catch () 是不一样的，如果 promise.catch () 不到错误，应该去看看 promise 源码对 promise.catch ()(即 Promise.prototype.then (null, onRejected)) 内部是如何实现的</p>
<p>源码必定都是遵循 js 事件轮询机制的！</p>
<p><code>案例4</code>  同上，await 都拿不到结果，那就更加别提能用 try catch 能捕获了，await 表示的是落定状态 (fulfilled) 返回的结果</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'我是个错误,但是我并不想落定状态,没有reject()'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
 <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'测试1'</span><span class="token punctuation">)</span>
     <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> createPromise <span class="token comment">// 调用的时候内部已经中止了,也不是settled的状态,所以没法去返回结果,那就更不可能进行到赋值给res的操作了</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'测试2'</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'await调用报错咯!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span> 
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'可以让我执行一下吗?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
 <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/12519da00f1c448eb33988b16c0d3ead%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p><code>案例5</code>  try catch 面对多个 await 捕获的问题</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> createPromise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> createPromise3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功3'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">await</span> createPromise1
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'不执行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> createPromise2
      <span class="token keyword">await</span> createPromise3
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'await调用报错咯!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1可以让我执行一下吗?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2可以让我执行一下吗?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125035949472.png" alt="image-20220125035949472"></p>
<p>结果就是多个 await 有几个报错，她只会 catch 到第一个，走了 catch, 但是仍然可以继续运行</p>
<p>但是 <code>我们依旧推荐多个awiat的东西如果没有关联性,考虑到并发性,可以直接用promise.all</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> createPromise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> createPromise2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'失败2'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> createPromise3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'成功3'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>createPromise1<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
    createPromise2<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> e<span class="token punctuation">)</span><span class="token punctuation">,</span> createPromise3<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> e<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">'list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1可以让我执行一下吗?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">awaitTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2可以让我执行一下吗?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/7fcdf64ace714c67851059af6ea6fee1%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<h4 id="45-try-catch不能捕获到promiseresolve的报错"><a class="markdownIt-Anchor" href="#45-try-catch不能捕获到promiseresolve的报错">#</a> 4.5 try catch 不能捕获到 promise.resolve () 的报错</h4>
<p>上面有提到，try catch 如果分为在主线程的执行的前中后，那么只有中才能捕获到错误，其实 4.3 的例子已经很明显了 (4.4 主要还是想大家普及一下 promise 捕获错误的知识) 但是这边还是再讲解一下</p>
<p>我们先看看 js 高级程序设计第 11 章 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/b7f2ec6fe9e44fa49b6532b164afb917%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p>4.5.1 try catch 捕获 throw new Error 这个没有问题</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span> 
   <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'catch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125040018874.png" alt="image-20220125040018874"></p>
<p>4.5.2 try catch 捕获不到 Promise.reject ()</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span> 
   Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'catch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/4b5a0f1ed26443b5b4b6cb923a21de4e%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p>首先你要知道，下面这两个契约实例其实是一样的</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>因为 p1,p2 是异步执行模式，而 try catch 是同步代码，同步代码先执行，异步去 task queue 排队，等同步做完再执行，而你能够在 then 的回调里面进行 try catch 或者 await 的返回数，只是对返回结果进行捕获而已，并捕获不了 promise 的异步代码</p>
<p>你可以将 p1,p2 看成在请求，请求成功我就写告诉用户已经成功了，用 resolve () 告诉大家，只有在 then 接受到，我可以对 then 里面的结果进行 try catch</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/6412fa184a054ea99ca6495dc5888562%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<h3 id="五-try-catch啥时候用以及如何抛错"><a class="markdownIt-Anchor" href="#五-try-catch啥时候用以及如何抛错">#</a> 五 try catch 啥时候用，以及如何抛错</h3>
<h5 id="51-throw-new-error"><a class="markdownIt-Anchor" href="#51-throw-new-error">#</a> 5.1 throw new Error()</h5>
<p>与 try/catch 语句对应的一个机制是 throw 操作符，用于在任何时候抛出自定义错误。throw 操作符必须有一个值，但值的类型不限。 使用 throw 操作符时，代码立即停止执行，除非 try/catch 语句捕获了抛出的值</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span> 
  window<span class="token punctuation">.</span><span class="token function">someNonexistentFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'报错了'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我要执行'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125040038688.png" alt="image-20220125040038688"></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span> 
     window<span class="token punctuation">.</span><span class="token function">someNonexistentFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
     <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'报错了'</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我要执行'</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#125;</span> 
   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/a5c3ac22a4ca4ff78e594bfaad1fd6c1%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<h4 id="52-应该仔细评估每个函数以及可能导致它们失败的情形-良好的错误处理协议可以保证只会发生你自己抛出的错误"><a class="markdownIt-Anchor" href="#52-应该仔细评估每个函数以及可能导致它们失败的情形-良好的错误处理协议可以保证只会发生你自己抛出的错误">#</a> 5.2 应该仔细评估每个函数，以及可能导致它们失败的情形。良好的错误处理协议可以保证只会发生你自己抛出的错误。</h4>
<p>比如平时 utils 里面，如果传入的参数不是规定的，可以直接通过 if 判断类型，然后抛错 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220125040051137.png" alt="image-20220125040051137"></p>
<p>至于抛出错误与捕获错误的区别，可以这样想： <code>应该只在确切知道接下来该做什么的时候捕获错误</code> 。捕获错误的目的是阻止浏览器以其默认方式响应； <code>抛出错误的目的是为错误提供有关其发生原因的</code></p>
<h4 id="53-通过继承自定义错误类型与提示"><a class="markdownIt-Anchor" href="#53-通过继承自定义错误类型与提示">#</a> 5.3 通过继承自定义错误类型，与提示</h4>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">CustomError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"CustomError"</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CustomError</span><span class="token punctuation">(</span><span class="token string">"My message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="六-有哪些错误类型"><a class="markdownIt-Anchor" href="#六-有哪些错误类型">#</a> 六 有哪些错误类型</h3>
<blockquote>
<p>1 Error<br>
2 InternalError<br>
3 EvalError<br>
4 RangeError<br>
5 ReferenceError<br>
6 SyntaxError<br>
7 TypeError<br>
8 URIError</p>
</blockquote>
<ol>
<li>
<p>Error 是基类型，其他错误类型继承该类型。因此，所有错误类型都共享相同的属性，浏览器很少会抛出 Error 类型的错误，该类型主要用于开发者抛出自定义错误</p>
</li>
<li>
<p>InternalError 该错误在 JS 引擎内部发生，特别是当它有太多数据要处理并且堆栈增长超过其关键限制时。示例场景通常为某些成分过大</p>
</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">该错误在<span class="token constant">JS</span>引擎内部发生，特别是当它有太多数据要处理并且堆栈增长超过其关键限制时。
示例场景通常为某些成分过大，例如：
“too many <span class="token keyword">switch</span> cases”（过多<span class="token keyword">case</span>子句）；
“too many parentheses <span class="token keyword">in</span> regular expression”（正则表达式中括号过多）；
“array initializer too large”（数组初始化器过大）；
“too much recursion”（递归过深）。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>EvalError 类型的错误会在使用 eval () 函数发生异常时抛出，如果非法调用 eval ()，则抛出 EvalError 异常</li>
<li>RangeError 错误会在数值越界时抛出</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">)</span>  <span class="token comment">// 异常的捕获.html:52 Uncaught RangeError: Invalid array length</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> num<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异常的捕获.html:53 Uncaught RangeError: toFixed() digits argument must be between 0 and 100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>5. ReferenceError 会在找不到对象时发生</code> 。（这就是著名的 “object expected” 浏览器错误的原因。）这种错误经常是由访问不存在的变量而导致的</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>  <span class="token comment">//异常的捕获.html:56 Uncaught ReferenceError: num is not defined</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="6">
<li>TypeError 在 JavaScript 中很常见，主要发生在变量不是预期类型，或者访问不存在的方法时</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">10</span><span class="token punctuation">;</span> <span class="token comment">// 抛出 TypeError</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"name"</span> <span class="token keyword">in</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抛出 TypeError</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 抛出 TypeError</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol start="7">
<li>URIError，只会在使用 encodeURI () 或 decodeURI () 但传入了格式错误的 URI 时发生</li>
</ol>
<h3 id="七-错误识别"><a class="markdownIt-Anchor" href="#七-错误识别">#</a> 七 错误识别</h3>
<blockquote>
<p>错误处理非常重要的部分是首先识别错误可能会在代码中的什么地方发生<br>
 类型转换错误<br>
 数据类型错误<br>
 通信错误</p>
<ol>
<li>使用 = = = ，而不使用 = =</li>
<li>if 判断的条件，尽量避免类型转换</li>
<li>通信错误，主要是 url 传参 (主要错误是 URL 格式或发送数据的格式不正确，在把数据发送到服务器之前没有用，encodeURIComponent () 编码))<br>
 封装 url 传参</li>
</ol>
</blockquote>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">addQueryStringArg</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        url <span class="token operator">+=</span> <span class="token string">"?"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        url <span class="token operator">+=</span> <span class="token string">"&amp;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    url <span class="token operator">+=</span> <span class="token string">'$&#123;encodeURIComponent(name)=$&#123;encodeURIComponent(value)&#125;'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> url<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"http://www.somedomain.com"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newUrl <span class="token operator">=</span> <span class="token function">addQueryStringArg</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">"redir"</span><span class="token punctuation">,</span><span class="token string">"http://www.someotherdomain.com?a=b&amp;c=d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newUrl<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="八-区分重大与非重大错误"><a class="markdownIt-Anchor" href="#八-区分重大与非重大错误">#</a> 八 区分重大与非重大错误、</h3>
<p>非重大错误和重大错误的区别主要体现在对用户的影响上</p>
<blockquote>
<p>非重大错误<br>
 不会影响用户的主要任务；<br>
 只会影响页面中某个部分；<br>
 可以恢复；<br>
 重复操作可能成功。</p>
</blockquote>
<blockquote>
<p>重大错误<br>
 应用程序绝对无法继续运行；<br>
 错误严重影响了用户的主要目标；<br>
 会导致其他错误发生。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> mod <span class="token keyword">of</span> mods<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
   mod<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可能的重大错误</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>可以使用</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> mod <span class="token keyword">of</span> mods<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
        mod<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// 在这里处理错误</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以封装方法来区分重大错误和非重大错误</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">logError</span><span class="token punctuation">(</span><span class="token parameter">sev<span class="token punctuation">,</span> msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   encodedSev <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>sev<span class="token punctuation">)</span><span class="token punctuation">,</span>
   encodedMsg <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
   img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'log.php?sev=$&#123;encodedSev&#125;&amp;msg=$&#123;encodedMsg&#125;'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>logError () 函数接收两个参数：严重程度和错误消息。严重程度可以是数值或字符串，具体取决于使用的日志系统。这里使用 Image 对象发送请求主要是从灵活性方面考虑的</p>
<h3 id="九-调试技术"><a class="markdownIt-Anchor" href="#九-调试技术">#</a> 九 调试技术</h3>
<p>所有主流浏览器都有 JavaScript 控制台，该控制台可用于查询 JavaScript 错误。另外，这些浏览器都支持通过 console 对象直接把 JavaScript 消息写入控制台</p>
<h4 id="91-debugger-关键字"><a class="markdownIt-Anchor" href="#91-debugger-关键字">#</a> 9.1 debugger 关键字</h4>
<p>推荐: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fxiaoqi2018%2Fp%2F10832069.html">www.cnblogs.com/xiaoqi2018/…</a></p>
<h4 id="92-在页面中打印消息"><a class="markdownIt-Anchor" href="#92-在页面中打印消息">#</a> 9.2 在页面中打印消息</h4>
<p>平时我们看信息，有时候会在 template 里面去打印</p>
<h4 id="93-根据需求封装consolelog"><a class="markdownIt-Anchor" href="#93-根据需求封装consolelog">#</a> 9.3 根据需求封装 console.log ()</h4>
<p>例如，平时我们要在浏览器上打印很多对象，但是每次都要去一级一级打开，可以去重写全局 console.log (这里我没有做类型判断哦)</p>
<p>重写前:</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>data<span class="token operator">:</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1520941fcbd64a06a494ae41f4644d9b~tplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<p>重写后</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> consoleog <span class="token operator">=</span> window<span class="token punctuation">.</span>console<span class="token punctuation">.</span>log
console<span class="token punctuation">.</span><span class="token function-variable function">log</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span>
  <span class="token function">consoleog</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>data<span class="token operator">:</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/760951e1c13946debd301d95b5682aa1%7Etplv-k3u1fbpfcp-watermark.awebp" alt="img"></p>
<h3 id="十-抛出错误"><a class="markdownIt-Anchor" href="#十-抛出错误">#</a> 十 抛出错误</h3>
<p>抛出错误是调试代码的很好方式。如果错误消息足够具体，只要看一眼错误就可以确定原因。好的错误消息包含关于错误原因的确切信息，因此可以减少额外调试的工作量</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> num1 <span class="token operator">!=</span> <span class="token string">"number"</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> num2 <span class="token operator">!=</span> <span class="token string">"number"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"divide(): Both arguments must be numbers."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> num1 <span class="token operator">/</span> num2<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Harry Qu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://harryqu1229.github.io/2021/11/02/ES6-11/">https://harryqu1229.github.io/2021/11/02/ES6-11/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/frontend/">frontend</a><a class="post-meta__tags" href="/tags/javascript/">javascript</a><a class="post-meta__tags" href="/tags/es6/">es6</a></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-621848f44e1c3724" async="async"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/01/ECharts/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/mountain.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">My Echarts not</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/10/%E8%B6%85%E5%85%A8%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E6%96%87%E7%AB%A0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/car.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Javascript interview questions</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/02/20/JS%E6%A8%A1%E5%9D%97%E5%8C%96/" title="My Javascript modularity notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/cat.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-20</div><div class="title">My Javascript modularity notes</div></div></a></div><div><a href="/2022/02/25/JS%E9%9D%A2%E8%AF%95%E9%A2%98--YK%E8%8F%8C/" title="some JS Frontend Interview Quesitions"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-25</div><div class="title">some JS Frontend Interview Quesitions</div></div></a></div><div><a href="/2022/02/27/JS%20DOM,BOM,PC%E7%AB%AF%E5%AE%9E%E4%BE%8B%E7%89%B9%E6%95%88,%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8/" title="My Javascript DOM, BOM, storage etc notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/mountain2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-27</div><div class="title">My Javascript DOM, BOM, storage etc notes</div></div></a></div><div><a href="/2022/01/03/Javascript/" title="My Javascript notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/car.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-03</div><div class="title">My Javascript notes</div></div></a></div><div><a href="/2022/01/02/Javascript%E8%BF%9B%E9%98%B6(pink)/" title="My Javascript Advanced notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/sun.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-02</div><div class="title">My Javascript Advanced notes</div></div></a></div><div><a href="/2022/02/21/js,css%E7%AD%89%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/" title="css and JS Frontend Interview Quesitions"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/hello-world.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-21</div><div class="title">css and JS Frontend Interview Quesitions</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Disqus</span><span class="switch-btn"></span><span class="second-comment">Gitalk</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Harry Qu</div><div class="author-info__description">Software Engineering Student</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">158</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">57</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/HarryQu1229"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://www.linkedin.com/in/harry-qu-a0a38220a" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a><a class="social-icon" href="https://github.com/HarryQu1229" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:Harryqu666@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="weixin://dl/chat?harry666ya" target="_blank" title="Wechat"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">be healthy, stay safe</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ecmasript-6-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">1.</span> <span class="toc-text"> ECMASript 6 新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-let-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.1.</span> <span class="toc-text"> 1. let 关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%BB%A5%E5%90%8E%E5%A3%B0%E6%98%8E%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8let-%E5%B0%B1%E5%AF%B9%E4%BA%86"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 应用场景：以后声明变量使用 let 就对了</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-const-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.2.</span> <span class="toc-text"> 2. const 关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%A3%B0%E6%98%8E%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E4%BD%BF%E7%94%A8-const%E9%9D%9E%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E%E9%80%89%E6%8B%A9-let"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 应用场景：声明对象类型使用 const，非对象类型声明选择 let</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%98%E9%87%8F%E7%9A%84%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">1.3.</span> <span class="toc-text"> 3. 变量的解构赋值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E9%A2%91%E7%B9%81%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95-%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC%E5%BD%A2%E5%BC%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 应用场景：频繁使用对象方法、数组元素，就可以使用解构赋值形式。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.4.</span> <span class="toc-text"> 4. 模板字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%BD%93%E9%81%87%E5%88%B0%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8E%E5%8F%98%E9%87%8F%E6%8B%BC%E6%8E%A5%E7%9A%84%E6%83%85%E5%86%B5%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 应用场景：当遇到字符串与变量拼接的情况使用模板字符串。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%AE%80%E5%8C%96%E5%AF%B9%E8%B1%A1%E5%86%99%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text"> 5. 简化对象写法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%AF%B9%E8%B1%A1%E7%AE%80%E5%86%99%E5%BD%A2%E5%BC%8F%E7%AE%80%E5%8C%96%E4%BA%86%E4%BB%A3%E7%A0%81%E6%89%80%E4%BB%A5%E4%BB%A5%E5%90%8E%E7%94%A8%E7%AE%80%E5%86%99%E5%B0%B1%E5%AF%B9%E4%BA%86"><span class="toc-number">1.5.1.</span> <span class="toc-text"> 应用场景：对象简写形式简化了代码，所以以后用简写就对了。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.</span> <span class="toc-text"> 6. 箭头函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E9%BB%98%E8%AE%A4%E5%80%BC%E8%AE%BE%E5%AE%9A"><span class="toc-number">1.7.</span> <span class="toc-text"> 7. 函数参数默认值设定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-rest-%E5%8F%82%E6%95%B0"><span class="toc-number">1.8.</span> <span class="toc-text"> 8. rest 参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AFrest-%E5%8F%82%E6%95%B0%E9%9D%9E%E5%B8%B8%E9%80%82%E5%90%88%E4%B8%8D%E5%AE%9A%E4%B8%AA%E6%95%B0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">1.8.1.</span> <span class="toc-text"> 应用场景：rest 参数非常适合不定个数参数函数的场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-spread-%E6%89%A9%E5%B1%95%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.9.</span> <span class="toc-text"> 9. spread 扩展运算符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-symbol"><span class="toc-number">1.10.</span> <span class="toc-text"> 10. Symbol</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#101-symbol-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">1.10.1.</span> <span class="toc-text"> 10.1 Symbol 基本介绍与使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#102-%E5%AF%B9%E8%B1%A1%E6%B7%BB%E5%8A%A0-symbol-%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.10.2.</span> <span class="toc-text"> 10.2 对象添加 Symbol 类型的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#103-symbol-%E5%86%85%E7%BD%AE%E5%80%BC"><span class="toc-number">1.10.3.</span> <span class="toc-text"> 10.3 Symbol 内置值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.11.</span> <span class="toc-text"> 11. 迭代器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#111-%E5%AE%9A%E4%B9%89"><span class="toc-number">1.11.1.</span> <span class="toc-text"> 11.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#112-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.11.2.</span> <span class="toc-text"> 11.2 工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E9%9C%80%E8%A6%81%E8%87%AA%E5%AE%9A%E4%B9%89%E9%81%8D%E5%8E%86%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%E8%A6%81%E6%83%B3%E5%88%B0%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.11.3.</span> <span class="toc-text"> 应用场景：需要自定义遍历数据的时候，要想到迭代器。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#113-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%81%8D%E5%8E%86%E6%95%B0%E6%8D%AE%E7%BB%99%E8%87%AA%E5%B7%B1%E5%BB%BA%E7%9A%84%E5%AF%B9%E8%B1%A1%E6%B7%BB%E5%8A%A0iterator%E6%8E%A5%E5%8F%A3%E5%B1%9E%E6%80%A7"><span class="toc-number">1.11.4.</span> <span class="toc-text"> 11.3 自定义遍历数据 (给自己建的对象添加 Iterator 接口 (属性))</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-generator-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.12.</span> <span class="toc-text"> 12. Generator 生成器函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#121-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E7%9A%84%E5%A3%B0%E6%98%8E%E5%92%8C%E8%B0%83%E7%94%A8"><span class="toc-number">1.12.1.</span> <span class="toc-text"> 12.1 生成器函数的声明和调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#122-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="toc-number">1.12.2.</span> <span class="toc-text"> 12.2 生成器函数的参数传递</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#123-%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0%E6%A1%88%E4%BE%8B"><span class="toc-number">1.12.3.</span> <span class="toc-text"> 12.3 生成器函数案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-promise"><span class="toc-number">1.13.</span> <span class="toc-text"> 13. Promise</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#131-promise-%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">1.13.1.</span> <span class="toc-text"> 13.1 Promise 的定义和使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#132-promise-%E5%B0%81%E8%A3%85%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">1.13.2.</span> <span class="toc-text"> 13.2 Promise 封装读取文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#133-promise-%E5%B0%81%E8%A3%85-ajax-%E8%AF%B7%E6%B1%82"><span class="toc-number">1.13.3.</span> <span class="toc-text"> 13.3 Promise 封装 Ajax 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#134-promiseprototypethen-%E6%96%B9%E6%B3%95"><span class="toc-number">1.13.4.</span> <span class="toc-text"> 13.4 Promise.prototype.then 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#134-%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="toc-number">1.13.5.</span> <span class="toc-text"> 13.4 链式调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#135-%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8%E7%BB%83%E4%B9%A0-%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-number">1.13.6.</span> <span class="toc-text"> 13.5 链式调用练习 - 多个文件读取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#136-promiseprototypecatch"><span class="toc-number">1.13.7.</span> <span class="toc-text"> 13.6 Promise.prototype.catch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-reject%E5%90%8E%E7%9A%84%E4%B8%9C%E8%A5%BF%E4%B8%80%E5%AE%9A%E4%BC%9A%E8%BF%9B%E5%85%A5then%E4%B8%AD%E7%9A%84%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%9B%9E%E8%B0%83%E5%A6%82%E6%9E%9Cthen%E4%B8%AD%E6%B2%A1%E6%9C%89%E5%86%99%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%9B%9E%E8%B0%83%E5%88%99%E8%BF%9B%E5%85%A5catch"><span class="toc-number">1.13.8.</span> <span class="toc-text"> 一、reject 后的东西，一定会进入 then 中的第二个回调，如果 then 中没有写第二个回调，则进入 catch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-resolve%E7%9A%84%E4%B8%9C%E8%A5%BF%E4%B8%80%E5%AE%9A%E4%BC%9A%E8%BF%9B%E5%85%A5then%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%9B%9E%E8%B0%83%E8%82%AF%E5%AE%9A%E4%B8%8D%E4%BC%9A%E8%BF%9B%E5%85%A5catch"><span class="toc-number">1.13.9.</span> <span class="toc-text"> 二、resolve 的东西，一定会进入 then 的第一个回调，肯定不会进入 catch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-set"><span class="toc-number">1.14.</span> <span class="toc-text"> 14. Set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#141-set-%E7%9A%84%E5%AE%9A%E4%B9%89%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="toc-number">1.14.1.</span> <span class="toc-text"> 14.1 Set 的定义和使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#142-%E9%9B%86%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">1.14.2.</span> <span class="toc-text"> 14.2 集合案例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-map"><span class="toc-number">1.15.</span> <span class="toc-text"> 15. Map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-class-%E7%B1%BB"><span class="toc-number">1.16.</span> <span class="toc-text"> 16. class 类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#161-%E5%A4%8D%E4%B9%A0-es5-function-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-number">1.16.1.</span> <span class="toc-text"> 16.1 复习 ES5 function 构造函数 的继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1615-es5%E5%92%8Ces6%E9%9D%99%E6%80%81%E6%88%90%E5%91%98%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95%E7%AD%89"><span class="toc-number">1.16.2.</span> <span class="toc-text"> 16.15 ES5 和 ES6 静态成员，静态方法等</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#es5"><span class="toc-number">1.16.2.1.</span> <span class="toc-text"> ES5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#es6"><span class="toc-number">1.16.2.2.</span> <span class="toc-text"> ES6</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#162-extends-%E7%B1%BB%E7%BB%A7%E6%89%BF%E5%92%8C%E6%96%B9%E6%B3%95%E7%9A%84%E9%87%8D%E5%86%99"><span class="toc-number">1.16.3.</span> <span class="toc-text"> 16.2 extends 类继承和方法的重写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#163-getter-%E5%92%8C-setter"><span class="toc-number">1.16.4.</span> <span class="toc-text"> 16.3 getter 和 setter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-%E6%95%B0%E5%80%BC%E6%89%A9%E5%B1%95"><span class="toc-number">1.17.</span> <span class="toc-text"> 17. 数值扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95%E6%89%A9%E5%B1%95"><span class="toc-number">1.18.</span> <span class="toc-text"> 18. 对象方法扩展</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#181-objectis"><span class="toc-number">1.18.1.</span> <span class="toc-text"> 18.1 Object.is()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#182-objectassign"><span class="toc-number">1.18.2.</span> <span class="toc-text"> 18.2 Object.assign</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#183-objectsetprototypeof-%E5%92%8C-objectgetprototypeof"><span class="toc-number">1.18.3.</span> <span class="toc-text"> 18.3 Object.setPrototypeOf 和 Object.getPrototypeof</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-es6-%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">1.19.</span> <span class="toc-text"> 19. ES6 模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#191-%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">1.19.1.</span> <span class="toc-text"> 19.1 模块化的好处</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#192-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%A7%84%E8%8C%83%E4%BA%A7%E5%93%81"><span class="toc-number">1.19.2.</span> <span class="toc-text"> 19.2 模块化规范产品</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#193-es6-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AF%AD%E6%B3%95"><span class="toc-number">1.19.3.</span> <span class="toc-text"> 19.3 ES6 模块化语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1931-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E8%AF%AD%E6%B3%95"><span class="toc-number">1.19.3.1.</span> <span class="toc-text"> 19.3.1 模块导出数据语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1932-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE%E8%AF%AD%E6%B3%95"><span class="toc-number">1.19.3.2.</span> <span class="toc-text"> 19.3.2 模块导入数据语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1933-es6-%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97%E5%8C%96%E6%96%B9%E5%BC%8F%E4%BA%8C"><span class="toc-number">1.19.3.3.</span> <span class="toc-text"> 19.3.3 ES6 使用模块化方式二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#194-%E4%BD%BF%E7%94%A8-babel-%E5%AF%B9%E6%A8%A1%E5%9D%97%E5%8C%96%E4%BB%A3%E7%A0%81%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.19.4.</span> <span class="toc-text"> 19.4 使用 babel 对模块化代码转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#195-es6-%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%95%E5%85%A5-npm-%E5%AE%89%E8%A3%85%E7%9A%84%E5%8C%85"><span class="toc-number">1.19.5.</span> <span class="toc-text"> 19.5 ES6 模块化引入 npm 安装的包</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ecmasript-7-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">2.</span> <span class="toc-text"> ECMASript 7 新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-arrayprototypeincludes"><span class="toc-number">2.1.</span> <span class="toc-text"> 1. Array.prototype.includes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%8C%87%E6%95%B0%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">2.2.</span> <span class="toc-text"> 2. 指数运算符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ecmascript-8-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text"> ECMAScript 8 新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-async-%E5%92%8C-await"><span class="toc-number">3.1.</span> <span class="toc-text"> 1. async 和 await</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-async"><span class="toc-number">3.1.1.</span> <span class="toc-text"> 1.1 async</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-await"><span class="toc-number">3.1.2.</span> <span class="toc-text"> 1.2 await</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.3.</span> <span class="toc-text"> 1.3 综合应用 - 读取文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E7%BB%BC%E5%90%88%E5%BA%94%E7%94%A8-%E5%B0%81%E8%A3%85ajax"><span class="toc-number">3.1.4.</span> <span class="toc-text"> 1.4 综合应用 - 封装 ajax</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-objectvalues-%E5%92%8C-objectentries"><span class="toc-number">3.2.</span> <span class="toc-text"> 2. Object.values 和 Object.entries</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ecmascript-9-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">4.</span> <span class="toc-text"> ECMAScript 9 新特性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ecmascript-10-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">5.</span> <span class="toc-text"> ECMAScript 10 新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-objectfromentries"><span class="toc-number">5.1.</span> <span class="toc-text"> 1. Object.fromEntries</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-trimstart-%E5%92%8C-trimend"><span class="toc-number">5.2.</span> <span class="toc-text"> 2. trimStart () 和 trimEnd ()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-arrayprototypeflat-%E5%92%8C-arrayprototypeflatmap"><span class="toc-number">5.3.</span> <span class="toc-text"> 3. Array.prototype.flat 和 Array.prototype.flatMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-symbolprototypedescription"><span class="toc-number">5.4.</span> <span class="toc-text"> 4. Symbol.prototype.description</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ecmascript-11-%E6%96%B0%E7%89%B9%E6%80%A7"><span class="toc-number">6.</span> <span class="toc-text"> ECMAScript 11 新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B1%BB%E7%9A%84%E7%A7%81%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="toc-number">6.1.</span> <span class="toc-text"> 1. 类的私有属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-allsettled"><span class="toc-number">6.2.</span> <span class="toc-text"> 2. allSettled</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#promiseallsettled"><span class="toc-number">6.2.1.</span> <span class="toc-text"> Promise.allSettled()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#promiseall"><span class="toc-number">6.2.2.</span> <span class="toc-text"> Promise.all()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-matchall"><span class="toc-number">6.3.</span> <span class="toc-text"> 3. matchAll</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%8F%AF%E9%80%89%E9%93%BE"><span class="toc-number">6.4.</span> <span class="toc-text"> 4. 可选链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E5%AE%9A%E4%B9%89"><span class="toc-number">6.4.1.</span> <span class="toc-text"> 4.1 定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E7%9F%AD%E8%B7%AF%E6%95%88%E5%BA%94"><span class="toc-number">6.4.2.</span> <span class="toc-text"> 4.2 短路效应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E5%85%B6%E5%AE%83%E5%8F%98%E4%BD%93"><span class="toc-number">6.4.3.</span> <span class="toc-text"> [4.3 其它变体：?.()，?.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%8A%A8%E6%80%81-import-%E5%AF%BC%E5%85%A5"><span class="toc-number">6.5.</span> <span class="toc-text"> 5. 动态 import 导入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-bigint"><span class="toc-number">6.6.</span> <span class="toc-text"> 6. BigInt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-globalthis"><span class="toc-number">6.7.</span> <span class="toc-text"> 7. globalThis</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B4%E4%B8%8B%E6%88%91%E7%9A%84%E7%90%86%E8%A7%A3"><span class="toc-number">7.</span> <span class="toc-text"> 说下我的理解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AFpromiseasync-await%E5%BC%82%E6%AD%A5%E5%BE%AE%E4%BB%BB%E5%8A%A1%E5%AE%8F%E4%BB%BB%E5%8A%A1%E5%90%8C%E6%AD%A5%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">7.1.</span> <span class="toc-text"> 事件循环，Promise,async-await, 异步 (微任务宏任务) 同步执行顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81-%E5%88%9B%E5%BB%BAnewpromise%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1%E6%97%B6%E9%87%8C%E9%9D%A2%E9%82%A3%E4%B8%AA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E7%9A%84%E9%87%8C%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%8C%E6%AD%A5%E6%93%8D%E4%BD%9C%E7%9A%84promise%E5%8F%AA%E6%9C%89thencatch%E7%AD%89%E7%AD%89methods%E6%98%AF%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C%E5%BE%AE%E4%BB%BB%E5%8A%A1"><span class="toc-number">7.1.0.0.0.1.</span> <span class="toc-text"> 非常重要！创建 (new) Promise 实例化对象时里面那个函数参数的里面的代码是同步操作的，Promise 只有 then,catch, 等等 methods 是异步操作 (微任务)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%90%8C%E6%A0%B7async%E5%87%BD%E6%95%B0%E9%87%8C%E9%9D%A2%E5%9C%A8%E5%88%B0%E8%BE%BEawait%E4%B9%8B%E5%89%8D%E7%9A%84%E4%BB%A3%E7%A0%81%E9%83%BD%E6%98%AF%E5%90%8C%E6%AD%A5%E6%89%A7%E8%A1%8C%E7%9A%84"><span class="toc-number">7.1.0.0.0.2.</span> <span class="toc-text"> 同样，async 函数里面在到达 await 之前的代码都是同步执行的</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%A2%98"><span class="toc-number">8.</span> <span class="toc-text"> 参考题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E5%BE%AE%E4%BB%BB%E5%8A%A1%E5%AE%8F%E4%BB%BB%E5%8A%A1"><span class="toc-number">8.1.</span> <span class="toc-text"> 1. 事件循环，同步异步，微任务宏任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5%E5%BE%AE%E4%BB%BB%E5%8A%A1%E5%AE%8F%E4%BB%BB%E5%8A%A1"><span class="toc-number">8.2.</span> <span class="toc-text"> 2. 事件循环，同步异步，微任务宏任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-asyncawait%E5%BC%82%E6%AD%A5%E7%AD%89%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">8.3.</span> <span class="toc-text"> 3. async,await, 异步等执行顺序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-try-catch%E8%83%BD%E4%B8%8D%E8%83%BDcatch%E5%88%B0reject%E7%8A%B6%E6%80%81%E7%9A%84promise%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E9%87%8D%E8%A6%81%E7%9A%84"><span class="toc-number">8.4.</span> <span class="toc-text"> 4. try catch 能不能 catch 到 reject 状态的 promise 以及其他重要的</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E8%BF%99%E7%AF%87%E7%9C%9F%E7%9A%84%E9%9D%9E%E5%B8%B8%E7%BB%86%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E5%B8%A6%E7%9D%80%E8%B5%B0%E5%A4%A7%E6%A6%82%E8%8A%B1%E4%BA%86%E4%B8%80%E5%91%A8%E6%97%B6%E9%97%B4%E5%90%A7%E6%89%80%E4%BB%A5%E7%9C%9F%E7%9A%84%E5%80%BC%E5%BE%97%E4%B8%80%E7%9C%8B%E5%96%9C%E6%AC%A2%E7%9A%84%E8%AF%9D%E5%B0%B1%E6%94%B6%E8%97%8F%E5%90%A7%E6%88%91%E4%B9%9F%E4%BC%9A%E7%BB%A7%E7%BB%AD%E5%8A%AA%E5%8A%9B%E7%9A%84%E5%86%B2%E5%91%80"><span class="toc-number">8.4.0.0.1.</span> <span class="toc-text"> 总结这篇，真的非常细，一步一步带着走，大概花了一周时间吧，所以真的值得一看，喜欢的话就收藏吧，我也会继续努力的！！！冲呀</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF"><span class="toc-number">8.4.1.</span> <span class="toc-text"> 一 为什么要捕获错误，处理错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E9%94%99%E8%AF%AF%E4%B8%80%E8%88%AC%E5%87%BA%E7%8E%B0%E5%9C%A8%E5%93%AA%E9%87%8C"><span class="toc-number">8.4.2.</span> <span class="toc-text"> 二 错误一般出现在哪里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-%E9%94%99%E8%AF%AF%E6%8D%95%E8%8E%B7%E5%A4%84%E7%90%86%E7%9A%84%E6%96%B9%E5%BC%8Ftry-catch%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.4.3.</span> <span class="toc-text"> 三 错误捕获处理的方式 try catch 基本介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#31try-catch%E7%9A%84%E5%87%BA%E7%8E%B0%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%E7%9A%84%E6%96%B9%E6%B3%95%E4%B9%8B%E4%B8%80"><span class="toc-number">8.4.3.1.</span> <span class="toc-text"> 3.1.try catch 的出现，处理异常的方法之一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#32-try-%E6%88%96-catch-%E5%9D%97%E6%97%A0%E6%B3%95%E9%98%BB%E6%AD%A2-finally-%E5%9D%97%E6%89%A7%E8%A1%8C"><span class="toc-number">8.4.3.2.</span> <span class="toc-text"> 3.2 try 或 catch 块无法阻止 finally 块执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#33-return-%E8%AF%AD%E5%8F%A5%E6%97%A0%E6%B3%95%E9%98%BB%E6%AD%A2finally%E7%9A%84%E6%89%A7%E8%A1%8C"><span class="toc-number">8.4.3.3.</span> <span class="toc-text"> 3.3 return 语句无法阻止 finally 的执行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-try-catch%E6%98%AF%E5%A6%82%E4%BD%95%E6%8D%95%E8%8E%B7%E9%94%99%E8%AF%AF%E7%9A%84%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E6%89%8D%E8%83%BD%E6%8D%95%E8%8E%B7%E5%88%B0%E9%94%99%E8%AF%AF-%E9%9D%9E%E5%B8%B8%E9%87%8D%E8%A6%81"><span class="toc-number">8.4.4.</span> <span class="toc-text"> 四 try catch 是如何捕获错误的？什么时候才能捕获到错误 ( 非常重要 )</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#41-try-catch-%E4%B9%8B%E5%89%8D-%E6%8D%95%E8%8E%B7%E4%B8%8D%E5%88%B0%E7%9A%84"><span class="toc-number">8.4.4.1.</span> <span class="toc-text"> 4.1 try catch 之前 ( 捕获不到的 )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#42-try-catch%E8%BF%9B%E8%A1%8C%E4%B9%8B%E4%B8%AD%E8%83%BD%E6%8D%95%E8%8E%B7%E5%88%B0"><span class="toc-number">8.4.4.2.</span> <span class="toc-text"> 4.2 try catch 进行之中 ( 能捕获到 )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#43-try-catch%E8%BF%9B%E8%A1%8C%E4%B9%8B%E4%B8%AD%E9%87%8D%E7%82%B9%E4%B8%8D%E8%83%BD%E6%8D%95%E8%8E%B7%E5%88%B0"><span class="toc-number">8.4.4.3.</span> <span class="toc-text"> 4.3 try catch 进行之中 ( 重点:不能捕获到 )</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#44-promise%E7%9A%84%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7"><span class="toc-number">8.4.4.4.</span> <span class="toc-text"> 4.4 Promise 的异常捕获</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#45-try-catch%E4%B8%8D%E8%83%BD%E6%8D%95%E8%8E%B7%E5%88%B0promiseresolve%E7%9A%84%E6%8A%A5%E9%94%99"><span class="toc-number">8.4.4.5.</span> <span class="toc-text"> 4.5 try catch 不能捕获到 promise.resolve () 的报错</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-try-catch%E5%95%A5%E6%97%B6%E5%80%99%E7%94%A8%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E6%8A%9B%E9%94%99"><span class="toc-number">8.4.5.</span> <span class="toc-text"> 五 try catch 啥时候用，以及如何抛错</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#51-throw-new-error"><span class="toc-number">8.4.5.0.1.</span> <span class="toc-text"> 5.1 throw new Error()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#52-%E5%BA%94%E8%AF%A5%E4%BB%94%E7%BB%86%E8%AF%84%E4%BC%B0%E6%AF%8F%E4%B8%AA%E5%87%BD%E6%95%B0%E4%BB%A5%E5%8F%8A%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4%E5%AE%83%E4%BB%AC%E5%A4%B1%E8%B4%A5%E7%9A%84%E6%83%85%E5%BD%A2-%E8%89%AF%E5%A5%BD%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%8D%8F%E8%AE%AE%E5%8F%AF%E4%BB%A5%E4%BF%9D%E8%AF%81%E5%8F%AA%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BD%A0%E8%87%AA%E5%B7%B1%E6%8A%9B%E5%87%BA%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-number">8.4.5.1.</span> <span class="toc-text"> 5.2 应该仔细评估每个函数，以及可能导致它们失败的情形。良好的错误处理协议可以保证只会发生你自己抛出的错误。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#53-%E9%80%9A%E8%BF%87%E7%BB%A7%E6%89%BF%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B%E4%B8%8E%E6%8F%90%E7%A4%BA"><span class="toc-number">8.4.5.2.</span> <span class="toc-text"> 5.3 通过继承自定义错误类型，与提示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD-%E6%9C%89%E5%93%AA%E4%BA%9B%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.4.6.</span> <span class="toc-text"> 六 有哪些错误类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83-%E9%94%99%E8%AF%AF%E8%AF%86%E5%88%AB"><span class="toc-number">8.4.7.</span> <span class="toc-text"> 七 错误识别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB-%E5%8C%BA%E5%88%86%E9%87%8D%E5%A4%A7%E4%B8%8E%E9%9D%9E%E9%87%8D%E5%A4%A7%E9%94%99%E8%AF%AF"><span class="toc-number">8.4.8.</span> <span class="toc-text"> 八 区分重大与非重大错误、</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D-%E8%B0%83%E8%AF%95%E6%8A%80%E6%9C%AF"><span class="toc-number">8.4.9.</span> <span class="toc-text"> 九 调试技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#91-debugger-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">8.4.9.1.</span> <span class="toc-text"> 9.1 debugger 关键字</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#92-%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%AD%E6%89%93%E5%8D%B0%E6%B6%88%E6%81%AF"><span class="toc-number">8.4.9.2.</span> <span class="toc-text"> 9.2 在页面中打印消息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#93-%E6%A0%B9%E6%8D%AE%E9%9C%80%E6%B1%82%E5%B0%81%E8%A3%85consolelog"><span class="toc-number">8.4.9.3.</span> <span class="toc-text"> 9.3 根据需求封装 console.log ()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81-%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF"><span class="toc-number">8.4.10.</span> <span class="toc-text"> 十 抛出错误</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-map"><div class="card-content"><div class="item-headline"><i class="fa fa-globe-asia" aria-hidden="true"></i><span>Visitor Map</span></div><script id="clstr_globe" type="text/javascript" defer="defer" src="//clustrmaps.com/globe.js?d=4LA950xi3DtQgUHPlkO0mo-n_QgrcOu-1BIiVpExg7k"></script></div></div><div class="card-widget card-pixiv"><div class="card-content"><div class="item-headline"><i class="fa fa-image" aria-hidden="true"></i><span>Pixiv Top50</span><iframe src="https://cloud.mokeyjay.com/pixiv" frameborder="0" style="width:99%;height:380px;margin:0;"></iframe></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/Maven/" title="My Maven notes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/hello-world.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My Maven notes"/></a><div class="content"><a class="title" href="/2022/07/28/Maven/" title="My Maven notes">My Maven notes</a><time datetime="2022-07-27T12:00:00.000Z" title="Created 2022-07-28 00:00:00">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/25/nodejs/" title="Nodejs notes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/town.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nodejs notes"/></a><div class="content"><a class="title" href="/2022/07/25/nodejs/" title="Nodejs notes">Nodejs notes</a><time datetime="2022-07-24T12:00:00.000Z" title="Created 2022-07-25 00:00:00">2022-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/12/%E7%AE%97%E6%B3%95%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97/" title="My ultimate data structure and algorithm guide"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/statue.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My ultimate data structure and algorithm guide"/></a><div class="content"><a class="title" href="/2022/06/12/%E7%AE%97%E6%B3%95%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97/" title="My ultimate data structure and algorithm guide">My ultimate data structure and algorithm guide</a><time datetime="2022-06-11T12:00:00.000Z" title="Created 2022-06-12 00:00:00">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="Design Patterns"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Design Patterns"/></a><div class="content"><a class="title" href="/2022/06/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="Design Patterns">Design Patterns</a><time datetime="2022-06-11T12:00:00.000Z" title="Created 2022-06-12 00:00:00">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" title="Design Patterns - Factory Method"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Design Patterns - Factory Method"/></a><div class="content"><a class="title" href="/2022/06/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" title="Design Patterns - Factory Method">Design Patterns - Factory Method</a><time datetime="2022-06-10T12:00:00.000Z" title="Created 2022-06-11 00:00:00">2022-06-11</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Harry Qu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="Chat"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://harryqu1229.github.io/2021/11/02/ES6-11/'
    this.page.identifier = '2021/11/02/ES6-11/'
    this.page.title = 'My Javascript ES6-11 notes'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://harry-study-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '5df1e915e0fa867b50de',
      clientSecret: 'ce1cb793fe49078ee9d0102d3326d0d50ff6937b',
      repo: 'blog-comments-storage',
      owner: 'HarryQu1229',
      admin: ['HarryQu1229'],
      id: '9d462d6eb148747faed0b0937918c42e',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Disqus' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<code>.*?<\/code>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    fetch('https://disqus.com/api/3.0/forums/listPosts.json?forum=harry-study-blog&related=thread&limit=6&api_key=B5XFmdGuVaYDW7OIBakffpXoKorvphwRiwONIol4puEtr8YiwYAMAk2K7QcExNLY')
      .then(response => response.json())
      .then(data => {
        const disqusArray = data.response.map(item => {
          return {
            'avatar': item.author.avatar.cache,
            'content': changeContent(item.message),
            'nick': item.author.name,
            'url': item.url,
            'date': item.createdAt
          }
        })

        saveToLocal.set('disqus-newest-comments', JSON.stringify(disqusArray), 10/(60*24))
        generateHtml(disqusArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "Unable to get the data, please make sure the settings are correct."
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick}</span><time> / ${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('disqus-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="2809513713" data-server="netease" data-type="playlist" data-autoplay="false" data-fixed="true" data-order="random" data-theme="#e9ccd3"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="255,255,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>((window.gitter = {}).chat = {}).options = {
  disableDefaultChat: true,
};
document.addEventListener('gitter-sidecar-ready', (e) => {
  const GitterChat = e.detail.Chat
  let chat

  function initGitter () {
    chat = new GitterChat({
      room: 'HarryStudyBlog/community',
      activationElement: '#chat_btn'
    });
  }

  initGitter()

  if (true) {
    document.addEventListener('pjax:complete', () => {
      chat.destroy()
      initGitter()
    })
  }

})</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="async" defer="defer"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v3.8.2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":300,"height":450},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>