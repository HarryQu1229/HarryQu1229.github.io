<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>My Webpack5 notes | Harry Blog</title><meta name="keywords" content="frontend,webpack5"><meta name="author" content="Harry Qu"><meta name="copyright" content="Harry Qu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="# webpack5：高级篇 # 前言 在 基础篇 中，我们基于 webpack 构建了我们的基础工程化环境，将我们认为需要的功能配置了上去。 除开公共基础配置之外，我们意识到两点:  开发环境 (mode&#x3D;development)，追求强大的开发功能和效率，配置各种方便开发的功能； 生产环境 (mode&#x3D;production)，追求更小更轻量的 bundle (即打包产物);  接下来基于我们的">
<meta property="og:type" content="article">
<meta property="og:title" content="My Webpack5 notes">
<meta property="og:url" content="https://harryqu1229.github.io/2021/12/29/webpack5%E9%AB%98%E7%BA%A7/index.html">
<meta property="og:site_name" content="Harry Blog">
<meta property="og:description" content="# webpack5：高级篇 # 前言 在 基础篇 中，我们基于 webpack 构建了我们的基础工程化环境，将我们认为需要的功能配置了上去。 除开公共基础配置之外，我们意识到两点:  开发环境 (mode&#x3D;development)，追求强大的开发功能和效率，配置各种方便开发的功能； 生产环境 (mode&#x3D;production)，追求更小更轻量的 bundle (即打包产物);  接下来基于我们的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://harryqu1229.github.io/img/default-covers/car.jpg">
<meta property="article:published_time" content="2021-12-28T11:00:00.000Z">
<meta property="article:modified_time" content="2022-06-12T01:16:45.833Z">
<meta property="article:author" content="Harry Qu">
<meta property="article:tag" content="frontend">
<meta property="article:tag" content="webpack5">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://harryqu1229.github.io/img/default-covers/car.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://harryqu1229.github.io/2021/12/29/webpack5%E9%AB%98%E7%BA%A7/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":100,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#C78550","bgDark":"#c08eaf","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'My Webpack5 notes',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-06-12 13:16:45'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">158</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">57</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAACMCAMAAABmmcPHAAAAw1BMVEX///8aHByO1vsceMAAAAAYGhoWGBjw8PCJ1Pv3/P8RExMiJSWV2PuG1Pu25PwAcL3MzMzo9/6fn5/O7P2yzudYl87T5PJ+rdhPUVHr6+uoqKjl5eUABwcRFBQKc76JiYlcXV3a8f6u4fzW1tZ5enqTlJQsLi5BQkLv+f4AbLtrbGxnaGjF6f1NT0+j3fzc3Ny7u7uwsbE0NjaAgIDI2+7f6/Wbvt9sodKKtNu60uk2hcbBwcF3p9U+iMdknNDO3+8AZLjWDvjfAAAPI0lEQVR4nO2de0PiOBfGW0xbKCKIOnJpAeWmKHKb67qzs9//U71pkpOcpCnirArMm+cvLaFNfz09lyQtnufk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OT0f6jK47nnPd7suxt/vC5OaxT0We32fN89+aN1/lQuMdDlcvmssu/e/LG6u62VSgJ0qVQuP+67Q3+mKmc1ileBpqhPnat+e12UGFwMmv795Fz12+rmSaDVQVP/cXa37779QbpTmA3QFHXJueo3EjhnO+jMqp2rfgtJ51wE2rnqt9DNaa1Uegk0tepb56r/i86fTKIFoLOouO/OHq8qt7U85wLQWVS82HeHj1OVx7IFZzFo+okrYH5DN6dWmNtA08/2NdYUtYX2c3gp6Ea06xdszhlYVujHuRAJ/mNPY02duMpEuvs4utKEd8Nv7db87rYQMyRyZtKnUO+lgOmQgGnfoKsp60Y836WxUaBgiNgJPxai3oOr7hCfae+gQ9aNeBeLLrbVU55WfL66ZmZdObNHy30UMMcH+qbIOVOXwLzvl3/qvd7Jd/b3+W2xq/7YAubYQFeeisjVeJC7+5tSpqr/dcm+sC0qvvdJYR0b6KKkTlTYle91hpmj/rHDNz5KRwfaGuOEy61cntRPkO6vPrFvXORRf7iTPi7QFRHjdG8A9d6Pnxpmql792xf+DT0qQjH+gbCPDHTplsc45KkB2qcrEzND3bvmrhuNioA7Pz+9fd+Twjoy0Kcws30j/Af8n6UaFs4M9VfW4g4uTu2JOecM/QeGw2MDraqNzFVDPX13fV+AmUXFE56AsMRQfp1a+PuAjqLFsBuZYwkm6Kg7XLw44JA1yu0Jf962HUrvTFdvsTtoGcioSfIRosrXky2YGeqfn9n3L06Fn+Hh0Qp62BTq4P7CRnxSHdjYUNsW41ZKMlUH/QXerQZ6MR4kWaN4OnrWsIzFHllHxi22p3SuN4IjNWfrmDUg69nSCnvYb/miM2PojAX0Kn/GHLQyZLbx8i+bczaj4j8sAamwr8CAlBV0g4Aiy8YlokJyG58pmjhgZxJSCC0ECIFuz6BVkCZk3bHsMvK6A60ROi5r2JzTj0N+KD9MiN/Poe5Mtc4MGgWgV/I8VHcFaDyG/zmXahSh5glINlsglyJYXYfoio+hjgWmZITh+6IhbJmR2MeKyUMedPQcJ7hRSFqSUcQbBYm3TLRGKRmg8dVoE5NUOxLdS1W7gbylbzSJySyygV4QcbnIWH1bgpa+tvK994LbkO5D1C+PKP2wgh6JU0w2attUdDqc5uHHgubQJ74pMgE+ADrpk9BolCRDHbTv9+HsESdpb0uSmJ+ya4HD7Ch3FNqZuQ20LxomD+jrCDTFxD3H+beifEMz6BOee3gXKAe3g34WZxtW5SYJwCfKbubCfMmKc44NI+MnBKQBtJ/kG6XpwjiOpVFIIBR0bZzpXtbqHB7y15x2tGMB/SAOlU4wAw10CUroXy96j179GhpflF8C7UmXIG/pJdE6y9Suwi3HUEaB4hymypySlgHapngdGRfUopDA3dG3NyNN6NvM1iBIunnQTQIfap5HB00D4jfuDi57W1HfX/H68PpyJ9AtMFXppEfSwuIZbAMXLbo8gCYhIZNplchbV1waHTTLTGJlmGRkAR2wpEJdv1j6LeZYwoSHMBkXwkmUuxC8ETtSysb6ddAN6aBXGoIc6Kv7n3w4Y4urrv/1WVyN+91Ad3KRT3nMwAczh7PhMWQlb4MJ63LUqQryAb8xMOiUrJur5erBV/slQxN0QPwZbdScKpLSZDskoJnIaPU87A6XA3VNG5oJsBA5ovsYt2Lahl9xDXQ7hsDf1xHkQfd6938zr/ClwFWDc86yk/puoNvgpMHpLdD5EwhcA7D77J6LJtBjeXGiVoKvBAJNphDXmgkwigcG6DTuiEs6nMPWsApXeRKPoB80qAQ6LojcfjKBA0XjasIvuAZ6Ks4hN7FlAc1Qsqza5qrBOfMKfUfQ0NMgFnEcWyMkQZFIYnkeAgathW4Rz2mypu2DoBRxCCbF5xIV6NBHPnMkbxeIEEOtkIfwzfMfGVBQ3kit54E7HgwabsowNpNwK2iVuRmjpPQDPk4KOeCuoCFxg4xqgNJjuPgNzb8Itx6kGACcMbsJJGjdelQy3tRAkwZuBVGjqHAWlsG98KDATBcm6GdiPdgW0Igo9h/1E+APrXYEPQSIPJOOfF6h8S4Sy8UAZ5PMtP3w73GGEjTRCwuwKuY7JGjDZ8qEjtiXhTxwtmGWvHTteQRIge5Kj9PMtSoEfSJdtRzFA+f8S1Xou4KO1rwLKb/buNUFk2mIzBxsmAXHlXELCM1ixbCj3d6IoQiILGUA0EFoAIW0B1Wr0XNzM5vNxqu2/Jj58I5uJcWgZR0wy7cqBs2GQ5mr5jW5dM7f7pGJ7wgaOi6cNDe6eDRmWxNmbBE2RK8vOMSzPtY8FAwRaGKMWqig2jX3igR3uSyTn2c0a0viOMveBg1xRYMMtLwmVoMG0OlAFrZTS6ttoDVXbTjn14J+1iyUGy9Zcstm2FSLFYblxwkWBDpsaMSMO9IHNRRo0jEatbWI4HVbuAqPweGwA4lbLZx4VsFITlV0WUb8V4DOhkMF30tB3Ph4V9Bt4V2Z9bZT9g9pR7wWZPnBWOM2tVXfUixEStDmsZbokkV2F0QlihseDRvG4JU8UAZ6sn3AGUDDyF9scRwvg5auOtPn3PDpzqDBRJmT5iSykQS+lRkxeHGeaq/zIzhYWVgSoAPfPBRE3iwkRci6dQl8LLVvWAaMFGhwwg/mLjTQwdSH+Gob7H4RtHLVNCqaH70CNL7RudPLOPCtzAYQHQ9ZdGBVlt8B6Kp5KCvo3Mkj0NFEHi3RSnDdogdbQacDCOCqCnod6CyrO6dew1Yn7g66i0IXN9cM1iKBk5UumkccCOBBGNtEFltcxzPyy5Hm+bGE68huMfBafhL2l4tGZyYNnIHWM6Yi0CjrSF6ZdSjdU0d9bftgd9BgF9RJc+ZBnG0VzBeQ/ULEmcEQdjeyykOgzUy4iawYQOdSM7jwmUOQExMzqNGrKQI9QBnIVtBqxN9MhHYFXX8D0MJsqPVyQvzU++BFhK9I+lprNRCSV6fIWPGYCYDOmSNETHpAcDUo2g1FCsLgQqpp9b1aZQi9DvJl0MeBlp6zMovVVecJXvwAAx0QtGTmMC7cIYBOjcIYij6tYMldsZaaZOhY/PgDsuIVMv7toGVoyS+W/jjQ4BTJkjEVY52eqBHFycg4EuHyDksVDaoE1zMKewme6JTUiEhX3T2oIBlDpEUleIFJY9BD2dQswj8QNFS181Ri8OA+T0XJp3JQef+PtJ0M1f8StO4WFMKVpw0qYb/Zhjwj+27T4qYwaNmX0NdLkdygkudtpPMwysgPBA3eINQuucAF4WhlttZJN4KUrBcGaD+ZK7N/hoAUhJEGOkC+vL2GDC5zTdJ1ICts4QAo+5Im6OaJHqp50N6kwHl8IOhImwGFK94maGMQKpOZShZruGPbbCY6FcTQmHYcC4jdmZxi4d4dDfwHZMCPGXXkbFYQt9U9EMi5c7lvkWmorJ6MRA/bfZLwWXJzKks7/j5AQ4DhtiFvd1xsYzOQY7vZPNVm3OyMB0SMTPHRMTx5EJDJqN/ftEiitngG6GwIY77p9wcETc1kNCKYagzDFePaBgcAoNVUlp+Q9WzTH7Ej8VvAmJxVcwpa+P1I0JiMmj3EE9BaCBmpD0K9YEur5u6yJlToSgqzN2bB06yRurFE1i5nigPiP2w2A3S5RHDGnQyzcS5mHdxaDNARZOXblhu8L2htolAG8AbeqhnB1LIWg50pdztblxsQUaBsXW4A+coCTRXH2pWQRcrcth/rcoOC6JIDbRnQKAbdu//xCtDIS6ipb2UB2gIb9snUSikO+eWQftQy8CaH3iVoSysVHptFl0NVgy1bE3YH5lYqwQoaLR3Mr1T6ak4TFoOuX/3ydlmpBFI3IB6gmUkEiTFFH81sy7CMrCMe5Ra3hGreSpXgA7NVnKiEb2N8GODKEJrkRm4DZrM50Mrno6Idr70Tyxzv8is6rKBhVqCCHojbDlp5CTwOv1Jbc2OZS99AnZANdF6ApqV8XxtNDkhVWZIcVBpTn49JhWSK/dRY20VMxnykHI9vPK911AGxBkMPOQ80uqRA19QT3V/+NlahW0DXxZKETOqBuBcWosdyPSvK/LtyY24cLltNWyWEPwOcLbaV2ZWX3e9c1KqGA9EoW00bj1ExiUB7jSlJ+K5ocJ0YIyTDORyHHoZeg0l+pbG3Yst2ZV82vC/QeVQ2DeQZSYMC0PBM1Zl4ruJKGxTNge7Vv4sHWfhqf3j09gXQwwYIb5Ub7QNIw/GUzWfF05G2OrwrvsU8yYI3qs7HepmMQWfryKdsRmzdtxxK7CKZ9rPeLSwdpcfstIKEN1LRPN/7qJE7UQ4ano6gvMol/qe2StoA3evxWZfsCXJ4To4/pfVez7CIkdGXWlk2AWjl/rc+WbHDYXbriyn2DIt4OcENf/in9sRRo3X/Guhe/R++wpE/nigfFsi+fXAv/7GA3o8o6NotPFMlQ5qw0q8QFTHo+5+/2DfVM53yQp0e3luWDgd06ZQ7Z+0lP+Uyf/oQ1ikp0LBWSX9KWT2Y5UAXqMJTuhvzIeVy7RE9cQ+g62Kt0nnuQX3xqGHl0F5mdTCgmfLcUFr9iSYgHDS8SeLO+iaJ2kG+XPqQQBe+5Accwuef/2ag76+tT4GjK3OAbyw9JNBewTvYSjIqepcU9CV/1q3wbT+H+Wa2gwK95QU+4HtBOV+O7PkAMR8aaOMlxjrAmnqDz03Ry2oO021kiuBVYgcC+gWIuTdNmHZ/sK/ujohY2nQwoLe8Koxuv9vmyQ/6Dcd4bdPBqPhda1temel+XuE3VJTpFYM+WOd86LI74sLXGrufwPl92d61VgDa/ajTf9Nj7j2lVtAHWaAclyq3RlS0gHYvQ38TGa7a8vMgj845v420n64wQdfcD1a8oS6U/9BBH3SBcoxSb+/GoA909Oi4BQUM+pk9V6C8j/hYk/zhyMMdPTp+ZWNNArRzzu+rszL/cV9XoLy3Klmpfeacs5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5PTa/U//8ZkEo9djoEAAAAASUVORK5CYII=')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Harry Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-graduation-cap"></i><span> Journey</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> Hobbies</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/Photos/"><i class="fa-fw fas fa-images"></i><span> Photos</span></a></li><li><a class="site-page child" href="/Movies/"><i class="fa-fw fas fa-video"></i><span> Movies</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">My Webpack5 notes</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-12-28T11:00:00.000Z" title="Created 2021-12-29 00:00:00">2021-12-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-06-12T01:16:45.833Z" title="Updated 2022-06-12 13:16:45">2022-06-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Frontend/">Frontend</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Frontend/webpack/">webpack</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">31k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>118min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="My Webpack5 notes"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="webpack5高级篇"><a class="markdownIt-Anchor" href="#webpack5高级篇">#</a> webpack5：高级篇</h1>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>在 <a target="_blank" rel="noopener" href="https://juejin.cn/post/7048971886696497183">基础篇</a> 中，我们基于 webpack 构建了我们的基础工程化环境，将我们认为需要的功能配置了上去。 除开公共基础配置之外，我们意识到两点:</p>
<ol>
<li>开发环境 (mode=development)，追求强大的开发功能和效率，配置各种方便开发的功能；</li>
<li>生产环境 (mode=production)，追求更小更轻量的 bundle (即打包产物);</li>
</ol>
<p>接下来基于我们的开发需求，完善我们的工程化配置的同时，来介绍一些常用并强大的工具。</p>
<h2 id="第一章提高开发效率与完善团队开发规范"><a class="markdownIt-Anchor" href="#第一章提高开发效率与完善团队开发规范">#</a> 第一章：提高开发效率与完善团队开发规范</h2>
<h3 id="11-source-map"><a class="markdownIt-Anchor" href="#11-source-map">#</a> 1.1 source-map</h3>
<p>作为一个开发工程师 —— 无论是什么开发，要求开发环境最不可少的一点功能就是 ——debug 功能。 之前我们通过 webpack， 将我们的源码打包成了 bundle.js 。 试想：实际上客户端 (浏览器) 读取的是打包后的 bundle.js ，那么当浏览器执行代码报错的时候，报错的信息自然也是 bundle 的内容。 我们如何将报错信息 (bundle 错误的语句及其所在行列) 映射到源码上？</p>
<p>是的，souce-map。</p>
<p>webpack 已经内置了 sourcemap 的功能，我们只需要通过简单的配置，将可以开启它。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//开启 source map</span>
    <span class="token comment">//开发中推荐使用 'source-map'</span>
    <span class="token comment">//生产环境一般不开启 source map</span>
    devtool<span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当我们执行打包命令之后，我们发现 bundle 的最后一行总是会多出一个注释，指向打包出的 bundle.map.js (sourcemap 文件)。sourcemap 文件用来描述 源码文件和 bundle 文件的代码位置映射关系。基于它，我们将 bundle 文件的错误信息映射到源码文件上。</p>
<h4 id="7种模式"><a class="markdownIt-Anchor" href="#7种模式">#</a> 7 种模式</h4>
<p>除开’source-map’外，还可以基于我们的需求设置其他值，webpack——devtool 一共提供了 7 种 SourceMap 模式：</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>eval</td>
<td>默认值。每个 module 会封装到 eval 里包裹起来执行，并且会在末尾追加注释 //@ sourceURL.</td>
</tr>
<tr>
<td>source-map</td>
<td>生成一个 SourceMap 文件.</td>
</tr>
<tr>
<td>hidden-source-map</td>
<td>和 source-map 一样，但不会在 bundle 末尾追加注释.</td>
</tr>
<tr>
<td>inline-source-map</td>
<td>生成一个 DataUrl 形式的 SourceMap 文件.</td>
</tr>
<tr>
<td>eval-source-map</td>
<td>每个 module 会通过 eval () 来执行，并且生成一个 DataUrl 形式的 SourceMap.</td>
</tr>
<tr>
<td>cheap-source-map</td>
<td>生成一个没有列信息（column-mappings）的 SourceMaps 文件，不包含 loader 的 sourcemap（譬如 babel 的 sourcemap）</td>
</tr>
<tr>
<td>cheap-module-source-map</td>
<td>生成一个没有列信息（column-mappings）的 SourceMaps 文件，同时 loader 的 sourcemap 也被简化为只包含对应行的。</td>
</tr>
</tbody>
</table>
<p>要注意的是，生产环境我们一般不会开启 sourcemap 功能，主要有两点原因:</p>
<ol>
<li>通过 bundle 和 sourcemap 文件，可以反编译出源码 ———— 也就是说，线上产物有 soucemap 文件的话，就意味着有暴漏源码的风险。</li>
<li>我们可以观察到，sourcemap 文件的体积相对比较巨大，这跟我们生产环境的追求不同 (生产环境追求更小更轻量的 bundle)。</li>
</ol>
<blockquote>
<p>一道思考题：有时候我们期望能第一时间通过线上的错误信息，来追踪到源码位置，从而快速解决掉 bug 以减轻损失。但又不希望 sourcemap 文件报漏在生产环境，有比较好的方案吗？</p>
</blockquote>
<p><strong>示例 1：默认值 eval。</strong></p>
<p>先搭建一个最基本的 webpack 环境。</p>
<p>1、生成 package.json 文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、搭建一个最基本的 webpack 环境，安装以下包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、创建 app.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello,world!'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4、创建 webpack.config.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5、打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6、打包效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015021846.png" alt="image-20220124015021846"></p>
<p>7、启动 开发服务器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack serve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>8、在浏览器中访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F">http://localhost:8080/</a> ，查看执行效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/29d622c1ea0a40cca845ac3624c870b1~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/16ea08f4ef0f4e0cb01a7513401f9821%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>9、结论。</p>
<p>默认情况下，即使我们没有配置 source map，webpack 也会在开发环境下，设置 source map，值为 eval。相当于手动设置  <code>devtool: false</code> 。</p>
<p>效果：eval 可以准确定位到源代码。</p>
<p><strong>示例 2：关闭 source map。</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devtool<span class="token operator">:</span> <span class="token boolean">false</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>效果：关闭 source map 后，不可以准确定位到源代码。</p>
<p><strong>示例 3：source-map。</strong></p>
<p>1、修改配置。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devtool<span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、打包。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/7f7c2597f4d643e1870a73bc057ad1a8%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/e60b7a4abce0447dab6854427a2ba193%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>3、效果：<br>
1. 生成了一个.map 文件。<br>
2.source-map 可以精准定位到源代码，可以定位到行数和列数。</p>
<p><strong>示例 4：hidden-source-map。</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devtool<span class="token operator">:</span> <span class="token string">'hidden-source-map'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>效果：<br>
1. 生成了.map 文件。<br>
2.bundle 末尾没有添加注释，所以 bundle 和.map 文件无法关联起来。<br>
3. 不能定位到源代码。</p>
<p><strong>示例 5：inline-source-map。</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devtool<span class="token operator">:</span> <span class="token string">'inline-source-map'</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/657e6bffa049409ebca7c9efd0b580c1%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>效果：<br>
1. 没有生成.map 文件，但是会将其内容以 dataURL 方式嵌入到 bundle 文件中。<br>
2. 可以定位到源代码。</p>
<p><strong>示例 6：eval-source-map。</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devtool<span class="token operator">:</span> <span class="token string">'eval-source-map'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d9b3c04c1fd344ac89628cf78934f9c8~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p>效果：<br>
1. 没有生成单独的.map 文件，但是会将其内容以 dataURL 方式嵌入到 bundle 文件中。<br>
2.eval () 执行 module 代码。<br>
3. 可以定位到源代码。</p>
<p><strong>示例 7：cheap-source-map。</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devtool<span class="token operator">:</span> <span class="token string">'cheap-source-map'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>效果：<br>
1. 生成了一个.map 文件。<br>
2.source-map 可以精准定位到源代码，只能定位到行数，不能定位到列数。</p>
<hr>
<h4 id="cheap-source-map-source-map的区别"><a class="markdownIt-Anchor" href="#cheap-source-map-source-map的区别">#</a> cheap-source-map、source-map 的区别：</h4>
<p>source-map 会在 .map 文件 /mappings 中记录源代码的行数和列数，而 cheap-source-map 只记录列数。</p>
<p>一般情况下，我们调试代码时，只需要知道代码的行数就可以了，并不需要关注列数。</p>
<hr>
<p><strong>示例 8：cheap-module-source-map。</strong></p>
<p>1、配置 devtool。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、安装 babel 相关的包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、配置 babel-loader。</p>
<p>babel 的作用：将 app.js 中的类语法转换为 es5 的语法。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、修改入口文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>
     <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> <span class="token string">'hello webpack'</span>
     <span class="token punctuation">&#125;</span>

     <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>str<span class="token punctuation">)</span>
     <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4、效果。</p>
<ul>
<li>生成.map 文件。</li>
<li>可以定位到被 babel 转换前的源代码，即定位到类语法的代码。</li>
</ul>
<h4 id="cheap-source-map-cheap-module-source-map的区别"><a class="markdownIt-Anchor" href="#cheap-source-map-cheap-module-source-map的区别">#</a> cheap-source-map、cheap-module-source-map 的区别。</h4>
<p>如果我们使用 babel 将 app.js 中的类语法转换为 es5 语法，我们还能定位到类语法代码吗？</p>
<p>cheap-module-source-map 可以定位到 babel 转换前的源代码，而 cheap-source-map 只能定位到 babel 转换后的代码。</p>
<p>示例： <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/af6499723f33446c9ee5c09b18110bad%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015405188.png" alt="image-20220124015405188"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015355471.png" alt="image-20220124015355471"></p>
<h4 id="推荐-cheap-module-source-map"><a class="markdownIt-Anchor" href="#推荐-cheap-module-source-map">#</a> 推荐 cheap-module-source-map</h4>
<p>在开发环境中，推荐大家使用 cheap-module-source-map 这个选项。因为它既可以生成单独的.map 文件，还可以定位到 babel 转换前的源代码，能够大大提高调试代码的效率。</p>
<hr>
<h3 id="12-devserver"><a class="markdownIt-Anchor" href="#12-devserver">#</a> 1.2 devServer</h3>
<p>开发环境下，我们往往需要启动一个 web 服务，方便我们模拟一个用户从浏览器中访问我们的 web 服务，读取我们的打包产物，以观测我们的代码在客户端的表现。webpack 内置了这样的功能，我们只需要简单的配置就可以开启它。</p>
<p>在此之前，我们需要安装它</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">-</span><span class="token constant">D</span> webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>devServer.proxy 基于强大的中间件 http-proxy-middleware 实现的，因此它支持很多的配置项，我们基于此，可以做应对绝大多数开发场景的定制化配置。</p>
<p>webpack-dev-server 的最底层实现是源自于 node 的 http 模块。</p>
<h4 id="基础使用"><a class="markdownIt-Anchor" href="#基础使用">#</a> 基础使用</h4>
<p>通过 devServer 选项 来配置 webpack-dev-server 如何工作。</p>
<p>示例 1：</p>
<p>1、生成 package.json 文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、搭建一个最基本的 webpack 环境，安装以下包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、app.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello,webpack'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4、webpack.config.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    <span class="token comment">//配置开发服务器</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//设置web服务的根目录</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5、打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6、启动开发服务器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack serve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>7、浏览器中访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F">http://localhost:8080/</a> 。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/59484dbe51ff48d0904c65c44578d569%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>8、结论。</p>
<p>开发服务器启动成功。</p>
<h4 id="开启gzips压缩"><a class="markdownIt-Anchor" href="#开启gzips压缩">#</a> 开启 gzips 压缩</h4>
<p>devServer.compress 选项：是否开启服务器的资源压缩功能，可以减小传输的体积大小。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//启动web服务的gzips压缩功能，减小传输体积。</span>
    compress<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>效果： <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/11bf4914e0a5406dacae215533ac2716%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>结论：启动 gzips 压缩后，web 服务器会在资源的请求响应头中添加一个字段：Content-Encoding: gzip。</p>
<h4 id="设置端口号"><a class="markdownIt-Anchor" href="#设置端口号">#</a> 设置端口号</h4>
<p>devServer.port：设置 web 服务的端口号，默认为 8080。</p>
<h4 id="设置响应头"><a class="markdownIt-Anchor" href="#设置响应头">#</a> 设置响应头</h4>
<p>通过 headers 选项可以添加响应头。</p>
<p>示例：<br>
1、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//设置响应头</span>
    headers<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'X-Access-Token'</span><span class="token operator">:</span> <span class="token string">'abc123'</span> <span class="token comment">//token</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015538925.png" alt="image-20220124015538925"></p>
<h4 id="启动代理"><a class="markdownIt-Anchor" href="#启动代理">#</a> 启动代理</h4>
<p>proxy 选项。</p>
<p>我们打包出的 js bundle 里有时会含有一些对特定接口的网络请求 (ajax/fetch)。要注意，此时客户端地址是在 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F">http://localhost:8080/</a> 下，假设我们的接口来自<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A4001%2F"> http://localhost:4001/</a> ，那么毫无疑问，此时控制台里会报错并提示你跨域。</p>
<p>如何解决这个问题？ 在开发环境下，我们可以使用 devServer 自带的 proxy 功能：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//开启代理</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http:localhost:4001'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>示例 1：未开启代理。</strong></p>
<ol>
<li>搭建一个简单的后台接口服务器。</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//server.js</span>

<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/api/hello'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello node'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9000</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'后台服务器启动成功，请访问：http://localhost:9000'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>启动后台接口服务器。</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">node server<span class="token punctuation">.</span>js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ol start="3">
<li>在浏览器中访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A9000">http://localhost:9000</a> 。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/e108e53cd4db4d29ba2a1afc875e78e8%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>说明后台接口服务器运行成功。</p>
<ol start="4">
<li>发起 ajax 请求。</li>
</ol>
<p>入口文件中，通过 fetch 方法来请求后台接口。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://localhost:9000/api/hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">console</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="5">
<li>打包、启动服务器、浏览器执行效果。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/b6d990ebd7c549b19f9d798dedfbd859%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<ol start="6">
<li>结论。</li>
</ol>
<p>未开启代理时，跨域请求会报错。</p>
<p><strong>示例 2：开启代理。</strong></p>
<ol>
<li>省略请求路径中的域名。</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//app.js</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/hello'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=></span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li>开启代理。</li>
</ol>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//开启代理</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://localhost:9000'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="3">
<li>打包、启动服务器、浏览器执行效果。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/de6c63f7866147efba4328dad7aa3ac0%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>请求成功了。</p>
<ol start="4">
<li>结论。</li>
</ol>
<p>开启代理后，跨域问题就解决了。</p>
<p>现在，对 /api/hello 的请求会将请求代理到 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A9000%2Fapi%2Fhello">http://localhost:9000/api/hello</a> 。</p>
<h4 id="https"><a class="markdownIt-Anchor" href="#https">#</a> https</h4>
<p>如果想让我们的本地 http 服务变成 https 服务，我们只需要这样配置:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    https<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意，此时我们访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3Aport">http://localhost:port</a> 是无法访问我们的服务的，我们需要在地址栏里加前缀：https: 注意：由于默认配置使用的是自签名证书，所以有得浏览器会告诉你是不安全的，但我们依然可以继续访问它。 当然我们也可以提供自己的证书 —— 如果有的话：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015743899.png" alt="image-20220124015743899"></p>
<h4 id="http2"><a class="markdownIt-Anchor" href="#http2">#</a> http2</h4>
<p>如果想要配置 http2，那么直接设置：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    http2<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>即可，http2 默认自带 https 自签名证书，当然我们仍然可以通过 https 配置项来使用自己的证书。</p>
<h4 id="historyapifallback"><a class="markdownIt-Anchor" href="#historyapifallback">#</a> historyApiFallback</h4>
<p>如果我们的项目是 SPA 应用，如 Vue 项目、React 项目等，而且使用的是 H5 history 历史路由模式时，我们在刷新页面或者直接在地址栏修改路由路径时，页面有可能会报错。如何解决呢？</p>
<p>如果我们的应用是个 SPA (单页面应用)，当路由到 /some 时 (可以直接在地址栏里输入)，会发现此时刷新页面后，控制台会报错。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token constant">GET</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3000</span><span class="token operator">/</span>some <span class="token number">404</span> <span class="token punctuation">(</span>Not Found<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此时打开 network，刷新并查看，就会发现问题所在 ——— 浏览器把这个路由当作了静态资源地址去请求，然而我们并没有打包出 /some 这样的资源，所以这个访问无疑是 404 的。 如何解决它？ 这种时候，我们可以通过配置来提供页面代替任何 404 的静态资源响应：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    historyApiFallback<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

<span class="token punctuation">[</span>webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server<span class="token punctuation">]</span> <span class="token number">404</span>s will fallback to <span class="token string">'/index.html'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此时重启服务刷新后发现请求变成了 index.html。 当然，在多数业务场景下，我们需要根据不同的访问路径定制替代的页面，这种情况下，我们可以使用 rewrites 这个配置项。 类似这样:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015803735.png" alt="image-20220124015803735"></p>
<h4 id="开发服务器主机"><a class="markdownIt-Anchor" href="#开发服务器主机">#</a> 开发服务器主机</h4>
<p>如果你在开发环境中起了一个 devServer 服务，并期望你的同事能访问到它，你只需要配置：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    host<span class="token operator">:</span> <span class="token string">'0.0.0.0'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这时候，如果你的同事跟你处在同一局域网下，就可以通过局域网 ip <a href="https://link.juejin.cn?target=http%3A%2F%2F192.168.43.168%3A8080%2F">http://192.168.43.168:8080/</a> 来访问你的服务啦。</p>
<hr>
<h3 id="13-模块热替换与热加载"><a class="markdownIt-Anchor" href="#13-模块热替换与热加载">#</a> 1.3 模块热替换与热加载</h3>
<h4 id="热替换"><a class="markdownIt-Anchor" href="#热替换">#</a> 热替换</h4>
<p>模块热替换 (HMR - hot module replacement) 功能会在应用程序运行过程中，替换、添加或删除 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fconcepts%2Fmodules%2F">模块</a>，而无需重新加载整个页面。</p>
<p>启用 webpack 的 热模块替换 特性，需要配置 devServer.hot 参数：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//开启热替换功能</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>此时我们实现了基本的模块热替换功能。webpack 默认开启了 HMR 功能。</p>
<p><strong>HMR 加载样式</strong></p>
<p>如果你配置了 style-loader，那么现在已经同样支持样式文件的热替换功能了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2bd25bc2dab04b61ab4495e373dd0d62%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>这是因为 style-loader 的实现使用了 module.hot.accept，在 CSS 依赖模块更新之后，会对 style 标签打补丁。从而实现了这个功能。</p>
<h4 id="热加载"><a class="markdownIt-Anchor" href="#热加载">#</a> 热加载</h4>
<p>热加载：文件更新时，自动刷新我们的服务和页面。</p>
<p>新版的 webpack-dev-server 默认已经开启了热加载的功能。 它对应的参数是 devServer.liveReload，默认为 true。 注意，如果想要关掉它，要将 liveReload 设置为 false 的同时，也要关掉 hot。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015951395.png" alt="image-20220124015951395"></p>
<p>热替换 和 热加载 有什么用处呢？它们可以帮助我们大大提高代码的调试效率。</p>
<h4 id="示例1css的热替换"><a class="markdownIt-Anchor" href="#示例1css的热替换">#</a> 示例 1：css 的热替换。</h4>
<p>1、搭建一个基础的 webpack 环境，安装以下包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>

npm i style<span class="token operator">-</span>loader css<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>2、设置配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//开启hmr功能</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、style.css。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">.</span>square<span class="token punctuation">&#123;</span>
    width<span class="token operator">:</span> <span class="token number">60</span>px<span class="token punctuation">;</span>
    height<span class="token operator">:</span> <span class="token number">60</span>px<span class="token punctuation">;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> red<span class="token punctuation">;</span>
    margin<span class="token operator">:</span> <span class="token number">30</span>px <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、app.js。</p>
<p>功能：点击按钮，添加一个正方形框。点击多次，则添加多个正方形框。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./style.css'</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
button<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'添加'</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'square'</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5、打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124015943131.png" alt="image-20220124015943131"></p>
<p>6、启动开发服务器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack serve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>7、浏览器执行效果。</p>
<ul>
<li>先点击按钮三次，生成三个正方形框，它们的背景色都是 red。</li>
<li>再修改 style.css，将正方形框的背景色修改为 green。</li>
<li>不需要重新打包和启动服务器。</li>
<li>在浏览器中查看执行效果。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/9dec7c64231c45098aaecb0714d876d9%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>8、结论。</p>
<p>修改 style.css 代码后，页面没有自动刷新，但是正方形框的背景色已经从红色变成了绿色。这就是 css 的热替换功能。</p>
<p>css 的热替换功能：css 模块代码发生修改后，页面会局部更新，显示最新的 css 代码的样式，而不会自动刷新页面，已经执行过的 js 代码的效果能够保留下来，只是样式更新了。</p>
<h4 id="示例2js的热替换"><a class="markdownIt-Anchor" href="#示例2js的热替换">#</a> 示例 2：js 的热替换。</h4>
<p>1、input.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#box'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'&lt;input type="text" value="test" />'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、index.html。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
    <span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>body<span class="token operator">></span>
        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"box"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//开启hmr功能</span>
        hot<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            template<span class="token operator">:</span> <span class="token string">'./index.html'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、app.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./style.css'</span>
<span class="token keyword">import</span> <span class="token string">'./input.js'</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
button<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'添加'</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'square'</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5、打包、启动开发服务器、浏览器执行效果。</p>
<ul>
<li>先点击三次按钮，在页面上生成三个正方形框。</li>
<li>再修改 input.js 代码。</li>
<li>不需要重新打包和启动开发服务器。</li>
<li>查看浏览执行效果。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/06864962ba75415c98daa64782fad9ea%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>6、结论。</p>
<p>修改 input.js 模块的代码后，页面发生了自动刷新，三个正方形框也消失了。说明 input.js 模块并没有开启热替换功能。</p>
<p><strong>哪如何开启 input.js 模块的热替换功能呢？</strong></p>
<p>7、修改 app.js 文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./style.css'</span>
<span class="token keyword">import</span> <span class="token string">'./input.js'</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
button<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'添加'</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
    div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'square'</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span>

<span class="token comment">//开启input.js模块的hmr功能</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./input.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过 <strong>module.hot.accept()</strong> 方法来开启某个 js 模块的热替换功能。<br>
参数 1：要开启热替换功能的 js 模块。<br>
参数 2：热替换完成后的回调。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//开启input.js模块的hmr功能</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./input.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>8、重新打包、启动服务器、浏览器执行效果。</p>
<ul>
<li>先点击三次按钮，在页面上生成三个正方形框。</li>
<li>再修改 input.js 代码。</li>
<li>不需要重新打包和启动开发服务器。</li>
<li>查看浏览执行效果。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/80c81aacfb204015a81f5b7d70da21a5%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020200550.png" alt="image-20220124020200550"></p>
<p>9、结论。</p>
<p>通过 accept () 方法 开启 input.js 模块的热替换功能后，修改 input.js 代码后，页面不会自动刷新，其它模块的已经执行过的效果会保留，只是重新执行了 input.js 的代码。</p>
<h4 id="小结"><a class="markdownIt-Anchor" href="#小结">#</a> 小结</h4>
<blockquote>
<p>简单理解，热替换：修改某个模块的代码后，页面不会全部刷新，而是刷新发生修改的模块。发生修改的模块会被重新执行，显示最新代码的执行效果。而其它未修改的模块则不会重新执行，已经执行过的效果会保留下来。</p>
</blockquote>
<blockquote>
<p>热替换功能 实际上使用的是一个插件 HotModuleReplacementPlugin，在 webpack 4.x 版本中，需要手动安装和配置该插件。在 webpack 5.x 中，已经内置了，可以开箱即用。</p>
</blockquote>
<blockquote>
<p>如果是我们自己写的 js 模块，则需要在入口文件中，使用 module.hot.accept () 方法来手动开启该模块的热替换功能。</p>
</blockquote>
<blockquote>
<p>其实 css 模块 也需要通过 module.hot.accept () 方法来开启热替换功能，但是 style-loader 帮我们完成了。</p>
</blockquote>
<blockquote>
<p>如果是 Vue、React 项目，框架会自动帮我们开启了热替换功能，不需要我们手动进行配置。</p>
</blockquote>
<hr>
<h3 id="14-eslint"><a class="markdownIt-Anchor" href="#14-eslint">#</a> 1.4 eslint</h3>
<p>eslint 是用来扫描我们所写的代码是否符合规范的工具。 往往我们的项目是多人协作开发的，我们期望统一的代码规范，这时候可以让 eslint 来对我们进行约束。 严格意义上来说，eslint 配置跟 webpack 无关，但在工程化开发环境中，它往往是不可或缺的。</p>
<h4 id="基本使用"><a class="markdownIt-Anchor" href="#基本使用">#</a> 基本使用</h4>
<p>在项目中，安装 eslint 包：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install eslint <span class="token operator">--</span>save<span class="token operator">-</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>配置 eslint，只需要在根目录下添加一个.eslintrc 文件 (或者.eslintrc.json, .js 等)。 当然，我们可以使用 eslint 工具来自动生成它：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx eslint <span class="token operator">--</span>init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们可以看到控制台里的展示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/ae934bbb369841479b45f4fe4ebc31cc%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>并生成了一个配置文件（.eslintrc.json)，这样我们就完成了 eslint 的基本规则配置。eslint 配置文件里的配置项含义如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/db72400d06284700a365e97549a9332d%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020306319.png" alt="image-20220124020306319"></p>
<h4 id="vscode插件"><a class="markdownIt-Anchor" href="#vscode插件">#</a> VSCode 插件</h4>
<p>VSCode 中，可以安装一个 eslint 插件，该插件会直接在编辑区中，使用红色波浪线来标记出不符合规范的代码，而不需要手动执行 npx eslint，也不需要在控制台中查看报错信息了，更加方便。</p>
<blockquote>
<p>注意：在项目中，必须搭建 eslint 环境（安装 eslint 包，创建.eslintrc.js 等），VSCode 中的 eslint 插件 才能正常工作，对项目中的 js 文件进行语法检查。否则不会对项目中的 js 文件进行检查。</p>
</blockquote>
<blockquote>
<p>VSCode 快捷键：Ctrl + ~ 打开命令行终端。</p>
</blockquote>
<h4 id="结合webpack使用"><a class="markdownIt-Anchor" href="#结合webpack使用">#</a> 结合 webpack 使用</h4>
<p>我们期望 eslint 能够实时提示报错而不必等待执行命令。 这个功能可以通过给自己的 IDE (代码编辑器) 安装对应的 eslint 插件来实现。 然而，不是每个 IDE 都有插件，如果不想使用插件，又想实时提示报错，那么我们可以结合 webpack 的打包编译功能来实现。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span><span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要同时使用 derServer。</p>
<p>现在我们就可以实时地看到代码里的不规范报错啦。</p>
<h4 id="示例1单独使用eslint"><a class="markdownIt-Anchor" href="#示例1单独使用eslint">#</a> 示例 1：单独使用 eslint。</h4>
<p>1、安装 eslint。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install eslint <span class="token operator">--</span>save<span class="token operator">-</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、生成 eslint 配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx eslint <span class="token operator">--</span>init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020342895.png" alt="image-20220124020342895"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//.eslintrc.js</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"env"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"browser"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string">"es2021"</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token string">"extends"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"standard"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"parserOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"ecmaVersion"</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
        <span class="token string">"sourceType"</span><span class="token operator">:</span> <span class="token string">"module"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token string">"rules"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、修改.eslintrc.js 中的 ecmaVersion 为 12。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"ecmaVersion"</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4、app.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello, world'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5、执行语法检查指令。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx eslint <span class="token punctuation">.</span><span class="token operator">/</span>app<span class="token punctuation">.</span>js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6、效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020359486.png" alt="image-20220124020359486"></p>
<p>7、结论。</p>
<p>eslint 执行成功。</p>
<h4 id="示例2在webpack中使用eslint"><a class="markdownIt-Anchor" href="#示例2在webpack中使用eslint">#</a> 示例 2：在 webpack 中使用 eslint。</h4>
<p>在示例 1 的基础上进行以下操作。</p>
<p>1、搭建一个基本的 webpack 环境，安装一些包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、安装 bable 相关的包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">-</span><span class="token constant">D</span> babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、安装 eslint-loader。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">-</span><span class="token constant">D</span> eslint<span class="token operator">-</span>loader<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4、webpack.config.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span><span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                exclue<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对 eslint 进行配置的关键代码：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span><span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclue<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>7、打包，而且启动开发服务器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack serve<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>8、浏览器执行效果。</p>
<p>在浏览中访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F">http://localhost:8080/</a> 。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/926f834fe702474a8a91fb39f962487b%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>9、结论。</p>
<p>可以看到，页面上并没有正常显示，而是显示出了 eslint 的报错信息。 当我们改正了 app.js 文件中不符合 eslint 语法规范的代码后，页面就正常显示了。 说明我们成功在 webpack 中使用了 eslint。</p>
<h4 id="关闭覆盖层"><a class="markdownIt-Anchor" href="#关闭覆盖层">#</a> 关闭覆盖层</h4>
<p>如果我们不想在页面上显示 eslint 语法检查的报错信息，则可以关闭覆盖层：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    client<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        overlay<span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样的话，就只在命令行窗口和浏览器控制台中，输出 eslint 语法检查的报错信息，而页面上就不会显示。</p>
<hr>
<h3 id="15-git-hooks-与-husky-建议先去学git"><a class="markdownIt-Anchor" href="#15-git-hooks-与-husky-建议先去学git">#</a> 1.5 git-hooks 与 husky (建议先去学 git)</h3>
<p>为了保证团队里的开发人员提交的代码符合规范，我们可以在开发者上传代码时进行校验。 我们常用 husky 来协助进行代码提交时的 eslint 校验。在使用 husky 之前，我们先来研究一下 git-hooks 。</p>
<blockquote>
<p>注意：<br>
1、git 相关的指令 要在 git bash 命令行中执行，而不是 window 命令行。 2、如何打开 git bash 命令行？ 右击文件夹，选中 Git Bash Here。</p>
</blockquote>
<blockquote>
<p>husky 是一个基于 git hooks 实现的工具。</p>
</blockquote>
<blockquote>
<p>一般在开发时，不进行语法检查。提交时才进行语法检查。</p>
</blockquote>
<h4 id="git-hooks的基本使用"><a class="markdownIt-Anchor" href="#git-hooks的基本使用">#</a> git hooks 的基本使用</h4>
<h5 id="示例1不成功"><a class="markdownIt-Anchor" href="#示例1不成功">#</a> 示例 1：不成功。</h5>
<p>0. 搭建一个基本的 webpack 环境。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/54ddbc756f074dddb03973a098ce4d4d%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>1、检查 git 是否安装成功。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git <span class="token operator">--</span>version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、初始化 git 仓库。在项目根目录下打开命令行窗口，执行：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、查看.git 目录。</p>
<blockquote>
<p>1、执行 git init，会在项目根目录中生成一个隐藏的 .git 目录。<br>
2、ls -la 指令：查看当前文件夹中的所有内容。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/f9db907579f44fc991440c765572478d%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">ls <span class="token operator">-</span>la<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020541239.png" alt="image-20220124020541239"></p>
<p>4、创建.gitignore 文件。</p>
<p>.gitignore 文件用来指定哪些文件不用被提交。如 node_modules 不用提交。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//.gitignore</span>

<span class="token operator">**</span><span class="token operator">/</span>node_modules<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>5、查看仓库状态。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git status <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6、添加到暂存区。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git add <span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>7、提交到本地库。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git commit <span class="token operator">-</span>m <span class="token string">'init'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>8、切换到.git 文件夹，查看里面的内容。</p>
<p>可以发现，.git 文件夹中有一个 hooks 文件夹，它里面就存放了 hooks。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">cd <span class="token punctuation">.</span>git
ls <span class="token operator">-</span>la<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020825242.png" alt="image-20220124020825242"></p>
<blockquote>
<p>以字母 d 开的是文件夹，如 drwxr-xr-x 。</p>
</blockquote>
<p>9、切换到 hooks 文件夹，查看里面的内容。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">cd hooks
ls <span class="token operator">-</span>la<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020836560.png" alt="image-20220124020836560"></p>
<blockquote>
<p>可以发现，hooks 文件夹中 有很多 .sample 后缀的文件。 这些.sample 文件就是 hooks。什么是 hooks 呢？它就是 git 回调函数，git 会在执行指令时自动调用它们。</p>
</blockquote>
<p>10、查看 pre-commit.sample 文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">cat pre<span class="token operator">-</span>commit<span class="token punctuation">.</span>sample<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>实际上，pre-commit.sample 文件并不能执行。如果我们想要执行该文件，则需要创建一个 pre-commit 文件来代替它。</p>
</blockquote>
<blockquote>
<p>cat 指令：在命令行中输出指定文件的内容。</p>
</blockquote>
<p>11、创建 pre-commit 文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">touch pre<span class="token operator">-</span>commit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>pre-commit 文件中可以编写一些脚本，当 git 进行提交时，就会先去执行这个文件中的代码。</p>
</blockquote>
<blockquote>
<p>touch 指令 ：创建一个文件</p>
</blockquote>
<p>12、编辑 pre-commit 文件内容。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">vim pre<span class="token operator">-</span>commit

<span class="token comment">//pre-commit</span>

echo pre<span class="token operator">-</span>commit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>vim 指令： 编辑指定文件的内容。</p>
</blockquote>
<blockquote>
<p>vim 常用编辑指令：<br>
i 进入编辑状态<br>
 esc 退出编辑状态<br>
:wq 保存退出<br>
不按 i 键，按 d d 键两次 删除当前行</p>
</blockquote>
<blockquote>
<p>vim 指令 编辑文件时，需要先切换到文件所在的目录。</p>
</blockquote>
<p>12.2、给 pre-commit 添加可执行权限。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">chmod <span class="token operator">+</span>x <span class="token punctuation">.</span><span class="token operator">/</span>pre<span class="token operator">-</span>commit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/d4f6a83c14ee422db5d4c9fad74ff411%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<blockquote>
<p>错误：pre-commit 加不了可执行权限，为什么？？？</p>
</blockquote>
<p>13、返回项目根目录。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">cd <span class="token punctuation">.</span><span class="token punctuation">.</span>
cd <span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p>cd … ：返回上一级目录</p>
</blockquote>
<p>14、app.js。</p>
<p>随意写一些不符合 eslint 语法规范的代码，来进行测试。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello, eslint'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>15、git 操作。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git status
git add <span class="token punctuation">.</span>
git commit <span class="token operator">-</span>m <span class="token string">'2'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/471c2f744a5148cbaf39b6b632196961~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<blockquote>
<p>报错：提交失败了，pre-commit 也没有被执行。</p>
</blockquote>
<p>16、结论。</p>
<blockquote>
<p>12 步 和 15 步报错了，失败了。但是视频中老师却成功了，为什么？？？</p>
</blockquote>
<p>17、</p>
<p>假设我们在 12、15 步都成功了，继续往后进行。 17 步及以后 是视频截屏，记录老师的操作，方便以后学习。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/7a73bf1ad38242ed9177c884e566f10c%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>可以看到，提交时，pre-commit 文件被执行了，输出了’pre-commit’。我们接下来只需要在 pre-commit 文件中，写入 eslint 语法检查的代码即可。</p>
<p>18、编辑 pre-commit 文件的内容。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx eslint <span class="token punctuation">.</span><span class="token operator">/</span>src<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>19、提交。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git status
git add <span class="token punctuation">.</span>
git commit <span class="token operator">-</span>m <span class="token string">'3'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020916475.png" alt="image-20220124020916475"></p>
<p>20、结论。</p>
<p>当 app.js 中有不符合规范的代码时，提交失败，命令行中输出 eslint 报错信息。这样我们就成功地 在提交前 使用 pre-commit 来对代码进行语法检查了，如果检查不通过，则提交失败。如果检查通过，则提交成功。</p>
<h4 id="提交hooks"><a class="markdownIt-Anchor" href="#提交hooks">#</a> 提交 hooks</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124020956907.png" alt="image-20220124020956907"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021028466.png" alt="image-20220124021028466"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021042465.png" alt="image-20220124021042465"></p>
<h5 id="示例2也没有成功"><a class="markdownIt-Anchor" href="#示例2也没有成功">#</a> 示例 2：也没有成功。</h5>
<p>说明：从示例 1 的 10 步接着往下做。</p>
<p>11、我们回到项目的根目录下，新建一个文件夹，暂时命名为 &quot;.mygithooks&quot;。然后在此文件夹下，新增一个 git-hook 文件，命名为 &quot;pre-commit&quot;，并写入以下内容：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx eslint <span class="token punctuation">.</span><span class="token operator">/</span>src<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/d572b416f296429f8cf59becb35d44f1%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>12、好了，我们新建了自己的 git-hook，但此时 git 并不能识别。下面我们执行这行命令：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"># 项目根目录下

git config core<span class="token punctuation">.</span>hooksPath <span class="token punctuation">.</span>mygithooks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>上述命令给我们自己的文件，配置了 git-hook 的执行权限。</p>
<p>12.2 查看.git/config 文件内容。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">cd <span class="token punctuation">.</span>git 
ls <span class="token operator">-</span>la
cat config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/10917bb556114f6186328d7e520f0210%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>可以发现，config 文件中有一个 hooksPath 字段。</p>
<p>13、给.mygithooks/pre-commit 文件添加可执行权限。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">chmod <span class="token operator">+</span>x <span class="token punctuation">.</span>mygithooks<span class="token operator">/</span>pre<span class="token operator">-</span>commit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>14、提交。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git status
git add <span class="token punctuation">.</span>
git commit <span class="token operator">-</span>m <span class="token string">'3'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021129305.png" alt="image-20220124021129305"></p>
<p>15、结论。</p>
<p>提交时，pre-commit 执行成功，eslint 成功执行。这样，我们就成功使用 git hooks 来完成提交前对代码进行语法检查。</p>
<h4 id="husky"><a class="markdownIt-Anchor" href="#husky">#</a> husky</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/32af1e42a091451a8470ab5faf3b8dba%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<h5 id="示例3husky的基本使用-没有成功"><a class="markdownIt-Anchor" href="#示例3husky的基本使用-没有成功">#</a> 示例 3：husky 的基本使用。没有成功。</h5>
<p>0、搭建一个基本的 webpack 环境。</p>
<p>1、安装 husky。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install husky <span class="token operator">--</span>save<span class="token operator">-</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、启用 Git hooks。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx husky install<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、package.json 中，添加自定义脚本。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// package.json </span>

<span class="token punctuation">&#123;</span> 
    <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> 
        <span class="token string">"prepare"</span><span class="token operator">:</span> <span class="token string">"husky install"</span> 
    <span class="token punctuation">&#125;</span> 
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、创建一个 hook。</p>
<ul>
<li>在.husky 目录中新建一个文件 pre-commit。</li>
<li>在 pre-commit 文件中输入以下内容：</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx eslint <span class="token punctuation">.</span><span class="token operator">/</span>src<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/e2a0d763242a4c179bb95ce06c6947a3%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>4.2、给.husky/pre-commit 添加可执行权限。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">chmod <span class="token operator">+</span>x <span class="token punctuation">.</span>husky<span class="token operator">/</span>pre<span class="token operator">-</span>commit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/46064a9952ff412c9b9ed2f160957b8d%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>4.3、解决 4.2 步中出现的无法设置可执行权限的问题。</p>
<p>注意在 window 系统中提供 chmod 指令为文件添加可执行权限时，可能会无效。</p>
<p>需要在文件的第一行添加以下语句：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token hashbang comment">#!/bin/bash</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5、提交。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">git status
git add <span class="token punctuation">.</span>
git commit <span class="token operator">-</span>m <span class="token string">'husky-01'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021235321.png" alt="image-20220124021235321"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021243586.png" alt="image-20220124021243586"></p>
<p>6、结论。</p>
<p>5 步 执行提交时，报错了。而视频中老师却成功了。为什么？？？</p>
<hr>
<h2 id="第二章模块与依赖"><a class="markdownIt-Anchor" href="#第二章模块与依赖">#</a> 第二章：模块与依赖</h2>
<p>在模块化编程中，开发者将程序分解为功能离散的文件，并称之为模块。 每个模块都拥有小于完整程序的体积，使得验证、调试及测试变得轻而易举。 精心编写的模块提供了可靠的抽象和封装界限，使得应用程序中每个模块都具备了条理清晰的设计和明确的目的。</p>
<p>Node.js 从一开始就支持模块化编程。 但，浏览器端的模块化还在缓慢支持中 —— 截止到 2021，大多主流浏览器已支持 ESM 模块化，因此基于 ESM 的打包工具生态逐渐开始活跃。</p>
<p>在前端工程化圈子里存在多种支持 JavaScript 模块化的工具，这些工具各有优势和限制。 Webpack 从这些系统中汲取了经验和教训，并将 模块 的概念应用到项目的任何文件中。</p>
<h3 id="21-webpack-模块与解析原理"><a class="markdownIt-Anchor" href="#21-webpack-模块与解析原理">#</a> 2.1 Webpack 模块与解析原理</h3>
<p>在讲 webpack 模块解析之前，我们先了解下 webpack 模块的概念，以及简单探究下 webpack 的具体实现。</p>
<h4 id="webpack-模块"><a class="markdownIt-Anchor" href="#webpack-模块">#</a> webpack 模块</h4>
<p>◆ <strong>何为 webpack 模块</strong></p>
<p>能在 webpack 工程化环境里成功导入的模块，都可以视作 webpack 模块。 与 Node.js 模块相比，webpack 模块 能以各种方式表达它们的依赖关系。下面是一些示例：</p>
<ul>
<li>ES2015 import 语句</li>
<li>CommonJS require () 语句</li>
<li>AMD define 和 require 语句</li>
<li>css/sass/less 文件中的 @import 语句</li>
<li>stylesheet  <code>url(...)</code>  或者 HTML  <code>&lt;img src=...&gt;</code>  文件中的图片链接</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021339322.png" alt="image-20220124021339322"></p>
<p>◆ <strong>支持的模块类型</strong></p>
<p>Webpack 天生支持如下模块类型：</p>
<ul>
<li>ECMAScript 模块</li>
<li>CommonJS 模块</li>
<li>AMD 模块</li>
<li>Assets</li>
<li>WebAssembly 模块</li>
</ul>
<p>而我们早就发现 —— 通过 loader 可以使 webpack 支持多种语言和预处理器语法编写的模块。loader 向 webpack 描述了如何处理非原生模块，并将相关依赖引入到你的 bundles 中。包括且不限于：</p>
<ul>
<li>TypeScript</li>
<li>Sass</li>
<li>Less</li>
<li>JSON</li>
<li>YAML</li>
</ul>
<p>总的来讲，这些都可以被认为是 webpack 模块。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021358840.png" alt="image-20220124021358840"></p>
<h4 id="compiler与resolvers"><a class="markdownIt-Anchor" href="#compiler与resolvers">#</a> compiler 与 Resolvers</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021409852.png" alt="image-20220124021409852"></p>
<p>在我们运行 webpack 的时候 (就是我们执行 webpack 命令进行打包时)，其实就是相当于执行了下面的代码：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token comment">// ...这是我们配置的webpackconfig对象</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>webpack 的执行会返回一个描述 webpack 打包编译整个流程的对象，我们将其称之为 compiler。 compiler 对象描述整个 webpack 打包流程 ——— 它内置了一个打包状态，随着打包过程的进行，状态也会实时变更，同时触发对应的 webpack 生命周期钩子。 (简单点讲，我们可以将其类比为一个 Promise 对象，状态从打包前，打包中到打包完成或者打包失败。) 每一次 webpack 打包，就是创建一个 compiler 对象，走完整个生命周期的过程。</p>
<p>而 webpack 中所有关于模块的解析，都是 compiler 对象里的内置模块解析器去工作的 ———— 简单点讲，你可以理解为这个对象上的一个属性，我们称之为 Resolvers。 webpack 的 Resolvers 解析器的主体功能就是模块解析，它是基于 enhanced-resolve 这个包实现的。换句话讲，在 webpack 中，无论你使用怎样的模块引入语句，本质其实都是在调用这个包的 api 进行模块路径解析。</p>
<hr>
<h3 id="22-模块解析resolve"><a class="markdownIt-Anchor" href="#22-模块解析resolve">#</a> 2.2 模块解析 (resolve)</h3>
<p>webpack 通过 Resolvers 实现了模块之间的依赖和引用。举个例子：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
<span class="token keyword">const</span> add <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/add'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>所引用的模块可以是来自应用程序的代码，也可以是第三方库。 resolver 帮助 webpack 从每个 require/import 语句中，找到需要引入到 bundle 中的模块代码。当打包模块时，webpack 使用 enhanced-resolve 来解析文件路径。(webpack_resolver 的代码实现很有思想，webpack 基于此进行 treeshaking，这个概念我们后面会讲到)。</p>
<h4 id="1-webpack中的模块路径解析规则"><a class="markdownIt-Anchor" href="#1-webpack中的模块路径解析规则">#</a> 1、webpack 中的模块路径解析规则</h4>
<p>通过内置的 enhanced-resolve，webpack 能解析三种文件路径：</p>
<p>● 绝对路径</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'/home/me/file'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'C:\\Users\\me\\file'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>由于已经获得文件的绝对路径，因此不需要再做进一步解析。</p>
<p>● 相对路径</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'../utils/reqFetch'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这种情况下，使用 import 或 require 的资源文件所处的目录，被认为是上下文目录。 在 import/require 中给定的相对路径，enhanced-resolve 会拼接此上下文路径，来生成模块的绝对路径 <code>path.resolve(__dirname, RelativePath)</code>  。 这也是我们在写代码时最常用的方式之一，另一种最常用的方式则是模块路径。</p>
<p>● 模块路径</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'module'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'module/lib/file'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>也就是在 resolve.modules 中指定的所有目录检索模块 (node_modules 里的模块已经被默认配置了)。 你可以通过配置别名的方式来替换初始模块路径， 具体请参照下面 resolve.alias 配置选项。</p>
<blockquote>
<p>绝对路径：可以在最前面使用一个 斜杆 / 表示当前项目的根目录路径。<br>
模块路径：会去 node_modules 中去找。<br>
相对路径：是相当于当前文件的路径。</p>
</blockquote>
<h4 id="2-resolve"><a class="markdownIt-Anchor" href="#2-resolve">#</a> 2、resolve</h4>
<h5 id="alias-设置目录别名"><a class="markdownIt-Anchor" href="#alias-设置目录别名">#</a> alias 设置目录别名</h5>
<p>我们可以通过 resolve.alias 来自定义配置模块路径。</p>
<blockquote>
<p>alias 英 [ˈeɪliəs] n. 别名；<br>
 为什么要使用别名呢？因为项目的目录结构如果非常深，使用相对路径来查找文件时，会非常麻烦。此时，可以为某个目录起一个别名，来简化路径，方便查找。</p>
</blockquote>
<p>现在我们来是实现一下：首先，我们 src 目录下新建一个 utils 文件夹，并新建一个 add.js 文件，对外暴露出一个 add 函数。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// src/utils/add.js</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后我们在 src/index.js 中基于相对路径引用并使用它：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> add <span class="token keyword">from</span> <span class="token string">'./utils/add'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>很好，代码跑起来了并且没有报错。 这时我们期望能用 @utils/add 的方式去引用它，于是我们这样写了：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> add <span class="token keyword">from</span> <span class="token string">'@utils/add'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>很明显它会报错，因为 webpack 会将其当做一个模块路径来识别 ——— 所以无法找到 @utils 这个模块。 这时，我们配置下 resolve：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        alias<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"@utils"</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src/utils/'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如代码所示，我们将 utils 文件夹的绝对路径配置为一个模块路径，起一个别名为 “@utils”。 重启服务发现，代码跑起来了。模块识别成功了。</p>
<h5 id="省略后缀名"><a class="markdownIt-Anchor" href="#省略后缀名">#</a> 省略后缀名</h5>
<p>引入模块时，可以省略.js 后缀名，只写文件名。webpack 会自动优先查找.js 后缀的同名文件。</p>
<h5 id="extentions-设置查找优先级"><a class="markdownIt-Anchor" href="#extentions-设置查找优先级">#</a> extentions 设置查找优先级</h5>
<blockquote>
<p>resolve.extentions 选项 设置 webpack 查找文件时的优先级。</p>
</blockquote>
<p>上述代码中我们发现，只需要 “import add from ‘@utils/add’”, webpack 就可以帮我们找到 add.js。 事实上，这与 import add from ‘@utils/add.js’ 的效果是一致的。 为什么会这样？ 原来 webpack 的内置解析器已经默认定义好了一些 文件 / 目录 的路径解析规则。 比如当我们</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">'./utils'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>utils 是一个文件目录而不是模块 (文件)，但 webpack 在这种情况下默认帮我们添加了后缀 “/index.js”，从而将此相对路径指向到 utils 里的 index.js。 这是 webpack 解析器默认内置好的规则。 那么现在有一个问题： 当 utils 文件夹下同时拥有 add.js、add.json 时，&quot;@utils/add&quot; 会指向谁呢？ @utils/add.json</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
    <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"add"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>我们发现仍然指向到 add.js。 当我们删掉 add.js, 会发现此时的引入的 add 变成了一个 json 对象。 上述现象似乎表明了这是一个默认配置的优先级的问题。 而 webpack 对外暴露了配置属性: resolve.extentions , 它的用法形如：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">,</span> <span class="token string">'.wasm'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>webpack 会按照数组顺序去解析这些后缀名，对于同名的文件，webpack 总是会先解析列在数组首位的后缀名的文件。</p>
<h5 id="一些例子"><a class="markdownIt-Anchor" href="#一些例子">#</a> 一些例子</h5>
<p><strong>◎ 示例 1：自定义模块 和 第三方模块。</strong></p>
<p>1、在项目中搭建一个基本的 webpack 环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install webpack webpack<span class="token operator">-</span>cli <span class="token operator">--</span>save<span class="token operator">-</span>dev
npm install lodash <span class="token operator">--</span>save<span class="token operator">-</span>dev

<span class="token comment">//webpack.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、编辑应用代码。</p>
<p>在入口文件中，分别使用 ESModule、Commonjs 来引入第三方模块 lodash 和自定义 math.js。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021927015.png" alt="image-20220124021927015"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//math.js</span>

<span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">&#125;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    add
<span class="token punctuation">&#125;</span>

<span class="token comment">//index.js</span>

<span class="token keyword">const</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/math.js'</span><span class="token punctuation">)</span> <span class="token comment">//引入自定义模块</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span> <span class="token comment">//引入第三方模块</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hellow'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5、执行。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">node main<span class="token punctuation">.</span>js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021937356.png" alt="image-20220124021937356"></p>
<p>6、结论。</p>
<p>可以看到 webpack 打包成功，自定义模块和第三方模块的代码也成功执行了。 这个例子说明了 webpack 天生就支持打包自定义模块和第三方模块。</p>
<p><strong>◎ 示例 2：webpack 解析绝对路径。</strong></p>
<p>在示例 1 的基础上，在 index.js 中，将自定义模块 math.js 的引用路径修改为绝对路径：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'/src/utils/math.js'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>重新打包，执行打包后的 bundle 文件。 可以发现，main.js 正常执行。 结论：webpack 能够解析以绝对路径来引入的模块。</p>
<p><strong>◎ 示例 3：使用路径别名。</strong></p>
<p>1. 在 webpack.config.js 文件中，添加一个 resolve.alias 选项，来为某个目录设置别名。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124021956862.png" alt="image-20220124021956862"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'pah'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//设置目录别名</span>
        alias<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'@'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2. 使用目录别名。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//使用别名：@ 表示src目录</span>
<span class="token keyword">const</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/utils/math.js'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hellow'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3. 重新打包，执行。</p>
<p>执行成功。说明我们配置目录别名成功了。</p>
<hr>
<h3 id="23-外部扩展externals"><a class="markdownIt-Anchor" href="#23-外部扩展externals">#</a> 2.3 外部扩展 (Externals)</h3>
<p>有时候我们为了减小 bundle 的体积，从而把一些不变的第三方库用 cdn 的形式引入进来，比如 jQuery： index.html</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js"</span> <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>这个时候我们想在我们的代码里使用引入的 jquery——— 但似乎三种模块引入方式都不行，这时候怎么办呢？ webpack 给我们提供了 Externals 的配置属性，让我们可以配置外部扩展模块:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    externals<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        jquery<span class="token operator">:</span> <span class="token string">'jQuery'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>我们不想本地安装 jquery，也不想直接放在 window 对象上，希望类似于已经安装好的方式来载入这个包，该怎么办呢？</p>
</blockquote>
<p>我们尝试在代码中使用 jQuery:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// index.js</span>
<span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>发现打印成功，这说明我们已经在代码中使用它。 注意：我们如何得知 {jquery:‘jQuery’} 中的 ‘jQuery’? 其实就是 cdn 里打入到 window 中的变量名，比如 jQuery 不仅有 jQuery 变量名，还有 $，那么我们也可以写成这样子:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    externals<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        jquery<span class="token operator">:</span> <span class="token string">'$'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>重启服务后发现，效果是一样的。</p>
<h4 id="自动引入cdn链接"><a class="markdownIt-Anchor" href="#自动引入cdn链接">#</a> 自动引入 cdn 链接</h4>
<p>在 html 文件中，添加 script 标签和 cdn 链接，可以引入第三方模块，但是手动的效率比较低，能不能让 webpack 自动帮助我们来做呢？</p>
<p><strong>修改 externals 选项，而且添加一个 externalsType 选项。</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    externalsType<span class="token operator">:</span> <span class="token string">'script'</span><span class="token punctuation">,</span>
    externals<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        jquery<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">'https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js'</span><span class="token punctuation">,</span>
            <span class="token string">'jquery'</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>value 改为一个数组，第一个元素：第三方包的 cdn 链接，第二个元素：第三方包在 window 上暴露的对象。</p>
<p>externalsType：指定用 script 标签来引入 cdn 链接。</p>
<hr>
<h3 id="24-依赖图dependency-graph"><a class="markdownIt-Anchor" href="#24-依赖图dependency-graph">#</a> 2.4 依赖图 (dependency graph)</h3>
<p>每当一个文件依赖另一个文件时，webpack 会直接将文件视为存在依赖关系。 这使得 webpack 可以获取非代码资源，如 images 或 web 字体等。并会把它们作为 依赖 提供给应用程序。 当 webpack 开始工作时，它会根据我们写好的配置，从 入口 (entry) 开始，webpack 会递归的构建一个 依赖关系图，这个依赖图包含着应用程序中所需的每个模块，然后将所有模块打包为 bundle (也就是 output 的配置项)。</p>
<p>单纯讲似乎很抽象，我们更期望能够可视化打包产物的依赖图，下边列示了一些 bundle 分析工具。</p>
<p>bundle 分析 (bundle analysis) 工具：</p>
<p>官方分析工具 是一个不错的开始。还有一些其他社区支持的可选项：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Falexkuz.github.io%2Fwebpack-chart%2F">webpack-chart</a>: webpack stats 可交互饼图。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fchrisbateman.github.io%2Fwebpack-visualizer%2F">webpack-visualizer</a>: 可视化并分析你的 bundle，检查哪些模块占用空间，哪些可能是重复使用的。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwebpack-contrib%2Fwebpack-bundle-analyzer">webpack-bundle-analyzer</a>：一个 plugin 和 CLI 工具，它将 bundle 内容展示为一个便捷的、交互式、可缩放的树状图形式。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.jakoblind.no%2Foptimize">webpack bundle optimize helper</a>：这个工具会分析你的 bundle，并提供可操作的改进措施，以减少 bundle 的大小。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frelative-ci%2Fbundle-stats">bundle-stats</a>：生成一个 bundle 报告（bundle 大小、资源、模块），并比较不同构建之间的结果。</li>
</ul>
<p>我们来使用 webpack-bundle-analyzer 实现。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"># 首先安装这个插件作为开发依赖

# <span class="token constant">NPM</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer

# Yarn
yarn add <span class="token operator">-</span><span class="token constant">D</span> webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后我们配置它:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// ...others</span>
        <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这时我们执行打包命令，发现控制台里打印出下面这样的日志：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">Webpack Bundle Analyzer is started at http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">8888</span>
Use Ctrl<span class="token operator">+</span><span class="token constant">C</span> to close it
asset bundle<span class="token punctuation">.</span>js <span class="token number">5.46</span> KiB <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span> <span class="token punctuation">[</span>minimized<span class="token punctuation">]</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> main<span class="token punctuation">)</span> <span class="token number">1</span>
related asset
asset index<span class="token punctuation">.</span>html <span class="token number">352</span> bytes <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>
orphan modules <span class="token number">2.35</span> KiB <span class="token punctuation">[</span>orphan<span class="token punctuation">]</span> <span class="token number">3</span> modules
<span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们在浏览器中打开 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8888">http://127.0.0.1:8888</a> ，我们成功可视化了打包产物依赖图！</p>
<p>注意： 对于 HTTP/1.1 的应用程序来说，由 webpack 构建的 bundle 非常强大。当浏览器发起请求时，它能最大程度的减少应用的等待时间。 而对于 HTTP/2 来说，我们还可以使用代码分割进行进一步优化。(开发环境观测的话需要在 DevServer 里进行配置 {http2:true, https:false})。这个我们会在之后的课程里讲。</p>
<h4 id="示例"><a class="markdownIt-Anchor" href="#示例">#</a> ◎ 示例</h4>
<p>1. 搭建测试项目。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
npm install <span class="token operator">--</span>save lodash 
<span class="token comment">//安装依赖图插件</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/d9ca604f06c64d55b032482ca26c7196%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>2. 编辑测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//math.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">&#125;</span>

<span class="token comment">//app.js</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> add <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./math.js'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//app2.js</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'lodash' */</span> <span class="token string">'lodash'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> _ <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>1、 <code>/* webpackChunkName: 'lodash' */</code>  是一个魔法注释，告诉 webpack 在打包时，将当前导入的模块单独打包成一个文件，文件名为 lodash。此时，lodash 是动态加载的。<br>
2、import () 方法返回的是一个 promise，可以链式调用 then () 方法。then () 方法中可以拿到模块导出的数据。<br>
3、 <code>default：_</code>  表示将 lodash 默认导出的对象重命名为下划线。default 表示默认导出的对象。<br>
4、设置了两个入口文件：app.js、app2.js。 app.js 中引用了自定义模块 math.js。 app2.js 中引用了第三方模块 lodash。</p>
</blockquote>
<p>3. 配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">//导入依赖图插件</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> BundleAnalyzerPlugin <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        app<span class="token operator">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
        app2<span class="token operator">:</span> '<span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>app2<span class="token punctuation">.</span>js
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4. 打包，启动开发服务器，浏览器执行效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/896ef9e68e0f4c808056675034573747%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/49771dbd948844979570441a60a2c6ed%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022125189.png" alt="image-20220124022125189"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/60cfb9112c154e5f94d4a387ee702a82%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>5. 结论。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/fa9754258a4c40a39c841bd06ff6c7f5%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<blockquote>
<p>1、执行打包，webpack-bundle-analyzer 插件会自动打开一个浏览器页面 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A8888%2F">http://127.0.0.1:8888/</a> ，显示当前项目的模块依赖图。</p>
</blockquote>
<blockquote>
<p>2、左侧是工具栏。工具栏中，有三种统计方式： Stat、Parsed、Gzipped，分别表示统计、解析、gzip，还列出了各个 bundle 的体积大小。</p>
</blockquote>
<blockquote>
<p>3、右侧是图形化的模块信息，列出了当前项目打包输出了哪些模块。每个矩形框都是一个输出的 bundle，它们有不同的背景色，其中偏蓝色的是静态加载的模块，即以 script 标签引入的。偏白色的是动态加载的模块。</p>
</blockquote>
<blockquote>
<p>4、通过使用 webpack-bundle-analyzer 插件，可以很方便地看出项目打包输出了多少个 bundle，每个 bundle 的体积，以及它们之间的依赖关系。</p>
</blockquote>
<hr>
<h2 id="第三章扩展功能"><a class="markdownIt-Anchor" href="#第三章扩展功能">#</a> 第三章：扩展功能</h2>
<h3 id="31-postcss与css模块"><a class="markdownIt-Anchor" href="#31-postcss与css模块">#</a> 3.1 PostCSS 与 CSS 模块</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpostcss%2Fpostcss%23usage">PostCSS</a> 是一个用 JavaScript 工具和插件转换 CSS 代码的工具。比如可以使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpostcss%2Fautoprefixer">Autoprefixer</a> 插件自动获取浏览器的流行度和能够支持的属性，并根据这些数据帮我们自动的 为 CSS 规则添加前缀，将最新的 CSS 语法转换成大多数浏览器都能理解的语法。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcss-modules%2Fcss-modules">CSS</a> 模块 能让你永远不用担心命名太大众化而造成冲突，只要用最有意义的名字就行了。</p>
<h4 id="postcss"><a class="markdownIt-Anchor" href="#postcss">#</a> PostCSS</h4>
<p>PosetCSS 与 Webpack 结合，需要安装 style-loader , css-loader , postcss-loader 三个 loader：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                <span class="token string">'postcss-loader'</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后在项目根目录下创建 postcss.config.js :</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-nested'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>插件 autoprefixer 提供自动给样式加前缀去兼容浏览器， postcss-nested 提供编写嵌套的样式语法。</p>
<p>最后，在 package.json 内增加如下实例内容：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"> 1%"</span><span class="token punctuation">,</span>
    <span class="token string">"last 2 versions"</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>数组内的值对应的含义：<br>
1.last 2 versions : 每个浏览器中最新的两个版本。<br>
2.&gt; 1% or &gt;= 1% : 全球浏览器使用率大于 1% 或大于等于 1%。</p>
<blockquote>
<p>autoprefixer、postcss-nested 都是 postcss 的插件。<br>
autoprefixer：为 css 样式添加兼容前缀。<br>
postcss-nested：允许我们在.css 文件中使用嵌套语法，来简化选择器的编写。</p>
</blockquote>
<h4 id="css-模块"><a class="markdownIt-Anchor" href="#css-模块">#</a> CSS 模块</h4>
<p>目前还有一个问题，就是多人编写的样式可能会冲突，开启 CSS 模块可以解决这个问题。</p>
<p>webpack.config.js 配置：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span>
                    loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">// 开启css模块</span>
                        modules<span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token string">'postcss-loader'</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>样式文件 style.css :</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">body <span class="token punctuation">&#123;</span>
    display<span class="token operator">:</span> flex<span class="token punctuation">;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> pink<span class="token punctuation">;</span>

    <span class="token comment">//定义一个类样式 .box</span>
    <span class="token punctuation">.</span>box<span class="token punctuation">&#123;</span>
        width<span class="token operator">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
        height<span class="token operator">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
        background<span class="token operator">-</span>color<span class="token operator">:</span> green<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 js 文件里导入 css 文件：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 开启 css 模块后，可以导入模块</span>
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'./style.css'</span>
<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
div<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'hello webpack'</span>

<span class="token comment">// style 里可以识别 class 样式</span>
div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span>box<span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>也可以部分开启 CSS 模块模式，比如全局样式可以冠以 .global 前缀，如：</p>
<ol>
<li>*.global.css 普通模式</li>
<li>*.css css module 模式</li>
</ol>
<blockquote>
<pre class="line-numbers language-none"><code class="language-none">如何理解 部分开启 CSS 模块模式？<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>某些样式需要使用 css 模块 来进行唯一性标识，避免被同名覆盖，而另一些样式是全局的，需要覆盖其它同名的样式，则不需要使用 css 模块。</p>
<p>如 全局样式 是统一的，需要覆盖同名的自定义样式，所以不使用 css 模块，而我们自己的样式则不希望被其它人的同名样式覆盖，则 使用 css 模块。</p>
</blockquote>
<p>这里统一用 global 关键词进行识别。用正则表达式匹配文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/3f0851cbfd7a43a2bcb234b39f529054%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token number">1</span>、<span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^(?!.*\\.global).*\\.css</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> 这个正则表达式用来匹配后缀名中包 <span class="token punctuation">.</span>global 的<span class="token punctuation">.</span>css文件，即全局样式文件，则不需要开启css module。
<span class="token number">2</span>、<span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^(.*\\.global).*\\.css</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> 这个正则表达式用来匹配后缀名中不包 <span class="token punctuation">.</span>global 的<span class="token punctuation">.</span>css文件，即普通样式文件，则需要开启css module。
<span class="token number">3</span>、exclude选项：排除node_modules目录下的css文件，即不需要为第三方包的css文件为来设置css module。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h5 id="示例autoprefixer插件的基本使用"><a class="markdownIt-Anchor" href="#示例autoprefixer插件的基本使用">#</a> ◎ 示例：autoprefixer 插件的基本使用。</h5>
<p>1、搭建测试项目。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y 
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin

npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev style<span class="token operator">-</span>loader css<span class="token operator">-</span>loader

npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev postcss<span class="token operator">-</span>loader
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev autoprefixer
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev postcss<span class="token operator">-</span>nested<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/5bd1365405114e0b8c31a0a90c1acb47%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>2、编辑测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//style.css</span>
body <span class="token punctuation">&#123;</span>
    display<span class="token operator">:</span> flex<span class="token punctuation">;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//app.js</span>
<span class="token keyword">import</span> <span class="token string">'./style.css'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、webpack.config.js 。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//关键代码</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、postcss.config.js 。<br>
在项目根目录新建一个 postcss.config.js 文件，写入以下内容：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5、package.json 。<br>
在 package.json 中添加一个 browserslist 选项。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"> 1%"</span><span class="token punctuation">,</span>
    <span class="token string">"last 2 versions"</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>6、打包、启动服务器、浏览器执行效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022241668.png" alt="image-20220124022241668"></p>
<p>7、结论。</p>
<p>autoprefixer 插件成功为 flex 属性添加了兼容性前缀 -webkit 和 -ms。</p>
<h4 id="示例postcss-nested插件的基本使用"><a class="markdownIt-Anchor" href="#示例postcss-nested插件的基本使用">#</a> ◎ 示例：postcss-nested 插件的基本使用。</h4>
<p>在示例 1 的基础上，继续练习。</p>
<p>1、postcss.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//配置postcss-nested插件</span>
        <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'postcss-nested'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、style.css</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">body <span class="token punctuation">&#123;</span>
    display<span class="token operator">:</span> flex<span class="token punctuation">;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> pink<span class="token punctuation">;</span>

    <span class="token comment">/* 嵌套 */</span>
    div<span class="token punctuation">&#123;</span>
        width<span class="token operator">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
        height<span class="token operator">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
        background<span class="token operator">-</span>color<span class="token operator">:</span> green<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、ap.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./style.css'</span>

<span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包、启动服务器、浏览器执行效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022303113.png" alt="image-20220124022303113"></p>
<p>5、结论。</p>
<p>可以发现，postcss 插件 能够解析.css 文件中的嵌套代码，转换成浏览器能够识别的正常的样式代码。</p>
<h5 id="示例css模块的基本使用"><a class="markdownIt-Anchor" href="#示例css模块的基本使用">#</a> ◎ 示例：css 模块的基本使用。</h5>
<p>在示例 2 的基础上，继续练习。</p>
<p>1、编辑测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//webpack.config.js</span>
module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">'style-loader'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span>
                    loader<span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">// 开启css模块</span>
                        modules<span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token string">'postcss-loader'</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

<span class="token comment">//app.js</span>
<span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">'./style.css'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span>

<span class="token keyword">let</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span> 
div<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'hello css module'</span>
div<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span>box<span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>

<span class="token comment">//style.css</span>
body <span class="token punctuation">&#123;</span>
    display<span class="token operator">:</span> flex<span class="token punctuation">;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> pink<span class="token punctuation">;</span>

    <span class="token punctuation">.</span>box<span class="token punctuation">&#123;</span>
        width<span class="token operator">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
        height<span class="token operator">:</span> <span class="token number">100</span>px<span class="token punctuation">;</span>
        background<span class="token operator">-</span>color<span class="token operator">:</span> green<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、打包、启动服务器、浏览器执行效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022352215.png" alt="image-20220124022352215"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022358643.png" alt="image-20220124022358643"></p>
<p>3、结论。</p>
<blockquote>
<p>1、css module 会将.css 文件中的类名 变成一个个具有唯一性的哈希值。<br>
2、Vue、React 框架也使用了 css module 机制，来避免样式的冲突。</p>
</blockquote>
<hr>
<h3 id="32-web-works"><a class="markdownIt-Anchor" href="#32-web-works">#</a> 3.2 Web Works</h3>
<p>有时我们需要在客户端进行大量的运算，但又不想让它阻塞我们的 js 主线程。你可能第一时间考虑到的是异步。<br>
但事实上，运算量过大 (执行时间过长) 的异步也会阻塞 js 事件循环，甚至会导致浏览器假死状态。<br>
这时候，HTML5 的新特性 WebWorker 就派上了用场。<br>
在此之前，我们简单的了解下这个特性。</p>
<p>html5 之前，打开一个常规的网页，浏览器会启用几个线程？<br>
一般而言，至少存在三个线程 (公用线程不计入在内):<br>
 分别是 js 引擎线程 (处理 js)、GUI 渲染线程 (渲染页面)、浏览器事件触发线程 (控制交互)。</p>
<p>当一段 JS 脚本长时间占用着处理机，就会挂起浏览器的 GUI 更新，而后面的事件响应也被排在队列中得不到处理，从而造成了浏览器被锁定进入假死状态。</p>
<p>现在如果遇到了这种情况，我们可以做的不仅仅是优化代码 ————html5 提供了解决方案，webworker。</p>
<p>webWorkers 提供了 js 的后台处理线程的 API，它允许将复杂耗时的单纯 js 逻辑处理放在浏览器后台线程中进行处理，让 js 线程不阻塞 UI 线程的渲染。</p>
<p>多个线程间也是可以通过相同的方法进行数据传递。</p>
<p>它的使用方式如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//new Worker(scriptURL: string | URL, options?: WorkerOptions)</span>
<span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">"someWorker.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>也就是说，需要单独写一个 js 脚本，然后使用 new Worker 来创建一个 Work 线程实例。<br>
这意味着并不是将这个脚本当做一个模块引入进来，而是单独开一个线程去执行这个脚本。</p>
<p>我们知道，常规模式下，我们的 webpack 工程化环境只会打包出一个 bundle.js，那我们的 worker 脚本怎么办？也许你会想到设置多入口 (Entry) 多出口 (ouotput) 的方式。事实上不需要那么麻烦，webpack4 的时候就提供了 worker-loader 专门配置 webWorker。令人开心的是，webpack5 之后就不需要用 loader 啦，因为 webpack5 内置了这个功能。</p>
<p>我们来试验一下：<br>
● 第一步<br>
创建一个 work 脚本 work.js, 我们甚至不需要写任何内容，我们的重点不是 webWorker 的使用，而是在 webpack 环境中使用这个特性。当然，也可以写点什么，比如：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/330db6a6d95a424198f3541db04be396%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"> ● 在 index.js 中使用它</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022427786.png" alt="image-20220124022427786"></p>
<p>(import.meta.url 这个参数能够锁定我们当前的这个模块 —— 注意，它不能在 commonjs 中使用。)<br>
 这时候我们执行打包命令，会发现，dist 目录下除了 bundle.js 之外，还有另外一个 xxx.bundle.js!<br>
 这说明我们的 webpack5 自动的将被 new Work 使用的脚本单独打出了一个 bundle。</p>
<p>我们加上刚才的问答代码，执行 npm run dev，发现它是能够正常工作。并且在 network 里也可以发现多了一个 src_worker_js.bundle.js。</p>
<p>总结： webpack5 以来内置了很多功能，让我们不需要过多的配置，比如之前讲过的 hot 模式，和现在的 web workder。</p>
<h4 id="示例-2"><a class="markdownIt-Anchor" href="#示例-2">#</a> ◎ 示例</h4>
<p>1、搭建 webpack 环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y 
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2、搭建测试项目。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/44811b54bc7d4ddca9fbe90d85971199%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//work.js</span>
self<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        answer<span class="token operator">:</span> <span class="token number">666</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//app.js</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'./work.js'</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> 

worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    question<span class="token operator">:</span> <span class="token string">'hi,那边的worker线程，请告诉我今天的幸运数字是多少？'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

worker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>data<span class="token punctuation">.</span>answer<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、打包、启动服务器、浏览器执行效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/849c0f545eaa48bab88f3efdcc6a704a%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022506246.png" alt="image-20220124022506246"></p>
<p>4、结论。</p>
<p>可以看到，work.js 被单独打包输出成一个文件，而且它在浏览器中正常执行了。</p>
<hr>
<h3 id="33-typescript"><a class="markdownIt-Anchor" href="#33-typescript">#</a> 3.3 TypeScript</h3>
<p>在前端生态里，TS 扮演着越来越重要的角色。 我们直入正题，讲下如何在 webpack 工程化环境中集成 TS。</p>
<p>首先，当然是安装我们的 ts 和对应的 loader。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev typescript ts<span class="token operator">-</span>loader<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>接下来我们需要在项目根目录下添加一个 ts 的配置文件 ————tsconfig.json，我们可以用 ts 自带的工具来自动化生成它。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx tsc <span class="token operator">--</span>init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我们发现生成了一个 tsconfig.json，里面注释掉了绝大多数配置。 现在，根据我们想要的效果来打开对应的配置。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
    <span class="token string">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"outDir"</span><span class="token operator">:</span> <span class="token string">"./dist/"</span><span class="token punctuation">,</span>
        <span class="token string">"noImplicitAny"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string">"module"</span><span class="token operator">:</span> <span class="token string">"es6"</span><span class="token punctuation">,</span>
        <span class="token string">"target"</span><span class="token operator">:</span> <span class="token string">"es5"</span><span class="token punctuation">,</span>
        <span class="token string">"jsx"</span><span class="token operator">:</span> <span class="token string">"react"</span><span class="token punctuation">,</span>
        <span class="token string">"allowJs"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>好了，接下来我们新增一个 src/index.ts，内置一些内容。<br>
然后我们别忘了更改我们的 entry 及配置对应的 loder。<br>
当然，还有 resolve.extensions，将.ts 放在.js 之前，这样它会先找.ts。<br>
注意，如果我们使用了 sourceMap，一定记得和上面的 ts 配置一样，设置 sourcemap 为 true。<br>
也别忘记在我们的 webpack.config.js 里，添加 sourcemap, 就像我们之前课程里讲的那样。<br>
更改如下：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	entry<span class="token operator">:</span> <span class="token string">'./src/app.ts'</span><span class="token punctuation">,</span>
	output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
		path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		clean<span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
	devtool<span class="token operator">:</span> <span class="token string">'inline-source-map'</span><span class="token punctuation">,</span>
	devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	resolve<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
		rules<span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token punctuation">&#123;</span>
				test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ts$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				use<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
				exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">]</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行我们的项目，我们发现完全没有问题呢！</p>
<h4 id="使用第三方类库"><a class="markdownIt-Anchor" href="#使用第三方类库">#</a> 使用第三方类库</h4>
<p>在从 npm 上安装第三方库时，一定要记得同时安装这个库的类型声明文件 (typing definition)。<br>
我们可以从 TypeSearch 中找到并安装这些第三方库的类型声明文件 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fdt%2Fsearch%3Fsearch%3D">www.typescriptlang.org/dt/search?s…</a>) 。</p>
<p>举个例子，如果想安装 lodash 类型声明文件，我们可以运行下面的命令：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev @types<span class="token operator">/</span>lodash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="eslint-ts"><a class="markdownIt-Anchor" href="#eslint-ts">#</a> eslint &amp; ts</h4>
<p>注意，如果要使用 eslint，使用初始化命令的时候，记得选择 “使用了 typesctipt”。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx eslint <span class="token operator">--</span>init
# 往下选择的时候选择使用了typesctipt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>如果已经配置了 eslint，但没有配置 ts 相关的配置，那么我们需要先安装对应的 plugin：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">yarn add <span class="token operator">-</span><span class="token constant">D</span> @typescript<span class="token operator">-</span>eslint<span class="token operator">/</span>eslint<span class="token operator">-</span>plugin@latest @typescript<span class="token operator">-</span>eslint<span class="token operator">/</span>parser@latest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意如果需要用到 react 的话，记得也要安装</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">yarn add <span class="token operator">-</span><span class="token constant">D</span> eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>react@latest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>vue 或者其他常用框架同样如此，一般都会有专门的 plugin。</p>
<p>然后我们对.esilntrc 进行更改～</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022808991.png" alt="image-20220124022808991"></p>
<p>执行 npm run eslint 试一下！<br>
大功告成！</p>
<h4 id="一些示例"><a class="markdownIt-Anchor" href="#一些示例">#</a> 一些示例</h4>
<h5 id="示例webpack打包ts文件"><a class="markdownIt-Anchor" href="#示例webpack打包ts文件">#</a> ◎ 示例：webpack 打包.ts 文件。</h5>
<p>1、搭建 webpack 环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y 
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin

npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev typescript ts<span class="token operator">-</span>loader<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、搭建测试项目。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/e62757f8c14146269c39207e117a0102%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//app.ts</span>
<span class="token keyword">const</span> age<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">18</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>

<span class="token comment">//webpack.config.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/app.ts'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'inline-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    resolve<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ts$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、创建 tsconfig.json 文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx tsc <span class="token operator">--</span>init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3.2、修改 tsconfig.json 文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022836718.png" alt="image-20220124022836718"></p>
<p>4、打包、启动服务器、效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/f496999ce77e4966be030e9fb46ec72d%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>5、结论。</p>
<p>可以看到，.ts 文件被转换为了.js 文件，而且在浏览器中正常执行了。<br>
这说明，我们成功地让 webpack 来解析和打包.ts 文件。</p>
<h5 id="示例ts中使用第三方包"><a class="markdownIt-Anchor" href="#示例ts中使用第三方包">#</a> ◎ 示例：.ts 中使用第三方包。</h5>
<p>在示例 1 的基础上，继续练习。</p>
<p>1、安装 lodash。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install lodash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、安装 lodash 的类型文件。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/999e41a939ae49fbba34e6f9ee3f7898%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i @types<span class="token operator">/</span>lodash <span class="token operator">--</span>save<span class="token operator">-</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、app.ts</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token keyword">const</span> age<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">18</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包、启动服务器、效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124022903811.png" alt="image-20220124022903811"></p>
<p>5、结论。</p>
<p>可以发现，lodash 正常执行，说明我们成功在 ts 文件中使用了第三方包。</p>
<h2 id="小结-2"><a class="markdownIt-Anchor" href="#小结-2">#</a> 小结</h2>
<blockquote>
<p>1、 <code>/* webpackChunkName: 'lodash' */</code>  是一个魔法注释，告诉 webpack 在打包时，将当前要导入的模块单独打包成一个文件，文件名为 lodash。</p>
</blockquote>
<blockquote>
<p>2、import () 方法返回的是一个 promise，可以链式调用 then () 方法。</p>
</blockquote>
<hr>
<h2 id="第四章多页面应用"><a class="markdownIt-Anchor" href="#第四章多页面应用">#</a> 第四章：多页面应用</h2>
<p>为什么需要多页面应用？</p>
<p>在实际开发中，一个完整的系统不会将所有的功能都放在一个页面上，因为这样容易导致性能不佳。实际的做法是：按照 功能模块 划分成多个单页应用，每个单页应用都生成一个 html 文件。而且随着业务的发展，还可以在项目中逐渐加入更多的单页应用。</p>
<h3 id="41-entry-配置"><a class="markdownIt-Anchor" href="#41-entry-配置">#</a> 4.1 entry 配置</h3>
<h4 id="单个入口简写语法"><a class="markdownIt-Anchor" href="#单个入口简写语法">#</a> ● 单个入口（简写）语法</h4>
<p>用法： <code>entry: string | [string]</code></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>entry 属性的单个入口语法，参考下面的简写：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        main<span class="token operator">:</span> <span class="token string">'./path/to/my/entry/file.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们也可以将一个文件路径数组传递给 entry 属性，这将创建一个所谓的 “multi-main entry”。在你想要一次注入多个依赖文件，并且将它们的依赖关系绘制在一个 &quot;chunk&quot; 中时，这种方式就很有用。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/file_1.js'</span><span class="token punctuation">,</span> <span class="token string">'./src/file_2.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>当你希望通过一个入口（例如一个库）为应用程序或工具快速设置 webpack 配置时，单一入口的语法方式是不错的选择。然而，使用这种语法方式来扩展或调整配置的灵活性不大。</p>
<h4 id="对象语法"><a class="markdownIt-Anchor" href="#对象语法">#</a> ● 对象语法</h4>
<p>用法： <code>entry: &#123; &lt;entryChunkName&gt; string | [string] &#125; | &#123;&#125;</code></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        app<span class="token operator">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
        adminApp<span class="token operator">:</span> <span class="token string">'./src/adminApp.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对象语法会比较繁琐。然而，这是应用程序中定义入口的最可扩展的方式。</p>
<p><strong>描述入口的对象：</strong><br>
用于描述入口的对象。你可以使用如下属性：</p>
<ul>
<li>dependOn : 当前入口所依赖的入口。它们必须在该入口被加载前被加载。</li>
<li>filename : 指定要输出的文件名称。</li>
<li>import : 启动时需加载的模块。</li>
<li>library : 指定 library 选项，为当前 entry 构建一个 library。</li>
<li>runtime : 运行时 chunk 的名字。如果设置了，就会创建一个新的运行时 chunk。在 webpack 5.43.0 之后可将其设为 false 以避免一个新的运行时 chunk。</li>
<li>publicPath : 当该入口的输出文件在浏览器中被引用时，为它们指定一个公共 URL 地址。请查看 output.publicPath。</li>
</ul>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        a2<span class="token operator">:</span> <span class="token string">'dependingfile.js'</span><span class="token punctuation">,</span>
        b2<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            dependOn<span class="token operator">:</span> <span class="token string">'a2'</span><span class="token punctuation">,</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>runtime 和 dependOn 不应在同一个入口上同时使用，所以如下配置无效，并且会抛出错误：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        a2<span class="token operator">:</span> <span class="token string">'./a'</span><span class="token punctuation">,</span>
        b2<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            runtime<span class="token operator">:</span> <span class="token string">'x2'</span><span class="token punctuation">,</span>
            dependOn<span class="token operator">:</span> <span class="token string">'a2'</span><span class="token punctuation">,</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./b'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>确保 runtime 不能指向已存在的入口名称，例如下面配置会抛出一个错误：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        a1<span class="token operator">:</span> <span class="token string">'./a'</span><span class="token punctuation">,</span>
        b1<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            runtime<span class="token operator">:</span> <span class="token string">'a1'</span><span class="token punctuation">,</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./b'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>另外 dependOn 不能是循环引用的，下面的例子也会出现错误：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        a3<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./a'</span><span class="token punctuation">,</span>
            dependOn<span class="token operator">:</span> <span class="token string">'b3'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        b3<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./b'</span><span class="token punctuation">,</span>
            dependOn<span class="token operator">:</span> <span class="token string">'a3'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="一些示例-2"><a class="markdownIt-Anchor" href="#一些示例-2">#</a> 一些示例</h4>
<h5 id="示例1entry是一个数组"><a class="markdownIt-Anchor" href="#示例1entry是一个数组">#</a> ◎ 示例 1：entry 是一个数组。</h5>
<blockquote>
<p>entry 数组中可以列出多个入口文件，它们会被打包到同一个 bundle 中。</p>
</blockquote>
<p>1、搭建 webpack 环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm i <span class="token operator">-</span><span class="token constant">D</span> webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2、编写测试代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/a3a4828698f44201a64bdd71a7044d50%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//app.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app.js'</span><span class="token punctuation">)</span>

<span class="token comment">//app2.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app2.js'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//entry是一个数组</span>
    entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span> <span class="token string">'./src/app2.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包、启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1524ca3714eb4b71aea5ca7edcc7fa16~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/3697216e9341448388ca4f8fc9058fd2%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>5、结论。</p>
<p>1.app.js 和 app2.js 之间可以没有任何关系。<br>
2.entry 是一个数组时，里面列出的模块会被打包到同一个 bundle 中。<br>
3.entry 数组中的多个模块的执行顺序：从头部到尾部。</p>
<h5 id="示例2entry数组中包含第三方包"><a class="markdownIt-Anchor" href="#示例2entry数组中包含第三方包">#</a> ◎ 示例 2：entry 数组中包含第三方包。</h5>
<p>entry 数组中不仅可以写自定义的模块，还可以写第三方包。<br>
效果：自定义模块 和 第三方包 就会被打包到同一个 bundle 中。</p>
<p>1、安装 lodash。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i lodash
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、修改配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app2.js'</span><span class="token punctuation">,</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span> <span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、打包、启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>4、结论。</p>
<p>1. 示例 1 中，输出的 bundle（main.js）中只包含我们自定义的模块的代码，而示例 2 中还包含了第三方包的代码。</p>
<h5 id="示例3单独输出第三方包"><a class="markdownIt-Anchor" href="#示例3单独输出第三方包">#</a> ◎ 示例 3：单独输出第三方包。</h5>
<p>我们希望将 自定义模块 和 第三方模块 分开打包，并输出到不同的 bundle 中，该怎么办呢？</p>
<p>1、修改配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    main<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span><span class="token string">'./src/app2.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    lodash<span class="token operator">:</span> <span class="token string">'lodash'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、打包、启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c18bcedd4c974e0b96ce9e5b380ee84a~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c84634814e7544ef9052ea9f612c5d44~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p>3、结论。<br>
可以发现，输出了两个 bundle：main.js 和 lodash.js。</p>
<h5 id="示例4重复打包"><a class="markdownIt-Anchor" href="#示例4重复打包">#</a> ◎ 示例 4：重复打包。</h5>
<p>示例 3 中，app.js 和 app2.js 中都没有使用 lodash。打包后，main.js 的大小为 219kb，lodash 为 751kb。如果 app.js 中使用了 lodash，打包后 bundle 的体积会如何变化呢？</p>
<p>1、app.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app.js'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、打包、启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/628eddc492fc43a28eff8cf7881b70e4%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7bfe37133134d6ab6bb51adf05a1f45~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p>3、结论。</p>
<p>可以发现，lodash.js 体积没有变化，而 main.js 体积却变大了很多，几乎和 lodash.js 一样大。这说明 lodash 也被打包到 main.js 中了。</p>
<h5 id="示例5避免重复打包"><a class="markdownIt-Anchor" href="#示例5避免重复打包">#</a> ◎ 示例 5：避免重复打包。</h5>
<p>示例 4 存在一个问题：打包后的代码存在两份 lodash，导致代码重复冗余。如何解决呢？</p>
<p>可以通过  <code>dependOn选项</code>  将自定义模块中所依赖的第三方包 提取出来，单独打包。</p>
<p><code>import选项</code>  ：指定当前 bundle 的入口文件，可以有多个。</p>
<p>1、修改 entry。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    main<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">import</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span><span class="token string">'./src/app2.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        dependOn<span class="token operator">:</span> <span class="token string">'lodash'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    lodash<span class="token operator">:</span> <span class="token string">'lodash'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、打包、启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/3967f49ab3994a2c959baf84c5b9356b%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dfafb9552df84416bfba9335c7b15479~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p>3、结论。</p>
<p>打包输出了两个 bundle：main.js，lodash.js，它们的体积分别是 1.37kb、754kb，这说明打包后只存在一份 lodash，成功解决了重复打包的问题。</p>
<h5 id="示例6-多bundle引用相同的第三方包"><a class="markdownIt-Anchor" href="#示例6-多bundle引用相同的第三方包">#</a> ◎ 示例 6： 多 bundle 引用相同的第三方包。</h5>
<p>如果在多个 bundle 中都引用了同一个第三方包，会引起重复打包问题吗？</p>
<p>1、测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//app3.js</span>

<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    main<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">import</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span><span class="token string">'./src/app2.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        dependOn<span class="token operator">:</span> <span class="token string">'lodash'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    main2<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./src/app3.js'</span><span class="token punctuation">,</span>
        dependOn<span class="token operator">:</span> <span class="token string">'lodash'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    lodash<span class="token operator">:</span> <span class="token string">'lodash'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、打包、启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/449c8a52743343e4875d6181b8a80320%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/1804c0160f44454f9cb972ed1bf18006%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/25a6d52485944a1186e4ed9ae5e05d80%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20094c5852b043609dce7adb5804d3ac~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p>4、结论。</p>
<p>打包输出了 3 个 bundle：main.js、main2.js、lodash.js，它们的体积分别是：1.37kb、1.17kb、754kb，说明第三方包 lodash 只打包了一份，不存在重复打包问题。</p>
<hr>
<h3 id="42-配置index-html模板"><a class="markdownIt-Anchor" href="#42-配置index-html模板">#</a> 4.2 配置 index html 模板</h3>
<h4 id="生成多个html文件"><a class="markdownIt-Anchor" href="#生成多个html文件">#</a> 生成多个 HTML 文件</h4>
<p>要生成多个 HTML 文件，请在插件数组中多次声明插件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'/dist'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'index_bundle.js'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Generates default index.html</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token comment">// Also generate a test.html</span>
            filename<span class="token operator">:</span> <span class="token string">'test.html'</span><span class="token punctuation">,</span>
            template<span class="token operator">:</span> <span class="token string">'src/assets/test.html'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="编写自己的模板"><a class="markdownIt-Anchor" href="#编写自己的模板">#</a> 编写自己的模板</h4>
<p>如果默认生成的 HTML 不能满足您的需要，您可以提供自己的模板。最简单的方法是使用 template 选项并传递自定义 HTML 文件。html 网页包插件将自动将所有必要的 CSS、JS、manifest 和 favicon 文件注入标记中。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        title<span class="token operator">:</span> <span class="token string">'Custom template'</span><span class="token punctuation">,</span>
        <span class="token comment">// Load a custom template (lodash by default)</span>
        template<span class="token operator">:</span> <span class="token string">'index.html'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

<span class="token comment">//index.html</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
    <span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%=</span> htmlWebpackPlugin<span class="token punctuation">.</span>options<span class="token punctuation">.</span>title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>body<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="htmlwebpackplugin插件-常用配置项"><a class="markdownIt-Anchor" href="#htmlwebpackplugin插件-常用配置项">#</a> HtmlWebpackPlugin 插件 常用配置项</h4>
<blockquote>
<p>1、自定义属性<br>
在  <code>new HtmlWebpackPlugin()</code>  时，可传入一个配置对象，在配置对象中，不仅可以设置内置的属性，还可以自定义属性，在 html 模板中可以通过模板语法  <code>&lt;%= htmlWebpackPlugin.options.xxx %&gt;</code>  来使用这些自定义的属性。</p>
<p>如下图，title 属性 就是一个自定义属性，在 html 模板中可以通过模板语法  <code>&lt;%= htmlWebpackPlugin.options.title %&gt;</code>  来使用它的值，来设置页面标签栏的标题文字。</p>
</blockquote>
<blockquote>
<p>2、template<br>
 指定 html 模板。</p>
</blockquote>
<blockquote>
<p>3、inject<br>
 指定在哪个位置引入打包后的文件。默认值是’head’，表示在 head 标签中引入打包后的文件。&gt; 我们也可以修改为’body’，表示在 body 标签末尾引入打包后的文件。</p>
</blockquote>
<blockquote>
<p>4、chunks<br>
 指定引入哪些 chunks。 默认情况下，htmlwebpackplugin 插件会自动引入打包后所有的 chunks。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        title<span class="token operator">:</span> <span class="token string">'多页面应用'</span><span class="token punctuation">,</span>
        template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
        inject<span class="token operator">:</span> <span class="token string">'body'</span><span class="token punctuation">,</span>
        chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'lodash'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="示例-htmlwebpackplugin插件-常用配置项"><a class="markdownIt-Anchor" href="#示例-htmlwebpackplugin插件-常用配置项">#</a> ◎ 示例： HtmlWebpackPlugin 插件 常用配置项。</h4>
<p>1、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        main<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span><span class="token string">'./src/app2.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            dependOn<span class="token operator">:</span> <span class="token string">'lodash'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        main2<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./src/app3.js'</span><span class="token punctuation">,</span>
            dependOn<span class="token operator">:</span> <span class="token string">'lodash'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        lodash<span class="token operator">:</span> <span class="token string">'lodash'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">//关键代码</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            title<span class="token operator">:</span> <span class="token string">'多页面应用'</span><span class="token punctuation">,</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            inject<span class="token operator">:</span> <span class="token string">'body'</span><span class="token punctuation">,</span>
            chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'lodash'</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、打包、启动服务器、效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/476bcd46ae3c450eaad0c83c573a8201%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/4a602a3c1a734b69967f147d89fae362%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/60226b402d6b4833970b8ed7c484f115%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/f48c604c8e9248e095bf4efa827ac332%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>3、结论。</p>
<p>可以发现，打包后的 index.html 确实使用了 <code>template选项</code> 指定的 html 模板，title 也设置成功，也只引入了 <code>chunks选项</code> 中指定的的 chunk，而且是在 body 标签中引入。</p>
<hr>
<h3 id="43-多页面应用"><a class="markdownIt-Anchor" href="#43-多页面应用">#</a> 4.3 多页面应用</h3>
<blockquote>
<p>搭建多页面应用，需要进行哪些操作？<br>
1、打包出多个 html 文件，每个 html 文件对应一个单页面应用。<br>
2、将每个 html 文件和它里面独有引入的 chunk 存放在同一个目录中，公共的 chunk 也可以放在一个单独的目录中。<br>
3、每个 html 文件引入 chunk 不完全相同。</p>
</blockquote>
<blockquote>
<p>配置项说明：</p>
<p>1、 <code>entry.Chunk.import</code>  选项： 指定当前 chunk 的入口文件，如果有多个，则使用一个数组。<br>
2、 <code>entry.Chunk.dependOn</code>  选项：列出当前 chunk 依赖的第三方包。它会被单独打包，避免将自己的代码和第三方包代码打包到一个 chunk 中，导致体积过大。<br>
3、 <code>entry.Chunk.filename</code>  选项：指定当前 chunk 的输出名字。还可以指定存放目录。<br>
4、可以创建多个 HtmlWebpackPlugin 实例  <code>new HtmlWebpackPlugin()</code>  ，来生成多个 html 文件，对应多个单页面应用的主页面。<br>
5、 <code>plugins.HtmlWebpackPlugin.filename</code>  选项：指定生成的 html 的名字。还可以指定存放目录。<br>
6、 <code>plugins.HtmlWebpackPlugin.publicPath</code>  选项：指定域名。如果要将打包输出的 chunk 部署到 cdn 上，就可以使用该 publicPath 选项来指定 cdn 域名。</p>
</blockquote>
<p>webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        pageOne<span class="token operator">:</span> <span class="token string">'./src/pageOne/index.js'</span><span class="token punctuation">,</span>
        pageTwo<span class="token operator">:</span> <span class="token string">'./src/pageTwo/index.js'</span><span class="token punctuation">,</span>
        pageThree<span class="token operator">:</span> <span class="token string">'./src/pageThree/index.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>这是什么？</strong> 我们告诉 webpack 需要三个独立分离的依赖图（如上面的示例）。</p>
<p><strong>为什么？</strong> 在多页面应用程序中，server 会拉取一个新的 HTML 文档给你的客户端。页面重新加载此新文档，并且资源被重新下载。然而，这给了我们特殊的机会去做很多事，例如使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Foptimization%2F%23optimizationsplitchunks">optimization.splitChunks</a> 为页面间共享的应用程序代码创建 bundle。由于入口起点数量的增多，多页应用能够复用多个入口起点之间的大量代码 / 模块，从而可以极大地从这些技术中受益。</p>
<h4 id="示例搭建多页面应用-环境"><a class="markdownIt-Anchor" href="#示例搭建多页面应用-环境">#</a> ◎ 示例：搭建多页面应用 环境。</h4>
<p>1、测试代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/a9131553b55b479bab0b47e300bacc9c%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//app.js </span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app.js'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>

<span class="token comment">//app2.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'app2.js'</span><span class="token punctuation">)</span>

<span class="token comment">//app3.js</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span>

<span class="token comment">//index.html</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
    <span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%=</span> htmlWebpackPlugin<span class="token punctuation">.</span>options<span class="token punctuation">.</span>title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>body<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>我是html模板<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>

<span class="token comment">//index2.html</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
    <span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%=</span> htmlWebpackPlugin<span class="token punctuation">.</span>options<span class="token punctuation">.</span>title <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>body<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>我是html模板<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//关键代码</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//打包输出三个chunk：main、main2、lodash</span>
        main<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./src/app.js'</span><span class="token punctuation">,</span><span class="token string">'./src/app2.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            dependOn<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'page1/[name].js'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        main2<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'./src/app3.js'</span><span class="token punctuation">,</span>
            dependOn<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'page2/[name].js'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        lodash<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">import</span><span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'common/[name].js'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//关键代码</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            title<span class="token operator">:</span> <span class="token string">'多页面应用-页面1'</span><span class="token punctuation">,</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span><span class="token punctuation">,</span>
            inject<span class="token operator">:</span> <span class="token string">'body'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'page1/index.html'</span><span class="token punctuation">,</span>
            chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">,</span> <span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            publicPath<span class="token operator">:</span> <span class="token string">'http://www.a.com/'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            title<span class="token operator">:</span> <span class="token string">'多页面应用-页面2'</span><span class="token punctuation">,</span>
            template<span class="token operator">:</span> <span class="token string">'./src/index2.html'</span><span class="token punctuation">,</span>
            inject<span class="token operator">:</span> <span class="token string">'body'</span><span class="token punctuation">,</span>
            filename<span class="token operator">:</span> <span class="token string">'page2/index2.html'</span><span class="token punctuation">,</span>
            chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main2'</span><span class="token punctuation">,</span> <span class="token string">'lodash'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            publicPath<span class="token operator">:</span> <span class="token string">'http://www.b.com/'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、打包、启动服务器、效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/fefb65357b80407d8f3c9a55f2f943ff%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/bd75acff74ff4cf28620577d01cdcb16%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/832062793f0e4792a8de9670370847d4%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124023945553.png" alt="image-20220124023945553"></p>
<p>4、结论。</p>
<ol>
<li>打包输出了三个 chunk：main.js，main2.js，lodash.js。</li>
</ol>
<p>​	main.js 的入口文件有：app.js、app2.js。</p>
<p>​	main2.js 的入口文件有：app3.js。</p>
<p>​	lodash.js 中打包了第三方包 lodash。</p>
<p>​	app.js、app2.js 中都引用了第三方包 lodash。</p>
<ol start="2">
<li>打包生成了两个 html 文件：index.html、index2.html。</li>
</ol>
<p>​	index.html 中引入了 main.js、lodash.js。</p>
<p>​	index2.html 中引入了 main2.js、lodash.js。</p>
<ol start="3">
<li>打包生成了三个目录：page1、page2、common。</li>
</ol>
<p>​	打包输出的 chunk 都存放在不同的目录中。</p>
<p>​	page1 目录和 page2 目录 有 html 文件，而 common 目录没有。</p>
<hr>
<h2 id="第五章-tree-shaking"><a class="markdownIt-Anchor" href="#第五章-tree-shaking">#</a> 第五章: Tree shaking</h2>
<p>tree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码 (dead-code)。它依赖于 ES2015 模块语法的  <code>静态结构</code>  特性，例如  <code>import</code>  和  <code>export</code>  。这个术语和概念实际上是由 ES2015 模块打包工具  <code>rollup</code>  普及起来的。</p>
<p>webpack 2 正式版本内置支持 ES2015 模块（也叫做 harmony modules）和未使用模块检测能力。新的 webpack 4 正式版本扩展了此检测能力，通过  <code>package.json</code>  的  <code>&quot;sideEffects&quot;</code>  属性作为标记，向 compiler 提供提示，表明项目中的哪些文件是 “pure (纯正 ES2015 模块)”，由此可以安全地删除文件中未使用的部分。</p>
<h3 id="51-tree-shaking实险"><a class="markdownIt-Anchor" href="#51-tree-shaking实险">#</a> 5.1 tree-shaking 实险</h3>
<p><strong>● src/math.js</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>需要将 mode 配置设置成 development，以确定 bundle 不会被压缩：</p>
<p><strong>● webpack.config.js</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>配置完这些后，更新入口脚本，使用其中一个新方法：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> cube <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./math.js'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'pre'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    element<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'Hello webpack!'</span><span class="token punctuation">,</span>
        <span class="token string">'5 cubed is equal to '</span> <span class="token operator">+</span> <span class="token function">cube</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> element<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意，我们没有从 src/math.js 模块中 import 另外一个 square 方法。这个函数就是所谓的 “未引用代码 (dead code)”，也就是说，应该删除掉未被引用的 export 。</p>
<p>现在运行 npm script npm run build ，并查看输出的 bundle：</p>
<p><strong>● dist/bundle.js</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/43f1e3b05993441cabd831a98f4d5739%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>注意，上面的  <code>unused harmony export square</code>  注释。如果你观察它下面的代码，你会注意到虽然我们没有引用  <code>square</code>  ，但它仍然被包含在 bundle 中。</p>
<p><strong>● mode: production</strong></p>
<p>如果此时修改配置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/4b67c12e909842f0a25cf302b44a6d37%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>打包后发现无用的代码全部都消失了。</p>
<p>处于好奇，webpack 是如何完美的避开没有使用的代码的呢？</p>
<p>很简单：就是 Webpack 没看到你使用的代码。Webpack 跟踪整个应用程序的 <code>import/export</code>  语句，因此，如果它看到导入的东西最终没有被使用，它会认为那是未引用代码 (或叫做 “死代码”——  <code>dead-code</code>  )，并会对其进行 tree-shaking 。</p>
<p>死代码并不总是那么明确的。下面是一些死代码和 “活” 代码的例子：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/c66dcf6539e84bcd85bef3ba8134f4c1%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<blockquote>
<p>1、默认情况下，被 import 导入的模块中的代码 不管是否被使用到，都会被打包到当前模块。</p>
</blockquote>
<blockquote>
<p>2、如果我们想去掉 未使用到的代码，该怎么办呢？<br>
1. 设置生产模式。  <code>mode: 'production'</code> <br>
2. 设置  <code>optimization.usedExports</code>  选项。</p>
</blockquote>
<blockquote>
<p>3、webpack5 tree-shaking 功能的特点：<br>
1 . 对于自定义模块，如果只导入，而没有调用过它，则也会被 “摇” 掉。<br>
2 . 对于第三方包，如果只导入，而没有调用过它，则也会被打包。<br>
3 . 对于.css 文件，如果只导入，而没有调用过它，则也会被打包。这是 webpack 智能 tree-shaking 的一个表现。因为样式文件一般只需要导入就能够生效，而不需要调用。</p>
</blockquote>
<h4 id="示例tree-shaking功能的基本使用"><a class="markdownIt-Anchor" href="#示例tree-shaking功能的基本使用">#</a> ◎ 示例：tree-shaking 功能的基本使用。</h4>
<p>1、搭建 webpack 环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    <span class="token comment">//devtool: 'cheap-module-source-map',</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、测试代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024127202.png" alt="image-20220124024127202"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//app.js</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> add <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./math.js'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//math.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">-</span> y
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包、启动服务器、效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/4156ef66fd1d4843965e90fee7f41be0%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024144533.png" alt="image-20220124024144533"></p>
<p>5、结论。</p>
<p>main.js 中只打印了 11 这个数字，add 函数都没有，这是因为 webpack 内部做了最极致的优化。也没有打包未使用到的 minus 函数。说明 tree-shaking 功能成功启动了。</p>
<hr>
<h3 id="52-sideeffects"><a class="markdownIt-Anchor" href="#52-sideeffects">#</a> 5.2 sideEffects</h3>
<p>注意 Webpack 不能百分百安全地进行 tree-shaking。有些模块导入，只要被引入，就会对应用程序产生重要的影响。一个很好的例子就是全局样式表，或者设置全局配置的 JavaScript 文件。</p>
<p>Webpack 认为这样的文件有 “副作用”。具有副作用的文件不应该做 tree-shaking，因为这将破坏整个应用程序。</p>
<p>Webpack 的设计者清楚地认识到不知道哪些文件有副作用的情况下打包代码的风险，因此 webpack4 默认地将所有代码视为有副作用。这可以保护你免于删除必要的文件，但这意味着 Webpack 的默认行为实际上是不进行 tree-shaking。值得注意的是 webpack5 默认会进行 tree-shaking。</p>
<p>如何告诉 Webpack 你的代码无副作用，可以通过 package.json 有一个特殊的属性 sideEffects，就是为此而存在的。</p>
<p>它有三个可能的值：</p>
<ul>
<li>
<p><strong>true</strong></p>
<p>如果不指定其他值的话。这意味着所有的文件都有副作用，也就是没有一个文件可以 tree-shaking。</p>
</li>
<li>
<p><strong>false</strong></p>
<p>告诉 Webpack 没有文件有副作用，所有文件都可以 tree-shaking。</p>
</li>
<li>
<p><strong>数组 […]</strong></p>
<p>是文件路径数组。它告诉 webpack，除了数组中包含的文件外，你的任何文件都没有副作用。因此，除了指定的文件之外，其他文件都可以安全地进行 tree-shaking。</p>
</li>
</ul>
<p>webpack4 曾经不进行对 CommonJs 导出和 require () 调用时的导出使用分析。webpack 5 增加了对一些 CommonJs 构造的支持，允许消除未使用的 CommonJs 导出，并从 require () 调用中跟踪引用的导出名称。</p>
<blockquote>
<p>1、sideEffects 选项 是 package.json 的配置项，而不是 webpack.config.js。<br>
2、sideEffects 选项 用来告诉 webpack 哪些文件是有 “副作用” 的，不要对它们进行 tree-shaking，一律全部打包。没有在该选项中列出的文件，则被认为没有 “副作用”，可以进行 tree-shaking。<br>
3、 webpack 默认认为样式文件是有 “副作用的”，不会对它们进行 tree-shaking，一律全部打包。 相当于： <code>&quot;sideEffects&quot;: [&quot;*.css&quot;]</code> 。</p>
</blockquote>
<h4 id="示例sideeffects的基本使用"><a class="markdownIt-Anchor" href="#示例sideeffects的基本使用">#</a> ◎ 示例：sideEffects 的基本使用。</h4>
<p>在上一个示例的基础上，继续练习。</p>
<p>1、安装 style-loader、css-loader。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev style<span class="token operator">-</span>loader css<span class="token operator">-</span>loader<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/app.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    <span class="token comment">//devtool: 'cheap-module-source-map',</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        usedExports<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、测试代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024210518.png" alt="image-20220124024210518"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//style.css </span>
body<span class="token punctuation">&#123;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//m.global.js </span>
<span class="token comment">//全局js文件，即使只导入而未调用，也不希望被tree-shaking。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'global code'</span><span class="token punctuation">)</span>

<span class="token comment">//app.js</span>
<span class="token keyword">import</span> <span class="token string">'./style.css'</span>
<span class="token keyword">import</span> <span class="token string">'./m.global.js'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、sideEffects 选项。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//package.json</span>

<span class="token string">"sideEffects"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"*.css"</span><span class="token punctuation">,</span> <span class="token string">"*.global.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>5、打包、启动服务器、效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/7aee6dd8954547bcb94a4e12bbc80318%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>6、结论。</p>
<blockquote>
<p>1 . 在入口文件 app.js 中，只导入而没有进行调用 全局 js 文件 m.global.js，默认情况下，它会被 webpack tree-shaking 掉。</p>
<p>可以通过  <code>sideEffects</code>  选项，将全局 js 文件 m.global.js 标记为有 “副作用” 的，让 webpack 不要对其进行 tree-shaking。</p>
</blockquote>
<blockquote>
<p>2 . style.css 文件 导入后，不需要调用，webpack 默认认为样式文件是有 “副作用” 的，不会对其进行 “树摇”。</p>
</blockquote>
<hr>
<h2 id="第六章-渐进式网络应用程序-pwa"><a class="markdownIt-Anchor" href="#第六章-渐进式网络应用程序-pwa">#</a> 第六章：渐进式网络应用程序 PWA</h2>
<p>渐进式网络应用程序 (progressive web application - PWA)，是一种可以提供类似于 native app (原生应用程序) 体验的 web app (网络应用程序)。PWA 可以用来做很多事。其中最重要的是，在 <strong>离线 (offline)</strong> 时应用程序能够继续运行功能。这是通过使用名为 <strong>Service Workers</strong> 的 web 技术来实现的。</p>
<h3 id="61-非离线环境下运行"><a class="markdownIt-Anchor" href="#61-非离线环境下运行">#</a> 6.1 非离线环境下运行</h3>
<p>到目前为止，我们一直是直接查看本地文件系统的输出结果。通常情况下，真正的用户是通过网络访问 web app；用户的浏览器会与一个提供所需资源（例如 .html、.js、.css 文件）的 <strong>server</strong> 通讯。</p>
<p>我们通过搭建一个拥有更多基础特性的 server 来测试下这种离线体验。这里使用 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fhttp-server">http-server</a></strong> package：  <code>npm install http-server --save-dev</code>  。还要修改 <code>package.json</code>  的  <code>scripts</code>  部分，来添加一个  <code>start</code>  script：</p>
<p>package.json</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
    <span class="token operator">...</span>
    <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string">"start"</span><span class="token operator">:</span> <span class="token string">"http-server dist"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意：默认情况下，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fdev-server%2F">webpack DevServer</a> 会写入到内存。我们需要启用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fconfiguration%2Fdev-server%2F%23devserverdevmiddleware">devserverdevmiddleware.writeToDisk</a> 配置项，来让 http-server 处理  <code>./dist</code>  目录中的文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    devMiddleware<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        index<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        writeToDisk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果你之前没有操作过，先得运行命令 npm run build 来构建你的项目。然后运行命令 npm start 。应该产生以下输出：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/6e2286794b884b4ba797e20f136a0d93%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>如果你打开浏览器访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080">http://localhost:8080</a> (即 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1">http://127.0.0.1</a> )，你应该会看到 webpack 应用程序被 serve 到  <code>dist</code>  目录。如果停止 server 然后刷新，则 webpack 应用程序不再可访问。</p>
<p>这就是我们为实现离线体验所需要的改变。在本章结束时，我们应该要实现的是，停止 server 然后刷新，仍然可以看到应用程序正常运行。</p>
<blockquote>
<p>1、执行 <code>npx webpack serve</code>  指令时，会重新进行打包，而且启动一个服务器。<br>
2、执行 <code>npx webpack serve</code>  打包时，默认不会将打包后的资源输出到目录中，而是存放在内存中。</p>
<p>如果我们希望将重新打包后的资源写入目录，则可以设置  <code>devServer.devMiddleware.writeToDisk</code>  选项。<br>
3、 <strong>http-server</strong> 是一个 npm 包，可以启动一个服务器，来管理打包后的 web 资源，让用户能够从浏览器来访问 web 应用。作用类似于  <code>webpack-dev-server</code>  。</p>
</blockquote>
<h4 id="示例http-server的基本使用"><a class="markdownIt-Anchor" href="#示例http-server的基本使用">#</a> ◎ 示例：http-server 的基本使用。</h4>
<p>1、搭建 webpack 环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin

<span class="token comment">//安装 http-server</span>
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev http<span class="token operator">-</span>server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、测试代码。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/f7263d6e53d148f4815c2caef3788149%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello, world'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3、配置文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//webpack.config.js</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、package.json</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"start"</span><span class="token operator">:</span> <span class="token string">"http-server dist"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>5、打包，启动 web 服务。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npm start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>6、效果。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024258216.png" alt="image-20220124024258216"></p>
<p>7、结论。</p>
<p>http server 可以启动一个服务器，管理打包后的 web 资源，用户可以通过浏览器来访问它。但只要 http server 停止，浏览器就无法访问了。这说明我们的 web 应用是非离线的。</p>
<hr>
<h3 id="62-添加workbox"><a class="markdownIt-Anchor" href="#62-添加workbox">#</a> 6.2 添加 Workbox</h3>
<p>添加 <strong>workbox-webpack-plugin</strong> 插件，然后调整 webpack.config.js 文件：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install workbox<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">--</span>save<span class="token operator">-</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> WorkboxPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'workbox-webpack-plugin'</span><span class="token punctuation">)</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">WorkboxPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token comment">// 快速启用 ServiceWorkers </span>
        clientsClaim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
        <span class="token comment">// 不允许遗留任何“旧的” ServiceWorkers</span>
        skipWaiting<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>执行：  <code>npx webpack</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024314261.png" alt="image-20220124024314261"></p>
<p>现在你可以看到，生成了两个额外的文件：  <code>service-worker.js</code>  和名称冗长的  <code>workbox-718aa5be.js</code>  。  <code>service-worker.js</code>  是 Service Worker 文件，  <code>workbox-718aa5be.js</code>  是  <code>service-worker.js</code>  引用的文件，所以它也可以运行。你本地生成的文件可能会有所不同；但是应该会有一个  <code>service-worker.js</code>  文件。</p>
<p>所以，值得高兴的是，我们现在已经创建出一个 Service Worker。接下来该做什么？</p>
<h4 id="示例workbox-webpack-plugin-插件的基本使用"><a class="markdownIt-Anchor" href="#示例workbox-webpack-plugin-插件的基本使用">#</a> ◎ 示例：workbox-webpack-plugin 插件的基本使用。</h4>
<p>在示例 1 的基础上继续练习。</p>
<p>1、安装 workbox-webpack-plugin 插件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install workbox<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">--</span>save<span class="token operator">-</span>dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、配置 workbox-webpack-plugin 插件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> WorkboxPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'workbox-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        devMiddleware<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            writeToDisk<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">WorkboxPlugin<span class="token punctuation">.</span>GenerateSW</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token comment">// 这些选项帮助快速启用 ServiceWorkers </span>
            clientsClaim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
            <span class="token comment">// 不允许遗留任何“旧的” ServiceWorkers</span>
            skipWaiting<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、打包、启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024331991.png" alt="image-20220124024331991"></p>
<p>4、结论。</p>
<p>打包后生成了两个新的文件：workbox-37481be9.js、service-worker.js。它们就是 workbox-webpack-plugin 插件创建出来的。service-worker.js 是主文件，会引用 workbox-37481be9.js 文件。</p>
<hr>
<h3 id="63-注册service-worker"><a class="markdownIt-Anchor" href="#63-注册service-worker">#</a> 6.3 注册 Service Worker</h3>
<p>接下来我们注册 Service Worker，使其出场并开始表演。通过添加以下注册代码来完成此操作：</p>
<p>index.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>再次运行  <code>npx webpack</code>  来构建包含注册代码版本的应用程序。然后用  <code>npm start</code>  启动服务。访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080">http://localhost:8080</a> 并查看 console 控制台。在那里你应该看到：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token constant">SW</span> registered<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>现在来进行测试。停止 server 并刷新页面。如果浏览器能够支持 Service Worker，应该可以看到你的应用程序还在正常运行。然而，server 已经<strong>停止</strong> serve 整个 dist 文件夹，此刻是 Service Worker 在进行 serve。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/0532111e6024428d944a717540380145%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<h4 id="示例-3"><a class="markdownIt-Anchor" href="#示例-3">#</a> ◎ 示例</h4>
<p>在示例 2 的基础上继续练习。</p>
<p>1、index.js。</p>
<p>编写 Service Worker 相关的代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello, world 666'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
        navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/service-worker.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">registration</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'SW registered:'</span><span class="token punctuation">,</span> registration<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">registrationError</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'SW registered failed:'</span><span class="token punctuation">,</span> registrationError<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、打包，启动 http-server 服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npm start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024442783.png" alt="image-20220124024442783"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024456909.png" alt="image-20220124024456909"></p>
<p>3、关闭 http server，刷新浏览器页面，查看是否还可以访问 web 应用。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//终止命令行终端中的http server</span>
Ctrl <span class="token operator">+</span> <span class="token constant">C</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024512978.png" alt="image-20220124024512978"></p>
<p>4、结论。</p>
<blockquote>
<p>1 . 关闭 http server 后，浏览器仍然能显示 web 应用。这说明当服务器挂掉或者用户网络断开后，刷新页面，在浏览器上仍然可以显示我们的 web 应用。</p>
</blockquote>
<blockquote>
<p>2 . 这是如何实现的呢？这是因为浏览器将 web 应用缓存起来了。</p>
</blockquote>
<blockquote>
<p>3 . 在 chrome 浏览器 地址栏中打开  <code>chrome://serviceworker-internals</code>  ，可以看到 有哪些 web 应用 在当前浏览器中注册了 Service Worker。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2c2777aebc344a4c8a41473f950e2648%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<blockquote>
<p>点击 <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/9c2ded1659f64c1a860553d228566b28%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"> 按钮，可以注销 Service Worker，这样就无法在离线状态下访问对应的 web 应用了。</p>
</blockquote>
<h3 id="小结-3"><a class="markdownIt-Anchor" href="#小结-3">#</a> 小结</h3>
<p>Service Worker 需要配合 webpack、浏览器 一起使用，来创建一个 PWA。</p>
<hr>
<h2 id="第七章-shimming预置依赖"><a class="markdownIt-Anchor" href="#第七章-shimming预置依赖">#</a> 第七章: shimming 预置依赖</h2>
<p><code>webpack</code>  compiler 能够识别遵循 ES2015 模块语法、CommonJS 或 AMD 规范编写的模块。然而，一些 third party (第三方库) 可能会引用一些全局依赖（例如  <code>jQuery</code>  中的 $ ）。因此这些 library 也可能会创建一些需要导出的全局变量。这些 “broken modules (不符合规范的模块)” 就是 shimming (预置依赖) 发挥作用的地方。</p>
<p>shim 另外一个极其有用的使用场景就是：当你希望  <code>polyfill</code>  扩展浏览器能力，来支持到更多用户时。在这种情况下，你可能只是想要将这些 polyfills 提供给需要修补 (patch) 的浏览器（也就是实现按需加载）。</p>
<blockquote>
<p><strong>shimming</strong> 英 [ˈʃɪmɪŋ] 匀场；匀场技术；垫补；填隙；补偿<br>
<strong> shim</strong> 英 [ʃɪm] n. 垫片；(木、橡胶、金属等) 楔子；填隙片 vt. 用垫片填</p>
</blockquote>
<h3 id="71-shimming预设全局变量"><a class="markdownIt-Anchor" href="#71-shimming预设全局变量">#</a> 7.1 Shimming 预设全局变量</h3>
<p>让我们开始第一个 shimming 全局变量的用例。还记得我们之前用过的  <code>lodash</code>  吗？出于演示目的，例如把这个应用程序中的模块依赖，改为一个全局变量依赖。要实现这些，我们需要使用  <code>ProvidePlugin</code>  插件。</p>
<blockquote>
<p>ProvidePlugin 插件 不需要安装，是 webpack 内置的。</p>
</blockquote>
<p>使用  <code>ProvidePlugin</code>  后，能够在 webpack 编译的每个模块中，通过访问一个变量来获取一个 package。如果 webpack 看到模块中用到这个变量，它将在最终 bundle 中引入给定的 package。</p>
<p>让我们先移除  <code>lodash</code>  的  <code>import</code>  语句，改为通过插件提供它：</p>
<p>src/index.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            _<span class="token operator">:</span> <span class="token string">'lodash'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们本质上所做的，就是告诉 webpack：</p>
<blockquote>
<p>如果你遇到了至少一处用到 _ 变量的模块实例，那请你将 lodash package 引入进来，并将其提供给需要用到它的模块。</p>
</blockquote>
<p>运行我们的构建脚本，将会看到同样的输出：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024612849.png" alt="image-20220124024612849"></p>
<p>还可以使用  <code>ProvidePlugin</code>  暴露出某个模块中单个导出，通过配置一个 “数组路径”（例如  <code>[module, child, ...children?]</code>  ）实现此功能。所以，我们假想如下，无论  <code>join</code>  方法在何处调用，我们都只会获取到  <code>lodash</code>  中提供的  <code>join</code>  方法。</p>
<p>src/index.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token comment">// _: 'lodash'</span>
            join<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">,</span> <span class="token string">'join'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样就能很好的与  <code>tree shaking</code>  配合，将  <code>lodash</code>  library 中的其余没有用到的导出去除。</p>
<h4 id="示例第三方包-shimming"><a class="markdownIt-Anchor" href="#示例第三方包-shimming">#</a> ◎ 示例：第三方包 shimming</h4>
<blockquote>
<p>一般情况下，我们会在一个模块中先导入 lodash，然后使用它。</p>
<p>那能不能将 lodash 变成一个全局变量呢？这样在任何模块中，都可以直接使用 lodash，而不需要导入了。</p>
<p>可以通过将第三方包预设成全局变量来实现。即第三方包的 shimming。</p>
</blockquote>
<p>1、搭建 webpack 环境</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2、测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3、webpack.config.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            _<span class="token operator">:</span> <span class="token string">'lodash'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、注意：不需要手动安装 lodash。执行 npx webpack 打包时，好像 ProvidePlugin 插件会自动帮我们下载 lodash。</p>
<p>5、打包、效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
cd dist
node main<span class="token punctuation">.</span>js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/327cbc5cd36d468191864534d937ec91~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/cedacf3d3d294bbf867c4fa73ca8931a%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93cff9e4c2974d078856758e23b7ffc9~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p>6、结论。</p>
<p>main.js 的体积竟然有 534kb，这说明 lodash 库被打包进去了。通过 nodejs 来执行 main.js，正常输出了。这说明我们成功地将  <code>第三方包</code>  预设成  <code>全局变量</code>  了。</p>
<p>我们没有 安装第三方包 lodash，也没有在入口文件 index.js 中 import 导入 lodash，只是设置了  <code>ProvidePlugin</code>  选项。</p>
<p>我们没有 安装第三方包 lodash，但是 main.js 的体积却有 534kb 这么大，这说明 webpack ProviedPlugin 会帮助我们下载 lodash 并进行打包。</p>
<hr>
<h3 id="72-细粒度-shimming"><a class="markdownIt-Anchor" href="#72-细粒度-shimming">#</a> 7.2 细粒度 Shimming</h3>
<p>一些遗留模块依赖的  <code>this</code>  指向的是  <code>window</code>  对象。在接下来的用例中，调整我们的 index.js ：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'hello webpack'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>当模块运行在 CommonJS 上下文中，这将会变成一个问题，也就是说此时的  <code>this</code>  指向的是  <code>module.exports</code>  。在这种情况下，你可以通过使用  <code>imports-loader</code>  覆盖  <code>this</code>  指向：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token string">'imports-loader?wrapper=window'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="示例imports-loader-基本使用"><a class="markdownIt-Anchor" href="#示例imports-loader-基本使用">#</a> ◎ 示例：imports-loader 基本使用</h4>
<blockquote>
<p>如果我们想在模块中使用  <code>this</code>  这个变量，并希望它是指向浏览器的  <code>window</code>  对象的，该怎么办呢？</p>
</blockquote>
<p>在示例 1 的基础上继续练习。</p>
<p>1、安装  <code>imports-loader</code>  。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev imports<span class="token operator">-</span>loader<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、index.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'hello, webpack'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、webpack.config.js。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./src/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token string">'imports-loader?wrapper=window'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包，启动服务器，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/093e097c91b540db8c683cba9e253d29%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>5、结论。</p>
<blockquote>
<p>webpack 打包时，模块中的 this 变量（如果有）会指向  <code>module.exports</code> ，而不是浏览器的 window 对象。但是，有些情况下，我们就希望 this 指向浏览器的 window 对象，来使用 window 对象上的一些 api，这时候该怎么办呢？</p>
<p>可以通过  <code>imports-loader</code>  来修改  <code>this</code>  的指向。</p>
</blockquote>
<hr>
<h3 id="73-全局-exports"><a class="markdownIt-Anchor" href="#73-全局-exports">#</a> 7.3 全局 Exports</h3>
<p>让我们假设，某个 library 创建出一个全局变量，它期望 consumer (使用者) 使用这个变量。为此，我们可以在项目配置中，添加一个小模块来演示说明：</p>
<p>src/globals.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token string">'example.txt'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> helpers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test something'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

    <span class="token function-variable function">parse</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parse something'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此时，在我们的 entry 入口文件中（即 src/index.js ），可以使用  <code>const &#123; file, parse &#125; = require('./globals.js');</code>  ，可以保证一切将顺利运行。</p>
<blockquote>
<p>为什么要使用 <strong>exports-loader</strong>？</p>
<p>一般情况下，我们不知道第三方包内部是如何导出的，此时，我们可以在 webpack.config.js 中对第三方包里面的内容作一个自定义的导出，这样就可以方便的使用它里面的一些 api 了。</p>
</blockquote>
<h4 id="示例-4"><a class="markdownIt-Anchor" href="#示例-4">#</a> ◎ 示例</h4>
<p>在示例 1 的基础上继续练习。</p>
<p>1、安装  <code>exports-loader</code></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i <span class="token operator">-</span><span class="token constant">D</span> exports<span class="token operator">-</span>loader<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>

<span class="token keyword">const</span> <span class="token punctuation">&#123;</span> file<span class="token punctuation">,</span> parse <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./globals'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> 
<span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//globals.js </span>

<span class="token keyword">const</span> file <span class="token operator">=</span> <span class="token string">'example.txt'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> helpers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">test</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test something'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">parse</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'parse something'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/eec7d0cc8e364b21a1cab1e244959812%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>3、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./src/globals.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token string">'exports-loader?type=commonjs&amp;exports=file,multiple|helpers.parse|parse'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包，启动服务器，浏览器效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>open<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/fc653843dc0a47eba3758bbeee3a98bf%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>5、结论。</p>
<blockquote>
<p><code>globals.js</code>  没有使用任何模块化语法来导出内容，所以它既不是 <code>ES module</code> ，也不是  <code>CommonJS module</code>  。为什么在入口文件 <code>index.js</code>  中，能够通过  <code>require()</code>  方法 来导入它里面定义的变量和函数呢？</p>
<p>这是因为我们在  <code>webpack.config.js</code>  中，使用  <code>exports-loader</code>  来对  <code>globals.js</code>  做了一个 <strong>自定义导出</strong>。它会覆盖 <code>globals.js</code>  内部的导出，我们自定义导出什么内容，在其它模块中就可以导入这些内容。所以此时我们不需要关心  <code>globals.js</code>  内部是如何导出的，只要使用我们自定义导出的内容即可。</p>
</blockquote>
<hr>
<h3 id="74-加载-polyfills"><a class="markdownIt-Anchor" href="#74-加载-polyfills">#</a> 7.4 加载 Polyfills</h3>
<p>目前为止，我们讨论的所有内容 都是处理那些遗留的 package，让我们进入到第二个话题：<strong>polyfill</strong>。</p>
<p>有很多方法来加载 polyfill。例如，想要引入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fbabel.docschina.org%2Fdocs%2Fen%2Fbabel-polyfill%2F">@babel/polyfill</a> 我们只需如下操作:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm install <span class="token operator">--</span>save @babel<span class="token operator">/</span>polyfill<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后，使用  <code>import</code>  将其引入到我们的主 bundle 文件：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token parameter">x</span> <span class="token operator">=></span> x <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意，这种方式优先考虑正确性，而不考虑 bundle 体积大小。为了安全和可靠，polyfill/shim 必须<strong>运行于所有其他代码之前</strong>，而且需要同步加载，或者说，需要在所有 polyfill/shim 加载之后，再去加载所有应用程序代码。 社区中存在许多误解，即现代浏览器 “不需要” polyfill，或者 polyfill/shim 仅用于添加缺失功能 - 实际上，它们通常用于<strong>修复损坏实现 (repair broken implementation)</strong>，即使是在最现代的浏览器中，也会出现这种情况。 因此，最佳实践仍然是，不加选择地和同步地加载所有 polyfill/shim，尽管这会导致额外的 bundle 体积成本。</p>
<blockquote>
<p>为什么要使用 <strong>polyfill</strong> ?</p>
<p>有些最新的 javascript api（ 如 Array.from () 方法）是低版本浏览器不支持的，通过引入 polyfill ，可以将这些 api 的实现代码打包到 web 应用中，这样就可以正常使用了。</p>
</blockquote>
<h4 id="示例babelpolyfill-基本使用"><a class="markdownIt-Anchor" href="#示例babelpolyfill-基本使用">#</a> ◎ 示例：@babel/polyfill 基本使用。</h4>
<p>1、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2、安装  <code>@babel/polyfill</code>  。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i <span class="token operator">-</span><span class="token constant">D</span> @babel<span class="token operator">/</span>polyfill<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3、测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>
<span class="token keyword">import</span> <span class="token string">'@babel/polyfill'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token parameter">x</span> <span class="token operator">=></span> x <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/b19cfa03184b4700bc1ee28425a05c96%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>5、结论。</p>
<p>可见， <code>main.js</code>  体积竟然达到 399kb，这是因为  <code>@babel/polyfill</code>  也被打包进去了。 <code>@babel/polyfill</code>  这个包中就包含了 Array.from () 的底层实现代码，这样在任何版本浏览器中都可以正常使用了 Array.from () 方法了。</p>
<hr>
<h3 id="75-进一步优化-polyfills"><a class="markdownIt-Anchor" href="#75-进一步优化-polyfills">#</a> 7.5 进一步优化 Polyfills</h3>
<p>不建议使用  <code>import @babel/polyfilll</code>  。因为这样做的缺点是会全局引入整个 polyfill 包，比如 Array.from 会全局引入，不但包的体积大，而且还会污染全局环境。</p>
<p><code>babel-preset-env</code>  package 通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbrowserslist%2Fbrowserslist">browserslist</a> 来转译那些你浏览器中不支持的特性。这个 preset 使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fbabel.docschina.org%2Fdocs%2Fen%2Fbabel-preset-env%2F%23usebuiltins">useBuiltIns</a> 选项，默认值是  <code>false</code>  ，这种方式可以将全局  <code>babel-polyfill</code>  导入，改进为更细粒度的  <code>import</code>  格式：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'core-js/modules/es7.string.pad-start'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'core-js/modules/es7.string.pad-end'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'core-js/modules/web.timers'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'core-js/modules/web.immediate'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'core-js/modules/web.dom.iterable'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>● 安装 @babel/preset-env 及 相关的包</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>● webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                            <span class="token punctuation">&#123;</span>
                                targets<span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token string">'last 1 version'</span><span class="token punctuation">,</span>
                                    <span class="token string">'> 1%'</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>useBuiltIns 参数有三个取值： “entry”、”usage”、false</strong></p>
<p>默认值是 false ，此参数决定了 babel 打包时如何处理 @babel/polyfill 语句。</p>
<p><strong>“entry”</strong>: 会将文件中  <code>import '@babel/polyfill'</code>  语句 结合 targets ，转换为一系列引入语句，去掉目标浏览器已支持的 polyfill 模块，不管代码里有没有用到，只要目标浏览器不支持都会引入对应的 polyfill 模块。</p>
<p><strong>“usage”</strong>: 不需要手动在代码里写  <code>import '@babel/polyfill'</code>  ，打包时会自动根据实际代码的使用情况，结合 targets 引入代码里实际用到部分 polyfilll 模块。</p>
<p><strong>false</strong>: 对  <code>import '@babel/polyfill'</code>  不作任何处理，也不会自动引入 polyfilll 模块。</p>
<p>需要注意的是在 webpack 打包文件配置的 entry 中引入的 @babel/polyfill 不会根据 useBuiltIns 配置任何转换处理。</p>
<p>由于 @babel/polyfill 在 7.4.0 中被弃用，我们建议直接添加 corejs 并通过 corejs 选项设置版本。</p>
<p>● 执行编译 npx webpack</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/87eac9968aba453e9fe2aa0166b1e2b5%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>提示我们需要安装  <code>core-js</code>  。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i core<span class="token operator">-</span>js@<span class="token number">3</span> <span class="token operator">-</span><span class="token constant">S</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此时还需要 添加一个配置：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                            <span class="token punctuation">&#123;</span>
                                targets<span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token string">'last 1 version'</span><span class="token punctuation">,</span>
                                    <span class="token string">'> 1%'</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                                <span class="token comment">//配置core-js</span>
                                corejs<span class="token operator">:</span> <span class="token number">3</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>成功优化！</p>
<h4 id="示例优化polyfill"><a class="markdownIt-Anchor" href="#示例优化polyfill">#</a> ◎ 示例：优化 polyfill</h4>
<p>在上一节 示例 的基础上继续练习。</p>
<p>1、安装 <strong>babel</strong> 。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i <span class="token operator">-</span><span class="token constant">D</span> babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2.2 安装 <strong>core-js</strong> 。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i <span class="token operator">-</span><span class="token constant">D</span> core<span class="token operator">-</span>js@<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    presets<span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">[</span>
                            <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
                            <span class="token punctuation">&#123;</span>
                                targets<span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token string">'last 1 version'</span><span class="token punctuation">,</span>
                                    <span class="token string">'> 1%'</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                useBuiltIns<span class="token operator">:</span> <span class="token string">'usage'</span><span class="token punctuation">,</span>
                                corejs<span class="token operator">:</span> <span class="token number">3</span>
                            <span class="token punctuation">&#125;</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、不需要手动导入  <code>@babel/polyfill</code>  。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>

<span class="token comment">//注释掉，不需要手动导入了。</span>
<span class="token comment">//import '@babel/polyfill' </span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token parameter">x</span> <span class="token operator">=></span> x <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包，效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/79a850bb03ad4f2186c82b63a5039c8d%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024805945.png" alt="image-20220124024805945"></p>
<p>5、结论。</p>
<p>可见，打包后的 main.js 体积为 110kb，比上一个节示例的打包结果 399kb 小了很多。这说明成功优化了 polyfill。</p>
<hr>
<h2 id="第八章-创建library"><a class="markdownIt-Anchor" href="#第八章-创建library">#</a> 第八章：创建 library</h2>
<p>除了打包应用程序，webpack 还可以用于打包 JavaScript library。</p>
<h3 id="81-如何构建library"><a class="markdownIt-Anchor" href="#81-如何构建library">#</a> 8.1 如何构建 library</h3>
<blockquote>
<p>在前面的章节中，打包出的都是一个 web 应用。</p>
</blockquote>
<blockquote>
<p>思考一下：能否使用 webpack 打包出一个 library，类似于 lodash，而不是一个 web 应用，提供给其它人使用呢？</p>
</blockquote>
<blockquote>
<p><strong>output.library</strong> 选项</p>
</blockquote>
<blockquote>
<p>library 选项 告诉 webpack 我们要打包成一个库，而不是一个 web 应用。此时，入口文件中，定义而未调用的代码不会被 tree shaking 掉。因为库里面定义的 api 是提供给其它人使用的，库本身不需要调用。</p>
</blockquote>
<h5 id="示例使用webpack打包出一个library的基本步骤"><a class="markdownIt-Anchor" href="#示例使用webpack打包出一个library的基本步骤">#</a> ◎ 示例：使用 webpack 打包出一个 library 的基本步骤。</h5>
<p>1、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y 
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'mylib.js'</span><span class="token punctuation">,</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">//关键代码</span>
        library<span class="token operator">:</span> <span class="token string">'mylib'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、测试代码。</p>
<p>在入口文件  <code>index.js</code>  中，定义并导出了一个  <code>add()</code>  方法，我们希望将它打包成一个库，提供给其它人使用。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>4、demo/index.html</p>
<p>为了测试打包后的库  <code>mylib.js</code>  是否能正常执行，我们在 demo 页面中，通过 script 标签来引入打包后的库  <code>mylib.js</code> ，并调用了它里面的  <code>add()</code>  方法。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
    <span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>body<span class="token operator">></span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../dist/mylib.js"</span> type<span class="token operator">=</span><span class="token string">"text/javascript"</span> charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
        <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mylib<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mylib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5、打包，启动一个服务器，浏览器效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx http<span class="token operator">-</span>server<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024829887.png" alt="image-20220124024829887"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024838941.png" alt="image-20220124024838941"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/ad804b41962a427da78b87f7f20fadb7%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/288fc769dcda4110a86c62d7bd98321d%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>6、结论。</p>
<p>可见，在浏览器中访问 deom 页面， <code>mylib.js</code>  中的  <code>add()</code>  方法成功执行了。这说明我们已经能够成功地使用 webpack 打包出一个库了。</p>
<hr>
<h3 id="82-构建小轮子"><a class="markdownIt-Anchor" href="#82-构建小轮子">#</a> 8.2 构建小轮子</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024913902.png" alt="image-20220124024913902"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/88c3948a15b444e4b5d66efd425f1224%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/aff66f49b8664814bee5367b46217c4f%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024933891.png" alt="image-20220124024933891"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124024948590.png" alt="image-20220124024948590"></p>
<p>然而它只能通过被 script 标签引用而发挥作用，它不能运行在 CommonJS、AMD、Node.js 等环境中。</p>
<p>作为一个库作者，我们希望它能够兼容不同的环境，也就是说，用户应该能够通过以下方式使用打包后的库：</p>
<p><strong>● CommonJS module require:</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> webpackNumbers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-numbers'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>● AMD module require:</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'webpackNumbers'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">webpackNumbers</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>● script tag:</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html<span class="token operator">></span>
    <span class="token operator">...</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://example.org/webpack-numbers.js"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
    <span class="token operator">&lt;</span>script<span class="token operator">></span>
        <span class="token comment">// ...</span>
        <span class="token comment">// Global variable</span>
        webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Five'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Property in the window object</span>
        window<span class="token punctuation">.</span>webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Five'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们更新  <code>output.library</code>  配置项，将其  <code>type</code>  设置为 ‘umd’ ：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'webpack-numbers.js'</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            name<span class="token operator">:</span> <span class="token string">'webpackNumbers'</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>现在 webpack 将打包一个库，其可以与 CommonJS、AMD 以及 script 标签使用。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/de0291fcbe3a412ab515df4d3a5480a6%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/037f8d5467604b49892de9ad727a3675%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/f9875947b06b4cc98504f96daa92fa48%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5b4ef74c3bd45ca831f3aba14407017~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<h4 id="outputlibrarytype属性"><a class="markdownIt-Anchor" href="#outputlibrarytype属性">#</a> output.library.type 属性</h4>
<blockquote>
<p><code>output.library.type</code>  属性：设置 打包出来的库 可以使用哪种引入方式。</p>
<p>可选值：</p>
</blockquote>
<blockquote>
<p><strong>● window</strong><br>
 以 script 标签来引入。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../dist/mylib.js"</span> type<span class="token operator">=</span><span class="token string">"text/javascript"</span> charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mylib<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mylib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>● commonjs</strong><br>
 以 require () 方法引入。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> mylib <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/mylib'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mylib<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>● module</strong><br>
 即 ES module，目前该功能还不够成熟，需要添加一个选项  <code>experiments.outputModule: true</code> ，此时不能设置  <code>library.name</code>  属性。</p>
<p>引入方式：</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"module"</span><span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> add <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../dist/mylib.js'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p><strong>● umd</strong></p>
<p>同时支持多种引入方式，包括 window、commonjs、amd，但 es modulde 支持还存在问题。</p>
</blockquote>
<h4 id="示例处理依赖"><a class="markdownIt-Anchor" href="#示例处理依赖">#</a> ◎ 示例：处理依赖。</h4>
<blockquote>
<p>如果自己的库中引入了第三方包，应该如何进行打包呢？</p>
<p>● <strong>library</strong> 选项<br>
● <strong>globalObject</strong> 选项<br>
● <strong>externals</strong> 选项</p>
</blockquote>
<p>1、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y 
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli 

npm i <span class="token operator">-</span><span class="token constant">D</span> lodash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>注意：lodash 不能安装成 运行依赖，避免将 lodash 打包进我们的库中，导致体积过大。</p>
</blockquote>
<p>2、测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>

<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span> 
<span class="token keyword">import</span> numRef <span class="token keyword">from</span> <span class="token string">'./ref.json'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">numToWord</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
        numRef<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">accum<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> ref<span class="token punctuation">.</span>num <span class="token operator">===</span> num <span class="token operator">?</span> ref<span class="token punctuation">.</span>word <span class="token operator">:</span> accum
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token string">''</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
        numRef<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">accum<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> ref<span class="token punctuation">.</span>word <span class="token operator">===</span> word <span class="token operator">&amp;&amp;</span> word<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> ref<span class="token punctuation">.</span>num <span class="token operator">:</span> accum
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'webpack-numbers.js'</span><span class="token punctuation">,</span>
         
        <span class="token comment">//关键代码</span>
        library<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            name<span class="token operator">:</span> <span class="token string">'webpackNumbers'</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span> <span class="token string">'umd'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        globalObject<span class="token operator">:</span> <span class="token string">'globalThis'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//externals选项：将lodash单独打包，不合并到我们自己的代码中。</span>
    externals<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        lodash<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            commonjs<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            commonjs2<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            amd<span class="token operator">:</span> <span class="token string">'lodash'</span><span class="token punctuation">,</span>
            root<span class="token operator">:</span> <span class="token string">'_'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token comment">//生产环境</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.2 修改 package.json main 选项。</p>
<blockquote>
<p><strong>name 选项</strong>：设置包名。</p>
<p><strong>version 选项</strong>：设置包的版本。</p>
<p><strong>main 选项</strong>： 设置为打包后的 bundle 主文件的路径。<br>
因为别人在通过 require () 来导入你的包的时候，会去读取 main 选项中指定的文件。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//package.json</span>

<span class="token punctuation">&#123;</span>
  <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"ygl-numbers"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token string">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token string">"main"</span><span class="token operator">:</span> <span class="token string">"dist/webpack-numbers.js"</span><span class="token punctuation">,</span>
  <span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token string">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token string">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token string">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"lodash"</span><span class="token operator">:</span> <span class="token string">"^4.17.21"</span><span class="token punctuation">,</span>
    <span class="token string">"webpack"</span><span class="token operator">:</span> <span class="token string">"^5.66.0"</span><span class="token punctuation">,</span>
    <span class="token string">"webpack-cli"</span><span class="token operator">:</span> <span class="token string">"^4.9.1"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>注意：打包后 bundle 文件的名字和库的名字可以不一样。</p>
<p>如：示例中，打包出来的 bundle 名字是  <code>webpadck-numbers.js</code>  ，它是在 <code>webpack.config.js</code>  <strong>output.filename 选项</strong> 中设置的。而发布时包的名字是  <code>ygl-numbers</code> ，它是在  <code>package.json</code>  <strong>name 选项</strong> 中设置的。</p>
</blockquote>
<p>4、打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/ba49740c4a26405cb79afbd9647ca5bd%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>5、测试打包后的库是否能够正常使用。</p>
<p>app.js 中以 CommonJS 语法 来使用 我们打包出来的库 webpack-numbers.js。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025052312.png" alt="image-20220124025052312"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">/</span>demo<span class="token operator">/</span>app<span class="token punctuation">.</span>js

<span class="token keyword">const</span> webpackNumbers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/webpack-numbers'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>webpackNumbers<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>webpackNumbers<span class="token punctuation">.</span><span class="token function">numToWord</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>webpackNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Four'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

node demo<span class="token operator">/</span>app<span class="token punctuation">.</span>js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025101053.png" alt="image-20220124025101053"></p>
<p>6、结论。</p>
<blockquote>
<p>1 . 打包后的库  <code>webpack-numbers.js</code>  体积只有 1.24kb，这说明 <code>lodash</code>  包没有被打包进去（或者是只打包了 <code>lodash</code>  中的 <code>reduce()</code>  方法，也就是 <code>tree shaking</code>  掉了 lodash 中那些未使用到的代码。）。</p>
</blockquote>
<blockquote>
<p>2 . 通过  <code>CommonJS</code>  语法 来引入  <code>webpack-numbers.js</code> ，调用它里面的两个方法： <code>numToWord()</code> 、 <code>wordToNum()</code> ，都执行成功了。这说明打包后的的库支持 <code>CommonJS</code>  语法的引入方式。</p>
</blockquote>
<hr>
<h3 id="83-发布为npm-package"><a class="markdownIt-Anchor" href="#83-发布为npm-package">#</a> 8.3 发布为 npm-package</h3>
<blockquote>
<p>如何将前面打包好的库发布到 npm 上，提供给其它人使用呢？</p>
</blockquote>
<h4 id="示例发布npm包的基本步骤"><a class="markdownIt-Anchor" href="#示例发布npm包的基本步骤">#</a> ◎ 示例：发布 npm 包的基本步骤。</h4>
<p>在上一个示例的基础上，继续练习。</p>
<p>1、注册 npm 账号。</p>
<p>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2F">npm 官网</a>，注册一个账号。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/3fad5039469d4a068fd8726e29a3a7f3%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>2、检查 npm 源。</p>
<blockquote>
<p>执行下面的命令，查看当前 npm 源，必须是官方的源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fregistry.npmjs.org%2F">registry.npmjs.org/</a> 。如果是淘宝的源，则会发布不上去。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm config <span class="token keyword">get</span> registry<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025130740.png" alt="image-20220124025130740"></p>
<p>3、添加用户。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm adduser<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/b8e9a8a4596f470da6bf87ef3fd89307%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<blockquote>
<p>注意：输入时速度要快，最好是复制粘贴，因为网速慢容易导致报错。多输几次就可以了。</p>
</blockquote>
<p>4、发布。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025143410.png" alt="image-20220124025143410"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm publish<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/6adb3edb744940238963269a75500095%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<blockquote>
<p>注意：</p>
<p>1、包名必须是全球唯一的，如果重名了则发布不了。<br>
如果重名了，只需要修改 package.json 中 name 选项，也可以修改版本号 version 。</p>
<p>2、同一个包 可以发布多次，但要修改版本号。<br>
同一个包，修改源代码，打包后，修改 package.json 中的 version 版本，就可以再次发布了。它会被发布到在同一个包的不同版本中。</p>
</blockquote>
<p>5、检查是否发布成功。</p>
<p>登录 npm 官网 / 点击用户头像 / Packages</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025209895.png" alt="image-20220124025209895"></p>
<p>6、测试发布成功的包  <code>ygl-numbers</code>  是否能够使用。</p>
<p>创建一个项目，下载使用 我们自己刚发布出去的包   <code>ygl-numbers</code>  ，测试它能否正常使用。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/852b17d82be244849368b3029e3c5d06%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm i ygl<span class="token operator">-</span>numbers 

<span class="token comment">//app.js</span>

<span class="token keyword">const</span> yglNumbers <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ygl-numbers'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>yglNumbers<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>yglNumbers<span class="token punctuation">.</span><span class="token function">numToWord</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>yglNumbers<span class="token punctuation">.</span><span class="token function">wordToNum</span><span class="token punctuation">(</span><span class="token string">'Four'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025223444.png" alt="image-20220124025223444"></p>
<p>7、结论。</p>
<p>我们成功地发布了自己的包  <code>ygl-numbers</code>  ，而且它可以被其它人正常下载和使用。</p>
<hr>
<h2 id="第九章-模块联邦"><a class="markdownIt-Anchor" href="#第九章-模块联邦">#</a> 第九章：模块联邦</h2>
<h3 id="91-什么是模块联邦"><a class="markdownIt-Anchor" href="#91-什么是模块联邦">#</a> 9.1 什么是模块联邦</h3>
<blockquote>
<p>federation 英 [ˌfedəˈreɪʃn] n. 联邦；联盟</p>
</blockquote>
<p>多个独立的构建可以组成一个应用程序，这些独立的构建之间不应该存在依赖关系， 因此可以单独开发和部署它们。</p>
<p>这通常被称作微前端，但并不仅限于此。</p>
<p>Webpack5 模块联邦让 Webpack 达到了线上 Runtime 的效果，让代码直接在项目间利用 CDN 直接共享，不再需要本地安装 Npm 包、构建再发布了！</p>
<p>我们知道 Webpack 可以通过 DLL 或者 Externals 做代码共享时 Common Chunk，但不同应用和项目间这个任务就变得困难了，我们几乎无法在项目之间做到按需热插拔。</p>
<h4 id="npm-方式共享模块"><a class="markdownIt-Anchor" href="#npm-方式共享模块">#</a> ● NPM 方式共享模块</h4>
<p>想象一下正常的共享模块方式，对，就是 NPM。</p>
<p>如下图所示，正常的代码共享需要将依赖作为 Lib 安装到项目，进行 Webpack 打包构建再上线，如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025245483.png" alt="image-20220124025245483"></p>
<p>对于项目 Home 与 Search，需要共享一个模块时，最常见的办法就是将其抽成通用依赖并分别安装在各自项目中。</p>
<p>虽然 Monorepo 可以一定程度解决重复安装和修改困难的问题，但依然需要走本地编译。</p>
<h4 id="umd-方式共享模块"><a class="markdownIt-Anchor" href="#umd-方式共享模块">#</a> ● UMD 方式共享模块</h4>
<p>真正 Runtime 的方式可能是 UMD 方式共享代码模块，即将模块用 Webpack UMD 模式打包，并输出到其他项目中。这是非常普遍的模块共享方式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/cd167a3551dc4d07b9e4259b9f04ade8%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>对于项目 Home 与 Search，直接利用 UMD 包复用一个模块。但这种技术方案问题也很明显，就是包体积无法达到本地编译时的优化效果，且库之间容易冲突。</p>
<h4 id="微前端方式共享模块"><a class="markdownIt-Anchor" href="#微前端方式共享模块">#</a> ● 微前端方式共享模块</h4>
<p>微前端：micro-frontends (MFE) 也是最近比较火的模块共享管理方式，微前端就是要解决多项目并存问题，多项目并存的最大问题就是模块共享，不能有冲突。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/fcaefffc9f374dbaa9d5c70fcd1049b3%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>由于微前端还要考虑样式冲突、生命周期管理，所以本文只聚焦在资源加载方式上。</p>
<p>微前端一般有两种打包方式：</p>
<ol>
<li>子应用独立打包，模块更解耦，但无法抽取公共依赖等。</li>
<li>整体应用一起打包，很好解决上面的问题，但打包速度实在是太慢了，不具备水平扩展能力。</li>
</ol>
<h4 id="模块联邦方式"><a class="markdownIt-Anchor" href="#模块联邦方式">#</a> ● 模块联邦方式</h4>
<p>终于提到本文的主角了，作为 Webpack5 内置核心特性之一的 Federated Module：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025305381.png" alt="image-20220124025305381"></p>
<p>从图中可以看到，这个方案是直接将一个应用的包应用于另一个应用，同时具备整体应用一起打包的公共依赖抽取能力。</p>
<hr>
<h3 id="92-搭建三个应用"><a class="markdownIt-Anchor" href="#92-搭建三个应用">#</a> 9.2 搭建三个应用</h3>
<p>本案例模拟三个应用：  <code>Nav</code>  、  <code>Search</code>  及  <code>Home</code>  。每个应用都是独立的，又通过模块联邦联系到了一起。</p>
<p>省略，见示例。</p>
<hr>
<h3 id="93-使用模块联邦"><a class="markdownIt-Anchor" href="#93-使用模块联邦">#</a> 9.3 使用模块联邦</h3>
<p>在 webpack.config.js 中 配置启用 模块联邦 功能。基本语法：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/55cba29d00054c0ca7d47dc20dd9d65a%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<blockquote>
<p>注意：<br>
1 . 如何暴露模块？<br>
2 . 如何导入模块？<br>
3 . 各个配置项的作用和使用方式。如图：</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/51220f63072e466f8fd1b985360ab7fb%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<hr>
<h3 id="示例-5"><a class="markdownIt-Anchor" href="#示例-5">#</a> ◎ 示例</h3>
<blockquote>
<p><code>Nav</code>  应用中有一个公共组件  <code>Header.js</code>  ，表示页面的公共头部。<br>
 <code>Home</code>  应用中有一个公共组件  <code>HomeList.js</code>  ，表示一个列表。</p>
<p>因为这里不使用 Vue 等框架，所以 Header.js、HomeList.js 不是真正的组件，只是模拟组件的样子，里面只写原生 js 代码，忽略样式等。</p>
</blockquote>
<h5 id="单独开发阶段"><a class="markdownIt-Anchor" href="#单独开发阶段">#</a> 单独开发阶段</h5>
<blockquote>
<p>分别开发三个相互独立的应用： Nav、Home、Search 。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/845dd3e3055c480b9929a8c8afc3c985%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<h6 id="1-nav"><a class="markdownIt-Anchor" href="#1-nav">#</a> 1、Nav</h6>
<p>1.0、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>1.1 测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//Header.js</span>

<span class="token keyword">const</span> <span class="token function-variable function">Header</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">)</span> 
    header<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'公共头部'</span>
    <span class="token keyword">return</span> header
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Header

<span class="token comment">//index.js</span>

<span class="token keyword">import</span> Header <span class="token keyword">from</span> <span class="token string">'./Header.js'</span>

<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
div<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>1.2、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    <span class="token comment">//devServer项可以设置，也可以不设置</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>1.3 打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025435673.png" alt="image-20220124025435673"></p>
<p>1.4 启动服务器，查看效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack serve <span class="token operator">--</span>port <span class="token number">3003</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025446022.png" alt="image-20220124025446022"></p>
<p>1.5 结论。</p>
<p>第一个应用 Nav 开发完成。</p>
<h6 id="2-home"><a class="markdownIt-Anchor" href="#2-home">#</a> 2、Home</h6>
<p>2.0、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2.1 测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//HomeList.js</span>

<span class="token keyword">const</span> <span class="token function-variable function">HomeList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'&lt;ul>'</span> 
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        str <span class="token operator">+=</span> <span class="token string">'&lt;li> item '</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">'&lt;/li>'</span>
    <span class="token punctuation">&#125;</span>
    str <span class="token operator">+=</span> <span class="token string">'&lt;/ul>'</span>
    <span class="token keyword">return</span> str 
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HomeList

<span class="token comment">//index.js</span>

<span class="token keyword">import</span> HomeList <span class="token keyword">from</span> <span class="token string">'./HomeList.js'</span>

<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span> 
div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">HomeList</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.2、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.3 打包，启动服务器，查看效果。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>port <span class="token number">3004</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/e2996141b3e945818f875e3b8429e0a6%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/7cbacb3ee9694fad8ead83b785133eff%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>2.4 结论。</p>
<p>第二个应用 Home 开发完成了。</p>
<h6 id="3-search"><a class="markdownIt-Anchor" href="#3-search">#</a> 3、Search</h6>
<p>3.0、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3.1 测试代码。</p>
<blockquote>
<p>Search 应用 要使用 Nav 应用中的公共组件 Header.js 和 Home 应用中的公共组件 HomeList.js 。</p>
</blockquote>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3.2、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="使用模块联邦"><a class="markdownIt-Anchor" href="#使用模块联邦">#</a> 使用模块联邦</h5>
<blockquote>
<p>假设 Nav、Home、Search 这三个相互独立的应用 都已经开发完成，而且都已经发布上线了。在线上环境中，不同应用之间 如果想访问 彼此的公共模块，如 Nav 应用 想要访问 Home 应用 中的公共组件 HomeList，应该怎么办呢？</p>
<p><strong>模块联邦</strong></p>
<p>模块联邦 是 webpack 的一个内置插件。</p>
</blockquote>
<h6 id="1-nav-2"><a class="markdownIt-Anchor" href="#1-nav-2">#</a> 1、Nav</h6>
<blockquote>
<p>使用 模块联邦插件  <code>ModuleFederationPlugin</code>  向外暴露了一个公共模块  <code>Header</code>  。</p>
</blockquote>
<p>1.1 修改 webpack.config.js：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> ModuleFederationPlugin <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>container
 
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">'nav'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'remoteEntry.js'</span><span class="token punctuation">,</span>
        remotes<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        exposes<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'./Header'</span><span class="token operator">:</span> <span class="token string">'./src/Header.js'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        shared<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>1.2 打包，启动服务器</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>port <span class="token number">3003</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/3bfc2f5c08894d0cb44ae9f68b4a0407%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025531398.png" alt="image-20220124025531398"></p>
<h6 id="2-home-2"><a class="markdownIt-Anchor" href="#2-home-2">#</a> 2、Home</h6>
<blockquote>
<p>1、使用 模块联邦插件  <code>ModuleFederationPlugin</code>  向外暴露了一个公共模块  <code>HomeList</code>  。</p>
<p>2、在 Home 应用 中，想要使用 Nav 应用 中提供的公共模块 Header。</p>
</blockquote>
<p>2.1 修改 webpack.config.js：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> ModuleFederationPlugin <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>container

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">'home'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'remoteEntry.js'</span><span class="token punctuation">,</span>
        remotes<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            nav<span class="token operator">:</span> <span class="token string">'nav@http://localhost:3003/remoteEntry.js'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        exposes<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'./HomeList'</span><span class="token operator">:</span> <span class="token string">'./src/HomeList.js'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        shared<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.2 修改 index.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> HomeList <span class="token keyword">from</span> <span class="token string">'./HomeList.js'</span>

<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'nav/Header'</span><span class="token punctuation">)</span> 
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">Header</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
	
	div<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>Header<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	
	div<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token function">HomeList</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
	document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2.3 打包，启动服务器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve <span class="token operator">--</span>port <span class="token number">3004</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025554373.png" alt="image-20220124025554373"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/ed78923644e341c59612977d451cda16%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>2.4 页面效果</p>
<p>在浏览器中分别访问 两个应用： Nav 应用  <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3003%2F">http://localhost:3003/</a> ，Home 应用 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3004%2F">http://localhost:3004/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/48c633d8b6b44738983d12be6d935202%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025609169.png" alt="image-20220124025609169"></p>
<p>2.5 结论。</p>
<p>可见，Home 应用 成功地引入了 Nav 应用 中的 Header 模块。</p>
<h6 id="3-search-2"><a class="markdownIt-Anchor" href="#3-search-2">#</a> 3、Search</h6>
<blockquote>
<p>同理，Search 应用 如果想使用 Nav 应用中的 Header 模块 和 Home 应用中的 HomeList 模块，则依照上面的步骤进行即可。</p>
</blockquote>
<p>3.1 webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> ModuleFederationPlugin <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>container

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        name<span class="token operator">:</span> <span class="token string">'search'</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'remoteEntry.js'</span><span class="token punctuation">,</span>
        remotes<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            nav<span class="token operator">:</span> <span class="token string">'nav@http://localhost:3003/remoteEntry.js'</span><span class="token punctuation">,</span>
            home<span class="token operator">:</span> <span class="token string">'home@http://localhost:3004/remoteEntry.js'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        exposes<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        shared<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.2 index.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">/* 
import('nav/Header')
.then((Header) => &#123;
    document.body.appendChild(Header.default())
&#125;)

import('home/HomeList')
.then((HomeList) => &#123;
    document.body.innerHTML +=  HomeList.default(8) 
&#125;) */</span>

<span class="token comment">//使用 Promise.all() 优化上面的代码</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'nav/Header'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'home/HomeList'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> Header<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span> <span class="token keyword">default</span><span class="token operator">:</span> HomeList<span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token function">HomeList</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3.3 打包，启动服务器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack 
npx webpack serve <span class="token operator">--</span>port <span class="token number">3005</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025626687.png" alt="image-20220124025626687"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025647202.png" alt="image-20220124025647202"></p>
<p>3.4 浏览器效果。</p>
<p>在浏览器中访问 Search 应用 页面 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3005%2F">http://localhost:3005/</a></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/5d5ecd84a01941198909c797b98ad0d2%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>3.5 结论。</p>
<p>在线上环境中， <code>Search</code>  应用 成功地使用到了  <code>Nav</code>  应用 向外提供的公共模块 <code>Header</code>  和  <code>Home</code>  应用 向外提供的公共模块 <code>HomeList</code> 。</p>
<h5 id="结论"><a class="markdownIt-Anchor" href="#结论">#</a> 结论</h5>
<p>至此，我们就掌握了 webpack 模块联邦 的基本使用。</p>
<hr>
<h2 id="第十章-提升构建性能"><a class="markdownIt-Anchor" href="#第十章-提升构建性能">#</a> 第十章：提升构建性能</h2>
<p>webpack 的性能提升分为两类：<br>
1、提升项目的性能。如减少首屏时间。受益者是用户。<br>
2、提升 webpack 的构建编译性能。如提高编译速度，减少编译时间。受益者是开发人员。</p>
<p>本章讲的是第二种。</p>
<p>不同版本的 webpack 有不同的优化点，建议参考官网进行操作。</p>
<h3 id="101-八个通用构建优化"><a class="markdownIt-Anchor" href="#101-八个通用构建优化">#</a> 10.1 八个通用构建优化</h3>
<p>无论你是在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fdevelopment">开发环境</a> 还是在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.docschina.org%2Fguides%2Fproduction">生产环境</a> 下运行构建脚本，以下最佳实践都会有所帮助。</p>
<h4 id="1-更新到最新版本"><a class="markdownIt-Anchor" href="#1-更新到最新版本">#</a> 1、更新到最新版本</h4>
<p>使用最新的  <code>webpack</code>  版本。我们会经常进行性能优化。</p>
<p>将  <code>Node.js</code>  更新到最新版本，也有助于提高性能。除此之外，将你的 package 管理工具（例如  <code>npm</code>  或者  <code>yarn</code>  ）更新到最新版本，也有助于提高性能。较新的版本能够建立更高效的模块树以及提高解析速度。</p>
<h4 id="2-loader"><a class="markdownIt-Anchor" href="#2-loader">#</a> 2、loader</h4>
<p>将 loader 应用于最少数量的必要模块。而非如下:</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>通过使用  <code>include</code>  字段，仅将 loader 应用在实际需要将其转换的模块：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="3-引导bootstrap"><a class="markdownIt-Anchor" href="#3-引导bootstrap">#</a> 3、引导 (bootstrap)</h4>
<p>每个额外的 loader/plugin 都有其启动时间。尽量少地使用工具。</p>
<h4 id="4-解析"><a class="markdownIt-Anchor" href="#4-解析">#</a> 4、解析</h4>
<p>以下步骤可以提高解析速度：</p>
<ul>
<li>减少  <code>resolve.modules</code>  ,  <code>resolve.extensions</code>  ,  <code>resolve.mainFiles</code>  ,  <code>resolve.descriptionFiles</code>  中条目数量，因为他们会增加文件系统调用的次数。</li>
<li>如果你不使用  <code>symlinks</code> （例如  <code>npm link</code>  或者  <code>yarn link</code>  ），可以设置  <code>resolve.symlinks: false</code>  。</li>
<li>如果你使用自定义  <code>resolve plugin</code>  规则，并且没有指定  <code>context</code>  上下文，可以设置  <code>resolve.cacheWithContext: false</code>  。</li>
</ul>
<h4 id="5-小即是快smaller-faster"><a class="markdownIt-Anchor" href="#5-小即是快smaller-faster">#</a> 5、小即是快 (smaller = faster)</h4>
<ul>
<li>使用数量更少 / 体积更小的 library。</li>
<li>在多页面应用程序中使用 SplitChunksPlugin 。</li>
<li>在多页面应用程序中使用 SplitChunksPlugin ，并开启 async 模式。</li>
<li>移除未引用代码。</li>
<li>只编译你当前正在开发的那些代码。</li>
</ul>
<h4 id="6-持久化缓存"><a class="markdownIt-Anchor" href="#6-持久化缓存">#</a> 6、持久化缓存</h4>
<p>在 webpack 配置中使用  <code>cache</code>  选项。使用  <code>package.json</code>  中的  <code>&quot;postinstall&quot; </code> 清除缓存目录。</p>
<p>将  <code>cache</code>  类型设置为内存或者文件系统。  <code>memory</code>  选项很简单，它告诉 webpack 在内存中存储缓存，不允许额外的配置：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//...</span>
    cache<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        type<span class="token operator">:</span> <span class="token string">'memory'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="7-自定义-pluginloader"><a class="markdownIt-Anchor" href="#7-自定义-pluginloader">#</a> 7、自定义 plugin/loader</h4>
<p>对它们进行概要分析，以免在此处引入性能问题。</p>
<h4 id="8-dll"><a class="markdownIt-Anchor" href="#8-dll">#</a> 8、dll</h4>
<p>使用 DllPlugin 为更改不频繁的代码生成单独的编译结果。这可以提高应用程序的编译速度，尽管它增加了构建过程的复杂度。</p>
<h4 id="9-worker-池worker-pool"><a class="markdownIt-Anchor" href="#9-worker-池worker-pool">#</a> 9、worker 池 (worker pool)</h4>
<p><code>thread-loader</code>  可以将非常消耗资源的 loader 分流给一个 worker pool。</p>
<blockquote>
<p>不要使用太多的 worker，因为 Node.js 的 runtime 和 loader 都有启动开销。最小化 worker 和 main process (主进程) 之间的模块传输。进程间通讯 (IPC,inter process communication) 是非常消耗资源的。</p>
</blockquote>
<h4 id="10-progress-plugin"><a class="markdownIt-Anchor" href="#10-progress-plugin">#</a> 10、Progress plugin</h4>
<p>将 ProgressPlugin 从 webpack 中删除，可以缩短构建时间。请注意，ProgressPlugin 可能不会为快速构建提供太多价值，因此，请权衡利弊再使用。</p>
<hr>
<h3 id="102-通用构建优化-dll"><a class="markdownIt-Anchor" href="#102-通用构建优化-dll">#</a> 10.2 通用构建优化 - dll</h3>
<blockquote>
<p>本节，演示如何使用 dll 来提高构建速度。</p>
</blockquote>
<h4 id="示例-6"><a class="markdownIt-Anchor" href="#示例-6">#</a> ◎ 示例</h4>
<blockquote>
<p>示例项目中使用了第三方包 lodash，它的代码是不变的，只需要打包一次，而我们自己的代码则因为频繁修改需要打包多次，所以可以对 lodash 使用 dll 技术，来避免不必要的重复打包，提高打包速度。</p>
</blockquote>
<p>1、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin

npm i <span class="token operator">-</span><span class="token constant">S</span> lodash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、测试代码。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//index.js</span>

<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'webpack'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//webpack.config.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/8df8b23969674f76a5702935db9ea2e8%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>4、结论。</p>
<blockquote>
<p>在没有使用 dll 技术时，打包耗时 3693ms，main.js 的体积为 69.5kb。</p>
</blockquote>
<p>5、<strong>webpack.dll.config.js</strong></p>
<p>新建 webpack.dll.config.js 文件，写入以下内容：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        lodash<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'lodash'</span><span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        library<span class="token operator">:</span> <span class="token string">'[name]_[hash]'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            name<span class="token operator">:</span> <span class="token string">'[name]_[hash]'</span><span class="token punctuation">,</span>
            path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dll/manifest.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>6、<strong>package.json</strong></p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token string">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"dll"</span><span class="token operator">:</span> <span class="token string">"webpack --config ./webpack.dll.config.js"</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>7、<strong>dll 打包</strong>。</p>
<p>dll 打包，生成 manifest 文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm run dll<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/0b624fb701704fdea028f509eb3abdb1%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/2e9e322bce3e44b2a0f77a61964ddc62%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>7.2、结论。</p>
<p>可见，打包输出了一个新的目录 dll，里面有：</p>
<ul>
<li>lodash.js 第三方包被单独打包出来了</li>
<li>manifest.json 这个文件就是用来进行构建缓存的。</li>
<li>xxx.txt</li>
</ul>
<p>8、webpack.config.js</p>
<p>使用 dll 打包后生成的文件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token operator">...</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>

<span class="token operator">...</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dll/manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>9、应用打包。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025907051.png" alt="image-20220124025907051"></p>
<p>10、结论。</p>
<blockquote>
<p>可见，使用 dll 后，打包耗时为 608ms，main.js 体积为 556bytes，构建速度快了 6 倍。</p>
</blockquote>
<blockquote>
<p>注意：此时，main.js 中并不包含 lodash 代码，index.html 中也只引入了 main.js。所以还不能部署上线。</p>
</blockquote>
<p>11、安装 <strong>AddAssetHtmlWebpackPlugin</strong> 插件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm i <span class="token operator">-</span><span class="token constant">D</span> add<span class="token operator">-</span>asset<span class="token operator">-</span>html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>12、配置 <strong>AddAssetHtmlWebpackPlugin</strong> 插件。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">//webpack.config.js</span>

<span class="token operator">...</span>
<span class="token keyword">const</span> AddAssetHtmlPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'add-asset-html-webpack-plugin'</span><span class="token punctuation">)</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>
    <span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dll/lodash.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        publicPath<span class="token operator">:</span> <span class="token string">'./'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>13、打包，启动开发服务器。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack
npx webpack serve<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/d4a3a6f33b0645ba8c4fa068102617ed%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bafd6023811c4ec49e83183a5e140442~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb048ca59b684d4fbb79c6ceb943c188~tplv-k3u1fbpfcp-watermark.awebp?" alt="image.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/80ae91e2ca514cea8e9a125dcaf439c4%7Etplv-k3u1fbpfcp-watermark.awebp" alt="image.png"></p>
<p>14、结论。</p>
<blockquote>
<p>开发时，先对第三方包进行 dll 打包，可以提高打包速度。最后打包时，需要使用  <code>AddAssetHtmlWebpackPlugin</code>  插件 来将 dll 打包好的第三方包 合并到最终的打包结果中，才能部署上线。</p>
</blockquote>
<hr>
<h3 id="103-通用构建优化-worker-pool"><a class="markdownIt-Anchor" href="#103-通用构建优化-worker-pool">#</a> 10.3 通用构建优化 - worker-pool</h3>
<blockquote>
<p>worker 池 (worker pool)：<br>
<strong>thread-loader</strong> 可以将非常消耗资源的 loader 分流给一个 worker pool 。</p>
</blockquote>
<blockquote>
<p>thread-loader 的使用方法： 哪个 loader 需要放在 worker pool 中运行，就在哪个 loader 的前面添加 thread-loader 。</p>
</blockquote>
<h4 id="示例-7"><a class="markdownIt-Anchor" href="#示例-7">#</a> ◎ 示例</h4>
<blockquote>
<p>本示例中，使用 babel-loader 对应用中的 class 语法进行转换。我们想将 babel-loader 放在一个 worker pool 中运行，来提高打包速度。</p>
<p>也可以简单理解为：利用电脑多核的特点，将 babel-loader 单独放在一个 CPU 中运行。</p>
</blockquote>
<p>1、搭建 webpack 基本环境。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npm init <span class="token operator">-</span>y
npm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack webpack<span class="token operator">-</span>cli webpack<span class="token operator">-</span>dev<span class="token operator">-</span>server html<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin

npm i <span class="token operator">-</span><span class="token constant">D</span> babel<span class="token operator">-</span>loader @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env

npm i <span class="token operator">-</span><span class="token constant">D</span> thread<span class="token operator">-</span>loader<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、webpack.config.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
    entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        clean<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    devtool<span class="token operator">:</span> <span class="token string">'cheap-module-source-map'</span><span class="token punctuation">,</span>
    devServer<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        rules<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                use<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">&#123;</span>
                        loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                        options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                            presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、index.js</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'汪汪'</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> dog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
dog<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、打包</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124025949780.png" alt="image-20220124025949780"></p>
<p>4.2 结论</p>
<p>可见，没有使用 worker pool 时，打包耗时 1171ms，main.js 体积为 1.22kb。</p>
<p>5、配置 thread-loader。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span>
                    loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token comment">//添加thread-loader</span>
                <span class="token punctuation">&#123;</span>
                    loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
                    options<span class="token operator">:</span><span class="token punctuation">&#123;</span>
                        workers<span class="token operator">:</span> <span class="token number">2</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>6、打包</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">npx webpack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://raw.githubusercontent.com/HarryQu1229/image-host/main/notes-img/image-20220124030007602.png" alt="image-20220124030007602"></p>
<p>6.2 结论</p>
<blockquote>
<p>可见，使用 worker pool 时，打包耗时 1324ms，竟然比没有使用时还长，这是为什么呢？</p>
<p>这是因为启动 thread-loader 是需要时间的。另外一个原因是：worker pool 只对那些耗时很长的 loader 才会有明显的提升效果，而本示例中 babel-loader 只是简单转换了 class 语法，耗时并不长，所以效果不明显。</p>
</blockquote>
<hr>
<h3 id="103-开发环境"><a class="markdownIt-Anchor" href="#103-开发环境">#</a> 10.3 开发环境</h3>
<p>以下步骤对于 开发环境 特别有帮助。</p>
<h4 id="1-增量编译"><a class="markdownIt-Anchor" href="#1-增量编译">#</a> 1、增量编译</h4>
<p>使用 webpack 的 watch mode (监听模式)。而不使用其他工具来 watch 文件和调用 webpack 。内置的 watch mode 会记录时间戳并将此信息传递给 compilation 以使缓存失效。</p>
<p>在某些配置环境中，watch mode 会回退到 poll mode (轮询模式)。监听许多文件会导致 CPU 大量负载。在这些情况下，可以使用  <code>watchOptions.poll</code>  来增加轮询的间隔时间。</p>
<h4 id="2-在内存中编译"><a class="markdownIt-Anchor" href="#2-在内存中编译">#</a> 2、在内存中编译</h4>
<p>下面几个工具通过在内存中（而不是写入磁盘）编译和 serve 资源来提高性能：</p>
<ul>
<li><code>webpack-dev-server</code></li>
<li><code>webpack-hot-middleware</code></li>
<li><code>webpack-dev-middleware</code></li>
</ul>
<h4 id="3-statstojson-加速"><a class="markdownIt-Anchor" href="#3-statstojson-加速">#</a> 3、stats.toJson 加速</h4>
<p>webpack 4 默认使用  <code>stats.toJson()</code>  输出大量数据。除非在增量步骤中做必要的统计，否则请避免获取  <code>stats</code>  对象的部分内容。  <code>webpack-dev-server</code>  在 v3.1.3 以后的版本，包含一个重要的性能修复，即最小化每个增量构建步骤中，从  <code>stats</code>  对象获取的数据量。</p>
<h4 id="4-devtool"><a class="markdownIt-Anchor" href="#4-devtool">#</a> 4、Devtool</h4>
<p>需要注意的是不同的 devtool 设置，会导致性能差异。</p>
<ul>
<li>“eval” 具有最好的性能，但并不能帮助你转译代码。</li>
<li>如果你能接受稍差一些的 map 质量，可以使用 cheap-source-map 变体配置来提高性能</li>
<li>使用 eval-source-map 变体配置进行增量编译。</li>
</ul>
<blockquote>
<p>在大多数情况下，最佳选择是 eval-cheap-module-source-map 。</p>
</blockquote>
<h4 id="5-避免在生产环境下才会用到的工具"><a class="markdownIt-Anchor" href="#5-避免在生产环境下才会用到的工具">#</a> 5、避免在生产环境下才会用到的工具</h4>
<p>某些 utility, plugin 和 loader 都只用于生产环境。例如，在开发环境下使用  <code>TerserPlugin</code>  来 minify (压缩) 和 mangle (混淆破坏) 代码是没有意义的。通常在开发环境下，应该排除以下这些工具：</p>
<ul>
<li><code>TerserPlugin</code></li>
<li><code>[fullhash]</code>  /  <code>[chunkhash]</code>  / <code> [contenthash]</code></li>
<li><code>AggressiveSplittingPlugin</code></li>
<li><code>AggressiveMergingPlugin</code></li>
<li><code>ModuleConcatenationPlugin</code></li>
</ul>
<h4 id="6-最小化-entry-chunk"><a class="markdownIt-Anchor" href="#6-最小化-entry-chunk">#</a> 6、最小化 entry chunk</h4>
<p>Webpack 只会在文件系统中输出已经更新的 chunk。某些配置选项（HMR, output.chunkFilename 的 [name] / [chunkhash]/[contenthash] ， [fullhash] ）来说，除了对已经更新的 chunk 无效之外，对于 entry chunk 也不会生效。</p>
<p>确保在生成 entry chunk 时，尽量减少其体积以提高性能。下面的配置为运行时代码创建了一个额外的 chunk，所以它的生成代价较低：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        runtimeChunk<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="7-避免额外的优化步骤"><a class="markdownIt-Anchor" href="#7-避免额外的优化步骤">#</a> 7、避免额外的优化步骤</h4>
<p>Webpack 通过执行额外的算法任务，来优化输出结果的体积和加载性能。这些优化适用于小型代码库，但是在大型代码库中却非常耗费性能：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    optimization<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        removeAvailableModules<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        removeEmptyChunks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        splitChunks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="8-输出结果不携带路径信息"><a class="markdownIt-Anchor" href="#8-输出结果不携带路径信息">#</a> 8、输出结果不携带路径信息</h4>
<p>Webpack 会在输出的 bundle 中生成路径信息。然而，在打包数千个模块的项目中，这会导致造成垃圾回收性能压力。在  <code>options.output.pathinfo</code>  设置中关闭：</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    output<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        pathinfo<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="9-nodejs-版本-8910-9111"><a class="markdownIt-Anchor" href="#9-nodejs-版本-8910-9111">#</a> 9、Node.js 版本 8.9.10-9.11.1</h4>
<p>Node.js v8.9.10 - v9.11.1 中的 ES2015 Map 和 Set 实现，存在 性能回退。Webpack 大量地使用这些数据结构，因此这次回退也会影响编译时间。之前和之后的 Node.js 版本不受影响。</p>
<h4 id="10-typescript-loader"><a class="markdownIt-Anchor" href="#10-typescript-loader">#</a> 10、TypeScript loader</h4>
<p>你可以为 loader 传入  <code>transpileOnly</code>  选项，以缩短使用  <code>ts-loader</code>  时的构建时间。使用此选项，会关闭类型检查。如果要再次开启类型检查，请使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffork-ts-checker-webpack-plugin">ForkTsCheckerWebpackPlugin</a> 。使用此插件会将检查过程移至单独的进程，可以加快 TypeScript 的类型检查和 ESLint 插入的速度。</p>
<pre class="line-numbers language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            loader<span class="token operator">:</span> <span class="token string">'ts-loader'</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                transpileOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<hr>
<h3 id="104-生产环境"><a class="markdownIt-Anchor" href="#104-生产环境">#</a> 10.4 生产环境</h3>
<p>以下步骤对于 生产环境 特别有帮助。</p>
<h4 id="不启用sourcmap"><a class="markdownIt-Anchor" href="#不启用sourcmap">#</a> 不启用 SourcMap</h4>
<p>source map 相当消耗资源，开发环境模式不要设置 source map</p>
<p>–</p>
<h2 id="官方链接"><a class="markdownIt-Anchor" href="#官方链接">#</a> 官方链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnaotu.baidu.com%2F">百度脑图</a></p>
<h2 id="视频教程"><a class="markdownIt-Anchor" href="#视频教程">#</a> 视频教程</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1YU4y1g745">千锋最新前端 webpack5 全套教程，全网最完整的 webpack 教程（基础 + 高级）</a></p>
<h2 id="学习资料"><a class="markdownIt-Anchor" href="#学习资料">#</a> 学习资料</h2>
<p>H:\ 学习课程 \ediary 日记 \ 学习课程 \webpack5_千峰 \ 资料 \ 笔记 - webpack5 学习指南 - V1.0 - 去水印.pdf</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Harry Qu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://harryqu1229.github.io/2021/12/29/webpack5%E9%AB%98%E7%BA%A7/">https://harryqu1229.github.io/2021/12/29/webpack5%E9%AB%98%E7%BA%A7/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/frontend/">frontend</a><a class="post-meta__tags" href="/tags/webpack5/">webpack5</a></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-621848f44e1c3724" async="async"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/statue.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Computer Network</div></div></a></div><div class="next-post pull-right"><a href="/2021/12/29/webpack5%E5%9F%BA%E7%A1%80/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/hello-world.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">My Webpack5 Advanced notes</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/12/29/webpack5%E5%9F%BA%E7%A1%80/" title="My Webpack5 Advanced notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/hello-world.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-29</div><div class="title">My Webpack5 Advanced notes</div></div></a></div><div><a href="/2022/01/01/20%E9%81%93%E5%A4%A7%E5%8E%82%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/" title="20 Frontend Interview Quesitions"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/car.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-01</div><div class="title">20 Frontend Interview Quesitions</div></div></a></div><div><a href="/2022/01/01/45%E9%81%93promise%E9%9D%A2%E8%AF%95%E9%A2%98/" title="45 Promise Frontend Interview Quesitions"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/cat.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-01</div><div class="title">45 Promise Frontend Interview Quesitions</div></div></a></div><div><a href="/2022/01/01/30%E9%81%93vue%E9%9D%A2%E8%AF%95%E9%A2%98/" title="30 Vue Frontend Interview Quesitions"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/mountain2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-01</div><div class="title">30 Vue Frontend Interview Quesitions</div></div></a></div><div><a href="/2022/01/01/50%E9%81%93%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E9%A2%98/" title="50 Frontend Interview Quesitions"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-01</div><div class="title">50 Frontend Interview Quesitions</div></div></a></div><div><a href="/2021/09/13/AJAX/" title="My Ajax notes"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/forest.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-13</div><div class="title">My Ajax notes</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Disqus</span><span class="switch-btn"></span><span class="second-comment">Gitalk</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Harry Qu</div><div class="author-info__description">Software Engineering Student</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">158</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">84</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">57</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/HarryQu1229"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://www.linkedin.com/in/harry-qu-a0a38220a" target="_blank" title="LinkedIn"><i class="fab fa-linkedin"></i></a><a class="social-icon" href="https://github.com/HarryQu1229" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:Harryqu666@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="weixin://dl/chat?harry666ya" target="_blank" title="Wechat"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">be healthy, stay safe</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#webpack5%E9%AB%98%E7%BA%A7%E7%AF%87"><span class="toc-number">1.</span> <span class="toc-text"> webpack5：高级篇</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text"> 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0%E6%8F%90%E9%AB%98%E5%BC%80%E5%8F%91%E6%95%88%E7%8E%87%E4%B8%8E%E5%AE%8C%E5%96%84%E5%9B%A2%E9%98%9F%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="toc-number">1.2.</span> <span class="toc-text"> 第一章：提高开发效率与完善团队开发规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-source-map"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 1.1 source-map</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.1.1.</span> <span class="toc-text"> 7 种模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cheap-source-map-source-map%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.2.1.2.</span> <span class="toc-text"> cheap-source-map、source-map 的区别：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cheap-source-map-cheap-module-source-map%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.2.1.3.</span> <span class="toc-text"> cheap-source-map、cheap-module-source-map 的区别。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90-cheap-module-source-map"><span class="toc-number">1.2.1.4.</span> <span class="toc-text"> 推荐 cheap-module-source-map</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-devserver"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 1.2 devServer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.2.1.</span> <span class="toc-text"> 基础使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AFgzips%E5%8E%8B%E7%BC%A9"><span class="toc-number">1.2.2.2.</span> <span class="toc-text"> 开启 gzips 压缩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">1.2.2.3.</span> <span class="toc-text"> 设置端口号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-number">1.2.2.4.</span> <span class="toc-text"> 设置响应头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%90%86"><span class="toc-number">1.2.2.5.</span> <span class="toc-text"> 启动代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#https"><span class="toc-number">1.2.2.6.</span> <span class="toc-text"> https</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http2"><span class="toc-number">1.2.2.7.</span> <span class="toc-text"> http2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#historyapifallback"><span class="toc-number">1.2.2.8.</span> <span class="toc-text"> historyApiFallback</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.2.2.9.</span> <span class="toc-text"> 开发服务器主机</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2%E4%B8%8E%E7%83%AD%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.2.3.</span> <span class="toc-text"> 1.3 模块热替换与热加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%AD%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.2.3.1.</span> <span class="toc-text"> 热替换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%AD%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.2.3.2.</span> <span class="toc-text"> 热加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1css%E7%9A%84%E7%83%AD%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.2.3.3.</span> <span class="toc-text"> 示例 1：css 的热替换。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2js%E7%9A%84%E7%83%AD%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.2.3.4.</span> <span class="toc-text"> 示例 2：js 的热替换。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.2.3.5.</span> <span class="toc-text"> 小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-eslint"><span class="toc-number">1.2.4.</span> <span class="toc-text"> 1.4 eslint</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.4.1.</span> <span class="toc-text"> 基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vscode%E6%8F%92%E4%BB%B6"><span class="toc-number">1.2.4.2.</span> <span class="toc-text"> VSCode 插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E5%90%88webpack%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.4.3.</span> <span class="toc-text"> 结合 webpack 使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%E5%8D%95%E7%8B%AC%E4%BD%BF%E7%94%A8eslint"><span class="toc-number">1.2.4.4.</span> <span class="toc-text"> 示例 1：单独使用 eslint。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2%E5%9C%A8webpack%E4%B8%AD%E4%BD%BF%E7%94%A8eslint"><span class="toc-number">1.2.4.5.</span> <span class="toc-text"> 示例 2：在 webpack 中使用 eslint。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E8%A6%86%E7%9B%96%E5%B1%82"><span class="toc-number">1.2.4.6.</span> <span class="toc-text"> 关闭覆盖层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-git-hooks-%E4%B8%8E-husky-%E5%BB%BA%E8%AE%AE%E5%85%88%E5%8E%BB%E5%AD%A6git"><span class="toc-number">1.2.5.</span> <span class="toc-text"> 1.5 git-hooks 与 husky (建议先去学 git)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#git-hooks%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.2.5.1.</span> <span class="toc-text"> git hooks 的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1%E4%B8%8D%E6%88%90%E5%8A%9F"><span class="toc-number">1.2.5.1.1.</span> <span class="toc-text"> 示例 1：不成功。</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4hooks"><span class="toc-number">1.2.5.2.</span> <span class="toc-text"> 提交 hooks</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2%E4%B9%9F%E6%B2%A1%E6%9C%89%E6%88%90%E5%8A%9F"><span class="toc-number">1.2.5.2.1.</span> <span class="toc-text"> 示例 2：也没有成功。</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#husky"><span class="toc-number">1.2.5.3.</span> <span class="toc-text"> husky</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3husky%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-%E6%B2%A1%E6%9C%89%E6%88%90%E5%8A%9F"><span class="toc-number">1.2.5.3.1.</span> <span class="toc-text"> 示例 3：husky 的基本使用。没有成功。</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%E6%A8%A1%E5%9D%97%E4%B8%8E%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.</span> <span class="toc-text"> 第二章：模块与依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-webpack-%E6%A8%A1%E5%9D%97%E4%B8%8E%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 2.1 Webpack 模块与解析原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#webpack-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.1.1.</span> <span class="toc-text"> webpack 模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#compiler%E4%B8%8Eresolvers"><span class="toc-number">1.3.1.2.</span> <span class="toc-text"> compiler 与 Resolvers</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E6%A8%A1%E5%9D%97%E8%A7%A3%E6%9E%90resolve"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 2.2 模块解析 (resolve)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-webpack%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E8%B7%AF%E5%BE%84%E8%A7%A3%E6%9E%90%E8%A7%84%E5%88%99"><span class="toc-number">1.3.2.1.</span> <span class="toc-text"> 1、webpack 中的模块路径解析规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-resolve"><span class="toc-number">1.3.2.2.</span> <span class="toc-text"> 2、resolve</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#alias-%E8%AE%BE%E7%BD%AE%E7%9B%AE%E5%BD%95%E5%88%AB%E5%90%8D"><span class="toc-number">1.3.2.2.1.</span> <span class="toc-text"> alias 设置目录别名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9C%81%E7%95%A5%E5%90%8E%E7%BC%80%E5%90%8D"><span class="toc-number">1.3.2.2.2.</span> <span class="toc-text"> 省略后缀名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#extentions-%E8%AE%BE%E7%BD%AE%E6%9F%A5%E6%89%BE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">1.3.2.2.3.</span> <span class="toc-text"> extentions 设置查找优先级</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E4%BE%8B%E5%AD%90"><span class="toc-number">1.3.2.2.4.</span> <span class="toc-text"> 一些例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-%E5%A4%96%E9%83%A8%E6%89%A9%E5%B1%95externals"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 2.3 外部扩展 (Externals)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%BC%95%E5%85%A5cdn%E9%93%BE%E6%8E%A5"><span class="toc-number">1.3.3.1.</span> <span class="toc-text"> 自动引入 cdn 链接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#24-%E4%BE%9D%E8%B5%96%E5%9B%BEdependency-graph"><span class="toc-number">1.3.4.</span> <span class="toc-text"> 2.4 依赖图 (dependency graph)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.4.1.</span> <span class="toc-text"> ◎ 示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E7%AB%A0%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD"><span class="toc-number">1.4.</span> <span class="toc-text"> 第三章：扩展功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-postcss%E4%B8%8Ecss%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 3.1 PostCSS 与 CSS 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#postcss"><span class="toc-number">1.4.1.1.</span> <span class="toc-text"> PostCSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#css-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.4.1.2.</span> <span class="toc-text"> CSS 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bautoprefixer%E6%8F%92%E4%BB%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.1.2.1.</span> <span class="toc-text"> ◎ 示例：autoprefixer 插件的基本使用。</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bpostcss-nested%E6%8F%92%E4%BB%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.1.3.</span> <span class="toc-text"> ◎ 示例：postcss-nested 插件的基本使用。</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bcss%E6%A8%A1%E5%9D%97%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.1.3.1.</span> <span class="toc-text"> ◎ 示例：css 模块的基本使用。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-web-works"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 3.2 Web Works</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">1.4.2.1.</span> <span class="toc-text"> ◎ 示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#33-typescript"><span class="toc-number">1.4.3.</span> <span class="toc-text"> 3.3 TypeScript</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E7%B1%BB%E5%BA%93"><span class="toc-number">1.4.3.1.</span> <span class="toc-text"> 使用第三方类库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#eslint-ts"><span class="toc-number">1.4.3.2.</span> <span class="toc-text"> eslint &amp; ts</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.4.3.3.</span> <span class="toc-text"> 一些示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bwebpack%E6%89%93%E5%8C%85ts%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.3.3.1.</span> <span class="toc-text"> ◎ 示例：webpack 打包.ts 文件。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bts%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85"><span class="toc-number">1.4.3.3.2.</span> <span class="toc-text"> ◎ 示例：.ts 中使用第三方包。</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="toc-number">1.5.</span> <span class="toc-text"> 小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.</span> <span class="toc-text"> 第四章：多页面应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-entry-%E9%85%8D%E7%BD%AE"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 4.1 entry 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E5%85%A5%E5%8F%A3%E7%AE%80%E5%86%99%E8%AF%AD%E6%B3%95"><span class="toc-number">1.6.1.1.</span> <span class="toc-text"> ● 单个入口（简写）语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E8%AF%AD%E6%B3%95"><span class="toc-number">1.6.1.2.</span> <span class="toc-text"> ● 对象语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">1.6.1.3.</span> <span class="toc-text"> 一些示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B1entry%E6%98%AF%E4%B8%80%E4%B8%AA%E6%95%B0%E7%BB%84"><span class="toc-number">1.6.1.3.1.</span> <span class="toc-text"> ◎ 示例 1：entry 是一个数组。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B2entry%E6%95%B0%E7%BB%84%E4%B8%AD%E5%8C%85%E5%90%AB%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85"><span class="toc-number">1.6.1.3.2.</span> <span class="toc-text"> ◎ 示例 2：entry 数组中包含第三方包。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B3%E5%8D%95%E7%8B%AC%E8%BE%93%E5%87%BA%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85"><span class="toc-number">1.6.1.3.3.</span> <span class="toc-text"> ◎ 示例 3：单独输出第三方包。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B4%E9%87%8D%E5%A4%8D%E6%89%93%E5%8C%85"><span class="toc-number">1.6.1.3.4.</span> <span class="toc-text"> ◎ 示例 4：重复打包。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B5%E9%81%BF%E5%85%8D%E9%87%8D%E5%A4%8D%E6%89%93%E5%8C%85"><span class="toc-number">1.6.1.3.5.</span> <span class="toc-text"> ◎ 示例 5：避免重复打包。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B6-%E5%A4%9Abundle%E5%BC%95%E7%94%A8%E7%9B%B8%E5%90%8C%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85"><span class="toc-number">1.6.1.3.6.</span> <span class="toc-text"> ◎ 示例 6： 多 bundle 引用相同的第三方包。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E9%85%8D%E7%BD%AEindex-html%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 4.2 配置 index html 模板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%A4%9A%E4%B8%AAhtml%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.2.1.</span> <span class="toc-text"> 生成多个 HTML 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E8%87%AA%E5%B7%B1%E7%9A%84%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.6.2.2.</span> <span class="toc-text"> 编写自己的模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#htmlwebpackplugin%E6%8F%92%E4%BB%B6-%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.6.2.3.</span> <span class="toc-text"> HtmlWebpackPlugin 插件 常用配置项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-htmlwebpackplugin%E6%8F%92%E4%BB%B6-%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="toc-number">1.6.2.4.</span> <span class="toc-text"> ◎ 示例： HtmlWebpackPlugin 插件 常用配置项。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#43-%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text"> 4.3 多页面应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E6%90%AD%E5%BB%BA%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%BA%94%E7%94%A8-%E7%8E%AF%E5%A2%83"><span class="toc-number">1.6.3.1.</span> <span class="toc-text"> ◎ 示例：搭建多页面应用 环境。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%AB%A0-tree-shaking"><span class="toc-number">1.7.</span> <span class="toc-text"> 第五章: Tree shaking</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-tree-shaking%E5%AE%9E%E9%99%A9"><span class="toc-number">1.7.1.</span> <span class="toc-text"> 5.1 tree-shaking 实险</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Btree-shaking%E5%8A%9F%E8%83%BD%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.1.1.</span> <span class="toc-text"> ◎ 示例：tree-shaking 功能的基本使用。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-sideeffects"><span class="toc-number">1.7.2.</span> <span class="toc-text"> 5.2 sideEffects</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bsideeffects%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.2.1.</span> <span class="toc-text"> ◎ 示例：sideEffects 的基本使用。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0-%E6%B8%90%E8%BF%9B%E5%BC%8F%E7%BD%91%E7%BB%9C%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-pwa"><span class="toc-number">1.8.</span> <span class="toc-text"> 第六章：渐进式网络应用程序 PWA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E9%9D%9E%E7%A6%BB%E7%BA%BF%E7%8E%AF%E5%A2%83%E4%B8%8B%E8%BF%90%E8%A1%8C"><span class="toc-number">1.8.1.</span> <span class="toc-text"> 6.1 非离线环境下运行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bhttp-server%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.1.1.</span> <span class="toc-text"> ◎ 示例：http-server 的基本使用。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E6%B7%BB%E5%8A%A0workbox"><span class="toc-number">1.8.2.</span> <span class="toc-text"> 6.2 添加 Workbox</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bworkbox-webpack-plugin-%E6%8F%92%E4%BB%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.8.2.1.</span> <span class="toc-text"> ◎ 示例：workbox-webpack-plugin 插件的基本使用。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#63-%E6%B3%A8%E5%86%8Cservice-worker"><span class="toc-number">1.8.3.</span> <span class="toc-text"> 6.3 注册 Service Worker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="toc-number">1.8.3.1.</span> <span class="toc-text"> ◎ 示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="toc-number">1.8.4.</span> <span class="toc-text"> 小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E7%AB%A0-shimming%E9%A2%84%E7%BD%AE%E4%BE%9D%E8%B5%96"><span class="toc-number">1.9.</span> <span class="toc-text"> 第七章: shimming 预置依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#71-shimming%E9%A2%84%E8%AE%BE%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">1.9.1.</span> <span class="toc-text"> 7.1 Shimming 预设全局变量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8C%85-shimming"><span class="toc-number">1.9.1.1.</span> <span class="toc-text"> ◎ 示例：第三方包 shimming</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#72-%E7%BB%86%E7%B2%92%E5%BA%A6-shimming"><span class="toc-number">1.9.2.</span> <span class="toc-text"> 7.2 细粒度 Shimming</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bimports-loader-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.9.2.1.</span> <span class="toc-text"> ◎ 示例：imports-loader 基本使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#73-%E5%85%A8%E5%B1%80-exports"><span class="toc-number">1.9.3.</span> <span class="toc-text"> 7.3 全局 Exports</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-4"><span class="toc-number">1.9.3.1.</span> <span class="toc-text"> ◎ 示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#74-%E5%8A%A0%E8%BD%BD-polyfills"><span class="toc-number">1.9.4.</span> <span class="toc-text"> 7.4 加载 Polyfills</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8Bbabelpolyfill-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.9.4.1.</span> <span class="toc-text"> ◎ 示例：@babel&#x2F;polyfill 基本使用。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#75-%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BC%98%E5%8C%96-polyfills"><span class="toc-number">1.9.5.</span> <span class="toc-text"> 7.5 进一步优化 Polyfills</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BC%98%E5%8C%96polyfill"><span class="toc-number">1.9.5.1.</span> <span class="toc-text"> ◎ 示例：优化 polyfill</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%88%9B%E5%BB%BAlibrary"><span class="toc-number">1.10.</span> <span class="toc-text"> 第八章：创建 library</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#81-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BAlibrary"><span class="toc-number">1.10.1.</span> <span class="toc-text"> 8.1 如何构建 library</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E4%BD%BF%E7%94%A8webpack%E6%89%93%E5%8C%85%E5%87%BA%E4%B8%80%E4%B8%AAlibrary%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.10.1.0.1.</span> <span class="toc-text"> ◎ 示例：使用 webpack 打包出一个 library 的基本步骤。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#82-%E6%9E%84%E5%BB%BA%E5%B0%8F%E8%BD%AE%E5%AD%90"><span class="toc-number">1.10.2.</span> <span class="toc-text"> 8.2 构建小轮子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#outputlibrarytype%E5%B1%9E%E6%80%A7"><span class="toc-number">1.10.2.1.</span> <span class="toc-text"> output.library.type 属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E5%A4%84%E7%90%86%E4%BE%9D%E8%B5%96"><span class="toc-number">1.10.2.2.</span> <span class="toc-text"> ◎ 示例：处理依赖。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#83-%E5%8F%91%E5%B8%83%E4%B8%BAnpm-package"><span class="toc-number">1.10.3.</span> <span class="toc-text"> 8.3 发布为 npm-package</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%E5%8F%91%E5%B8%83npm%E5%8C%85%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.10.3.1.</span> <span class="toc-text"> ◎ 示例：发布 npm 包的基本步骤。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B9%9D%E7%AB%A0-%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6"><span class="toc-number">1.11.</span> <span class="toc-text"> 第九章：模块联邦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#91-%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6"><span class="toc-number">1.11.1.</span> <span class="toc-text"> 9.1 什么是模块联邦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#npm-%E6%96%B9%E5%BC%8F%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9D%97"><span class="toc-number">1.11.1.1.</span> <span class="toc-text"> ● NPM 方式共享模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#umd-%E6%96%B9%E5%BC%8F%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9D%97"><span class="toc-number">1.11.1.2.</span> <span class="toc-text"> ● UMD 方式共享模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%96%B9%E5%BC%8F%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9D%97"><span class="toc-number">1.11.1.3.</span> <span class="toc-text"> ● 微前端方式共享模块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6%E6%96%B9%E5%BC%8F"><span class="toc-number">1.11.1.4.</span> <span class="toc-text"> ● 模块联邦方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#92-%E6%90%AD%E5%BB%BA%E4%B8%89%E4%B8%AA%E5%BA%94%E7%94%A8"><span class="toc-number">1.11.2.</span> <span class="toc-text"> 9.2 搭建三个应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#93-%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6"><span class="toc-number">1.11.3.</span> <span class="toc-text"> 9.3 使用模块联邦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-5"><span class="toc-number">1.11.4.</span> <span class="toc-text"> ◎ 示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E7%8B%AC%E5%BC%80%E5%8F%91%E9%98%B6%E6%AE%B5"><span class="toc-number">1.11.4.0.1.</span> <span class="toc-text"> 单独开发阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-nav"><span class="toc-number">1.11.4.0.1.1.</span> <span class="toc-text"> 1、Nav</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-home"><span class="toc-number">1.11.4.0.1.2.</span> <span class="toc-text"> 2、Home</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-search"><span class="toc-number">1.11.4.0.1.3.</span> <span class="toc-text"> 3、Search</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97%E8%81%94%E9%82%A6"><span class="toc-number">1.11.4.0.2.</span> <span class="toc-text"> 使用模块联邦</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-nav-2"><span class="toc-number">1.11.4.0.2.1.</span> <span class="toc-text"> 1、Nav</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-home-2"><span class="toc-number">1.11.4.0.2.2.</span> <span class="toc-text"> 2、Home</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-search-2"><span class="toc-number">1.11.4.0.2.3.</span> <span class="toc-text"> 3、Search</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">1.11.4.0.3.</span> <span class="toc-text"> 结论</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%8D%81%E7%AB%A0-%E6%8F%90%E5%8D%87%E6%9E%84%E5%BB%BA%E6%80%A7%E8%83%BD"><span class="toc-number">1.12.</span> <span class="toc-text"> 第十章：提升构建性能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#101-%E5%85%AB%E4%B8%AA%E9%80%9A%E7%94%A8%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="toc-number">1.12.1.</span> <span class="toc-text"> 10.1 八个通用构建优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC"><span class="toc-number">1.12.1.1.</span> <span class="toc-text"> 1、更新到最新版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-loader"><span class="toc-number">1.12.1.2.</span> <span class="toc-text"> 2、loader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%BC%95%E5%AF%BCbootstrap"><span class="toc-number">1.12.1.3.</span> <span class="toc-text"> 3、引导 (bootstrap)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%A7%A3%E6%9E%90"><span class="toc-number">1.12.1.4.</span> <span class="toc-text"> 4、解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%B0%8F%E5%8D%B3%E6%98%AF%E5%BF%ABsmaller-faster"><span class="toc-number">1.12.1.5.</span> <span class="toc-text"> 5、小即是快 (smaller &#x3D; faster)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%8C%81%E4%B9%85%E5%8C%96%E7%BC%93%E5%AD%98"><span class="toc-number">1.12.1.6.</span> <span class="toc-text"> 6、持久化缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E8%87%AA%E5%AE%9A%E4%B9%89-pluginloader"><span class="toc-number">1.12.1.7.</span> <span class="toc-text"> 7、自定义 plugin&#x2F;loader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-dll"><span class="toc-number">1.12.1.8.</span> <span class="toc-text"> 8、dll</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-worker-%E6%B1%A0worker-pool"><span class="toc-number">1.12.1.9.</span> <span class="toc-text"> 9、worker 池 (worker pool)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-progress-plugin"><span class="toc-number">1.12.1.10.</span> <span class="toc-text"> 10、Progress plugin</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#102-%E9%80%9A%E7%94%A8%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96-dll"><span class="toc-number">1.12.2.</span> <span class="toc-text"> 10.2 通用构建优化 - dll</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-6"><span class="toc-number">1.12.2.1.</span> <span class="toc-text"> ◎ 示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#103-%E9%80%9A%E7%94%A8%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96-worker-pool"><span class="toc-number">1.12.3.</span> <span class="toc-text"> 10.3 通用构建优化 - worker-pool</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-7"><span class="toc-number">1.12.3.1.</span> <span class="toc-text"> ◎ 示例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#103-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">1.12.4.</span> <span class="toc-text"> 10.3 开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%A2%9E%E9%87%8F%E7%BC%96%E8%AF%91"><span class="toc-number">1.12.4.1.</span> <span class="toc-text"> 1、增量编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E7%BC%96%E8%AF%91"><span class="toc-number">1.12.4.2.</span> <span class="toc-text"> 2、在内存中编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-statstojson-%E5%8A%A0%E9%80%9F"><span class="toc-number">1.12.4.3.</span> <span class="toc-text"> 3、stats.toJson 加速</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-devtool"><span class="toc-number">1.12.4.4.</span> <span class="toc-text"> 4、Devtool</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%81%BF%E5%85%8D%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8B%E6%89%8D%E4%BC%9A%E7%94%A8%E5%88%B0%E7%9A%84%E5%B7%A5%E5%85%B7"><span class="toc-number">1.12.4.5.</span> <span class="toc-text"> 5、避免在生产环境下才会用到的工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%9C%80%E5%B0%8F%E5%8C%96-entry-chunk"><span class="toc-number">1.12.4.6.</span> <span class="toc-text"> 6、最小化 entry chunk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E9%81%BF%E5%85%8D%E9%A2%9D%E5%A4%96%E7%9A%84%E4%BC%98%E5%8C%96%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.12.4.7.</span> <span class="toc-text"> 7、避免额外的优化步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E4%B8%8D%E6%90%BA%E5%B8%A6%E8%B7%AF%E5%BE%84%E4%BF%A1%E6%81%AF"><span class="toc-number">1.12.4.8.</span> <span class="toc-text"> 8、输出结果不携带路径信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-nodejs-%E7%89%88%E6%9C%AC-8910-9111"><span class="toc-number">1.12.4.9.</span> <span class="toc-text"> 9、Node.js 版本 8.9.10-9.11.1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-typescript-loader"><span class="toc-number">1.12.4.10.</span> <span class="toc-text"> 10、TypeScript loader</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#104-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83"><span class="toc-number">1.12.5.</span> <span class="toc-text"> 10.4 生产环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%90%AF%E7%94%A8sourcmap"><span class="toc-number">1.12.5.1.</span> <span class="toc-text"> 不启用 SourcMap</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%98%E6%96%B9%E9%93%BE%E6%8E%A5"><span class="toc-number">1.13.</span> <span class="toc-text"> 官方链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B"><span class="toc-number">1.14.</span> <span class="toc-text"> 视频教程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99"><span class="toc-number">1.15.</span> <span class="toc-text"> 学习资料</span></a></li></ol></li></ol></div></div><div class="card-widget card-map"><div class="card-content"><div class="item-headline"><i class="fa fa-globe-asia" aria-hidden="true"></i><span>Visitor Map</span></div><script id="clstr_globe" type="text/javascript" defer="defer" src="//clustrmaps.com/globe.js?d=4LA950xi3DtQgUHPlkO0mo-n_QgrcOu-1BIiVpExg7k"></script></div></div><div class="card-widget card-pixiv"><div class="card-content"><div class="item-headline"><i class="fa fa-image" aria-hidden="true"></i><span>Pixiv Top50</span><iframe src="https://cloud.mokeyjay.com/pixiv" frameborder="0" style="width:99%;height:380px;margin:0;"></iframe></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/07/28/Maven/" title="My Maven notes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/hello-world.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My Maven notes"/></a><div class="content"><a class="title" href="/2022/07/28/Maven/" title="My Maven notes">My Maven notes</a><time datetime="2022-07-27T12:00:00.000Z" title="Created 2022-07-28 00:00:00">2022-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/25/nodejs/" title="Nodejs notes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/town.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nodejs notes"/></a><div class="content"><a class="title" href="/2022/07/25/nodejs/" title="Nodejs notes">Nodejs notes</a><time datetime="2022-07-24T12:00:00.000Z" title="Created 2022-07-25 00:00:00">2022-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/12/%E7%AE%97%E6%B3%95%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97/" title="My ultimate data structure and algorithm guide"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/statue.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="My ultimate data structure and algorithm guide"/></a><div class="content"><a class="title" href="/2022/06/12/%E7%AE%97%E6%B3%95%E7%BB%88%E6%9E%81%E6%8C%87%E5%8D%97/" title="My ultimate data structure and algorithm guide">My ultimate data structure and algorithm guide</a><time datetime="2022-06-11T12:00:00.000Z" title="Created 2022-06-12 00:00:00">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="Design Patterns"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Design Patterns"/></a><div class="content"><a class="title" href="/2022/06/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="Design Patterns">Design Patterns</a><time datetime="2022-06-11T12:00:00.000Z" title="Created 2022-06-12 00:00:00">2022-06-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" title="Design Patterns - Factory Method"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/default-covers/home.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Design Patterns - Factory Method"/></a><div class="content"><a class="title" href="/2022/06/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%20-%20%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95/" title="Design Patterns - Factory Method">Design Patterns - Factory Method</a><time datetime="2022-06-10T12:00:00.000Z" title="Created 2022-06-11 00:00:00">2022-06-11</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Harry Qu</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="Chat"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://harryqu1229.github.io/2021/12/29/webpack5%E9%AB%98%E7%BA%A7/'
    this.page.identifier = '2021/12/29/webpack5高级/'
    this.page.title = 'My Webpack5 notes'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://harry-study-blog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '5df1e915e0fa867b50de',
      clientSecret: 'ce1cb793fe49078ee9d0102d3326d0d50ff6937b',
      repo: 'blog-comments-storage',
      owner: 'HarryQu1229',
      admin: ['HarryQu1229'],
      id: 'b35f35e1866aa07eba6216cc9533a8c9',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Disqus' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<code>.*?<\/code>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    fetch('https://disqus.com/api/3.0/forums/listPosts.json?forum=harry-study-blog&related=thread&limit=6&api_key=B5XFmdGuVaYDW7OIBakffpXoKorvphwRiwONIol4puEtr8YiwYAMAk2K7QcExNLY')
      .then(response => response.json())
      .then(data => {
        const disqusArray = data.response.map(item => {
          return {
            'avatar': item.author.avatar.cache,
            'content': changeContent(item.message),
            'nick': item.author.name,
            'url': item.url,
            'date': item.createdAt
          }
        })

        saveToLocal.set('disqus-newest-comments', JSON.stringify(disqusArray), 10/(60*24))
        generateHtml(disqusArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "Unable to get the data, please make sure the settings are correct."
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick}</span><time> / ${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('disqus-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="2809513713" data-server="netease" data-type="playlist" data-autoplay="false" data-fixed="true" data-order="random" data-theme="#e9ccd3"> </div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="255,255,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>((window.gitter = {}).chat = {}).options = {
  disableDefaultChat: true,
};
document.addEventListener('gitter-sidecar-ready', (e) => {
  const GitterChat = e.detail.Chat
  let chat

  function initGitter () {
    chat = new GitterChat({
      room: 'HarryStudyBlog/community',
      activationElement: '#chat_btn'
    });
  }

  initGitter()

  if (true) {
    document.addEventListener('pjax:complete', () => {
      chat.destroy()
      initGitter()
    })
  }

})</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async="async" defer="defer"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v3.8.2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":300,"height":450},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>